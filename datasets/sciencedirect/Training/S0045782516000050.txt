@&#MAIN-TITLE@&#
Nonlinear structural design using multiscale topology optimization. Part II: Transient formulation

@&#HIGHLIGHTS@&#
Adjoint sensitivity analysis for nonlinear elastodynamics.Composite design for desired energy propagation.Multiscale topology optimization.

@&#KEYPHRASES@&#
Topology optimization,Elastodynamics,Energy management,Computational homogenization,

@&#ABSTRACT@&#
We extend the hierarchical multiscale design framework of Nakshatrala et al. (2013) to nonlinear elastodynamics wherein we use topology optimization to design material micro-structures to achieve desired energy propagation in nonlinear elastic material systems subjected to impact loading. As in Part I, a well-posed topology optimization problem is obtained via (a) relaxation to design the macroscale which requires homogenization theory to relate the macroscopic homogenized response to its micro-structure and (b) via restriction to design the microscale to obtain a well-defined micro-structural length scale. It is assumed that the primary wavelengths of interest are much longer than the micro-structural length scale and hence the effective properties are computed using the static homogenization theory. An adjoint sensitivity analysis is performed to compute the derivatives of the objective function with respect to the micro-structural design parameters and a gradient-based optimization algorithm is used to update the design. The numerical implementation of the computationally challenging terminal-value adjoint problems is discussed and a structural design example for tailored energy propagation is provided.

@&#INTRODUCTION@&#
Wave propagation in highly heterogeneous media with gradually changing macroscopic material properties must be considered in many situations, e.g. for crashworthiness, acoustic and electromagnetic cloaking, impact mitigation and others. Towards this end, Le et al.  [1] use topology optimization to design structures with spatially varying material micro-structures comprised of linear elastic sequentially ranked laminates to tailor energy propagation. In the present work, we extend this study to the nonlinear elastic regime wherein the material micro-structure parameters are related to macroscopic effective properties via homogenization theory  [2–8]. To do this we extend the computational framework developed in Nakshatrala et al.  [9] to the dynamic regime.Initial research on tailoring wave propagation is focused on electromagnetic cloaking [10–12] and acoustic cloaking [13–15] where gradually changing material properties are used to cloak objects at certain wavelengths. Elastodynamic applications are later explored in Milton et al.  [16], Brun et al.  [17], Norris and Shuvalov  [18] and Amirkhizi et al.  [19] by imposing gradual changes in the anisotropy of the material elasticity tensor. All these approaches introduce a prescribed spatial variation in the constitutive properties based on coordinate transformations surrounding the cloaking region.As an alternative to the aforementioned analytical approaches, various computational frameworks based on topology optimization have been developed. Early approaches in topology optimization related to “dynamic loading” maximized the structure’s natural frequency  [20–22]. Similar approaches use the Floquet–Bloch wave theory to design both micro- and macro-structures, refer to Bendsøe and Sigmund  [23] and the references cited within. Topology optimization via inverse homogenization has been used to obtain periodic unit cell micro-structures for photonic  [24] and phononic  [25–28] bandgap structures. Also, multiple materials are optimally distributed in the macro-structure to design wave guides  [25,29]. The above approaches are based on frequency domain analysis. Topology optimization based on time domain analysis is addressed by Dahl et al.  [30], Min et al.  [31], Turteltaub  [32], Le et al.  [1]. In our work, we generate the desired nonlinear elastodynamic macroscopic trajectory by optimizing the micro-structure throughout the structure, i.e. the micro-structure at every point in the structure is optimized thus creating an optimized heterogeneous composite structure.Optimal design of structures subjected to impact loads has been analyzed under the one-dimensional assumption by Bruck  [33], Velo and Gazonas  [34], where the objective was to reduce the amplitude of the stress waves. Le et al.  [1] design the optimal layer volume fractions and orientations in sequentially ranked laminates to obtain desired macroscopic energy trajectories in linear elastic two-dimensional structures subjected to impact loads. At each macroscopic material point, the laminate parameters are assigned and closed form homogenization expressions are used to compute the macroscopic effective properties. Sensitivities computed by an adjoint method are combined with nonlinear programming to optimize the laminate parameters.Many of these studies assume linear elastic behavior; our work studies nonlinear elastodynamics by extending the multiscale topology optimization framework we discussed in Nakshatrala et al.  [9]. Specifically, we design the optimal micro-structural morphologies to obtain effective energy propagation in structures subject to impact loadings. The homogenization theory described in Nakshatrala et al.  [9] is again used to compute the “averaged” coarse scale response without fully resolving the high frequency oscillations corresponding to the fine scale. Indeed the static homogenization theory holds since we assume the primary wavelengths are much longer than the unit cell length scale  [2] whereby the material is considered homogeneous at the scale of the considered wavelengths even though microscopically it is highly heterogeneous.We also use the numerical approach of Nakshatrala et al.  [9] wherein the macroscopic domain is discretized by finite elements; and each integration point of each macroscopic finite element is assigned a distinct micro-structure that is defined by its unit cell which itself is discretized by finite elements. Again as in Nakshatrala et al.  [9] our design variables are the material constituent volume fractions for each finite element in each unit cell corresponding to each integration point of each macroscopic finite element. And again like  [9] the response for a given design and time instant is computed using a multilevel nested Newton strategy where the outer iterations resolve the macroscopic momentum balance equation of the macro-structure while the inner iterations resolve the equilibrium equation of the micro-structural unit cells. As an extension of Nakshatrala et al.  [9] we consider dynamic response which is a straightforward extension for the analysis, but not the sensitivity analysis. Following  [35], a motivation for the choice of the discretize and then differentiate sensitivity analysis is provided through a linear oscillator example. The numerical implementation of the discrete adjoint sensitivity analysis is discussed and then combined with our optimality criteria based optimization algorithm  [23,1] to iteratively update the micro-structural design parameters. To do this we enhance the parallel framework as described in Nakshatrala et al.  [9] and apply the resulting framework to design an optimal material microstructure at each point in the macroscopic structure to achieve controlled energy propagation.The organization of this manuscript is as follows. Section  2 presents the transient dynamic optimization problem, motivation for the adjoint sensitivity analysis is provided in Section  3, the sensitivity analysis is detailed in Section  4 and numerical examples and conclusions are provided in Sections  5 and 6.Using the notation described in Nakshatrala et al.  [9], the elastodynamic governing equation of motion is(1)div(Pϵ)+bϵ=ρϵaϵ,x∈Ωϵ,whereaϵ,ρϵ,Pϵ,bϵandxare the acceleration, mass density, first Piola–Kirchhoff stress, body force and material point location in the reference configurationΩϵof the heterogeneous macro-structure, respectively.We are concerned with the averaged response over the lengthscaleϵand not the fine scale oscillations. We compute this averaged (homogenized) response by replacing (1) with the homogenized equation(2)div(PM)+bM=ρMaM,x∈ΩM,withaM,ρM,PMandbMdenoting the homogenized acceleration, mass density, first Piola–Kirchhoff stress and body force fields in the homogenized macro-structureΩM. The homogenized density is trivially computed by volume averaging the densities of the constituent phases over the unit cell. Using the long wavelength assumption, we compute the homogenized stressPMusing the static homogenization theory, cf.  [2,9]. And while convergence proofs exist to show the displacementuϵ⇀uMweakly inU(ΩM)×[0,T]whereU={u∈H1(Ω),u=0onΓD}withΓDthe portion of∂ΩMover which displacement is fixed andTis the total simulation time, it is known that the energy corresponding touϵdoes not in general converge to the energy corresponding touM, cf.  [36]. Corrector problems can be introduced to ensure convergence but such a choice would complicate our optimization. However, the need for such correctors is not necessary if zero initial conditions are prescribed  [36]. As such we assign zero initial data in all our examples. This subtle point is critical to accurately evaluate the response.The weak formulation for the macroscopic problem is to finduM∈U×[0,T]such that at any given timet(3)rM(uM)≔∫ΩM(ϱMw⋅aM+∇w⋅PM−w⋅b)dΩ=0∀w∈U,where, without loss of generality, we assume zero applied traction. We use thea−form of Newmark’s implicit time-stepping scheme  [37] coupled with Newton’s method to solve (3). To this end, (3) is discretized in time to obtain(4)rM(n)(aM(n))≔∫Ω(ϱMw⋅aM(n)+∇w⋅PM(n)−w⋅b(n))dΩ=0,whereaM(n)=aM(t(n))etc. andt(n)denotes the time. The argument switch fromuMtoaM(n)in the residuals of (3) and (4) is justified by the Newmark update equations that relate accelerationaM(n)to displacementuM(n)and velocityvM(n), viz.(5)uM(n)=uM(n−1)+ΔtvM(n−1)+(1−2β)2Δt2aM(n−1)+βΔt2aM(n),(6)vM(n)=vM(n−1)+(1−γ)ΔtaM(n−1)+γΔtaM(n),whereβandγare the Newmark stability parameters andΔt=t(n)−t(n−1)is the time increment  [37].At each timet(n), we solve (4) via Newton’s method to computeaM(n)and subsequently update the values ofuM(n)andvM(n)via (5)–(6). Each Newton iteration requires us to compute the response correctionδaMsuch that(7)δrM(n)(aM(n);δaM(n))+rM(n)(aM(n))=0,where the variation of (3) is(8)δrM(n)(aM(n);δaM(n))=∫Ω(ϱMw(n)⋅δaM(n)+βΔt2∇w⋅AM(FM(n))[∇δaM(n)])dΩ,in which we use (5) to obtain∇δuM=βΔt2∇δaMand see the appearance of the incremental elasticity tensorAM(FM)=∂PM(FM)/∂FMderived in Nakshatrala et al.  [9]. After finite element discretization (7) takes the familiar form(9)(M+βΔt2KT(n))δa(n)=−R(n)whereMandKT(n)are the mass and tangent stiffness matrices andδa(n)andR(n)are the nodal update acceleration and residual vectors.11Henceforth sans-serif font denotes finite element quantities that result after parameterizing the response and integrating over the domainΩin the usual manner.The formation ofKT(n)is identical to that discussed in Nakshatrala et al.  [9] and the formation ofR(n)is also the same sans the added dynamic termMa(n)which is standard. Upon updating theaM(n)=aM(n)+δaM(n), we update the displacementuM(n)=uM(n)+βΔt2δaM(n)and velocityvM(n)=vM(n)+γΔtδaM(n)via (5) and (6). Iterations continue until (4) is satisfied to within a specified convergence tolerance whereupon the timet(n)is incremented tot(n+1)=t(n)+Δtand the process begins anew.In order to motivate the subsequent adjoint sensitivity analysis for our multiscale problem, we first consider a spring mass system with two degrees of freedom (see Fig. 1). The equation of motion for this system is(10)Ma+Ku=f,whereM=[m100m2]is the mass matrix,K=[(k1+k2)−k2−k2(k2+k3)]is the stiffness matrix andfis the time varying forcing function. Here and for future reference we recall thatu,vandaare the displacement, velocity and acceleration vectors. For the sensitivity analysis, we treatMandKas explicit functions of the design parameter vectordmakingu,vandaimplicit functions ofd.For our sensitivity analysis we consider a general response function of the displacement, velocity, acceleration and the design parameterd(a component ofd) i.e.,(11)Θ(d)=∫0Tπ(u(t,d),v(t,d),a(t,d),d,t)dt,where[0,T]is the time interval of interest. The derivative of (11) with respect todis(12)∇Θ=∫0T(∂π∂uDu+∂π∂vDv+∂π∂aDa+∂π∂d)dt,whereDu,DvandDaare the derivatives ofu,vandawith respect tod. For this simple system, it is easy to compute the analytical solution to (10) and thusly evaluate the derivative∇Θin (12). Bearing in mind the forthcoming nonlinear finite element applications, we solve (10) numerically via the aforementioned implicit Newmark scheme. Using the computed response,Θ(d)is approximated via, e.g the rectangular summation rule as(13)Θa(d)=∑n=1Nπ(n)(u(n)(d),v(n)(d),a(n)(d),d)Δt,where we replace the argumentt(n)inπwith the superscript, i.e.π(n)(u(n)(d),v(n)(d),a(n)(d),d)=π(u(n)(d),v(n)(d),a(n)(d),d,t(n)).In most studies on dynamic topology optimization the sensitivities are computed via the differentiate and then discretize adjoint variable approach [32,38,39] with the exception of Le et al.  [1] in which a discretize and then differentiate approach is used. In what follows, we review two ways to compute numerical approximations to (12) via an adjoint method  [35]: they are the (a) differentiate and then discretize procedure; and (b) discretize and then differentiate procedure.22An additional procedure discussed in Jensen et al.  [35] is not discussed here due to its cumbersome numerical implementation.; We then compare them to motivate the approach (b) that is used in our nonlinear transient dynamic applications.In adjoint-based sensitivity analysis, we compute the derivative of the response function by eliminating the implicit derivativesDu,DvandDathat are difficult to compute  [40]. To accomplish this annihilation we take the derivative of (10) with respect tod(this is often referred to as the pseudo equation) and multiply it by an arbitrary, smooth adjoint variableλ, integrate over the time interval[0,T]and add the resulting zero i.e.,∫0TλTDDd(Ma+Ku−f)dt=0to (12). Twice integrating the resulting expression by parts and rearranging yields(14)∇Θ=∫0T(∂π∂uDu+∂π∂vDv+∂π∂aDa+∂π∂d)dt+∫0TλTDDd(Ma+Ku−f)dt=∫0TλT(DMa+DKu)dt+∫0T(Du)T[Mλ̈+Kλ+(∂π∂u−ddt(∂π∂v)+d2dt2(∂π∂a))T]dt+[(Du)T((∂π∂v−ddt(∂π∂a))T−Mλ̇)+(Dv)T((∂π∂a)T+Mλ)]|t=T,where, without loss of generality, we use the simplifying assumptions∂f/∂d=Du(0)=Dv(0)=0. To eliminate the response derivativesDu,DvandDafrom (14), we define the adjoint variableλsuch that it annihilates the terms in brackets. This would yield an adjoint problem that is similar to the primal analysis but with terminal conditionsMλ(T)=−(∂π/∂a)TandMλ̇(T)=(∂π/∂v−ddt(∂π/∂a))T|t=Tmaking the adjoint problem a terminal-value problem. To make the adjoint problem resemble the primal initial-value problem, we apply a change of variable such thatt=τ(s)=T−sand introduce the composite functionΛsuch thatΛ(s)=λ(τ(s))=λ(T−s)to transform the terms involving the response derivativesDuandDvto(15)∇Θ=∫0T∂π∂ddt+∫0TλT(DMa+DKu)dt+∫0T(Du(τ(s)))T[MΛ̈(s)+KΛ(s)+(∂π∂u−ddt(∂π∂v)+d2dt2(∂π∂a))T|t=τ(s)]ds+(Du(T))T((∂π∂v−ddt(∂π∂a))T|t=T+MΛ̇(0))+(Dv(T))T[(∂π∂a)T|t=T+MΛ(0)].To annihilate the response derivatives we now assign the heretofore arbitrary adjoint variableΛsuch thatMΛ̈(s)+KΛ(s)=−(∂π∂u−ddt(∂π∂v)+d2dt2(∂π∂a))T|t=τ(s),MΛ(0)=−(∂π∂a)T|t=T,(16)MΛ̇(0)=−(∂π∂v−ddt(∂π∂a))T|t=T.Note that the adjoint transient problem closely resembles the primal problem and is typically solved using the same procedure as the primal transient analysis. Also note the efficiency of the adjoint problem in that the coefficient matrices are the same as the primal problem allowing one to store and reuse the decomposed coefficient matrices from the primal analysis, provided a constant time-step is used throughout the simulation. Upon solving the above adjoint problem, the sensitivity in (15) reduces to(17)∇Θ=∫0T∂π∂ddt+∫0TλT(DMa+DKu)dt,=∫0T∂π∂ddt+ΛT∗(DMa+DKu)|t=Twhere∗is the convolution and it is understood that the above renders the derivative with respect to any parameterdofd.In the numerical implementation, the discrete approximation to the time continuous adjoint sensitivity expression in (17) is obtained from(18)∇Θa≈∑n=1N[∂π(n)∂d+Λ(N−n+1)T(DMa(n)+DKu(n))]Δt.Due to the order of the computations in this approach wherein we differentiated the time continuous equation (11) and then introduced the time discretization to obtain (18), it is characterized as the differentiate and then discretize approach. Though this method is simple and the derivation is straightforward, as soon seen, it suffers from consistency errors.In the previous approach, we derived the sensitivity expressions in the time-continuous form and discretized the final expression to numerically evaluate them. However, in the discretize and then differentiate approach, the sensitivities are computed by differentiating the discretized response, cf. (13)   [1].To begin, the responsea(n)at each timet(n)is evaluated by solving(19)(M+βΔt2K)a(n)=f(n)−K(uM(n−1)+ΔtvM(n−1)+(1−2β)2Δt2aM(n−1))whereafteru(n)andv(n)are computed from (5) and (6). Next the discretized function (13) is evaluated and subsequently differentiated to give the sensitivity(20)∇Θ=∑n=1N(∂π(n)∂u(n)Du(n)+∂π(n)∂v(n)Dv(n)+∂π(n)∂a(n)Da(n)+∂π(n)∂d)Δt.As aboveDu(n),Dv(n)andDa(n)are implicit quantities defined via the governing equations; we eliminate them using the adjoint approach.Mimicking the derivation of (14) we add a zero to (20). And by noting the convolution operation in the sensitivity expression (17), we anticipate the same need here. Hence, the added zero to (20) is obtained by multiplying a “discrete convolved” arbitrary adjoint variableλ(N−n+1)(rather thanλ(n)) with an identity obtained from the derivative of (19) at timet(n)i.e., the discrete pseudo equation. In the differentiate and then discretize derivation of (14) integration-by-parts is used to convert the derivativesDv(t)andDa(t)toDu(t)and some additional terms at timest=0andt=T. In the discretize and differentiate approach we do not have this luxury. Thusly, to annihilate the derivativesDu(n)andDv(n), identities obtained from the derivatives of (5) and (6) at timet(n)are “convolved” with additional adjoint variablesμ(N−n+1)andη(N−n+1). These additional variables can be viewed as the adjoint displacement and velocity that appear in a Newmark-Beta like time-stepping for the adjoint simulation. By adjoining these three zero expressions, the sensitivity (13) is equivalently written as(21)∇Θ=∑n=1N(∂π(n)∂u(n)Du(n)+∂π(n)∂v(n)Dv(n)+∂π(n)∂a(n)Da(n)+∂π(n)∂d)Δt+∑n=1Nλ(N−n+1)TDDd[(M+βΔt2K)a(n)−f(n)+K(u(n−1)+Δtv(n−1)+(1−2β)2Δt2a(n−1))]Δt+∑n=1Nμ(N−n+1)TDDd(−u(n)+u(n−1)+Δtv(n−1)+(1−2β)2Δt2a(n−1)+βΔt2a(n))Δt+∑n=1Nη(N−n+1)TDDd(−v(n)+v(n−1)+(1−γ)Δta(n−1)+γΔta(n))Δt,since each of the last three summations equal zero. We now do some rearranging to isolate the response derivativesDu(n),Dv(n)andDa(n), cf. (15), to obtain(22)∇Θ=∑n=1N[∂π(n)∂d+λ(N−n+1)T(DMa(n)+DKu(n))]Δt+∑n=1N(Du(n))T[(∂π(n)∂u(n))T−μ(N−n+1)+H(N−n)(Kλ(N−n)+μ(N−n))]+∑n=1N(Dv(n))T[(∂π(n)∂v(n))T−η(N−n+1)+H(N−n)[Δt(Kλ(N−n)+μ(N−n))+η(N−n)]]+∑n=1N(Da(n))T[(M+βΔt2K)λ(N−n+1)+(∂π(n)∂a(n))T+βΔt2μ(N−n+1)+γΔtη(N−n+1)+H(N−n)[(1−2β)2Δt2(Kλ(N−n)+μ(N−n))+(1−γ)Δtη(N−n)]]where we again assume that the load and initial condition derivatives are zero, we use (5) (on the first line of the above) and we introduce the Heaviside step functionH(which is defined such thatH(x)=0ifx≤0andH(x)=1ifx>0). The terms that contain the response derivatives are annihilated by requiring adjoint responsesλ(n),μ(n)andη(n)to satisfy(23)μ(n)=(∂π(N−n+1)∂u(N−n+1))T+H(n−1)(Kλ(n−1)+μ(n−1)),(24)η(n)=(∂π(N−n+1)∂v(N−n+1))T+H(n−1)[Δt(Kλ(n−1)+μ(n−1))+η(n−1)],(25)(M+βΔt2K)λ(n)=−(∂π(N−n+1)∂a(N−n+1))T−βΔt2μ(n)−γΔtη(n)−H(n−1)[(1−2β)2Δt2(Kλ(n−1)+μ(n−1))+(1−γ)Δtη(n−1)],forn=1,…,N.The auxiliary equations (23) and (24) are explicit equations (i.e., they do not involve a linear solve) andμ(n)andη(n)are computed before solving the adjoint matrix equation (25) forλ(n). This is in contrast to the primal analysis where we solve the primal matrix equation (19) fora(n)prior to evaluatingu(n)andv(n)from the auxiliary equations (5) and (6). This “reordering” is to be expected in the adjoint analysis in which the order of the computations is dictated by the discrete convolution. We also note that the coefficient matrices in the primal and adjoint analyses fora(n)andλ(n)are identical (assuming equal time-steps) and that the adjoint “displacement”μ(n)and “velocity”η(n)are obtained from explicit expressions akin to the primal displacementu(n)and velocityv(n)computations.The final sensitivity expression obtained after eliminating the implicit derivatives reduces to(26)∇Θb=∑n=1N[∂π(n)∂d+λ(N−n+1)T(DMa(n)+DKu(n))]Δt.

@&#CONCLUSIONS@&#
We have demonstrated the application of a topology optimization framework to effectively design nonlinear elastic material micro-structures for tailored energy propagation. A discretize and then differentiate sensitivity analysis using multiple adjoint variables is motivated through a two-degree of freedom spring mass system. Future work should incorporate the size effects by using higher-order homogenization theory and more complex material models, e.g. that are history dependent.