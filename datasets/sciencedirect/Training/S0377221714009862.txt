@&#MAIN-TITLE@&#
The center of a convex set and capital allocation

@&#HIGHLIGHTS@&#
A capital allocation scheme for coherent risk measures has been suggested.It returns the unique solution for every coherent risk measure.The resulting capital allocation is linear and diversifying.The method can be applied to fair division in optimal risk sharing problems.

@&#KEYPHRASES@&#
Capital allocation,Risk contribution,Coherent risk measures,Risk sharing,

@&#ABSTRACT@&#
A capital allocation scheme for a company that has a random total profit Y and uses a coherent risk measure ρ has been suggested. The scheme returns a unique real numberΛρ*(X,Y),which determines the capital that should be allocated to company’s subsidiary with random profit X. The resulting capital allocation is linear and diversifying as defined by Kalkbrener (2005). The problem is reduced to selecting the “center” of a non-empty convex weakly compact subset of a Banach space, and the solution to the latter problem proposed by Lim (1981) has been used. Our scheme can also be applied to selecting the unique Pareto optimal allocation in a wide class of optimal risk sharing problems.

@&#INTRODUCTION@&#
One of the basic problems in risk management is to determine the allocation of risk capital among agents or business units. We make two assumptions: (i) a company consists of n subsidiaries, each contributing a random profit Xi, so that the total profit of the company isY*=∑i=1nXi,and (ii) the company has decided, or is required by a regulator, to reserve a risk capital ρ(Y*), to compensate possible loss, where ρ(.) is a fixed risk measure. The capital allocation problem is to distribute ρ(Y*) among subsidiaries, that is, to assign subsidiary i the capital kiwith∑i=1nki=ρ(Y*). The numbers kiare called risk contributions of Xito the Y*.Ifρ(Y*)≤∑i=1nρ(Xi),it is possible to find a capital allocation such that ki≤ ρ(Xi), i = 1, … , n. This corresponds to the intuition of diversification: the risks produced by subsidiaries partially compensate each other, which allows one to reduce the risk contribution of each of them. Ifρ(Y*)=∑i=1nρ(Xi),such an allocation is unique and given by ki= ρ(Xi), i = 1, … , n. The capital allocation problem can be formulated as follows.Problem IAssume thatρ(Y*)<∑i=1nρ(Xi),so that a capital allocation satisfying ki≤ ρ(Xi), i = 1, … , n is not unique. Which one to choose?The capital allocation problem in this or similar form has been extensively studied in a number of papers, see e.g. Denault (2001), Delbaen (2004), Kalkbrener (2005), Cherny and Orlov (2011) and references therein. We rely on a natural assumption (see Kalkbrener, 2005), that the risk contribution kiof subsidiary i depends only on Xiand Y*, but not on the decomposition of Y* − Xiamong the rest of subsidiaries. In this context, a capital allocation with respect to risk measure ρ(.) is just a function of two arguments Λρ(X, Y), such that Λρ(Y, Y) = ρ(Y). With ki= Λρ(Xi, Y*), the requirements (i)∑i=1nki=ρ(Y*)and (ii) ki≤ ρ(Xi), i = 1, … , n can now be rewritten as(i)(Linearity) Λρ(X, Y) is a linear functional in the first argument;(Diversification) Λρ(X, Y) ≤ ρ(X) for all X, Y.Kalkbrener (2005) proved that a linear diversifying capital allocation exists if and only if the risk measure ρ is positively homogeneous and subadditive. He also proved that it is unique for a fixed Y and ρ(.) if and only if the directional derivative(1)limɛ→0ρ(Y+ɛX)−ρ(Y)ɛexists for all X. This, however, is not the case in many natural contexts. Cherny and Orlov (2011) argue that it might not exists for a popular risk measure CVaR(.) if the distribution function of Y is not continuous, which is typical e.g. in the context of credit portfolios. Actually, if we denoteY(ρ)to be the set of all Y such that (1) does not exists for some X, one can prove thatY(ρ)is non-empty unless ρ(.) is linear (see Proposition 1), and, moreover, one may getY∈Y(ρ)by solving a natural optimization problem (see Example 3). Problem I can be adapted to this context as followsProblem IILet ρ be a positively homogeneous and subadditive risk measure, and assume thatY∈Y(ρ),so that a linear diversifying capital allocation Λρ(X, Y) is not unique. Which one to choose?A possible approach to solve Problem II is to impose additional assumptions on capital allocation. Kalkbrener (2005) introduced a “continuity in Y” axiom, and proved that if a linear, diversifying, and continuous capital allocation exists, it is unique. However, Theorem 4.3. in Kalkbrener (2005) states that the existence of such a capital allocation is equivalent to the existence of directional derivative in (1), so this approach makes no progress in Problem II.Cherny and Orlov (2011) suggested to consider the capital allocation problem within the framework of coherent risk measures of Artzner, Delbaen, Eber, and Heath (1999), and introduced an assumption that Λρ(X, Y) is law-invariant, that is, depends only on the joint law of X and Y. They proved that the linear diversifying law-invariant capital allocation exists and is unique for a class of so called weighted VaR risk measures, defined on an atomless probability space. However, there are important coherent risk measures outside of this class, for which such a capital allocation does not exist or might not be unique, see Section 2.In this paper, we develop an approach of selecting one linear diversifying capital allocation for every coherent risk measure. Our approach can naturally be extended to other classes of positively homogeneous and subadditive functionals. We do this by reducing this problem to selecting a “center” in a convex weakly compact subset of a Banach space, which is fixed under affine isometries, and the latter problem was solved in Lim (1981). If directional derivative in (1) exists for every X, our capital allocation coincides with that of Kalkbrener (2005); if ρ belongs to the class of weighted VaR, it coincides with that of Cherny and Orlov (2011). We do not assume that probability space is atomless, and an important special case of discrete probability space is treated separately.This work is organized into eight sections. Section 2 formulates a capital allocation problem, provides several motivating examples, and reduces the problem to identification of the “center” in a convex weakly compact set. Section 3 suggests a solution in a special but important case when the underlying probability space is finite. Section 4 reformulates the concept of law-invariant capital allocation, suggested by Cherny and Orlov (2011), in terms of invariance under automorphisms of the underlying probability space. Section 5 solves the capital allocation problem in the general case, while Section 6 discusses an economic interpretation of the obtained solution. Section 7 applies the results to the optimal risk sharing problem. Section 8 concludes the work.Let(Ω,F,P)be a probability space, where Ω denotes the designated space of future states ω,Fis a field of sets in Ω, andPis a probability measure on(Ω,F). We will assume that probability space is standard, that is, isomorphic mod 011Two probability spaces(Ω1,F1,P1)and(Ω2,F2,P2),are isomorphic mod 0, if there exist sets Ai⊂Ωi, i = 1, 2, withP1(A1)=P2(A2)=0,and an invertible map f: Ω1/A1 → Ω2/A2 such that both f and f−1 are measurable, andP1(A)=P2(f(A))for allA∈F1.to an interval (0, 1) with Lebesgue measure, a finite or countable set of atoms22A setA∈FwithP[A]>0is called atom ifP[B]=0orP[B]=P[A]for everyB∈Fsuch that B⊂A., or a combination (disjoint union) of both. A random variable (r.v.) is any measurable function from Ω toR. The relations between r.v.’s are understood to hold in the almost sure sense, e.g., we write X = Y ifP[X=Y]=1and X ≥ Y ifP[X≥Y]=1. We restrict our attention to r.v.’s fromL1(Ω)=L1(Ω,F,P)(r.v.s with finite expectations), or fromL∞(Ω)=L∞(Ω,F,P)(bounded r.v.s).FX(x)=P[X≤x]andqX(α)=inf{x|FX(x)>α}will denote the cumulative distribution function (CDF) and quantile function of an r.v. X, respectively. The probability space Ω is called atomless if there exists an r.v. with a continuous CDF. This implies existence of r.v.’s on Ω with all possible CDFs (see e.g. Proposition A.27 in Föllmer and Schied, 2004).A risk measure is any functionalρ:L∞(Ω)→R. A capital allocation with respect to the risk measure ρ(.) is a functionalΛρ:L∞(Ω)×L∞(Ω)→Rsatisfying Λρ(Y, Y) = ρ(Y). It is called linear if Λρ(aX1 + bX2, Y) = aΛρ(X1, Y) + bΛρ(X2, Y), for allX1,X2,Y∈L∞(Ω)anda,b∈R; it is called diversifying if Λρ(X, Y) ≤ ρ(X) for allX,Y∈L∞(Ω). This paper studies the problem of selection of a linear diversifying capital allocation for a given risk measure ρ(.).Theorem 4.2. in Kalkbrener (2005) proves that there exists a linear diversifying capital allocation Λρ(., .) if and only if ρ(.) is positively homogeneous and subadditive. This suggests that the capital allocation problem can naturally be considered in the context of coherent risk measures in the sense of Artzner et al. (1999).Definition 1Coherent risk measuresA coherent risk measure is any functionalρ:L∞(Ω)→Rsatisfying the axioms(R1)ρ(X) ≤ ρ(Y) if X ≥ Y (monotonicity),ρ(λX) = λρ(X) for all X and all λ ≥ 0 (positive homogeneity),ρ(X + Y) ≤ ρ(X) + ρ(Y) for all X and Y (subadditivity),ρ(X + C) = ρ(X) − C for all X and constant C.A risk measure ρ(.) is called continuous from below iflimn→∞ρ(Yn)=ρ(Y)for every non-decreasing sequence Ynconverging to Y pointwise on Ω. For simplicity of presentation, we first solve the capital allocation problem for the case of coherent risk measures, which are continuous from below. The extension to all coherent risk measures, and beyond, is presented in Section 5.Corollary 4.35 in Föllmer and Schied (2004) states that coherent risk measure ρ is continuous from below if and only if(2)ρ(Y)=maxQ∈QEQ[−Y],forallY∈L∞(Ω),forQ⊂F1(P),whereF1(P)is the set of all probability measures which are absolutely continuous with respect toP. Moreover,Qcan be chosen such that the set of Radon–Nikodym derivatives(3)S={dQdP,Q∈Q}is weakly compact inL1(Ω). Also, without loss in generality,Q(and thusS) can be assumed to be convex, otherwise the same representation holds for its closed convex hull. For a fixedY∈L∞(Ω),letS(Y)be the non-empty set of elements ofS,at which the maximum in (2) is attained. For everyS=dQdP∈S(Y),the functional Λρ(X, Y) ≔ EQ[ − X] = −E[SX] is a linear diversifying capital allocation. Theorem 4.3. in Kalkbrener (2005) states that it is unique (and thusS(Y)is a singleton) if and only if the directional derivative (1) exists for all X. For a given risk measure ρ, letY(ρ)be the set of all Y such thatS(Y)is not a singleton (equivalently, such that (1) does not exist for some X). We start with the following simple observation.Proposition 1For risk measure ρ satisfying (R2) and (R3), the directional derivative (1) exists at 0 in any direction X, if and only if ρ is linear. Hence0∈Y(ρ)if and only if ρ is not linear.If ρ is linear, the directional derivative (1) exists and equal to ρ(X). In the opposite direction, if the derivative (1) exists for Y = 0, then the right derivative, which is ρ(X), is equal to the left one, which is − ρ( − X). Hence, using subadditivity, ρ(X1 + X2) ≤ ρ(X1) + ρ(X2) = −(ρ( − X1) + ρ( − X2)) ≤ −ρ( − X1 − X2) = ρ(X1 + X2), showing ρ(X1 + X2) = ρ(X1) + ρ(X2) for anyX1,X2∈L∞(Ω).□Proposition 1 shows that, for every non-linear ρ, setY(ρ)contains 0, and therefore, in particular, it is non-empty. One may argue that the setY(ρ)is typically non-empty but the eventY∈Y(ρ)is rather exceptional. This is supported by Corollary 5.1. in Kalkbrener (2005), which states thatY(ρ)consists only on constants for risk measure ρSTD(X) = c · σ(X) − EX, where σ(X) = ‖X − EX‖2 is the standard deviation. However, ρSTD is not a coherent risk measure (axiom R1 fails), and, in applications, is sometimes replaced by ρMAD(X) = c‖X − EX‖1 − EX, which is coherent forc∈[0,12],see Rockafellar, Uryasev, and Zabarankin (2006a).Example 1For a coherent risk measure ρMAD(Y) = c‖Y − EY‖1 − EY,c∈(0,12],we haveY(ρ)={Y:P(Y=EY)>0}.Detail.  For ρMAD, the setSin (3) is given byS={S:ES=1,supS−infS≤2c},and, for nonconstant Y,S(Y)=1+c(EZ−Z),Z∈sign[Y−EY],where sign [X] is a set of r.v.s Z such that Z(ω) = 1, Z(ω) = −1, and Z(ω) ∈ [ − 1, 1] for X(ω) > 0, X(ω) < 0, and X(ω) = 0, correspondingly, see Rockafellar, Uryasev, and Zabarankin (2006b). If Y is a constant,S(Y)=S. Thus, in any case,S(Y)is not a singleton if and only if P(Y = EY) > 0. □In the above example, the event{Y∈Y(ρ)}={P(Y=EY)>0}may still be considered as almost negligible for practice. The next examples demonstrate that this is not the case for some other important risk measures.Example 2For a coherent risk measure given by(4)ρ(Y)=maxi∈{1,2}E[Qi(−Y)],Q1,Q2∈F1(P),Q1≠Q2,we haveY(ρ)={Y:EQ1[−Y]=EQ2[−Y]}.Detail.  Let Y be such thatEQ1[−Y]=EQ2[−Y]. Because Q1 ≠ Q2, we have Q1(A) < Q2(A) for some setA∈F,andEQ1[−X]>EQ2[−X]for the indicator function X = IAof this set. Thenρ(Y+ϵX)=EQ1[−(Y+ϵX)]for ε > 0, andρ(Y+ϵX)=EQ2[−(Y+ϵX)]for ε < 0, whence the right and left directional derivatives in (1) areEQ1[−X]andEQ2[−X],correspondingly. □The risk measure (4) has the following interpretation: a company may consider two possible probabilistic scenarios with Radon–Nikodym derivatives Q1 and Q2, and the risk of every random profit Y is just the worst-case expected loss. Now, assume that the company can choose a policy from a set of admissible policies, leading to a set of possible profitsY⊂L∞(Ω),that is, to the optimization problem(5)infY∈Yρ(Y).We will call problem (5) reducible, if an optimizer in (5) solves also optimization probleminfY∈YEQ1[−Y]orinfY∈YEQ2[−Y](that is, one of the scenarios can be neglected), and irreducible otherwise.Example 3Let ρ be given by (4), and letY⊂L∞(Ω)be a convex set such that problem (5) is irreducible. Then any minimizer Y* in problem (5), if it exists, belongs toY(ρ).Detail.  Because problem (5) is irreducible, setYcontains r.v.s Y1, Y2 such thatEQi[−Yi]<EQi[−Y*],i=1,2. For every λ ∈ (0, 1),λY*+(1−λ)Y1∈Y,whenceEQ1[−Y*]≤ρ(Y*)≤ρ(λY*+(1−λ)Y1)=maxi∈{1,2}λEQi[−Y*]+(1−λ)EQi[−Y1].ButEQ1[−Y*]=λEQ1[−Y*]+(1−λ)EQ1[−Y*]>λEQ1[−Y*]+(1−λ)EQ1[−Y1],whenceEQ1[−Y*]≤λEQ2[−Y*]+(1−λ)EQ2[−Y1],∀λ∈(0,1).Taking λ → 1, we getEQ1[−Y*]≤EQ2[−Y*]. The reverse inequality can be proved similarly. □Example 3 demonstrates that the total profit Y* of a company might belong toY(ρ)as a result of natural risk-minimization policy of the company, confirming the practical significance of Problem II. The example can be extended to risk measures ρ of the form(6)ρ(Y)=maxi∈{1,⋯,k}E[Qi(−Y)],Q1,⋯,Qk∈F1(P).Representation of risk measures based on finite number of scenarios (6) is often used for simulation of coherent risk measures in practice, see Lesnevski, Nelson, and Staum (2007).The following problem is a version of Problem II for coherent risk measures, continuous from below.Problem IIILet ρ be a coherent risk measure, continuous from below, and letY∈L∞(Ω). For everyS∈S(Y),the functional Λρ(X, Y) ≔ −E[SX] is a linear diversifying capital allocation. Which one to choose?SetQin (2) can be interpreted as a set of (Radon–Nikodym derivatives of) possible probabilistic scenarios Q, considered by a company. ThenS(Y)is a set of Radon–Nikodym derivatives of the “worst-case” scenarios (that is, those ones, for which an equality in (2) holds for a given Y). Then, capital allocation problem III is interpreted as a problem of choosing the unique probabilistic scenario from a set of worst-case ones, and then assign the capital allocation according to the chosen scenario.LetTbe the set of all non-empty convex weakly compact subsets ofL1(Ω). On an abstract level, Problem III is just a problem of choosing the unique element from everyT∈T. A mapf:T→L1(Ω)will be called CA-solution (capital-allocation-solution), iff(T)∈T,∀T∈T. We will call f(T) the selector from a convex set T. Given any CA-solution f, the capital allocation can be estimated as(7)Λρ(X,Y):=−E[f(S(Y))X],∀X,Y∈L∞(Ω).First, we suggest a CA-solution for the important special case when the probability space Ω is discrete. Let Ω = {ω1, … , ωn}, with P(ωi) = pi> 0, i = 1, … , n. Then any r.v. X is just a vector(x1,…,xn)∈Rnwith xi= X(ωi), i = 1, … , n. A discrete probability space typically arise when xnare empirical or Monte Carlo realizations of X. In this case, every positively homogeneous and subadditive risk measure ρ (not necessary coherent or continuous from below) can be represented in the form(8)ρ(Y)=maxQ∈QE[Q(−Y)],∀Y∈Rn,for a non-empty convex compact setQ⊂Rn. A CA-solution f is a map which assigns a point f(T) ∈ T to every non-empty convex compact set T inRn.Example 4Let f(T) be the center of mass (centroid) of set T given by(9)f(T)=∫RnxIT(x)dx∫RnIT(x)dx,where IT(x) is the characteristic function of T. With f(T) given by (9), formula (7) defines the capital allocation for every positively homogeneous and subadditive risk measure ρ. We will call it the centroid capital allocation.Because T is the set of Radon–Nikodym derivatives of the “worst-case” scenarios, the centroid (9) can be interpreted as the “average”, or “expected” element of T, assuming that they are “equally probable”.Example 5For a risk measure ρ given by(10)ρ(Y)=maxi∈{1,⋯,k}E[Qi(−Y)],∀Y∈Rn,where Q1, …, Qkare affinely independent vectors inRn,the centroid capital allocation is given by(11)Λρ(X,Y):=E[(1|I(Y)|∑i∈I(Y)Qi)(−X)],∀X,Y∈Rn,where I(Y)⊂{1, …, k} is the set of indexes i such that E[Qi( − Y)] = ρ(Y).Detail.  In this case, theS(Y)in (7) is the convex hull of affinely independent vectors {Qi|i ∈ I(Y)}, and its centroid is given by1|I(Y)|∑i∈I(Y)Qi. □Example 6For a coherent risk measure ρ given by(12)ρ(Y)=−infY=−mini∈{1,…,n}Y(ωi),∀Y∈Rn,the centroid capital allocation is given by(13)Λρ(X,Y):=E[−X|Y=infY],∀X,Y∈Rn.Detail.  In Example 5, let k = n, and Qi(ωj) is 1/pjfor i = j and 0 otherwise, i = 1, … , n; j = 1, … , n. Then ρ(Y) in (10) takes the form (12), and the centroid capital allocation in (11) takes the form (13). □Next sections discuss what are the desirable properties we want CA-solution to possess, show that the centroid capital allocation satisfies these properties, and also suggest a capital allocation scheme for an arbitrary probability space Ω.Cherny and Orlov (2011) suggested that the capital allocation should be law-invariant, that is, Λρ(X, Y) should depend only on the joint law of (X, Y), and have studied such capital allocations for the case when ρ can be represented as(14)ρ(Y)=WVaRμ(Y)=∫01CVaRα(Y)μ(dα),Y∈L∞(Ω),where μ is a probability measure on (0, 1] and(15)CVaRα(Y)=−1α∫0αqY(β)dβ,Y∈L∞(Ω).Theorem 2.3 in Cherny and Orlov (2011) states that, if the probability space is atomless, and ρ is given by (14), then there exists a unique linear diversifying law-invariant capital allocation, which is continuous in X. In this form, Theorem 2.3 is not applicable for probability spaces with atoms.Example 7Let Ω = {ω1, ω2, ω3}, pi= P(ωi), i = 1, 2, 3, p1 < ce: paraid = "para0053" >ρ(.)=CVaRp1(.),Y(ω1) = Y(ω2) < Y(ω3). Then Λρ(X, Y) = a · X(ω1) + b · X(ω2) is a linear diversifying law-invariant and continuous in X capital allocation, for any a ≤ 0, b ≤ 0, such that a + b = −1.Detail.  Λρ(X, Y) is a valid capital allocation at Y for ρ(.), becauseΛρ(Y,Y)=a·Y(ω1)+b·Y(ω2)=−Y(ω1)=CVaRp1(Y). Linearity and continuity is obvious. Also,Λρ(X,Y)≤(a+b)infX=−infX=CVaRp1(X),thus it is diversifying. Now, at a given probability space, if (X1, Y1) and (X2, Y2) have the same joint law, then actually X1 = Y1 and X2 = Y2, whence Λρ(X1, Y1) = Λρ(X2, Y2), and the capital allocation is law-invariant. □However, it follows from the proof of Theorem 2.3 in Cherny and Orlov (2011), that the “law-invariance” condition can be reformulated as follows.Proposition 2Let ρ be a coherent risk measure, continuous from below,Y∈L∞(Ω),S∈S(Y),and Λρ(X, Y) ≔ −E[SX]. The following statements are equivalent.(i)Λρ(X,Y)=Λρ(E[X|Y],Y),∀X∈L∞(Ω)S = f(Y) a.e. for some measurablef:R→R. In other words, S is Y-measurable.Both these conditions imply that(iii)Λρ(X1, Y) = Λρ(X2, Y) whenever pairs (X1, Y) and (X2, Y) have the same joint law.Moreover, if Ω is atomless, conditions (i)–(iii) are equivalent.(ii)  →  (i):  Λρ(X, Y)  =   − E[f(Y)X]  =   − E(E[f(Y)X|Y])  =   − E[f(Y)(E[X|Y])] = Λρ(E[X|Y], Y).(i) → (ii):E[SX]=−Λρ(X,Y)=−Λρ(E[X|Y],Y)=E[S(E[X|Y])]=E[(E[S|Y])X],∀X∈L∞(Ω). This implies S = E[S|Y], whence S is Y-measurable.(i) → (iii): Let X1, X2, Y be any r.v.’s such that (X1, Y) and (X2, Y) have the same joint law. Then E[X1|Y] = E[X2|Y], hence, Λρ(X1, Y) = Λρ(E[X1|Y], Y) = Λρ(E[X2|Y], Y) = Λρ(X2, Y).The proof of the direction (iii) → (ii) for an atomless probability space can be extracted from the proof of Theorem 2.3 in Cherny and Orlov (2011).□Equivalent conditions (i) and (ii) in Proposition 2 can be interpreted as the “correct” analogue of law-invariance axiom for capital allocations for general probability space Ω. Condition (i) also has the following financial interpretation: the states of natures ω1 and ω2 such that Y(ω1) = Y(ω2) are indistinguishable from the company point of view, and only average value of X over all such states is taken into account for capital allocation. Theorem 6.3 in Cherny (2006) implies that the corresponding capital allocation exists and unique for the family (14) on general Ω.Proposition 3Let ρ be given by (14). Then for everyY∈L∞(Ω),there exists a unique Y-measurable elementS*∈S(Y). Moreover,S*=E[S|Y],∀S∈S(Y).See Theorem 6.3 in Cherny (2006).□Proposition 3 can be interpreted as a version of Theorem 2.3 in Cherny and Orlov (2011) for general Ω. In particular, in Example 7, there are many law-invariant capital allocations, but only one of them, namelyΛρ(X,Y)=−p1p1+p2·X(ω1)−p2p1+p2·X(ω2),can be represented as Λρ(X, Y) = −E[SX], whereS∈S(Y)is Y-measurable.Next, we argue that law-invariant capital allocations can be interpreted as ones invariant under automorphisms of the underlying probability space. A bijection g: Ω/A1 → Ω/A2 is called mod 0 automorphism of Ω, if (i)P(A1)=P(A2)=0,(ii)A∈Fif and only ifg(A)∈Fand (iii)P(g(A))=P(A)for allA∈F. LetAbe the set of all mod 0 automorphisms of Ω. Everyg∈Adefines a mapBg:L1(Ω)→L1(Ω)by (Bg(X))(ω) = X(g(ω)), ω ∈ Ω/A1. Obviously, r.v.s X and Bg(X) have the same distribution. The converse, in general, does not hold: for Ω = (0, 1) with Lebesgue measure, X(ω) = ω, and Y(ω) = |2ω − 1|, X and Y have the same distribution, but Y ≠ Bg(X) for anyg∈A. However, Jouini, Schachermayer, and Touzi (2006, Lemma A.4) implies that a risk measureρ:L∞(Ω)→R,defined on an atomless probability space Ω, and continuous from below, is law-invariant33That is, ρ(X) = ρ(Y) whenever X and Y have the same distribution functionif and only ifρ(Bg(X))=ρ(X),∀g∈A.This section aims to prove the following result.Proposition 4Let Ω be atomless, andf:T→L1(Ω)be a CA-solution such that(*)Bg(f(T)) = f(T) wheneverBg(T)=T,g∈A.Then(i)If ρ is a law-invariant coherent risk measure, continuous from below, thenf(S(Y))is Y-measurable for everyY∈L∞(Ω),whenceΛρ(X,Y):=−E[f(S(Y))X]is a law-invariant capital allocation.In particular, if ρ is given by (14), Λρ(X, Y) coincides with the unique linear diversifying law-invariant continuous in X capital allocation, described in Theorem 2.3 in Cherny and Orlov (2011).The proof of Proposition 4 requires some preparation. For a fixedY∈L1(Ω),letAinv(Y)={g∈A|Bg(Y)=Y}.Proposition 5Let Ω be atomless, andρ:L∞(Ω)→Rbe a law-invariant coherent risk measure, continuous from below. ThenBg(S(Y))=S(Bg(Y)),∀g∈A,for everyY∈L∞(Ω). In particular,Bg(S(Y))=S(Y),∀g∈Ainv(Y).Letg∈AandS∈S(Y). Because S and Bg(S) have the same distribution,Bg(S)∈Sby Dana (2005, Corollary 4.3). Becauseρ(Bg(Y))=ρ(Y)=−E[SY]=−∫ΩS(ω)Y(ω)dP(ω)=−∫ΩS(g(ω))Y(g(ω))dP(ω)=−E[Bg(S)Bg(Y)],this impliesBg(S)∈S(Bg(Y)),orBg(S(Y))⊆S(Bg(Y)). Thus,S(Y)=Bg−1(Bg(S(Y)))⊆Bg−1(S(Bg(Y)))⊆S(Bg−1(Bg(Y)))=S(Y),where the first and last equalities follows from the fact that g is a bijection. This shows that actuallyBg(S(Y))=S(Bg(Y)).□Let Ω be atomless, andρ:L∞(Ω)→Rbe a law-invariant coherent risk measure, continuous from below,Y∈L∞(Ω),andX∈S(Y). Then X and Y are comonotone, that is, there exists a set E⊆Ω such thatP[E]=1and (X(ω1) − X(ω2))(Y(ω1) − Y(ω2)) ≥ 0 for all ω1, ω2 ∈ E.Dana (2005, Lemma 4.3) implies that there exists an r.v. Z with the same distribution as X which is comonotone with Y. ThenZ∈S,whereSdefined in (3), by Dana (2005, Corollary 4.3). Thus E[ZY] ≤ ρ(Y) = E[XY], whence X is comonotone with Y by Föllmer and Schied (2004, Theorem A.24).□Let Ω be atomless, andX,Y∈L1(Ω)be comonotone r.v.s. Then X is Y-measurable if and only ifAinv(Y)⊆Ainv(X)If X is Y-measurable, X = f(Y) for somef:R→R,and(Bg(X))(ω)=X(g(ω))=f(Y(g(ω)))=f((Bg(Y))(ω))=f(Y(ω))=X(ω),∀g∈Ainv(Y)for almost all ω ∈ Ω, and “only if” follows. Let us prove the “if” direction. LetE={ω∈Ω|P[Y=Y(ω)]>0}. Because X and Y are comonotone, it is sufficient to show that X is Y-measurable on E. If not, there exists constantsx,y∈Rsuch thatP[I<]>0andP[I>]>0,where I< = {ω ∈ Ω|X(ω) < x, Y(ω) = y} and I> = {ω ∈ Ω|X(ω) > x, Y(ω) = y}. Because the probability space is atomless, we can find two subsets I1 ∈ I< and I2 ∈ I> such thatP[I1]=P[I2]>0. Let us show that there exists ang∈Asuch that g(I1) = I2 a.s. andg(ω)=ω∀ω∉I1∪I2,which would implyg∈Ainv(Y)butg∉Ainv(X),a contradiction. Because Ω is atomless (and standard), we can assume that Ω = (0, 1) with Lebesgue measure. Then I1, I2 are Lebesgue measurable, and, ignoring the sets of measure 0, we may assume that they are Borel sets. Then for almost every ω ∈ I1 we can find g(ω) ∈ I2 defined by relationP((0,ω)∩I1)=P((0,g(ω))∩I2).□If ρ is a law-invariant coherent risk measure, continuous from below, thenBg(S(Y))=S(Y),∀g∈Ainv(Y)by Proposition 5. This implies thatBg(f(S(Y)))=f(S(Y)),∀g∈Ainv(Y),which is equivalent to saying thatf(S(Y))is Y-measurable by Propositions 6 and 7, and (i) follows. Now (ii) follows from Theorem 2.3 in Cherny and Orlov (2011).□Condition (*) in Proposition 4 reformulates the “law-invariance” axiom of Cherny and Orlov (2011) as follows: the selector f(T) from any convex set T should be a fixed point of any map from the familyBg,g∈A,mapping T into T. The interpretation of this condition is straightforward: if the risk measure ρ is law-invariant, then the corresponding setS(Y)is invariant under any automorphism of an underlying probability space, and we require that the resulting capital allocation should also be invariant under such automorphisms. However, some popular law-invariant coherent risk measures, including ρMAD from Example 1, cannot be represented in the form (14), and a law-invariant capital allocation may still be non-unique, see Cherny and Orlov (2011) for more examples. Also, a law-invariance axiom for capital allocation does not make sense if ρ is not law-invariant (which is typically the case in Example 2). In the next sections, we develop an approach to capital allocation, valid for all coherent risk measures, by extending the condition (*) to a larger family of maps, called affine isometries.LetXbe a Banach space with norm ||.||. A mapB:X→Xis called an isometry if∥B(x)−B(y)∥=∥x−y∥,∀x,y∈X. A map B is called linear, ifB(x+y)=B(x)+B(y),∀x,y∈X,andB(α·x)=α·B(x),∀x∈X,α∈R. A map B is affine ifB(x)−B(y)=A(x−y),∀x,y∈Xfor some linear map A. Equivalently, a map B is affine if and only if it preserves the centers of mass:(16)B(∑i=1nαixi)=∑i=1nαiB(xi),∀x1,…,xn∈X,α1,…,αn∈R,∑i=1nαi=1.It is straightforward to verify, that for everyA∈A,the map BAdefined as (BA(X))(ω) = X(A(ω)), ω ∈ Ω is a linear (and hence affine) isometry over Banach spaceL1(Ω). Thus, condition (*) in Proposition 4 is just a special case of the following one.Definition 2AI-preserving CA-solutionAn CA-solutionf:T→L1(Ω)will be called AI-preserving (affine-isomerty-preserving), if B(f(T)) = f(T) for every affine isometry B such that B(T) = T. In other words, f is an AI-preserving CA-solution, if the selector f(T) from any convex set T is a fixed point of any affine isometry, mapping T into T. In this case, we will call f(T) the center of convex set T.For a finite probability space, AI-preserving CA-solution is presented in Example 4.Proposition 8If probability space Ω is a finite set, then the centroid capital allocation, defined in Example 4, is an AI-preserving CA-solution.It follows from (16) that the centroid (9) is a fixed point of any affine isometry, mapping T into T.□From now, we assume that Ω is an infinite set. In this case, the notion of centroid for subsets ofL1(Ω)does not exist in the form (9), because there is no analogue of Lebesgue measure on an infinite-dimensional separable Banach space. More precisely, every translation-invariant measure on such space that is not identically zero assigns infinite measure to all open subsets, see Hunt, Sauer, and Yorke (1992). For this reason, the construction of the “natural” center for every convex weakly compact subset T of a Banach space is a non-trivial and well-known problem. Brodskii and Mil’man (1948) developed a method for assigning center to every set T with “normal structure”, see their paper for definition. The construction which works in general case and returns a unique center was suggested 33 years later in Lim (1981).To be self-contained, we repeat the construction here. It defines Cαfor all ordinals α by transfinite induction. Let C0 = T. Let β be an ordinal and suppose that Cαhas been defined for α < β. If β is a limit ordinal, letCβ=⋂α<βCα. Otherwise, let Cβbe a closed convex hull of the set{z∈Cγ:z=12(x+y),forsomex,y∈Cγwith∥x−y∥=12diamCγ},where γ is the predecessor of β, anddiamCγ=supx,y∈Cγ∥x−y∥. Lim proved that, for sufficiently large ordinals β, Cβare identical, and consist of exactly one point, which he called the center of T. This construction defines the CA-solution, which we denote f*, and the corresponding capital allocation in (7) will be denotedΛρ*(X,Y).Proposition 9Theorem 1 in Lim, 1981Let T be a nonempty weakly compact convex subset of a Banach space. The center f*(T) is a fixed point of every affine isometry mapping T into T.In other words, Proposition 9 states that f* is an AI-preserving CA-solution.We summarize the discussion above as follows.•Λρ*(X,Y)is linear and diversifying.Λρ*(X,Y)coincides with the directional derivative (1), provided that it exists.If ρ is law-invariant,Λρ*(X,Y)is law-invariant. In particular, it coincides with the capital allocation described in Theorem 2.3 of Cherny and Orlov (2011), if Ω is atomless, and ρ belongs to the family (14).However,Λρ*(X,Y)is defined for every coherent risk measure ρ, continuous from below (and for allX,Y∈L∞(Ω)).In particular, we are now able to solve the capital allocation problem for the risk measures in Examples 1 and 2 in the “difficult” caseY∈Y(ρ). We remark that, although the original construction of the center uses ordinals and is not explicit, Proposition 9 can be used to derive the formulas forΛρ*(X,Y)easily, at least in the examples below.Example 8Let ρ be a coherent risk measure given by (4), and Y be such thatEQ1[−Y]=EQ2[−Y]. Then(17)Λρ*(X,Y)=E(Q1+Q2)/2[−X],∀X∈L∞(Ω).Detail.  In this case,S(Y)={Sα|α∈[0,1]},whereSα=αdQ1dP+(1−α)dQ2dP. The map Sα→ S1 − αis an affine isometry, mappingS(Y)toS(Y),thus the center is the fixed point of this isometry, S1/2. □Example 9Let ρ(Y) = c‖Y − EY‖1 − EY,c∈[0,12],see Example 1. For any nonconstantY∈L∞(Ω),(18)Λρ*(X,Y)=E[−X]+cE[X−EX|Y>EY]P[Y>EY]−cE[X−EX|Y<EY]P[Y<EY],∀X∈L∞(Ω).Detail.  Forc∈(0,12]and nonconstant Y,S(Y)=1+c(EZ−Z),Z∈sign[Y−EY],see Example 1. LetBYbe a set of mapsB:L∞(Ω)→L∞(Ω),such that B(X) = 1 + A(X − 1), where (A(X))(ω) = −X(ω) if Y(ω) = EY, and (A(X))(ω) = X(ω) otherwise. ThenB∈BYare affine isometries, which mapsS(Y)into itself. Indeed, A(Z) ∈ sign [Y − EY] if and only if Z ∈ sign [Y − EY], whenceB(S)=1+c(EZ−Z)=1+A(c(EZ−Z))=1+c(EA(Z)−A(Z))∈S(Y)for allS∈S(Y). Thus, the centerS*∈S(Y)is a fixed point of everyB∈BY,which implies S* = 1 + c(EZ − Z) for the unique Z ∈ sign [Y − EY] such that Z(ω) = 0 if Y(ω) = EY, and (18) follows. □If Y = C is a constant, the capital allocation in Example 9 is given by(19)Λρ*(X,C)=E[−X].Relation (19) is a corollary from Proposition 4 (i), and remains valid for every law-invariant coherent risk measure ρ, which is continuous from below and can be defined on an atomless probability space.Next, we remark that our methodology can be easily extended to wider families of risk measures. Corollary 5.1. in Kalkbrener (2005) solves the capital allocation problem for nonconstant Y for risk measure ρSTD(X) = c · σ(X) − EX, which is not coherent (R1 fails). Similarly, R1 fails for ρ(Y) = c‖Y − EY‖1 − EY in Example 9 ifc>12. Rockafellar et al. (2006a) showed that every continuous risk measure satisfying R2–R4 can still be represented in the form(20)ρ(Y)=maxS∈SE[S(−Y)],forallY∈L∞(Ω),whereSis nonempty, closed, convex set such thatES=1,∀S∈S(ρ is coherent if and only ifS≥0,∀S∈S), whence the capital allocation problem reduces to the choice of the center in a setS(Y)of maximizers in (20). In case ρ = ρSTD,S(Y)is a singleton for non-constant Y, andS(Y)=Sfor constants. In the latter case, allocation formula (19) remains valid, complementing Corollary 5.1. in Kalkbrener (2005). Similarly, capital allocation (18) in Example 9 remains valid forc>12.A coherent risk measureρ(Y)=−infY,which, in general, is not continuous from below, can be represented in the form (2), but with sup instead of max, and the supremum is not attained. However, Proposition 4.14 in Föllmer and Schied (2004) states that every coherent risk measure ρ can be represented in the form(21)ρ(Y)=supQ∈QEQ[−Y],for some subsetQof the Banach spaceba(Ω)=ba(Ω,F,P)of finitely additive set functions on(F,P)with bounded variation, absolutely continuous with respect to P, see e.g. Appendix A.6 in Föllmer and Schied (2004) for definitions and the meaning of EQ[ − X]. Actually, for coherent ρ,Q⊂ba1(Ω),where ba1(Ω)⊂ba(Ω) is a set of nonnegative set functions Q normalized as Q(Ω) = 1. Moreover,Qcan be chosen as a convex set for which the supremum in (21) is attained. Thus, one can find the capital allocation as(22)Λρ*(X,Y)=EQ*[−X],forallX∈L∞(Ω),where Q* is the center of the setQ(Y)of maximizers in (21).Actually, representation (21) remains valid for every positively homogeneous and subadditive ρ, which is lower-semicontinuous, that is, set{Y∈L∞(Ω)|ρ(Y)≤C}is closed for allC∈R,see e.g. Rudloff (2006). In addition to coherent risk measures, there are other interesting families of functionals with these properties (see Grechuk and Zabarankin, 2012b).Definition 3Deviation measures and error measuresA positively homogeneous, subadditive, and lower-semicontinuous functionalρ:L∞(Ω)→Ris called•A deviation measure, if ρ(Y) = 0 for constant Y, but ρ(Y) > 0 otherwise;An error measure, if ρ(0) = 0, but ρ(Y) > 0 for Y ≠ 0.Deviation measures introduced in Rockafellar et al. (2006a) to measure the non-constancy, inherent in an r.v. Y. If ρ is a deviation measure,Λρ*(X,Y)should be interpreted as deviation contribution (rather than risk contribution), that is, it measures the contribution of nonconstancy of X to the nonconstancy of Y. The capital allocation problem with deviation measures naturally arises in the context of cooperative portfolio investment, see Grechuk, Molyboha, and Zabarankin (2013). The solution of the formΛρ(X,Y)=EQ[−X],Q∈Q(Y)was proposed in Grechuk and Zabarankin (2012a), but the issue thatQ(Y)might not be a singleton was ignored.Error measures are designed to measure non-zeroness of an r.v., with the prominent example ρ(X) = ||X||2, see Rockafellar, Uryasev, and Zabarankin (2008). If ρ is an error measure, a natural interpretation forΛρ*(X,Y)is error contribution. For example, assume that there are n sources of random noise X1, X2, … , Xn, with total noiseY=∑i=1nXi,and we need to estimate the contribution of each source to the total noise in the system. This may be useful e.g. for deciding which source of noise should be removed/reduced first.

@&#CONCLUSIONS@&#
We have reduced the problem of identifying the unique linear diversifying risk contribution Λρ(X, Y) to the problem of selecting the unique center of a convex weakly compact set in a Banach space. The latter problem has a natural solution (centroid) in finite-dimensional case, which corresponds to the case when probability space Ω is finite. In the general case, we have used the construction of Lim (1981), which has the advantage that the resulting center is a fixed point of every affine isometry mapping the set into itself. This construction produces the unique risk contribution, defined for allX,Y∈L∞(Ω),and for every coherent risk measure ρ, as well as for other classes of functionals, such as deviation measures or error measures. Our solution is consistent with those derived in Kalkbrener (2005) and Cherny and Orlov (2011) in cases the latter exist and unique. It can also be applied to selecting the unique Pareto optimal allocation in a wide class of optimal risk sharing problems.