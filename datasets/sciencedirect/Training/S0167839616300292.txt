@&#MAIN-TITLE@&#
Design with Quasi Extended Chebyshev piecewise spaces

@&#HIGHLIGHTS@&#
Introduce Quasi Extended Chebyshev piecewise spaces.Develop their properties for design, e.g., existence/pseudoaffinity of blossoms.Determine the class of all such spaces.Provide illustrations.

@&#KEYPHRASES@&#
(Quasi) Extended Chebyshev (piecewise) spaces,Connection matrices,(Quasi) Bernstein bases,(Piecewise) generalised derivatives,Blossoms,Geometric design,

@&#ABSTRACT@&#
A Quasi Extended Chebyshev (QEC) space is a space of sufficiently differentiable functions in which any Hermite interpolation problem which is not a Taylor problem is unisolvent. On a given interval the class of all spaces which contains constants and for which the space obtained by differentiation is a QEC-space has been identified as the largest class of spaces (under ordinary differentiability assumptions) which can be used for design. As a first step towards determining the largest class of splines for design, we consider a sequence of QEC-spaces on adjacent intervals, all of the same dimension, we join them via connection matrices, so as to maintain both the dimension and the unisolvence. The resulting space is called a Quasi Extended Chebyshev Piecewise (QECP) space. We show that all QECP-spaces are inverse images of two-dimensional Chebyshev spaces under piecewise generalised derivatives associated with systems of piecewise weight functions. We show illustrations proving that QECP-spaces can produce interesting shape effects.

@&#INTRODUCTION@&#
Throughout this article we consider a fixed interval[a,b],a<b, and a fixed positive integer n. An(n+1)-dimensional spaceE⊂Cn([a,b])is an Extended Chebyshev-space (for short EC-space) on[a,b]if any non-zero element ofEvanishes at most n times on[a,b], counting multiplicities as far as possible forCnfunctions, that is, up to(n+1). Equivalently,Eis an EC-space on[a,b]if any Hermite interpolation problem in(n+1)data on[a,b]has a unique solution inE. There exists a classical procedure to build(n+1)-dimensional EC-spaces from systems of weight functions on[a,b], that is, from sequences(w0,…,wn)such that eachwiisCn−iand positive on[a,b]. With such a system one can associate generalised derivativesL0,…,Lndefined in a recursive way as follows:(1)L0F:=Fw0,LiF:=1wiDLi−1F,1⩽i⩽n,when D stands for the ordinary differentiation. Then, the setEC(w0,…,wn)composed of all functionsF∈Cn([a,b])for whichLnFis constant is an EC-space on[a,b]. This is due to Rolle's theorem (Karlin and Studden, 1966; Schumaker, 1981). Because we are working on a closed bounded interval we can even state that (Pottmann, 1993; Mazure, 2007, 2011b)Theorem 1.1The class of all(n+1)-dimensional EC-spaces on[a,b]coincides with the class of all spaces of the formEC(w0,…,wn), where(w0,…,wn)is any system of weight functions on[a,b].It is well known that EC-spaces can advantageously serve as substitutes for polynomials in many issues requiring shape/tension parameters (Schweikert, 1966). To gain the maximal potential from the great variety of parameters provided by this class of spaces, it is interesting to mix different(n+1)-dimensional EC-spaces on adjacent intervals so as to obtain an(n+1)-dimensional space possessing similar properties. With this in view, take:–a fixed sequenceT=(t1,…,tq)of knots interior to[a,b], witht0:=a<t1<…<tq<tq+1:=b;an associated sequenceM1,…,Mqof connection matrices of order(n+1), each of them being lower triangular with positive diagonal entries;a sequenceEk,0⩽k⩽q, of section-spaces: for each k,Ek⊂Cn([tk,tk+1])is an(n+1)-dimensional EC-space on[tk,tk+1].fork=0,…,q, there exists a functionFk∈Eksuch that F coincides withFkon[tk+,tk+1−];fork=1,…,q, the following connection condition is fulfilled:(2)(F(tk+),F′(tk+),…,F(n)(tk+))T=Mk(F(tk−),F′(tk−),…,F(n)(tk−))T.An extensive study of ECP-spaces was developed in a number of earlier papers Mazure (1999, 2005b, 2006, 2007, 2011a), Mazure and Laurent (1999). In particular, the class of all ECP-spaces was clearly identified in Mazure (2007), see also Mazure (2011a). With a view to describe it, consider a system(w0,…,wn)of piecewise weight functions on([a,b];T), with the meaning that eachwiisCn−iand positive separately on each[tk+,tk+1−]. With such a system we can associate linear piecewise generalised derivativesL0,…,Lnvia the procedure already recalled in (1). ByECP(w0,…,wn)we denote the set of all piecewise functions which are piecewiseCnon([a,b];T)and such thatLnFis constant on[tk+,tk+1−]fork=0,…q, with the additional requirement thatLiF(tk+)=LiF(tk−)fori=0,…,n,and fork=1,…,q.A piecewise version of Rolle's theorem Mazure (2006) proves that the spaceECP(w0,…,wn)is an(n+1)-dimensional ECP-space on([a,b];T). It was proved that (Mazure, 2007)Theorem 1.2The class of all(n+1)-dimensional ECP-spaces on([a,b];T)coincides with the class of all spaces of the formECP(w0,…,wn), where(w0,…,wn)is any system of piecewise weight functions on([a,b];T).For any real numbersp,q>n−1, the spaceEp,qspanned on[a,b]=[0,1]by the(n+1)functions1,x,…,xn−2,xp,(1−x)q, is not an EC-space on[0,1]— except forp=q=nwhere it is the degree n polynomial space on[0,1]. Nevertheless, this(n+1)-dimensional space behaves similarly to EC-spaces, and the parameters p, q act as useful tension parameters for spline interpolation as well as for design (Costantini, 1986, 2000; Kaklis and Pandelis, 1990; Kaklis and Sapidis, 1995; Goodman and Mazure, 2001; Costantini et al., 2005; Mazure, 2011d; Bosner and Rogina, 2013). These spaces belong to a larger class of spaces, named Quasi-Extended Chebyshev-spaces (for short QEC-spaces), see Mazure (2008b). An(n+1)-dimensional spaceE⊂Cn−1([a,b])is a QEC-space on[a,b]if any non-zero element ofEvanishes at most n times on[a,b], counting multiplicities as far as possible forCn−1functions, that is, up to n, or, equivalently, if any Hermite interpolation problem in(n+1)data[a,b]which is not a Taylor interpolation problem has a unique solution inE. An(n+1)-dimensional spaceE⊂C0([a,b])is a Chebyshev space (C-space) on[a,b]if any non-zeroF∈Evanishes at most once in[a,b], not counting multiplicities. In dimension two, being a QEC-space on[a,b]is therefore the same as being a QEC-space on[a,b]. Select any two-dimensional C-spaceCon[a,b], containing constants, and any system(w0,…,wn−1)of weight functions on[a,b], with associated generalised derivativesL0,…,Ln−1. Denote byQEC(w0,…,wn−1;C)the set composed of all functionsF∈Cn−1([a,b])for whichLn−1F∈C. The class of all QEC-spaces on[a,b]was clearly identified in Mazure (2011c) where Theorem 1.1 was extended to QEC-spaces as follows:Theorem 1.3The class of all(n+1)-dimensional QEC-spaces on[a,b]coincides with the class of all spaces of the formQEC(w0,…,wn−1;C), where(w0,…,wn−1)is any system of weight functions on[a,b]and whereCis any two-dimensional C-space on[a,b]containing constants.If only for the sake of theoretical completeness, the brief record above makes it natural to address the following question: is it possible to establish a result similar to Theorems 1.2 and 1.3 for(n+1)-dimensional Quasi Extended Piecewise spaces (for short, QECP-spaces) obtained by connecting in an appropriate way(n+1)-dimensional QEC-spaces on adjacent intervals. This article gives a positive answer to this question. We will indeed prove thatTheorem 1.4The class of all(n+1)-dimensional QECP-spaces on([a,b];T)coincides with the class of all spaces of the formQECP(w0,…,wn−1;C), where(w0,…,wn−1)is any system of piecewise weight functions on([a,b];T)and whereCis any two-dimensional C-space on[a,b]containing constants.The motivation for this work is also on the practical side. Indeed, in several previous situations (see, for instance, Laurent et al., 1997; Mazure, 2011d) we have observed that allowing zero multiplicities in spline spaces can produce powerful shape effects. This will be permitted by Theorem 1.4 for splines based on QECP-spaces, which is a priori not obvious at first with QEC-section-spaces.In Section 3 the reader will learn how to build and how to handle(n+1)-dimensional Piecewise QEC-spaces (PQEC-spaces) obtained by connecting different(n+1)-dimensional QEC-section-spaces. Among all such PQEC-spaces, in Section 4 we distinguish those which meet the same requirement on the number of zeroes as QEC-spaces and we call them QECP-spaces. We show that QECP-spaces really behave as QEC-spaces, and that one can build such spaces with the help of systems of piecewise weight functions. Section 5 is devoted to QECP-spaces good for design, in which ready-to-blossom bases exist and make the existence of blossoms easily perceived. As usual, the crucial and tricky point is to prove that blossoms are pseudoaffine. As was already the case for Theorems 1.1, 1.2, and 1.3, pseudoaffinity is a key-point for Theorem 1.4. The proof of this theorem is given in Section 6, and some consequences are developed. The results are illustrated in Section 7 with QECP-spaces built from sections of the formEp,q(up to translations).The present work was made possible by many earlier results by the same author, in particular on QEC-spaces and on ECP-spaces. Out of necessity, this article cannot be self-contained. However in order to facilitate the reading a brief commented background is given is Section 2 below.From the next section we will be in a piecewise context. In order to facilitate the reading we have gathered here some of the most important definitions we will deal with, introducing them in the non-piecewise context, and possibly commenting on the extensions to the piecewise framework.A system(w0,…,wn)of weight functions on[a,b](see Section 1) generates a nested sequence of EC-spaces on[a,b]EC(w0)⊂EC(w0,w1)⊂⋯⊂EC(w0,w1,…,wn).Take any non-zeroU0∈EC(w0), and, fori=1,…,n, anyUi∈EC(w0,…,wi)∖EC(w0,…,wi−1). Then, the functionsU0,U1,…,Unform a Complete W-sequence (for short, CW-sequence) on[a,b]in the sense that their successive Wronskians never vanish on[a,b], i.e.,(3)W(U0,…,Ui)(x):=det⁡(Uk(j)(x))0⩽k,j⩽i≠0for allx∈[a,b],i=0,…,n.Conversely, let(n+1)functionsU0,U1,…,Un∈Cn([a,b])form a CW-sequence on[a,b], in the sense of (3). Then, for anyF∈Cn(I)we can set(4)LiF=W(U0,…,Ui−1,F)W(U0,…,Ui−1,Ui),0⩽i⩽n.Clearly, eachLiis a linear differential operator of order i. By differentiation, we obtain (Mazure, 2006)(5)DLiF=W(U0,…,Ui−1)W(U0,…,Ui−1,Ui,F)W(U0,…,Ui)2.Accordingly, the operatorsL0,L1,…,Lnsatisfy (1) provided that we define the functionsw0,…,wnby(6)wi:=W(U0,…,Ui−2)W(U0,…,Ui)W(U0,…,Ui−1)2,0⩽i⩽n,with the convention thatW(∅)=1. The sequence(w0,…,wn)will be a system of weight functions on[a,b]if all Wonskians (3) are positive. If it is not the case, we simply have to replaceUiby−Uiwhenever needed. What the reader should retain is that generalised derivatives can be associated with systems of weight functions or with CW-sequences as well.In the presence of a sequenceTof interior knots, we will make use of piecewise functions on([a,b];T). Stricto sensu, a piecewise function F on([a,b];T)should be defined as a sequenceF=(F0,…,Fq), where fork=0,…,q,Fkis a function on[tk,tk+1]. It will be convenient to proceed similarly to the non-piecewise case, saying that F is defined separately on each[tk+,tk+1−], the equalityF=Gbetween two piecewise functions F, G on([a,b];T)meaning thatF(x)=G(x)for allx∈[a,b]∖{t1,…,tn}, and that bothF(tk−)=G(tk−)andF(tk+)=G(tk+), fork=1,…,q. This will be summarised by saying thatF(xε)=G(xε)for allx∈[a,b], ε having the meaning of both −, +. One can similarly consider positive piecewise functions on([a,b];T), and so forth. In particular we will denote byPCj([a,b];T)the set of all piecewise functions on([a,b];T)which areCjon each[tk+,tk+1−].As mentioned in Section 1, we can introduce systems of piecewise weight functions on([a,b];T). One can also define piecewise CW-sequences (for short PCW-sequences) on([a,b];T), with the meaning of a sequence(U0,…,Un)inPCn([a,b];T)which satisfy all relations (3) in which we replace x byxε. When the piecewise functionsU0,…,Un∈PCn([a,b];T)satisfy a common connection relation of the form (2), if they form a PCW-system on([a,b];T), then for eachi=0,…,n, the piecewise functionW(U0,…,Ui)keeps the same strict sign on all[tk+,tk+1−]. After possible multiplications by(−1)they will similarly give birth to a system of piecewise weight functions on([a,b];T)via (6), and therefore to piecewise generalised derivatives. In the piecewise context, the reader should keep in mind that (4) and all similar equalities are then piecewise equalities.Definition 2.1Given(n+1)functionsB0,…,Bn∈Cn−1([a,b])we say that(B0,…,Bn)is a quasi-Bernstein-like basis relative to(a,b)if these functions satisfy the following properties:(1)B0(a)≠0andB0vanishes n times at b;for eachi=1,…,n−1,Bivanishes exactly i times at a and exactly(n−i)times at b;Bnvanishes n times at a andBn(b)≠0.for eachi=0,…,n,Biis positive on]a,b[.Clearly, a quasi-Bernstein-like basis relative to(a,b)is a basis of the space it spans. Given an(n+1)-dimensional spaceE⊂Cn−1([a,b]), the presence of quasi-Bernstein-like bases relative to all couples(c,d)∈[a,b]2,c<d, is one of the many possible ways to characterise that this spaceEis a QEC-space on[a,b]. For other characterisations, readers are mainly referred to Mazure (2008b). If we know that is a QEC-space on[a,b], if needed quasi-Bernstein-like bases can be assumed to be positive (on the concerned interval).Subsequently, we consider a given(n+1)-dimensional spaceE⊂Cn−1([a,b])containing constants. By1we mean the constant function1(x):=1for allx∈[a,b]. We will keep the same notation for its restriction to any sub-interval.Definition 2.2A basis(B0,…,Bn)inEis said to be normalised if∑i=0nBi=1. A quasi-Bernstein basis relative to(a,b)is a positive quasi-Bernstein-like basis relative to(a,b)which is normalised.The presence inEof quasi-Bernstein bases relative to all couples(c,d)∈[a,b]2,c<d, is necessary and sufficient for the n-dimensional spaceDE(obtained fromEvia differentiation) to be a QEC-space on[a,b], and it implies thatEitself is a QEC-space on[a,b].A mother-function inEis a functionΦ:=(Φ1,…,Φn)∈Ensuch that(1,Φ1,…,Φn)is a basis ofE. In that case, for anyd⩾1, anyF∈Edcan be uniquely obtained as the imageF=h∘Φof Φ under an affine maph:Rn→Rd. Given any non-negative integeri⩽n−1, and anyx∈[a,b], the ith order osculating flat of Φ at x is the affine flat throughΦ(x)with direction spanned by the i derivativesΦ(j)(x),j=1,…,i. We denote it byOsciΦ(x). Note thatOsc0Φ(x)={Φ(x)}.Definition 2.3An(n+1)-dimensional spaceE⊂Cn−1([a,b]), withn⩾2, is said to be a QEC-space good for design on[a,b]whenEcontains constants and when the n-dimensional spaceDEis a QEC-space on[a,b].AssumeEto be a QEC-space good for design on[a,b]. Given anya1<…<arin[a,b]and any positive integersμ1,…,μrsuch that∑i=1rμi=n, one can prove that the r osculating flatsOscn−μiΦ(ai),i=1,…,r, have in common a single point. The blossom φ of Φ is the functionφ=(φ1,…,φn):[a,b]n→Rndefined by setting(7){φ(x1,…,xn)}:=⋂i=1rOscn−μiΦ(ai)whenever(x1,…,xn)=(a1[μ1],…,ar[μr])up to permutation, wherex[k]stands for x repeated k times. The function φ is thus symmetric and it gives Φ by restriction to the diagonal of[a,b]n. For any affine maph:Rn→Rd, the blossom f ofF:=h∘Φis then defined asf:=h∘φ. It is important to mention that it does not depend on the selected mother-function. In particular, the Bézier points of F relative to(a,b)are the pointsf(a[n−i],b[i]),i=0,…,n.It is due to the presence of blossoms and to their properties (see Mazure, 2008b) that the class of all QEC-spaces good for design has been identified as the largest class of spaces (with ordinary differentiation assumptions) which can be used for design. Existence and properties of blossoms will be extended to the piecewise QEC context in Section 5.In this section we connect different(n+1)-dimensional QEC-spaces on adjacent intervals so as to form an(n+1)-dimensional space on the global interval. The connection relations cannot be of the form (2) since, at a given point, either the nth derivatives do not exist or, if they exist, they may be linearly dependent of the derivatives of lesser orders.For a while we assume thatE⊂Cn−1([a,b])is an(n+1)-dimensional QEC-space on[a,b]and thata<c<b. Consider the linear functionalsℓ0,…,ℓn,ℓ‾n:E→Rdefined byℓi(F):=F(i)(c)fori=0,…,n−1,ℓn(F):=F(a),ℓ‾n(F):=F(b).Due toEbeing a QEC-space on[a,b], the(n+1)linear functionalsℓ0,…,ℓnare linearly independent. It results that the linear functionalℓ‾ncan be expanded in a unique way as a linear combination ofℓ0,…,ℓn. In other words, there exists a unique(A0,…,An)∈Rnsuch that(8)F(b)=∑i=0n−1AiF(i)(c)+AnF(a)for allF∈E.Given a basis(U0,…,Un)inE, let us setU:=(U0,…,Un)T. Due toEbeing a QEC-space on[a,b], we know that the determinantdet⁡(U(a1),U′(a1),…,U(μ1−1)(a1),……,U(ar),…,U(μr−1)(ar))keeps the same strict sign independently of the integerr⩾2, of the positive integersμ1,…,μr, such that∑i=1rμi=n+1, and ofa⩽a1<a2<⋯<ar⩽b(see Lemma 2.14 in Mazure, 2008b). For any givenx⁎∈[a,b], the non-zero functionΨnx⁎defined by(9)Ψnx⁎(y):=det⁡(U(x⁎),U′(x⁎),…,U(n−1)(x⁎),U(y)),y∈[a,b],belongs toE, it vanishes n times atx⁎, and it vanishes nowhere else. As a straightforward consequence of the result recalled above we can say that, ifx⁎∈]a,b[, the (strict) sign of the functionΨnx⁎changes n times atx⁎, i.e.,(10)(−1)nΨnx⁎(y1)Ψnx⁎(y2)>0for ally1,y2such thata⩽y1<x⁎<y2⩽b.Accordingly, applying (8) withF:=Ψncproves that(−1)nAn>0.After this preliminary observation, from now on, we work with a fixed integern⩾1and the following data:(1)a sequence of interior knotsT=(t1,…,tq)witht0:=a<t1<⋯<tq<tq+1:=b;a corresponding sequence(M1,…,Mq)of connection matrices: for eachk=1,…,q,Mk=(mi,jk)0⩽i,j⩽nis a lower triangular matrix of order(n+1), of which the diagonal entriesmj,jk,j=0,…,n, satisfy(11)mj,jk>0forj=0,…,n−1,(−1)nmn,nk>0;a sequence(E0,E1,…,Eq)of section-spaces: fork=0,…,q,Ek⊂Cn−1([tk,tk+1])is an(n+1)-dimensional QEC-space on[tk,tk+1].fork=0,…,q, the restriction of F to[tk+,tk+1−]belongs toEk;for eachk=1,…,q, F satisfies the connection condition(12)(F(tk+),F′(tk+),…,F(n−1)(tk+),F(tk+1−))T=Mk(F(tk−),F′(tk−),…,F(n−1)(tk−),F(tk−1+))T.Definition 3.1The(n+1)-dimensional spaceEdefined by the two conditions (i) and (ii) above is said to be a piecewise Quasi Extended Chebyshev space (for short, PQEC-space) on([a,b];T).The requirement that(−1)nmn,nk>0fork=1,…,qis a demanding one, aimed at eliminating uninteresting cases. It is justified by our preliminary observation which enables to state:Proposition 3.2Any QEC-space on[a,b]is a PQEC-space on([a,b];T).Remark 3.3One can also check that any PEC-space on([a,b];T)is a PQEC-space on([a,b];T). Finally, our preliminary observation makes it clear that, by restriction to any non-trivial subinterval, a PQEC-space on([a,b];T)remains a PQEC-space.In this section we gather the main technical points about PQEC-spaces which will be involved in the next sections. They concern in particular the connection matrices, and how they are transformed via standard operations.The special case whereEcontains constants is crucial for design.Lemma 3.4The PQEC-spaceEcontains constants if and only if the following two properties are satisfied(1)fork=0,…,q, the section-spaceEkcontains constants;fork=1,…,q, the first column ofMkis equal to(1,0,…,0,1−mn,nk)T.ProofThe new connection condition (13) is obtained by applying (12) to constants. Details are left to the reader. □Below we state an important consequence of the previous lemma.Proposition 3.5A two-dimensional PQEC-space on([a,b];T)which contains constants is a C-space on[a,b].ProofLetEbe a two-dimensional PQEC-space on([a,b];T)containing constants. We thus know thatE⊂C0([a,b])and from (13) we can state the existence of positivem1,…,mqsuch that any elementF∈Esatisfies(14)F(tk+1)−F(tk)=mk(F(tk)−F(tk−1)),k=1,…,q.For eachk=0,…,q, the section-spaceEkis a two-dimensional C-space on[tk,tk+1]which contains constants. Accordingly, for eachk=0,…,q, the restrictionFk∈Ekof F to[tk,tk+1]is either constant or strictly monotone on[tk,tk+1]. Therefore, due to (14), the function F is constant (resp. strictly increasing, strictly decreasing) on[a,b]if and only if it is constant (resp. strictly increasing, strictly decreasing) on one of the intervals[tk,tk+1], which proves the claimed result. □Lemma 3.6Assume thatn≥2, that the(n+1)-dimensional PQEC-spaceEcontains constants and that, fork=0,…,q, the section-spaceEkis good for design on[tk,tk+1]. Then the n-dimensional spaceDEis a PQEC-space on([a,b];T).ProofTwo things are to be checked: firstly, that the section-spaces inDEare QEC-spaces; secondly that they are connected by convenient matrices. The first point is guaranteed by the assumption that, fork=0,…,q, the section-spaceEkis good for design on[tk,tk+1]. TakeF∈E. The latter assumption also guarantees the existence of blossoms in eachEk(see the reminder in Section 2.2). Fork=0,…,q, we can therefore consider the Bézier points relative to(tk,tk+1)of the restrictionFk∈Ekof F to[tk,tk+1]. Denote them byP0k,…,Pnk.We know that the function F satisfies the connection conditions (13), in which we can replaceF(tk+1)−F(tk)byPnk−P0kandF(tk)−F(tk−1)byPnk−1−P0k−1. The last line in the connection condition (13) can be written as[Pnk−Pn−1k]+[Pn−1k−P0k]=∑i=1n−1mn,ikF(i)(tk−)−mn,nk([Pnk−1−P1k−1]+[P1k−1−P0k−1]),with(−1)nmn,nk>0. Denoting byfk:[tk,tk+1]n→Rthe blossom of the functionFk∈Ek, we know thatPn−1k=fk(tk,tk+1[n−1]),P1k−1=fk−1(tk−1[n−1],tk).The value at(tk−1[n−1],tk)of the blossom of a mother function inEk−1is the unique point belonging both to its osculating flat of order(n−1)attkand to its osculating flat of order 1 attk−1. The value at(tk,tk+1[n−1])of the blossom of a mother function inEkis the unique point belonging both to its osculating flat of order(n−1)attkand to its osculating flat of order 1 attk+1. This ensures the existence of real numbersλk+1−,λk−1+,μk,1−,…,μk,n−1−,μk,1+,…,μk,n−1+, independent of F, such that(15)[Pnk−Pn−1k]=λk+1−F′(tk+1−),[P1k−1−P0k−1]=λk−1+F′(tk−1+);[Pn−1k−P0k]=∑i=1n−1μk,i+F(i)(tk+),[Pnk−1−P1k−1]=∑i=1n−1μk,i−F(n−1)(tk−).One can prove that the two real numbersλk+1−andλk−1+are positive (see for instance Lemma 3.21 in Mazure, 2008b). Combining the previous relations with the first n lines of (13) leads to(16)F′(tk+1−)=∑i=1(n−1)m‾n−1,ikF(i)(tk−)+m‾n−1,n−1kF′(tk−1+),withm‾n−1,n−1k=−mn,nkλk−1+λk+1−>0,where all coefficientsmn,ikare independent of F. The connection matrix attkin the spaceDEis obtained by deleting the first row and the first column inNkand then replacing the last line by (16). Since(−1)n−1m‾n−1,n−1k>0, it satisfies the appropriate requirements for the spaceDEto be a PQEC-space on([a,b];T). □Lemma 3.7Given an(n+1)-dimensional PQEC-spaceEon([a,b];T), letEˆdenote the space of all continuous functionsFˆon[a,b]which are piecewise differentiable on([a,b];T)and such thatDFˆ∈E. This is an(n+2)-dimensional PQEC-space on([a,b];T)containing constants.ProofFor eachk=1,…,q, the connection condition (12) inEcan now rewritten as a connection on the (left/right) derivatives inEˆ:(17)(Fˆ′(tk+),…,Fˆ(n)(tk+),Fˆ′(tk+1−))T=Mk(Fˆ′(tk−),…,Fˆ(n)(tk−),Fˆ′(tk−1+))T.Clearly, the section-spaces inEˆare QEC-spaces good for design on their intervals, andEˆcontains constants. Accordingly, we can proceed exactly the reverse way as we did in the previous subsection, going this time from derivatives to Bézier points in each section, e.g., via relations of the formFˆ′(tk+1−)=1λˆk+1−[Pˆnk−Pˆn−1k],Fˆ′(tk−1+)=1λˆk−1+[Pˆ1k−1−Pˆ0k−1],with positive real numbersλˆk+1−,λˆk−1+. Given thatPˆnk=Fˆ(tk+1),Pˆ0k−1=Fˆ(tk−1)andPˆ0k=Pˆnk−1=F(tk), these reverse arguments will finally provide us with a connection condition of the formFˆ(tk+1)=∑i=0nmˆn+1,iFˆ(i)(tk−)+mˆn+1,n+1kFˆ(tk−1),with(−1)n+1mˆn+1,n+1k>0. We can then transform (17) into a convenient connection condition attkwith a lower triangular matrixMˆkof order(n+2)obtained fromMkby adding(1,0,…,0)and(1,0,…,mˆn+1,0)Tas its first row and column, respectively. □Lemma 3.8Assume thatEis an(n+1)-dimensional PQEC-space on([a,b];T). For each piecewise functionω∈PCn−1([a,b];T)which has the same strict sign on all[tk+,tk+1−], the spaceωEobtained by piecewise multiplication of all elements ofEby ω is an(n+1)-dimensional PQEC-space on([a,b];T).ProofThe section spaces inωEare QEC-spaces on their intervals. Therefore, for eachk=1,…,q, there is indeed a lower triangular connection matrixM˜kof order(n+1)inωEsuch that, for eachF∈E(18)((ωF)(tk+),(ωF)′(tk+),…,(ωF)(n−1)(tk+),(ωF)(tk+1−))T=M˜k((ωF)(tk−),(ωF)′(tk−),…,(ωF)(n−1)(tk−),(ωF)(tk−1+))T.LetMk♯andM˜k♯be the lower triangular matrices obtained by deleting the last row and column inMkandM˜k, respectively. Applying the Leibniz formula yields(19)M˜k♯:=Cn−1(ω,tk+)Mk♯Cn−1(ω,tk−)−1,k=1,…,q,where, forx∈[a,b]andε∈{−,+},Cn−1(ω,xε)=(Cn−1(ω,xε)p,q)0⩽p,q⩽n−1stands for the lower triangular square matrix of order n defined by (see Lemma 40 in Mazure, 2006)Cn−1(ω,xε)p,q:=(pq)ω(p−q)(xε),for0⩽q⩽p⩽n−1.Taking additionally account of the last line in (18), one can see that the diagonal entries of the matrixM˜kare given bym˜j,jk=ω(tk+)ω(tk−)mj,jkforj=0,…,n−1,m˜n,nk=ω(tk+1−)ω(tk−1+)mn,nk.Since ω keeps the same strict sign on all[tk+,tk+1−], the signs on the diagonal ofM˜kare the same as on the diagonal ofMk. The proof is thus complete. □Combining the last two operations, we can describe the behaviour of PEQC-spaces under suitable generalised differentiation.Lemma 3.9Assume thatn≥2and thatEis an(n+1)-dimensional PQEC-space on([a,b];T). Givenw∈E, we assume that, fork=0,…,q, its restrictionwkto[tk+,tk+1−]has positive coordinates in any positive quasi-Bernstein-like basis ofEkrelative to(tk,tk+1). Then, the piecewise function w is positive on each[tk+,tk+1−], and ifL0denotes the piecewise division by w, the setDL0Eis an n-dimensional PQEC-space on([a,b];T).ProofTake anyk=0,…,q. Thatwkhas positive coordinates in any positive quasi-Bernstein-like basis ofEkrelative to(tk,tk+1)is necessary and sufficient to ensure both thatwkis positive on[tk+,tk+1−], and that the spaceL0kEkobtained by dividing all elements ofEkbywkis a QEC-space good for design on[tk,tk+1](see Mazure, 2011c).From Lemma 3.8 we know thatL0Eis a PEQC-space on([a,b];T). Moreover,L0Eclearly contains constants because it is obtained by piecewise division by w which belongs toE. Since eachL0kEkis a QEC-space good for design on[tk,tk+1], it follows from Lemma 3.6 that the n-dimensional spaceDL0Eis PQEC-space on([a,b];T). □In this section, we work with a given(n+1)-dimensional PQEC-spaceEon([a,b];T), withn⩾1, defined by the sequenceT=(t1,…,tq)of interior knots in[a,b], connection matricesM1,…,Mqsatisfying (11), and QEC section-spacesE0,…,Eq. The results developed here will generalise those proved in earlier articles both on QEC-spaces and on ECP-spaces, in particular Mazure (2005b, 2006, 2008b).Select any non-zero piecewise functionF∈E. Fork=1,…,q, and for0⩽p⩽n, F vanishes p times attk−(i.e.,F(tk−)=F′(tk−)=⋯=F(p−1)(tk−)=0) if and only if it vanishes p times attk+(i.e.,F(tk+)=F′(tk+)=⋯=F(p−1)(tk+)=0). This is due to the connection matrixMkbeing lower triangular and regular. In that case we will simply say that F vanishes p times attk. Ifp⩽n−1, F vanishes exactly p times attk−(i.e., it vanishes p times, but not(p+1)times attk−) if and only if it vanishes exactly p times attk+. These remarks make it possible to count the total number of zeroes of F on[a,b], including multiplicities up to n, which we denote asZn[a,b](F). Givenk=0,…,q, since the section-spaceEkis a QEC-space on[tk,tk+1], we know thatZn[tk,tk+1](F)⩽n.Definition 4.1An(n+1)-dimensional PQEC-spaceEon([a,b];T)is said to be a Quasi Extended Chebyshev Piecewise space (for short, QECP-space) on([a,b];T)when, for any non-zero element ofF∈E, the total numberZn[a,b](F)of zeroes of F on[a,b], multiplicities included up to n, is bounded above by n.Remark 4.2Given a basis(U0,…,Un)in the PQEC-spaceEon([a,b];T), setU:=(U0,…,Un)T. Then, obviously,Eis a QECP-space on([a,b];T)when any of the following equivalent properties below are satisfied(1)any Hermite interpolation problem(20)findF∈Esuch thatF(j)(τiεi)=αi,j,1⩽i⩽r,0⩽j⩽μi−1,— in which r is any integer greater than or equal to 2,μ1,…,μrare positive integers such that∑i=1rμi=n+1,τ1,…,τr∈[a,b]are pairwise distinct,αi,j,1⩽i⩽r,0⩽j⩽μi−1are given real numbers, and whereε1,…,εr∈{−,+}— has a unique solution.with any data as in (1), the(n+1)vectorsU(τiεi),U′(τiεi),…,U(μi−1)(τiεi),i=1,…,r, are linearly independent.Remark 4.3In the(n+1)-dimensional PQEC-spaceE, for anyx⁎∈[a,b]and any j,0⩽j⩽n−1, it is possible to select a piecewise function which vanishes exactly j times atx⁎. We systematically denote such a function asΨjx⁎. Similarly, the notationΨnx⁎will stand for a non-zero element ofEwhich vanishes n times atx⁎. Such an element is unique up to multiplication by a non-zero constant.In spite of the piecewise nature of the elements of the PQEC-spaceE, the fact that we can count the zeroes makes it possible to keep the same definition for quasi-Bernstein-like bases inEas in QEC-spaces (see Definition 2.1).Theorem 4.4Givenn⩾1and given an(n+1)-dimensional PQEC-spaceEon([a,b];T), the following six properties are equivalent:(i)Eis a QECP-space on([a,b];T);any Hermite interpolation problem(20)based on exactly two points of[a,b]has a unique solution inE;given anyx1,x2∈[a,b],x1≠x2, any non-zero element F ofEvanishes at most n times on{x1,x2}, counting multiplicities up to order n, i.e.,Zn{x1,x2}(F)⩽n;for any positive integersi1,i2such thati1+i2=n+1, anyx1,x2∈[a,b],x1≠x2, and anyε1,ε2∈{+,−}, the(n+1)vectorsU(x1ε1),…,U(i1−1)(x1ε1),U(x2ε2),…,U(i2−1)(x2ε2)are linearly independent;for any(c,d)∈[a,b]2,c<d,Epossesses a quasi-Bernstein-like basis relative to(c,d);for anyc∈[a,b], and any integer p,1⩽p⩽n,(21)W(Ψnc,…,Ψpc)(xε)≠0for anyx∈[a,b]∖{c}.ProofThis is a strong result which says that, in the PQEC-spaceE, the unisolvence of any Hermite interpolation problem (20) is obtained as soon as it is obtained for any Hermite interpolation problem based on exactly two points in[a,b]; equivalently the bound on the number of zeroes is obtained by bounding zeroes at any pair of points. There is hardly any difference in the proofs of the equivalences stated above between the present piecewise situation and the non-piecewise one addressed in Mazure (2008b) to which we refer the reader to. □In Goodman and Mazure (2001) we showed how to build QEC-spaces from systems of weight functions. The theorem below is the piecewise version of this construction.Theorem 4.5Let(w0,…,wn−1)be a system of piecewise weight functions on([a,b];T), with associated piecewise generalised derivatives denoted byL0,…,Ln−1, and letCbe a two-dimensional C-space on[a,b]containing constants. LetQECP(w0,…,wn−1;C)⊂PCn−1([a,b];T)be composed of all piecewise functionsF∈PCn−1([a,b];T)meeting the following two requirements:(i)Ln−1F∈C;fori=0,…,n−2,LiFis continuous on[a,b].ProofFori=0,…,n, we can also consider the following sets:E<i>:=QECP(wn−1−i,…,wn−1;C),i=n,…,0,Eˆ<i>=QECP(1,wn−i,…,wn−1;C)so thatEˆ<0>=C,E<n−1>=QECP(w0,…,wn−1;C).As indicated in Fig. 1, the recursive definition of the generalised derivatives implies that(1)for each i,0<i⩽n−1, we go fromEˆ<i>toE<i>by piecewise multiplication bywn−1−i;for each i,0<i⩽n−2, we go fromE<i>toEˆ<i+1>by continuous integration.The following two results will be crucial in subsequent sections. In particular Theorem 4.6 below is a piecewise version of Theorem 3.10 in Mazure (2008b).Theorem 4.6An(n+1)-dimensional PQEC-spaceEon([a,b];T)being given, we assume the existence of a system(w0,…,wn−1)of piecewise weight functions on([a,b];T)such that(22)ECP(w0,…,wn−1)⊂E,and we denote byL0,…,Ln−1the associated piecewise generalised derivatives. Then,C:=Ln−1Eis a two-dimensional C-space on[a,b]andE=QECP(w0,…,wn−1;C).ProofClearly, the only thing that we have to prove is thatC:=Ln−1Eis a C-space on[a,b]. On account of Proposition 3.5, it is sufficient to prove by induction oni=0,…,n−1, thatLiEis an(n−i+1)-dimensional PQEC-space on([a,b];T)which contains constants.Select any elementUninE∖ECP(w0,…,wn−1). Fork=0,…,q, denote byw0k,…,wn−1k,Unkthe restrictions ofw0,…,wn−1,Unto[tk+,tk+1−]and byL0k,…,Ln−1kthe generalised derivatives associated with(w0k,…,wn−1k). From (22) we can derive thatEC(w0k,…,wn−1k)⊂Ek,k=0,…,q.SinceEkis a QEC-space on[tk,tk+1], Theorem 3.10 in Mazure (2008b) implies thatEk=QEC(w0k,…,wn−1k;Ck), whereCkis the two-dimensional C-space on[tk+,tk+1−]spanned by(1,Ln−1kUnk). Moreover, we also haveLikEk=QEC(1,wi+1k,…,wn−1k;Ck)fori=0⩽n−1,k=0,…,q.From Theorem 3.2 of Mazure (2011c) we know thatwi+1khas positive coordinates in any positive quasi-Bernstein-like basis ofDLikEk. The expected result follows by iterated application of Lemma 3.9. □Proposition 4.7Select anya‾<a, and denote byT‾the sequence(a,T). Then, any(n+1)-dimensional QECP-spaceEon([a,b];T)which is of the formE:=QECP(w0,…,wn−1;C)can be extended into an(n+1)-dimensional QEC-space on([a‾,b];T‾).ProofSelect any two-dimensional C-spaceC˜⊂C0([a‾,a])containing constants. The setC‾composed of all continuous functions on[a‾,b]which belong toC˜andCby restriction to[a‾,a]and to[a,b], respectively, and which additionally satisfyF(a)−F(a‾)=c[F(b)−F(a)]for some given positivec,is a two-dimensional C-space on[a‾,b]. Considering any system(w‾0,…,w‾n−1)of piecewise weight functions on[a‾,b]which coincides with(w0,…,wn−1)on([a,b];T), the(n+1)-dimensional QECP-spaceQECP(w‾0,…,w‾n−1;C‾)on([a‾,b];(a,T))givesEby restriction to([a,b];T). □In Theorem 4.4 we have given different ways to characterise QECP-spaces on([a,b];T)among all PQEC-spaces on([a,b];T). Below, we give an additional one, which will be crucial for blossoms in next section.Theorem 4.8LetEbe an(n+1)-dimensional PQEC-space on([a,b];T). Then, it is a QECP-space on([a,b];T)if and only if it meets the following requirement:(vii)given any integerr⩾1, any pairwise distincta1,…,ar∈[a,b], and any positive integersμ1,…,μr,(a)when∑i=1rμi=n+1, any sequence of the form(Ψna1,…,Ψn−μ1+1a1,……,Ψnar,…,Ψn−μr+1ar)is a basis ofE;when∑i=1rμi⩽n, then for eachx∈[a,b]∖{a1,…,ar},(23)W(Ψna1,…,Ψn−μ1+1a1,……,Ψnar,…,Ψn−μr+1ar)(xε)≠0.ProofThe statement in (b) of (vii) withr=1corresponds to property (vi) of Theorem 4.4. Accordingly, we only have to assume thatEis QECP-space on([a,b];T), and to prove that (vii) is satisfied. Moreover, given that (vii) is satisfied forr=1, we can additionally assume that the result holds with some integerr−1⩾1in any QECP-space. Then, we just have to prove thatEsatisfies (vii) with the integer r.Without loss of generality we can assume thata1<a2<⋯<ar. LetF⊂Ebe spanned by the n piecewise functionsΨna1,…,Ψ1a1. Let the interval[a⁎,b⁎]be chosen so thata1<a⁎<a2,b⁎=b, letE⁎,F⁎denote the restrictions ofE,Fto[a⁎,b⁎], respectively, and letT⁎be the sequence of knots which are interior to[a⁎,b⁎]. From (vi) of Theorem 4.4 we know that the sequence(Ψna1,…,Ψ1a1)is a PCW-sequence on([a⁎,b⁎];T⁎)(see Section 2.1). Let(w0⁎,…,wn−1⁎)be the associated system of piecewise weight functions on([a⁎,b⁎];T⁎), given by (6) (up to signs), and letL0⁎,…,Ln−1⁎denote the corresponding piecewise generalised derivatives. We thus haveF⁎=ECP(w0⁎,…,wn−1⁎)⊂E⁎.Given thatE⁎is an(n+1)-dimensional QECP-space on([a⁎,b⁎];T⁎), by Theorem 4.6 this implies that(24)E⁎=QECP(w0⁎,…,wn−1⁎;C⁎)for some convenient C-spaceC⁎on[a⁎,b⁎].From (24) we can derive thatE⁎˜:=DLμ1−1⁎E⁎=QECP(wμ1⁎,…,wn−1⁎;C⁎).Settingn˜:=n−μ1, the spaceE⁎˜is thus an(n˜+1)-dimensional QECP-space on([a⁎,b⁎];T⁎)and the positive integersμ2,…,μrsatisfy∑i=2rμi⩽n˜+1. Therefore, the inductive assumption applies toE˜⁎. For anyx∈[a⁎,b⁎], the notationΨ⁎˜kxwill stand for any element inE⁎˜which vanishes exactly k times at x ifk<n˜, and for any non-zero element inE⁎˜vanishingn˜times at x ifk=n˜. This enables us to state the following two properties:(1)if∑i=1rμi=n+1, any sequence of the form(Ψ⁎˜n˜a2,…,Ψ⁎˜n˜−μ2+1a2,……,Ψ⁎˜n˜ar,…,Ψ⁎˜n˜−μr+1ar)is a basis ofE˜⁎;if∑i=1rμi⩽n, then, for allx∈[a⁎,b⁎]∖{a2,…,ar},(25)W(Ψ⁎˜n˜a2,…,Ψ⁎˜n˜−μ2+1a2,……,Ψ⁎˜n˜ar,…,Ψ⁎˜n˜−μr+1ar)(xε)≠0.if∑i=1rμi=n+1, restricted to[a⁎,b⁎]the(n+1)piecewise functionsΨnai,…,Ψn−μi+1ai,i=1,…,r, form a basis ofE⁎, and therefore these(n+1)piecewise functions form a basis ofE;if∑i=1rμi⩽n, then (23) holds on[a⁎,b⁎]∖{a2,…,ar}. This being true for anya1<a⁎<a2, it is true also on]a1,b]∖{a2,…,ar}.Being interested in design, in this section we assume that, for eachk=0,…,q,Ekis good for design on[tk,tk+1], and that the PQEC-spaceEcontains constants. In particularE⊂C0([a,b]).The results presented here extend those previously obtained for EC-spaces (e.g., Mazure, 2005a, 2006), QEC-spaces (Mazure, 2008b), ECP-spaces (e.g., Mazure, 2005b, 2006).Given any basis of the form(1,Φ1,…,Φn)inE, we consider the associated mother-functionΦ:=(Φ1,…,Φn). Due to the structure of the connection matricesM1,…,Mq, for anyk=1,…,q, and anyi=1,…,n−1, the linear space spanned by the right derivativesΦ′(tk+),…,Φ(i)(tk+)coincides with the linear space spanned by the left onesΦ′(tk−),…,Φ(i)(tk−). The left and right osculating flats of order i, that is,OsciΦ(tk+)andOsciΦ(tk−)thus coincide too. We will thus denote both of them byOsciΦ(tk). We can therefore define possible blossoms exactly as explained in Section 2.2 for QEC-spaces.Definition 5.1LetEbe an(n+1)-dimensional PQEC-space on([a,b];T)containing constants. Given any pairwise distincta1,…,ar∈[a,b]and any positive integersμ1,…,μrwith∑i=1rμi=n, if a sequence(1,Ψna1,…,Ψn−μ1+1a1,……,Ψnar,…,Ψn−μr+1ar)forms a basis ofEwe say that this basis is a ready-to-blossom basis relative to any n-tuple(x1,…,xn)which is equal to(a1[μ1],…,ar[μr])up to permutation.Theorem 5.2LetE⊂PCn−1([a,b];T)be an(n+1)-dimensional PQEC-space containing constants, withn⩾2, and letU⊂PCn−2([a,b];T)be the n-dimensional PQEC-space on([a,b];T)obtained by differentiation ofE(seeLemma 3.6). The following four properties are equivalent:(i)Uis a QECP-space on([a,b];T);given anyc,d∈[a,b], withc<d, the spaceEpossesses a normalised quasi-Bernstein-like basis relative to(c,d);given any(x1,…,xn)∈[a,b]n, the spaceEpossesses a ready-to-blossom basis relative to(x1,…,xn);blossoms exist in the spaceE.ProofThe fact thatEis a QECP-space on([a,b];T)as soon as (i) holds results from the piecewise version of Rolle's theorem already mentioned.•(i)⇔(iii)is obtained by applying Theorem 4.8 in the PQEC-spaceU.•(i)⇒(ii). Assume that (i) holds, and consider anyc,d∈[a,b], withc<d. We know that the QECP-spaceUpossesses a quasi-Bernstein-like basis(V0,…,Vn−1)relative to(c,d). Each piecewise functionVidoes not vanish on[a,b]∖{c,d}and therefore it piecewisely keeps the same strict sign on the whole of]c,d[, thus ensuring that∫cdVi(t)dt≠0. Setting(27)B0(x)=1−∫cxV0(t)dt∫cdV0(t)dt,Bi(x)=∫cxVi−1(t)dt∫cdVi−1(t)dt−∫cxVi(t)dt∫cbVi(t)dt,1⩽i⩽n−1,Bn(x)=∫cxVn−1(t)dt∫cdVn−1(t)dt,x∈[a,b],yields a normalised quasi-Bernstein-like basis relative to(c,d)inE.•(ii)⇒(i). If(B0,…,Bn)is a normalised quasi-Bernstein-like basis relative to some(c,d)∈[a,b]2,c<d, then as is classical the piecewise functionsV0,…,Vn−1∈Udefined by(28)Vi:=∑j=i+1nDBj=−∑j=0iDBj,i=0,…,n−1,form a quasi-Bernstein-like basis relative to(c,d)inU(see (4.1) and (4.2) in Mazure, 2005a). Therefore(v)⇒(i)of Theorem 4.4 guarantees thatUis a QECP-space on([a,b];T).•(iii)⇒(iv). LetΦ=(Φ1,…,Φn)be any mother-function inE. Given an n-tuple(x1,…,xn)=(a1[μ1],…,ar[μr])∈[a,b]n, with pairwise distincta1,…,arand positiveμ1,…,μrwe have to prove that the r osculating flatsOscn−μiΦ(ai),i=1,…,r, have in common a unique point. Since this can be done with any mother-function, let us select Φ so that(1,Φ1,…,Φn)is a ready-to-blossom basis relative to(x1,…,xn). With this choice it can be easily checked that(29)⋂i=1rOscn−μiΦ(ai)={(0,…,0)}.•(iv)⇒(i). Assume the existence of blossoms inE. In particular, given anyx1,x2∈[a,b],x1<x2, and any integer i,1⩽i⩽n−1, the Bézier pointΠi:=φ(x1[n−i],x2[i])of a mother-function Φ is the unique point obtained by intersecting the i-dimensional affine flatOsciΦ(x1)with the(n−i)-dimensional affine flatOscn−iΦ(x2). It implies that forε1,ε2∈{−,+}, the n vectorsΦ′(x1ε1),…,Φ(i)(x1ε1),Φ′(x2ε2),…,Φ(n−i)(x2ε2), are linearly independent. Accordingly, the spaceUsatisfies (iv) of Theorem 4.4: it is thus a QECP-space on([a,b];T). □The last statement in Theorem 5.2 makes the following definition consistent.Definition 5.3Given an(n+1)-dimensional PQEC-spaceEon([a,b];T), withn⩾2, we say that it is a QECP-space good for design on([a,b];T)when it meets the following two requirements:(1)Econtains constants;the n-dimensional piecewise spaceU:=DEis a QECP-space on([a,b];T).Theorem 5.4LetEbe an(n+1)-dimensional QECP-space good for design on([a,b];T), withn⩾2. Then, for anyF∈E, and any(x1,…,xn)∈[a,b]n, we have that:1–the valuef(x1,…,xn)of the blossom f of F at(x1,…,xn)is the first coordinate of F in any ready-to-blossom basis relative to(x1,…,xn);if(x1,…,xn)=(a1[μ1],…,ar[μr])∈[a,b]n, with pairwise distincta1,…,ar∈[a,b]and positiveμ1,…,μr,(30)f(x1,…,xn)=W(Ψna2,…,Ψn−μ2+1a2,……,Ψnar,…,Ψn−μr+1ar,F)(a1ε)W(Ψna2,…,Ψn−μ2+1a2,……,Ψnar,…,Ψn−μr+1ar,1)(a1ε),all other expressions obtained by permutation ofa1,…,arbeing also valid.ProofAs in the proof of Theorem 5.2 assume that the mother functionΦ=(Φ1,…,Φn)is selected so that(1,Φ1,…,Φn)is a ready-to-blossom basis relative to(x1,…,xn). The first point is obtained from (29) via affine maps. The second one readily follows (see Corollary 3.19 in Mazure, 2008b). □Remark 5.5In order to be able to consider the spaceU:=DEwe had to assume the integer n to be greater than or equal to 2, that is, the spaceEto be of dimension at least three. Nevertheless, apart from (i) of Theorem 5.2, all other properties/formulæ involved in this section are meaningful even whenn=1. What therefore should be the definition of a two-dimensional QECP-space good for design on([a,b];T)? The answer is clear: it is a PQEC-space on([a,b];T)containing constants, that is, a C-space on[a,b]containing constants.In this section we assume thatn⩾2and thatE⊂PCn−1([a,b];T)is an(n+1)-dimensional QECP-space good for design on([a,b];T). As usual, the blossom f of anyF∈Ed,d⩾1, satisfies two elementary properties which readily follow from the geometrical definition of the blossom φ of any mother-function Φ:•symmetry:f is symmetric on[a,b]n;diagonal property: by restriction to the diagonal of[a,b]n, f gives F, that is,f(x[n])=F(x)for allx∈[a,b].Theorem 5.6LetEbe an(n+1)-dimensional QECP-space good for design on([a,b];T). Then, the blossomf:[a,b]n→Rdof anyF∈Ed, ispseudoaffine in each variable, in the following sense: for anyx0,x1,…,xn∈[a,b], withx0<xn, there exists a strictly increasing continuous functionβ(x1,…,xn−1;x0,xn;.):[a,b]→R, independent of F, such that(31)f(x1,…,xn−1,x)=[1−β(x1,…,xn−1;x0,xn;x)]f(x1,…,xn−1,x0)+β(x1,…,xn−1;x0,xn;x)f(x1,…,xn−1,xn),x∈[a,b].ProofIt is sufficient to prove (31) replacing f by the blossom φ of any possible mother-function Φ inE. In that case, proving (31) consists in proving that the pointφ(x1,…,xn−1,x)moves in a continuous strictly monotonic way along an affine lineL⊂Rnas x moves from a to b. Moreover, due to the symmetry of blossoms we can assume that(x1,…,xn−1)=(a1[μ1],…,ar[μr]),witha⩽a1<a2<⋯<ar⩽b,and with positive integersμ1,…,μr, with∑i=1rμi=n−1. The definition of blossoms makes it clear thatfor anyx∈[a,b],the pointφ(x1,…,xn−1,x)lies inL:=⋂i=1rOscn−μiΦ(ai)⊂Rn.At each step of the proof,[a⁎,b⁎]will denote a generic non-trivial interval strictly contained in[a,b], andT⁎will always denote the associated sequence composed of all the knots inTwhich are interior to[a⁎,b⁎]. In accordance to the result we want to prove we will select a specific n-dimensional spaceF⊂Eand we will consider the corresponding inclusion(32)F⁎⊂E⁎,whereE⁎,F⁎are the restrictions ofE,Fto[a⁎,b⁎].The choice of F and[a⁎,b⁎]will be guided by the fact that we want to ensure the following property(33)F⁎is an(n-dimensional) ECP-space good for design on([a⁎,b⁎];T⁎).When needed, the choice ofFcan be connected with the choice of an appropriate mother-functionΦ=(Φ1,…,Φn): the first(n−1)components of Φ can be chosen so as to form a mother-function inF, and the last one,Φn, has then to be selected inE∖F. Moreover, in the situation described by (32) and (33) we will select a convenient basis(U0,…,Un−1)ofFwhose restriction(U0⁎,…,Un−1⁎)to[a⁎,b⁎]will form a PCW-sequence on([a⁎,b⁎];T⁎). Applying Theorem 4.6 to the inclusion (32) will then imply that(34)F⁎=ECP(w0⁎,w1⁎,…,wn−1⁎),E⁎=QECP(w0⁎,w1⁎,…,wn−1⁎;C⁎),where(w0⁎,…,wn−1⁎)is the system of piecewise weight functions on([a⁎,b⁎];T⁎)deduced from(U0⁎,…,Un−1⁎)(up to signs) as reminded in Section 2.1, and whereC⁎:=Ln−1⁎E⁎is a two-dimensional C-space on[a⁎,b⁎],L0⁎,…,Ln−1⁎standing for the piecewise generalised derivatives onPCn−1([a⁎,b⁎];T⁎)associated with(w0⁎,…,wn−1⁎). Depending on our purpose we will not necessarily havew0⁎=1, that isU0=1. The interest of such a situation (34) lies in that it will enable us to use the results developed in Section 4.2.• First step:We will first prove thatLis an affine line along which the pointφ(x1,…,xn−1,x)moves in a continuous strictly monotonic way as x moves froma⁎tob⁎, where[a⁎,b⁎]is any non-trivial interval selected so that(35)[a⁎,b⁎]⊂[a,b]∖{a1,…,ar}.InE, take a mother-functionΦ=(Φ1,…,Φn)of the form(36)Φ=(Ψna1,…,Ψn−μ1+1a1,……,Ψnar,…,Ψn−μr+1ar,Φn).It readily follows thatLis the affine line composed of all the points inRnof which the(n−1)first components are equal to zero. We more precisely have(37)φ(x1,…,xn−1,x)=(0,…,0,φn(x1,…,xn−1,x))for eachx∈[a,b],whereφnis the blossom ofΦn. We therefore have to prove that the functionφn(x1,…,xn−1,.)is continuous and strictly monotone on[a⁎,b⁎].LetF⊂Ebe spanned by the n functions1,Φ1,…,Φn−1. Applying (23) in the spaceU=DE, we can see that(1,Φ1,…,Φn−1)is a PCW-sequence on([a⁎,b⁎];T⁎). Therefore in particular (33) is satisfied. Applying (23) in the spaceEitself enables us to state that the sequence(U0,…,Un−1):=(Φ1,…,Φn−1,1)is a PCW-sequence on([a⁎,b⁎];T⁎). We work within the corresponding situation (34). In particular, according to Theorem 4.6, we can therefore assert that the correspondence(38)x∈[a⁎,b⁎]↦Ln−1⁎Φn(x)=W(Φ1,…,Φn−2,Φn)(xε)W(Φ1,…,Φn−2,1)(xε)is a continuous strictly monotone function on[a⁎,b⁎]. As a matter of fact, due to (35), we know that the right-hand side of (38) is equal toφn(a1[μ1],…,ar[μr],x)for anyx∈[a⁎,b⁎](see formula (30)). The claimed result is thus proved.• Second step:It remains to prove the continuity of the functionφ(x1,…,xn−1,.)at each pointaialong with the compatibility of the strict monotonicities on the left and right ofai, fori=1,…,r. Here we prove it withr=1, and therefore withμ1=n−1.We first assume thata⩽a1<b. Selecting any c, witha1<c<b, our non-trivial interval[a⁎,b⁎]is the interval[a,c]. Here the spaceFis spanned by1,Ψnb,Ψn−1b,…,Ψ2b. Since the expected result can be proved using any mother-function Φ, here we will work with the mother-functionΦ‾defined byΦ‾=(Θ,Φ‾n),withΘ:=(Ψnb,Ψn−1b,…,Ψ2b)and, for instanceΦ‾n:=Ψ1b.The functionΘ:[a,b]→Rn−1is a mother-function in the n-dimensional spaceF. For the sake of simplicity, the restriction of Θ to[a⁎,b⁎]will still be denoted by Θ. Given that (33) holds for the restrictionF⁎ofFto[a⁎,b⁎], blossoms exist inF⁎, and we denote byϑ:[a⁎,b⁎]n−1→Rn−1the blossom of Θ as a mother-function ofF⁎, known to be continuous on[a⁎,b⁎]n−1and pseudoaffine in each variable, see Mazure (2006). Accordingly, denoting byL⁎the segment inRn−1with end-pointsϑ(a1[n−2],a)andϑ(a1[n−2],c), we know thatL⁎={ϑ(a1[n−2],x)|x∈[a⁎,b⁎]}.Moreover we also know that(39)ϑ(a1[n−2],x)moves in a continuous strictly monotonic way alongL⁎asxgoes fromatoc.Here the situation (34) corresponds to(U0,…,Un−1)=(1,Ψnb,Ψn−1b,…,Ψ2b), and thereforew0⁎=1. From Proposition 4.7 we know that we can add an interval[a‾,a], witha‾<a, on the left of a while preserving the equalities (34) on([a‾,b⁎];(a,T⁎)), and therefore the existence of blossoms in the extensions ofF⁎,E⁎, thus defined on[a‾,b⁎]n−1and[a‾,b⁎]n, respectively. If the claimed result is proved on the extended interval[a‾,b⁎], we will obtain it in particular on[a⁎,b⁎]. Without loss of generality from now on we can therefore assume thata<a1.Viewed as an element ofE⁎n−1, the function Θ possesses a blossom in n variables, sayϑˆ:[a⁎,b⁎]n→Rn−1the(n−1)components of which are simply the restrictions to[a⁎,b⁎]n−1of the first(n−1)components of the blossomφ‾of the mother-functionΦ‾. Consider any x, y such thata<y<a1<x<c. Corresponding to the inclusion (32) a dimension elevation formula permits the calculation of the(n+1)Bézier points of Θ inE⁎from its n (affinely independent) Bézier points inF⁎, both relative to(y,a1)and to(a1,x). It can be proved that this works exactly as in QEC-spaces good for design, and we therefore refer the reader to Mazure (2008a) for more details. In addition to the equalityϑ(a1[n−1])=Θ(a1)=ϑˆ(a1[n]), we know that(40)ϑˆ(a1[n−1],x)is a strictly convex combination ofΘ(a1)andϑ(a1[n−2],x);ϑˆ(y,a1[n−1])is a strictly convex combination ofΘ(a1)andϑ(y,a1[n−2]).We are thus in the situation depicted in Fig. 2where we represent the segmentL⁎⊂Rn−1. According to the first step, we know that the pointsϑˆ(a1[n−1],x)andϑˆ(a1[n−1],y)move in a continuous strictly monotonic way onL⁎as x ranges over]a1,c]and y ranges over[a,a1[, respectively. As clear from Fig. 2, (40) and (39) ensure the continuity and strict monotonicity ofϑˆ(a1[n−1],.)on the whole of[a,c]=[a⁎,b⁎], whatever the pointc∈]a1,b[, and therefore on the whole of[a,b[. Continuity and strict monotonicity on]a,b]can be proved symmetrically by exchanging the roles of a and b. The proof is thus complete in that case.• Third step:The objective is the same as in the second step, but now with anyr⩾1. The proof will be done by induction on r.Assume thatr⩾2and the result holds for(r−1)in any QECP-space good for design. We work with the n-dimensional spaceFspanned by1,Ψnar,…,Ψ2arand its restrictionF⁎to[a⁎,b⁎]=[a,c], where nowar−1<c<ar. For anyF∈E, let us consider the following function(41)F˜(x):=φ(x[n−μr],ar[μr]),x∈[a,b].LetE˜be the set of all such functions, andE˜⁎its restriction to[a⁎,b⁎]. From (30) we know that(42)F˜(x):=W(Ψnar,…,Ψn−μr+1ar,F)(xε)W(Ψnar,…,Ψn−μr+1ar,1)(xε),x∈[a,b]∖{ar}.Here, we take(U0,…,Un−1)=(Ψnar,…,Ψn−μr+1ar,1,Ψn−μrar,…,Ψ2ar). By application of (23) both inEand inU=DE, we know that this is indeed a PCW-sequence on([a⁎,b⁎];T⁎). We can therefore consider the corresponding situation (34). From (42) we can see thatE˜⁎=Lμr−1⁎E⁎=QECP(1,wμ1⁎,…,wn−1⁎;C⁎).Given anyy1,…,yn−μr∈[a,b]∖{ar}, let(1,Θ1,…,Θn)be a ready-to-blossom basis relative to(y1,…,yn−μr,ar[μr]), with its last components equal toΨnar,…,Ψn−μr+1ar. Let us setA:=f(y1,…,yn−μr,ar[μr]).From Theorem 5.4 we know thatF=A1+∑i=1nλiΘi,for someλ1,…,λn∈R.Using (42) it readily follows that:—restricted to[a⁎,b⁎],(1,Θ˜1,…,Θ˜n−μr)is a ready-to-blossom basis relative to(y1,…,yn−μr)in the spaceE˜⁎;A is the first coordinate of the restriction ofF˜in that basis.Exchanging the roles ofaranda1, one can similarly prove thatφn(a1[μ1],…,ar[μr],.)is continuous and strictly monotone on]a1,b]. It is therefore continuous and strictly monotone on the whole of[a,b]. □The pseudoaffinity of blossoms was not easy to achieve. It is a key-property, which is the reason why blossoms are so powerful tools. Indeed, together with symmetry and diagonal property, it is the property which makes it possible to describe in an elegant and efficient way the classical design algorithms (evaluation, subdivision) in the QECP-spaceEgood for design on([a,b];T). Pseudoaffinity is the reason why we obtain corner cutting algorithms on the concerned intervals, and this is crucial for shape preservation.As an instance, given a functionF∈Ed,d⩾1, and its Bézier points relative to(c,d)∈[a,b]2,c<d,f(c[n−i],d[i]),0⩽i⩽n, an n-step corner-cutting de Casteljau algorithm permits the evaluation of all values of the blossom f of F on[a,b]n. Due to (31), at the nth step, we obtainf(x1,…,xn)as an affine combination of the Bézier points (a convex one whenx1,…,x∈[c,d], a strictly convex one whenx1,…,x∈]c,d[), with coefficients independent of F. In other words, denoting bybi(x1,…,xn),0⩽i⩽n, the coefficients in question, we directly obtain(44)f(x1,…,xn)=∑i=0nbi(x1,…,xn)f(c[n−i],d[i]),∑i=0nbi(x1,…,xn)=1,x1,…,xn∈[a,b],withbi(x1,…,xn)>0forc<x1,…,xn<d,0⩽i⩽n.As a special case, forx1=⋯=xn=xwe obtain(45)F(x)=∑i=0nBi(x),∑i=0nBi(x)=1,x∈[a,b],withBi(x):=bi(x[n])>0forc<x<d,0⩽i⩽n.The functionsB0,…,Bnform a quasi-Bernstein basis relative to(c,d), their zeroes at c, d following from the geometrical definition of the Bézier points. Note that, fori=0,…,n, the functionbiinvolved in (44) is the blossom ofBi. That(B0,…,Bn)is produced by the corner-cutting de Casteljau algorithm enables us to state the following result, the proof of which can be obtained as in Mazure (2004). For the importance of normalised totally positivity we refer the reader to Goodman (1989).Theorem 5.7LetEbe an(n+1)-dimensional QECP-space good for design on([a,b];T). For any(c,d)∈[a,b],c<d, the normalised quasi-Bernstein-like basis ofErelative to(c,d)is a quasi-Bernstein basis relative to(c,d). It is the optimal normalised totally positive basis in the restriction ofEto[c,d].The object of the present section is to show how to obtain all possible QECP-spaces on([a,b];T)by proving Theorem 1.4. On account of Theorem 4.5 what remains to prove is that any(n+1)-dimensional QECP-space on([a,b];T)is of the formQECP(w0,…,wn−1;C).The results presented here extend similar results obtained for EC-spaces in Mazure (2011b), for ECP-spaces in Mazure (2011a), and for QEC-spaces in Mazure (2011c).We will first work in QECP-spaces good for design where we now know that blossoms are pseudoaffine. As a matter of fact, the following lemma readily follows from the pseudoaffinity of blossoms exactly as in Mazure (2011b).Lemma 6.1LetEbe an(n+1)-dimensional QECP-space good for design on([a,b];T). Given a functionU∈E, the following three properties are equivalent:(i)the Bézier points of U relative to(a,b)form a strictly increasing sequence;for anyc,d∈[a,b],c<d, the Bézier points of U relative to(c,d)form a strictly increasing sequence;the blossom u of U is strictly increasing in each variable on[a,b]n.This lemma will be essential to establish Theorem 6.2 below.Theorem 6.2LetEbe an(n+1)-dimensional QECP-space good for design on([a,b];T), withn⩾2, and let(B0,…,Bn)denote its quasi-Bernstein basis relative to(a,b), and letU=DE. Given anyU=∑i=0nuiBi, letw1∈PCn−2([a,b];T)denote the piecewise function DU. The following properties are equivalent:(i)the Bézier pointsu0,…,unof U form a strictly increasing sequence;w1has positive coordinates in any positive quasi-Bernstein-like basis ofUrelative to(a,b);w1is positive on([a,b];T), and ifL1is the piecewise generalised derivative onPCn−1([a,b];T))defined byL1F=DF/w1,L1Eis an n-dimensional QECP-space good for design on([a,b];T).ProofAs a positive quasi-Bernstein-like basis in the spaceDEwe can take the basis(V0,…,Vn−1)defined in (28). In this basis, the piecewise functionw1can be expanded as(46)w1=∑i=0n−1αiVi,αi:=ui+1−uifori=0,…,n−1.The equivalence between (i) and (ii) readily follows from (46).Assume that (iii) holds. Let us denote by(B0{1},…,Bn−1{1})the quasi-Bernstein basis relative to(a,b)in the n-dimensional spaceL1Egood for design on([a,b];T). Clearly, after piecewise multiplication byw1, the normalisation property1=∑i=0n−1Bi{1}implies thatw1=∑i=0n−1w1Bi{1}.Now,(w1B0{1},…,w1Bn−1{1})is a positive quasi-Bernstein-like basis in the QECP-spaceU=DE. Therefore (ii) is obviously satisfied.Let us now assume that (i) holds and prove that (iii) is satisfied. From (46) we can see that the piecewise functionw1∈U=DEis positive on([a,b];T). The n-dimensional spaceL1Eobtained by piecewise division of all elements ofUbyw1contains constants. Moreover it is a PEQC-space on([a,b];T)according to Lemma 3.8. Piecewise division of the two sides of (46) byw1yields1=∑i=0n−1Bi{1},withBi{1}:=αiViw1fori=1,…,n−1.Clearly,(B0{1},…,Bn−1{1})is a quasi-Bernstein basis relative to(a,b)inL1E. Lemma 6.1 ensures that, for anya⁎,b⁎∈[a,b],a⁎<b⁎, U has strictly increasing Bézier points relative to(a⁎,b⁎). We can thus similarly expandw1in the quasi-Bernstein-like basis(V0⁎,…,Vn−1⁎)ofUrelative to(a⁎,b⁎)asw1=∑i=0n−1αi⁎Vi⁎,withαi⁎>0fori=0,…,n−1.As previously, after division byw1we obtain a quasi-Bernstein basis relative to(a⁎,b⁎)inL1E. The PQEC-spaceL1Eon([a,b];T)thus possesses a quasi-Bernstein basis relative to any(a⁎,b⁎)∈[a,b]2witha⁎<b⁎. According to Theorem 5.2 this ensures thatDL1Eis a QECP-space on([a,b];T), i.e. (see Definition 5.3)L1Eis a QECP-space good for design on([a,b];T). □Theorem 6.3Given an(n+1)-dimensional PQEC-space on([a,b];T), containing constants, the following properties are equivalent:(i)Eis a QECP-space good for design on([a,b];T);there exists a system(w1,…,wn−1)of piecewise weight functions on([a,b];T)and a two-dimensional C-spaceCon[a,b], containing constants, such that(47)E=QECP(1,w1,…,wn−1;C).ProofThis is obtained by iteration of Theorem 6.2, taking additionally into account of Proposition 3.5. □Corollary 6.4Given an(n+1)-dimensional PQEC-space on([a,b];T), containing constants, the following properties are equivalent(i)Eis a QECP-space on([a,b];T);there exists a system(w0,…,wn−1)of piecewise weight functions on([a,b];T)and a two-dimensional C-spaceCis on[a,b]such that(48)E=QECP(w0,…,wn−1;C).ProofLetEˆbe the(n+2)-dimensional PQEC-space on([a,b];T)obtained fromEby continuous integration. The claimed result is obtained by applying Theorem 6.3 toEˆ. □Remark 6.5Theorem 6.3 and therefore its corollary (which is exactly Theorem 1.4) have been obtained by iterated application of Theorem 6.2. It is worthwhile mentioning two most interesting consequences of Theorem 6.2.1- Assuming that (i) of Theorem 6.2 is satisfied, we know that the piecewise functionw1is positive on([a,b];T). Accordingly the function U is strictly increasing on[a,b]. We can thus define a strictly increasing sequencea=ξ0<ξ1<⋯<ξn=bby settingξi:=U−1(αi),i=0,…,n.Let us define the operatorB:C0([a,b])→EbyBF:=∑i=0nF(ξi)Bifor allF∈C0([a,b]).This is a Bernstein-type positive linear operator based on the QECP-spaceE. It reproduces constants and the function U, and it is variation-diminishing due to the quasi-Bernstein basis being normalised and totally positive. Such operators can be handled as in the case of EC- or QEC-spaces Mazure (2009, 2011b, 2011c) to which we refer the reader (also see Aldaz et al., 2009 on this subject).2- Given any positiveω0,…,ωn, consider the functionΩ:=∑i=0nωiBi∈E.As an application of(ii)⇒(iii)of Theorem 6.2, we can deduce that the spaceR(E;Ω):={FΩ|F∈E},is a QECP-space good for design on([a,b];T). It can also be described asR(E;Ω)={∑i=0nγiωiBi∑i=0nωiBi|γ0,…,γn∈R}.By analogy with the classical rational spaces, we call it the rational QECP-space on([a,b];T)based onEand Ω. The properties and advantages of such rational QECP-spaces can be developed as we did for rational EC-spaces in Mazure (2013). We just mention two facts:– for eachF∈E, the blossom ofFΩ∈R(E;Ω)is the quotientfωof the blossoms f, ω of F, Ω inE;– any QECP-space good for design is a rational QECP-space, sinceR(R(E;Ω);1Ω)=E.We can actually write Theorem 6.3 as stated below, where, for the sake of simplicity we denote the same way an element ofEand its restriction to each[tk+,tk+1−]:Theorem 6.6Given an(n+1)-dimensional PQEC-spaceEon([a,b];T), and given anyc∈[a,b], the following properties are equivalent:(i)is a QECP-space on([a,b];T);for eachk=0,…,q, we can find a system(w0k,…,wn−1k)of weight functions on[tk,tk+1], with associated differential operators onCn−1([tk,tk+1]denoted byL0k,…,Ln−1k, so that the following three requirements are fulfilled:1)the section spaces are given by(49)Ek=QEC(w0k,…,wn−1k;Ck),k=0,…,q,whereCkis a two-dimensional C-space on[tk,tk+1];anyF∈Esatisfies the connection conditions(50)LikF(tk+)=Lik−1F(tk−)fori=0,…,n−1and fork=1,…,q;the continuous function whose restriction to[tk,tk+1]isLn−1kΨnc,k=0,…,q, is strictly monotone on[a,b].Remark 6.7LetEbe an(n+1)-dimensional PQEC-space on([a,b];T). The practical problem that we want to solve here is the following one: how to know whether or notEis a QECP-space on([a,b];T)? Equivalently, how to establish necessary and sufficient conditions forEto be a QECP-space on([a,b];T)? These conditions should involve all the parameters definingE. What are therefore these parameters? The most obvious ones are theq(n+1)(n+2)/2entries of all connection matrices, but the section-spaces themselves may depend on parameters, and even the knots(t0,…,tq+1)can also possibly serve as parameters. Answering these questions is not an easy task. Given that, for eachk=0,…,q, we can build all possible systems(w0k,…,wn−1k)of weight functions on[tk,tk+1]such thatEk=QEC(w0k,…,wn−1k;Ck)by iteration of the non-piecewise version of Theorem 6.3, the equivalence(i)⇔(ii)of Theorem 6.6 provides us with a possible constructive approach to answer these questions. An alternative approach will consist in finding conditions to diminish the dimension within the class of all PECQ-spaces on([a,b];T)via Proposition 6.8 below.Proposition 6.8LetEbe an(n+1)-dimensional QECP-space on([a,b];T)and let(V0,…,Vn)be a quasi-Bernstein-like basis relative to(a,b). Then, for each integer i,0⩽i⩽n, all coordinates ofViin a quasi-Bernstein-like basis(W0,…,Wn)relative to(c,d), witha⩽c<d⩽b, are positive — except, possibly, for those required to be 0 by the zeroes ofViat a, b —. More precisely, ifVi=∑j=0nvi,jWj•ifa<c<d<b, then allvi,jare positive;ifa=c<d<b, thenvi,j=0forj=0,…,i−1, and all othervi,jare positive;ifa<c<d=b, thenvi,j=0forj=i+1,…,n, and all othervi,jare positive.ProofLetEˆbe the QECP-space good for design on([a,b];T)obtained fromEby continuous integration. Without loss of generality, we can assume that(V0,…,Vn)is obtained from the quasi-Bernstein basis(Bˆ0,…,Bˆn)relative to(a,b)inEˆvia formulæ (28). We can make a similar assumption for(W0,…,Wn)on[c,d]. The claimed result follows from the lemma below via (46). □Lemma 6.9LetEbe an(n+1)-dimensional QECP-space good for design on([a,b];T)and let(B0,…,Bn)be its quasi-Bernstein basis relative to(a,b). Givena<c<d<b, and given an integer i,0⩽i⩽n−1, we denote byβi,j,γi,j,δi,j,j=0,…,n, the Bézier points of the functionBi:=∑j=i+1nBj,relative to(a,c),(c,d), and(d,b), respectively. They satisfy(51)0=βi,0=βi,1=⋯=βi,i<βi,i+1<βi,i+2<⋯<βi,n<1,0<γi,0<γi,1<⋯<γi,n−1<γi,n<1,0<δi,0<δi,1<⋯<δi,i<δi,i+1=⋯=δi,n−1=δi,n=1.This is a straightforward consequence of the de Casteljau evaluation algorithm ofBi(c)from the Bézier points(0,0,…,0︸(i+1)times,1,1,…,1︸(n−i)times)ofBirelative to(a,b)and then of the de Casteljau evaluation algorithm ofBi(d)from its Bézier points relative to(c,d). Therefore, it is a straightforward consequence of the properties of blossoms, and in particular of their pseudoaffinity. □Remark 6.10To continue the comments in Remark 6.7, the necessary and sufficient conditions for a PQEC-spaceEon([a,b];T)to be a QECP-space on([a,b];T)will be obtained step by step. From Proposition 6.8 we know that we should first find necessary and sufficient conditions forEto possesses a “convenient” quasi-Bernstein-like basis(V0,…,Vn)relative to(a,b), in the sense that this basis should satisfy the positivity conditions stated in Proposition 6.8 in each interval[tk,tk+1]. Then, for any positiveα0,…,αn, the piecewise functionw0:=∑i=0nαiVi∈Ewill satisfy the assumptions of Lemma 3.9. Accordingly, the corresponding spaceDL0Ewill be an n-dimensional PQEC-space on([a,b];T), possessing a quasi-Bernstein-like basis relative to(a,b)obtained from (28). The second step will consist in finding additional necessary and sufficient conditions for this basis to be a “convenient” one, so as to decrease the dimension again via Lemma 3.9, and so forth… This will be the method adopted in next section.In this section we illustrate our results with the relatively simple case wheren=2with a view to design in the four-dimensional space of continuous functions obtained by integration.We start with only two sections spaces. We thus work witht0=a<t1<t2=bandT=(t1). In order to avoid too many indices, we are changing our notations compared to the previous sections. We denote byEandE‾two three-dimensional QEC-spaces on[t0,t1]and[t1,t2], respectively. By(V0,V1,V2)and(V‾0,V‾1,V‾2)we denote a positive quasi-Bernstein-like basis relative to(t0,t1)and to(t1,t2)inEandE‾, respectively. Without loss of generality we can assume that(52)V0(t0)=V2(t1)=V‾0(t1)=V‾2(t2)=1.Sincen=2, the three-dimensional PQEC-spaceEˆon([a,b];T)we are working with is thus defined by the two section-spacesEandE‾and a lower triangular connection matrix of order 3 with positive diagonal entries. Therefore, all piecewise functionsFˆ∈Eˆsatisfy the same connection condition(53)[Fˆ(t1+)Fˆ′(t1+)Fˆ(t2)]=[a00bc0def][Fˆ(t1−)Fˆ′(t1−)Fˆ(t0)],wherea,c,f>0.Theorem 7.1The PQEC-spaceEˆis a QECP-space on([t0,t2];T)if and only if the following properties are satisfied(54)e>0,d+eV2′(t1)>0,eb−cd−eaV‾0′(t1)>0.ProofThe proof comprises several steps.• First step:Expliciting the connection conditions(53)via(V0,V1,V2)and(V‾0,V‾1,V‾2). Consider two functionsF∈EandF‾∈E‾expanded in the corresponding quasi-Bernstein-like bases as(55)F=α0V0+α1V1+α2V2,F‾=α‾0V‾0+α‾1V‾1+α‾2V‾2.On account of our choice (52), we have(56)F(t1)=α2,F′(t1)=α1V1′(t1)+α2V2′(t1),F(t0)=α0,F‾(t1)=α‾0,F‾′(t1)=α‾0V‾0′(t1)+α‾1V‾1′(t1),F‾(t2)=α‾2.Accordingly, from (53) we can say that the two functions F andF‾are the restrictions to[t0,t1]and[t1,t2], of a piecewise functionFˆ∈Eˆif and only if(57){α‾0=aα2,α‾1V‾1′(t1)=Δα2+cV1′(t1)α1,α‾2=Hα2+eV1′(t1)α1+fα0,with(58)Δ:=b+cV2′(t1)−aV‾0′(t1),H:=d+eV2′(t1).• Second step:Necessary and sufficient conditions ensuring the presence of a “convenient” quasi-Bernstein-like basis relative to(t0,t2)inEˆ.With notations consistent with the previous point, the restrictionsB0,B‾0,B1,B‾1,B2,B‾2, to[t0,t1]and[t1,t2], of a possible quasi-Bernstein-like basis(Bˆ0,Bˆ1,Bˆ2)inEˆcan be written as(59)B0=α0,0V0+α0,1V1+α0,2V2,B‾0=α‾0,0V‾0,B1=α1,1V1+α1,2V2,B‾1=α‾1,0V‾0+α‾1,1V‾1,B2=α2,2V2,B‾2=α‾2,0V‾0+α‾2,1V‾1+α‾2,2V‾2.Not only do we require the existence of such a quasi-Bernstein-like basis(Bˆ0,Bˆ1,Bˆ2)but we even require that all α'-s and allα‾'-s involved in (59) be positive. Since(V0,V1,V2)and(V‾0,V‾1,V‾2)are positive quasi-Bernstein-like bases inEandE‾, respectively, we know that(60)V1′(t1)<0,V‾1′(t1)>0.1)B2,B‾2are obtained by solving (57) under the requirements:α0=α1=0. We therefore have to solve(61)α‾2,1V‾1′(t1)=Δα2,2,α‾2,2=Hα2,2,under the additional requirementα2,2,α‾2,1,α‾2,2>0. Due to (60), a necessary condition for this to be possible is that(62)Δ>0andH>0.Conversely, if (62) holds, any choice of a positiveα2,2generates positiveα‾2,1,α‾2,2.2) Let us assume that (62) holds. Then,B0,B‾0are obtained by solving (57) under the requirementsα‾1=α‾2=0. We have to solve(63)−eV1′(t1)α0,1=Hα0,2+fα0,0,−cV1′(t1)α0,1=Δα0,2,withα0,0,α0,1,α0,2>0. Substituting in it the value ofα0,1obtained from the second equation in (63), the first equation can equivalently be replaced by(64)Γα0,2=cfα0,0,withΓ:=eΔ−cH=eb−cd−eaV‾0′(t1).On account of (62) we can therefore obtain positiveα0,0,α0,1,α0,2>0satisfying (63) if and only if we additionally require thatΓ>0.3) Let us assume that (62) holds and thatΓ>0. Then,B1,B‾1are obtained by solving (57) under the requirementsα0=α‾2=0. We thus have to find positiveα1,1,α1,2,α‾1,1such that(65)α‾1,1V‾1′(t1)=Δα1,2+cV1′(t1)α1,1,Hα1,2+eV1′(t1)α1,1=0.After elimination ofα1,1, the left equation can equivalently be replaced by(66)eα‾1,1V‾1′(t1)=Γα1,2.It readily follows that positiveα1,1,α1,2,α‾1,1can satisfy (65) if and only if we additionally require thate>0.All in all, existence of a Bernstein-like basis(Bˆ0,Bˆ1,Bˆ2)with positive α'-s andα‾'-s in (59) is obtained if and only ifΔ>0,H>0,e>0,Γ>0.However, sinceeΔ=cH+Γ, these four conditions reduce to the three conditionsH>0,e>0,Γ>0, which is exactly (54).• Third step:Assume that(54)holds. Let us prove thatEˆis a QECP-space on([t0,t2];T). Given any positive real numbersAˆ0,Aˆ1,Aˆ2, consider(67)Wˆ0:=Aˆ0Bˆ0+Aˆ1Bˆ1+Aˆ2Bˆ2∈Eˆ.Denote byW0andW‾0the restrictions ofWˆ0to[t0,t1]and[t1,t2], respectively, and byL0andL‾0the divisions byW0andW‾0. Let us expand these functions as(68)W0=α0V0+α1V1+α2V2,W‾0=α‾0V‾0+α‾1V‾1+α‾2V‾2.On account of (67) and of our second step, we can say thatα0,α1,αnandα‾0,α‾1,α‾2are all positive. From Lemma 3.9 we can thus assert thatWˆ0is positive on([a,b];T)and that, ifLˆ0Eˆdenotes the piecewise division byWˆ0, thenDLˆ0Eˆis a two-dimensional PQEC-space on([t0,t2];T). Moreover, we also know thatDLˆ0Eˆpossesses a quasi-Bernstein-like basis relative to(t0,t2), say(βˆ0,βˆ1). Indeed such a basis can be derived, for instance, by the systematic procedure (28) from the quasi-Bernstein basis relative to(t0,t2)inLˆ0Eˆobtained by division of the sides of (67) byWˆ0, i.e.,(Aˆ0Bˆ0Wˆ0,Aˆ1Bˆ1Wˆ0,Aˆ2Bˆ2Wˆ0).The piecewise functionsβˆ0,βˆ1∈DLˆ0Eˆcan thus be taken asβˆ0:=−Aˆ0(Bˆ0Wˆ0)′=Aˆ0Wˆ0′Bˆ0−Wˆ0Bˆ0′Wˆ02,βˆ1:=Aˆ2(Bˆ2Wˆ0)′=Aˆ2Wˆ0Bˆ2′−Wˆ0′Bˆ2Wˆ02.InDLˆ0Eˆthe section-spacesDL0EandDL‾0E‾are two-dimensional C-spaces on[t0,t1]and[t1,t2], respectively. Moreover, we know that the first diagonal entry of the connection matrix att1inDLˆ0Eˆis positive. Accordingly, all components ofβˆ0,βˆ1in quasi-Bernstein-like bases ofDL0EandDL‾0E‾— other than those which are equal to zero due to(βˆ0,βˆ1)being a quasi-Bernstein-like basis relative to(t0,t2)— are positive if and only if we haveβˆ0(t1+)>0andβˆ1(t1−)>0,that is, if and only ifW‾0′(t1)B‾0(t1)−W‾0(t1)B‾0′(t1)>0,W0(t1)B2′(t1)−W0′(t1)B2(t1)>0.From (68), (52) and (59), we can derive that(69)W0(t1)B2′(t1)−W0′(t1)B2(t1)=α2α2,2V2′(t1)−(α1V1′(t1)+α2V2′(t1)))α2,2=−α1α2,2V1′(t1)>0,the positivity being guaranteed by (60). One can similarly check thatW‾0′(t1)B‾0(t1)−W‾0(t1)B‾0′(t1)=α‾1α‾0,0V‾1′(t1)>0.Accordingly, for any positive numbersγˆ0,γˆ1, the piecewise functionWˆ1:=γˆ0βˆ0+γˆ1βˆ1∈DLˆ0Eˆis positive on([t0,t2];T). Piecewise division byWˆ1transforms the PQEC-spaceDLˆ0Eˆon([t0,t2];T)into a two-dimensional PQEC-spaceLˆ1Eˆon([t0,t2];T)containing constants, that is, into a two-dimensional C-spaceCon[t0,t2](see Proposition 3.5). It readily follows thatEˆ=QECP(Wˆ0,Wˆ1;C).We thus have proved that the conditions (54) are indeed necessary and sufficient forEˆto be a QECP-space on([t0,t2];T). □Besides, from (61) and (63)–(66) we can derive the following result:Proposition 7.2Assume that(54)holds. As a Bernstein-like basis relative to(t0,t2)in the QECP-spaceEˆwe can take the basis(Bˆ0,Bˆ1,Bˆ2)whose restrictions to[t0,t1]and[t1,t2]are given by:(70)B0=V0+fΔ−V1′(t1)ΓV1+cfΓV2,B‾0=acfΓV‾0,B1=H−eV1′(t1)V1+V2,B‾1=aV‾0+ΓeV‾1′(t1)V‾1,B2=1HV2,B‾2=aHV‾0+ΔV‾1′(t1)HV‾1+V‾2,where Δ, H are defined in(58), and Γ in(64).Note that the latter formulæ are deliberately written so as to point out the positivity of all coefficients (see (60)).Remark 7.3We have only addressed the case where we are connecting two three-dimensional QEC section-spaces. In practice, for the construction of splines, the resulting QECP-spaces can usefully play the role of one section-space (see Laurent et al., 1997). Nevertheless, we would like to draw the reader's attention to the fact that it is possible to iterate the process. Indeed, if, for instance, we have a third QEC-section spaceE̿on[t2,t3]with a corresponding connection matrix att2, the QECP-spaceEˆcan be considered as one section-space on[t0,t2]that we are connecting with the second section-spaceE̿. The same approach can be developed, provided that we do not work with the given connection matrix att2but with a modified one, expressing the values att3of piecewise functionsFˆˆin the resulting PQEC-spaceEˆˆon([t0,t3];(t1,t2))as linear combinations ofFˆˆ(t2−),Fˆ′ˆ(t2−)andFˆˆ(t0). With the help of the quasi-Bernstein-like basis (70) and of a positive quasi-Bernstein-like basis(V̿0,V̿1,V̿2)relative to(t2,t3)inE̿we simply have to find necessary and sufficient conditions ensuring the existence of a “convenient” quasi-Bernstein-like basis relative to(t0,t3)in theEˆˆ. Such conditions are similar to (54).Here we assume thatt0=0,t1=1,t2=2, thatE=Ep,qand thatE‾is obtained fromEp‾,q‾by translation from[0,1]to[1,2], where p, q,p‾,q‾are any real numbers greater than 1.As a positive quasi-Bernstein-like basis in the section-spaceE, we can take the quasi-Bernstein basis relative to(0,1), that is,V0(x)=(1−x)p,V2(x):=xq,V1(x):=1−V0(x)−V2(x),x∈[0,1],and the similar quasi-Bernstein basis(V‾0,V‾1,V‾2)relative to(1,2)inE‾. We therefore haveV1′(t0)=p=−V0′(t0),V2′(t1)=−V1′(t1)=q,V‾1′(t1)=p‾=−V‾0′(t1),V‾2′(t2)=−V‾1′(t2)=q‾.In this example, the quantities Δ, H, Γ introduced in (58) and (64) are thus given by(71)Δ=b+cq+ap‾,H=d+eq,Γ=eb−cd+eap‾.In particular, Theorem 7.1 yields the following result.Corollary 7.4Under the data above, the PQEC-spaceEˆis a QECP-space on([0,2];(1))if and only if(72)e>0,d+eq>0,eb−cd+eap‾>0.Under the conditions (72) the spaceFobtained fromEˆby continuous integration is a four-dimensional QECP-space good for design on([0,2];(1)). It is in that spaceFthat we want to illustrate the shape effects permitted by the context. Nevertheless, we have to handle a total amount of ten parameters: namely the six entries a, b, c, d, e, f of the connection matrix, and the two pairs of real numbers(p,q)and(p‾,q‾)defining the two section-spaces. This is not a reasonable amount to give illustrations in an article, and this is why we significantly reduce the number of free parameters by requiring the spaceFto preserve symmetry, in the sense that symmetric control polygons should provide symmetric parametric curves.Proposition 7.5The spaceFpreserves symmetry if and only if(73)p‾=q,q‾=p,a=c=f=1,d=eb2.When(73)holds, the four free parameters e, b, p, q are assigned to satisfy(74)e>0,b+2q>0.ProofSince the Bernstein-like basis (70) is chosen so thatBˆ0(0)=Bˆ0(2)=1, symmetry is preserved if and only ifB0(x)=B‾2(2−x),B2(x)=B‾0(x),B1(x)=B‾1(2−x),x∈[0,1].From (70) it readily follows that these conditions are satisfied if and only ifp‾=q,q‾=p,a=c=f=1andΓ=H. This yields (73). In that case (72) becomes (74). □Under the requirements (73) and (74), the functions in the four-dimensional spaceFareC1andF2(orG2as well): continuity of the Frenet frames of order two and of the first curvature att1. A few illustrations are provided in Figs. 3 and 4, with special insistence on the limit casesb=−2q+,b→+∞ande=0+,e→+∞.Example 7.6The technique used for connecting two three-dimensional QEC-spaces so as to form a QECP-space on([t0,t2];(t1))can of course be used to connect two three-dimensional EC-spaces so as to form an ECP-space on([t0,t2];(t1)). We illustrate this with a simple example within the symmetry conditions (73). Here we assume thatp=q=2. We are thus connecting two cubic polynomials F,F‾on[t0,t1]=[0,1]and[t1,t2]=[1,2]viaF(t1)=F‾(t1)and(75)[F‾′(t1)F‾″(t1)F‾′(t2)]=[100b10eb2e1][F′(t1)F″(t1)F′(t0)].Via Taylor expansions ofF′(t0)andF‾′(t2)att1, (75) can equivalently be written in the more usual way(76)[F‾′(t1)F‾″(t1)F‾‴(t1)]=[100b10ηb2η1][F′(t1)F″(t1)F‴(t1)],withη:=2e−4.The functions inFare piecewise cubic on([0,2];(1)), they areC1and they areF3in the usual sense of continuity of the Frenet frames of order three and of the first two curvatures att1=1. The symmetric spaceFis an ECP-space good for design on([0,2];(1))if and only ifb+4>0andη+4>0.This is illustrated in Fig. 5, for various values of the parameters η and b.

@&#CONCLUSIONS@&#
