@&#MAIN-TITLE@&#
Accurate inverse-consistent symmetric optical flow for 4D CT lung registration

@&#HIGHLIGHTS@&#
The classical centre-symmetric local binary pattern is generalised to generate distinctive features.A novel hybrid local binary pattern is proposed.A novel method based on Lucas-Kanade algorithm and the novel hybrid pattern is proposed.The proposed method is inverse-consistent.The proposed method yields the most accurate results of all the unmasked methods tested on the 4D CT datasets from the DIR-lab.

@&#KEYPHRASES@&#
Optical flow,Deformable image registration,Local binary pattern,4D CT,

@&#ABSTRACT@&#
Deformable image registration remains a challenging research area due to difficulties associated with local intensity variation and large motion. In this paper, an Accurate Inverse-consistent Symmetric Optical Flow (AISOF) method is proposed to overcome these difficulties. The two main contributions of AISOF include the following: (1) a coarse-to-fine strategy for an inverse-consistent symmetric method and (2) a novel Hybrid Local Binary Pattern (HLBP) to the classical Lucas–Kanade optical flow method. The HLBP consists of a median binary pattern and a generalised centre-symmetric local binary pattern. The generalised centre-symmetric local binary pattern has two thresholds, and this pattern can capture more information than the classical centre-symmetric local binary pattern, which has one threshold. The proposed HLBP can cope well with high contrast intensity and local intensity variation. Because the inverse-consistent symmetric method can reduce inverse consistency errors in Markov random fields based registration methods, we adopted this method to improve the accuracy of registration. In addition, a coarse-to-fine strategy was adopted to handle large motion. The proposed AISOF method was evaluated for 10 publicly available 4D CT lung datasets from the DIR-Lab. The mean target registration error of the AISOF method is 1.16mm, which is significantly superior to the error of the classical Lucas–Kanade optical flow method, 2.83mm. Moreover, this error is also the smallest of all unmasked registration methods using these datasets.

@&#INTRODUCTION@&#
Image registration, which has been extensively studied [1–3], can be classified into rigid registration and deformable image registration (DIR) [4–6]. Specifically, DIR has been proved as an invaluable tool in many clinical applications of lung Computed Tomography (CT) images, such as Image-Guided Radiation Therapy (IGRT) [7], dose estimation [8], and estimation of lung ventilation [9]. Because small errors can ultimately lead to unwanted consequences in clinical applications, high demands are placed on the accuracy of DIR methods. However, improving the accuracy of DIR for lung CT images is difficult due to the following two problems: local intensity variation and large motion [10]. The DIR of lung CT images has received considerable attention in recent years [11–21].The first problem in lung registration is local intensity variation due to lung compression. This phenomenon may be problematic for deformable registration if the selected similarity metrics of image registration are inappropriate. Classical similarity metrics attempt to find a global relationship between two images, such as mutual information and cross-correlation. Therefore, they are not suitable for local variations of intensity. This problem is generally solved with three types of methods. The first method models lung compression using various approaches, such as an additional label that represents the local intensity variation in MRF [10], compressible flow [11,12] and mass-preserving similarity [13,14]. This type of method usually improves the accuracy of image registration. However, accurately estimating the local intensity variation in an image registration framework is difficult because these methods increase the complexity of image registration. For example, the additional label in MRF increases the complexity of the energy term due to the additional variable and weighting parameter [10]. Furthermore, selecting a weighting parameter to simultaneously estimate displacements and the local intensity variation is difficult. Therefore, some methods address the local intensity variation prior to image registration, which constitutes the aforementioned second class of methods. These methods usually obtain dense features that are robust to locally varying contrast, such as Self-Similarity Context (SSC) descriptors [15], Modality Independent Neighbourhood Descriptors (MIND) [16], normalised gradient fields [17,18], census transform [19–23], Local Binary Pattern (LBP) [24,25], entropy images [26], and manifold-based methods [27,28]. Notably, the census transform method is very similar to the LBP method. This type of method has become popular in recent years and yields highly accurate image registration results via various approaches, such as normalised gradient fields, census transform, and LBP. However, other methods, such as entropy images and manifold-based methods, continue to suffer from low accurate image registration results and highly complex calculations. The third type of method obtains local similarity features, such as local cross-correlation [29,30] and local phase methods [31]. This type of method is better than the global cross-correlation and mutual information methods. Local cross-correlation is a powerful method for lung CT images [30]. However, local phase method is sensitive to image noise and filter parameter tuning.Among these methods, LBP-based image registration produces the most accurate image registration results. However, the LBP method suffers three drawbacks in the application to 4D CT lung images. First, LBP suffers from a high computational complexity when applied to high-resolution CT lung images. Second, LBP is sensitive to noise because it utilises the centred pixel value as the threshold in the local neighbourhood. Third, the binary representation by LBP cannot differentiate high-contrast regions from low-contrast regions. These drawbacks inspired us to utilise robust and efficient variants of LBP for lung CT images, such as the Median Binary Pattern (MBP) [32] and Centre-Symmetric Local Binary Pattern (CS-LBP) methods [33]. MBP utilises the median of the neighbourhood as the threshold, which is a more robust approach than that of LBP. Because CS-LBP reduces the calculation time by half by using symmetric points with a typically non-zero threshold, it is more efficient than LBP. We generalised the classical CS-LBP with two different thresholds; the small threshold was used for low-contrast regions, and the large threshold was used for high-contrast regions, which allows the generalised CS-LBP to distinguish between low- and high-contrast regions. To increase the robustness of representations, the generalised CS-LBP was combined with MBP to generate a novel local binary pattern, i.e., the Hybrid Local Binary Pattern (HLBP). To improve the efficiency of calculation, HLBP only selects a small fraction of points in each neighbourhood.The second problem in lung registration is the large motion of lungs, which can often lead to errors in registration. Three types of strategies can be used to address this problem. The first strategy relies on image features to reduce the negative impact caused by large motion [34–36]. For example, the landmark-based thin-plate-spline method in [34] incorporates landmark information into the registration scheme as a pre-registration to handle large motion. The varying framework in [35] employs sparse descriptor matching to handle large motion. Both of these approaches successfully overcome the challenges posed by large motion, but they suffer from complex feature detection and sparse descriptor matching. The second type of strategy is based on discrete optimisation, which is usually formulated based on a Markov Random Field (MRF) model [37]. Discrete optimisation can overcome the negative impact of large motion while improving the control over the displacement space. However, the MRF method [6] requires high computational effort in the search space. Lastly, the coarse-to-fine image warping method for optical flow has been introduced by Lucas and Kanade [38] to overcome large motion. Despite being the oldest method to solve this problem, it performs well and is widely used in image registration [39–41].This paper proposes an Accurate Inverse-consistent Symmetric Optical Flow (AISOF) method to overcome the difficulties in handling local intensity variation and large motion. The AISOF adopts the HLBP method, a coarse-to-fine strategy, and an inverse-consistent symmetric method. Specifically, the HLBP method can cope well with local intensity variation, and the coarse-to-fine strategy can overcome large motion. Moreover, the inverse-consistent symmetric method can reduce the influence of swapping source and target images, which can improve the accuracy of image registration [10].Notably, our work entirely differs from that of Antink et al. described in [42]. Antink et al. improved the classical Lucas–Kanade algorithm with robust gradient calculation, a non-Gaussian weighting function and Tikhonov regularisation. However, the high calculation complexity limits the applicability of this method. The computation time was approximately 40/73min for one case of 4D CT lung datasets from the DIR-Lab on a Xeon X5460-server.

@&#CONCLUSIONS@&#
A novel method based on Lucas–Kanade algorithm that yields a mean target registration error of 1.16mm was proposed. This estimation is the most accurate of all unmasked registration methods tested on the 4D CT lung datasets from DIR-Lab to date. To handle intensity variation due to lung compression, a novel hybrid local binary pattern was proposed, which was derived from the generalised centre-symmetric local binary pattern and median local binary pattern.Whereas our validation focused on CT images, we believe that our approach could be applied to a variety of medical image registration tasks. The application of HLBP to multi-modal registration tasks, such as the registration of PET and CT, MRI and ultrasound, is the subject of future work. Furthermore, the use of additional thresholds may improve the HLBP.Moreover, the AISOF method may be improved further. Because the use of lung segmentation masks could improve the performance of registration methods, we plan to incorporate lung segmentation masks into the proposed AISOF method in the future. Feature-based methods are usually used to pre-align images in order to overcome large motion. We also plan to incorporate feature-based methods into the AISOF method in future studies.