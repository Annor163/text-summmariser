@&#MAIN-TITLE@&#
Cost allocation in asymmetric trees

@&#HIGHLIGHTS@&#
Agents can produce and demand a good.Agents can send and receive the good through a tree.This tree has associated a cost that should be paid by the agents.We propose two rules for dividing the cost of the tree among the agents.

@&#KEYPHRASES@&#
Cost allocation,Tree,Asymmetric agents,

@&#ABSTRACT@&#
Agents are connected each other through a tree. Each link of the tree has an associated cost and the total cost of the tree must be divided among the agents. In this paper we assume that agents are asymmetric (think on countries that use aqueducts to bring water from the rainy regions to the dry regions, for example). We suppose that each agent is entitled with a production and demand of a good that can be sent through the tree. This heterogeneity implies that the links are not equally important for all the agents. In this work we propose, and characterize axiomatically, two rules for sharing the cost of the tree when asymmetries apply.

@&#INTRODUCTION@&#
The study on the structure of service networks (such as power grids, gas pipelines, telecommunications or transportation infrastructures) has become more and more important. Those networks are costly (some times that cost is the amount to pay for its construction, and some other times it refers to the needed money for its maintenance). Quite often the structure of the network is a tree, because it allows to have all agents connected in the cheapest way. The problem of allocation the cost of a network, and particularly of a tree, has been widely studied in the literature.Let us consider the simplest problem we may define, that is, two agents with a link connecting them. To divide the cost of the link equally between the two extremes, is a quite reasonable outcome when there is no more information and agents are assumed to be homogeneous. However, there are many cases where that homogeneity does not apply, and the link is much more important for one of the agents than for the other. The electrical interconnection between France and Spain is a quite illustrative example of this situation. These two countries decided to communicate their national power grid with a link crossing the Pyrenees. The cost of this connection has to be split between both countries, taking into account that Spain will obtain more beneficial than France from the construction of the link. This is because France produces enough electricity to cover, in case of failure in Spain, both its own demand and the Spanish one. The question then arises: How should the cost of the new connection be distributed between France and Spain considering all the elements? Similar questions emerge in the construction of the gas pipelines between Europe and Africa or Russia and Germany. Another situation that reflects this asymmetry is the network of aqueducts and pipelines that bring water from the rainy regions to the arid areas. The first ones use to have enough water to cover its demand and to even send the surplus to where it is needed, whereas the arid regions hardly have enough resource to fulfilled its own demand. Until which point is fair to oblige to the rainy areas to contribute to the cost of the pipelines? This paper deals with these situations, where the agents in the tree are asymmetric. This asymmetry will be induced by different demand and production for different agents.In its general formulation, we consider a set of agents, each of them able to produce and demand a service like water. All agents are connected to each other forming a tree. Through this tree agents can send and receive water (or any other good). Hence, if the production of one agent fails, its demand can still be satisfied by obtaining the water from another agent. This can be obviously done only if the production of the other agent is high enough to compensate the failure. We assume that the tree is given and that each link of the tree has an associated cost that should be paid by the agents. This cost could be interpreted as a construction cost, maintenance cost (the tree already exists there but there are recurring maintenance costs, otherwise cannot be operative) or usage cost (the tree is there but we must pay a cost for using it). To sum up, a problem has five elements: a set of agents, a tree that describes the communication structure, a cost function that sets the cost of each link, a vector of demands (one demand for each agent), and a vector of productions (one production for each agent). A rule is a mechanism to distribute the cost of the tree among the agents.Our paper belongs to literature on the axiomatic analysis of cost allocation rules. Some papers of this literature focus on general problems like Moulin and Shenker (1992), Sprumont (1998), and Tijs and Driessen (1986). Other papers study some particular situations associated with networks, like Estevez-Fernandez (2012), Moulin and Laigret (2011), Norde, Fragnelli, Garcia-Jurado, Patrone, and Tijs (2002). Other papers focus on situations associated with a tree, like Bird (1976), Bogomolnaia, Holzman, and Moulin (2010), Littlechild and Owen (1973), and Ni and Wang (2007).The particular case of trees has been a focal point (mostly because it is the most efficient way to communicate all the agents, regardless other aspects like flows and capacities). In the so-called minimum cost spanning problem several agents (nodes) need a good (water, for example) which can only be provided by a special node called the source (a water tank, for example). Thus, agents have to be connected to the source. Bird (1976), probably the seminal paper on this field, studies how to share the cost of a given tree among its nodes. Several papers came after in this field, proposing new solutions and analyzing the properties such solutions may satisfy. We can mention, for instance, the papers of Kar (2002), Dutta and Kar (2004), Tijs, Branzei, Moretti, and Norde (2006), Bergantiños and Vidal-Puga (2007, 2010), Bergantiños and Lorenzo-Freire (2008), Bogomolnaia and Moulin (2010), Bergantiños, Lorenzo, and Lorenzo-Freire (2011), Hougaard and Tvede (2012) and Trudeau (2012). In a parallel way other papers propose rules in problems arising from extensions of the minimum cost spanning tree problem. For instance, Fernandez, Hinojosa, and Puerto (2004) study multicriteria cost spanning tree games; Bergantiños and Gómez-Rúa (2010) study situations where agents are grouped; Dutta and Mishra (2012) study situations where costs are asymmetric; and Bergantiños, Gómez-Rúa, Llorca, Pulido, and Sánchez-Soriano (2012, 2014) study situations where the computation of the optimal tree is NP hard. In this paper we consider situations where each node can provide the service. Thus each node has a demand and a capacity production. As far as we are aware no other work has studied the problem presented in this paper. A real example captured by our model, but not by the previous ones, is the transfer of water from Tagus river to Segura river in Spain.Our paper belongs to literature on the axiomatic analysis of cost allocation rules in networks. See Sharkey (1995) and Thomson (2001) for two surveys of this literature. In the axiomatic method, rules are justified in terms of the axioms they fulfill. In general, suitable combinations of desirable axioms are used to differentiate among rules. Thus, we introduce a collection of axioms that are adequate for the framework we study.The first group of axioms are: Fairness for two agents says that, when there are only two agents and one link between them, the cost of the connection is paid by the agent that gets profit from its existence. Symmetry states that symmetric agents should pay the same. Independence reallocation requires that if the cost of connecting two individuals is zero, both cannot benefit from reallocating productions and demands between themselves. Network-cost independence of extra costs refers to how to allocate punctual increments of the cost of a single link. Our first result identifies the rule that satisfies these four axioms. We call it the equal division across components rule, which works as follows. For each link l, if we remove l from the tree we have two connected components. The cost of l is divided among the components following the idea of fairness for two agents, but applied to each component. We compute the aggregate production and demand of both components. If the link is profitable for only one component, then this component pays the cost. If the link is profitable for both or nobody, then each component pays half of the cost. Once this is done, the payment of each component is equally allocated among the agents belonging to it. We apply the same reasoning to all the links of the tree and the contribution of an agent is the sum of his contributions in the removal of all links.The second group of axioms we propose is the following. Cost additivity simply says that the rule is additive with respect to the cost function. Stand alone core states that the rule must select allocation within the core (whenever the core is not empty). An agent is safe in a tree when, in case of failure of his production, the other agents can fulfill its demand. After the removal of a link in the tree, the safe status of an agent may change. Balanced contributions with respect to the safe status requires that if the cost of a link increases, all agents with the same status with respect to such a link should be affected in the same way. In our second result we characterize the rule that fulfills the three previous properties. We call it the equal safety rule. This rule also specifies how to divide the cost of each single link. Now, the cost of a link is equally split among all the agents for whom such a link is necessary for their safety. If some link is not necessary for any agent then, the cost of the link is equally divided among all the agents. Again, the contribution of an agent is the sum of his contributions to all links of the tree.We apply both rules to the design of a tariff system for the water transferred from Tagus river to Segura river in Spain. Even both rules are different, in this particular case coincide.The rest of the paper is structured as follows. In Section 2 we present the model and the elements of the problem. In Section 3 we introduce the axioms we use in the rest of the paper. Sections 4 and 5 are devoted to the characterizations we aforementioned. Finally, Section 6 concludes.LetU=1,2,3,…be the (infinite) set of possible agents andN⊂U. Usually we takeN={1,2,…,n}wheren=N. A networkg is a collection of unordered pairs in N, i.e.,g={{i,j}:{i,j}⊂N}. When there is no room for confusion we denote the elements of g simply as ij instead of{i,j}. The agentsi∈Ninvolved in the network are called nodes, while the pairs ij are called links. Given a network g, the set of links and nodes of g are denoted byL(g)andN(g)respectively. GivenS⊂N,gSdenotes the restriction of g to S, namelygS=ij∈g:ij⊂S. Given a network g and a linkij∈g,g⧹ijdenotes the network resulting from dropping the link ij from g.A path ingbetweeniandj is a sequence of links in g that starts in node i and finishes in node j, i.e., it is a stringk1k2,…,kh-1khsuch thatkq≠krfor allq,r∈1,…,h,kq-1kq∈gfor allq∈{2,…,h},i=k1, andj=kh. We say that iandjare connected ing if there exists a path in g between i and j. We say thatS⊂Nis a connected component in g if any pair of agents in S are connected whereas no agent in S is connected with an agent inN⧹S. LetN/gdenote the partition of N in connected components. Giveni∈N, we denote byAigthe connected component ofN/gto which i belongs to.A cycle ing is a path in g between i and i different from ii. A forest is a network without cycles. A tree is a forest in which each pair of nodes are connected.If g is a forest thenN/gcould have several elements. If g is a tree thenN/g=N. Given a tree t andij∈t,N/t⧹ijhas two connected components. We denote byAiijrespectivelyAjijthe component to which irespectivelyjbelongs to.A cost function is a mappingc:N×N→R+wherecijis the cost associated to link ij.We assume that the cost of connecting agent i with itself is null,c(ii)=0for eachi∈N; and connecting i with j is as costly as connecting j with i, this is,c(ij)=c(ji)for each{i,j}⊆N. For each network t, abusing the notation we denote byc(t)the cost of all links int,c(t)=∑l∈tc(l).Let1lbe the cost function such that1ll′=1ifl′=land1ll′=0otherwise.A problem is defined bya=(N,t,c,p,d)where N is the set of nodes, t is a forest, c is a cost function,p=pii∈N∈R+Nwherepidenotes the production capacity of node i, andd=dii∈N∈R+Nwheredidenotes the demand of node i. LetAdenote the set of all problems.The following situation is proposed. A set of agents have a demand for a good, for example water, given by d. They also have a capacity production given by p. In general, agents have enough capacity for producing all their own demand. Nevertheless, in some circumstances, it could happen that there is not enough production to cover its demand (for instance the production fails). When this happens, agents can receive water from other agents through t. Thus, we can think on t as a network that allows agents to obtain water when their production fails. But t has associated a cost (construction, maintenance, use, etc.) which should be paid by agents.GivenS⊂NletaSdenote the restriction of a to S. Namely,aS=(S,tS,cS,pii∈S,dii∈S)wherecSis the restriction of c to S(cS(ij)=c(ij)for all{i,j}⊂S). When no confusion arises we use c instead ofcS.A rule is a functionR:A→⋃N∈URNsuch that for each problema∈Aselects one and only one allocationR(a)∈RNsatisfying:R1∑i∈NRi(a)=c(t).Given a connected componentS∈N/tandi∈S,Ri(a)=Ri(aS).R1 means that the cost of t should be paid by all agents.R2 means that there are no externalities among different connected components, that is, the amount that each agent has to pay depends only on the situation inside the connected componentN/tto which the agent belongs to.By R2 we can restrict to problemsa=(N,t,c,p,d)where t is a tree.Now, we present some examples of rules. The first one, the half–half rule, simply says that the cost of each link is equally split between agents on its extremes.Half–half rule, HH. For eacha∈Aand eachi∈N,HHi(a)=∑ij∈tc(ij)2.The following two rules divide the cost proportionally either by demand or by production, with the proviso that, when we consider the demand, agents who demand more also contribute more, while when we consider the production, agents who produce more contribute less.p-proportional rule,Pp. For eacha∈Aand eachi∈N,Pip(a)=1pi∑j∈N1pjc(t).d-proportional rule,Pd. For eacha∈Aand eachi∈N,Pid(a)=di∑j∈Ndjc(t).Example 2.1Consider a quite simple situation with only two nodesN={1,2}and a link between them whose cost isc(12)=3. The production and demand are given byp=(3,6)andd=(3,1). In case of failure of the production of agent 1, the production of agent 2 is enough to cover the demand of both 1 and 2. On the contrary, if the production of agent 2 fails, the production of agent 1 is not enough to cover the demand of agent 2 (assuming that agent 1 has to cover his demand). Thus, it seems reasonable that only agent 1 pays the cost of the link. According to the previous rules, the cost is distributed as follows:HH(a)=32,32,Pp(a)=(2,1),Pp(a)=94,34.In all the three rules, agent 2 has to contribute to the construction of the link; however, this agent gets no profit from the existence of the connection. Later on we will introduce two rules that avoid this shortcoming.We end this section by presenting a real situation that could be modeled as one of our problems.Example 2.2In Spain there are some canals for transferring water from rainy areas to arid areas. We focus in the Tagus–Segura transfer. The information used in this example was obtained through the web page of “Ministerio de Agricultura, Alimentación y Medio Ambiente”, http://www.chsegura.es/chs_en/cuenca/resumendedatosbasicos/recursoshidricos/trasvaseTajoSegura.html which is the office of the Government of Spain devoted to this issue.Typically, the Tagus is a river with many water, which means that the people living around this river have all the water they need. Nevertheless, Jucar and Segura rivers, typically, have not enough water for covering the needs of peel living around them. Thus, the government of Spain constructed some canals for transferring water from Tagus to Jucar and Segura (it is called aqueduct). The government also constructed canals for transferring water from Jucar to some areas and from Segura to some other areas (they are called distribution canals). Let us explain how the system works. The source is Bolarque reservoir, located in Tagus river. From this reservoir the water is pumped to the Alarcón reservoir located in the Jucar river through the aqueduct. From Alarcón Reservoir the water flows in three ways. First, through Jucar rivers until the customers. Secondly, through a distribution canal until some other customers. Third, it is pumped through the aqueduct until Talave reservoir, in the Segura river basin. From Talave reservoir the water flows in three ways. First, through Segura rivers until the customers. Secondly, through the south distribution canal until some other customers. Third, through the north distribution canal until some other customers. Notice that the way in which the water flows from Bolarque reservoir until the customer can be modeled as a tree.According with the Spanish regulation the tariffs for using the water that comes from Tagus river must consider the construction costs of the aqueduct and the distribution canals and the maintenance costs of such infrastructures. This part of the tariff is decided by the government. The last update was in March 7th, 2012. The government propose several kind of tariffs, depending on the canals needed for providing the service to the users. For each one of these tariffs, it is also considered if the water is used for domestic use or for irrigation.We model this situation asa=(N,t,c,p,d)where•N={1,2,3,4,5,6,7,8,9}represents the following. 1 will be the Bolarque reservoir, namely, the customers obtaining water directly from this reservoir. 2 will be the Alarcón reservoir, namely, the customers obtaining water directly from this reservoir. With 3 we represent the set of customers obtaining the water directly from the Jucar river basin after Alarcón reservoir. With 4 we represent the set of customers obtaining water from the distribution canal starting at Alarcó n reservoir. 5 will be the Talave reservoir, namely, the customers obtaining water directly from this reservoir. With 6 we represent the set of customers obtaining water from the south distribution canal starting at Talave reservoir. With 7 we represent the set of customers obtaining the water directly from Segura river basin after Talave reservoir. The north distribution canal is relatively long. Thus we have divided it in two parts. With 8 we represent the set of costumers obtaining water form the north distribution canal between Talave reservoir and Pedrera reservoir. With 9 we represent the set of costumers obtaining water from the north distribution canal between Pedrera reservoir and the end of the canal (see Fig. 1).t={(1,2),(2,3),(2,4),(2,5),(5,6),(5,7),(5,8),(8,9)}. It is represented through the figure.c=(c(i,j))(i,j)∈t. Of coursec(2,3)=c(5,7)=0because these links corresponds to the rivers Jucar and Segura. The other costs are positive and must represent, for the period of time where the tariff is applied, the part of the construction costs customer should pay during this period and the maintenance cost of the period of the infrastructure representing such link. For instance,c(1,2)represents the aqueduct between Bolarque reservoir and Alarcón reservoir. Unfortunately, this information is not public. Thus, our computations will depend on c.p=(pi)i∈Nwherepiis the amount of water that agent i could produce (rivers Jucar and Segura, underground water, etc,). Besides,d=(di)i∈Nwherediis the amount of water demanded by agent i.This information is known in an aggregate way, namely, the government has estimated, for the next years, the following amounts. For Jucar river basin and Segura river basin, the amount of water will have using their own resources,∑i∈N⧹{1}pi, and the amount of water they will need,∑i∈N⧹{1}di. Unfortunately,∑i∈N⧹{1}pi<∑i∈N⧹{1}di. Implicitly, it is assumed thatpi<difor alli∈N⧹{1}.Nevertheless, it is possible to send water from Tagus river to Jucar and Segura rivers without damaging customers in Tagus river basin, namely,p1-d1>∑i∈N⧹{1}di-∑i∈N⧹{1}pi.A ruleR=(Ri)i∈Nsays how to divide the cost of the tree among the different nodes. In our case how to divide the construction and the maintenance cost of the transfer infrastructures among the nodes. Since each node represents a set of customers, the cost assigned to each node should be divided among their customers. A reasonable way for doing it is that each customer l associated to node i should pay in proportion to the water he consumes, namely customer l will payRididlwheredlrepresents the amount of water used by consumer l.A couple of comments. First, even the demand of each nodedidoes not appear in the web, this information is known by the government. Second, we have not distinguished between the water used for domestic use and for irrigation, as the government did. If we want to do it we proceeds as follows. For each nodei∈N, letdidomanddiirrbe the demands of water for domestic use and irrigation respectively (obviously,di=didom+diirr). Letwi∈R+denote the parameter measuring the price relative between the domestic use and the irrigation use. Namely, the tariff of eachm3of water devoted to irrigation iswitimes the tariff of eachm3devoted to domestic use. Thus, the tariff of eachm3of water for domestic use in node i will beRididom+widiirrwhereas the tariff of eachm3of water devoted to irrigation will bewiRididom+widiirr.In this section we introduce several properties that rules may satisfy. Most of them will be used later in the axiomatic characterizations.The first property refers to a very simple situation. Suppose that there are only two agents and one link between them. Assume that the link is only profitable for one agent, then this agent pays the whole cost of the link. If the link is profitable for both or neither (recall that we are assuming that t is given), the cost of the link is equally divided between both agents.For eacha∈Asuch thatN={i,j}andt=ij,Ri(N,t,c,p,d)=0ifpi⩾di+djandpj<di+djc(t)ifpi<di+djandpj⩾di+djc(t)2otherwise.In our model the link is profitable for agent i when, in case of failure of his production, agent j can produce enough amount of the good to fulfill the demand for both. Thus, whenpi<di+djandpj⩾di+dj, the link ij is only profitable for agent i. Similarly, whenpi⩾di+djandpj<di+djthe link ij is only profitable for agent j.Remark 3.1The definition of fairness for two agents is given under the assumption that agents produce enough good (namelypi⩾difor alli) and they will receive the good only when their production fails. We can give this definition assuming that agents can produce less than their demand and receive the good from agents producing more than their demand. In this case the property of fairness for two agents should be rewritten asRi(N,t,c,p,d)=0ifpj<djandpi-di⩾dj-pjc(t)ifpi<diandpj-dj⩾di-pic(t)2otherwise.It is not difficult to check that all our results can be adapted to this definition of fairness for two agents.Leta∈A,kh∈tandi∈Akkhand assume that the cost of kh increases by x. Link kh is important for agent i because kh allows agent i to use the aggregate capacity production of componentAhkh. Thus, the extra amount that agent i should pay does not depend on the rest of the costs of the links of t, neither on the structure of the componentAhkhwhen the aggregate demand and production in such component remains the same.Given a tree t andkh∈tsuch that h is an ending node in t (an ending node is a node that belongs to a unique link), we say thatt∗is a h-continuation oft ift∗=t∪t′wheret′is a tree andt∩t′=h.We now define the property formally.Let t be a tree such thatkh∈t, and lett1,t2be two h-continuations of t such that∑i∈N(t1⧹t)pi=∑i∈N(t2⧹t)piand∑i∈N(t1⧹t)di=∑i∈N(t2⧹t)di. Then for all cost functionsc1andc2, and alli∈Nt⧹h,Ri(N(t1),t1,c1+x1kh,(pi)i∈N(t1),(di)i∈N(t1))-Ri(N(t1),t1,c1,(pi)i∈N(t1),(di)i∈N(t1))=Ri(N(t2),t2,c2+x1kh,(pi)i∈N(t2),(di)i∈N(t2))-Ri(N(t2),t2,c2,(pi)i∈N(t2),(di)i∈N(t2)).In our model agents produce and demand a good. They can send and receive the good through the tree t. Thus we can consider that agents i and j are symmetric if both have the same production, both have the same demand, and for any other agent k the cost of sending (or receiving) the good from i to k is the same as from j to k. Symmetry simply says that symmetric agents should pay the same.Formally, we say that i and j are symmetric if three conditions hold:1.pi=pj.di=dj.For eachk∈N⧹{i,j}, letgikandgjkdenote the unique path (or the empty set if agents are in a different connected component ofN/t) in t from i to k and from j to k respectively. Then,c(gik)=c(gjk).For each problema∈Aand each pair of symmetric agentsi,j∈Nwe have thatRi(a)=Rj(a).Leta=(N,t,c,p,d)anda′=(N,t,c,p′,d′)such thatij∈tandcij=0. For each agentk∈N⧹{i,j}agents i and j can get the productionpkof node k at the same cost in a anda′. Besides they can getpi+pjin both problems at cost 0. Suppose that i and j reallocate between themselves their aggregate demand and production. Then, this reallocation of demand and production does not affect to the amount that each of those agents have to pay.For eacha=(N,t,c,p,d)∈Aanda′=(N,t,c,p′,d′)∈Asuch thatij∈t,c(ij)=0,pi+pj=pi′+pj′,di+dj=di′+dj′,pk=pk′anddk=dk′for eachk∈N⧹{i,j}, we have thatRi(N,t,c,p,d)=Ri(N,t,c,p′,d′)andRj(N,t,c,p,d)=Rj(N,t,c,p′,d′).The property of additivity on the cost function is quite standard in the literature.For each(N,t,c,p,d)∈Aand(N,t,c′,p,d)∈Awe have thatR(N,t,c+c′,p,d)=R(N,t,c,p,d)+R(N,t,c′,p,d).Givena=(N,t,c,p,d)andi∈Nwe say that i is safe in a if when the production of agent i fails, then the other agents can fulfill the demand of agent i. Namely, sinceAitdenotes the connected component ofN/tto which i belongs to, thendi⩽∑j∈Ait(pj-dj).We denote byS(a)the set of agents who are safe in a.The removal of link l from the tree t may change the safety of some agents. Those agents can be classified into two categories: agents whose status changes and agents whose status does not. The first category is formed by the agents that are safe in t but not int⧹l. Thus, the first category contains agents that need link l. The second category is formed by agents that are safe in t and int⧹l, as well as the agents that are not safe in t (which also remain not safe int⧹l). Thus, the second category contains the agents that do not need link l, because they continue to be safe after removing it or because they are never safe. The next property says that if the cost of link l increases, all agents needing link l should be affected in the same way, and all agents that do not need link l should be affected also in the same way.Given a problema=(N,t,c,p,d)we denote bya⧹lthe problem where we have removed link l from t. Namely,a⧹l=(N,t⧹l,c,p,d).For each(N,t,c,p,d)∈A, eachl∈t, and eachi,j∈Nsuch thati,j∈S(a)∩(N⧹S(a⧹l)), ori,j∈N⧹(S(a)∩(N⧹S(a⧹l))), we have that:Ri(N,t,c+x1l,p,d)-Ri(N,t,c,p,d)=Rj(N,t,c+x1l,p,d)-Rj(N,t,c,p,d).For each problema=(N,t,c,p,d)and for each coalition (subset of agents)M⊂N, the stand alone cost of M (denoted byva(M)) is the cost of the cheapest subtree of t that keeps safe all the agents that were already safe in t. WhenM=Nwe simply defineva(N)as the cost of t. Formally,va(M)=mint′⊂t{c(t′):i∈S(N,t′,c,p,d)∀i∈M∩S(a)}ifM⊊Nc(t)ifM=N.Notice that for eachM⊊N,va(M)=va(M∩S(a)). The next example illustrates how to constructva.Example 3.1Let us consider the problema=(N,t,c,p,d)∈Awhere:N={1,2,3},t={12,23},c(12)=10,c(23)=6,p=(4,6,20),andd=(2,2,19).Thus,S(a)={1,2}. The subsets of t that make safe agent 1 are{12}and{12,23}. Thus,va(1)=c(12)=10. No subset of t can make agent 3 safe. Thus,va(3)=0. Analogously,va(2)=va(1,2)=va(1,3)=va(2,3)=10. By definitionva(N)=16.If we takea′=(N,t,c,p′,d′)wherep′=(6,6,6)andd′=(2,2,2)we have thatS(a′)=N,va′(1)=10,va′(2)=6,va′(3)=6,va′(1,2)=10,va′(1,3)=16,va′(2,3)=6, andva′(N)=16.The core is a well-known concept and it is defined as:core(a)=x∈RN:∑i∈Nxi=va(N)and∑i∈Mxi⩽va(M)∀M⊊N.In Example 3.1, the core of a is empty, whereas fora′it is not (for instance,(10,6,0)∈core(a′)).The next property requires that, when the core is non-empty, the rule selects an allocation within it.For eacha∈Asuch thatcore(a)≠∅, we have thatR(a)∈core(a).The non-emptiness of the core is related to the existence of irrelevant links. Given a problem a and a linkl∈t, assume that the set of safe agents is the same in a as ina⧹l(namelyS(a)=S(a⧹l)). Thus, we can consider that link l is irrelevant because deleting l no agent is damaged. Next proposition states that the core is non-empty if and only if the cost of all irrelevant links is cero.Proposition 3.1For each problem a we have thatcore(a)≠∅if and only if∑l∈t:S(a)=S(a⧹l)c(l)=0.We first prove that ifcore(a)≠∅, then∑l:S(a)=S(a⧹l)c(l)=0. Suppose not. Then, there existsl=jk∈tsuch thatS(a)=S(a⧹l)andc(l)>0. LetN/(t⧹l)=Ajjk,Akjk. It is obvious thatAjjk≠∅andAkjk≠∅. Lettj=(t⧹l)Ajjkandtk=(t⧹l)Akjk. SinceS(a)=S(a⧹l), we have that ifi∈Ajjk∩S(a)(respectivelyi∈Akjk∩S(a)) theni∈S(N,tj,c,p,d)(respectivelyi∈S(N,tk,c,p,d)). Thus,vaAjjk⩽c(tj)andvaAkjk⩽c(tk).Letx=(xi)i∈N∈core(a). Then,∑i∈Ajjkxi⩽va(Ajjk)and∑i∈Akjkxi⩽va(Akjk). Sinceva(N)=c(t)andc(l)>0we have thatc(t)=c(t⧹l)+c(l)>c(t⧹l)=c(tj)+c(tk)⩾vaAjjk+vaAkjk⩾∑i∈Ajjkxi+∑i∈Akjkxi=∑i∈Nxi=c(t),which is a contradiction.We now prove that if∑l∈t:S(a)=S(a⧹l)c(l)=0, thencore(a)≠∅. For eachl∈tsuch thatS(a)≠S(a⧹l)we associate an agentil∈Nsatisfying thatil∈S(a)butil∉S(a⧹l). Givenl∈tsuch thatS(a)=S(a⧹l)we takeil∈Narbitrarily. We define the allocation x in which each agenti∈Npays the cost of the links associated to him. Namely, for eachi∈N,xi=∑l∈t:il=ic(l). If no linkl∈tsatisfies thatil=iwe takexi=0.We now prove thatx∈core(a). Obviously,∑i∈Nxi=c(t). LetM⊊N. Assume thatva(M)=c(t′). Hence,i∈S(N,t′,c,p,d)for alli∈M∩S(a). Leti∈M∩S(a)andl∈tsuch thatil=iandc(l)>0. Thus,l∈t′(otherwise we will have a contradiction because i is not safe int⧹lbut i is safe int′⊂t⧹l). Hence⋃i∈M∩S(a)⋃l∈t:il=i,c(l)>0l⊂t′, which implies that∑i∈Mxi⩽c(t′)=v(M).□Finally, we introduce three monotonicity properties: over the cost, the production, and the demand.Cost monotonicity says that if the cost of some link increases, no agent can pay less.For eacha=(N,t,c,p,d)anda′=(N,t,c′,p,d)such thatc′(ij)⩾c(ij)for allij∈t, thenR(a′)⩾R(a).Assume that the production of some agent increases and the rest of the problem remains the same. Thus, this agent cannot pay more.For eacha=(N,t,c,p,d)anda′=(N,t,c,p′,d)such thatpi′>pifor somei∈Nandpj′=pjfor allj∈N⧹{i}, we have thatRi(a′)⩽Ri(a).Assume that the demand of some agent increases and the rest of the problem remains the same. Thus, this agent cannot pay less.For eacha=(N,t,c,p,d)anda′=(N,t,c,p,d′)such thatdi′<difor somei∈Nanddj′=djfor allj∈N⧹{i}, we have thatRi(a′)⩽Ri(a).In this section we introduce the equal division across components rule (EC, for short). We also provide an axiomatic characterization of this rule by mean of fairness for two agents, network-cost independence of extra costs, symmetry, and independence reallocation.A very intuitive procedure to share the cost of the whole treec(t)is to do it link by link, that is, we choose a linkl∈L(t)and we divide its costc(l)among all the agents in N. We clarify this idea in the example below.Example 4.1In the following problem we explain how to allocate the costc(12).Notice that the link 12 divides the tree into two components. As a first step, we collapse each component in a virtual node, whose demand and production are the sum of the demands and productions of the agents that it contains.As result, we get a simple tree with only two nodes and one link. Now, in application of fairness for two agents,x(1)=0andx({2,3,4})=2are the contribution of 1 and the coalition{2,3,4}to the payment of link 12, respectively. It only remains to equally dividex({2,3,4})among{2,3,4}. Therefore, the share ofc(12)is 0 for 1 and23for 2, 3, and 4. Obviously, this procedure can be apply to any other link.More generally, the EC rule is based on the following reasoning (which we formally state below). For a problema=(N,t,c,p,d)let us consider a linkl∈L(t). Since t is a tree, l divides the tree in two connected components. The cost ofl,c(l), is divided among the components following the idea of fairness for two agents, but applied to each component. We compute the aggregate production and demand of both components. If the link is profitable for only one component, then this component pays the cost. If the link is profitable for both or nobody, then each component pays half of the cost. Once this is done, the payment of each component is equally allocated among the agents belonging to it. We apply the same reasoning to all the links and the contribution of an agent is the sum of his contributions in the removal of all possible links.Formally, leta=(N,t,c,p,d)∈Aand letij∈t, we define the aggregate production in each of the two connected components (AiijandAjij) asp(Aiij)=∑k∈Aiijpkandp(Ajij)=∑k∈Ajijpk.Similarly, the aggregate demand inAiijandAjijared(Aiij)=∑k∈Aiijdkandd(Ajij)=∑k∈Ajijdk.Now, let(1)xAiij=0ifpAiij⩾dAjij+dAiijandpAjij<dAiij+dAjijc(ij)ifpAiij<dAjij+dAiijandpAjij⩾dAiij+dAjijc(ij)2otherwise.Notice thatx(Aiij)is computed by applying the ideas of fairness for two agents to a problem where each connected componentAiijandAjijis considered as a single agent.For eacha∈Aand eachi∈N,ECi(a)=∑jk∈t,i∈AjjkxAjjkAjjk.The EC rule can be computed in polynomial time. We need to compute for each link(i,j)in the tree the following elements:Aiij,Ajij,pAiij,pAjij,dAiij,dAjij,xAiijandxAjij. Since all of them can be computed in polynomial time, the EC rule can be computed in polynomial time.We now compute EC in an example.Example 4.2Leta∈Abe a problem where:N={1,2,3,4},t=12,23,24,c(12)=6,c(23)=2,c(24)=2,p=(10,5,1,8),andd=(3,4,1,1).Next table shows the allotment of the cost of each link among the agents:i⧹l1223241300210031204102Therefore,EC(a)=(3,1,3,3).In the proposition below we examine which properties the EC rule fulfills.Proposition 4.1The EC rule satisfies fairness for two agents, network-cost independence of extra costs, symmetry, independence reallocation, cost additivity, cost monotonicity, production monotonicity, and demand monotonicity. The EC rule does not satisfy stand alone core and balanced contributions with respect to the safe status.The EC rule satisfies fairness for two agents. It is obvious from the definition.The EC rule satisfies network-cost independence of extra cost. Let t be a tree such thatkh∈t, and lett1,t2be two h -continuations of t such that∑i∈N(t1⧹t)pi-∑i∈N(t1⧹t)di=∑i∈N(t2⧹t)pi-∑i∈N(t2⧹t)di. Letc1andc2be two cost functions, and leti∈N(t)⧹h. We denotep1=(pj)j∈N(t1),p2=(pj)j∈N(t2),d1=(dj)j∈N(t1), andd2=(dj)j∈N(t2).Ri(N(t1),t1,c1+y1kh,p1,d1)-Ri(N(t1),t1,c1,p1,d1)=∑jm∈t1i∈Ajjmxc1+y1kh(Ajjm)|Ajjm|-∑jm∈t1i∈Ajjmxc1(Ajjm)|Ajjm|=∑jm∈t1⧹khi∈Ajjmxc1+y1kh(Ajjm)|Ajjm|-xc1(Ajjm)|Ajjm|+xc1+y1kh(Akkh)|Akkh|-xc1(Akkh)|Akkh|.Notice thatxc1+y1kh(Ajjm)=xc1(Ajjm)for alljm∈t1⧹kh, since they do not depend on the cost of the link kh. Then, the expression above is simplified toRi(N(t1),t1,c1+y1kh,p1,d1)-Ri(N(t1),t1,c1,p1,d1)=1|Akkh|xc1+y1khAkkh-xc1Akkh.Similarly, we can obtain thatRi(N(t2),t2,c2+y1kh,p2,d2)-Ri(N(t2),t2,c2,p2,d2)=1|A‾kkh|xc2+y1khA‾kkh-xc2A‾kkh,whereA‾kkhcorresponds to the component induced byt2that contains agent i. Now,Akkh=A‾kkhbecausei∈N(t)⧹k.Since∑i∈N(t1⧹t)pi=∑i∈N(t2⧹t)piand∑i∈N(t1⧹t)di=∑i∈N(t2⧹t)diwe deduce thatxc1+y1kh(Akkh)-xc1(Akkh)=xc2+y1kh(A‾kkh)-xc2(A‾kkh).Therefore, EC satisfies network-cost independence of extra cost.The EC rule satisfies symmetry. Leta∈Aand leti,j∈Nbe two symmetric agents in a. Indeed, letl1,l2,…,ls-1,lsbe the links of the unique path from i to j in t. We distinguish two cases:1.One of the agents is not an ending node. Without loss of generality assume that j is not an ending node. Then, there existsk∈N⧹{i,j}such thatjk∈tandjk≠ls. Thus,gik(the unique path in t form i tok) is{l1,…,ls,jk}andgjk=jk. Since i and j are symmetric,c(gik)=c(gjk). Hencec(lr)=0for allr=1,…,s. Now, letkh∈t. There are two possibilities. (i) kh is in the path between i and j. Sincec(kh)=0,x(Akkh)=x(Ahkh)=0. Then, i and j pay nothing in this link. (ii) kh is not in the path between i and j. Thus, i and j are in the same component, let sayAkkh. By the definition of the EC rule, in such a case both agents contribute with the same amount to the payment of the cost of link kh. Therefore,ECi(a)=ECj(a).Both agents are ending nodes. Since i and j are symmetric,c(gik)=c(gjk)for all node k. Applying it to the agents in the path form i to j we have thatc(l1)+c(l2)+⋯+c(ls-1)=c(ls)c(l1)+c(l2)+⋯=c(ls-1)+c(ls)⋮c(l1)=c(l2)+⋯+c(ls-1)+c(ls)Thus,c(l1)=c(ls)andc(l2)=…=(ls-1)=0. We consider two cases.(a)s=1. ThusN={i,j}and henceECi(a)=ECj(a)=cij2.s⩾2. Letkh∈t. Assume that kh is not in the path between i and j. Thus, i and j are in the same component, let sayAkkh. By the definition of the EC rule, in such a case both agents contribute with the same amount to the payment of the cost of link kh.Assume that kh is in the path between i andj,kh≠l1andkh≠ls. Sincec(kh)=0,x(Akkh)=x(Ahkh)=0. Then i and j pay nothing in this link.We now considerl1andls. Notice thatAil1={i}andAjls={j}andc(l1)=c(ls). Since i and j are symmetric,x(Ail1)=x(Ajls). Thus, the amount paid by agent i in linkl1coincides with the amount paid by agent j in linkls. Leti′andj′be such thatl1=ii′andls=jj′. Notice thatAi′l1=N⧹{i}andAj′ls=N⧹{j}. Since i and j are symmetricxAi′l1=xAj′ls. Then, the amount paid by agent i in linklscoincides with the amount paid by agent j in linkl1.Now, it is obvious thatECi(a)=ECj(a).The EC rule satisfies independence reallocation. Leta=(N,t,c,p,d)anda′=(N,t,c,p′,d′)be such thatij∈t,c(ij)=0,pi+pj=pi′+pj′,di+dj=di′+dj′,pk=pk′anddk=dk′for allk∈N⧹{i,j}. Letkh∈t. There are two possibilities.1.kh≠ij. In this case both agents i and j belong to the same component. Thus, they contribute the same towards the payment of link kh. Notice as well that the overall payment of such a component does not change from a toa′.kh=ij. Since by assumptionc(ij)=0, agents i and j pays nothing in this link.Therefore,ECi(a)=ECi(a′)andECj(a)=ECj(a′).The EC rule satisfies cost additivity. It is obvious from the definition.The EC rule trivially satisfies cost monotonicity, production monotonicity and demand monotonicity sinceAiijonly depends on t andx(Aiij)is monotonic (in the sense of the definition) with respect to the cost, the production, and the demand.The EC rule does not satisfy stand alone core. In Example 4.2EC3(a)=3>2=va(3). Since link 12 is relevant for agent 1, link 23 is relevant for agent 3 and link 24 is relevant for agent 4, by Proposition 3.1 we deduce thatcore(a)≠∅.The EC rule does not satisfy balanced contributions with respect to the safe status. Let a be as in Example 4.2,l=12andx=6. We have that 1 and 4 belong toS(a)∩(N⧹S(a⧹l)). Nevertheless,EC1(N,t,c+61l,p,d)-EC1(N,t,c,p,d)=6-3=3andEC4(N,t,c+61l,p,d)-EC4(N,t,c,p,d)=4-3=1.□The next result gives a characterization of the EC rule.Theorem 4.1EC is the unique rule satisfying fairness for two agents, network-cost independence of extra costs, symmetry, and independence reallocation.By Proposition 4.1 we know that the EC rule satisfies these properties. We now prove the uniqueness.Given a tree t andij∈t, we define two trees that will become useful later on.•ti: Roughly, it consists in collapsing the whole componentAiijinto a single node (that for convenience we also call i), keeping the rest of the tree t unaltered. Hence,N(ti)=Ajij∪{i}andL(ti)={kh∈L(t):h,k∈Ajij}∪ij.tij: we collapse both components. That is,N(tij)={i,j}andL(tij)=ij.Leta=(N,t,c,p,d)be a problem where the cost of all the links but one are equal to zero; that is, there is a link ij such thatc(ij)>0andc(l)=0∀l∈t⧹ij. We define the following problems.•ai=(Ajij∪{i},ti,ci,pi,di)is the problem in which we have collapsed the componentAii,jinto a single node i and we have attributed to i the aggregate production and demand ofAiij. Namely,tiis the tree described above,ci=cN(ti),pii=∑k∈Aiijpk,pki=pkfor allk∈N(ti)⧹{i},dii=∑k∈Aiijdk, anddki=dkfor allk∈N(ti)⧹{i}.aij=({i,j},tij,cij,pij,dij)is obtained when we collapse both componentsAiijandAjijwith their respective aggregated demand and productions into two nodes i and j. Namelytijis the tree described above,cij(ij)=c(ij),piij=∑k∈Aiijpk,pjij=∑k∈Ajijpk,diij=∑k∈Aiijdk, anddjij=∑k∈Ajijdk.Notice that bothtiandtijare j-continuations of{i}.2Givenk∈N,{k}denotes the tree that has a single node k.2By network-cost independence of extra costs,Ri(aij)-Ri({i,j},tij,0,pij,dij)=Ri(ai)-Ri(Ajij∪{i},ti,0,pi,di).Leta=(N,t,c,p,d)such thatc(kh)=0for allkh∈t. Leta′=N,t,c,p′,d′be such that for allk∈N,pk′=∑h∈Nphn, anddk′=∑h∈Ndhn. By Independence reallocationRa=Ra′. Since all agents are symmetric ina′, by symmetry,Rk(a′)=Rh(a)for allk,h∈N. Sincec(t)=0we deduce thatRk(a′)=0for allk∈N. Hence,Rk(a)=0for allk∈N.Thus,Ri({i,j},tij,0,pij,dij)=Ri(Ajij∪{i},ti,0,pi,di)=0; and thereforeRi(aij)=Ri(ai).On the other hand, we know that∑k∈AjijRk(ai)=c(ij)-Ri(ai)=c(ij)-Ri(aij).Now, since t andtiarei-continuations oftAjij, by applying again network-cost independence of extra costs, we have that for allk∈AjijRk(a)-Rk(N,t,0,p,d)=Rk(ai)-Rk(Ajij∪{i},ti,0,pi,di).Since for allk∈Ajij,Rk(N,t,0,p,d)=Rk(Ajij∪{i},ti,0,pi,di)=0, we deduce that for allk∈Ajij,Rk(a)=Rk(ai).Therefore,(2)∑k∈AjijRk(a)=∑k∈AjijRk(ai)=c(ij)-Ri(ai)=c(ij)-Ri(aij)and(3)∑k∈AiijRk(a)=c(ij)-∑k∈AjijRk(a)=Ri(aij).By applying fairness for two agents to the problemaij, we know that(4)∑k∈AiijRk(a)=0ifpiij⩾djij+diijandpjij<diij+djijcijifpiij<djij+diijandpjij⩾diij+djijcij2otherwiseLetp′andd′are such that for allk∈Aiijpk′=∑k∈AiijpkAiij,anddk′=∑k∈AiijdkAiij.By independence reallocation,Rk(a)=Rk(N,t,c,p′,d′),Now, notice that all agents inAiijare symmetric. Hence, by symmetry,Rh(N,t,c,p′,d′)=Rk(N,t,c,p′,d′)for allh,k∈Aiij. Combining this fact with Eq. (4) we get that for eachk∈Aiij(5)Rk(a)=0ifpiij⩾djij+diijandpjij<diij+djijcij|Aiij|ifpiij<djij+diijandpjij⩾diij+djijcij2|Aiij|otherwiseBy applying an analogous argument we obtain that for eachk∈Ajij(6)Rk(a)=c(ij)|Ajij|ifpiij⩾djij+diijandpjij<diij+djij0ifpiij<djij+diijandpjij⩾diij+djijc(ij)2|Ajij|otherwise.Leta∈Abe a general problem (with no restriction on the cost function). We prove uniqueness by using an induction argument over the number of links in t with cost different from 0. Lett={i1j1,…,in-1jn-1}. We assume without loss of generality thatc(ikjk)>0for allk=0,…,θandc(ikjk)=0for allk=θ+1,…,n-1. We use an induction argument overθ. Ifθ⩽1we have proved that R is unique. Assume that R is unique whenθ<αand we prove it whenθ=α.Leta=(N,t,c,p,d)be such thatθ=α. Leti∈Aiαiαjα(the casei∈Ajαiαjαis similar and we omit it). By network-cost independence of extra costs we have thatRi(N,t,c,p,d)-Ri(N,t,c-c(iαjα)1iαjα,p,d)=Ri(N,t,c(iαjα)1iαjα,p,d)-Ri(N,t,0,p,d).By induction hypothesisRi(N,t,c-c(iαjα)1iαjα,p,d),Ri(N,t,c(iαjα)1iαjα,p,d), andRi(N,t,0,p,d)are unique. Thus,Ri(N,t,c,p,d)is unique.□Notice that the proof of the result has a constructive structure, which has several advantages. Firstly, it helps to understand the effect of each single property. Secondly, it illustrates the family of rules that would emerge if we get rid of some of the properties.As the following collection of rules shows, the properties in Theorem 4.1 are independent.1.The following rule satisfies network-cost independence of extra costs, symmetry, and independence reallocation, but violates fairness for two agents. For eacha∈Aand eachi∈N:Ri(a)=∑jk∈t,i∈Ajjkcjk2Ajjk.The following rule satisfies fairness for two agents, symmetry, and independence reallocation, but violates network-cost independence of extra costs. IfN={i,j}we compute R following fairness for two agents. If|N|⩾3then, for eachk∈NRk(a)=c(t)|N|.The following rule satisfies fairness for two agents, network-cost independence of extra costs, and symmetry, but violates independence reallocation. For eacha∈A, letx(Aiij)be the overall quantity paid by the componentAiijas it is defined in Eq. (1). Letpmax(Aiij)=maxk∈Aiijpkbe the maximum production withinAiij. LetNmax(Aiij)={k∈Aiij:pk=pmax(Aiij)}be the agents that produce such a maximum. For eacha∈Aand eachk∈N:Rk(a)=∑ij∈t,k∈Aiijyk(x(Aiij)),whereykx(Aiij)=x(Aiij)|Nmax(Aiij)|ifk∈Nmax(Aiij)0otherwise.The following rule satisfies fairness for two agents, network-cost independence of extra costs, and independence reallocation, butviolates symmetry. For eachS⊂N, letm(S)be the agent in S with smallest index, namelym(S)=mini:i∈S. For eacha∈Aand eachk∈NRk(a)=∑ij∈t,k=mAiijx(Aiij),wherex(Aiij)is given by Eq. (1).We end this section by computing the EC rule in the Example 2.2.Example 4.3Continuation of Example 2.2We end this section by computing the EC rule in Example 2.2, where we consider the transfer between the rivers Tagus and Segura. Firstly we should note that this example corresponds to the situation described in Remark 3.1. Remember that all nodes have less water than they need but node 1 who can produce enough water for fulfill the extra needs of the other nodes. Letij∈tbe and assume, without loss of generality, that1∈Aiij. Now,x(Aiij)=0andx(Ajij)=cij. Then,c(ij)is equally split divided among the nodes that need the link ij to be connected to node 1 (Bolarque). Hence, node 1 pays nothing, which seems reasonable. Next table shows the allotment of the cost of each link among the nodes (we avoid 23 and 57 because they are rivers and the costs are zero).i⧹l1224255658891218c(12)318c(12418c(12)c(24)518c(12)15c(25)618c(12)15c(25)c(56)718c(12)15c(25)818c(12)15c(25)12c(58)918c(12)15c(25)12c(58)c(89)We now introduce a new rule, called the equal safety rule (ES rule, for short). Our main result is a characterization of this rule in terms of stand alone core, balanced contributions with respect to safe status, and cost additivity.Similarly to the solution we presented in the previous section, the equal safety rule, is based on deciding which is the contribution of each agent to every single link. More specifically, the cost of a link is equally split among all the agents for whom such a link is crucial for their safety. Consider link 12 in Example 4.2. We first note that all agents are safe in t. What happens if we remove link 12? Agent 1 is not safe anymore because he will be isolated from the other agents. Agent 2 is still safe because if his production fails, then he can obtain the good from agent 4 through the link 24. Agent 3 is still safe because if his production fails, then he can obtain the good from agent 2 through the link 23. Agent 4 is still safe because if his production fails, he can obtain the good from agent 2 through the link 24. Thus, the cost of link 12 is paid only by agent 1.Leta=(N,t,c,p,d)be a problem. For eachl∈twe can identify the set of agents needing link l to be safe int,Nl(a). The rest of individualsN⧹Nl(t)keep their status before and after the removal of l. In this case the cost of link l is divided equally among agents inNl(a). Eventually, there may exist some link l that is not necessary for any agent(Nl(a)=∅). However, even in this case, the link has to be paid. In those circumstances, the cost of l is equally divided among all the agents.Now, we introduce the equal safety rule formally. For each linkl∈twe takeNl(a)=S(a)⧹S(a⧹l)whenS(a)⧹S(a⧹l)≠∅andNl=Notherwise.For eacha∈Aand eachi∈N,ESi(a)=∑l:i∈Nl(a)c(l)Nl(a).The ES rule can be computed in polynomial time. We need to compute for each link(i,j)in the tree the following elements:∑l∈N⧹{k}(pl-dl)for eachk∈N,Aiij,Ajij,∑l∈Aiij⧹{k}(pl-dl)for eachk∈Aiij,∑l∈Ajij⧹{k}(pl-dl)for eachk∈AjijandNij(a). Since all of them can be computed in polynomial time, the ES rule can be computed in polynomial time.We now compute ES in Example 4.2. Notice thatS(a)=N,S(a⧹12)={2,3,4},S(a⧹23)={1,2,4}, andS(a⧹24)={2,3}. The table below shows the allotment of the cost of each link among agents:i⧹l1223241601200030204001Therefore,EC(a)=(7,0,2,1).In the proposition below we examine which properties theESrule fulfills.Proposition 5.1TheESrule satisfies fairness for two agents, symmetry, cost additivity, balanced contributions with respect to the safe status, stand alone core, and cost monotonicity.The ES rule does not satisfy network cost independence of extra costs, independence reallocation, production monotonicity, and demand monotonicity.TheESrule satisfies fairness for two agents. It is straightforward.TheESrule satisfies symmetry. Leta∈Aand leti,j∈Nbe two symmetric agents in a. Indeed, letl1,l2,…,ls-1,lsbe the links of the unique path from i to j in t. By the definition of ES it is enough to prove that for eachl∈twithc(l)>0we have that{i,j}⊂Nl(a)or{i,j}∩Nl(a)=∅.We distinguish two cases.1.One of the agents is not an ending node. By using arguments similar to those used when we proved that EC satisfies symmetry, we can prove thatc(lr)=0for allr=1,…,s.Letl∈t⧹{l1,…,ls}. Thus, i and j are in the same component ofN/(t⧹l). Since i and j are symmetric, we have that{i,j}⊂S(a)or{i,j}∩S(a)=∅. Analogously,{i,j}⊂S(a⧹l)or{i,j}∩S(a⧹l)=∅. Therefore,{i,j}⊂Nl(a)or{i,j}∩Nl(a)=∅.Both agents are ending nodes. By using arguments similar to those used when we proved that EC satisfies symmetry, we can prove thatc(l1)=c(ls)andc(l2)=⋯=(ls-1)=0. We consider two cases.(a)s=1. ThusN={i,j}. Since i and j are symmetric,{i,j}⊂Nij(a)or{i,j}∩Nij(a)=∅.s⩾2. Letl∈t⧹{l1,…,ls}. By using arguments similar to those used in Case 1, we can prove that{i,j}⊂Nl(a)or{i,j}∩Nl(a)=∅.We now study the case wherel∈{l1,ls}. Since i and j are symmetric,{i,j}⊂S(a)or{i,j}∩S(a)=∅;i∈S(a⧹ls)if and only ifj∈S(a⧹l1);i∉S(a⧹l1);j∉S(a⧹ls); and for eachk∈N⧹{i,j},k∈S(a⧹l1)if and only ifk∈S(a⧹ls). Thus,i∈Nls(a)if and only ifj∈Nl1(a). Besides,i∈Nl1(a)if and only ifS(a⧹l1)=S(a). Remember that whenS(a⧹l1)=S(a), we have thatNl(a)=N. But ifS(a⧹l1)=S(a)then,S(a⧹ls)=S(a)and hence,j∈Nls(a)=N. Assume thati∈Nls(a)andi∉Nl1(a). Then,j∈Nl1(a)andj∉Nls(a). Now,ESi(a)-ESj(a)=c(ls)Nls(a)-c(l1)Nl1(a).Since for eachk∈N⧹{i,j},k∈S(a⧹l1)if and only ifk∈S(a⧹ls)we deduce thatNls(a)=Nl1(a). Sincec(ls)=c(l1)we deduce thatESi(a)=ESj(a).Two other cases exist. Firstlyi∈Nls(a)andi∈Nl1(a). Secondlyi∉Nls(a)andi∉Nl1(a)(notice thati∉Nls(a)andi∈Nl1(a)is not possible). Both cases are similar to the previous one and we omit it.TheESrule satisfies cost additivity. Leta,a′∈A. It is obvious that for eachl∈t,S(a)=S(a′)=S(a+a′)andS(a⧹l)=S(a′⧹l)=S((a+a′)⧹l). Then,Nl(a)=Nl(a′)=Nl(a+a′)for eachl∈t. Thus,ESsatisfies cost additivity.TheESrule satisfies balanced contributions with respect to the safe status. Leta=(N,t,c,p,d)∈Aandl∈t. Suppose thati,j∈Sa∩N⧹Sa⧹l. Let us denotea′=(N,t,c+x1l,p,d). Thus,ESi(a′)-ESi(a)=∑l′:i∈Nl′(a′)(c+x1l)(l′)Nl′(a′)-∑l′:i∈Nl′(a)c(l′)Nl′(a)andESj(a′)-ESj(a)=∑l′:j∈Nl′(a′)(c+x1l)(l′)Nl′(a′)-∑l′:j∈Nl′(a)c(l′)Nl′(a).It is obvious thatS(a′)=S(a)andS(a′⧹l)=S(a⧹l). Then,Nl′(a′)=Nl′(a)for alll′∈t. Now,ESi(a′)-ESi(a)=xNl(a)andESj(a′)-ESj(a)=xNl(a).Suppose now thati,j∈N⧹(S(a)∩(N⧹S(a⧹l))). Similarly to the previous case we can prove thatESi(a′)-ESi(a)=ESj(a′)-ESj(a).TheESrule satisfies stand alone core. Leta∈Abe such thatcore(a)≠∅. By Proposition 3.1,∑l∈t:S(a)=S(a⧹l)c(l)=0.It is obvious that∑i∈NESi(a)=c(t)=v(N).LetM⊊Nandt′⊂tbe such thatva(M)=c(t′). Thus, giveni∈M∩S(a),i∈S(N(t′),t′,c,p,d). Givenl∈tsuch thati∈S(a)⧹S(a⧹l)suppose thatl∉t′. Hencet′⊂t⧹landi∈S(N,t⧹l,c,p,d), contradicting thati∈S(a)⧹S(a⧹l). Thus,l∈t′. Then,⋃l:i∈S(a)⧹Sa⧹l;i∈M∩Sal⊂t′.Sincec(l)=0whenS(a)=S(a⧹l)we deduce that for eachi∈N,ESi(a)=∑l:i∈S(a)⧹S(a⧹l)c(l)Nl(a).Now, ifi∉S(a), thenESi(a)=0. Hence,∑i∈MESi(a)=∑i∈M∩S(a)ESi(a)=∑i∈M∩S(a)∑l:i∈S(a)⧹S(a⧹l)c(l)Nl(a)⩽∑l:i∈S(a)⧹S(a⧹l);i∈M∩S(a)c(l)⩽c(t′).TheESrule satisfies cost monotonicity. It is obvious from the definition.The ES rule does not satisfy network cost independence of extra costs. Lett={12},kh=12,t1={12,23},t2={12,24,45},N(t1)={1,2,3},N(t2)={1,2,4,5},c1(12)=6,c1(23)=0,c2(12)=6,c2(24)=c2(45)=0,p=(5,10,5,3,2),andd=(1,10,4,3,1).Now,ES2(N(t1),t1,c′+x1kh,(pi)i∈N(t1),(di)i∈N(t1))=6+x2,ES2(N(t1),t1,c′,(pi)i∈N(t1),(di)i∈N(t1))=62,ES2(N(t2),t2,c+x1kh,(pi)i∈N(t2),(di)i∈N(t2))=6+x3,andES2(N(t2),t2,c,(pi)i∈N(t2),(di)i∈N(t2))=63.The ES rule does not satisfy independence reallocation. LetN={1,2,3},t={12,23},c(12)=0,c(23)=6,p=(8,2,4),p1′=4,p2′=6,d=(8,1,3),d1′=4,andd2′=5.Now,ES2(N,t,c,p,d)=6andES2(N,t,c,p′,d′)=63=2.The ES rule does not satisfy production monotonicity. LetN={1,2,3},t={12,23},c(12)=6,c(23)=12,p=(9,9,9),p2′=20,andd=(6,6,6).Now,ES2(N,t,c,p,d)=63+123=6andES2(N,t,c,p′,d)=62+122=9.The ES rule does not satisfy demand monotonicity. LetN={1,2,3},t={12,23},c(12)=6,c(23)=3,p=(10,6,10),d=(8,5,8),andd2′=1.Now,ES2(N,t,c,p,d)=63+33=3andES2(N,t,c,p′,d′)=6+3=9.□The next theorem provides a characterization of the ES rule.Theorem 5.1ES is the unique rule satisfying cost additivity, balanced contributions with respect to the safe status, and stand alone core.By Proposition 5.1 we know that the ES rule satisfies the three properties. Let us show the converse. Let R be a rule fulfilling the three properties.Leta=(N,t,c,p,d)be a problem where the cost of all the links but one are equal to zero; that is, there is a linkl∈tsuch thatc(l)>0andc(l′)=0∀l′∈t⧹l. We first prove that R is uniquely determined on such kind of problems. We distinguish two cases:1.S(a⧹l)=S(a). Thus,S(a)∩(N⧹S(a⧹l))=∅andN⧹(S(a)∩(N⧹S(a⧹l)))=N. By balanced contributions with respect to the safe status we deduce that for alli,j∈N,Ri(a)-Ri(N,t,c-c(l)1l,p,d)=Rj(a)-Rj(N,t,c-c(l)1l,p,d).We have thatv(N,t,c-c(l)1l,p,d)(T)=0for eachT⊂N. By stand alone core,Ri(N,t,c-c(l)1l,p,d)=0for alli∈N. Now it is easy to conclude thatRi(a)=c(l)|N|for alli∈N.S(a⧹l)⊊S(a). By Proposition 3.1 we conclude thatcore(va)≠∅.We first computeva. LetM⊂Nbe a coalition. IfM∩(S(a)⧹S(a⧹l))=∅, then each agent ofM∩S(a)is safe ina⧹l. Thus,va(M)=0. IfM∩(S(a)⧹S(a⧹l))≠∅andi∈M∩(S(a)⧹S(a⧹l))is safe int′⊂t, thenl∈t′and hencec(t′)=c(l). Thus,va(M)=c(l).Leti∈N⧹(S(a)⧹S(a⧹l)). Sinceva(i)=0and R satisfies stand alone core, we deduce thatRi(a)⩽0.We now computeRi(a)wheni∈S(a)⧹S(a⧹l). Obviouslyva(S(a)⧹S(a⧹l))=c(l). By stand alone core∑i∈S(a)⧹S(a⧹l)Ri(a)⩽c(l). Sinceva(N)=c(l)andRi(a)⩽0wheni∈N⧹(S(a)⧹S(a⧹l))we deduce that∑i∈S(a)⧹S(a⧹l)Ri(a)=c(l). By balanced contributions with respect to the safe status we deduce that for alli,j∈S(a)⧹S(a⧹l),Ri(a)-Ri(N,t,c-c(l)1l,p,d)=Rj(a)-Rj(N,t,c-c(l)1l,p,d).As in the previous case we can argue thatRi(N,t,c-c(l)1l,p,d)=0for alli∈N. Thus,Ri(a)=1S(a)⧹S(a⧹l)for alli∈S(a)⧹S(a⧹l).Leta∈Abe a general problem. Thus,c=∑l∈tc(l)1l. By cost additivity,R(a)=∑l∈tR(N,t,c(l)1l,p,d). Since R is uniquely determined for each(N,t,c(l)1l,p,d),Ris uniquely determined for a.□As the following collection of rules shows, the properties used in Theorem 5.1 are independent.1.The following rule satisfies balanced contributions with respect to the safe status and cost additivity, but violates stand alone core. For eacha∈Aand eachi∈N,Ri(a)=c(t)n.The following rule satisfies stand alone core and cost additivity, but violates balanced contributions with respect to the safe status. For eachl∈t, letm(l)=min{i:i∈Nl(a)}. Now for each problem a and eachi∈NRi(a)=∑l:ml=ic(l).The following rule satisfies stand alone core and balanced contributions with respect to the safe status, but violates cost additivity. LetA‾⊂Abe the set of problems whereN={1,2,3},t={12,23},p=(5,2,5), andd=(2,1,2). We define R such that, for each individual:Ri(a)=ESi(a)ifa∈A⧹A‾c12+c23-minc12,c232ifa∈A‾andi∈{1,3}minc12,c23ifa∈A‾andi=2.Now, we compute the ES rule in the Example 2.2.Example 5.1Continuation of Example 2.2Letij∈tbe and assume, without loss of generality, that1∈Aiij. Then,Nij(a)=Ajijand henceNij(a)≠∅for allij∈t. Now it is obvious that, in this particular case, the ES and EC rules coincide.Unfortunately, we cannot compare directly the tariffs obtained with our rules with the ones proposed by the government because for applying our rules we need to know some information which is not available. Nevertheless we can say something. In both tariffs people from Tagus pays nothing and the more infrastructures you need for obtaining water, the more you pay. The main difference is that the government tariffs only considered two cases for costumers located after Talave reservoir: the one who use the south distribution canal and the ones who use the north distribution canal. Our tariffs will consider more cases because we have considered it explicitly when we define the problem.There are other rules that can be applied to divide the cost among agents. A quite natural rule is the Shapley value of the gameva. The study of this rule is out of scope of this paper. Nevertheless, it is noteworthy to mention that the Shapley rule is different to the two rules studied in this paper, shown by the following example.Example 5.2Consider the problema=(N,t,c,p,d)where:N={1,2,3},t={12,23},c(12)=4,c(23)=12,p=(5,2,5),andd=(2,1,2).Thus,EC(a)=42+124,44+124,44+122=(5,4,7),ES(a)=42+122,0+0,42+126=8,0,8,andShapley(N,va)=223,43,223.We can also compare the Shapley value with the equal rules we define by mean of the properties they fulfill. In this sense, the Shapley value satisfies fairness for two agents and symmetry; but it violates network-cost independence of extra costs, independence reallocation, cost additivity, balanced contributions with respect to the safe status, and stand alone core.In this paper we study how to allocate the cost of a tree where agents are heterogenous. The heterogeneity emerges as a consequence of the different levels of production and consumption of a good. The model we propose has five elements, a set of agents, a tree that represents the possibilities of communication among the agents, a cost function, and the production and demand of each agent. The goal is to determine how to divide the overall cost of the tree among the agents taking into account all the elements of the problem. As far as we know, existing literature has focused on situations that involve only the first three ingredients, without using the information on production and demand to discriminate among agents. For example, what it may be considered as “fair” in the traditional setting, it may not necessarily be in our framework. This idea is very well captured by the property of fairness for two agents (which is satisfied by the two rules we present in the paper).We introduce a collection of properties which we believe may result suitable to solve the problem of allotting the cost. Some of them are quite standard and can be easily applied to the traditional framework (without demand/production). For instance, this is the case of cost additivity. Others however, are more specifically applied to our setting. We show that two combinations of these properties characterize the corresponding two rules: the equal division across components rule and the equal safety rule. Both are based on a process that divide the cost of each single link (each rule using different criteria), and the final contribution is the sum of the contributions of each link. The two rules we define clearly differ both in their nature and the properties they satisfy.For this work we have focused on trees, as a particular case of networks. The existing literature (see the wide list of papers mentioned in the Introduction) shows trees, unlike other structures like cycles, lines or hubs, deserve a special analysis. We should mention that the extension of our analysis to more general networks is far from being straightforward. For example, the equal across components rule exploits the fact any link in a tree divides the tree into to components, which is not true for general networks. From a practical point of view there are real situations that could be modeled as a tree. In this paper we have considered the tariff system for the water transfer from Tagus river to Segura river in Spain.

@&#CONCLUSIONS@&#
