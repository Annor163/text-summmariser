@&#MAIN-TITLE@&#
Dynamic mean-risk portfolio selection with multiple risk measures in continuous-time

@&#HIGHLIGHTS@&#
Study dynamic portfolio selection with multiple risk measures in continuous-time.Help investors control both central-moment risk measure and downside risk measure.Solve analytically dynamic mean-variance-CVaR formulation.Solve analytically dynamic mean-variance-SFP (Safety-First Principle) formulation.Reveal a curved V-shape property in optimal portfolio policies of our models.

@&#KEYPHRASES@&#
Dynamic mean-risk portfolio selection,Conditional value at risk,Safety-first principle,Stochastic optimization,Martingale approach,

@&#ABSTRACT@&#
While our society began to recognize the importance to balance the risk performance under different risk measures, the existing literature has confined its research work only under a static mean-risk framework. This paper represents the first attempt to incorporate multiple risk measures into dynamicportfolio selection. More specifically, we investigate the dynamic mean-variance-CVaR (Conditional value at Risk) formulation and the dynamic mean-variance-SFP (Safety-First Principle) formulation in a continuous-time setting, and derive the analytical solutions for both problems. Combining a downside risk measure with the variance (the second order central moment) in a dynamic mean-risk portfolio selection model helps investors control both a symmetric central risk measure and an asymmetric catastrophic downside risk. We find that the optimal portfolio policy derived from our mean-multiple risk portfolio optimization models exhibits a feature of curved V-shape. Our numerical experiments using real market data clearly demonstrate a dominance relationship of our dynamic mean-multiple risk portfolio policies over the static buy-and-hold portfolio policy.

@&#INTRODUCTION@&#
One fundamental principle behind the mean-variance (MV) portfolio selection formulation proposed by Markowitz (1952) is to strike a balance between maximizing the expected terminal wealth and minimizing the investment risk. Please refer to Kolm, Tütüncü, and Fabozzi (2014) for a review of the research progress in portfolio optimization during the past 60 years. As a natural generalization of the MV analysis, a general class of mean-risk portfolio optimization models has already become a fundamental instrument in real-world portfolio management. The last half century has witnessed numerous risk measures proposed in the literature. Please see Krokhmal, Zabarankin, and Uryasev (2011) for a comprehensive review. At the same year when Markowitz published his seminal work of the MV formulation, Roy (1952) proposed the fundamental safety-first principle (SFP) in portfolio selection, which concerns the probability that disastrous events happen, a risk measure concentrating on the tail of a distribution, instead of the central moments. Following the same concept of SFP to measure the downside risk, the Value-at-Risk(VaR) is defined as the quantile of the loss under certain confidence level. Although VaR is popular in financial industry (RiskMetricTMMorgen, 1996), the VaR has been widely criticized for some of its undesired properties (Tasche, 2002). More specifically, VaR fails to qualify as a coherent risk measure, as it violates some axioms of the coherent risk measures proposed by Artzner, Delbaen, Eber, and Heath (1999). As a modification of the VaR, the conditional Value-at-Risk (CVaR) proposed by Rockafellar and Uryasev (2000) and Rockafellar and Uryasey (2002) is defined as the average value of the loss greater than the VaR for a given confidence level. CVaR has attracted increasing attention in recent years as CVaR is a coherent risk measure proved by Acerbi and Tasche (2002). More importantly, the convexity of the CVaR measure leads to a tractable optimization model of the corresponding mean-CVaR portfolio formulation and its extensions, see, e.g., Alexander and Baptista (2002), Rockafellar and Uryasey (2002), Zhu and Fukushima (2009) and Huang, Zhu, Fabozzi, and Fukushima (2010). While almost all mean-risk frameworks in the literature adhere to a single risk measure, Roman, Darby-Dowman, and Mitra (2007) proposed recently a static portfolio selection model with a combined risk measure of both variance and CVaR, which offers a new way of thinking under the mean-risk framework.Various dynamic mean-risk portfolio optimization models have been developed according to different risk measures. The past 15 years has witnessed rapid progresses of the dynamic MV formulation by leaps and bounds, see Li and Ng (2000), Zhou and Li (2000), Li, Zhou, and Lim (2001), Zhu, Li, and Wang (2004), Bielecki, Jin, Pliska, and Zhou (2005), Basak and Chabakauri (2010), Cui, Li, Wang, and Zhu (2012), Cui, Gao, Li, Li, (2014). The earliest work on dynamic mean-SFP portfolio selection model by Li, Chan, and Ng (1998) approximates the SFP measure by using the Bienaymé–Tchebycheff Inequality as did in the original work of Roy (1952), which in turn leads back to a dynamic MV formulation. However, when the underlying distribution of the random return is not normally distributed and is asymmetric, such an approximation method is certainly not accurate enough and basically loses the essential feature of the safety-first principle. As for the mean-CVaR portfolio models, the current state-of-the-art still remains mainly at the level of static formulations which generate optimal buy-and-hold portfolio policies, e.g., see Rockafellar and Uryasev (2000), Alexander and Baptista (2002), Rockafellar and Uryasey (2002), Zhu and Fukushima (2009), Künzi-Bay and János (2006) and Huang et al. (2010). Different from MV portfolio optimization where only the first two central moments of the distribution are needed, the distribution information of the returns is always required in computing the CVaR of the portfolio loss. Thus, either an explicit distribution function or a discrete distribution is assumed in mean-CVaR portfolio optimization. The past several years have witnessed efforts to extend static mean-CVaR optimization models to two-period or multi-period settings, see, e.g., Fábián (2006), Fábián and Szoke (2007), Hibiki (2006). However, due to the assumption of the discrete scenario of the returns, these models often lead to a computational intractability while the number of scenario and/or periods is only relatively large. By using the dynamic programming approach, Siegmann and Lucas (2005) studied the loss aversion based dynamic portfolio allocation model which is related to mean-downside risk portfolio optimization. As for continuous-time models, Jin, Yan, and Zhou (2005) showed that a general class of mean-downside risk portfolio optimization problem in continuous-time setting is ill-posed in the sense that the optimal value cannot be achieved. Despite of such a negative result, there do exist research works that integrate the downside risk measure into the utility maximization model in continuous-time, e.g., Basak and Shapiro (2001) considered the VaR constraint on the terminal wealth, and Yiu (2004) extended such a result to the case when the VaR constraint is imposed for the entire investment process. Chiu, Wong, and Li (2012) modified the original mean-SFP formulation reasonably by imposing an upper bound on the terminal wealth level and completely solved the continuous-time mean-SFP asset-liability problem.Different risk measures emphasize different aspects of the random investment loss. While the variance measures the deviation of the random variable from the expected value, Roy’s safety-first principle (SFP) (Roy, 1952) focuses on the extreme events in the tail part of the random return distribution. While SFP is a probability measure, the CVaR is a conditional expectation conditioned on that losses are greater than the VaR for a given confidential level. If we examine the investment performance according to different spectra of the risk measures, any policy generated from a mean-risk portfolio model with a sole risk measure may not become a good choice. Roman et al. (2007) showed that the optimal policy generated from the mean-CVaR portfolio model could induce a very large variance, which leads to a small Sharpe ratio. The confidential level of the loss in CVaR is usually set at 95 or 99 percent. Intuitively speaking, the CVaR focuses on the 5 or1percenttail part of the random return distribution, which neglects the risk exhibited in other parts of the distribution. On the other hand, the CVaR of the portfolio generating from the traditional MV model could be also unacceptably large. To overcome the inconsistence between the policies generated from the MV and mean-downside risk models, Roman et al. (2007) proposed to combine the CVaR and the variance together as two risk measures in a multi-objective portfolio optimization problem. After solving these static optimization problems, Roman et al. (2007) showed the advantage of these portfolio models with multiple risk measures by checking them against various market data sets.Motivated by the work in Roman et al. (2007) under a static setting, we consider in this paper its extension to dynamic portfolio selection with multiple risk measures. More specifically, we consider in this work two kinds of dynamic mean-multiple risk portfolio optimization models, namely, the dynamic mean-variance-CVaR (MVC) and the dynamic mean-variance-SFP (MVS) portfolio optimization problems. To our knowledge, this is the first work in the literature studying dynamic mean-multiple risk portfolio optimization models. Compared to the existing literature, our contributions include several significant features. Under our market setting, we are able to derive the analytical forms of the portfolio policy for both MVC and MVS portfolio optimization models. Due to the combined risks in the objective function, our multiple-risks based portfolio model conquers the ill-posedness of the mean-downside risk portfolio optimization model with a sole downside risk (Jin et al., 2005). We also reveal a key difference of our portfolio model with the well known dynamic MV portfolio policy, e.g., see Li and Ng (2000), Zhou and Li (2000), Bielecki et al. (2005). The optimal portfolio policies derived from both MVC and MVS exhibit a curved V-shape property, i.e., with respect to a certain level of the current wealth, both of the MVC and MVS portfolio policies increase the allocation to the risky assets in both directions. Compared with the static MVC model proposed by Roman et al. (2007), our newly derived dynamic MVC portfolio policy can reduce both the variance and the CVaR measures significantly.The remaining of this paper is organized as follows. We present the market setting and problem formulations in Section 2. We investigate and solve completely the dynamic MVC and dynamic MVS formulations in Section 3 and Section 4, respectively. In Section 5, we compare the dynamic MVC and MVS portfolio policies with the dynamic MV portfolio policy via two illustrative examples. We also compare our dynamic MVC portfolio model with the static buy-and-hold portfolio policy. Throughout of the paper, we use notation 1Afor the indicator function, i.e.,1A=1if conditionAholds and1A=0otherwise, Q′ for the transpose of matrix Q, and(y)+for the nonnegative part of y, i.e.,(y)+≜max{0,y}. We denote normal random variable Xwith mean a and variance b byX∼N(a,b),and denote the probability density function and the cumulative distribution function (CDF) of the standard normal variable by ϕ(·) and Φ(·), respectively. For any particular optimization problem(P),we usev(P)to denote its optimal objective value.We consider a market with n risk assets and one risk free asset which can be traded continuously within a time horizon [0, T]. An investor enters the market with initial wealth x0 and allocates his wealth in thesen+1assets continuously. The price process S0(t) of the risk free asset follows the ordinary differential equation,dS0(t)=r(t)S0(t)dt,t ∈ [0, T], withS0(0)=s0,where r(t) is the risk free return, 0 ≤ t ≤ T. In this work, all the randomness is modeled by a complete filtrated probability space{Ω,F,P,{Ft}t≥0},on which anFtadapted n-dimensional Brownian motionW(t)=(W1(t),…,Wn(t))′is defined, where Wi(t) and Wj(t) are mutually independent fori≠j. The price processes of the nrisky assets satisfy the following set of stochastic differential equations (SDE),dSi(t)=Si(t)(μi(t)dt+∑j=1nσij(t)dWj(t)),i=1,…,n,withSi(0)=si,where μi(·) and σij(·) are the appreciation and volatility, respectively. We assume that r(t), μi(·) and σij(·) areFt-adapted uniformly bounded stochastic processes and the volatility matrixσ(t)≜{σij(t)}i,j=1nsatisfies the nondegeneracy condition, σ(t)σ′(t) > ϵI, for all t ≥ 0 and some positive number ϵ > 0, where I is the identity matrix. LetLF2(0,T;Rn)be the set of allRn-valued,Ft-adapted and square integrable stochastic processes, andLFT2(Ω;Rn)be the set of allRnvalued,FT-measurable random variables. Letμ(t)≜(μ1(t),…,μn(t))′. Define the self-financing portfolio process asπ(t)≜(π1(t),…,πn(t))′withπ(·)∈LF2(0,T;Rn),where πi(t) is the dollar amount allocated to the ith stock at time t. The wealth process x(t) then satisfiesdx(t)=(r(t)x(t)+b(t)′π(t))dt+π(t)′σ(t)dW(t),withx(0)=x0,whereb(t)≜μ(t)−r(t)e=(μ1(t)−r(t),μ2(t)−r(t),…,μn(t)−r(t))′with e being the n-dimensional all-one vector.Before we present our mean-multiple-risk portfolio models, we give first the formal definition of the CVaR of the portfolio loss. Let the loss function of the terminal wealth beL(x(T))≜x0−x(T),i.e., the difference between the initial and terminal wealth. We adopt the CVaR definition of the loss given by Rockafellar and Uryasey (2002), which is a unified definition applied for all loss functions with a continuous or a discontinuous distribution. Define the cumulative distribution function of L(x(T)) asΨ(y)=P(L(x(T))≤y). For a given confidence level β, the correspondent β-tail distribution of the loss function L(x(T)) is given as(1)Ψβ(y)={0,ify<VaRβ;Ψ(y)−β1−β,ify≥VaRβ,whereVaRβ=inf{y|Ψ(y)≥β}. The CVaR of the loss function L(x(T)) is given as(2)CVaRβ[L(x(T))]≜∫L(x(T))≥VaRβf(x(T))dΨβ(y),where the integration in (2) degenerates to a summation if the β-tail distribution function of L(x(T)) is discrete. The CVaR definition in (2) is actually the mean value of the β-tail distribution of the loss L(x(T)). Such a definition of CVaR covers general distribution functions of the loss function L(x(T)).11Please refer to Rockafellar and Uryasey (2002) for some subtle difference between the cases with discrete and continuous distribution functions of the random loss.We useV[x(T)]≜E[(x(T)−E[x(T)])2]to denote the variance of the terminal wealth x(T). Investors who care about both the variance and CVaR risk measures of the portfolio should naturally consider the following mean-variance-CVaR (MVC) portfolio selection model,(3)Pmvc(ω):minπ(·)∈LF2(0,T;Rn)V[x(T)]+ωCVaRβ[L(x(T))],(4)Subjectto:E[x(T)]=d,(5)dx(t)=(r(t)x(t)+b(t)′π(t))dt+π(t)′σ(t)dW(t),(6)x(T)≥0,where ω ≥ 0 is a weighting parameter, which balances the importance of the two risk measures. Note that, for a fixed value of d, varying the parameter ω generates the efficient frontier in the two-dimensional variance-CVaR space. Varying both d and ω generates the efficient surface in the three-dimensional mean-variance-CVaR space. Similarly, we can also consider the following mean-variance-SFP (MVS) portfolio selection model,(7)Pmvs(ω):minπ(·)∈LF2(0,T;Rn)V[x(T)]+ωP(x(T)≤γ),Subjectto:{x(t),π(t)}satisfies(4),(5),(6),where ω ≥ 0 serves the same purpose as in problemPmvc(ω)and γ > 0 is a given benchmark level of the terminal wealth, e.g., γ can be set asγ=e∫0Tr(s)dsx0,which is the terminal wealth resulted from the pure investment in the risk free account. In the literature, the probabilityP(x(T)≤γ)is also known as the disaster probability.In this section, we develop the optimal portfolio policy for problemPmvc(ω). Firstly, we adopt the following result from Rockafellar and Uryasey (2002)(page 1451, Theorem 10) to rewrite the objective function of problemPmvc(ω)in a more computable form.Proposition 3.1Rockafellar & Uryasey, 2002The CVaR of the loss function L(x(T)) can be computed as follows,(8)CVaRβ[L(x(T))]=minα{α+11−βE[(x0−x(T)−α)+]},where α is an auxiliary variable.From Proposition 3.1, we first solve the following auxiliary problem with a fixed value of α,(9)P˜mvc(ω,α):minπ(·)∈LF2(0,T;Rn)V[x(T)]+ω^E[(q−x(T))+]Subjectto{x(t),π(t)}satisfies(4),(5)and(6),whereq≜x0−αandω^≜ω/(1−β). Note that, since x(T) ≥ 0, we have(q−x(T))+=0if q ≤ 0. Thus, for problemP˜mvc(ω,α),we only need to consider the cases with q > 0. Note that the difference between problemPmvc(ω)andP˜mvc(ω,α)is that the decision variable α is fixed as a constant in problemP˜mvc(ω,α),which leaves π(·) being the only decision vector. Thus, our solution scheme consists of two steps: i) we solve problemP˜mvc(ω,α)in the first step; and ii) In accordance with the solution form of problemP˜mvc(ω,α)parameterized in α, we solve the original problemPmvc(ω)by identifying optimal α in the second step.Due to the constraints in (4)–(6), it is difficult to solve problemP˜mvc(ω,α)directly by using the classical stochastic control approach. We use, instead, the martingale approach to solve problemP˜mvc(ω,α),see, e.g., Pliska (1986) and Karatzas and Shreve (1998). The main idea of the martingale approach is to decompose the solution process into two phases: i) solving first a static optimization problem to determine the optimal terminal wealth x*(T); and ii) identifying next the portfolio policy which replicates such an optimal wealth x*(T). Under our market setting, the market is complete. Thus, we can compute the market price of risk asθ(t)≜σ−1(t)b(t). We can then define the deflator process (see, e.g., Karatzas & Shreve, 1998) asdz(t)=−z(t)(r(t)dt+θ′(t)dW(t))withz(0)=1,or equivalently, the exponential martingale,(10)z(t)=exp{−∫0t[r(τ)+12∥θ(τ)∥2]dτ−∫0tθ′(τ)dW(τ)},withz(0)=1. We can define the essential lower and upper bounds of z(T) as(11)ξ̲:=inf{a∈R:P(z(T)≤a)>0},ξ¯=sup{a∈R:P(z(T)≥a)>0}.From (10), we know z(T) ≥ 0. When θ(t) is a deterministic number (from the Black–Schole type of market setting), e.g., under Assumption 3.1 introduced later in the paper, we haveξ̲=0andξ¯=+∞. However, when θ(t) is a stochastic process, it is possible thatξ>0 andξ¯<+∞(please see the example given in Bielecki et al., 2005). The deflator process z(t) changes the wealth process to a martingale, i.e.,z(t)x(t)=E[z(s)x(s)|Ft],for any 0 ≤ t < s ≤ T. Thus, the optimal terminal wealth x*(T) of the problemP˜mvc(ω,α)can be found by the following static optimization problem,(12)Pmvcaux:minx(T)∈LFT2(Ω,R)E[x2(T)−d2]+ω^E[(q−x(T))+],(13)SubjecttoE[x(T)]=d,(14)E[z(T)x(T)]=x0,(15)x(T)≥0.The solution of problemPmvcauxcan be characterized by the following proposition.Proposition 3.2The following solution x*(T) solves problemPmvcaux,(16)x*(T)={12(λ−ηz(T))ifηz(T)≤λ−2q,qifλ−2q<ηz(T)<λ−2q+ω^,12(λ+ω^−ηz(T))ifλ−2q+ω^≤ηz(T)≤λ+ω^,0ifηz(T)>λ+ω^.where η and λ are the solutions of the following system of two equations,(17)E[(λ−2q−ηz(T))+]−E[(λ−2q+ω^−ηz(T))+]+E[(λ+ω^−ηz(T))+]=2d,(18)E[z(T)(λ−2q−ηz(T))+]−E[z(T)(λ−2q+ω^−ηz(T))+]+E[z(T)(λ+ω^−ηz(T))+]=2x0.To simplify the notation in our proof, we use Z and X to represent z(T) and x(T), respectively. By introducing Lagrangian multipliersλ∈Randη∈Rin problemPmvcaux,we form the Lagrangian relaxation ofPmvcaux,minX≥0g^(X)≜E[X2−d2+ω^(q−X)+−λ(X−d)+η(ZX−x0)]. Ignoring the constant terms, we solve the following point-wise optimization problem,(19)minX≥0g(X)≜X2+ω^(q−X)+−λX+ηZX.Since Z is random, the optimal solution of (19) depends on the value of Z. Thus, We consider different cases in problem (19). (i) Ifq−X≥0,then we have 0 ≤ X ≤ q. Problem (19) becomesmin0≤X≤qg(X)=X2+ω^(q−X)−λX+ηZX,which is a convex optimization problem. The optimal solution X* of this problem is as follows. Ifλ+ω^−2q≤ηZ≤λ+ω^,we haveX*=12(λ+ω^−ηZ)withg(x*)=ω^q−14(λ+ω^−ηZ)2. If ηZ≥λ+ω^,thenX*=0with g(X*)=ω^q. WhenηZ≤λ+ω^−2q,the optimal solution isX*=qwithg(X*)=q2−(λ−ηZ)q. (ii) Whenq−X≤0,problem (19) becomes minX ≥ qg(X)=X2−(λ+ηZ)X. IfηZ≤λ−2q,thenX*=12(λ−ηZ)with optimal value g(X*)=−14(λ−ηZ)2. IfηZ≥λ−2q,thenX*=qwithg(X*)=q2−(λ−ηZ)q. Comparing the above two cases, we can conclude that the optimal solution X*of problem (19) is given as in (16). Due to the weak duality, we always havev(Pmvcaux)≥g^(X*),wherev(Pmvcaux)denotes the optimal objective value of problemPmvcaux. However, if X*solves both (13) and (14), which ensures the feasibility of X* in problemPmvcaux,thusg^(X*)≥v(Pmvcaux),which further impliesg^(X*)=v(Pmvcaux)and the optimality of X* in problemPmvcauxunder this condition. Note that for any a < b,A1X≤a+B1a<X≤b=(A−B)1X≤a+B1X≤b. Thus, substituting (16) back to (13)and (14) gives rise to Eqs. (17) and (18).□The optimal terminal wealth (16) is a piece-wise linear function of the state z(T). Ifω=0,thenq=0and this problem degenerates to the pure MV portfolio optimization formulation, which is studied by Bielecki et al. (2005).Under the assumption thatξ<x0/d < E[z(T)], whereξis defined in(11),Eqs. (17)and(18)may only have solutions with η > 0.The proof of Proposition 3.3 is given in the appendix. Theoretically speaking, once the optimal terminal wealthx*(T)∈LFT(Ω;R)is known, the optimal wealth process x*(t) and portfolio policy π*(t) can be found by solving the following backward stochastic differential equation (BSDE) with terminal wealth x*(T),dx(t)=(r(t)x(t)+θ(t)y(t))dt+y(t)′dW(t)withx(T)=x*(T),wherey(·)=σ(·)π(·). Due to the martingale property, in general, the optimal wealth process x*(t) can be expressed as x*(t)=E[z(T)z(t)x*(T)|Ft],0 ≤ t ≤ T, and the optimal portfolio π*(t) can be characterized as π*(t)=−(σ(t)σ′(t))−1b(t)∂G(t,z(t))∂z(t),if x*(t) can be expressed as G(t, z(t)) for some deterministic differentiable function G(t, z(t)) (see, e.g., Karatzas & Shreve, 1998). Thus, for some special market settings, we can derive the analytical portfolio policy.Assumption 3.1The market parameters r(t), μ(t) and σ(t), 0 ≤ t ≤ T, are deterministic functions of t.Under Assumption 3.1, the deflator process, z(t), defined in (10) implies that z(T)/z(t) follows a log-normal distribution, i.e.,ln(z(T)/z(t))∼N(m(t),ν2(t)),where(20)m(t)≜−∫tT(r(τ)+12∥θ(τ)∥2)dτ,t∈[0,T],(21)ν2(t)≜∫tT∥θ(τ)∥2dτ,t∈[0,T].Sincez(0)=1,we haveln(z(T))∼N(m(0),ν2(0)). Under this assumption, the essential lower and upper bounds of z(T) defined in (11)becomeξ̲=0andξ¯=+∞and the expected value of z(T) becomesE[z(T)]=e−∫0Tr(s)ds. Thus the condition proposed in Proposition 3.3becomesd>x0e∫0Tr(s)ds,which implies that the expected target terminal wealth, d, should be larger than the terminal wealth generated from keeping all wealth in the risk free account. To simplify the notations, we denote the first and second moment of z(T)/z(t) as A(t)≜E[z(T)/z(t)]=em(t)+[ν(t)]22=e−∫tTr(s)dsand B(t) ≜ E[(z(T)/z(t))2]=e2m(t)+2ν2(t),respectively.Proposition 3.4UnderAssumption 3.1andd>x0e∫0Tr(s)ds,the optimal wealth processx*(t,α)|t=0Tand the optimal portfolio policyπ*(t,α)|t=0Tof problemP˜mvc(ω,α)are given respectively as follows,(22)x*(t,α)=A(t)2((λ−2q)Φ(κ1(t))−(λ−2q+ω^)Φ(κ2(t))+(λ+ω^)Φ(κ3(t)))−z(t)ηB(t)2(Φ(κ1(t)−ν(t))−Φ(κ2(t)−ν(t))+Φ(κ3(t)−ν(t))),(23)π*(t,α)=12(σ(t)σ(t)′)−1b(t){A(t)ν(t)[(λ−2q)ϕ(κ1(t))−(λ−2q+ω^)ϕ(κ2(t))+(λ+ω^)ϕ(κ3(t))]+z(t)ηB(t)×[Φ(κ1(t)−ν(t))−Φ(κ2(t)−ν(t))+Φ(κ3(t)−ν(t))−1ν(t)(ϕ(κ1(t)−ν(t))−ϕ(κ2(t)−ν(t))+ϕ(κ3(t)−ν(t)))]},where κ1(t)=ln((λ−2qη)+)−lnz(t)−m(t)ν(t)−ν(t),κ2(t)=ln((λ−2q+ω^η)+)−lnz(t)−m(t)ν(t)−ν(t),and κ3(t)=ln((λ+ω^η)+)−lnz(t)−m(t)ν(t)−ν(t). Furthermore, the Lagrange multipliers λ and η are the solutions to the following system of two equations,(24)(λ−2q)Φ(κ1(0)+ν(0))−(λ−2q+ω^)Φ(κ2(0)+ν(0))+(λ+ω^)Φ(κ3(0)+ν(0))−ηA(0)×(Φ(κ1(0))−Φ(κ2(0))+Φ(κ3(0)))=2d,(25)A(0)((λ−2q)Φ(κ1(0))−(λ−2q+ω^)Φ(κ2(0))+(λ+ω^)Φ(κ3(0)))−ηB(0)(Φ(κ1(0)−ν(0))−Φ(κ2(0)−ν(0))+Φ(κ3(0)−ν(0)))=2x0.From the martingale property x*(t)=E[z(T)z(t)x*(T)|Ft],expression (16) and Proposition 3.3, we have(26)x*(t,α)=12E[z(T)z(t)(λ−ηz(T))1z(T)≤λ−2qη|Ft]+qE[z(T)z(t)1λ−2qη<z(T)<λ−2q+ω^η]+12E[z(T)z(t)(λ+ω^−ηz(T))1λ−2q+ω^η≤z(T)≤λ+ω^η|Ft].Applying Proposition 7.1 (in the Appendix) to each term in (26) yields (22). Once we know the explicit expression of x*(t, α), we can compute the optimal portfolio policy (23) by π*(t) =−(σ(t)σ′(t))−1b(t)∂x*(t,α)∂z(t),which yields (23).□Based on the solution ofP˜mvc(ω,α),which is parameterized in α, the optimal portfolio policy of problemPmvc(ω)can be found by minimizing the value function ofP˜mvc(ω,α)over α.Proposition 3.5UnderAssumption 3.1, the optimal wealth processx*(t)|t=0Tand portfolio policyπ*(t)|t=0Tof problemPmvc(ω)are, respectively, in the forms of(22)and(23)for some λ*, η*and α*, whereα*=argminαGcvar(α)with(27)Gcvar(α)={−λ−ω^2(Φ(κ3(0)+ν(0))−Φ(κ2(0)+ν(0)))+ηA(0)2(Φ(κ3(0))−Φ(κ2(0))))+(x0−α)(1−Φ(κ2(0)+ν(0)))ifα<x0,αotherwise,λ*and η*are the solutions to(24)and(25)withα=α*,and A(·), B(·), κ1(t), κ2(t) and κ3(t) are defined inProposition 3.4. Furthermore, under the optimal portfolio policyπ*(t)|t=0T,the correspondent CVaR of the loss is given by CVaRβ[L(x(T))]=Gcvar(α*).Proposition 3.1 implies that the CVaR term inPmvc(ω)can be computed via minimizingGcvar(α)=(α+11−βE[(q−x*(T))+])with respect to α. Applying Proposition 7.1 (in the Appendix) and Proposition 3.3 with the expression (16) in Proposition 3.2 gives rise to the first case in (27). Whenx0−α<0,then(x0−α−x(T))+=0. Combining these two cases completes the proof.□Note that the optimal α* defined in Proposition 3.5 may not be unique. Since the distribution function of x*(T) is not continuous, as indicated in Rockafellar and Uryasey (2002), all the optimal α*s form a closed and bounded interval. Since the objective functionGcvar(α)is convex, we can use the gradient based searching procedure to find one of the optimal solution α*.In problemPmvc(ω),the mean-variance-CVaR efficient frontier is a surface in the three dimensional space of the expected value, standard deviation and CVaR of x(T). More specifically, the efficient surface is a set of triples,(d,CVaRβ[L(x(T))|F0],V[x(T)|F0])parameterized in d and ω, whereCVaRβ[L(x(T))|F0]=Gcvar(α*)and(28)V[x(T)|F0]=14{λ2Φ(κ1(0)+ν(0))−2ληA(0)Φ(κ1(0))+η2B(0)Φ(κ1(0)−ν(0))+4q2×(Φ(κ2(0)+ν(0))−Φ(κ1(0)+ν(0)))+(λ+ω^)2(Φ(κ3(0)+ν(0))−Φ(κ2(0)+ν(0)))−2(λ+ω^)ηA(0)(Φ(κ3(0))−Φ(κ2(0)))+η2B(0)(Φ(κ3(0)−ν(0))−Φ(κ2(0)−ν(0)))}−d2,where (28) is computed byV[x(T)|F0]=E[x*(T)2]−d2with (16) and Proposition 7.1.Remark 3.3In Propositions 3.4 and 3.5, the optimal wealth processx*(t)|t=0Tand optimal portfolio policyπ*(t)|t=0Tare represented by the market state z(t). Although z(t) can be computed by observing the price S(t) when the market is complete, z(t), in general, cannot be observed directly. Thus, it is more favorable to have the feedback form of the portfolio policy, i.e., representing the portfolio policy π*(t) in terms of the current wealth x*(t). This can be done by eliminating z(t) from (22) and (23) numerically, i.e., we can compute the value of x*(t) and π*(t) for a set of discrete value of z(t). Then, we can build up a mapping between π*(t) and x*(t) by using a curve fitting method.Our solution scheme in solving problemPmvs(ω)is similar to the one forPmvc(ω). The optimal terminal wealth of problemPmvs(ω)can be found by solving the following static optimization problem,(29)Pmvsaux:minx(T)∈LFT2(Ω,R)E[x2(T)−d2]+ωE[1x(T)≤γ],Subjectto:x(T)satisfies(13),(14)and(15).Proposition 4.1The following solution x*(T) solves problemPmvsaux.(i) If γ2 ≤ ω, then(30)x*(T)={12(λ−ηz(T))ifηz(T)≤λ−2γ,γifλ−2γ<ηz(T)≤λ−γ+ωγ,0ifηz(T)>λ−γ+ωγ,where λ and η satisfy the following two equations,(31){E[(λ−2γ−ηz(T))+]−2γE[1ηz(T)≤λ−γ+ωγ]=2d,E[z(T)(λ−2γ−ηz(T))+]−2γE[z(T)1ηz(T)≤λ−γ+ωγ]=2x0.(ii) If γ2 > ω, then(32)X*={12(λ−ηz(T))ifηz(T)≤λ−2γ,γifλ−2γ<ηz(T)≤λ−2γ+2ω,12(λ−ηz(T))ifλ−2γ+2ω<ηz(T)≤λ,0ifηz(T)>λ.where λ and η satisfy the following two equations,(33){E[(λ−2γ−ηz(T))+]+E[(2γ−λ+ηz(T))1ηz(T)≤λ−2γ+2ω]+E[(λ−ηz(T))+]=2d,E[z(T)(λ−2γ−ηz(T))+]+E[z(T)(ηz(T)2γ−λ+ηz(T))1ηz(T)≤λ−2γ+2ω]+E[z(T)(λ−ηz(T))+]=2x0.We use Z and X to denote z(T) and x(T) in the proof. Constructing the Lagrangian function of problemPmvsauxand ignoring the constant term, we solve the point-wise optimization problem for optimal X,minX≥0g(X)=X2+ω1X≤γ−λX+ηZX,or equivalently,(34)minX≥0g(X)={g1(X)=X2+X(ηZ−λ)+ω,ifX≤γ,g2(X)=X2+X(ηZ−λ),ifX>γ.It is not difficult to verify the minimizers of these two problems as follows,argmin0≤X≤γg1(X)={γifηZ≤λ−2γ,12(λ−ηZ)ifλ−2γ<ηZ≤λ,0ifηZ<λ,andargminX≥γg2(X)={12(λ−ηZ)ifηZ≤λ−2γ,γifηZ>λ−2γ.Combining the solutions of these two problems leads to the solution for problem (34), which depends on the value of γ2 and ω. (i) WhenηZ≤λ−2γ,the optimal solution of (34) isX*=12(λ−ηZ). (ii) Whenλ−2γ≤ηZ≤λ,we compareg1(12(ηZ−λ))and g2(γ). Note that when γ2 ≤ ω,g2(γ)≤g1(12(ηZ−λ))for allλ−2γ≤ηZ≤λ. Thus, the minimizer of (34)is γ under this case. However, when γ2 ≥ ω, we haveg2(γ)≤g1(12(ηZ−λ))whenλ−2γ≤ηZ≤λ−2γ+2ωandg2(γ)≥g1(12(ηZ−λ))whenλ−2γ+2ω≤ηZ≤λ. This implies that the minimizer of (34)is either γ or12(ηZ−λ)depending on whetherηZ∈[λ−2γ,λ−2γ+2ω]orηZ∈[λ−2γ+2ω,λ−2γ]. (iii) Now we consider the case ηZ≥ λ. Similar to case (ii), when γ2 ≤ ω, the minimizer of (34) is either γ forηZ∈[λ,λ−γ+ωγ)or 0 forηX≥λ−γ+ωγ. When γ2≥ ω, the minimizer is 0 for ηZ ≥ λ. As a summary, we can conclude that when γ2 ≤ ω, the optimal solution of (34) is given as in (30), and, when γ2 > ω, the optimal solution of (34) becomes (32). At this point, X* is the solution in minimizing the Lagrange function g(X). To achieve the strong duality, substituting X* into (13) and (14) forces the feasibility of X*, thus yielding the results in (31) and (33), respectively, for the cases of γ2 ≤ ω and γ2 > ω.□Ifξ<x0/d < E[z(T)], whereξis defined in(11),Eqs. (33)and(31)only have positive solution of η.The proof of Proposition 4.2 is similar to Proposition 3.3. Thus, we omit its details here. Similar to problemPmvc(ω),when the market parameters are deterministic, we can compute the portfolio policy of problemPmvs(ω)explicitly.Proposition 4.3UnderAssumption 3.1, the optimal wealth processx*(t)|t=0Tand portfolio processπ*(t)|t=0Tof problemPmvs(ω)are expressed as follows. (i) If γ2 ≤ ω, we havex*(t)=12A(t)((λ−2γ)Φ(ζ1(t))+2γΦ(ζ2(t)))−ηz(t)2B(t)Φ(ζ1(t)−ν(t)),π*(t)=12(σ(t)σ(t)′)−1b(t)×(A(t)ν(t)((λ−2γ)ϕ(ζ1(t))+2γϕ(ζ2(t)))+ηB(t)z(t)(Φ(ζ1(t)−ν(t))−1ν(t)ϕ(ζ2(t)))),where λ and η are the solutions of the following equations,(35){(λ−2γ)Φ(ζ1(0)+ν(0))+2γΦ(ζ2(0)+ν(0))−ηA(0)Φ(ζ1(0))=2d,A(0)((λ−2γ)Φ(ζ1(0))+2γΦ(ζ2(0)))−ηB(0)Φ(ζ1(0)−ν(0))=2x0.(ii) If γ2 > ω, we havex*(t)=12A(t)((λ−2γ)(Φ(ζ1(t))−Φ(ζ3(t)))+λΦ(ζ4(t)))−ηz(t)2B(t)(Φ(ζ1(t)−ν(t))−Φ(ζ3(t)−ν(t))+Φ(ζ4(t)−ν(t))),π*(t)=12(σ(t)σ(t)′)−1b(t)(A(t)ν(t)((λ−2γ)(ϕ(ζ1(t))−ϕ(ζ3(t)))+λϕ(ζ4(t)))+ηB(t)z(t)(Φ(ζ1(t)−ν(t))−Φ(ζ3(t)−ν(t))+Φ(ζ4(t)−ν(t))−1ν(t)(ϕ(ζ1(t)−ν(t))−ϕ(ζ3(t)−ν(t))+ϕ(ζ4(t)−ν(t))))),where λ and η are the solutions of the following equations,(36){(λ−2γ)(Φ(ζ1(0)+ν(0))−Φ(ζ3(0)+ν(0)))+λΦ(ζ4(0)+ν(0))−ηA(0)(Φ(ζ1(0))−Φ(ζ3(0))+Φ(ζ4(0)))=2d,A(0)((λ−2γ)(Φ(ζ1(0))−Φ(ζ3(0)))+λΦ(ζ4(0)))−ηB(0)(Φ(ζ1(0)−ν(0))−Φ(ζ3(0)−ν(0))+Φ(ζ4(0)−ν(0)))=2x0,where ζ1(t)=ln(λ−2γη)+−lnz(t)−m(t)ν(t)−ν(t),ζ2(t)=ln(λ−γ−ωγη)+−lnz(t)−m(t)ν(t)−ν(t),ζ3(t)=ln(λ−2γ+2ωη)+−lnz(t)−m(t)ν(t)−ν(t)and ζ4(t)=ln(λη)+−lnz(t)−m(t)ν(t)−ν(t).The proof of Proposition 4.3 is quite similar to the one for Proposition 3.5. Thus, we omit the details. From Proposition 4.3, we can compute the correspondent disaster probability E[1x(T) ≤ γ]=P(x(T)≤γ)of the optimal portfolio policy explicitly as follows by using Lemma 7.1 (Seetinga=0in (40)),(37)Gsf(ω)=E[1x(T)≤γ]={Φ(ln(λ−γ+ω/γη)+)ifγ2<ω,Φ(ln(λ−2γ+2ωη)+)ifγ2≥ω,where λ, η and Φ(·) are given in Proposition 4.3. Similar toPmvc(ω),varying d and ω spans the efficient surface ofPmvs(ω)in the three dimensional space of the mean E[x(T)], varianceV[x(T)],and the disaster probability E[1x(T) ≤ γ].Example 5.1We first consider an example to investigate the properties of the portfolio policies derived fromPmvc(ω)andPmvs(ω). We adopt a market setting given in Berkelaar, Kouwenberg, and Post (2004), in which the market consists of one risky asset and one risk free asset. The annually based market parameters are given asr=0.0408,μ=0.1068andσ=22percent. The investor’s initial wealth isx(0)=1(million) and the investment target is20percent(i.e.,d=1.2) of the portfolio return inT=1year. The investor adopts modelsPmvc(ω)(with confidence level isβ=95percent) andPmvs(ω)to guide his investment, where the weighting coefficient ω is set atω=0,ω=0.5orω=2. In modelPmvs(ω),the benchmark level is set atγ=erTx0=1.0416,which is the terminal wealth of the riskless investment. According to Propositions 3.5 and 4.3, we can compute parameters η, λ and α numerically, which are given in Table 1.Figs. 1–3plot the optimal terminal wealth x*(T), intermediate wealth x*(t) and portfolio level π*(t) att=0.5for problemPmvc(ω)andPmvs(ω),respectively.In modelPmvc(ω),whenω=0,problemPmvc(ω)degenerates to the dynamic MV portfolio selection model. We can observe from Figs. 1(a) and 2(a) that, when ω > 0, x*(T) and x*(t) generated from problemPmvc(ω)are higher than the one generated from the MV portfolio model (corresponding toω=0) when the market condition is good (when z(T) or z(t) are small, e.g., around 0.5). Similarly, Fig. 3(a) shows that the policy derived fromPmvc(ω)(corresponding to ω > 0) allocates more in the risky asset than the MV portfolio policy does when the market condition is good. These findings actually show that modelPmvc(ω)removes the drawback of a symmetrical penalization on both gain and loss parts of the terminal wealth from adopting the variance term as a risk measure in the MV portfolio model.Figs. 1(b), 2(b) and 3(b) illustrate the solution properties ofPmvs(ω),whose patterns are different from the ones ofPmvc(ω). When ωis small, the wealth process and the portfolio allocation of modelPmvs(ω)behave quite similar to the MV portfolio model. However, when ω is large, in order to protect the probability that the wealth level x*(t) is above certain level, the policy derived fromPmvs(ω)allocates less wealth in the risky asset when market condition is good and more wealth when market condition is bad, when compared to the MV portfolio policy (Please refer to the double peaks in Fig. 3(b)).Fig. 4(a) and (b) demonstrate the relationship between the proportion invested in the risky assetw*(t)≜π*(t)/x*(t)and the current wealth level x*(t) at different time instances forPmvc(ω)andPmvs(ω). We can see thatw*(t),which can be regarded as a feedback gain in our feedback policy, exhibits a feature of curved V-shape, i.e., when the current wealth x*(t) is below or above certain level, both thePmvc(ω)andPmvs(ω)policies increase their proportion of allocations in the risky asset. However, compared with thePmvs(ω)policy, thePmvc(ω)policy is more sensitive to the deviation of the current wealth from the threshold. As for the time effect, we can see that, when the remaining investment horizon becomes shorter, thePmvc(ω)policy becomes more sensitive to the deviation of the current wealth from the threshold. This effect can be interpreted as the reverse time-diversification, i.e., allocating more wealth in the risky asset when facing shorter investment horizon.We compare in this example our dynamic MVC portfolio optimization model with the static buy-and-hold policy in Roman et al. (2007). We adopt a similar market setting given by Rockafellar and Uryasev (2000), where the risky assets are the Standard & Poor index (S&P 500), the long-term US Government Bond (Bond) and the US Small capital index (SamllCap). Following Rockafellar and Uryasev (2000), the annual expected return rate R and the covariance matrix Q can be estimated as given in Table 2. We also assume that there is a risky free asset with an annual return rate1.6percent. From the data given in Table 2, we setμ(t)=μ¯andσ(t)=σ¯for t ∈ [0, T] withμ¯=(0.13460.05300.1722)andσ¯=(0.14280.00940.10020.00940.07280.00310.10020.00310.2353).Let the initial wealth bex0=10(million) and the investment horizon beT=1(1 year). The dynamic MVC portfolio optimization problemPmvc(ω)is solved by using Proposition 3.5, while the static counter part of the MVC portfolio optimization is given as follows in the spirit of Roman et al. (2007),(38)Psmvc(ω)minα,y,yfy′Qy+ω(α+11−βE[(x0−R′y−α)+])Subjectto:E[R]′y+Rfyf=d,∑j=1nyi+yf=x0,R′y+rfyf≥0,wherey=(y1,…,yn)′is the vector of amounts allocated to the risky assets, yfis the allocation in the risk free asset, R is the n-dimensional random return vector,Q∈Rn×nis the covariance matrix, and β is the confidence level set as the same as inPmvc(ω). Note that the constraint (38)corresponds to the no bankruptcy constraint, i.e., for any realization of the random return vector, the terminal wealth is nonnegative. SolvingPsmvc(ω)yields the static Buy-and-Hold portfolio y and yf. ProblemPsmvc(ω)is solved by using the Monte Carlo Simulation approach, e.g., see Rockafellar and Uryasev (2000), Rockafellar and Uryasey (2002). More specifically, we first randomly generate 105 samples of the returns of the three assets from the log-normal distribution according to the mean and covariance listed in Table 2. We then compute the CVaR value of the Buy-and-Hold policy by solving the correspondent linear programming problem associated with these samples by using the CPLEX solver.For problemPmvc(ω),the optimal portfolio policy and the correspondent CVaR of the terminal wealth can be computed by Propositions 3.4 and 3.5. For any fixed α, solving the Eqs. (24) and (25) yields λ(α) and η(α), which further enables us to computeGcvar(α)defined in (27). In this example, we use the simple steepest decent method to find the minimizer, α*, of the problemminαGcvar(α). After α*is known, the optimal CVaR and variance of the terminal wealth are computed by (27) and (28), respectively.Table 3shows the comparison results between the two pairs of optimal variance and the CVaR of the terminal wealth generated from these two models for given d. We can observe that, when the confidence level isβ=0.95,for all the cases, the variance and the CVaR generated from our dynamic modelPmvc(ω)dominate the ones generated from the static modelPsmvc(ω)for the same ω. Furthermore, the marginal improvement becomes larger, when the expected target terminal wealth d increases. When confidence level is99percent,we can observe a similar pattern. However, whenω=2,the variance generated fromPmvc(ω)is worse than the ones generated fromPsmvc(ω),while the CVaR behaves in the opposite direction. The reason is that the optimal variance and CVaR are more sensitive to the weighting parameter ω in problemPmvc(ω)than in the static modelPsmvc(ω). When ωis large, ourPmvc(ω)dynamic policy can control the CVaR at a very low level while the variance is compromised. When ω is increasing, both the optimal variance increases and the CVaR decreases. For a given ω, if we increase the confidence level fromβ=95percenttoβ=99percent,the optimal variance also increases while the optimal CVaR decreases. When the expected target terminal is fixed at eitherd=12ord=12.8,we can see that there exists a trade-off between the variance and the CVaR, i.e., when the weight ω is large, the CVaR can be reduced only at a cost of worsening the variance, and vice versa.

@&#CONCLUSIONS@&#
We have advanced the current literature on dynamic mean-risk portfolio selection formulations by incorporating multiple risk measures, have achieved convincing advantages over the static counterpart of such a type, and have demonstrated an ability to balance and manage wide spectra of the risk. By using the martingale approach, we have derived the solutions of the mean-variance-CVaR (MVC) and mean-variance-SFP (MVS) portfolio optimization formulations analytically, when the market coefficients are deterministic. The portfolio policies of both MVC and MVS models exhibit a feature of curved V-shape, i.e., the larger the distance from the current wealth level to the tip of the curved V function (from both sides), the larger the allocation in the risky assets when the wealth level is either below or above certain level (with a highly nonlinear pattern).Since CVaR and variance inPmvc(ω)or disaster probability and variance inPmvs(ω)are in different units, it is not easy for investors to assign an appropriate value for the weighting coefficient ω, see, e.g., Branke, Deb, Miettinen, and Slowiński (2008). We may, instead, consider an alternative formulation to include only one of three performance measures, the mean, the variance, or CVaR (or SFP) in the objective function, while placing the other two as constraints with given constraint levels. We can also derived the analytical solutions for these alternative formulations. The relationships between these two different formulations are studied in Li, Yang, and Biswal (1999).Proof of Proposition 3.3To simplify the notation, we use Z for z(T). We show that Eqs. (17) and (18) admit no solution when η ≤ 0. If η < 0, then x*(T) given in (16) becomes(39)x*(T)=12(λ+ω^−ηZ)1λ+ω^η<Z<λ−2q+ω^η+q1λ−2q+ω^η<Z<λ−2qη+12(λ−ηZ)1Z≥λ−2qη,which indicates that x*(T) is a piece-wise linear nondecreasing function of Z. SinceZ∈(ξ̲,ξ¯)withξ>0, whereξandξ¯are defined in (11), we have to consider several different cases according to the relationship between (39) and these bounds. To simplify the discussion, we first consider the case thatλ−2q+ω^η<ξ̲<λ−2qη<ξ¯,which impliesx*(T)=q1ξ̲<Z<λ−2qη+12(λ−ηZ)1λ−2qη<Z<ξ¯.Changing the variable by lettingρ=λ−2qη,we havex*(T)=q1ξ̲<Z<ξ¯−η2(Z−ρ)1Z≥ρ. Define a function H(ρ)=E[Zx*(T)]E[x*(T)],which can be simplified as H(ρ)=q^E[Z]+E[Z(Z−ρ)+]q^+E[(Z−ρ)+],whereq^=−2q/η. By using the similar argument in Lemma 5.2 in Bielecki et al. (2005), we can show that H(ρ) is a non-decreasing function with respect to ρ. Thus, we can find the infimum of H(ρ) by settinglimρ→−∞=qE[Z]+E[Z(Z−ρ)+]q+E[(Z−ρ)+]=qE[Z]+E[Z2]−ρE[Z])]q+E[Z]−ρ=E[Z],where the second equality is from the fact that(Z−ρ)+=Z−ρwhenρ→−∞. Under the assumption given in the proposition, we have H(ρ) > E[Z] > x0/d, that is to say the equationE[Zx*(T)]E[x*(T)]=H(ρ)=x0dhas no solution. For the other cases ofξ, e.g.,ξ̲<λ+ωη,we can use a similar method to show that the equations have no solution. Note that whenη=0,it is also easy to check that there is no solution for Eqs. (17) and (18). Thus, under the assumption given in the proposition, we only need to consider the positive solution η > 0 for Eqs. (17) and (18).□Let Y be a random variable that follows the normal distribution with mean and variance being μ andv2,respectively. Then(40)E[eaY·1Y≤d]=e(aμ+a2v22)Φ(d−μv−av),where Φ(·) is the distribution function of the standard normal random variable.LetZ=(Y−μ)/v. Then Zfollows the standard normal distribution and the following holds true,E[eaY1Y≤d]=E[ea(zv+μ)1zv+μ≤d]=12πexp(2aμ+a2v22)∫−∞d−μvexp(−(z−av)22)dz,which completes the proof for (40).□For given real numbers a, h, η > 0 and the stochastic process z(t) defined in(10), the following holds true,(41)E[(a+bz(T))1ηz(T)≤h]=aΦ(w(0))+bA(0)Φ(w(0)−ν(0)),(42)E[z(T)z(t)(a+bz(T))1ηz(T)≤h|Ft]=aA(t)Φ(w(t)−ν(t))+bz(t)B(t)Φ(w(t)−2ν(t)),where m(t) and ν(t) are defined in(20)and(21), respectively, andw(t)≜ln((h/η)+)−ln(z(t))−m(t)ν(t).Since z(T)/z(t) follows a lognormal distribution, ln (z(T)/z(t)) is a normal random variable with the mean and variance being m(t) and ν2(t) given in (20) and (21), respectively. Note thatz(0)=1,which impliesln(z(T))∼N(m(0),ν2(0)). To compute (41)and (42), we need to consider different cases of h as follows. (i) If h ≤ 0 and η ≥ 0, since z(T) ≥ 0, we haveE[(a+bz(T))1ηz(T)≤h]=0andE[(z(T)/z(t))(a+bz(T))1ηz(T)≤h]=0. (ii) For the case with h> 0 and η > 0, we have(43)E[(a+bz(T))1ηz(T)≤h]=aE[1lnz(T)≤ln(hη)]+bE[elnz(T)1z(T)≤ln(hη)](44)E[z(T)z(t)(a+bz(T))1ηz(T)≤h|Ft]=aE[eln(z(T)z(t))1ln(z(T)z(t))≤ln(hηz(t))]+z(t)bE[e2ln(z(T)z(t))1ln(z(T)z(t))≤ln(hηz(t))].Applying Lemma 7.1 to the expressions in (43) and (44) and further combining both cases of (i) and (ii) yield the uniformed expressions in (41) and (42), which completes the proof.□