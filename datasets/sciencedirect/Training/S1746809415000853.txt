@&#MAIN-TITLE@&#
Combining ensemble empirical mode decomposition with spectrum subtraction technique for heart rate monitoring using wrist-type photoplethysmography

@&#HIGHLIGHTS@&#
Heart rate (HR) monitoring using wrist-type PPG signals during physical exercise was examined.The proposed method combines ensemble empirical mode decomposition with spectrum subtraction technique.The proposed method provides satisfactory performance on twelve PPG datasets collected when the subjects were running with the peak speed of 15km/h.The average absolute error of HR estimation was 1.83 beat per minute and the Pearson correlation was 0.989 between the ground-truth and estimated HR.

@&#KEYPHRASES@&#
Photoplethysmography (PPG),Heart rate (HR) monitoring,Ensemble empirical mode decomposition (EEMD),Spectrum subtraction,

@&#ABSTRACT@&#
Photoplethysmography (PPG)-based heart rate (HR) monitoring is a promising feature in modern wearable devices. However, it is difficult to accurately track HR during physical exercise since PPG signals are vulnerable to motion artifacts (MA). In this paper, an algorithm is presented to combine ensemble empirical mode decomposition (EEMD) with spectrum subtraction (SS) to track HR changes during subjects’ physical activities. In this algorithm, EEMD decomposes a PPG signal and an acceleration signal into intrinsic mode functions (IMFs), respectively. Then noise related IMFs are removed. Next the correlation coefficient is computed between the spectrum of the acceleration signal and that of the PPG signal in the band of [0.4Hz–5Hz]. If the coefficient is above 0.5, SS is used to remove the spectrum of the acceleration signal from the PPG's spectrum. Finally, a spectral peak selection method is used to find the peak corresponding to HR. Experimental results on datasets recorded from 12 subjects during fast running showed the superior performance of the proposed algorithm compared with a benchmark method termed TROIKA. The average absolute error of HR estimation was 1.83 beats per minute (BPM), and the Pearson correlation was 0.989 between the ground-truth and the estimated HR.

@&#INTRODUCTION@&#
Heart rate (HR) monitoring using photoplethysmography (PPG) during physical exercise is a useful feature in wrist-type wearable devices [1], which can guide exercisers to increase or decrease their training load, since over-fast HR is harmful to health. The PPG signals [2,3] are generally recorded by pulse oximeters embedded in these wearable devices.However, noise and motion artifacts (MA) could seriously contaminate the wrist-type PPG signals during physical exercise, strongly affecting HR estimation accuracy [1]. Thus it is important to remove MA from raw PPG signals for reliable health monitoring [4–6]. So far a number of signal processing techniques have been proposed to remove MA. Independent component analysis (ICA) is one of techniques used to remove MA. Kim et al. suggested that ICA algorithm combined with a block interleaving with low-pass filtering can reduce MA [7]. Peng et al. showed that temporally constrained ICA (cICA) algorithm combined with adaptive filters could extract the clean PPG signals [8]. However, statistical independence or uncorrelation in ICA does not hold in PPG signals contaminated by MA. Another technique is adaptive filter algorithm [4,9] where reference signals can be constructed from acceleration data [10], or PPG signals themselves [8,9].Empirical Mode Decomposition (EMD) is another attractive method to remove MA from biomedical signals, such as ECG signals [11,12] and PPG signals [13,14]. EMD is a data-driven algorithm that decomposes a time series into multiple intrinsic mode functions (IMFs) [15]. It is an adaptive and nonlinear signal processing method, and is well suited to nonstationary data. For example, Wang et al. used EMD and the Hilbert transform to reduce MA by removing IMFs of which the mean instantaneous frequency was out of the frequency band of PPG [14]. Although the EMD-based methods could remove MA, determining which IMFs should be removed is a difficult issue. Moreover, EMD is sensitive to noise in the recorded signals, and has a phenomenon known as mode mixing. In order to eliminate this mode mixing dilemma, a noise-assisted version called ensemble-EMD (EEMD) is proposed. The method defines the true IMF components as the mean of an ensemble of trials. Each trial consists of the signal plus an additive a white noise [16]. However, EEMD has huge computational load. Recently, a fast realization version of EEMD (FEEMD) was provided by Wang et al. [17]. The new version has much less computation load than the original EEMD.Simultaneous acceleration signals are known to be helpful to remove MA. For example, in [7] the acceleration signals were used to construct a reference signal for Kalman filtering. Fukushima et al presented a spectrum subtraction (SS) technique to remove the spectrum of acceleration data from that of a PPG signal [18]. Recently, Zhang et al proposed a framework termed TROIKA for HR monitoring during subjects’ intensive exercise [1]. It consists of signal decomposition, sparsity-based high-resolution spectrum estimation and spectral speak tracking and verification. In its signal decomposition stage, TROIKA used acceleration signals to identify noise series when using singular spectrum analysis (SSA) to reduce MA.In this work, we focused on HR monitoring using a wrist-type PPG signal and a simultaneous acceleration signal during subjects’ intensive physical activities. A new method was proposed which consisted of three key parts, namely signal decomposition, spectrum estimation, and HR estimation. FEEMD was used in the part of signal decomposition, aiming to partially remove MA in a raw PPG signal and an acceleration signal. SS was used in the part of spectrum estimation. According to the correlation between the spectrum of the PPG signal and that of the acceleration signal, it was used to further remove the remaining MA spectrum in the PPG spectrum. In the part of heart rate estimation, a heuristic procedure was adopted to determine HR. Experimental results on 12 datasets collected during subjects’ fast running with the peak speed of 15km/h showed that the proposed method yielded satisfactory performance with the average absolute error being 1.83 beats per minute (BPM) (with the standard deviation being 1.21 BPM).The rest of the paper is organized as follows. Section 2 describes the materiel and method. Section 3 presents the experimental results and discussion. Conclusion is drawn in Section 4.The datasets were initially recorded and used in [1]. Twelve subjects (male, with ages ranging from 18 to 35) were enrolled for the study. For each subject, simultaneous PPG signals, acceleration signals, and a single-channel ECG signal were recorded during the subject's physical activities. All data were sampled at 125Hz. The PPG data were recorded from the wrist using a pulse oximeter with green LED (wavelength: 515nm). Both the pulse oximeter and the accelerometer were embedded in a wristband, comfortably worn on the subject's wrist. The ECG signal was recorded from the chest using wet ECG sensors, which provided the ground-truth of HR. During data recording subjects walked or ran on a treadmill with the following speeds in order:•At the speed of 1–2km/h for 30s.At the speed of 6–8km/h for 60s.At the speed of 12–15km/h for 60s.At the speed of 6–8km/h for 60se.At the speed of 12–15km/h for 60s.And at the speed of 1–2km/h for 30s.The subjects were asked to purposely use the hand with the wristband to pull clothes, wipe sweat on forehead, and push buttons on the treadmill, in addition to freely swing. The total duration of the signals recorded for each subject lasted about 4–5min.The block diagram of our proposed algorithm is shown in Fig. 1. In our experiments, the algorithm was implemented on a PPG signal and an acceleration signal (the x-axis acceleration signal). A time window of 8s was sliding on the signals with a step of 2s (overlapping 6s). In each time window, HR was estimated.The raw PPG signal and the acceleration signal in a given time window were first filtered with a band-pass filter from 0.4Hz to 5Hz using 2nd order Butterworth filter. This preprocessing procedure removed noise and MA outside of the frequency band of interest. Then these signals were normalized to be zero mean and unit variance.Simultaneous acceleration signals are helpful to remove MA via SS. However, sometimes MA spectral components in a PPG spectrum may not be well matched to the spectrum of a simultaneous acceleration signal. In this case, SS may not be helpful, and even could result in many false spectral peaks. Thus, before performing SS, we first calculated the correlation coefficient (CC) between the spectrum of the acceleration signal and that of the PPG signal. The spectrum of each signal was calculated by using Periodogram, and the magnitude was normalized to [0 1] before computing CC. For simplicity, the CC was termed spectral CC hereinafter. A threshold of spectral CC was set to determine when SS should be used. In our experiments the threshold was set to 0.5. When the spectral CC was smaller than 0.5, only the PPG signal were used to estimate the HR. Otherwise, both acceleration and PPG signals were used.In our experiments, the number of FFT points used in Periodogram was set to 4096.The idea of signal decomposition is to decompose the raw PPG signal into a number of components, and then remove those MA-related components, reconstructing a clean PPG signal [1]. Following this idea, we used EEMD to perform signal decomposition. EEMD is a noise-assisted data analysis method based on the EMD, which can alleviate the mode mixing phenomenon existing in the original EMD method. The EEMD is performed according to the following procedure [17]:(1)With a pre-set ensemble number NE, create a group of signals:sn(t)=x(t)+wn(t)for n=1, 2, ⋯, NE, where x(t) is the original PPG signal or acceleration signal,wn(t)∼N(0,σ2)is independent realizations of white Gaussian noise (WGN), andsnn=1NEare an ensemble of data sets by adding different realizations of a white noise with finite amplitude to the original PPG signal or acceleration signal.Using the standard EMD algorithm [12], decompose each sn(t) into KnIMFs (Knis another pre-set parameter) to obtain the sets{Cin(t)}i=1Knfor n=1, 2, ⋯, NE;Then, the i-th IMF can be calculated by the formula:However, the traditional EEMD proposed by Wang et al was computation-intensive [16]. Thus we adopted the fast EEMD (FEEMD) to conduct the decomposition [17].As in [13], in our experiment, the noise standard deviation (σ2) was empirically set to 0.1 times the standard deviation of the signal (x(t)). The ensemble number (NE) was set to 20. Figs. 2 and 3showed an example of the IMFs of a PPG signal and an acceleration signal of 8s respectively. For both signals, some IMFs of high frequencies were related to noise or MA, and some IMFs of low frequencies were related to low oscillations and the trend. These kinds of IMFs of both signals were removed in the proposed method.Based on our experimental analysis, we found that when the spectral CC was smaller than the threshold, the first two IMFs and the last two IMFs of the PPG signal were related to random noise and wander lines and thus were removed to yield a slightly cleaned PPG signal. In addition, when the spectral CC was larger than the threshold, the first IMF and the last three IMFs of PPG and acceleration signals were related to random noise and wander lines and thus were removed. Therefore, these IMFs were removed during signal decomposition stages.The main goal of this stage was to obtain the spectrum for HR estimation. When the spectral CC was smaller than 0.5, it indicated that the PPG signal contained fewer MA components, or the MA was not dominant in the PPG signal. Thus, SS was not performed. After the signal decomposition stage, we obtained a number of IMFs of the PPG signal, and reconstructed a new PPG signal by removing first two IMFs and the last two IMFs of the original signal. The spectrum of the reconstructed PPG signal, calculated by Periodogram, was directly used to find the spectral peak corresponding to HR as described in the next subsection.If the spectral CC was larger than 0.5, both the PPG signal and the acceleration signal were used, and the SS was used obtain the spectrum for HR estimation. The flowchart was shown in Fig. 4. In this situation, it indicated the spectra were aligned well between the PPG signal and the acceleration signal. In other words, the PPG signal contained lots of MA, which can be well approximated by the acceleration signal. Thus, SS was performed. However, instead of directly subtracting the spectrum of the acceleration signal from that of the PPG signal, we selected the spectral components of the acceleration signal which were mostly correlated with the spectrum of the PPG signal. To find these spectral components, we suggested the following method.Note that after the previous signal decomposition operation, we have obtained a number of IMFs of the PPG signal and the acceleration signal. As stated above, the first IMF and the last three IMFs of PPG and acceleration signals were removed. Given an IMF of remaining IMFs of the acceleration signal, we calculated the correlation coefficients between it and all remaining IMFs of the PPG signal, and then summated the absolute values of these correlation coefficients. The IMFs of which the summation values were within the range of [μ−σ, μ+σ] were selected, where μ was the mean and σ was the standard deviation of all the summation values. A new acceleration signal was reconstructed with these selected IMFs. After that, the spectra of the reconstructed acceleration signal and the PPG signal (reconstructed from the remaining IMFs) were estimated using Periodogram, and normalized respectively. Then, the spectrum of the acceleration signal was subtracted from that of the PPG signal. The SS was run only in the band of [0.4Hz–5Hz]. The spectrum after SS was used to find the spectral peak corresponding to HR.In order to show the performance of the spectrum subtraction after the FEEMD, Fig. 5gives an example of locating the HR spectral peak. The frequency location associated with the true heartbeat frequency (estimated from the simultaneous ECG) did not exhibit at any spectral peak in the raw PPG spectrum, while the estimated heartbeat frequency located at a spectral peak which was very close to the true heartbeat frequency after the spectrum subtraction operation.In current window, after obtaining spectrum in the band of [0.4Hz–5Hz], local maxima of the spectrum series were searched, and the first and second highest peak amplitudes were selected. Then, the frequency location of the two peaks can be estimated. Denote the frequencies of the two peaks by Fi(i=1, 2), the HRs corresponding to the two frequencies by HRi(i=1, 2), and the HR values in current and previous windows by HRcurr and HRpre respectively. The relationship between Fiand HRiwas:HRi=Fi×60i=1,2When estimating the HR, we considered the following three cases:(1)If the absolute value of the difference between HR1 and HRpre was below a threshold, the HR1 was the HR in current windows, and thusHRcurr←HR1The change of BPM values in two successive time windows rarely exceeds 10 BPM, we used a threshold of 10 BPM in our experiment.When HR1 didn’t meet the criteria, HR2 was checked whether it met the criteria. If HR2 satisfied the limitation, then we hadHRcurr←HR2If HRi(i=1, 2) were not chosen, we calculated the difference between HR1 and HRpre, the HR in current window was estimated as following:HRcurr=HRpre+5ifHRest−HRpre>threHRpre−5ifHRest−HRpre<−threTo obtain the performance of the proposed method, the ground-truth of HR in each time window was calculated from the simultaneously recorded ECG signal. For each time window, we counted the number of cardiac cycles H and the duration D (in seconds), and then calculated the HR as 60 H/D (in BPM).Multiple evaluation indexes were used. HRtrue(i) denotes the ground-truth of HR and HRest(i) denotes the estimated HR, in the i-th time window. The average absolute error was defined as:Aerror=∑i=1NHRest(i)−HRtrue(i)where, N is the total number of time windows. The standard deviation of the absolute error was also calculated. Besides, the average absolute error percentage was defined asAPerror=∑i=1NHRest(i)−HRtrue(i)HRtrue(t)In addition, the Bland–Altman plot [19] was also used to examine the agreement between ground-truth and estimates, which shows the difference between each estimate and the associated ground-truth against their average. Limit of Agreement (LOA) in this analysis was calculated, which is defined as [μ−1.96σ, μ+1.96σ], where μ is the average difference and σ is the standard deviation. In this range 95% of all differences are inside. Pearson correlation between ground truth and estimates was also evaluated.

@&#CONCLUSIONS@&#
