@&#MAIN-TITLE@&#
A low cost approach for brain tumor segmentation based on intensity modeling and 3D Random Walker

@&#HIGHLIGHTS@&#
An unsupervised, low cost, hybrid approach for brain tumor segmentation is proposed.Global intensity modeling and local intensity variation are incorporated.Applicability to different malignancy grades.Our approach requires only routine MRI.This study might provide a decision-support tool for neoplastic tissue segmentation.

@&#KEYPHRASES@&#
Tumor segmentation,Outlier detection,Random walks,Brain neoplasms,Magnetic resonance imaging (MRI),

@&#ABSTRACT@&#
ObjectiveMagnetic resonance imaging (MRI) is the primary imaging technique for evaluation of the brain tumor progression before and after radiotherapy or surgery. The purpose of the current study is to exploit conventional MR modalities in order to identify and segment brain images with neoplasms.MethodsFour conventional MR sequences, namely, T1-weighted, gadolinium-enhanced T1-weighted, T2-weighted and fluid attenuation inversion recovery, are combined with machine learning techniques to extract global and local information of brain tissues and model the healthy and neoplastic imaging profiles. Healthy tissue clustering, outlier detection and geometric and spatial constraints are applied to perform a first segmentation which is further improved by a modified multiparametric Random Walker segmentation method. The proposed framework is applied on clinical data from 57 brain tumor patients (acquired by different scanners and acquisition parameters) and on 25 synthetic MR images with tumors. Assessment is performed against expert-defined tissue masks and is based on sensitivity analysis and Dice coefficient.ResultsThe results demonstrate that the proposed multiparametric framework differentiates neoplastic tissues with accuracy similar to most current approaches while it achieves lower computational cost and higher degree of automation.ConclusionThis study might provide a decision-support tool for neoplastic tissue segmentation, which can assist in treatment planning for tumor resection or focused radiotherapy.

@&#INTRODUCTION@&#
Treatment of brain neoplasms is in close relationship to the knowledge of the extent and degree of neoplastic infiltration. Thus the quantification and spatial localization of neoplastic tissue are of greatest importance for diagnosis, treatment planning and therapeutic monitoring. Brain tumor detection and tissue characterization is usually based on Magnetic Resonance Imaging (MRI) which provides a great means for assessing the disease evolution and efficacy of therapy [1,2].Brain neoplasms consist of enhancing neoplastic/tumoral tissue, non-enhancing tissue, edematous tissue and non-vital tissue, known as necrosis. Tumor necrosis can occur as a result of radiotherapy as well as by the tumor growth itself, as in glioblastomas. In clinical practice, expert radiologists obtain complete information about the brain tumor by multi-channel MR imaging and perform the delineation task manually. However, a non-automated segmentation process is subject to variations, not only between different radiologists but also by the same expert [3,4]. Moreover, the neoplastic tumor can vary significantly in geometric properties, location and degree of enhancement among patients, making the segmentation and characterization of brain abnormalities a very demanding, difficult and highly time consuming task. In particular, some neoplasms deform the surrounding healthy structures or appear together with edema causing changes in intensity properties of the nearby region, thus tissue characterization becomes a very complex task.In addition to the structural complexity of the tumoral tissue, clinical experts characterize brain tissue based on visual examination of 2D image slices with limited consideration of the informative 3D brain structure; thus inconsistencies across slices might occur. Therefore, fully automated systems that exploit multiparametric brain imaging techniques are considered necessary.Classifying and characterizing neoplastic tissue generally requires information of several MR protocols and contrasts, as the axial 3D T1-weighted (T1) and T2-weighted (T2), Fluid Attenuated Inversion Recovery (FLAIR), axial 3D contrast enhanced T1 contrast-enhanced (T1ce) images. Intravenous contrast agents augment lesion conspicuity and reveal enhancement characteristics that can help improve specificity [5]. In T1ce, blood vessels and part of the tumoral tissue where the contrast agent (gadolinium) passed the blood-brain barrier, are observed as hyperintense regions, while necrotic tissue is observed as hypointense since there is no blood flow into this area. FLAIR, on the other hand, highlights mostly tissue with increased water content, such as edema [6]. Additionally, several advanced imaging techniques have been used to provide complementary information about tumoral or edematous tissue, such as Perfusion Imaging, Diffusion Imaging, or Spectroscopic Imaging [5]. However, such imaging techniques have inherently low signal-to-noise ratio compared to conventional MR modalities and, in addition, such acquisitions are not performed in clinical routine, especially during regular follow-up.There have been considerable efforts to develop automated or minimally interactive [1,7,8] computer-based approaches for segmenting different tissue types in human brain using MRI data. Clustering algorithms [9], atlas-based methods [10,11], deformable models [12,13] and (semi)supervised classification techniques [1,14,15] are used in literature for brain tumor segmentation. A review of pattern recognition methods for (semi)automatic brain tumor segmentation based on human brain magnetic resonance images can be found in [16,17]. Atlas-based approaches [10,11] deal with the segmentation as a template matching problem, where registration techniques [18–20] are used to transfer labels from a pre-labeled atlas to the subject space. These approaches incorporate prior knowledge about the normal brain tissue of healthy individuals. However, registration itself is challenging, especially for the human cortex due to the high variability of the cortical shape. Atlas registration of brain images with tumors, as required by the segmentation approaches that incorporate tissue probability maps, becomes an even more challenging problem for two fundamental reasons. Firstly, there is no diffeomorphic transformation that can solve this problem (one-to-one mapping is not preserved due to the existence of tumor in patient's image). Secondly, due to the growth of brain tumors healthy tissue is distorted and therefore the normal tissue in a patient's brain image might not correspond to the normal tissue in a probability map within the expected range of displacements. Gooya et al. [21] proposed a method to overcome this limitation by jointly segmenting gliomas and registering the MR images to a probabilistic atlas of healthy individuals. This method however has a very high computational cost.Approaches based on deformable models, formulate the problem of tumor segmentation as an optimization task where the segmentation boundary is obtained by the optimization of an appropriate energy function. The random field methods [22] perform image segmentation by minimizing an energy function defined on the graph corresponding to the image. Active contours and level sets, starting with an initialization, evolve the segmentation boundary until the desired segmentation is achieved. Xie et al. [12] proposed a hybrid level set (HLS) method, where both region- and edge-based terms are employed in an active contour framework for the segmentation of brain tumors and edema. Here, the segmentation boundary is primarily driven by the region-based term, and the edge-based term is only used as a stopping force to inhibit the progress of the segmentation boundary across the tumor edges. In another study [13], the authors used symmetry analysis and constrained deformable models for brain tumor segmentation exploiting T1-weighted acquisitions. This method does not consider edematous tissue as separate class while user interaction is needed. Furthermore, several supervised pattern classification approaches have been used for brain tumor segmentation. Nan Zhang et al. [23] integrated SVM classification with a selection of the features in a kernel space to learn the tumor profile from the first MRI examination. Yet, such supervised classification methods are subject to inter- and intra-rater variability and also demand the collection and labeling of large training sets, which is highly time consuming.In our preliminary work [24], we integrated graph-based segmentation with intensity modeling in order to characterize brain tissue in 2D MR images. In this study we build upon this work by expanding the analysis into 3D and improving the methodology to achieve more accurate segmentation, applicable to enhancing masses. Here, the proposed methodology segments normal and abnormal tissues, including white matter (WM), gray matter (GM), cerebrospinal fluid (CSF), non-necrotic enhancing neoplastic tissue (ET) and non-enhancing tissue (non-enhancing neoplastic, edema and necrosis) (EDM/NET), in a multiclass tissue characterization problem. Since the scope of this study is not to perform healthy tissue segmentation, we evaluate our results only for the aforementioned abnormal tissues. Its application to several datasets with various tumor shapes, intensities and locations shows that it can automatically detect and segment enhancing neoplastic and edematous regions with good quality. Moreover, we perform intensity- and topology-based sensitivity analyses in order to evaluate the effect of the seed generation in the proposed framework. The main strengths of this methodology can be summarized in the following:•Its low computational cost, since it does not require manual labeling of training samples, neither atlas registration nor computationally expensive modeling.Its automated and hybrid nature, which incorporates outlier detection based on global intensity modeling in the first step, and a modification of the Random Walker algorithm [25] based on local intensity variation in the second step by exploiting the information provided from multiparametric 3D MRI.Its applicability to different malignancy grades.It requires only routine MRI.The remainder of this paper is organized as follows. In the next section, the data and methods incorporated in the proposed framework are presented, while in Section 3, experimental results are shown. The last two sections are devoted to some discussion and concluding remarks.Let the intensities in an MR image be denoted as a vectorh={h1,h2,…,hv}then, the underlying segmentation is denoted asℑ={ℑ1,ℑ2,…,ℑv}whereℑvindicates to which tissue type the voxelv∈Vbelongs. Assuming that there are C tissue types, the probability of voxel v to belong to a specific class li, i∈[1, C] is denoted as xopt, where liis a unit vector whose ith component is one and all the other components equal to zero. Then, the label with the highest probability is assigned to each voxel, as(1)ℑv=argmaxli{xopt}vIn this paper, we propose an unsupervised framework to initialize and drive a graph-based segmentation technique. We utilized the graph-based Random Walker algorithm [25] to segment different abnormal and healthy tissue types through the estimation of the probabilities xopt. The Random Walker algorithm treats images as a graph of nearby voxels and requires user-defined seed points (pre-labeled voxels) to initialize its process. In this study, a multiparametric scheme is introduced for the generation of seed points for tumor and brain tissue which models the tissue intensity profile using conventional MR modalities. Healthy tissue is segmented by applying unsupervised classification and abnormal tissue is segmented based on outlier detection. Thus the total framework follows a hierarchical approach where segmentation is first performed, in a first step, by modeling the tissue intensity in a global scale and then the segmented boundaries are locally refined, in a second step, by applying graph-based segmentation which accounts for local intensity differences.In more details, in the 1st step of the framework the method identifies the abnormal tissue as samples, which deviate from the expected profile of healthy tissue. As an example, Fig. 1illustrates the multivariate image intensity of T1ce, T2 and FLAIR MR sequences of normal and abnormal tissue samples extracted from expert-defined regions of some of the real data used in this study. As shown, there is a distinction between healthy tissue and abnormalities, however not without overlap, making thresholding techniques not sufficient for accurate segmentation. Therefore, we first apply an intensity-based outlier detection methodology to approximately segment abnormal tissue. Then, based on intensity tissue profiles, our method decomposes the detected abnormal tissue into ET and EDM/NET regions, along with the segmentation of the three healthy tissues. This step consists of (1) unsupervised clustering, (2) histogram analysis and (3) intensity and spatial constraints. In the 2nd step of the framework, the modified Random Walker is applied for multiclass segmentation, initialized by the segmented normal and abnormal seed regions. Fig. 2illustrates the different stages of the proposed framework. Datasets from different sites including a total of 57 real patients are tested and compared to manual delineation of brain neoplasms, along with 25 synthetic images. The segmentation accuracy is assessed by sensitivity analysis and overlap metrics.Initially, some image slices including only healthy tissue are depicted from each patient as training samples, while the remaining slices are considered as test samples. Broadly speaking, MR imaging enables the acquisition of different types of tissue contrast by varying excitation and repetition times. By modifying MR sequence parameters, anatomical images can emphasize contrast between gray and white matter (e.g. T1-weighted with short repetition time and short echo time) or between brain tissue (WM and GM) and cerebrospinal fluid (e.g. T2-weighted with long TR and long echo time) [6]. To this end, the healthy image slices are segmented into WM, GM and CSF using the fuzzy c-means (FCM) algorithm [26] based on T1 and T2 sequences. In the absence of explicit expert knowledge, we utilize these samples to guide our model toward brain tumor identification. Abnormalities are, then, detected as deviations from the calculated healthy tissue, using the Mahalanobis distance (MD) as distance metric. The MD is calculated for each voxel v and each segmented healthy tissueli,i=1,2,3, as follows:(2)MDi2(v)=∑ihv−ci′⋅∑i−2⋅(hv−ci)wherehv∈ℝp(p is the number of parameters, i.e. T1ce and FLAIR intensities) is the feature vector for voxel v, clis the mean intensity of each segmented healthy tissue cluster andΣi−2indicates the inverse intensity variance of the data in class li. Three MD maps (Fig. 3c–e) are created, one for each of the three healthy tissue clusters, expressing the probability of each voxel to be an outlier. Consequently, the abnormal tissue is detected by sampling the overlap of high confidence regions of the three MD maps, i.e. regions VO⊆V for whichMDi2≥t,i={1,2,3}(where t is a density threshold above which a region is considered abnormal). Here, the threshold value t is determined by selecting the 35% highest probability. Based on our experimental results (for all the three different datasets) the segmentation process is not too sensitive to the choice of this value.Since some false positives (FPs), i.e. voxels wrongly identified as abnormalities are included in the acquired abnormality segmentation, we apply intensity constraints to reduce the FPs. It was noticed that most FPs appeared in regions with FLAIR hypointensity (e.g. between or within the ventricles), thus detection is restricted to only hyperintense regions in FLAIR sequence. The applied intensity threshold is not selected the same for all subjects, because images might differ in contrast and brightness levels even if intensity standardization is previously applied to factor out this variance. Based on the assumption that the probability of a voxel to be detected as false positive is inverse proportional to its intensity profile in FLAIR sequence and the pathological region occupies no more than 20% of the brain, the threshold value is determined by analyzing the image histogram for each individual and by selecting the 20% highest intensity in FLAIR images. Fig. 3f shows the detected abnormal mask (neoplastic tissue, edematous tissue and remaining FPs) after the imposition of intensity constraints.In addition to the aforementioned outliers, many spurious small structures (mainly blood vessels) observed as hyperintense in T1ce or FLAIR modalities, are detected as voxels belonging to the tumoral or edematous tissue (Fig. 3f). Assuming a minimum volume of the tumor mass, we eliminate these irrelevant outliers, by introducing spatial constraints and considering voxels as connected components of an undirected graph. During this step, we set an upper limit on the number of possible tumor clusters (e.g. Nf=1 or 2). The retained tumor clusters are the Nflargest (regarding total volume) spatially connected components (i.e. voxels)v∈Vcon⊆VO. This post-processing step was capable to detect tumoral region, even if it had a small size, for all the patients among the three datasets. Connected-component analysis is performed by application of the union-find algorithm [27] using 6-connectivity as the elementary 3D neighborhood of the morphological operation. We examined also 18 and 26-connected neighborhood but it provided less accurate results, since more misclassified components were maintained. At the end of this step, the extracted abnormal mask includes both neoplastic and edematous regions. A segmentation example is depicted in Fig. 3g.Finally, we aim to differentiate ET from EDM/NET, as well as the three healthy tissues, in order to determine seeds for all the classes. For this purpose, the detected abnormal mask Vconis subtracted from the brain and the remaining healthy brain tissue is segmented into CSF, GM and WM using unsupervised clustering with FCM [26]. ET is separated from EDM/NET by clustering (instead of hard thresholding) the detected abnormal mask in T1ce modality. The ET cluster is identified as the cluster with the highest average T1ce value (Fig. 3h) while the remaining voxels are segmented as EDM/NET. As previously, this step is performed by applying the FCM algorithm. Then, all image voxels corresponding to the abnormal and healthy clusters are used as pre-labeled seedsv∈VL⊆V(i.e. seed regions) for the modified 3D Random Walker. We have also experimented using only seed points from the skeleton of each region, assuming that voxels with distinct tissue probability and far from the uncertain tissue boundaries would better guide the Random Walker, but observed that the accuracy of the final segmentation of the tumoral tissue dropped. This observation supports our assumption that the probability models, learnt in the first step of the method, differentiate partial volume from tumoral tissue. The class differentiation of these “uncertain” seeds is lost during skeletonization and Random Walker seems not to be able to recover it.The Random Walker algorithm is a graph-based image segmentation technique, used in combination with user-defined seeds. Assuming that the image is a given graph G=(V, E), each voxel in the image represents a vertexv∈V, which connects with neighboring voxels through an edge e∈E⊆V×V, representing the relationship of these voxels. In a weighted graph, a weight rjk∈R is assigned between the nodes j, k∈V, based on imaging features. The random walk method consists of computing the probability, that a “random walker”, starting at an arbitrary node, first reaches a pre-assigned node with a particular label [25]. In image segmentation problems, given a subset of pre-defined marked vertices VL, a graph-theoretic Random Walker optimization labeling problem is defined and solved by(3)xopt=argminx12∑ejk∈Erjk(xjli−xkli)2wherexvliindicates the probability of vertexv∈Vto belong to a specific class li, i∈[1, C]. Consequently, the solution Xoptis a V×C matrix containing the probability of vertex v to belong to the label li. Then, in order to acquire the final undirected labeled (i.e. segmented) graphℑv∈[1,C], we assign to each vertex the label with the highest probability, as defined by Eq. (1).In this study, we adapt the original 2D Random Walker algorithm to 3D MR images in order to capture also relations across axial slices in brain structure. Here, 6-neighbor connectivity is used to handle the volumetric datasets. A Gaussian weighting function is utilized to connect voxel j and voxel k, defined as(4)rjk=e−λhj−hk2where hjand hkare the feature vectors of voxels j, k∈V and λ is a constant penalizing dissimilarity, which is the only free parameter in the algorithm. Low edge weights indicate high probabilities of region margin evidence between two neighboring voxels thus prevent a Random Walker crossing these boundaries. In general, the above feature vectors could represent texture [28,29], symmetry [13] or spatial features. In our analysis, only intensity features are used aiming at a lower computational cost. Specifically, intensities of T1ce, T1 and FLAIR modalities are used as 3-dimensional feature vectors. During our analysis the free parameter λ is assigned to its default value (λ=90). The performed experiments showed that the segmentation is not sensitive to the choice of λ.Summarizing, the applied Random Walker algorithm proceeds as following:•An undirected weighted graph is constructed. The graph represents the image and the connectivity neighborhood structure defines the topology of the graph.Seeds of C=6 different labels, generated as described in the previous section, are used as initialization nodes for the healthy and abnormal brain tissues (i.e. ET, EDM/NET, GM, WM and CSF), as well as the background.Eq. (3) is solved through a sparse linear system to obtain xopt.The label corresponding to the highest probability is assigned to each vertex. The resulted labeled 3D-graphℑvrepresents the segmented image.The methodology is applied to three different datasets. All datasets include for each patient the T1, T2, FLAIR, and T1ce MR images. For all three datasets, the patients utilized in our analysis are part of larger groups with the exclusion criterion being the absence of tumor enhancement.The first dataset (DataSet1) consists of 34 patients (age 28–83 years) with a diagnosis of brain neoplasm. All patients underwent biopsy or surgical resection of the neoplasm with histopathological diagnosis. The total of 34 brain masses were graded based on WHO criteria as metastasis, meningiomas grade I, gliomas grade II, gliomas grade III, and glioblastomas grade IV. The patients were imaged using a 3.0-T MRI scanner system (Magnetom Trio Tim System; Siemens Medical Systems, Erlangen, Germany), with a multichannel phased-array coil. The imaging acquisition protocol was the same for all patients and included the following sequences (among others): axial three-dimensional T1-weighted (T1) (matrix size 192×256), sagittal T2-weighted (T2) (matrix size 256×320), FLAIR (matrix size 192×256). Axial 3D contrast-enhanced T1-weighted images (T1ce) were obtained after administration of a standard dose (0.1mmol/kg) of gadodiamide with a power injector (Medrad, Idianola, PA). The images of DataSet1 (Table 1) were preprocessed following a number of steps, including noise reduction, bias-field correction, and rigid intra-subject registration in order to co-align all sequences using the public software package FSL [30]. The co-registration of all sequences (T1, T1ce, T2, FLAIR) is performed with the rigid registration algorithm FLIRT [31] from FSL. Skull stripping was first performed (using BET [32]) to generate a brain tissue mask from the T1 image and histogram matching followed to make the intensities comparable across patients. Regions of interest (ROIs) for the abnormal tissue were manually traced by an expert neuroradiologist and used for the assessment of the proposed method. Further information about the DataSet1 can be found in [29].The second (DataSet2) and third datasets (DataSet3) are obtained from the NCI-MICCAI2013 Challenge on Multimodal Brain Tumor Segmentation [33] organized by K. Farahani, M. Reyes, B. Menze, E. Gerstner, J. Kirby and J. Kalpathy-Cramer. The challenge database contains fully anonymized images from the following institutions: ETH Zurich, University of Bern, University of Debrecen, and University of Utah and publicly available images from the Cancer Imaging Archive (TCIA). These datasets provide a common framework for comparison between different segmentation approaches [34–43]. DataSet2 consists of real multi-contrast MR scans of 23 glioma patients (3 low-grade and 20 high-grade) along with expert annotations similar to DataSet1. All volumes are linearly co-registered to the T1 contrast image, skull stripped, and interpolated to 1mm3 isotropic resolution. No attempt was made to put the individual patients in a common reference space. The patients and tumor characteristics for DataSet2 (along with DataSet1) are presented in (Table 1). DataSet3 contains T1, T2, FLAIR, and T1ce synthetic images for 25 high-grade glioma subjects along with ROIs for two abnormal classes (ground truth), as described in [44]. The developed method [44] combines physical and statistical modeling to generate synthetic multimodal 3D brain MRI with tumor and edema, along with the underlying anatomical ground truth, emphasizing on the major effects known for tumor MRI, such as contrast enhancement, local distortion of healthy tissue, edema infiltration, destruction and deformation of fiber tracts, and multimodal MRI contrast of healthy and pathological tissue. Interestingly, this scheme also simulates different patterns of enhancement (i.e. ring, uniform, and no enhancement) by introducing vascular information typically observed in real tumor MRI. In DataSet3, the first abnormal class includes enhancing and non-enhancing tumor and necrosis, while the second one corresponds to edema. Since our method does not differentiate non-enhancing tumor from edema, for DataSet3 the assessment is based only on the total abnormal tissue.The segmented abnormal tissues, obtained by our method, are compared against expert-defined ROIs, considered as the gold standard. Two ROIs are used in this study: (i) ET that includes all non-necrotic enhancing neoplastic tissue and (ii) EDM/NET that depicts the rest of the abnormal region including peritumoral edema, possible neoplastic infiltration and necrosis. For DataSet1, ET is marked avoiding the peritumoral edema by tracing the FLAIR image, while EDM/NET is traced using both FLAIR and T2 images by drawing the ROI surrounding the high signal intensity seen on these sequences. For DataSet2 and DataSet3 the provided masks are merged to form similar (with DataSet1) ROIs.The identification of edematous and neoplastic regions is quantitatively assessed using four measures of spatial overlap: (1) false positive rate (FPR), (2) true positive rate (or Sensitivity), (3) dice coefficient (DCC), and (4) Hausdorff distance (HD). If the notations M and A represent the manual segmentation determined by clinical expert and the automated segmentation, respectively, then the previous overlap measures are defined as follows:(5)FPR=M¯∩A/M¯(6)Sensitivity=M∩A/M(7)DCC=2M∩A/M+A(8)HD=max{supa∈Ainfm∈Md(a,m),supm∈Minfa∈Ad(a,m)}The bar indicates the negation operator, the |•| indicates the number of voxels in the ROI, while sup, inf and d() represent the supremum, infimum and Euclidean distance, respectively.

@&#CONCLUSIONS@&#
