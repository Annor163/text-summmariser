@&#MAIN-TITLE@&#
Integrated lung field segmentation of injured region with anatomical structure analysis by failure–recovery algorithm from chest CT images

@&#HIGHLIGHTS@&#
Automatic segmentation of lung anatomical structures: airways, lung vessels and lung lobes.Combination of segmented lung lobes and diffuse lung disease classification.Airway segmentation by failure tracking and recovery algorithm.

@&#KEYPHRASES@&#
Airway segmentation,Pulmonary vessels segmentation,Diffuse lung diseases classification,

@&#ABSTRACT@&#
This work proposes a functionality for computerized tomography (CT) based investigation of diffuse lung diseases diagnosis that enables the evaluation of the disease from lung anatomical structures. Automated methods for segmenting several anatomy structures in chest CT are proposed: namely the lobe lungs, airway tree and pulmonary vessel tree. The airway and pulmonary vessel trees are segmented using a failure tracking and recovery algorithm. The algorithm checks intermediary results consistence, backtrack to a history position if a failure is detected. The quality of the result is improved while reducing the processing time even for subjects with lung diseases. The pulmonary vessels are segmented through the same algorithm with different seed points. The seed for the airway tree segmentation is within the tracheal tube, and the seed for the pulmonary vessels segmentation is within the heart. The algorithm is tested with CT images acquired from four distinct types of subjects: healthy, idiopathic interstitial pneumonias (IIPs), usual interstitial pneumonia (UIP) and chronic obstructive pulmonary disease (COPD). The main bronchi are found in the segmented airway and the associated lung lobes are determined. Combining the segmented lung lobes and the diffuse lung diseases classification, it is possible to quantify how much and where each lobe is injured. The results were compared with a conventional 3D region growing algorithm and commercial systems. Several results were compared to medical doctor evaluations: inter-lobe fissure, percentage of lung lobe that is injured and lung and lobe volumes. The algorithm proposed was evaluated to be robust enough to segment the cases studied.

@&#INTRODUCTION@&#
Segmentation of the pulmonary lobes is important to locate parenchymal disease inside the lungs and to quantify its distribution. The segmentation issue becomes even more challenging with regard to the high variability of the computerized tomography (CT) image in clinical practice due to the use of different CT scanners and protocols. One might think that the first step for lung structure recognition is to extract inter-lobe fissures and use them to divide the lung regions. However, the inter-lobe fissures are very thin surfaces with light density in CT images and difficult to be observed from original CT images even by human experts [1].The left lung is divided into two lobes, upper and lower, by an inter-lobe fissure. The right lung is divided into three lobes, upper, middle and lower, by two inter-lobe fissures. Pulmonary fissures are often only incomplete or not clearly visible in the CT image because of severe lung diseases and low image resolution. Previous approaches to lobe segmentation can be roughly divided into two groups: direct and indirect. The former approaches consist of methods that search for the fissures based on gray-level information present in the image [2–5], while the latter approaches consist of methods that use information from other anatomical structures to approximate the location of the fissures [6,7]. Different techniques were used by the direct methods; Zhang et al. [4] presented a method for automatic segmentation of the oblique fissures using an atlas-based initialization procedure, in which the anatomic atlas is created by manually delineating the fissures on a number of subjects. Wiemker et al. [2] proposed an automatic segmentation approach based on 3D filtering of the image data. More recently, van Rikxoort et al. [5] described a nearest-neighbor classifier approach to identify voxels on the fissures.Among the indirect approaches, Kuhnigk et al. [6] proposed a method for the indirect estimation of the lobes, using information from the segmented vasculature. In a similar approach, Zhou et al. [7] reported a method based on the Voronoi division of the lungs using the lobar bronchi. Neither indirect approach was evaluated by their authors. The approach proposed herein is classified as indirect. As a secondary objective, we also propose a 3D segmentation algorithm that can extract the airways and lung vessels. Such lung anatomical structures are used to determine the fissure location.3D segmentation of the airway from multi-slice CT is useful for analyzing airway compression and obstruction caused by pathology. The expected benefits are related to diagnosis improvement of airway pathologies, preoperative planning and follow-up. Accurate lung segmentation allows the detection and quantification of abnormalities within the lungs. It is a challenging problem due to the inhomogeneity of the bronchial lumen and bronchial wall gray levels along different subdivision orders. Several methods have been presented in the literature for this task. The methods proposed can be classified into three main categories: (1) 2D/3D techniques detect potential airway sections on 2D axial images and then perform the selection of the candidates which will provide the 3D reconstruction [8]. (2) 3D region growing techniques act directly on the 3D image. They combine thresholding and 3D propagation procedures in order to generate an airway tree reconstructed set, connected to a seed defined inside the trachea. With these techniques, the reconstruction accuracy depends directly on the threshold setting. Adaptive thresholding cannot ensure a reliable reconstruction due to the inhomogeneity of the airway lumen along the tree structure [9]. (3) Hybrid methods combine 3D region growing and 2D segmentation approaches to detect more airway candidates and to obtain smoother edges. Even if they provide better results [10], the main limitation of these techniques remains their inability to reconstruct high order bronchi: the 2D and 3D segmentation phases being independent, their common limitations are inherited by the hybrid method.Extraction of vessels in CT is a key component for the diagnosis of vascular diseases, such as stenosis, hypertension and embolism. The vessel tree is also an important cue for registering images of the same patient. Another role of vessel tree extraction is an aid to improve detection of other structures, such as lung nodules, which has shown to help reduce false positives [11,12]. Different approaches have been used to segment lung vessels. Kirbas and Quek [12] divided vessel segmentation algorithms and techniques into six main categories: (1) pattern recognition techniques, (2) model-based approaches, (3) tracking-based approaches, (4) artificial intelligence-based approaches, (5) neural network-based approaches, and (6) miscellaneous tube-like object detection approaches.Although the correct diagnosis of diffuse lung disease is very important, it is one of the most difficult tasks for radiologists, because the contrast of lesions is often low and the patterns of opacities are very complex. Diffuse lung disease represents a large and heterogeneous group of disorders. In the management of patients with diffuse lung diseases, it is important to define the extent of disease present, particularly if the patient is being monitored for disease progression or response to treatment. Since lung diseases are commonly nonuniform in their distribution, physiologic measurements may underestimate the extent of lung diseases. The method chosen for feature extraction is clearly critical to the success of texture classification. In this work, diffuse lung diseases are classified using the algorithm proposed by Asakura et al. [13], which was already tested by several hospitals with different CT scanners and protocols [14].This work investigates an anatomical classification technique for lung structures and integrates it with the diffuse lung disease classification approach proposed by Asakura et al. [13], such system was already tested by several hospitals with different CT scanners and protocols [14]. This work is structured as follows. Section 2 explains the improved algorithm to classify diffuse lung diseases. Section 3 briefly explains the system proposed to integrate the determined lung structures with classified diffuse lung diseases. The algorithm proposed to segment airway, pulmonary vessel and lungs is also explained. Section 4 presents some results; the conclusions and future works are in Section 5.Texture classification has been a significant research topic in image processing, particularly in medical image analysis, and many features have been proposed to represent texture. Five major categories of features for texture identification have been proposed: statistical, geometrical, structural, model based and signal processing [15]. In order to classify diffuse lung diseases the algorithm proposed by Asakura et al. [13] was improved such that images from multiple CT scanners can be processed using the same database. Fig. 1 shows the flow of the improved approach.Initially, a calibration process is executed for all images to normalize the standard deviation (see Fig. 1). Every pixel from the CT images is linearly interpolated between the values obtained from water and air phantoms. The CT images from subjects and phantoms are obtained on the same day. The user defines a set of patterns associated to each diffuse lung disease, called learned patterns. Similarities between the learned patterns and regions in the CT image are evaluated using a Gaussian histogram normalized correlation method and a local noise model of the chest CT images. Since the fluctuation of the CT distributes in a shape similar to a Gaussian distribution [16], the local noise of a CT pixel is assumed to be spatially random with the Gaussian distribution.After the application of the Gaussian convolution filter, the normalized correlations between the estimated distribution of CT regions and those of learning patterns with the diseased classes are calculated by the following equationr(α,β)=1A(α)A(β)∑α∈α∑β∈βl(α,β)wherel(α,β)=12πσexp−(α−β)24σ2where A(α) and A(β) are the histograms of the learning patternαand the CT regionβ, and σ is the noise model standard deviation. In this paper, σ=23.35HU (Hounsfield Units) is used. This expression allows the comparison of regions in the CT images with the learned patterns.Furthermore, because of gravity the blood flow can undergo variations that can globally influence the CT image. To reduce such influence, the user divides the lung into nine regions and defines learned patterns for each one of these nine regions (see Fig. 2). Finally, if the learned patterns are directly used; they might present some discontinuities. To overcome this possibility, depending on the region of the CT image analyzed, an interpolation is executed.The classifier has been used in different applications: evaluating the utility CT imaging to understand the response to pirfenidone therapy [17], the use of CT images to evaluate the relation between the severity of idiopathic pulmonary fibrosis (IPF) and the incidence of pneumothorax [18], among others.The proposed system architecture is shown in Fig. 3. The system proposed segments the lung 3D CT image into lung boundary, airway tree and lung vessel tree. The airway tree is anatomically classified into 5 lobes. The lung vessel tree is also classified using the airway tree classification. For each voxel in the lung vessel tree, the nearest airway tree voxel is determined and both voxels are set to have the same lobe classification. A 3D Voronoi is used to determine which part of the lung corresponds to each lung lobe.3D region growing algorithms, taking advantage of speed and simplicity, is widely used as a method for airway segmentation from CT images [19]. The algorithm is based on the fact that the bronchial lumen has low intensity and it is surrounded by the bronchial wall whose intensity is relatively high in a CT image. However, the thickness of a bronchial wall becomes thinner in the peripheral area of the lung and its intensity becomes lower (see Fig. 4). The partial volume effect creates holes in bronchial walls in CT images. Such regions where the boundary is not clear cannot be segmented correctly by a region growing method. Several methods have been proposed to overcome this problem: region growing method with adaptive threshold [8], rule based detection [10] and others [20]. Consequently, these methods proposed avoid failures by increasing complexity and computational cost.In this work, a failure tracking and recovery algorithm that admits failures is proposed. The algorithm consists of a recovering process, history storage (with plane and branch data stacking) and the main process. It is possible to backtrack to a previous state in history and re-start the processing from a safe state when a failure is detected. Its flowchart is shown in Fig. 5(b). Initially, a seed within the tracheal lumen is selected by the user. A threshold with a large enough value is fixed. Starting from the current position adjacent pixels in the current horizontal plane are analyzed (see Fig. 5(a)). A first horizontal plane is defined. Adjacent planes are searched recursively (see Algorithm 1) and stored in a stack.Algorithm 1extractionProcess.Validation is the crucial point of the algorithm because it is responsible for rejecting the current algorithm state and forcing the algorithm to return to a previous state with new threshold value (the threshold value is decremented). In the current implementation, the validation procedure uses two criteria: volume and radius. Generally, radius and volume do not change rapidly. When a new plane is determined, the algorithm checks if the new plane and the stacked planes are a viable branch. Fig. 6(a) shows several detected failures in red. If it is not a viable branch, the threshold value for the current branch is decremented and the stack of planes is reset and just the first plane remains (see Fig. 6(b)). If the threshold value becomes null then the current branch is removed from the data structure. The algorithm starts again with a new decremented threshold value. Fig. 6(c) shows the final result.A branch is represented by a stack of planes in which planes are recursively pushed considering the direction defined by the firstly included plane. Even disconnected planes can be pushed into the stack. Disconnected planes can be recombined if a bifurcation is not detected (see Fig. 7(b)). If a bifurcation is detected, the stack of planes is divided into three parts: one root and two child branches. The current branch is finished and stored in the branch stack. The initial planes for the new bifurcating branches are determined. Fig. 7(a) explains the procedure. The very first planes are horizontal and the following initial planes associated with new branches can have any angle.The identification of the lungs in thoracic CT images is a prerequisite for almost any kind of CT-based computer assistance in pulmonary radiology. In particular, the segmentation of the left and right lung is the first step towards a region based quantification of lung parenchyma. Due to the high density difference between the air-filled lung regions and soft tissue in CT images, the pulmonary airspace can usually be identified without greater efforts. For use in a clinical environment, lung segmentation must furthermore be robust against pathological alterations, have acceptable time and memory requirements [21]. Here, the lung is segmented using a conventional 3D region algorithm.In this work, the same algorithm used to segment the airway tree is applied to lung vessels segmentation, due to the high contrast between blood vessels and lung parenchyma. The algorithm for lung vessels segmentation has few differences: the vessels can have several ramifications and the validation rules are not the same. This way, at least two starting points are used and at least two vessel trees are determined. After the processing, the vessel trees are combined. The same validation rules considering volume and radius are used, and additional pulmonary vessels must be internal to the lung boundary without intersecting the airway tree.The airway tree structure is automatically classified into five lobes herein. The classification is based on the directions of the initial bronchus. Fig. 8[22] shows an anatomical atlas with approximate bronchus direction for several initial bronchi (until third bifurcation level). The anatomical atlas bronchus directions are used to classify the airway tree determined by the proposed failure tracking and recovery algorithm. The airway tree classification is used to help the lung vessel tree classification. All lung vessel tree voxels are processed and the nearest airway tree voxel is determined, and, temporarily, both voxels are associated with the same classification. Finally, the lung vessel tree is hierarchically tracked, in which the entire subtree is coherently classified. A subtree must belong exclusively to one lung lobe. A Voronoi diagram is constructed using the airway and vessel trees voxels [23]. The Voronoi regions are classified into lobes according to their original voxel classification. This algorithm is possible because the lobes represent functional units and have their own bronchial and vascular systems.The CT images were obtained from six subjects lying supine: one healthy subject, two patients with idiopathic interstitial pneumonias (IIPs), two patients with chronic obstructive pulmonary disease (COPD) and one patient with usual interstitial pneumonia (UIP).11The protocol was approved by the hospital medical ethics committee of Kanagawa Cardiovascular and Respiratory Center, and informed consent was obtained from each patient.Table 1shows several details about the CT images used. The results were validated by comparison against a conventional 3D region growing algorithm, two commercial systems and a medical expert evaluation.

@&#CONCLUSIONS@&#
