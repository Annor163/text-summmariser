@&#MAIN-TITLE@&#
A computational analysis of multidimensional piecewise-linear models with applications to oil production optimization

@&#HIGHLIGHTS@&#
A comprehensive analysis of multidimensional piecewise-linear models.A computational analysis of the piecewise-linear models in oil production optimization.Logarithmic convex combination models were mostly efficient to model pressure drops.Simulated production is improved with increased resolution of the models.

@&#KEYPHRASES@&#
OR in energy,Integer programming,Multidimensional functions,Piecewise linearization,Oil production,Pressure constraints,

@&#ABSTRACT@&#
Production optimization of gas-lifted oil wells under facility, routing and pressure constraints is a challenging problem, which has attracted the interest of operations engineers aiming to drive economic gains and scientists for its inherent complexity. The hardness of this problem rests on the non-linear characteristics of the multidimensional well-production and pressure-drop functions, as well as the discrete routing decisions. To this end, this work develops several formulations in Mixed-Integer Linear Programming (MILP) using multidimensional piecewise-linear models to approximate the non-linear functions with domains spliced in hypercubes and simplexes. Computational and simulation analyses were performed considering a synthetic but realistic oil field modeled with a multiphase-flow simulator. The purpose of the analyses was to assess the relative performance of the MILP formulations and their impact on the simulated oil production.

@&#INTRODUCTION@&#
Although technological advances have increased the diversity of energy resource alternatives, fossil energy remains a primal source of energy in the modern world. In response to the increasing demand for petroleum and highly competitive markets, the petroleum industry has been investing in innovation aiming to optimize production processes and cut operational costs.On the daily operation of oil fields several decisions are made to determine the production plan: valve configurations, well-manifold routings, and choke openings, among others. Further, the engineers have to deal with uncertainties and complex problems that arise from unexpected contingencies, such as compressor failure and choke stalling caused by equipment wear and abrasive fluid production. In existing oil fields, operational plans are reached promptly often based on a sensitivity analysis that uses simulation tools and heuristics. Even though these methods can obtain good operational plans, they do not necessarily ensure a mode of operation that maximizes the daily production.In principle, optimal production plans could be achieved by formulating the production optimization problem as a Mixed-Integer Nonlinear Program (MINLP) accounting for complex nonlinear phenomena like well production and pressure drop. Since these relations are not known explicitly, they can be approximated using nonlinear functions to cast the problem as an MINLP or using piecewise-linear models to yield a Mixed-Integer Linear Programming (MILP) problem.Although several works have applied mathematical programming methods to obtain optimal production plans (Buitrago, Rodríguez, & Espin, 1996; Alarcón, Torres, & Gómez, 2002; Camponogara & de Conto, 2009; Misener, Gounaris, & Floudas, 2009; Codas & Camponogara, 2012), only a limited number of works considered pressure drop in pipelines which cannot be neglected when the operating conditions vary due to routing operations and equipment failure, for instance.Beggs and Brill (1973) were among the first to study the representation of pressure in oil production systems, who proposed correlations between the pressure drop and flow in pipelines. Litvak and Darlow (1995) developed analytic and piecewise-linear models for representing pressure equations. The first represents more precisely the physical phenomenon and is routinely used in software for simulating flows in oil production systems. The second technique approximates pressure drops as a function of the outlet pressure and the oil, gas, and water flows.More recent works in oil production optimization considering complex operations, such as routing and pressure drop, can be roughly divided in MINLP and MILP methods. Kosmidis, Perkins, and Pistikopoulos (2004, 2005) present an MINLP optimization formulation of a production network with naturally producing and gas-lifted wells. The MINLP problem is solved by a sequence of MILP problems following a sequential linear programming strategy. On the other hand, Gunnerud and Foss (2010) present an MILP formulation for oil fields structured in clusters of independent wells, manifolds, and pipelines while the separation facilities are centralized in a platform. Piecewise linearization techniques based on special ordered sets of type 2 (SOS2) constraints are used to approximate nonlinear functions.Because the complex behavior of well production and pipeline pressure drop are not explicitly known, the synthesis of an MINLP program will entail fitting sample data from a simulator to nonlinear models, a task that itself is challenging and dependent on the space of models considered. On the other hand, piecewise-linear models have the advantage of not needing the synthesis of such relationships, being defined directly from the sample points, a property that motivates the work herein.Although some works have represented pressure drops with piecewise-linear models, a comprehensive analysis of the existing models for piecewise linearization in oil production optimization is lacking. To this end, this work presents a computational and simulation analysis of piecewise-linear models for hypercube- and simplex-based approximations of the function domains, considering an oil field modeled with a standard multiphase-flow simulator.The work is organized as follows. Section 2 defines the problem of optimizing gas-lifted oil fields as an MINLP problem. Section 3 offers a brief review of piecewise-linear functions and several MILP approximation formulations of the gas-lift optimization problem. Section 4 presents a synthetic but realistic model of an off-shore oil field, along with a computational analysis of the developed MILP formulations and a simulation analysis considering both hypercube- and simplex-based approximations. Finally, Section 5 presents some conclusions and suggests directions for future research.The problem of optimizing the daily production of a gas-lifted oil field taking into account constraints on lift-gas availability, separation capacity, well-manifold routing, and pressure constraints can be formulated as a mixed-integer non-linear program:(1a)P:maxf=∑m∈Mg(qm)-∑n∈Ncqin(1b)s.t.:∑n∈Nqin⩽qimax(1c)Foralln∈N:qin,minyn⩽qin⩽qin,maxyn(1d)∑m∈Mnzn,m=yn(1e)qn,m=qn,mpm,qinzn,m,∀m∈Mn(1f)zn,mqn,L⩽qn,m⩽zn,mqn,U,∀m∈Mn(1g)qm=∑n∈Nmqn,m⩽qm,S,∀m∈M(1h)pm=pm,S+Δpm(qm),∀m∈M(1i)pm,min⩽pm⩽pm,max(1j)0⩽yn⩽1,∀n∈N(1k)zn,m∈{0,1},∀n∈N,∀m∈Mnwith decision variables for optimization being:•qinis the lift-gas rate injected into well n;yntakes on value 1 when well n is producing and 0 otherwise. Dispite being a continuous variable it can only assume values 1 or 0 as a consequence of Eq. (1d);zn,massumes value 1 if the production of well n is directed to manifold m, and 0 otherwise;qhn,mis the flow of phaseh∈Hdirected from well n to manifold m, andqn,m=qhn,m:h∈His the vector of all phase flows;qm=∑n∈Nmqn,mis the total flow received by manifold m;pmis the pressure of manifold m;with parameters:•N is the number of oil wells,N={1,…,N}, andNm⊆Nis the subset of wells whose production can be directed to manifold m;M is the number of manifolds,M={1,…,M}andMn⊆Mis the subset of manifolds that can receive production from well n. The production of each manifold is processed by a dedicated separator;H={o,g,w}has the phase flows, namely oil (o), gas (g), and water (w);qimaxmodels the lift-gas that can be delivered by the compression station;qin,minandqin,maxare bounds on the lift-gas injection for well n typically used to ensure production stability, avoid slugging, and follow a recovery policy for the reservoir;pm,S is the operational pressure of the separator connected to manifold m;qn,L and qn,U are vectors with lower and upper bounds on the production of well n;qm,S is the processing capacity of the separator of manifold m;pm,min (pm,max) is the minimum (maximum) operational pressure for manifold m;and with functions:•f is a function composed by a function g that represents the economic benefit from oil production and a function c which represents the lift-gas injection cost, however any other continuous function can be considered such as the total oil production;qhn,mpm,qinis the flow of phase h sent by well n to manifold m given as a function of the manifold pressure and lift-gas injection, andqn,mpm,qin=qhn,mpm,qin:h∈His the vector of all phase flows;Δpm(qm) represents the pressure drop in the pipeline connecting manifold m to its adjoint separator.Among the decision variables for optimization, the ones that are actually controlled in the oil field are the well activation decisions yn, the routing decisions zn,m, and the lift-gas ratesqin.The nonlinearity in the production optimization problem arises from the nonlinear nature of the well-production functionqhn,mand the pressure drop Δpmin pipelines, which later will be approximated with piecewise-linear models. This problem extends the work of Codas and Camponogara (2012) by explicitly modeling pressure drops and considering pressure constraints.The gas compressing capacity and the bound on lift-gas injection for the wells are defined by constraints (1b) and (1c) respectively.The well-manifold routing constraints (1d) and (1e) ensure that the production of each well will be sent to precisely one manifold when the well is producing, i.e. yn=1. The production of well n sent to manifold m is zero if not routed to this manifold, i.e. zn,m=0, however the production becomes bounded by qn,L and qn,U if well n is routed to manifold m.The operational limits for well production, the mass balance equations, and separation capacity are established by constraints (1f) and (1g), while the pressure balance between manifolds and separators are given by constraints (1h) and (1i).Fig. 1illustrates the structure of the oil production system and the semantics of the decision variables. The available lift-gas rateqimaxis distributed to the active wellsqin:n∈Nwhich in turn yield multiphase flows that are directed to manifolds(qn,m:n∈N,m∈Mn)and then to the separators (qm). These flows induce pressure drops in the pipelines (Δpm(qm)) which are limited by the separator’s capacity (qm,S).The MINLP problem given above is a conceptual formulation because the well-production and pressure-drop relations are not known explicitly. An MINLP approximation may be obtained by fitting nonlinear models to sample data provided by a simulator or real measurements from the oil field. However, the synthesis and validation of such models are themselves a challenge, motivating the development of piecewise-linear models directly from the sample data to yield an MILP approximation. Since the true MINLP is not known, this work will compare the predictions induced by the piecewise-linear schemes against to the corresponding values provided by a simulator. This means that a solution close to the global optimum may be reached by solving the MILP formulation considering a sufficiently high number of sample points.The formulation of the gas-lift optimization problem presented in the previous section is non-convex due to the non-linear nature of the well production curves and the flow-line pressure drops. The feasible space for well production can be non-convex regardless of the well production function being concave. Further, the flow-line pressure-drop functions are multidimensional relationships available in phenomenological simulators, making it a challenge to be modeled and used in optimization software even when the relationships are univariate.However, non-convex piecewise-linear models can be used to approximate such complex non-linear functions, allowing the resulting MILP formulations to be solved by specialized algorithms and off-the-shelf solvers. Usually, the latter approach takes advantage on the first since it benefits from the state-of-the-art technology implemented in the solvers (Vielma, Ahmed, & Nemhauser, 2010). In this work, we approximate the non-linear functions with piecewise-linear (PWL) models and solve the gas-lift distribution problem with an MILP solver.This section starts with a brief introduction to the existing MILP models for multidimensional piecewise-linear approximation and then presents the corresponding MILP approximation formulations of problem P.The definition of piecewise-linear function is borrowed from Vielma et al. (2010) who review existing MILP models for piecewise linearization. According to Vielma et al. (2010), a continuous functionf:D→Rwith compact domainD⊆Rdis piecewise-linear if, and only if, there exists a family of polytopesP, such that∪P∈PP=D,{mP}P∈P⊆Rd, and{cP}P∈P, where:(2)f(x)=mP′x+cP,∀x∈P,P∈PLet V(P) be the set of vertices of polytope P andV(P)=∪P∈PV(P)be the set of all vertices.Figs. 2 and 3show one-dimensional and two-dimensional illustrative PWL functions respectively. The domain of the first one is D=[0,4], which is represented by a family of polytopes P={P1,P2,P3,P4}, where P1=[0,1], P2=[1,2], P3=[2,3], and P4=[3,4], and V(P1)={0, 1}, V(P2)={1,2}, V(P3)={2,3}, and V(P4)={3,4}, with the graph pointsG={(x,f(x)):x∈D}being {(0,8), (1,28), (2,14), (3,25), (4,21)}.The two-dimensional PWL function approximates the non-convex functionf(x,y)=e-y+e-x2-x2+xy-2ydepicted in Fig. 3. Its domainD=[-2,2]2is partitioned in a set of polytopesP={P1,P2,…,P|P|}which can be hypercubes or simplexes. According to Todd (1977), the J1 (Union Jack) triangulation yields a subdivision of the domain space which is compatible with all PWL models, except the SOS2 model. Fig. 3b shows the J1 triangulation for the two-dimensional PWL function depicted in Fig. 3a.The MILP models available to approximate multidimensional functions can represent the PWL functions in many different ways: convex combination of the vertices of one single polytope, set of hyperplane equations and linear inequalities, and incrementally from a set of ordered polytopes (simplexes) and vertices.These formulations split the domain of the function in a set of polytopesP∈P. Each polytope P has a set of vertices V(P), and for each vertex v∈V(P) of this polytope, there is an associated continuous variable λP,v. The representation of a graph point of the function is described as the convex combination of the vertices of each polytope.The DCC model does not require any special property for its polytopes. This model was studied by Croxton, Gendron, and Magnanti (2003), Jeroslow and Lowe (1984), Meyer (1976), and Sherali (2001). The MILP reformulation of the production functionqn,mpm,qinusing the DCC model is given by following set of equations:(3a)Foralln∈N:∑m∈Mn∑P∈Pn,m∑(qi,pr)∈V(P)λqi,prn,m,Pqi=qin(3b)pm⩾∑P∈Pn,m∑(qi,pr)∈V(P)λqi,prn,m,Ppr,∀m∈Mn(3c)pm⩽∑P∈Pn,m∑(qi,pr)∈V(P)λqi,prn,m,Ppr+pm,max(1-zn,m),∀m∈Mn(3d)∑P∈Pn,m∑(qi,pr)∈V(P)λqi,prn,m,Pqn,m(qi,pr)=q̃n,m,∀m∈Mn(3e)zn,mqn,L⩽q̃n,m⩽qn,Uzn,m,∀m∈Mn(3f)λqi,prn,m,P⩾0,∀m∈Mn,P∈Pn,m,(qi,pr)∈V(P)(3g)∑(qi,pr)∈V(P)λqi,prn,m,P=yPn,m,∀m∈Mn,P∈Pn,m(3h)∑P∈Pn,myPn,m=zn,m,∀m∈Mn(3i)yPn,m∈{0,1},∀m∈Mn,P∈Pn,mhaving the following extra parameters:•Kn,mandRn,mare the sets of breakpoints for the lift-gas rate injected in well n and pressure of manifold m;Pn,mis the set of polytopes in the production function domain for well n when its production is directed to manifold m, and the set of verticesV(Pn,m)≔Kn,m×Rn,mis defined by the Cartesian product of the set of breakpoints for the lift-gas rate and manifold pressure;and extra variables:•λqi,prn,m,Pis the weighting variable of a breakpoint pair(qi,pr)inKn,m×Rn,mthat belongs to a polytopeP∈Pn,m. When manifold m receives the production of well n, zn,mtakes on value 1 and the respective convex combination becomes active;yPn,mis a binary variable associated to each polytopeP∈Pn,mwhich assumes value 1 when the convex combination is limited to polytope P. According to constraint (3g), only the vertices of P can be part of the convex combination that defines the lift-gas injectionqininto well n and the manifold pressure pm;q̃n,mis the piecewise-linear approximation of qn,m.In the same way, the pressure drop functions Δp(qm) are piecewise linearized with each model. For simplicity, we show only the reformulation for the well production curves. Then, the objective function given in Eq. (1a) is recast as a piecewise-linear form:(4)maxf̃=∑m∈Mg(q̃m)-∑n∈NcqinThe DLog model aims to reduce the binary variables and extra constraints of the DCC model. In this formulation, each polytopeP∈Pis represented with a binary vectory∈{0,1}⌈log2|P|⌉using an injective functionB:P→{0,1}⌈log2|P|⌉. Some binary variables are required to enforce∑v∈V(P)λP,vto be one when y=B(P). Let B(P)lbe the value in position l of the binary code associated to polytope P.Pj(B,l)is the set of polytopes whose binary codes have value j∈{0,1} in position l, andL(P)is the set of indexes for the entries of a binary code B(P):Pj(B,l)≔{P∈P:B(P)l=j},j∈{0,1}L(P)≔{1,…,⌈log2|P|⌉}.Based on the works of Ibaraki (1976), Vielma, Keha, and Nemhauser (2008), Vielma and Nemhauser (2011), the well performance curve qn,mis then approximated with a piecewise-linear function using the DLog model as follows:(5a)Foralln∈N:∑m∈Mn∑P∈Pn,m∑(qi,pr)∈V(P)λqi,prn,m,Pqi=qin(5b)∑P∈Pn,m∑(qi,pr)∈V(P)λqi,prn,m,Ppr⩽pm,∀m∈Mn(5c)∑P∈Pn,m∑(qi,pr)∈V(P)λqi,prn,m,Ppr+pm,max(1-zn,m)⩾pm,∀m∈Mn(5d)∑P∈Pn,m∑(qi,pr)∈V(P)λqi,prn,m,Pqn,m(qi,pr)=q̃n,m,∀m∈Mn(5e)zn,mqn,L⩽q̃n,m⩽qn,Uzn,m(5f)λqi,prn,m,P⩾0,∀m∈Mn,P∈Pn,m,(qi,pr)∈V(P)(5g)∑P∈Pn,m∑(qi,pr)∈V(P)λqi,prn,m,P=zn,m,∀m∈Mn(5h)∑P∈P1,n,m(B,l)∑(qi,pr)∈V(P)λqi,prn,m,P⩽yln,m,∀m∈Mn,l∈L(Pn,m)(5i)∑P∈P0,n,m(B,l)∑(qi,pr)∈V(P)λqi,prn,m,P⩽1-yln,m,∀m∈Mn,l∈L(Pn,m)(5j)yln,m∈{0,1},∀m∈Mn,l∈L(Pn,m)having the additional variable:•yln,mis a binary variable associated with the lthentry of the binary code of each polytope, which induces the branching scheme in the weighting λ variables.and extra parameters:•P1,n,m(B,l)andP0,n,m(B,l)are the polytope sets associated to the injective function B which maps polytopes to binary vectors, grouping polytopes according to the index l and its binary representation B, wherePj,n,m(B,l)≔{P∈Pn,m:B(P)l=j},j∈{0,1};L(Pn,m)≔{1,…,⌈log2|Pn,m|⌉}is the set of indexes mapped by the binary vectors to represent each polytopeP∈Pn,m.The production functionqn,mpm,qinof well n depends on the pressure of the manifold m to which it is connected, pm, and the lift-gas injection rate,qin. This curve is represented by a piecewise-linear function using the CC model as follows:(6a)Foralln∈N:qin=∑m∈Mn∑(qi,pr)∈V(P)λqi,prn,mqi(6b)∑(qi,pr)∈V(P)λqi,prn,mpr⩽pm⩽∑(qi,pr)∈V(P)λqi,prn,mpr+pm,max(1-zn,m),∀m∈Mn(6c)q̃n,m=∑(qi,pr)∈V(P)λqi,prn,mqn,m(qi,pr),∀m∈Mn(6d)zn,mqn,L⩽q̃n,m⩽qn,Uzn,m,∀m∈Mn(6e)λqi,prn,m⩾0,∀m∈Mn,(qi,pr)∈V(P)(6f)∑(qi,pr)∈V(P)λqi,prn,m=zn,m,∀m∈Mn(6g)λqi,prn,m⩽∑P∈Pn,m(qi,pr)yPn,m,∀m∈Mn,(qi,pr)∈V(P)(6h)∑P∈Pn,myPn,m=zn,m,∀m∈Mn(6i)yPn,m∈{0,1},∀P∈Pn,mwherePn,m(qi,pr)={P∈Pn,m:(qi,pr)∈V(P)}andyPn,mchooses the polytope.New concepts are introduced to implement the branching scheme proposed by Vielma and Nemhauser (2011). LetSe={s0,…,sn}be the set of breakpoints on axis e andIe≔{[s0,s1],…,[sn-1,sn]}be the intervals of breakpoints. LetIe(s)≔{I∈Ie:s∈I}be the intervals containing s. Let Ξe([si,si+1])=i+1 be the index of an interval[si,si+1]∈Ie. LetB:{1,…,|Ie|}→{0,1}⌈log2(|Ie|)⌉be a SOS2 compatible function, meaning that B(i) and B(i+1) differ only in one bit according to the Gray code property. The vertices of the domain isV(P)=S1×⋯×Sdand d is the dimension. The first phase of the branching scheme uses the setsJe,B,l+≔{s∈Se:B(Ξe(I))l=1,∀I∈Ie(s)}1Je,B,l+is the set of breakpoints s on axis e such that the binary code of all intervals that contain s has value 1 at the lthposition of the code.1andJe,B,l0≔{s∈Se:B(Ξe(I))l=0,∀I∈Ie(s)}, where l∈Φ(Se)={1,2,…,⌈log2(∣Se∣−1)⌉} is the position of the binary code used to represent the intervals on axis e. Notice that the number of intervals is precisely one less the number of breakpoints.The second phase selects a simplex of the hypercube obtained in phase one using the setsLr,s={v∈V(P):vrisevenandvsisodd}andRr,s={v∈V(P):vrisoddandvsiseven},∀r,s∈D={1,…,d}, such that r<s.To piecewise linearizeqn,mpm,qin, the Log model builds the J1 triangulation and restricts the convex combination to a single simplex implicitly through the branching scheme. This is achieved with the following equations:(7a)Foralln∈N,m∈Mn,l∈Φ(Kn,m):(7b)∑qi∈Jaxis(Kn,m),B,l+∑pr∈Rn,mλqi,prn,m⩽xln,m(7c)∑qi∈Jaxis(Kn,m),B,l0∑pr∈Rn,mλqi,prn,m⩽1-xln,m(7d)Foralln∈N,m∈Mn,l∈Φ(Rn,m):(7e)∑qi∈Kn,m∑pr∈Jaxis(Rn,m),B,l+λqi,prn,m⩽xˇln,m(7f)∑qi∈Kn,m∑pr∈Jaxis(Rn,m),B,l0λqi,prn,m⩽1-xˇln,m(7g)Foralln∈N,m∈Mn,(r,s)∈Γn,m:(7h)∑(qi,pr)∈Lr,sn,mλqi,prn,m⩽yr,sn,m(7i)∑(qi,pr)∈Rr,sn,mλqi,prn,m⩽1-yr,sn,m(7j)xln,m∈{0,1},∀n∈N,m∈Mn,l∈Φ(Kn,m)(7k)xˇln,m∈{0,1},∀n∈N,m∈Mn,l∈Φ(Rn,m)(7l)yr,sn,m∈{0,1},n∈N,m∈Mn,(r,s)∈Γn,mhaving the following extra parameters:•Φ(S)={1,…,⌈log2(|S|-1)⌉};axis(Q)is the axis that contains the breakpoint setQ;Γn,m≔{(r,s)∈D×D:r<s};Lr,sn,m={v∈V(Pn,m):vrisevenandvsisodd}andRr,sn,m={v∈V(Pn,m):vrisoddandvsiseven},∀r,s∈Dsuch that r<s;and extra variables:•xln,mandxˇln,mare binary variables that induce the first phase of Log branching, for each entryl∈Φ(Kn,m)andl∈Φ(Rn,m)respectively;yr,sn,mis a binary variable that induces the second phase of the Log branching for each (r,s)∈Γn,m.The complete Log model for the piecewise-linear approximation of the well-production functions consists of Eqs. (6a)–(6f) and (7). A complete example of the Log model for a 2-dimensional function is found in Silva, Codas, and Camponogara (2012).The Multiple Choice (MC) model approximates the original function using hyperplane equations for each polytope function. The domain is divided into a set of polytopesP∈P, which are described by a set of linear inequalities APxP⩽bPyP. A domain point x is represented by the summation of all domain variables xP. For each polytope there is an associated hyperplane function that linearizes the original function inside that polytope. Finally, only one polytope can be active, which has an active domain point and its corresponding function value. This formulation was studied in Balakrishnan and Graves (1989), Croxton et al. (2003), and Jeroslow and Lowe (1984). The non-convex functionqn,mpm,qinis approximated with a PWL function using the MC model as follows:(8a)Foralln∈N:qin,m=∑P∈Pn,mqin,m,P(8b)0⩽qin,m,P⩽qin,maxyPn,m(8c)qin=∑m∈Mnqin,m(8d)pm⩾∑P∈Pn,mprn,m,P,∀m∈Mn(8e)pm⩽∑P∈Pn,mprn,m,P+pm,max(1-zn,m),∀m∈Mn(8f)q̃n,m=∑P∈Pn,mMPn,mqin,m,Pprn,m,P+cPn,myPn,m,∀m∈Mn(8g)zn,mqn,L⩽q̃n,m⩽qn,Uzn,m(8h)APn,mqin,m,Pprn,m,P⩽bPn,myPn,m,∀m∈Mn,P∈Pn,m(8i)∑P∈Pn,myPn,m=zn,m,∀m∈Mn(8j)prn,m,P⩾0,∀m∈Mn,P∈Pn,m(8k)yPn,m∈{0,1},∀m∈Mn,P∈Pn,mwith additional variables:•qin,m,Pis the lift-gas injection rate for well n when it belongs to polytopeP∈Pn,m;prn,m,Pis manifold m pressure in polytopeP∈Pn,m;yPn,mis a binary variable that takes on value 1 when polytopeP∈Pn,mis active, and 0 otherwise;and extra parameters:•MPn,mis a matrix with the coefficients of the hyperplanes that approximate the vector function qn,mwithin the polytopeP∈Pn,m;cPn,mis a vector of constants for the hyperplanes that approximate qn,mwithinP∈Pn,m;APn,mandbPn,mdescribe the linear inequalities that define polytopeP∈Pn,m. Since the matrixAPn,mmay not be full rank, Eq. (8b) is needed to forceqin,m,Pto zero whenyPn,mtakes on value zero. In this case, the pressureprn,m,Pdoes not need to be driven to zero because pmwill become a free variable, bounded by other wells connected to manifold m.The Incremental Model (Inc) approximates the original function incrementally with an ordered set of simplexes and vertices, which must induce a triangulation of the domain of the function. When approximating multivariate functions, this model requires the set of polytopesPto be a triangulationTwith special ordering properties:O1:The simplexes inTmust be ordered asT1,…,T|T|such that Ti∩Ti+1≠∅ fori∈{1,…,|T|-1}.The vertices of each simplex Timust be ordered asvi0,…,vi|V(Ti)|-1such thatvi|V(Ti)|-1=vi+10fori∈{1,…,|T|-1}.These properties ensure a total ordering among the simplexes and vertices in the domain, which is required to incrementally represent the graph of the function,G={(x,f(x)):x∈dom(f)}. Lee and Wilson (2001) showed that such conditions are met by several triangulations, inclusive the J1 (“Union Jack”). Dantzig (1960), Jeroslow and Lowe (1985), Keha, de Farias, and Nemhauser (2004), Lee and Wilson (2001), and Padberg (2000) have studied the Inc model which is also referred to as the delta method. More recently, Vielma et al. (2010), Croxton et al. (2003), and Keha et al. (2004) began calling it the incremental model. Below, the equations based on the incremental model are presented to approximate the non-convex function qn,m:(9a)Foralln∈N:qin,m=qi,1,0n,mzn,m+∑j=1|Tn,m|∑k=1|V(Tj)|-1δj,kn,mqi,j,kn,m-qi,j,0n,m,∀m∈Mn(9b)pm⩾pr,1,0n,mzn,m+∑j=1|Tn,m|∑k=1|V(Tj)|-1δj,kn,mpr,j,kn,m-pr,j,0n,m,∀m∈Mn(9c)pm⩽pr,1,0n,mzn,m+∑j=1|Tn,m|∑k=1|V(Tj)|-1δj,kn,mpr,j,kn,m-pr,j,0n,m+pm,max(1-zn,m),∀m∈Mn(9d)q̃n,m=qn,mqi,1,0n,m,pr,1,0n,mzn,m+∑j=1|Tn,m|∑k=1|V(Tj)|-1δj,kn,mqn,mqi,j,kn,m,pr,j,kn,m-qn,mqi,j,0n,m,pr,j,0n,m,∀m∈Mn(9e)zn,mqn,L⩽q̃n,m⩽qn,Uzn,m,∀m∈Mn(9f)∑k=1|V(T1)|-1δ1,kn,m⩽zn,m,∀m∈Mn(9g)δj,kn,m⩾0,∀m∈Mn,j∈{1,…,|Tn,m|},k∈{1,…,|V(Tj)|-1}(9h)wjn,m⩽δj,|V(Tj)|-1n,m,∀m∈Mn,j∈{1,…,|Tn,m|-1}(9i)∑k=1|V(Tj)|-1δj+1,kn,m⩽wjn,m,∀m∈Mn,j∈{1,…,|Tn,m|-1}(9j)wjn,m∈{0,1},∀m∈Mn,j∈{1,…,|Tn,m|-1}.having the additional variables:•δj,kn,mis a weighting variable that incrementally represents the domain into a single polytope;wjn,massumes value 1 when the variableδjˆ,|V(Tjˆ)|-1n,mof the simplexTjˆ∈Tn,mtakes on value 1, for alljˆ⩽j. In this case, Tj+1 is the active simplex of the domain;and extra parameters:•qi,j,kn,mis the breakpoint of the lift-gas injection rate for vertex k of simplex j of well n;pr,j,kn,mis the breakpoint of the pressure of manifold m for vertex k of simplex j;Tn,mis the set of simplexes that make up the family of polytopes in the domain of the production functionq̃n,mwhen well n is routed to manifold m;V(T) is the set of vertices of the simplexT∈Tn,m.The Inc model requires an ordering of the polytopes and vertices according to properties O1 and O2. In this work, the J1 triangulation was used for all simplex-based approximation models, inclusive Inc. To find such an ordering of the J1 triangulation, the approach below was followed:1.An undirected graphG=(P,E)is obtained to represent each polytope (simplex) as a vertex P, where an edge(P,P′)∈Eif and only if V(P)∩V(P′)≠∅;A weightcP,P′=1/(|V(P)∩V(P′)|)is assigned to each edge, being inversely proportional to the number of shared vertices between P and P′;A Hamiltonian pathCforGis found by a reduction to the traveling salesman problem which is solved using the Concorde solver.Finally, an ordering of the vertices is obtained by following the pathC, moving from one polytope Pkto the next Pk+1 and selecting the common verticevk|V(Pk)|-1=vk+10at random.In a pioneer work, Beale and Tomlin (1970) proposed a new representation for piecewise-linear functions based on the convex combination of the weighting variables λ’s associated with the vertices of the function domain. Among these weighting variables, only two of them can be nonzero and consecutive in the branch-and-bound algorithm. Such sets are called Special Ordered Sets of Type II (SOS2) and the constraints that use these sets are called SOS2 constraints.Nowadays some general purpose solvers support SOS2 constraints. Camponogara, Nazari, and Meneses (2012) presented an example that illustrates how the SOS2 constraints can be treated in a branch-bound procedure. Assume thatλj0,…,λjk(j)are SOS2, and letλ̃j0,λ̃j1,…,λ̃jk(j)be the solution of the linear relaxation of the problem, whereλ̃k1,λ̃k2>0for some k1, k2∈{0,…,k(j)}, k1<k2, and k2−k1⩾2. This violation of the SOS2 constraint can be ruled out in the branch-and-bound search by introducing the constraintsλj0=⋯=λjk1=0in one branch, andλjk1+2=⋯=λjk(j)=0in the other.Beale (1980) showed how to extend SOS2 constraints to multidimensional piecewise-linear functions. Instead of using binary variables, convex combinations are limited to a hypercube of the function domain using a linked chain of SOS2 constraints. The equations that represent the well-performance curveqn,mpm,qinare reformulated with SOS2 constraints as follows:(10a)Foralln∈N:qin=∑m∈Mn∑qi∈Kn,m∑pr∈Rn,mλqi,prn,mqi(10b)∑qi∈Kn,m∑pr∈Rn,mλqi,prn,mpr⩽pm,∀m∈Mn(10c)pm⩽∑qi∈Kn,m∑pr∈Rn,mλqi,prn,mpr+pm,max(1-zn,m),∀m∈Mn(10d)q̃n,m=∑qi∈Kn,m∑pr∈Rn,mλqi,prn,mqn,m(qi,pr),∀m∈Mn(10e)zn,mqn,L⩽q̃n,m⩽qn,Uzn,m,∀m∈Mn(10f)λqi,prn,m⩾0,∀m∈Mn,qi∈Kn,m,pr∈Rn,m(10g)∑qi∈Kn,m∑pr∈Rn,mλqi,prn,m=zn,m,∀m∈Mn,(10h)ξqin,m=∑pr∈Rn,mλqi,prn,m,∀qi∈Kn,m(10i)ηprn,m=∑qi∈Kn,mλqi,prn,m,∀pr∈Rn,m(10j)ξqin,mKn,m,ηprn,mRn,mareSOS2,∀m∈Mnhaving additional variables:•ξqin,mis an auxiliary variable which takes on the value of the summation of the weighting variablesλqi,prn,mover all manifold pressures pr for a particular injection rate qi;ηprn,mis an auxiliary variable which takes on the value of the summation of the weighting variablesλqi,prn,mover all qi for a particular manifold pressure pr.The auxiliary variablesξqin,mandηprn,mcompose the linked chain of SOS2 constraints that divides the domain in a grid. The SOS2 constraints (10j) limit the convex combination of the weighting variablesλqi,prn,mto be within a single polytope (hypercube).Table 1gives the number of variables and constraints of the piecewise-linear models for a general function. The total number of variables and constraints of the MILP formulation of the oil production optimization problem is omitted for being too complex, however it is a function of the size of the PWL models and the number of wells and manifolds. The size of the formulations depends on the dimension d of the function domain, the number of polytopes|P|, and the number of vertices|V(P)|or ∣V(P)∣, forP∈P, with the exception of Log, MC, and SOS2.The size of MC depends ond,|P|, and the number of facets of polytope P, denoted by F(P). In particular, whenPis a triangulation,|F(P)|=d+1,∀P∈P.For Log, the formulation size is a function of the number of vertices|V(P)|and ∣S∣, where S is a branching scheme for the J1 triangulation defined in [0,K]d, with the breakpoints being {0,1,…,K}. For the two-dimensional case,|P|=Kdd!and ∣S∣=d⌈log2(K)⌉+d(d−1)/2. For dimensionsd>2,|S|≈log2(|P|), that is,limK→∞|S|/(log2(|P|)=1(Vielma et al., 2010).In SOS2, the number of constraints is a function of the number of breakpoints in each axis of the gridG={0,1,…,K}d.This section presents a computational and simulation analysis of the MILP formulations developed for the oil production optimization problem subject to routing and pressure constraints. The oil production system used as a testbed is a synthetic but representative oil field modeled with a multiphase flow simulator widely used by oil operators. The computational analysis evaluates the performance of the MILP reformulations for both hypercube and simplex approximations. Finally, a simulation analysis is performed to analyze the mean errors and respective overall benefit of these models with respect to the results obtained with the multiphase flow simulator.The production system has N=16 wells and M=2 manifolds as illustrated in Fig. 4. All production wells can send their production to both manifolds, i.e.Nm=N,∀m∈M. Each manifold is connected to a dedicated separator.The wells and manifolds are topologically divided into two groups: the wells 1–8 are 1kilometer away from manifold 1, and 10kilometers away from manifold 2, while the wells 9–16 are 1kilometer away from manifold 2, and 10kilometers away from manifold 1. The pipelines connecting wells and manifolds have 4 inches of inner diameter (ID), and 0.001inches of roughness (R). With this topological structure,qn,m1(pr,qi)⩾qn,m2(pr,qi)if well n is closer to manifold 1 than manifold 2 for a given manifold pressure pr and lift-gas injection rate qi.The Gas–Oil Ratio (GOR) and Basic Sediment and Water (BSW) fraction are given constants for each well. The liquid flow rate of each well behaves according the equation ql=Ji(pR−pwf), where ql=qo+qw, pwfis the bottom-hole pressure, Ji is the well productivity index, and pR is the reservoir static pressure. Table 2presents the well parameters with the units of GOR, BSW, pR, and Ji being sm3/sm3, %, psi, and STB/d/psi, respectively.The production of manifold 1 flows through a pipeline of 10kilometers to reach a separator, while the production of manifold 2 flows through a pipeline of 5kilometers long. Both pipelines have negligible vertical elevation, ID=4.5inches, and R=0.001inches. The manifold pressures can vary from 300 to 800pounds per square inch, while the nominal pressure at the separator is 300pounds per square inch.All wells have identical tubings with the following features: ID of 3inches, drilling depth of 3.7kilometers, depth of 2.7kilometers, and injection point at 2.8kilometers. The maximum flow rate of each well is 8000Million standard cubic feet per day. The well performance curves used to represent this production system are available in Silva, Codas, and Camponogara (2011). This instance was obtained using the multiphase flow simulator Schlumberger Pipesim, inspired in a synthetic field from Kosmidis et al. (2004).This section presents a computational analysis of the application of the MILP formulations developed in this paper to the synthetic production system. The formulations were expressed in AMPL and solved with the MILP solver CPLEX 11.2 in a Linux workstation, with an Intel Core 2 Quad 2.93gigahertz processor and 4gigabytes of RAM. All experiments ran within a time limit of 10,000seconds (≈2.78hours). The instances for which the solver ran out of memory are indicated with an asterisk (☆).For comparing the performance of the developed formulations, we analyze the impact of the number of polytopes in the domain of the PWL functions for each scenario of gas-compression capacity. This analysis aims to verify the increase in the running time as a function of the resolution quality. The analysis considered three different scenarios of lift-gas compression capacity, namely: high forqimax=3,624,480standard cubic meters per day, medium forqimax=453,060standard cubic meters per day, and low forqimax=113,265standard cubic meters per day. The resolution qualities are:•coarse: 18 squares (six breakpoints for gas-injection and three for manifold pressure) for the production function and 25 cubes (five breakpoints for phase flow) for pressure drop in the hypercube approximation; 36 (twice the number of squares) and 150 (six times the number of cubes) polytopes for the simplex approximation, respectively;moderate: 66 squares (11 by 6) and 1000 cubes (10 breakpoints in each phase) for hypercube approximation; 132 and 6000 polytopes in the simplex approximation, respectively.fine: 180 squares (15 by 12) and 2197 cubes (13 breakpoints in each phase) for hypercube approximation; 360 and 13182 polytopes in the simplex approximation, respectively.Table 3gives the size of the oil production optimization problem for the instances considered in the computational analysis and each PWL model, as reported by the MILP solver.A computational analysis of DCC, DLog, CC, and SOS2 models is performed with hypercube approximation to the oil production optimization problem. Tables 4–6present the running time in seconds and the primal–dual gap (i.e., ∣upper-bound-best-integer∣/∣best-integer∣) for the PWL formulations considering the hypercube approximation for high, medium, and low gas-compression capacity respectively. All formulations were evaluated with coarse, moderate, and fine resolutions for each scenario of lift-gas availability.Table 4 presents the results for the scenario of high availability of compression gas. With the exception of DCC and MC, all formulations reached the global optimum, with the SOS2 formulation achieving the best performance.Table 5 presents the results for the scenario of medium availability of compression gas. All formulations reached the global optimum for coarse and moderate resolutions, with the exception of MC for which the optimum was found only for the coarse resolution. Although DLog was the most efficient for the coarse resolution, only the SOS2 formulation was capable of closing the primal–dual gap with the fine resolution.When the compression capacity becomes low, the oil production optimization problem becomes more complex and only the SOS2 formulation achieves the global optimum in all resolutions as shown in Table 6. The MC formulation reached the optimal solution only in the coarse resolution, while the others reached the optimum for coarse and moderate resolutions, but failed to close the primal–dual GAP for the fine resolution.The results from a computational analysis of DCC, DLog, CC, Log, MC, and Inc models are presented for the simplex approximation of the function domains. As before, the performance of these models considers a varying number of polytopes and three scenarios of lift-gas compression capacity.Table 7presents the running times in seconds and primal–dual GAPs for the scenarios of high compression capacity with coarse, moderate, and fine resolutions. All models reached the global optimum with coarse resolution fairly quickly. For a medium resolution, the optimal solution was found with all formulations but MC, which also achieved the worse performance with the coarse resolution. For a fine resolution, the MC model could not find a feasible solution and only the Log model succeeded to close the primal–dual GAP. For a high gas-compression capacity, the Log model outperformed all of the other models for all approximation qualities.Tables 8 and 9present the results for the scenarios of medium and low compression capacity, respectively. As the compression capacity becomes constrained, the oil production optimization problem becomes harder and the primal–dual GAP cannot be closed with most of the formulations and resolutions. This was expected because the approximation with simplex is more precise but rather complex. The results with medium and low gas-compression capacity were similar: the Log model achieved the best performance, whereas only the DCC and CC models could not reach the global optimum with the coarse resolution. With a moderate resolution, only logarithmic models (Log and DLog) closed the primal–dual GAP. With a fine resolution, the solver ran out of memory with the CC model and could not find a feasible solution, however the optimal solution was found with the Log model which was faster in all scenarios and approximation qualities.Typically, gas production from the reservoir is sufficient to sustain the nominal operation which often seeks to maximize oil production, particularly so in offshore gas-lifted oil fields. Since prices and costs are difficult to come by, the experiments considered some plausible but arbitrary values in relative terms to honor the policy of oil production maximization. To assess the impact of the costs on the objective function and computational time, a restricted sensitivity analysis was performed considering only the variation on compression cost pi, a scenario of medium compression capacity, and SOS2 for hypercube approximation and Log for simplex approximation, which were the most efficient models.Table 10shows the influence of the compression cost on solving time and objective function. As expected, the economic gain dwindles with the increase of the cost. Solving time tends to increase with a rising cost, with the Log model performing gracefully and always reaching the optimum, while SOS2 failed to close the gap in some instances. Despite the effects on solving time, the optimal or a nearly-optimal solution was always found with both models.The quality (benefit and mean error) of the solutions obtained by hypercube and simplex approximations are compared considering the oil-field performance estimated with a multiphase flow simulator. The simulation analysis evaluates the mean errors of the process variables calculated with the simulator and their optimizer predictions for the scenario of low compression capacity, considering three approximation resolutions: coarse, moderate, and fine.The objective function considered for optimization isf=∑m∈Mpoqom+pgqgm-pwqwm-∑n∈Npiqinwith po=20, pg=2, pw=1, and pi=0, which were arbitrarily defined to reflect the relative values of the production phases and costs.Tables 11 and 12present the simulated pressure flow rates handled by both manifolds according to the optimizer predictions. All optimization models suggested the same well-manifold routing. The main differences arise in the multiphase flows, pressures, and in the system total benefit.Analyzing the hypercube-based solutions shown in Table 11, it is noticeable the effect of the resolution quality on the simulated manifold production and pressure. The solution obtained with the coarse resolution has considerably high errors, mostly in manifold 2. When the resolution is increased (moderate and fine), the errors drop to under 1.5% except for the water production. Surprisingly, the moderate resolution achieves smaller mean errors than the fine resolution. However, a better solution was found with a more precise resolution, inducing a better field operation but with higher modeling errors. Further, the oil production and benefit function are increased as the resolution increases, even though a more precise resolution induces higher errors.Table 12 shows the manifold pressure and flow rates of the simplex-based solution for varying resolutions. The errors obtained with the coarse resolution were not high in manifold 1, but considerably high in manifold 2. As in the approximation with hypercubes, the errors are reduced with an increased resolution (moderate and fine resolutions). However, the moderate resolution reached a solution with smaller errors in manifold 2, while the fine resolution presented smaller errors in manifold 1. Again, it can be noticed that the oil/gas production and benefit function are increased as the resolution is improved with simplex approximation. The profit obtained in the fine resolution is about 9.89% better than with the moderate, and 9.97% better than the coarse.

@&#CONCLUSIONS@&#
