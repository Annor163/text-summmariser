@&#MAIN-TITLE@&#
Directional distances and their robust versions: Computational and testing issues

@&#HIGHLIGHTS@&#
Practical computations of directional distances and their robust versions.Conditional and unconditional distances: cases with inactive directions.Measuring the impact of environmental factors on efficiency with these distances.Bandwidth selection for conditional directional distances.Testing significance of external factors on efficiency with directional distances.

@&#KEYPHRASES@&#
Directional distances,Free Disposal Hull (FDH),Conditional efficiency measures,Nonparametric frontiers,Significance test,Bootstrap,

@&#ABSTRACT@&#
Directional distance functions provide very flexible tools for investigating the performance of Decision Making Units (DMUs). Their flexibility relies on their ability to handle undesirable outputs and to account for non-discretionary inputs and/or outputs by fixing zero values in some elements of the directional vector. Simar and Vanhems (2012) and Simar, Vanhems, and Wilson (2012) indicate how the statistical properties of Farrell–Debreu type of radial efficiency measures can be transferred to directional distances. Moreover, robust versions of these distances are also available, for conditional and unconditional measures. Bădin, Daraio, and Simar (2012) have shown how conditional radial distances are useful to investigate the effect of environmental factors on the production process. In this paper we develop the operational aspects for computing conditional and unconditional directional distances and their robust versions, in particular when some of the elements of the directional vector are fixed at zero. After that, we show how the approach of Bădin et al. (2012) can be adapted in a directional distance framework, including bandwidth selection and two-stage regression of conditional efficiency scores. Finally, we suggest a procedure, based on bootstrap techniques, for testing the significance of environmental factors on directional efficiency scores. The procedure is illustrated through simulated and real data.

@&#INTRODUCTION@&#
In productivity and efficiency analysis, most of theoretical and empirical studies have been based on the Farell–Debreu radial oriented measures (Farrell, 1957, Debreu, 1951, Shephard, 1970). The basic idea was to gauge how much the outputs should be increased proportionally (maximal attainable value), given the level of the inputs used, to reach the efficient frontier. Alternatively, mainly when the outputs are not under the control of the DMUs, like in some service industries, one could analyze how much a firm should reduce its inputs proportionally, given the level of outputs it is producing.Later, directional distance functions have been introduced (see Chambers, Chung, & Färe, 1996, 1998, Färe & Grosskopf, 2004, Färe, Grosskopf, & Margaritis, 2008) to generalize the radial input and output distance functions. A directional distance function projects the input–output vector onto the technology frontier in a direction given by a vector d.1“Directional distance functions” is the terminology used in Chambers et al. (1996, 1998) and Färe et al. (2008). For sake of simplicity we will rather refer, as in our title, to the shorter “directional distances” terminology.1It encompasses indeed both the input and the output oriented radial measures as special cases when some elements of the directional vector d are fixed at zero.Recently, Simar and Vanhems (2012) have shown that by choosing an appropriate probabilistic formulation of the production process (as initiated by Cazals, Florens, & Simar, 2002), all the known statistical properties of the nonparametric estimators of the radial efficiency scores were easily adapted to the FDH nonparametric estimators of the directional distance functions. They provided also robust versions of these estimators, based on the order-m partial frontiers (Cazals et al., 2002) and order-αquantile frontiers (Daouia & Simar, 2007). Finally, Simar and Vanhems (2012) only sketch how conditional directional distances could be defined in this framework, without providing any information about their computational implementation. Furthermore, Simar et al. (2012) analyze the statistical properties of the DEA estimators of directional distances. Statistical inference for individual directional distances was derived in these papers, and it implies the use of bootstrap methods.Interestingly, the great flexibility of the directional distances rests in their ability to handle non-discretionary inputs and/or outputs by simply setting at zero any subset of the vector d. The only constraint is that the vector d should not be equal to zero for all its components.Another important aspect for the practitioner in production analysis is to investigate the impact of environmental-external factors on the production process. Recently, Bădin et al. (2012) have developed a methodology initiated by Daraio and Simar (2005, 2007) for this specific purpose. Their approach uses conditional efficiency measures (see Bădin, Daraio, & Simar, 2014 for a recent survey of available techniques). All these approaches, however, use traditional radial measures.In this paper we combine the tools recently developed by Simar and Vanhems (2012) and Bădin et al. (2012) by adapting the methodology for detecting the impact of external-environmental variables on the production process to the directional distance framework. Our contribution is thus fourfold.–First we operationalize, by explicating the algorithms, the computation of directional distance estimates, where Simar and Vanhems (2012) were only mentioning the possibility of extension, without giving any computational details. In particular, we provide a practical procedure for computing FDH estimates of directional distances and their robust versions when some of the elements of the directional vector are zeros (both in inputs and/or in outputs).2To save space, we limit the presentation to the case of FDH and quantile frontiers. This can be adapted without much difficulty to the order-m partial frontier cases. We summarize in Appendix B the main steps for the order-m cases.2Second, we make explicit the computations for the conditional distance estimates, including their robust versions. By doing this, we particularize to conditional directional distances the procedure for selecting the appropriate bandwidth, suggested by Bădin, Daraio, and Simar (2010).Third, we adapt the methodology for measuring the impact of environmental variables implemented so far for radial oriented efficiency scores (Bădin et al., 2012) to the directional distance context. This includes the appropriate second stage regression to explore the effect of external variables on the expected efficiency scores.Finally, we provide a test for assessing the significance of the effect of external variables on the expected efficiency scores. This test adapts a bootstrap methodology suggested for traditional nonparametric regression to this particular context. Specifically, we show how a consistent bootstrap test can be implemented by working with order-αquantile frontiers. The procedure is illustrated with some simulated data sets and with a real data set on Mutual Funds. We analyze the role of Market Risk on the mean efficiency in a simple Mean–Variance model.The paper is organized as follows. Section 2 introduces the basic notation for directional distances and their robust versions. In Section 3 we illustrate how to compute the FDH nonparametric estimators of directional distances when some elements of the direction d are set at zero. Then Section 4 gives all the details for computing conditional directional distances and their robust versions. The significance test for the external factors, based on bootstrap methods, is explained in Section 5. Section 6 illustrates the proposed procedure with some data sets. The bootstrap algorithm (including the double bootstrap) is detailed in Appendix A. Section 7 summarizes the main findings and concludes the paper.In production theory (see Shephard, 1970), we consider a set of producing units (hereafter we will use the term “DMU”) that produce a set of outputsY∈Rqby combining a set of inputsX∈Rp. The technology is characterized by the attainable set T, the set of all the combinations of(x,y)that are technically achievable, defined as:(2.1)T={(x,y)∈Rp×Rq|xcan producey}.We know (Cazals et al., 2002) that under the free disposability assumption for the inputs and the outputs,3The free disposability we used in this paper is the assumption that if(x,y)∈Tthen(x̃,ỹ)∈Tfor allx̃⩾xand allỹ⩽y. It is a minimal assumption generally made on production processes.3the set can be described as:(2.2)T={(x,y)∈Rp×Rq|HXY(x,y)>0},whereHXY(x,y)is the probability of observing a unit(X,Y)dominating the production plan(x,y), i.e.HXY(x,y)=Prob(X⩽x,Y⩾y).The efficient boundary of T is of interest and several ways have been proposed in the literature to measure the distance of the unit(x,y)to (from) the efficient frontier. One of the most flexible approaches is based on directional distances introduced by Chambers et al. (1998) (see also Färe & Grosskopf, 2004 & Färe et al., 2008). Given a directional vector for the inputsdx∈R+pand a direction for the outputsdy∈R+q, a directional distance is defined as:(2.3)β(x,y;dx,dy)=sup{β>0|(x-βdx,y+βdy)∈T},or equivalently, under the free disposability assumption (see Simar & Vanhems, 2012):(2.4)β(x,y;dx,dy)=sup{β>0|HXY(x-βdx,y+βdy)>0}.That is, we measure the distance of unit(x,y)from the efficient frontier in an additive way, and along the path defined by(-dx,dy). This way of measuring the distance is very flexible and generalizes the “oriented” radial measures proposed by Debreu (1951) and Farrell (1957), see also Shephard (1970). Certainly, by choosingdx=0anddy=y(ordx=xanddy=0), we can recover the traditional Farrell–Debreu output (resp. input) radial distance. The flexibility of this approach rests on the fact that we might have some elements of the vectordxand/or of the vectordythat can be set at zero. This is the case when one wants to focus the analysis on distances to the frontier along certain particular paths or, for instance, when some inputs or outputs are non-discretionary, or not under the control of the manager. The usefulness of selecting zero elements in the directional vectors is not only to allow to handle input and output orientations but also to handle exogenously fixed inputs or outputs. Banker and Morey (1986) show how to achieve this when using Farrell type efficiency measures. They give the example of units willing to estimate their input savings and having to deal with some inputs that they do not control (like e.g., level of advertising and number of competitors, see Banker and Morey for a detailed discussion). These inputs are thus exogenously fixed and it is not meaningful to reduce them. Banker and Morey (1986) also give an example of exogenously fixed outputs (like e.g. check cashing in transactions in a bank, which is a purely gratis service function, so the banks try to maximize the outputs that are under their own control). We could also consider the case of bad outputs that we do not want to maximize (see Simar & Vanhems, 2012 for a discussion).An important point to note is that the efficient frontier is uniquely defined by the boundary of the attainable set T (where all the inputs and outputs are involved), but the distance to the frontier depends on the chosen direction. In particular, in the optimization (2.3), some inputs or outputs could not be involved because they have zero elements in the direction vector, but the corresponding inputs and outputs are real inputs and outputs that determine the attainable set T. So this is different from just ignoring these inputs or outputs in the analysis. We illustrate the effects of zero elements in the direction vector, in a simple example in Section 6.1.For a discussion about the choice of a direction, see Färe et al. (2008). The direction can be different for each unit (like in the radial cases) or it can be the same for all the units. Färe et al. (2008) argue that a common direction would be a kind of egalitarian evaluation reflecting a kind of social welfare function. Researchers often select in the latter casedx=E(X)anddy=E(Y), whereE(.)means expected value of (.) and in practice empirical averages are chosen.4Note that the choice of the direction could also be endogenized, see e.g. Färe, Grosskopf, and Whittaker (2013).4Simar and Vanhems (2012) show the equivalence between directional and hyperbolic distances. Accordingly we have:β(x,y;dx,dy)=log(γ(x∗,y∗)),where(2.5)γ(x∗,y∗)=supγ>0|HX∗Y∗(γ-1x∗,γy∗)>0.We see indeed thatγ(x∗,y∗)is the hyperbolic distance from(x∗,y∗)to the efficient frontier along an hyperbolic path (Färe, Grosskopf, & Lovell, 1985) in a transformed coordinates space,(X∗,Y∗). When bothdx>0anddy>0, the monotonic transformation proposed by Simar and Vanhems (2012) is defined by:(2.6)X∗=exp(X./dx)andY∗=exp(Y./dy),where./refers to the Hadamar componentwise division of vectors. It is implicit thatx∗andy∗have also been transformed in the same way. It will be seen below that this link provides a simple way to define robust version of directional distances and simple formulae for computing nonparametric estimates. A contribution of the present paper is to show how to handle the case of zero directional elements indxand/or indy. This is provided in Section 3.2.Quantile frontiers for evaluating the performance of DMUs have been introduced in the full multivariate setup by Daouia and Simar (2007), by using (input or output) oriented radial measures. Their adaptation to directional distances is due to Simar and Vanhems (2012) and is quite natural after the representation given in (2.4) and exploiting the link between directional and hyperbolic distances.Hence, instead of looking at the support of the distributionHXY, as in (2.4), we benchmark the DMU against a point which leaves on averageα×100%of points above the frontier, whereα∈(0,1). This benchmark is theα-quantile frontier. Formally the order-αdirectional distance is defined as:(2.7)βα(x,y;dx,dy)=sup{β>0|HXY(x-βdx,y+βdy)>1-α}.Here a valueβα(x,y;dx,dy)=0indicates a point(x,y)on theα-quantile frontier, a positive value is a point below the quantile frontier and a negative value is a point above the quantile frontier. We see clearly that whenα→1we recover the full frontier definition. As explained in Simar and Vanhems, and using the transformation (2.6) we haveβα(x,y;dx,dy)=log(γα(x∗,y∗)),where(2.8)γα(x∗,y∗)=sup{γ>0|HX∗Y∗(γ-1x∗,γy∗)>1-α},Note that, as already pointed out by Daouia, Simar, and Wilson (2013) the correspondingα-quantile frontier, defined as the set of points(x,y)such thatHXY(x,y)=1-α, is uniquely determined whatever being the chosen direction. Certainly, the value of the distance itself, instead, relies on the chosen path(-dx,dy).The FDH estimator (Deprins, Simar, & Tulkens, 1984) is obtained by plugging the natural empirical version ofHXY(·,·)in the formulae above:βˆ(x,y;dx,dy)=sup{β⩾0|H^n,XY(x-βdx,y+βdy)>0},βˆα(x,y;dx,dy)=sup{β⩾0|H^n,XY(x-βdx,y+βdy)>1-α},whereH^n,XY(x,y)=(1/n)∑i=1n1(Xi⩽x,Yi⩾y), and1(.)is an indicator function, equal to one if the condition (.) is verified or zero otherwise. Due to the simple monotonic transformation (2.6), Simar and Vanhems derive for the case ofdx>0anddy>0, a simple sorting formula for computing these estimators.5The DEA version, appropriate under the additional assumption of convexity of the attainable set T, and its asymptotic properties are derived in Simar et al. (2012).5They provide also the asymptotic properties of the resulting estimators. The FDH estimator is given by:βˆ(x,y;dx,dy)=log(γˆ(x∗,y∗)),where(3.1)γˆ(x∗,y∗)=maxj∈Dx,yminmink=1,…,px∗,kXj∗,k,minℓ=1,…,qYj∗,ℓy∗,ℓ,where for a vectora,akdenotes itskth component andDx,y={i|Xi⩽x,Yi⩾y}is the set of labels of observations dominating the point(x,y)which is evaluated.6Note that, as in Simar and Vanhems (2012),Dx,y≡i|Xi∗⩽x∗,Yi∗⩾y∗, because the inequalities are equivalent due to the monotonicity of (2.6).6Note that from a practical point of view, standard FDH algorithms can be used to computeγˆ(x∗,y∗). Indeed, we see that (3.1) is nothing else than a standard output-oriented FDH estimator by considering an extended set of(p+q)outputs1./Xi∗,Yi∗,i=1,…,nand no inputs and evaluating the output FDH efficiency score at the point(1./x∗,y∗).7Some software will require the presence of an input, then we fix a single input, say equal to 1, for all units and evaluate the extended output FDH estimator, at a point with an input also fixed at 1.7The nonparametric estimator ofγα(x∗,y∗)is also provided in Simar and Vanhems (2012). Define fori=1,…,nthe variables:(3.2)Xi=minmink=1,…,px∗,kXi∗,k,minℓ=1,…,qYi∗,ℓy∗,ℓ,and letX(1)⩽X(2)⩽…⩽X(n)be the order statistics of the variablesXi. Then we have(3.3)γˆα(x∗,y∗)=X(αn)ifαnis an integerX([αn]+1)otherwise,where[·]denotes the integer part of a real number; thenβˆα(x,y;dx,dy)=log(γˆα(x∗,y∗)).8Note the unfortunate typos around formula (51) in Simar and Vanhems (2012). The correct formulation, using similar notations is given in Eqs. (3.2) and (3.3). Note that the results in the empirical section of Simar and Vanhems use the correct formulae.8We remark also thatγˆ(x∗,y∗)≡γˆ1(x∗,y∗)=X(n).The projection of any(x,y)∈Ton the estimatedα-quantile frontier is given by the pointsxˆα∂,yˆα∂defined as(3.4)xˆα∂=x-βˆα(x,y;dx,dy)dx,andyˆα∂=y+βˆα(x,y;dx,dy)dy.Since the resulting estimator will not envelop all the data points, the resulting frontier is more robust to outliers and extreme data points than its full version above. Properties of this estimator are derived in Simar and Vanhems (2012).When some elements ofdxand/or ofdyare equal to zero, the transformation (2.6) has to be modified. Simar and Vanhems (2012) give only some indication on how to proceed for the pure input (pure output) orientationdy=0(resp.dx=0) and Simar and Wilson (2013) explain how to proceed for the full frontier case, but to the best of our knowledge, the case of the order-αdirectional distance was never analyzed. We will see that using an additional transformation of the variables, the nonparametric estimators in both cases (full frontier and order-αfrontier) can be easily computed.Without loss of generality, let us partitiondx=(dx1,dx2), wheredx2=0is of dimensionp2. Sodx1>0andp1=p-p2. Note thatdx2could be the empty vector∅withp2=0, covering the case where all the elements ofdx>0. We use the same notational convention fordy=(dy1,dy2), withdy2=0, which is of dimensionq2, withq2⩾0. We partition all the input and output vectors X and Y accordingly, remembering thatX2and/orY2could be empty vectors. The directional distances are now defined as:(3.5)β(x,y;dx,dy)=sup{β>0|HXY(x1-βdx1,x2,y1+βdy1,y2)>0}.Therefore, the monotone transformation (2.6) becomes as follows:(3.6)X1∗=exp(X1./dx1)andX2∗=X2,Y1∗=exp(Y1./dy1)andY2∗=Y2.From this, it is easy to see that:β(x,y;dx,dy)=log(γ(x∗,y∗)),where(3.7)γ(x∗,y∗)=supγ>0|HX∗Y∗γ-1x1∗,x2∗,γy1∗,y2∗>0,We have similar expressions for the order-αcase. The order-αdirectional distance is now:βα(x,y;dx,dy)=sup{β>0|HXY(x1-βdx1,x2,y1+βdy1,y2)>1-α},=log(γα(x∗,y∗)),where(3.8)γα(x∗,y∗)=supγ>0|HX∗Y∗γ-1x1∗,x2∗,γy1∗,y2∗>1-α.The easiest way to define the FDH estimators, obtained by replacingHX∗Y∗by its empirical versionH^n,X∗Y∗, is to adapt the notations introduced in Daouia et al. (2013) to our case here. Consider the following random variable:(3.9)Wxy(X∗,Y∗)=1X2∗⩽x2∗,Y2∗⩾y2∗minmink=1,…,p1x1∗,kX1∗,k,minℓ=1,…,q1Y1∗,ℓy1∗,ℓ.The random variableWxy(X∗,Y∗)could be interpreted as the “partial” hyperbolic efficiency score of a random points(X∗,Y∗)dominating(x,y)for the variablesx2∗,y2∗and where only the variablesx1∗,y1∗are used in the optimization. It can be seen that:(3.10)Prob(Wxy(X∗,Y∗)⩾w)=SWxy(w)=HX∗Y∗w-1x1∗,x2∗,wy1∗,y2∗,and thatγ(x∗,y∗)=sup{w|SWxy(w)>0}andγα(x∗,y∗)=sup{w|SWxy(w)>1-α}. Note that hereSWxy(w)=1forw<0butSWxy(0)=HX2∗Y2∗(x2∗,y2∗)≡HX2Y2(x2,y2)⩽1. As a consequence, for anyα⩽1-HX2Y2(x2,y2),γα(x∗,y∗)=0andβα(x,y;dx,dy)=-∞. We remark also that if bothX2andY2are empty,SWxy(0)=1as in the regular case where all the directions are strictly positive andβα(x,y;dx,dy)will be well defined for allα∈(0,1].The nonparametric estimators can now be easily derived by plugging the empirical version ofSWxy(·)in the formulae. We evaluateWxyat each observationXi∗,Yi∗,Wixy=WxyXi∗,Yi∗and we denoteW(i)xythe ith order statistic of these n observations, such thatW(1)xy⩽W(2)xy⩽…W(n)xy. Note that by construction, the firstn-n2order statistics are equal to zero and only the lastn2ones are positive. Heren2=∑i=1n1X2,i∗⩽x2∗,Y2,i∗⩾y2∗is the number of observations dominating the point(x2,y2)in the restricted space of dimension(p2+q2). Note that if bothX2andY2are empty vectors(p2+q2=0), we haven2=nand the observationsWixycoincide withXidefined in (3.2). We now have the simple expression for the nonparametric estimators of the hyperbolic measuresγ’s(3.11)γˆ(x∗,y∗)=W(n)xy,(3.12)γˆα(x∗,y∗)=W(αn)xyifαnis an integerW([αn]+1)xyotherwise,Note that ifα⩽1-H^n,X2Y2(x2,y2)=1-n2/n, we haveγˆα(x∗,y∗)=0. Taking thelogof theγˆ’s produce the estimates of the directional distances as follows:(3.13)βˆ(x,y;dx,dy)=log(γˆ(x∗,y∗)),(3.14)βˆα(x,y;dx,dy)=log(γˆα(x∗,y∗)).Note that the latter formulae can be used in all the cases (any directional vectors) with the remark done above that ifdx>0anddy>0, thenn2=nandWixy≡Xifor alli=1,…,n.It may be useful for practitioners to measure, in original units of the inputs and of the outputs, the estimated distance of a DMU from the frontier. This permits us to appreciate the efforts to be achieved in increasing the outputs and decreasing the inputs to reach the efficient frontier. For the full frontier this measure is given by what we call the “gaps” to efficiency.9Sometimes researchers use the term “slacks” in place of “gaps”. In the literature, slacks appear when a part of the frontier is Farrell (radially) efficient but not necessarily Pareto efficient. The slacks is, e.g. the amount of an input we can still decrease (i.e. staying in T) keeping the other inputs at their level. So the concept we use here is different and we suggest to use the terminology “gaps”, because it is really the gap that is missing for a firm to reach the frontier in the chosen direction.9They are directly given by:(3.15)Gx=βˆ(x,y;dx,dy)dx,andGy=βˆ(x,y;dx,dy)dy.For the partial frontiers, the gaps appear as being the difference between(x,y)and the projections on theα-quantile frontier given in (3.4). They are particularly useful to detect outliers in the direction given by the path(-dx,dy). This will be the case in the input direction ifGα,x=βˆα(x,y;dx,dy)dxhas some elements with large negative value: the DMU(x,y)is well below the estimatedα-frontier in the input direction, and/or a very large negative value in some elements of the vectorGα,y=βˆα(x,y;dx,dy)dysignals a point being well above the quantile frontier. The efficiency scoreβˆα(x,y;dx,dy)provides the same information but when translated in terms of the real input/output values via the gaps calculations, it may appear more evidently that the point is lying far away from the other units in the sample.Here we want to introduce in the production model exogenous variables or external, environmental factorsZ∈Rr. These variables are neither inputs nor outputs, and they are not under the direct control of the manager. However, they may influence the production process. A natural way for introducing these variables has been initiated by Cazals et al. (2002) and extended to define conditional measures by Daraio and Simar (2005).The idea is very simple, we only have to replaceHXY(x,y)in the above unconditional model byHXY|Z(x,y|Z=z)=Prob(X⩽x,Y⩾y|Z=z)where we condition to the value z of the external factors that the unit(x,y)has to face. In our setup here, this allows to define a conditional directional distanceβ(x,y;dx,dy|z), as shown in Simar and Vanhems (2012). Simar and Vanhems indicate the link with a conditional hyperbolic distance, but they do not provide any explicit algorithm. Moreover, so far, no indication has been given for the bandwidth selection, nor for cases where there are directions with zero values and for robust (α-quantile) versions. We fill this gap in this section.10We focus the presentation for the case of continuous variables Z, but as pointed in Bădin et al. (2010), it is easy to adapt the computations to the case of discrete or categorical variables, by using special kernels (see Li & Racine, 2007). However, for the particular case of full frontier, as explained in Daraio, Simar, and Wilson (2010), smoothing the discrete variable does not help because we estimate a support of random variable and not a mean or whatsoever. It is for the same reason that the kernel used in (4.1) has to be with compact support. For full frontier, we have to treat each subgroups determined by a categorical variable separately. For an ordered discrete variable taking a large number of value, we can treat it as a continuous variable.10A nonparametric estimator ofHXY|Z(x,y|Z=z)is given by(4.1)H^n,XY|Z(x,y|Z=z)=∑i=1n1I(Xi⩽x,Yi⩾y)K((Zi-z)/h)∑i=1nK((Zi-z)/h),whereK(.)is a kernel function with compact support and h is the bandwidth. Whenr>1,Z=(Z1,…,Zr)is multivariate and we use a product kernel with a vector of bandwidthsh=(h1,…,hr)andK((Zi-z)/h)is the shortcut notation for∏j=1rKZij-zj/hj.Bădin et al. (2010) provide a way of selecting optimal bandwidths in the case of radial input (or output) oriented measures. In our case here, since we use the joint probability on inputs and outputs, conditional on Z, we can directly apply the optimal procedure suggested by Hall, Racine, and Li (2004), providing optimal bandwidths for the conditional probability distribution function (pdf) of(X,Y), conditional on Z.11This is a standard problem in nonparametric density estimation and is obtained by Least Squares Cross Validation (LSCV). For instance, the np package in R, Hayfield and Racine (2008), provides such algorithm.11As explained in Li and Racine (2007), this gives a bandwidth of ordern-1/(4+p+q+r). Since the optimal bandwidth for estimating a conditional cumulative distribution has to be, for each component, of ordern-1/(4+r), the optimal values found by Least Squares Cross Validation (LSCV) for pdf have to be rescaled by the multiplication of the factorn1/(4+p+q+r)n-1/(4+r)=n-(p+q)/((4+p+q+r)(4+r)).The computations of the conditional hyperbolic measures in the transformed spaces are then easy to obtain. We present directly the case where some directions indxand/ordycould be equal to zero, and when necessary we will particularize to the “regular” case wheredx>0anddy>0. We use the notations introduced above from (3.6)–(3.9) and (3.10), noting that in the regular caseX2andY2are empty vectors. The conditional survival function ofWxyis given by:(4.2)SWxy|Z(w|Z=z)=HX∗Y∗|Zw-1x1∗,x2∗,wy1∗,y2∗|Z=z.Then we have:(4.3)γ(x∗,y∗|z)=sup{w|SWxy|Z(w|Z=z)>0},(4.4)γα(x∗,y∗|z)=sup{w|SWxy|Z(w|Z=z)>1-α}.We can verify that here we haveγα(x∗,y∗|z)=0forα⩽1-HX2,Y2|Z(x2,y2|Z=z), and in the regular case,γα(x∗,y∗|z)>0forα∈(0,1]. The nonparametric estimators are then obtained by using the empirical version of the survival function:(4.5)S^n,Wxy|Z(w|Z=z)=∑i=1n1Wixy⩾wK((Zi-z)/h)∑i=1nK((Zi-z)/h).Denote byZ[j]xythe observationZicorresponding to the jth order statisticW(j)xy. The estimated survival can also be written as:(4.6)S^n,Wxy|Z(w|Z=z)=∑j=1n1W(j)xy⩾wKZ[j]xy-z/h∑i=1nK((Zi-z)/h).As pointed in Daraio and Simar (2005) and Jeong, Park, and Simar (2010), for the full conditional hyperbolic measureγˆ(x∗,y∗|z)=sup{w|S^n,Wxy|Z(w|Z=z)>0}is given by the greatest order statisticW(i)xyamong the observations i such that|Zi-z|⩽h. For multivariate Z the later inequality has to be understood componentwise. In practice, and equivalently, the formula for obtainingβˆ(x,y;dx,dy|z)is exactly the same as the one described above except that the estimation is “localized” in a neighborhood of the given z value. The neighborhood is tuned by the selected bandwidths. The formula forβˆ(x,y;dx,dy|z)can be written exactly as in (3.1) except that nowDx,yis replaced by its localized version. Therefore we have:βˆ(x,y;dx,dy|z)=log(γˆ(x∗,y∗|z)),where(4.7)γˆ(x∗,y∗|z)=maxj∈Dx,y|zminmink=1,…,px∗,kXj∗,k,minℓ=1,…,qYj∗,ℓy∗,ℓ,where now,(4.8)Dx,y|z=i|Xi⩽x,Yi⩾y,Zij-zj⩽hj,j=1,…,r.The latter set is the set of labels of data dominating the point(x,y), and having “similar” values for the r components ofZi. Asymptotic properties of these nonparametric estimators of conditional efficiency scores have been established by Jeong et al. (2010) for the radial cases, and, as explained in Simar and Vanhems (2012), they remain valid for directional distances.For robustα-quantile, it is less obvious. It can be verified that, in the general case where some elements of the directional vector are zero, we have:S^n,Wxy|Z(w|Z=z)=1ifw⩽0Lk+1ifW(k)xy<w⩽W(k+1)xy,0ifw>W(n)xy,fork=n-n2,…,n-1whereLk+1=∑j=k+1nKZ[j]xy-z/h∑i=1nK(Zi-z)/h. We note that indeedW(j)xy=0for allj=1,…,n-n2. In the regular case withn2=n,W(j)xy>0for all j and the estimate slightly particularizes in:S^n,Wxy|Z(w|Z=z)=1ifw⩽W(1)xyLk+1ifW(k)xy<w⩽W(k+1)xy,0ifw>W(n)xy,fork=1,…,n-1whereLk+1is as before. In the general case, the estimator of the hyperbolic measure is:(4.9)γˆα(x∗,y∗|z)=0if1-α⩾Ln-n2+1W(k)xyifLk>1-α⩾Lk+1,W(n)xyif0⩽1-α<Ln,fork=n-n2,…,n-1Hence, the directional estimateβˆ(x,y;dx,dy|z)=log(γˆα(x∗,y∗|z))will take finite values, only forα>1-Ln-n2+1=1-H^n,X2Y2|Z(x2,y2|Z=z). It is easy to see that in the regular case wheredx>0anddy>0, we have for allα∈(0,1]:(4.10)γˆα(x∗,y∗|z)=W(k)xyifLk>1-α⩾Lk+1,fork=1,…,n-1W(n)xyif0⩽1-α<Ln.Here we adapt the methodology described in details in Bădin et al. (2012, 2014) for radial oriented distances, to the directional distances case. When using Farrell or Shephard radial measures of efficiencies, the ratio of the conditional to unconditional efficiency scores is quite natural. For instance, the shift of the frontier at a point(x,y)in the output direction can be measured by the ratio of the modulus of projection of(x,y)on the conditional frontier in the output direction,||yz∂||=λ(x,y|z)||y||, to its projection, in the same direction, on the unconditional frontier given by||y∂||=λ(x,y)||y||. This ratio is indeed given byλ(x,y|z)/λ(x,y). And the analysis, suggested by Daraio and Simar (2005, 2007) and detailed in Bădin et al. (2012, 2014) follows, including the case where the robust order-αefficiency scores are used.Here the situation is more complex because the projection of a pointw=(x,y)on the frontier is given by the point inRp+qwith coordinate(x-βdx,y+βdy)whereβisβ(x,y;dx,dy)(resp.β(x,y;dx,dy|z)) for the unconditional (resp. conditional) frontier. In particular, the modulus of the pointw=(x,y)projected on the frontier, in the direction(-dx,dy)is given by:(4.11)||w∂||=∑j=1pxj-β(x,y;dx,dy)dxj2+∑k=1qyk-β(x,y;dx,dy)dyk2,whereβ(x,y;dx,dy)would be replaced byβ(x,y;dx,dy|z)for defining||wz∂||. This is not a simple function of theβ’s, depending on(x,y)but also on the chosen direction(-dx,dy). The analysis becomes simpler if we choose, for investigating the impact of Z on the production process, the following directions:(4.12)dx=xanddy=y.We remember indeed that the frontier levels do not depends on the chosen direction, both for the full frontier and for theα-quantile frontier computed with directional distances. The choice (4.12) will appear quite useful and also allows to compute order-αmeasures for allα∈(0,1].The modulus of the frontier points would then be given by(1-β)2||x||2+(1+β)2||y||2, whereβis the appropriate distance (conditional or unconditional). We see that here the ratios||wz∂||/||w∂||does not simplify unless we are back in the radial cases wheredx(ordy) is set to zero. Indeed in the latter case, e.g.dx=0anddy=y, the ratios simplify to(1+β(x,y;dx,dy|z))/(1+β(x,y;dx,dy))which turns out, as expected, to be the ratios used in the radial output measuresλ(x,y|z)/λ(x,y)described above (choosingdx=xanddy=0would give the radial input oriented case). Nothing is new for these particular radial cases.12Recent applications of conditional directional distances within this framework include Halkos and Tzeremes (2013) and Bonaccorsi, Daraio, and Simar (2013).12In a more general case and using (4.12), it is easy to check that the distance inRp+qbetweenwz∂andw∂is simply given by:(4.13)||wz∂-w∂||=(β(x,y;dx,dy)-β(x,y;dx,dy|z))||w||,where the first factor is by construction greater or equal to zero. So a simple unit free measure of the shift of the frontier at the pointw=(x,y)in the direction(-dx,dy), is given by the relative distance:(4.14)δ(x,y,z)=||wz∂-w∂||/||w||=β(x,y;dx,dy)-β(x,y;dx,dy|z)⩾0.By following the same arguments, it easy to show that the relative distance between the quantile-αfrontiers (conditional and unconditional) is given by:(4.15)|wα,z∂-wα∂|/||w||=|βα(x,y;dx,dy)-βα(x,y;dx,dy|z)|.Note that here we need the absolute value of the difference because this difference (like the measuresβαthemselves) can be either positive or negative. It can be seen that whatever being the sign of the measures, ifβα(x,y;dx,dy)⩾βα(x,y;dx,dy|z), the conditional quantile frontier is below the unconditional one in the direction(-dx,dy), and the contrary whenβα(x,y;dx,dy)⩽βα(x,y;dx,dy|z). Since the sign of these differences is informative, we will use as tool for measuring the impact of Z on theα-quantile frontiers the quantity:(4.16)δα(x,y,z)=βα(x,y;dx,dy)-βα(x,y;dx,dy|z),where both the sign and the absolute value are of importance in the interpretation. As explained in Bădin et al. (2012), if we want robust versions of the frontier levels,αhas to be chosen near 1, but for analysis of the effect of Z on the middle of the distribution of efficiencies, a value ofα=0.5is more appropriate because it provides an estimate of the median of the distribution.Certainly, in practice these quantities are unknown but we can use their nonparametric estimates. An estimate of the shift of the conditional frontier at the point(x,y)in the direction(-dx,dy)is given by:(4.17)δˆ(x,y,z)=βˆ(x,y;dx,dy)-βˆ(x,y;dx,dy|z)⩾0,which is positive since the maximum for computing theγˆin (3.1) is over a more restricted set for the conditional measure than for the unconditional ones (compare the setsDx,yandDx,y|z).Adapting the approach of Daraio and Simar (2005) and Bădin et al. (2012) to this directional distance framework, we can say that a positive value ofδˆindicates a shift of the frontier of T in the direction(-dx,dy)(the conditional frontier is always below the unconditional one). The bigger is the difference the bigger is the shift at this point and for this value of z. Looking at the picture ofδˆ(Xi,Yi,Zi)as a function of the elements of Z can be useful to indicate ifδhas a tendency to increase or to decrease with z. An increasing trend indicates a bigger negative shift with larger values of z, so z has a negative effect on the attainable set. On the contrary if there is a tendency ofδto decrease with z, it means that the conditional frontier is shifted less below the unconditional when z increase, indicating a favorable effect of z on the attainable set.The robust version usingδˆα(x,y,z)with large values ofαis desirable if we expect to have some outliers or extreme data points in the sample. But as pointed in Bădin et al. (2012), the analysis ofδˆα(x,y,z)for smaller values ofα, likeα=0.5explores the potential shift of the distribution of the inefficiencies as a function of z, becauseβˆ0.5(x,y;dx,dy)andβˆ0.5(x,y;dx,dy|z)correspond to the “median” frontiers. If the differences are bigger than the differences computed for the full frontier, it means that in addition to the potential shift of the frontier, there is a shift of the median in the inefficiency distribution (less efficiency). With the opposite conclusion if the differences are smaller (more concentration of the distribution near the efficient frontier). As explained above, the sign ofδˆα(x,y,z)indicates if the conditional quantile frontier is below or above the unconditional one.To summarize, some potential shift observed with (4.14) could be enhanced (or reduced) if the effect on the distribution of the inefficiencies captured by (4.16) is different. So, the analysis and comparison of unconditional and conditional efficiency estimates, both with largeα(evenα=1) and small values likeα=0.5, allows to disentangle the potential effect of z on the frontier from the effect of z on the distribution of the inefficiencies.13It may be worth to mention the work of Mastromarco and Simar (2014) who explore such analysis in great details in a macroeconomic application, including also dynamic effects (the effect of time) in the conditional measures.13In Bădin et al. (2014), confidence intervals for ratios of conditional to unconditional Farrell radial measures, at a fixed set of grid values for z, have been proposed by using sub-sampling techniques (m out of n bootstrap). Their analysis can certainly be adapted here for building confidence intervals forE(δ(X,Y|Z=z))at fixed values of z on a grid. The procedure would use nonparametric regression ofδ(X,Y|Z)on Z. Nevertheless, as pointed in Bădin et al. (2014), a formal proof of the consistency of this bootstrap has still to be derived.14Note that the analysis of the Section 4.3 could be done on the differencesδ(X,Y|Z=z)andδα(X,Y|Z=z). For reasons explained in details in Section 5, the nonparametric regression ofδ(X,Y|Z=z)on Z will provide consistent estimates ofE(δ(X,Y|Z=z))but the bootstrap significance test proposed there is valid only if we regressδα(X,Y|Z=z)on Z forα<1.14Another interesting analysis of individual conditional directional distances, for any directional vectord=(dx,dy), is to provide a tool allowing to investigate the effect of z on the mean of the conditional directional distances. This is in the spirit of the so called two-stage regression approaches, where the estimated unconditional efficiency scores (input or output oriented) are regressed, in a second stage, against the Z variables. However we know from Simar and Wilson (2007, 2011) that this has a meaning only under the “separability” assumption, which assumes that the frontier of the attainable set does not depend on the values of z. Formally, denote byTzthe support ofHXY|Z(x,y|Z=z), i.e. the set of attainable points in the input–output space of DMUs facing the external conditionsZ=z. The “separability” condition states thatTz≡Tfor all z. This assumption is very restrictive and often unrealistic. Daraio et al. (2010) suggest a bootstrap procedure for testing the separability condition, they used Farrell input or output efficiency measures, but of course we could use the directional distances in the same way.As indicated in Bădin et al. (2012), the use of the estimated conditional efficiency scores for this second stage regression, does not require this restrictive assumption. We can evidently do the same here with conditional directional distances. Therefore, the flexible second stage regression can be written as the following location-scale nonparametric regression model:(4.18)β(X,Y;dx,dy|Z=z)=μ(z)+σ(z)ε,whereεand Z are independent withE(ε)=0andV(ε)=1. From which:μ(z)=E(β(X,Y;dx,dy|Z=z))andσ2(z)=V(β(X,Y;dx,dy|Z=z)).These two functions can be estimated non-parametrically from a sample of observations{Zi,βˆ(Xi,Yi;dx,dy|Zi)},i=1,…,nby using, e.g., Nadaraya–Watson estimator, local linear estimator, and so on (see Bădin et al., 2012 and the references cited therein for technical details). As shown with simulated samples in Bădin et al., the analysis ofμˆ(z)as a function of z will enlighten the potential effect of Z on the average efficiency of DMUs, with the help ofσˆ(z)which may indicate the presence of heteroscedasticity. The resulting residualsεˆi=(βˆ(Xi,Yi;dx,dy|Zi)-μˆ(Zi))/σˆ(Zi)can be viewed as the remaining part of the efficiency when its dependence on Z has been removed. They can be used for ranking units even when they are confronted to different environmental conditions measured by Z. Finally, they can be interpreted according to Bădin et al. as “pure” or “managerial” efficiency measures. We discuss in the next section some issues of statistical inference in these models and how the bootstrap can help to test the significance of Z.One would be very happy to derive a procedure for testing if the effect of Z (or some components of Z) are significant on the average efficiency scores. Testing the significance of some elements of Z in the nonparametric regression ofβ(X,Y;dx,dy|Z)on Z seems to be straightforward if the true valuesβ(Xi,Yi;dx,dy|Zi)would have been available. This could indeed be achieved by applying the bootstrap procedure described in Racine (1997). The procedure is seemingly simple. To summarize, the local linear estimators of the regression are used to estimate the local derivatives with respect to any selected element of Z and a test statistic is built on the average of the square of those derivatives. Finally by bootstrapping the re-centered residuals of the nonparametric regression constrained by the null hypothesis, a p-value is approximated by using the percentiles of the bootstrap distributions of the chosen statistic. This procedure is correct when the dependent variable of the regression is observed which is the usual situation.However, in the setup here, it is not the case because theβ(Xi,Yi;dx,dy|Zi)are not observed and have to be replaced by their nonparametric estimates. So the simple bootstrap described in Racine cannot be used here because it ignores the noise introduced by this first stage estimation and so, underestimates (in the bootstrap world) the sampling variation of the nonparametric regression estimates. This approach is in general not consistent, in particular if the noise introduced at the first stage estimation ofβ(Xi,Yi;dx,dy|Zi)is larger than the noise due to the second stage nonparametric regression. The procedure is complicated because the nonparametric estimators of the efficiency scores are plagued by the curse of dimensionality. As pointed above, the asymptotic properties of the individual efficiency estimators at fixed points(x,y,z)are well established, but the analysis of statistics which are functions of these estimators evaluated at random points becomes more complicated. The problem comes mainly from the bias of the resulting statistic which does not disappear at the appropriate rate compared to the variance of the statistic. Kneip, Simar, and Wilson (2014) illustrate this problems for a simple average of DEA and FDH efficiency scores and also for weighted averages of these scores (by investigating a simple OLS regression of DEA or FDH scores on exogenous factors). The latter procedure described in Kneip et al. for the OLS case, could be adapted here, because local linear (or local constant) are also weighted averages with weights determined by kernel functions, but there is little hope to get sensible results when using full frontier estimates as soon as the number of inputs and outputsp+qis bigger than 2 when FDH estimator is used at the first stage and bigger than 3 when DEA estimator is used at the first stage (see Kneip et al., 2014 for details).We will now explain how to avoid the plague due to the dimensionality of the input–output space and how to adapt the bootstrap algorithm described in Racine (1997) to our setup here, explaining why this bootstrap is consistent. A solution is indeed to use rather partial quantile frontiers and the order-αefficiency measures, because their nonparametric estimators have, for any fixed levelα∈(0,1), rates of convergence not depending of the number of inputs and outputs. Only the dimension of Z will play a role for the rates of convergence of the efficiency scores but, as explained below, this will not hurt for the second stage regression of interest. Hence, we test the significance of Z on the average efficiencyμ(z)=E[βα(X,Y;dx,dy|Z=z)]. For large values ofα, say,α=0.95or0.99, the analysis could be viewed as a robust version of the analysis for full efficiency scores.We know from Cazals et al. (2002), Daouia and Simar (2007), Jeong et al. (2010) and Simar and Vanhems (2012) that the conditional efficiency estimates for partial frontiers share similar properties than the unconditional ones, where the sample size n is replaced by the “effective” one in nonparametric estimation, i.e.nh1…hr, where r is the size of Z. To summarize we have, asn→∞and for any fixed point(x,y,z):(5.19)nh1…hr(βˆα(x,y;dx,dy|Z=z)-βα(x,y;dx,dy|Z=z))→LN(0,σα2(x,y,z)),whereσα2(x,y,z)>0is a known function of different characteristics of the DGP. Since, as recalled above, the optimal bandwidths arehj=cjn-1/(r+4), for some constantcj, the rate of convergence isn4/(r+4)which can be compared with the ratenachieved by the unconditional order-αdirectional distance (see Simar & Vanhems, 2012). So we see clearly how the conditioning on Z deteriorates the rate of convergence when r increases. The same is true for the partial frontiers of order-m (see Cazals et al., 2002) and for the full frontier estimates (see Jeong et al., 2010). So, we note that for order-αscores we will use here, the dimensions p and q do not play any role on the convergence rates.In what follows, we simplify the notations and useβα(x,y,z)forβα(x,y;dx,dy|Z=z). Letb=(b1,…,br)be the vector of bandwidths used in the second stage nonparametric regression ofβαon Z. It is clear that by using local linear kernel methods on a sample{(Zi,βα(Xi,Yi,Zi)|i=1,…,n}, we would obtain (see Li & Racine, 2007, Theorem 2.7):(5.20)nb1…brμ̃(z)-μ(z)+∑k=1rbk2Ck(z)→LN(0,V1),(5.21)nb1…brbj(η̃j(z)-ηj(z))→LN(0,V2),for some finite constantsCk(z)depending on the second partial derivative ofμ(z), whereV1,V2are finite variances depending on the characteristics of the DGP (see Li & Racine, 2007, for explicit formulae). The mean functionμ(z)is nowE[βα(x,y;dx,dy|Z=z)]andηj(z)=∂μ(z)/∂zjforj=1,…,rare the partial derivatives, that will be used for building the test statistic. It is well known that the estimatesμ̃(z)andη̃j(z)can be written as weighted averages of the n valuesβα(Xi,Yi,Zi). In particular we have:(5.22)η̃j(z)=∑i=1nWi,j(Zi,z,b)βα(Xi,Yi,Zi),whereWi,j(Zi,z,b)are known functions of(Zi-z)and of the kernelK((Zi-z)./b).15Explicit formulae forWi,j(Zi,z,b)are complicated and are not needed for the argument here, but they have a simple form in matrix notation, e.g., as Eq. (2.10) in Li and Racine (2007) which gives the estimator of the vector(μ̃(z),η̃′(z))′. The expression (5.22) is the(j+1)th element of this vector.15It is also known that the optimal bandwidthsbjcan be determined by LSCV (least-squares cross validation) providing valuesbjof the same order as the bandwidthshjused in estimating the conditional distribution in the first step above, i.e.bj=djn-1/(r+4)for some constantdj. Note that the rate of convergence for estimating any derivativeηj(z)is given byn2/(r+4)due to the presence ofbj, which is worse than the raten4/(r+4)achieved when estimating the meanμ(z). In this setup then, testing the significance of any subset of the vector Z could then be developed by following the algorithm described in Racine (1997). It is based on the test statistic denoted byτ̃written as:(5.23)τ̃=n-1∑i=1n∑j=1r1[η̃j(Zi)]2,withr1⩽r,where the null hypothesis is:(5.24)H0:∀z,∂μ(z)∂zj=0,forj=1,…,r1,i.e., the firstr1components of Z do not affectμ(z)against the alternative hypothesis(5.25)HA:∂μ(z)∂zj≠0,for somezandj=1,…,r1i.e., some components of Z affectμ(z). Note that without loss of generality we test the significance of the firstr1⩽rcomponents of Z. We would reject the null in favor of the alternative whenτ̃is too big. Either the p-value ofH0or critical values of any size can be determined by the bootstrap algorithm described in Racine (1997), where the bootstrap samples have to be generated, as usually required, under the null hypothesis.As pointed above, we do not observe theβα(Xi,Yi,Zi); we only have their estimatesβˆα(Xi,Yi,Zi). Given the asymptotic properties of partial order-αfrontiers, plugging these estimates in place of the true values in the above procedure will not create any problem and will not change the validity of the asymptotic results (as explained below). Therefore, we will rather use in the test statistics the estimators of the derivativesηˆj(z), obtained by the nonparametric regression ofβˆαon z from the available sample{(Zi,βˆα(Xi,Yi,Zi)|i=1,…,n}without losing the properties described above. We will denoteτˆthe resulting test statistic. The asymptotic theory described above forη̃j(z)is indeed still valid forηˆj(z)because, in the weighted averages (5.22), the error we introduce by replacingβα(Xi,Yi,Zi)byβˆα(Xi,Yi,Zi)is of ordern-4/(r+4)that is smaller than the ordern-2/(r+4)of the error betweenη̃j(z)andηj(z). So, by using optimal bandwidths we have(5.26)n1/(r+4)(ηˆj(z)-ηj(z)+op(n-1/(r+4)))→LN(0,V2),This explains also why full frontier estimates cannot be used, because the noise introduced in the first stage by estimatingβ(Xi,Yi|Zi)could not be neglected, theop(n-1/(r+4))would be replaced byOpn-γwith – for the FDH case,γ=2/((p+q)(r+4))<1/(r+4)as soon asp+q>2.16A sequence of random variablesAnisOp(n-α)ifnαAnis bounded in probability whenn→∞. Saying thatAn=op(n-α)is stronger and means thatnαAnconverges in probability to zero asn→∞.16For DEA estimates,γ=4/((p+q+1)(r+4)), so we would have problem as soon asp+q>3(see Kneip et al., 2014 for a discussion on these issues).Finally, it has to be noted that, as pointed in Racine (1997), we can improve the performance of test (both size and power) by using a pivotal version of the test statisticstˆ=τˆ/SE(τˆ), whereSE(τˆ)can be estimated by an inner loop in the bootstrap algorithm. This is known in the literature as the “double bootstrap”. The reader is referred to the detailed algorithm in Appendix A.In this section we first illustrate, in a simple simulated example, the effects of choosing a directional vector with some elements equal to zero. We then illustrate how the testing procedure proposed in the previous section works with 3 simulated samples and with a real data set to test the effect of market risk on the performance of mutual funds.To make the example simple allowing for pictures in two dimensions, suppose all the units produce the same amount of an output Y (sayY=1) by using two inputsX1andX2. The efficient frontier is given by(6.1)Y=0.1X10.5X20.5.We generate a sample of sizen=50of values on the frontier withX1,i∼U(2,10)andX2,i=10/X1,i. After that, due to input inefficiencies, the observations are projected inside T, above this efficient frontier, at a radial distance given byexp(U), whereU∼N+(0,0.102). This gives the sample of points shown in Fig. 1.By inspecting Fig. 1 we see the importance of choosing the directional vector. For the points A and B, the efficient measures vary with the chosen direction; for A we haveβA=0.2989(radial), 0.4890 (horizontal) and 0.6210 (vertical) and for the points B we haveβB=0.3897(radial), 0.5997 (horizontal) and 0.4070 (vertical). It is more informative to evaluate in terms of real input values the efforts of the two units to reach the frontier, according to the chosen direction. This is given by the gaps, summarized in Table 1. Suppose that the inputX1is exogenously fixed, or that this input is not under the control of the manager, it is certainly important for unit B to be evaluated with the appropriate directiondx=(0,x2): it has only to reduce its inputx2by an amount of 0.76.We select here the data sets of sizen=200simulated by scenario inspired from Simar and Wilson (2011) and already used in Bădin et al. (2012). To summarize we have the three following different DGPs:(6.2)Y=g(X)e-U(6.3)Y∗=g(X)e-U|Z-2|(6.4)Y∗∗=g(X)(1+|Z-2|/2)1/2e-U,whereg(X)=[1-(X-1)2]1/2withX∼U(0,1)andZ∼U(0,4). FinallyU⩾0withU∼N+(0,σU2), and we choose for the illustration hereσU2=0.20. In DGP1 (6.2), Z has no effect on the production process (Z is independent of(X,Y)). The situation is different in DGP2 (6.3), we have the separability condition described in Simar and Wilson (2011), i.e.Tz≡T,∀zbut Z influences the distribution of the inefficiencies (higher probability of being inefficient when|Z-2|increases). Whereas, in DGP3 (6.4), the effect of Z is only on the boundary of the attainable(X,Y), violating the separability condition, the shift (increasing the level of the attainable frontier) is multiplicative and more important when|Z-2|increases. In these examples, we use as directional vector the individual (radial) directions, i.e.dx=Xianddy=Yifori=1,…,n.Fig. 2gives the results of the local linear regression ofβˆα(X,Y,Z)on Z forα=0.99. We see clearly that the results are as expected: no visible effect for DGP1 and DGP3. For the latter, it has to be noticed that Z has an important effect on the frontier level, but not on the probability of being more or less efficient. In this case, a traditional two-stage regression on the unconditionalβˆα(X,Y)on Z would be meaningless providing a wrong information (see Simar & Wilson, 2007, 2011, for a detailed discussion). For DGP2, as expected we recover the shape of the influence of Z on the average efficiency levels, the effect being more important atZ=2.Certainly, a visual inspection of these pictures is a good tool; nevertheless, a formal test is even better. By using our bootstrap algorithm we obtain the p-values (withB1=1000andB2=100) reported in Table 2. We should not reject the null hypothesis (no effect of Z) for DGP1 and DGP3. On the contrary, we should reject the null for DGP2, at any reasonable level given that the p-values calculated for DGP2 are very small. This is exactly what we expected. We remark that in these examples, the double bootstrap and the simple bootstrap provide very similar estimates of the p-values.We illustrate now the methodology with a real data set. We have data on the Aggressive-Growth (AG) category of US Mutual Funds data collected by Morningstar, updated at May 2002. We concentrate our analysis on 129 AG funds previously analyzed in Daraio and Simar (2006) and in Bădin et al. (2010, 2014), where more details on the data are given. These studies used input-oriented radial efficiency scores because most output (return) have negative values and so output oriented measures were not appropriate when using radial, multiplicative, efficiency scores. Simar and Vanhems (2012) uses the same data set to estimate directional distances (with a common direction for all units, including both inputs and outputs). They derive individual bootstrap confidence intervals for full frontier but also their robust versions for partial frontiers (order-m and order-αquantile frontiers).Here we will rather focus on the effect of the Market Risk (Z) on the performance of the funds by using directional distances where both inputs and outputs are considered together. Given the limited number of data points(n=129)we restrict our analysis to the classical Mean–Variance framework. In fact we use as output Y the Total Return and as input X, a measure of the volatility, i.e. the standard deviation of Return. Market risks reflects the percentage of a funds movements that can be explained by movements in its benchmark index. It is calculated on a monthly basis, based on a least-squares regression of the funds returns on the returns of the funds benchmark index. We use as in Simar and Vanhems (2012) a common direction for evaluating all the funds:dx=X‾anddy=|Y|‾(we take the mean of the absolute value because most of the valuesYiare negative).Fig. 3displays the results of the local linear regression ofβˆα(X,Y,Z)on Z. Here we have chosenα=0.95, because we know from previous studies that there areextreme data and outlying points in this dataset. We see that Z has an inverted U-shaped effect on the average values ofβα(X,Y,Z). Market risk shows a slightly negative effect followed by a slightly positive effect on the average of the distancesβˆα(X,Y,Z). We see also the S-shaped form of the derivatives. An average effect was also detected in Bădin et al. (2014), where they used radial input orientation (in a model with two additional inputs, measuring management cost and trading activity). Here, in addition, we provide a formal test. Our bootstrap algorithm provides a p-value of 0.059 (when using the test statistictˆ) and 0.049 (when usingτˆ). Hence, the picture is clearer: for many levels (higher than 0.06) we would reject the null hypothesis. Therefore, the effect of Market Risk seems to be significant. Certainly, having more data would give an even clearer picture.

@&#CONCLUSIONS@&#
In this paper we show how to implement and operationalize the computations of conditional and unconditional directional distances and their robust versions. We provide all the detailed algorithms to compute conditional and unconditional distances when some elements of the directional vector are fixed at zero. We describe how the methodology proposed in Bădin et al. (2012) for radial measures can be adapted to directional distances. We detail in particular how to select the bandwidth in the context of conditional directional distances and how to make a sensible two-stage regression in this framework.Finally, we provide a formal test of significance of external-environmental factors on the average conditional efficiency. This test adapts a bootstrap methodology suggested for usual nonparametric regression. We show how a consistent bootstrap test can be implemented by working with order-αquantile frontiers. The procedure is illustrated with some simulated data sets and with a real data set on US Mutual Funds, by analyzing the role of Market Risk on the mean efficiency, in a simple Mean–Variance model.