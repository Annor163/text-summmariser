@&#MAIN-TITLE@&#
Stabilized space–time finite elements for high-definition simulation of packed bed chromatography

@&#HIGHLIGHTS@&#
A space–time finite element method has been tailored to multidomain mass transfer problems.Packed bed chromatography is simulated in full spatial resolution.Different binding models and boundary conditions are implemented.The solver is parallelized to solve realistic problems on high performance computers.

@&#KEYPHRASES@&#
Stabilized space–time finite elements,Multidomain,Multi-physics,Advection–diffusion–reaction,

@&#ABSTRACT@&#
We present a finite element scheme for spatially resolved simulations of fluid flow and mass transfer in chromatography columns. Packed bed chromatography is an important unit operation for the purification of product molecules in biopharmaceutical industry. The problem combines different challenges arising from advection dominance, stiffness due to the presence of reaction terms, and from the size of the resulting linear equation systems. We show that our stabilized space–time finite element method can handle these difficulties adequately and solve test problems efficiently.

@&#INTRODUCTION@&#
Packed bed column liquid chromatography is among the most important unit operations in biotechnology and chemical process engineering [1]. It is commonly applied for separating and purifying target molecules, e.g., proteins for pharmaceutical use, from fermentation broth. An aqueous solution containing a mixture of molecules is pumped through the cylindrical chromatography column which is filled with porous particles (beads). While mass transport through the interstitial volume between the beads is governed by advection and diffusion, the solute molecules can also diffuse into the beads. The inner surfaces of the beads are functionalized with chemical groups to which the solute molecules can bind. The desired separation is facilitated by varying binding affinities of different molecule species in the mixture. Consequently, these species have different retention times, i.e. leave the column at different times [2,3] (Fig. 1).For numerical process analysis and optimization of packed bed chromatography, most established algorithms employ rather simple one-dimensional models [4,5]. In spite of complex packing geometries, these models rely on homogeneity assumptions, considering concentration gradients only along the column axial and in bead radial directions. Such simplified models generally produce proper numerical predictions for typical laboratory and industrial-scale applications with columns of up to several liters of volume. However, recently miniaturized chromatography columns on the micro-liter scale are increasingly utilized for investigating and optimizing industrial chromatography processes. For these scale-down applications, the prevalent one-dimensional models are not suitable, since spatial inhomogeneities due to channeling and wall influence become dominant.We have developed a finite element method for simulating separation processes in randomly packed micro-columns. Such problems are strongly advection dominated and stiff due to low diffusivities and complex reactive terms, which describe the binding of solute molecules to the functionalized inner bead surfaces. Moreover, realistic-size applications that require 3D simulations can involve 104 and more beads, which result in complicated geometries and in 108 elements minimum for a reasonable spatial resolution. Thus, besides accurate numerical schemes, a special focus is required on computational efficiency and parallel scalability.We apply a stabilized fully implicit space–time finite element method to solve the described problems. The approach relies on a piecewise linear approximation with Galerkin least squares stabilization and uses a discontinuous-in-time ansatz for transient problems. This allows us to use a classical time marching procedure and provides a simple formulation while precluding stability problems. Parallel computations on distributed memory clusters are facilitated by a two-level mesh segmentation which is obtained from existing graph-partitioners. We present 2D and 3D test cases to verify the implemented method and to underline the suitability of our approach for realistic problem settings.Spatially resolved simulation of packed bed chromatography involves two steps:1.solving the steady-state incompressible flow problem,solving the transient mass transport and the adsorption problem.Fluid flow in the interstitial volume between the beads is in the low Reynolds number regime (typicallyRe<0.1). Hence, this region is governed by Stokes equations describing steady-state flow of an incompressible fluid by means of conservation of mass and momentum (see, e.g., [6]):(1)∇·σ=0withσ=−μ(∇u+∇uT)+pI,(2)∇·u=0inΩ1.Hereσis the fluid stress tensor, μ denotes the dynamic viscosity and Ω1 refers to the interstitial column volume. Appropriate boundary conditions are no-slip on the cylinder wall and bead surfaces, along with a prescribed normal velocity field at the inlet and vanishing normal stresses at the outlet:(3)u=0onΓwall∪Γsurf,(4)u=UonΓin,(5)n·σ=0onΓout,with∂Ω1=Γin∪Γout∪Γwall∪Γsurf.Transport and binding of solute molecules in the packed bed are described in terms of a multidomain formulation, because the problem comprises different physical phenomena in different parts of the computational domain (Fig. 2). While the interstitial volume is governed by an advective–diffusive transport problem, we have a coupled diffusion–reaction problem inside the beads. The diffusion equation incorporates a sink term which accounts for the effect of adsorption and is directly influenced by the respective binding model. Such models comprise ordinary differential equations and potentially algebraic constraints. In this paper, we use the customary Langmuir [7] and steric mass action (SMA) [8] models, but our formulation allows us to employ any other adsorption model as well.For a system consisting of N chemical species, the governing equations for mobile phase concentrations ciand stationary phase concentrations qiof species i read (where i=1 refers to the buffer salt component in the case of the SMA model) as follows:Domain Ω1 – interstitial volume – advection and diffusion:(6)∂c1i∂t+(u·∇)c1i=D1i∇2c1iinΩ1,where u is the fluid velocity field as determined by solving Stokes equations in the first step, and D1 is the molecular diffusivity. The transported scalar c1 is the concentration of solute molecules in the surrounding fluid. For better readability, we drop from here on the superscript i on all concentrations (c and q) and species-dependent coefficients (e.g., D, kf, qm, ka, kd, ν, σ), unless a differentiation is necessary.Domain Ω2 – beads – diffusion and adsorption:(7)ε∂c2∂t+(1−ε)∂q∂t=D2ε∇2c2inΩ2,where D2 is the effective diffusivity, and ε is the bead porosity. Two different binding models describing the exchange between liquid and solid phase are implemented:Langmuir model:(8)∂q∂t−kac2qm(1−∑j=1Nqjqmj)+kdq=0Steric mass action (SMA) model:(9)q1+∑j=2Nνjqj−Λ=0(electro-neutralityconstraint)(10)∂q∂t−kac2(q¯1)ν+kdq(c21)ν=0fori=2..N(11)whereq¯1=q1−∑j=2NσjqjHere kaand kdare the adsorption and desorption coefficients, respectively, qmis the maximum binding capacity in the Langmuir model,Λis the ionic capacity in the SMA model, σ is the steric factor, and ν is the characteristic charge of the molecules.Both binding models allow mutual interactions between different chemical species. However, while the Langmuir model can describe a single component system, the SMA model always relies on an additional salt component which regulates the binding affinities of the other molecules. The SMA model involves highly non-linear reaction terms and an algebraic constraint (Eq. (9)), which makes it generally stiff.Boundary conditions: Most boundary conditions are straightforward (inlet, outlet, and column wall). However, depending on the modeled system, either a diffusive flux continuity or an infinitely thin film of stagnant fluid may be assumed at the bead surfaces. Both options can be treated with our method. The conditions are the following:Prescribed concentrations at the inlet:(12)c1(t)=C(t)onΓinVanishing normal diffusive flux at the outlet and vanishing normal total flux at the column wall(whereu≡0):(13)n·∇c1=0onΓout∪ΓwallFlux continuity across bead surfaces:(14)n1·(−D1∇c1)=n2·(−D2ε∇c2)onΓsurf,or infinitely thin film diffusion across bead surfaces:(15)n1·(−D1∇c1)=kf(c1−c2)onΓsurf,1,(16)n2·(−D2ε∇c2)=kf(c2−c1)onΓsurf,2,where kfis a film mass transfer coefficient, andΓsurf,1andΓsurf,2refer to the bead surface seen from subdomains 1 and 2, respectively. The continuity condition (14) automatically ensuresc1=c2at the domain interface for all timest>t0, provided that the computation is started with physically correct initial conditionsc1=c2att=t0. On the other hand, the film diffusion BC (15) allows differing concentrations at both sides of the interface. Hence, the discretization scheme must account for such jumps in the solution.The steady-state Stokes flow problem in subdomainΩ=Ω1((Eqs. (1) and 2)) is solved with a stabilized Galerkin finite element method on simplex elements (P1P1). The corresponding discrete weak formulation reads as follows:Find(vh,ph)∈Sh×Qhsuch that for all(wh,qh)∈Vh×Qh:(17)∫Ω∇wh:μ∇vhdΩ+∫Ωwh·∇phdΩ=0,(18)∫Ωvh·∇qhdΩ−∑EτE∫ΩE∇qh·∇phdΩE=0.Herein,Shand Qhare the suitable finite dimensional interpolation spaces for velocities and pressure, respectively. Note that members ofShmust satisfy the Dirichlet boundary conditions, i.e. in our case the inlet velocity profile. The test function space for the pressure is identical to its solution space Qh, whereas test functions for velocities are required to vanish on Dirichlet boundaries.The stabilization term∑E…is a sum of element-wise contributions to prevent oscillations which are due to our equal-order discretization that does not satisfy the LBB condition [9]. There are different formulations available for the stabilization parameterτEthat generally include some heuristics.Detailed derivations and explanations of the stabilized Galerkin method for the Stokes problem can be found in the literature [10–13].For discretization of the time-dependent mass transfer equations (Eqs. (6)–(11)) we apply a stabilized first-order space–time finite element scheme [14–16]. The space–time domain is subdivided into so-called space–time slabs. Each space–time slab has to be solved in consecutive order, as in a typical time-marching scheme. For time discretization, we use piecewise linear shape functions that are not continuous across space–time slab interfaces. Temporal continuity is weakly enforced in the variational formulation.Stabilization is required for the usually advection-dominant transport problem in the interstitial column volume. The coupled diffusion–adsorption problem inside the porous beads may also need stabilization, if the reaction terms become dominant [17,18]. However, even for realistic parameter settings the problem is typically just at the edge of reaction-dominance and even without stabilization no spurious oscillations have been observed. Error analyses of similar finite element schemes for the advection–diffusion–reaction problem can, e.g., be found in [19,20].The complete mass transfer problem is described by the following weak forms:Domain Ω1: For time step n with space–time slabQn=Ω1×]tn,tn+1[over the spatial domain Ω1, findc1h∈SDhs.t.∀wh∈S0h(where ShDis the space of functions satisfying the Dirichlet BC, and Sh0 is the linear space whose elements vanish on the Dirichlet nodes):(19)∫Qnw(c1,t+(u·∇)c1)dQn+∫Qn∇w·D1∇c1dQn+∫Ω1w+(c1+−c1−)dΩ1+∑E∫QEnτE(w,t+(u·∇)w−∇·(D1∇w))(c1,t+(u·∇)c1−∇·(D1∇c1))dQEn=RHSThis equation has to be solved for each chemical species i (ci1). The superscript h, which denotes members of finite dimensional subspaces (in terms of piecewise linear polynomials), has been omitted for readability.The first integral describes local and advective contributions, the second integral corresponds to the diffusive term. The third integral weakly enforces temporal continuity across space–time slab interfaces (wherec1−andc1+are the different solution values when approaching the space–time slab interface from below and above, respectively). The sum over all elements refers to Galerkin/least squares type stabilization, which is consistent in the sense that any solution to the strong form (6) is also a solution to the stabilized weak form. The right-hand side of this equation depends on the boundary condition used at the domain interface:Flux continuity:(20)RHS=∫Γsurfwn2·(D2ε∇c2)dsThin film diffusion:(21)RHS=∫Γsurfwkf(c2−c1)dsThe stabilization parameterτEdepends on the local element Péclet number, which means that it has to be computed separately for each chemical component, because the diffusivities can vary between different species. Moreover, note that in our special case of linear shape functions, the second-order terms∇·(D1∇w)and∇·(D1∇c1)vanish. Hence, the final space–time GLS formulation for linear elements reads in residual form:(22)∫Qnw(c1,t+(u·∇)c1)dQn+∫Qn∇w·D1∇c1dQn+∑E∫QEnτE(w,t+(u·∇)w)(c1,t+(u·∇)c1)dQEn+∫Ω1w+(c1+−c1−)dΩ1−RHS=0Domain Ω2: For space–time slabQn=Ω2×]tn,tn+1[over the spatial domain Ω2, findc2h,qh∈Shs.t.∀wh∈Sh:Transport:(23)∫Qnw(εc2,t+(1−ε)q,t)dQn+∫Qn∇w·D2ε∇c2dQn+∫Ω2w+(c2+−c2−)dΩ2+∫Ω2w+(q+−q−)dΩ2−RHS=0Here we have either(24)RHS=∫Γsurfwn1·(D1∇c1)dsor(25)RHS=∫Γsurfwkf(c1−c2)dsLangmuir model:(26)∫Qnw(q,t−kac2qm(1−∑j=1Nqjqmj)+kdq)dQn+∫Ω2w+(q+−q−)dΩ2=0SMA model:(27)∫Qnw(q1+∑j=2Nνjqj−Λ)dQn=0(28)∫Qnw(q,t−kac2(q¯1)ν+kdq(c21)ν)dQn+∫Ω2w+(q+−q−)dΩ2=0This formulation is sufficient for implementing a residual function for the mass transfer equations and to assemble element and global system matrices. Local linearization is typically required, if a Newton method is used for the non-linear system solution.Although in this paper our focus is on the mathematical foundations of our method, we aim at computing realistic-size chromatography problems with our solver. Since these can easily involve 108 and more degrees of freedom, adequate parallelization and scalability on high-performance computers is required. This should be accounted for already in early stages of the solver development. Hence, in this section we highlight major implementation details of our code, with a focus on parallelization issues.In order to solve the non-linear algebraic systems resulting from the space–time discretization, we apply a Newton-Raphson method. The residual and Jacobian matrix are assembled directly from the weak forms (22), (23) and (26)–(28). We apply second-order quadrature rules to evaluate most element-wise integrals exactly for linear shape functions. Finally, the linear systems for the Newton update are solved using a GMRES method which performs well for our problems [21–23]. Preconditioning, for example by incomplete LU factorization (ILU), is currently not used in order to improve parallel scalability. Future developments will address parallel ILU preconditioning [24–26].For a correct formulation of the physical domain interface at bead surfaces (esp. for the thin film layer boundary condition), we must allow a sharp discontinuity in solution values. We have chosen a straightforward approach in which the interface is exactly resolved by the finite element mesh and we always have two mesh nodes at the same location, each belonging to a different subdomain (Fig. 3). An alternative concept for treating domain and material interfaces with potential discontinuities would be, for example, the extended finite element method (XFEM) in which element interpolation spaces are locally enriched with discontinuous shape functions for representing jumps in the solution variable [27,28]. However, this can complicate load balancing, and conditioning of the discrete system may be worse due to very small cut cells. The specific difficulties we face in connection with the multi-domain coupling are in detail:•The mesh will disaggregate into disjoint parts because corresponding interface nodes (partner nodes) are not connected by elements (Fig. 3).The multidomain connectivity across the interface must be stored in addition to the regular mesh connectivity.In parallel computations, nodal values have to be exchanged, i.e. communicated, between partner nodes in every solver iteration to evaluate the interface boundary condition.Coupling terms in the system matrix resulting from the domain interface surface integrals (Eqs. (14) and (15)) can corrupt the band structure of the system matrix. In our implementation, these coupling terms are neglected without noticeable decrease in convergence rates.Within the finite element solution procedure we encounter different steps that have to be parallelized on different levels:1.The matrix and the residual assembly are performed element-wise. Thus, a certain distribution of elements on the available processing units is required.The linear system solution is related to the degrees of freedom of the system, which are located on the nodes. Therefore, in order to perform parallel matrix–vector multiplications, a distribution of the mesh nodes is required as well.We use graph-partitioning techniques to obtain close-to-optimal segmentations of unstructured triangular and tetrahedral meshes. The FE mesh is converted to an extended dual graph in which each element and each node are represented by a graph vertex (Fig. 4). Edges exist between vertices of neighbor elements and between elements and their corresponding nodes. Consequently, the graph vertices mirror computing effort (either element or node related) while edges represent required communication between the two levels.Such a dual graph can be handled directly by typical graph-partitioning or mapping algorithms such as METIS [29] or SCOTCH [30]. These algorithms use certain heuristics to split the graph across its edges into a given number of parts, such that each part comprises a similar amount of vertices, and the number of cut edges is minimized. We use the MPI parallel versions ParMETIS [31] and PT-SCOTCH [32] to avoid excessive computation time requirements and memory problems for large meshes. While ParMETIS scales better on large numbers of processors(>512), PT-SCOTCH appears to be more robust, and furthermore provides the possibility to compute mesh-architecture mappings, which account for the network topology of the compute cluster.Through the multidomain coupling we introduce an additional communication pattern to our system, because partner node values have to be exchanged every time when the interface boundary condition is evaluated. In order to account for this in the partitioning, we add edges to the extended dual graph between partner nodes. These are the only edges between two node vertices.

@&#CONCLUSIONS@&#
We have presented a finite element method for spatially resolved simulation of fluid flow and coupled mass transport and adsorption/desorption processes in packed bed chromatography columns. Such a scheme is required to investigate and fundamentally understand the impact of local mechanisms in chromatography columns in particular but not only at the micro-scale.A Galerkin/least squares type stabilization makes our method applicable to strongly advection dominated problems, while the fully implicit space–time FEM approach allows stiff reactive, i.e. adsorption, equations. Multi-domain physics are captured in the discrete FEM context by doubling mesh nodes at domain interfaces and thereby allowing for sharp jumps in the discrete solution. Since realistic 3D chromatography applications can involve several hundred million degrees of freedom, our focus has been on solver efficiency and scalability on parallel supercomputers. This is realized by mesh-partitioning that ensures load balancing and minimization of inter-process communication.We have demonstrated correct implementation of multi-physics extensions by means of 2D test cases. Transport and adsorption of single and multi-component systems as well as exchange between different physical subdomains can be correctly simulated with our code. These results lay the basis for applying the solver to full-scale 3D problems. The presented simulator is ready for large-scale computations, which we have illustrated with a 3D benchmark problem with 750 spherical beads. Although this system is still about one order of magnitude smaller than our target problems, it incorporates all the expected challenges and shows important features of micro-scale chromatography. Fluid velocities as well as solute molecule concentration profiles exhibit pronounced inhomogeneities inside the packed bed. This observation strongly supports our hypothesis that simple homogenized 1D models may not be valid for mathematical description of chromatography at the micro-scale. However, the question how these irregularities ultimately affect separation efficiency of multi-component mixtures in complete micro-scale columns with more than 10K beads is still to be answered, and will be subject of future research.