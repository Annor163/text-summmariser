@&#MAIN-TITLE@&#
Application of detector precision characteristics for the denoising of biological micrographs in the wavelet domain

@&#HIGHLIGHTS@&#
We propose a new wavelet-domain denoising algorithm for biological micrographs.We compute noise characteristics directly from image acquisition parameters.Algorithm exploits intra- and inter-scale correlation of wavelet coefficients.Algorithm outperforms others: AdaptShrink, BivarShrink, and OraclShrink.

@&#KEYPHRASES@&#
Microscope imaging,Biomedical imaging,Acquisition noise modeling,Wavelet image denoising,Adaptive soft thresholding,

@&#ABSTRACT@&#
Typical fluorescence microscopy images contain large amounts of noise, which depends on the signal in a complex manner. This characteristic is substantially different from digital photography or satellite data, for which most of the existing denoising algorithms have been designed. Therefore, an efficient estimation of the noise in fluorescence micrographs and its removal pose a challenge. On the other hand, as shown previously, the use of a calibrated microscopy detector may allow computation of the signal and noise characteristics directly from the image acquisition parameters. Therefore, we propose a denoising algorithm that takes advantage of this information to obtain an estimate of the signal and the corresponding noise in the wavelet domain. This general model was constructed using actual fluorescence micrographs and utilizes intra- and inter-scale correlations of the wavelet coefficients. The signal-to-noise estimate was then applied to perform local soft thresholding in the wavelet domain. The performance of the proposed algorithm was tested using a set of images of several common subcellular structures containing various amounts of signal-dependent and signal-independent noise. The denoising performance of the new algorithm depends on the actual amount of noise and on the type of imaged structures. In every case, we demonstrated that the proposed algorithm is superior to two other locally adaptive denoising algorithms (AdaptShrink and BivarShrink) and to optimal subband adaptive soft thresholding (OraclShrink).

@&#INTRODUCTION@&#
The prominence of noise, which is caused by a low number of detected photons, is a typical problem in images registered with fluorescence microscopy. The purpose of denoising is to eliminate this random image component while retaining the biological structures under study. Traditionally, this is achieved by linear processing, such as spatial/temporal averaging and Wiener filtering. Inspired by the seminal works performed by Donoho and Johnstone [1–3], a number of studies have used nonlinear filtering based on (soft) thresholding in the wavelet domain. The main idea is to subtract the threshold value (T) from all of the coefficients greater that T and set the others to zero. In general, the threshold should be proportional to the variance of the noise and inversely proportional to the standard deviation of the distribution of the wavelet coefficients in the absence of noise [4,5]. Determination of the optimal threshold is not a trivial problem, and several methods have thus been developed to this end. The signal and noise characteristics (and thus the threshold value) may be globally estimated as proposed by the VisuShrink algorithm [1]. Another option is the adoption of subband-adaptive thresholding, as in the SureShrink algorithm [2]. Superior performance is usually achieved with another data-driven algorithm, AdaptShrink [4]. The efficiency of denoising may be further improved by taking the correlations between coefficients at different resolution scales into account [6–9].It should be noted that the statistical models of wavelet transform coefficients adopted in these schemes were constructed for natural images [10–13]. The typical dynamic range of this type of data corresponds to 256 levels (8 bits), with the intensity histogram spanning the whole range. Conversely, when larger dynamic range is used, histograms of such images tend to be sparse [14]. This effect is a source of a significant data redundancy. Furthermore, the majority of denoising algorithms have been designed for signal-independent noise, which is the major artifact in images acquired with consumer cameras operating at a high photon flux. These prerequisites may not be met in fluorescence microscopy, where a scarcity of light is the major limitation, but image acquisition is performed with low-noise detectors operating at a high (16 bits) dynamic range. Fortunately, when using this modality, one does not have to compute the signal and noise characteristics from the images that are to be denoised. This information may be available beforehand if a calibrated detector (e.g., CCD and PMT) is used with known image acquisition parameters [15,16].In this study, we constructed spatial models of wavelet-domain noise as a function of the image acquisition parameters of a typical CCD detector used in microscopy. We then adapted a bivariate shrinkage algorithm [6] to compute and apply the wavelet threshold in a locally adaptive inter-scale-dependent manner. We compared the proposed denoising approach to AdaptShrink [4], the original BivarShrink [7] and optimal subband adaptive soft thresholding (OraclShrink).MSU 1.1 human fibroblasts and HepG2 human hepatoma cells were cultured on 20-mm-diameter, 0.17-mm-thick coverslips placed in tissue culture Petri dishes. DMEM (Sigma), supplemented with 10% fetal bovine serum (Gibco) and antibiotics, was used. Fixed and stained bovine pulmonary artery endothelial cells were not cultured in our laboratory but purchased from Molecular Probes/Invitrogen as FluoCells prepared slide #2.Coverslips with live cells (MSU 1.1 or HepG2) were washed three times with PBS (with Mg+2 and Ca+2) and fixed with formaldehyde (1% in PBS at 20°C for 1h). MSU 1.1 cells were stained by incubation with a solution of DAPI (10μM) for 30min to visualize the DNA. HepG2 cells were stained by incubation with NAO (1μM) for 15min to visualize the mitochondria. The endothelial cells were labeled by the manufacturer using mouse anti-bovine α-tubulin monoclonal antibodies in conjunction with BODIPY FL goat anti-mouse IgG antibody.Images of the endothelial cells were acquired using a Nikon E1000 wide-field fluorescence microscope. The microscope was equipped with a Nikon 60× PlanApo oil-immersion objective lens (NA 1.4) and a 100-W Hg arc lamp. The DAPI fluorescence was registered using a 360- to 370-nm excitation filter (band pass), a 400-nm long-pass dichroic mirror and a 400-nm emission filter (long pass). The fluorescence of BODIPY FL and NAO was registered using a 475- to 495-nm excitation filter (band pass), a 505-nm long-pass dichroic mirror and a 525- to 565-nm emission filter (band pass). A 12-bit monochromatic CCD camera (Retiga 4000R, Qimaging, Burnaby, Canada) was used for image registration. The camera was cooled to 25°C below ambient temperature. A 16× neutral density (ND) filter was used to attenuate the flux of the excitation light. The microscope aperture diaphragm was fully open, whereas the field diaphragm was adjusted to match the field of view of the objective. Image collection was carried out at room temperature. Time series of 128 images of stationary (fixed) cells were collected using full frame (no binning) at an acquisition time of 0.75s and a gain of 2 (DAPI) or 5 (NAO and BODIPY FL). The image acquisition was controlled using ImagePro Plus v 5.1 (Media Cybernetics, Silver Spring, MD, USA).A time series of 128 images of fluorescent cells was acquired as described in the previous paragraphs. Time-averaged images were calculated and subjected to filtering with a hybrid median (3×3 kernel). The background value was set to 200, and the processed images were used as a template for the generation of synthetic noisy images. Three such templates were generated for each of three fluorophores (nine templates in total). A series of images was generated by the addition of Poisson and additive noise to the templates using the following formula:(1)I(x,y)=It(x,y)+P((It(x,y)−B)s)+A(σ)where I(x,y) is the pixel intensity in the noisy image, It(x,y) is the pixel intensity in the respective template image, P is a random value from a Poisson distribution, s is a constant representing the amount of Poisson noise, B is a uniform background (200), A is a random value from a Gaussian distribution with a mean of 0, and σ is the standard deviation representing the amount of additive noise.The noisy images contained varied amounts of signal-dependent (Poisson) noise corresponding to s in the range from 0 to 2.25 and varied amounts of signal-independent (Gaussian) noise corresponding to σ (standard deviation) in the range from 10 to 60. A set of 651 such images was generated for each of nine templates. One should note that the presence and the magnitude of these two forms of noise reflected the actual characteristics of the microscope detector (Retiga 4000 CCD, Qimaging) determined in a previous study [15]. The referenced work was based on the measurement of image noise in the spatial domain. In this study, we modeled the noise in the wavelet domain. Therefore, the template and noisy images were subjected to forward wavelet transform (3 decomposition levels) using biorthogonal Daubechies’ 3.3 wavelet:(2)SL=∑x,ywL(x,y)I(x,y)SLt=∑x,ywL(x,y)It(x,y)where SLis the ith wavelet coefficient at level L, WLis ith biorthogonal wavelet, and I(x,y) and It(x,y) are the pixel intensities in the noisy and template images, respectively. In the reminder of this study the image spatial coordinates (x,y) are omitted for clarity.Each of the decomposition levels comprised three bands corresponding to the sequential application of low- and high-pass wavelet filters (L and H, respectively). The difference between the noisy and template wavelet coefficients was analyzed in two steps. First, the noise was modeled as a two-dimensional linear function of these noisy coefficients and their parents (respective coefficients at higher decomposition level):(3)δ2(SLB(i))=(SLB(i)−SLBt(i))2V(SLB,S(L+1)B)=∑i∈LBδ2(SLBt(i))N(SLBt(i))=ESLB+DS(L+1)B+Cwhere StLBand SLBare the ith wavelet coefficients (template and noisy, respectively) obtained by decomposition at level L and in band B (HH, LH or HL), S(L+1)Bis the corresponding ith noisy parent wavelet coefficient (coarser resolution level) in the same band (HH, LH or HL, respectively), δ2 is the square of the difference between the noisy and template wavelet coefficients, V is the average δ2 (variance), and E, D and C are phenomenological regression coefficients.The coefficients of this variance function were calculated using the LLS (linear least squares) method separately for two decomposition levels corresponding to finest details (1 and 2) and for each of three bands (HH, LH and HL). The respective coefficients representing the nine templates were averaged. Therefore, the variance represents the expected value for the square of the difference as a function of the energy of the noisy coefficient and its parent in a given band and level. A high correlation (r2>0.98) indicated that the model provided an accurate representation of the noise variance as a function of the wavelet energy.The variance functions were calculated at several levels of signal-dependent and signal-independent noise. Therefore, in the second step, the dependence of the variance function coefficients on the noise levels (characterized by s and σ, see Eq. (1)) were modeled using two-dimensional fifth-order Chebyshev polynomials:(4)ULB(s,σ)=a+bT1(s')+cT1(σ')+dT2(s')+eT1(s')T1(σ')+fT2(σ')+gT3(s')+hT2(s')T1(σ')+iT1(s')T2(σ')+jT3(σ')+kT4(s')+lT3(s')T1(σ')+mT2(s')T2(σ')+nT1(s')T3(σ')+oT4(σ')+pT5(s')+qT4(s')T1(σ')+rT3(s')T2(σ')+sT2(s')T3(σ')+tT1(s')T4(σ')+uT5(σ')Tn(s')=cos(ncos−1(s'))Tn(σ')=cos(ncos−1(σ'))where ULBis the variance function coefficient (E, D or C, Eq. (3)) corresponding to the decomposition level L and band B (HH, LH or HL), s′ and σ′ are scaled between −1 and 1, and a−u are Chebyshev polynomial coefficients.The Chebyshev coefficients were calculated using LLS. The values predicted using these polynomials did not deviate from the coefficients of variance function (Eq. (3)) by more 1%. Consequently, by combining Eqs. (3) and (4), one may calculate the local level (at each wavelet coefficient) of expected noise in the wavelet domain as a function of the global amounts of signal-dependent and signal-independent noise measured in the spatial domain (in an image). Using this information, a thresholding rule was implemented and tested in the wavelet domain, as described in the subsequent paragraphs.To establish a set of local wavelet thresholds adaptive to decomposition, the sub-band expected noise variance was calculated using the following formula:(5)Vnois(SLB,S(L+1)B,s,σ)=ELB(s,σ)×SLB+DLB(s,σ)×S(L+1)B+CLB(s,σ)where SLBis the ith noisy wavelet coefficient obtained by decomposition at level L and in band B (HH, LH or HL), S(L+1)Bis the corresponding ith noisy parent wavelet coefficient (coarser resolution level) in the same band (HH, LH or HL, respectively), s is a constant representing the amount of Poisson noise (Eq. (1)), σ is the standard deviation representing the amount of additive noise (Eq. (1)), and ELB, DLBand CLBare phenomenological regression coefficients (Eq. (3)) at level L and in band B calculated as a function of s and σ using a Chebyshev polynomial (Eq. (4)).The expected variance was calculated separately for every coefficient at two decomposition levels corresponding to finest details (1 and 2) and for each of three bands (HH, LH and HL). To obtain a more accurate estimate of the variance, local averages were computed within sub-bands:(6)Vnloc(SLB,S(L+1)B,s,σ)=∑SLB∈KVn(SLB,S(L+1)B,s,σ)N(K)where K is the neighborhood of the ith noisy wavelet coefficient SLBat level L and in band B (HH, LH or HL), and N(K) is the number of coefficients in K.Similarly, the total and signal variances of the wavelet coefficients were calculated using the following formulas:(7)Vtloc(SLB)=∑SLB∈KSLB2N(K)Vsloc(SLB)=max(Vtloc(SLB)−Vnloc(SLB,S(L+1)B,s,σ),0)where max is the maximum operator.Using a local estimate of the signal and noise variances, a soft thresholding operation was implemented in the wavelet domain using the following formula:(8)TLBloc=VnlocVslocSLBD=max(SLB−TLBloc,0)×sgn(SLB)where SLBis the ith noisy wavelet coefficient at level L and in band B (HH, LH or HL), SDLBis its thresholded (denoised) counterpart, and sgn is the sign operator. Note that if Vsloc=0, then TLBlocis infinite (i.e., the wavelet coefficient is rejected regardless of its value).Thresholding was performed in each of the three decomposition bands (HH, LH and HL) at two decomposition levels (1 and 2). The denoised images were reconstructed through inverse wavelet transform:(9)ID=WL−1SLBDwhere SDLBis the ith thresholded wavelet coefficient at level L and in band B, and W−1Lis the inverse biorthogonal wavelet.The denoising efficiency was calculated with the mean square error (MSE) using the template image as the standard:(10)MSED=∑x,y(It(x,y)−ID(x,y))2N(I)FMSE=1−MSEDMSEnwhere Itis the template image (Eq. (1)), IDis the denoised image, N(I) is the number of pixels in the image, and MSEnis the mean square error calculated for a noisy image (Eq. (1)), similarly to its denoised counterpart.The total level of noise (Eq. (1)) depended on the signal-dependent and signal-independent components as well as the image content. The denoising performance was also affected by these factors. Hence, the relative MSE (FMSE) instead of its absolute value was used as an estimator of the denoising efficiency. The proposed algorithm required a choice of the neighborhood size (K, Eqs. (6) and (7)). Although this choice is arbitrary, it does not significantly affect the algorithm performance because similar values of FMSEwere obtained with neighborhoods of 3×3, 5×5 and 7×7. A size of at least 9×9 resulted in a decrease in the performance. Therefore, a neighborhood of 3×3 was used in all presented calculations.The proposed method takes advantage of both the inter-scale and intra-scale dependencies between the wavelet coefficients. This algorithm may adapt its operation to the local distribution of the wavelet coefficients in different decomposition sub-bands (i.e., it is sub-band and locally adaptive). Therefore, the performance of the proposed algorithm was compared to performance of two other methods that operate based on similar principles, namely AdaptShrink proposed by Chang et al. [4,5] and bivariate shrinkage with local variance estimation (BivarShrink) proposed by Sendur et al. [6,7]. A free software that allows testing of the proposed method using the data of the Reader was prepared (http://sun.aei.polsl.pl/∼rstaros/wddpc/index.html).Briefly, to characterize the activity level at a pixel using AdaptShrink, a weighted average of the absolute value of the pixel neighbors was calculated:(11)Z=∑KwTSBN(K)where K is the neighborhood of the ith noisy wavelet coefficient SBin band B (HH, LH or HL) and at level L or L+1 (parent), N(K) is the number of coefficients in K, and wTis the transpose of the weight matrix.The neighborhood comprised the eight nearest neighbors of a coefficient and its parent at the lower decomposition level. The weights were found through a least squares estimate to minimize the difference between the Z values and the corresponding wavelet coefficients. The variance wavelet was estimated from the other coefficients whose context variables were close in value to Z. For a given coefficient, the C closest points (in value of Z) above and the C closest points below were taken, resulting in a total of 2C-1 points. Hence, the signal variance of the wavelet coefficients was calculated using the following formula:(12)Vsloc(SLB)=max∑SLB∈BSLB22C+1−σe2,0where B is the set of wavelet coefficients SLBwhose context Z falls within a moving window with a size of 2C+1, and σ2eis the variance corresponding to the total noise in the image.The sizes of the neighborhood and context window (C=50) were optimized with respect to the denoising performance (Eq. (9)). To further improve the performance, the deviation in the empirical noise variance (σ2e, calculated from the template and noise image) was used (instead of the variance of σ2 from Eq. (1) corresponding to Gaussian noise only). This parameter was used as an estimation of the noise variance (similar to Vnloc) to perform soft thresholding using the procedure described in Eq. (8). One should note that thresholding was executed at two levels corresponding to finest details (1 and 2) and for each of three bands (HH, LH and HL). Similarly, wavelet reconstruction and FMSEcalculation were executed as in the proposed technique.Several variants of BivarShrink were tested, and model 1 [7] was chosen because it provided the highest denoising performance of the four presented models. Estimation of the total variance was implemented in BivarShrink in the same manner as in the proposed method using Eq. (6) with a local operator. The neighborhood was optimized in terms of performance, and a size of 5×5 was used in the subsequent calculations. Consequently, the signal variance was estimated using the following equation:(13)Vtloc(SLB)=∑SLB∈KSLB2N(K)Vsloc(SLB)=max(Vtloc(SLB)−σe2,0)where σ2eis the variance corresponding to the total noise in the image.The inter-scale dependencies between the wavelet coefficients were implemented in this algorithm in the thresholding step:(14)TLBloc=σe2VslocSLBD=maxSLB2+S(L+1)B2−3TLBlocSLB2+S(L+1)B2,0×SLBwhere SLBis the ith noisy wavelet coefficient at level L and in band B (HH, LH or HL), S(L+1)Bis the corresponding ith noisy parent wavelet coefficient (coarser resolution level) in the same band (HH, LH or HL, respectively), and SDLBis its thresholded (denoised) counterpart.Thresholding was executed at the decomposition level corresponding to finest details (1) and in each of three bands (HH, LH and HL). Wavelet reconstruction and FMSEcalculation were executed as described in the previous paragraphs.The performances of the proposed method, AdaptShrink and BivarShrink were also compared to performance of oracle wavelet shrinkage (OraclShrink, [5]). Briefly, global soft thresholding was applied separately at two levels corresponding to finest details (1 and 2) and for each of three bands (HH, LH and HL). The thresholds were calculated to minimize the square of the error between the wavelet coefficients of the denoised image and their counterparts in the template image. One should note that OraclShrink is a sub-band adaptive technique that does not use information of the inter-scale and intra-scale dependencies between the wavelet coefficients.

@&#CONCLUSIONS@&#
In this study, we describe a new adaptive wavelet denoising algorithm for fluorescence microscopy images. The proposed technique, similarly to the bivariate shrinkage algorithm described in previous studies [6,7], exploits the intra- and inter-scale correlations of the wavelet coefficients. However, in contrast to the previous work [6,7] and to other standard denoising algorithms [1,3,4], which estimate noise parameters directly from the untransformed or transformed data being denoised, we constructed general phenomenological wavelet-domain image detector noise models as a function of the acquisition parameters. Our model is based on an analysis of actual fluorescence micrographs acquired with a CCD camera [15,16]. Hence, the images contain varied amounts of signal-dependent (Poisson) and signal-independent (Gaussian) noise, which correspond to actual acquisition parameters. The expected noise is then computed for each magnitude of the wavelet coefficients and used as an input for soft thresholding in the wavelet domain.The performance of the proposed algorithm was compared to the performance of AdaptShrink [4] and BivarShrink [7] and to optimal subband adaptive soft thresholding (OraclShrink) using a set of biological micrographs containing eight types of common subcellular structures. The performance of the proposed algorithm was affected by the type of imaged structure. The best efficiency was obtained with images of Golgi structures and nucleoli because the majority of the noise was removed with the algorithm. Conversely, the worst performance was observed in the case of the endosome images. It should be noted that while the former structures are characterized by a low internal complexity (they constitute uniform image regions), the latter comprises a set of small isolated objects (few pixels in size). Thus, the correlations between the respective wavelet coefficients at different resolution scales and between their magnitudes at the same scale are less pronounced than in the case of larger objects (nucleoli, filaments, etc.). Moreover, small structures are represented by a small set of wavelet coefficients and therefore appear more similar to noise (which corresponds to uncorrelated coefficients). Nonetheless, in this scenario, the proposed algorithm performed similarly or better that the other tested in this study.One of the possible advantages of the proposed approach is the explicit estimation of signal-dependent (Poisson) noise. It is therefore interesting to note that the proposed method offered superior denoising performance when the contribution of this form of noise was minor (images comprising mostly constant background) or totally absent. The soft wavelet thresholding used in this study was directly adopted from the method constructed for the removal of signal-independent noise only [7], which opens new avenues for further improvement. For instance, one may combine the proposed method with more sophisticated wavelet shrinkage schemes (developed for signal-dependent noise), such as Stein's unbiased risk estimate, SURE [17] and multi-stage Wiener filtering [18]. These approaches will be tested in further studies, and the construction of a simpler model of the relationship between of signal and noise in the wavelet domain will also be investigated in the future.None.The study sponsors were not involved in the study design, in the collection, analysis and interpretation of the data, in the writing of the manuscript, or in the decision to submit the manuscript for publication.