@&#MAIN-TITLE@&#
Bayesian perspective for the registration of multiple 3D views

@&#HIGHLIGHTS@&#
Use of a Bayesian framework allows tolerance to incorrect pairwise registrations.Correspondence weights vary depending on their reliability, until a specific criteria is achieved.Results show that an important improvement is achieved in objects with degraded correspondences.Also in cases without degraded correspondences, the proposed method improves the accuracy in comparison to other methods.

@&#KEYPHRASES@&#
3D registration,Pairwise correspondences,Expectation Maximization algorithm,

@&#ABSTRACT@&#
The registration of multiple 3D structures in order to obtain a full-side representation of a scene is a long-time studied subject. Even if the multiple pairwise registrations are almost correct, usually the concatenation of them along a cycle produces a non-satisfactory result at the end of the process due to the accumulation of the small errors. Obviously, the situation can still be worse if, in addition, we have incorrect pairwise correspondences between the views. In this paper, we embed the problem of global multiple views registration into a Bayesian framework, by means of an Expectation–Maximization (EM) algorithm, where pairwise correspondences are treated as missing data and, therefore, inferred through a maximum a posteriori (MAP) process. The presented formulation simultaneously considers uncertainty on pairwise correspondences and noise, allowing a final result which outperforms, in terms of accuracy and robustness, other state-of-the-art algorithms. Experimental results show a reliability analysis of the presented algorithm with respect to the percentage of a priori incorrect correspondences and their consequent effect on the global registration estimation. This analysis compares current state-of-the-art global registration methods with our formulation revealing that the introduction of a Bayesian formulation allows reaching configurations with a lower minimum of the global cost function.

@&#INTRODUCTION@&#
Current technology allows to obtain 3D representations of real objects or scenarios by using different methods. From usual methods like stereoscopy to complex devices like LADAR or time-of-flight cameras, the possibilities are growing continuously. However, acquisition techniques usually have problems with occluded surfaces or the limited field of view, so it is usually necessary to combine different views of the same object or scenario in order to obtain a full representation. Using this process another problem then arises: the registration of these individual 3D views which will enable, at the end of the process, to a whole 3D reconstruction of the desired object or scene.First step for this objective is the so-called pairwise registration, where the 3D representations are registered pair to pair. Depending if the two structures have overlap, pairwise registration methods will give as a result a transformation which registers the first 3D view to the second one.Multiview registration is the second step of this process, and is usually a more complex situation. Assuming that pairwise registrations are correct, their concatenation along a cycle will probably result in a non-satisfactory multiview registration because of the accumulation of the different pairwise errors. An example of this effect can be seen in Fig. 1.In addition, there could exist another situation which produces more problems. Even if two structures register perfectly in the pairwise registration process, their transformation could be incorrect in a global environment. This could happen specially if we are working with objects with symmetries, planes or repetitive patterns. In these cases, most of the current multiview registration algorithms will fail because they are not ready to deal with this kind of error.The main contribution of this paper, in opposition to other state-of-the-art papers, is the possibility of detecting these incorrect registrations between different views and therefore minimize their impact in the global registration process. This feature is achieved thanks to the use of different weights which encode the reliability we have in the correspondences between the views.The structure of the document is as follows: a review of different registration algorithms is presented in Section 2, followed by an introduction to the main problematic of multiview registration in Section 3. The proposed algorithm is explained in detail in Section 4, and the obtained experimental results are shown in Section 5. Finally, conclusions and possible future improvements are explained at the end of the paper in Section 6.As previously stated the first step in order to achieve the registration of multiple 3D representations is the computation of the pairwise registrations. The most usual method consists in the establishment of correspondences between points of the two views, which can be found by using descriptors like the Spin-Images of Johnson and Hebert [1] or covariance descriptors like the one presented by Fehr et al. in [2]. The combination of correspondences between the two views determines an approximated transformation between them, having a minimum of 3 point correspondences in order to obtain it. This step is known as coarse pairwise registration. After this approximation, the transformation is refined by the so-called fine pairwise registration methods, which minimize the distance between all the points of both point clouds. The most representative examples of fine coarse registration methods are the Iterative Closest Point [3] presented by Besl and McKay in 1992 and the registration algorithm developed by Chen and Medioni [4]. At the end of this pairwise registration execution we will obtain a rigid transformation, composed by a rotation matrix and a translation vector, which registers the first view to the second one.With respect to the multiview registration algorithms, they can be basically divided into two families: sequential registration methods and simultaneous registration methods.The first ones consist in the sequential pairwise registration of additional views to an aggregated view which is continuously growing. This aggregated view is also denominated metaview in some literature, as stated in Matabosch et al. [5]. This method was initially proposed in the aforesaid paper of Chen and Medioni [4] and afterwards improved in the works presented by Pulli [6] and Nuchter et al. [7]. This kind of multiview registration methods have the advantage that they do not need to previously obtain all the views implicated in the registration process, so they do not suffer problems of memory in their execution and can also be useful for applications where the 3D structures are acquired at the same time as the registration is produced, achieving a performance which could be considered near to real-time. However, their main problem is the non-possibility of modifying the already registered views, producing a final result which is usually not as ideal as desired.On the other side, simultaneous registration methods make use of all the information of pairwise registrations at the same time. A good example of this kind of method is the work presented by Eggert et al. [8], where the authors present an iterative algorithm which simultaneously updates the transformations of all the views by using the information of position and normal of the correspondence points. In Silva et al. [9] the multiview registration is achieved thanks to the use of genetic algorithms and a metric defined by the authors called Surface Interpenetration Measure, which indicates the level of confidence on a registration according to the multiple crossings of the surfaces between themselves (i.e. the interpenetration between themselves).Inside the category of simultaneous registration methods a high number of papers base their algorithm on the use of a registration graph which encodes the different pairwise relations between the 3D views. Each node on a registration graph represents an specific view of the object, while each edge encodes the rigid transformation (rotation and translation) between two views. As can be seen in the registration graph of Fig. 2, each node is connected, at least, with the previous and the following node of the sequence of views and, in addition, with a variable number of additional nodes. The establishment of these additional edges to non-contiguous nodes may depend on the result of the automatic pairwise registration between the views (if the registration quality is lower than a pre-defined threshold, this registration is discarded) or also on the preferences of the user.In order to obtain the multiview registration some properties of the registration graph are usually applied, like the property that rotations and translations along a loop of the registration graph should be null. This is the basis for the work presented by Sharp et al. [10], where, for the different basic cycles of the registration graph, the error in rotation and translation is distributed along all the edges. Also the concept of graphs minimization is used in Shih et al. [11] where, using concepts of Lie algebra and circuit theory, the authors develop an algorithm which achieves good results in standard databases, also with the advantage of having a low computational cost.Other papers do not mention explicitly the concept of graph but use it intrinsically, using the same properties and ideas. A good example are the two papers presented by Krishnan et al. [12,13] which are based on the notion that, concatenating translations and rotations along a path, the same 3D view should be obtained independently on the direction we use to arrive to it. One particularity of this method is that it directly works with the correspondences itself and not with the rigid transformations obtained from the pairwise registration methods, so the algorithm uses all the data without losing any information. This fact causes an apparent complexity of the formulation, but using some concepts of Lie algebra and manifolds the authors achieve a compact representation of the problem. These two papers of Krishnan et al. are used as the basis of our algorithm due to the interesting conceptualization of the problem and the good results obtained after their implementation.Independently of the election of using a sequential registration method or a simultaneous registration method, one of the main lacks of the aforesaid papers and the majority of other state-of-the-art publications is that they do not take into account the possibility of having absolutely bad registrations or bad correspondences. One of the few papers that deal with this possibility is the work presented by Hubert and Hebert in 2003 [14], where using the joint distribution probabilities the incorrect correspondences are eliminated and, in consequence, the graph can be separated into different splitted sub-graphs which can afterwards be studied individually. As developed in the following sections of the present paper, our algorithm will also serve for the detection of incorrect correspondences between the views, allowing to minimize the impact of this incorrect information into the global registration process.The most usual problem related with the multiview registration process is the minimization of the global error which is produced due to the small errors in every pairwise registration. These errors could be produced by different factors, like a noisy acquisition process, differences in the 3D structure of two overlapping views due to the different date of acquisition, or, in most of the cases, by an inaccurate selection of correspondences. Having a look at the example already shown in the left side of Fig. 1 it can be easily seen that the result using only the information from the pairwise registration is not enough in order to obtain a good result.There is another possible problem in the multiview registration process which is in fact more problematic and difficult to solve: the possibility of having not only small errors on the registrations but also absolutely incorrect registrations. Consider the example shown in Fig. 3, where different views of a horn are shown. Pairwise registration between different views can be correctly established in most of the cases, but there are some ones which could cause problems. Imagine the pairwise registration of view number 3 or 4 against view number 15. Although the object has been rotated around its longitudinal axis (the color of the balls inside the horn demonstrate this rotation) a pairwise registration algorithm could estimate a registration which, after applying it with the other pairwise registrations, produce a result similar to the one shown in Fig. 4. Similar problems can also be produced if there exist objects with symmetries, planes or repetitive patterns. This is also a common problem in the registration of a model against an scene, where the same object can have multiple instances as studied in [15].In order to solve these two types of problems, and especially the second one, we need to combine both local and global information, or in other words, the information from the pairwise registrations and from the whole multiview result. The proposed novel algorithm in order to solve these issues is presented in the following in Section 4.In this section our developed method for the 3D registration of multiple views is explained, which will be called Bayesian-Based Multiview Registration (BBMR) method in the following. As previously stated, this method is based on the previous work presented by Krishnan et al. in [13]. In our work we apply an additional layer over this method, adding an uncertainty which is solved thanks to the use of the Expectation Maximization algorithm.As an introduction to the problem, we first describe the notation used for the different elements and in a second subsection the proposed Bayesian framework and its resolution using the Expectation Maximization algorithm is presented.According to the notation used in [13], let us consider a set of n points W={w1,…,wn} in a world reference frame. These points can be seen from N different views V1,…,VN, whereVi={vi1,…,vini}. Each view Vican only see a limited number of the total n points, so it is supposed that each nimust be lower or equal to n. In addition, the notation of Vijis used to describe the set of points from Viwhich can be seen also from Vj, so in consequence nijdefines the number of points from Viwhich can be seen from Vjand therefore nij=nji.Each view Viconnects with the world reference frame by means of relative rotation and translation matrices (Ri,ti), such that:(1)wk=Rivijk+tiwk=Rjvjik+tjIn a noise free context there would be an equivalenceRivijk+ti=Rjvjik+tjbetween both sets of points, but in a more realistic case and considering the presence of noise, the minimization error function used to estimate the parameters (Ri,ti) and (Rj,tj) takes the following form:(2)ε=∑k=1nijRivijk+ti-Rjvjik+tj2Applying this expression to all the correspondences between the views:(3)ε=∑i=1N∑j=i+1N∑k=1nijRivijk+ti-Rjvjik+tj2As you can see in [13], Eq. (3) corresponds to the registration error cost function of the Krishnan method. From this point on, we introduce the novel parts of our method, starting by the uncertainty on the points correspondences.In order to evaluate the possible incorrect correspondences, let us assume that there is no prior knowledge between points from two different views, and therefore, the model in Eq. (3) should be generalized in the following way:(4)ε=∑i=1N∑j=i+1N∑k=1nij∑k′=1njiωijkk′Rivijk+ti-Rjvjik′+tj2whereωijkk′is an element of the weight matrix that indicates the degree of confidence for a correspondence of pointsvijkandvjik′.As a simplification of the expression, we can define a new indexkˆas a re-ordered version of the double indexing k and k′. Applying this indexing change, Eq. (4) would be expressed as:(5)ε=∑i=1N∑j=i+1N∑kˆ=1mijωijkˆRivijkˆ+ti-Rjvjikˆ+tj2wheremij≡nij×nji=nij2Let us represent a point correspondence between two specific views Viand Vjasxijkˆ=vijk,vjik′, and let θij=(Ri,ti,Rj,tj) represent the model parameters of these two views which should be estimated. The objective is to maximize the joint likelihood distributionP(Xij|θij)of the observed dataXij=xij1,…,xijmij.The optimization ofPxij1,…,xijmij|θijcan be a difficult task if pairwise relations are unknown. In order to solve this problem, we introduce a set of binary latent variablesZij=zij1,…,zijmij, which can be considered as indicator variables of the correspondence between a pair of pointsxijkˆ=(vijk,vjik′). In an ideal case, where the correspondences were “a priori” known,zijkˆshould be 1 only for those validxijkˆcorrespondences and 0 for the rest of pairs of points between the sets Viand Vj. However, the variables Zijare hidden or, in other words, cannot be directly observed. If their value was known, then {Xij,Zij} would be considered as the complete data set, and therefore, this estimation problem could be easily solved.Assuming conditional independence on the observationsXij=xij1,…,xijmijand the latent variablesZij=zij1,…,zijmij, the joint distribution of the complete data set factorizes as follows:(6)P(Xij,Zij|θij)=∏kˆ=1mijPxijkˆ,zijkˆ|θijwhich according to the binary nature of the latent variables Z takes the following form:(7)P(Xij,Zij|θij)=∏kˆ=1mijPxijkˆ|θijzijkˆApplying the logarithm we obtain the joint log-likelihood of the data set as follows:(8)log[P(Xij,Zij|θij)]=∑kˆ=1mijzijkˆlogP(xijkˆ|θij)where if Zijis known a priori, only the terms indicating correspondence between pairs of points, i.e.zijkˆ=1would contribute to the summation of this log-likelihood function. In addition, if we consider Eq. (5) as the result of a negative logarithm of a Gaussian distribution, we can see a convergence of the probabilistic formulation in Eq. (8) and the previous least squares error problem:(9)log[Pxijkˆ=vijk,vjik′|θij]∝-Rivijk+ti-Rjvjik′+tj2and therefore(10)∑kˆ=1mijzijkˆlogP(xijkˆ=vijk,vjik′|θij)∝-∑i=1N∑j=i+1N∑kˆ=1mijωijkˆRivijk+ti-Rjvjik′+tj2The context of observations Xijand the simultaneous inference of latent variables Zijand estimation of model parameters θijcan be tackled by means of the Expectation–Maximization (EM) algorithm. The EM algorithm was initially presented in 1977 by Dempster et al. in [16] and its possibilities are discussed in detail in [17]. It has been previously used in the field of registration, as can be seen in the work presented by Cross and Hancock [18] or, more specifically in the 3D surface registration field, in the works of Granger and Pennec [19] and Horaud et al. [20].Basically, the EM algorithm is a fixed-point fashion procedure that operates in two steps, which are repeated alternately until convergence:ExpectationGiven an intermediate iteration step l with an instance of the model parameters θl, compute the posterior probability for latent variables zi.MaximizationGiven the posterior probabilityP(Z|X,θl), compute the expected value of the joint log-likelihood of the complete data set {X,Z} and find the parameters θl+1 that maximize it. As pointed out in Appendix A:(11)θl+1=argmaxθ∑kˆ=1mijP(zkˆ|xkˆ,θl)log[P(xkˆ|θ)]Following the equivalence in Eq. (9) the maximization process could be expressed as follows:(12)θl+1=argmaxθ-∑kˆ=1mijPzkˆ|vijk,vjik′,θlRivijk+ti-Rjvjik′+tj2whereθl=Ril,Rjl,til,tjl.In this sense, we can see demonstrated that the estimation of the posterior probabilities and the optimization of the model parameters according to the weights provided by these posterior probabilities has the property of converging to a local maximum. Moreover, Eq. (12) shows that this formulation is equivalent to robust statistics weighted techniques, where the posteriorsPzkˆ|vijk,vjik′,θltake care of the contribution of each observationvijk,vjik′with respect to the estimated model θl. In the following, these two iterated steps are developed for the specific case of the multiview registration explained in this paper. For a more detailed description of the original EM algorithm itself please refer to Appendix A.In the Expectation step the objective is to compute the sufficient statistics for the latent variables posterior distributionsP(Zij|Xij,θij), in order to infer Zijfrom the observations Xijand the parameters of the model θij. Inference occurs when computing the values forzijkˆthat maximize the a posteriori probability of a given data pointxijkˆand a specific instance for the model’s parameters θij.In particular, when inspecting the joint distribution in Eq. (7) and taking into account the Bayes’ theorem, we can see that the form of the posterior probabilityPzijkˆ=1|xijkˆ,θijis proportional toPxijkˆ|θijzijkˆ=1. If we consider the following approximation:(13)Pzijkˆ=1|xijkˆ,θij∝Pxijkˆ|θijthen Eq. (12) would penalize all those pairs of pointsvijk,vjik′with biggest error, while it would consider with higher priority the pairs with lower error in the next estimation iteration of θ. Given this behavior and the empirical observations showing an exponential decay of the posterior probability (these observations will be shown in the experimental results in Section 5), we can model it as a negative exponential distribution:(14)Pzijkˆ=1|vijk,vjik′,θij∝exp-αεvijk,vjik′|θijwhere α corresponds to the sufficient statistics of the exponential distribution. In an ideal case without uncertainties in the correspondences and therefore without weight values this value would be estimated as:(15)α=∑i∑j1∑i∑jεvijk,vjik′|θlIn our case we want to give more importance to the correspondences with higher weight valuesωijkˆ, so this equation would be adapted as:(16)α=∑i∑jEωijkˆPωijkˆvijk,vjik′,θl∑i∑jEωijkˆPωijkˆvijk,vjik′,θlεvijk,vjik′|θlwhereEωijkˆPωijkˆvijk,vjik′,θlis the posterior expectation of the unobservedωijkˆindicator variables, which have been inferred from the model θland the observed datavijk,vjik′:(17)EωijkˆPωijkˆvijk,vjik′,θl=∑ωijkˆ=01ωijkˆPωijkˆ|vijk,vjik′,θl=Pωijkˆ=1|vijk,vjik′,θlAccording to the Maximization step, let us consider the cost function to be optimized:(18)E(θ)=-∑i=1N∑j=i+1N∑kˆ=1mijEεvijk,vjik′|θijPωijkˆ=1vijk,vjik′,θlwhich corresponds to the posterior expectation of(19)ε=∑i=1N∑j=i+1N∑kˆ=1mijωijkˆRivijk+ti-Rjvjik′+tj2=∑i=1N∑j=i+1N∑kˆ=1mijωijkˆRivijk-Rjvjik′2+2(ti-tj)TRivijk-Rjvjik′+|ti-tj|2At this point we can return again to the notation used in [13], so let us define:R≡[R1|R2|…|RN]∈R3×3NT≡[T1|T2|…|TN]∈R3×Nand let eibe the ith column of a N×N identity matrix, and eij=ei−ej.Also let us define:cijkˆ≡(ei⊗I3)vijk-(ej⊗I3)vjik′where ⊗ indicates the Kronecker product[21].The cost function can now be re-written as follows:(20)ε=∑i=1N∑j=i+1N∑kˆ=1mijωijkˆ{cijkˆTRTRcijkˆ+2eijTTTRcijkˆ+eijTTTTeij}Applying the property that u·v=tr(uvT) we obtain(21)ε=trR∑i=1N∑j=i+1N∑kˆ=1mijωijkˆcijkˆcijkˆTRT+2Teij∑i=1N∑j=i+1N∑kˆ=1mijωijkˆcijkˆTRT+T∑i=1N∑j=i+1N∑kˆ=1mijωijkˆcijkˆTeijeijTTTIf we defineA≡∑i=1N∑j=i+1N∑kˆ=1mijωijkˆcijkˆcijkˆTB≡eij∑i=1N∑j=i+1N∑kˆ=1mijωijkˆcijkˆTC≡∑i=1N∑j=i+1N∑kˆ=1mijωijkˆeijeijTthen, the error function can be represented as follows:(22)ε=tr[R|T]ABBTCRTTTThe obtained Eq. (22) corresponds to the same error function presented by Krishnan in [13], but in this case the componentsA,BandCintegrate inside them the uncertainty of the weight coefficientsωijkˆ.Also following the idea of [13], the total registration error function can be written only in terms of rotationsR, since the optimal set of translations can be computed in terms ofRas:(23)T(R)=-RBC†whereC†is the pseudo-inverse ofC. In this case the Eq. (22) transforms into:(24)ε=tr(RMRT)whereM≡A-BC†BTis the Schur complement of the matrixABBTC.According to the EM algorithm formulation, the Maximization step will be the posterior expectation of Eq. (24):(25)E(θ)=-∑i=1N∑j=i+1N∑kˆ=1mijEεvijk,vjik′|θPωijkˆ=1vijk,vjik,θl=trREMPωijkˆ=1vijk,vjik′,θlRTNote that, since the connection weightsωijkˆare not directly observable, the elements ofEM|Pωijkˆ=1|vijk,vjik′,θlmatrix must be estimated in each iteration process of the optimization algorithm, i.e.:(26)E[A]=∑i=1N∑j=i+1N∑kˆ=1mijPωijkˆ|vijk,vjik′,θlcijkˆcijkˆT(27)E[B]=eab∑i=1N∑j=i+1N∑kˆ=1mijPωijkˆ|vijk,vjik′,θlcijkˆT(28)E[C]=∑i=1N∑j=i+1N∑kˆ=1mijPωijkˆ|vijk,vjik′,θleijeijTwherePωijkˆ=1|vijk,vjik′,θl∝exp-αεvijk,vjik′|θland α is obtained from the Expectation step in Eq. (16).As a summary of the whole process, in order to implement the proposed method the schema shown in Algorithm 1 should be followedAlgorithm 1Summary of the proposed methodInitialization•Obtain an initial estimate forθ0=R10,…,RN0,t10,…,tN0using the original Krishnan method, which corresponds to an ideal case without correspondences uncertainty•Initialize the correspondences uncertainty matrixωijkˆto 1 for all the correspondenceswhileεvijk,vjik′|θl+1-εvijk,vjik′|θl>ξdoExpectation•Find the sufficient statistics of the exponential distribution shown in Eq. (14):α=∑i=1N∑j=i+1NEωijkˆPωijkˆvijk,vjik′,θl∑i=1N∑j=i+1NEωijkˆ|Pωijkˆ|vijk,vjik′,θlεvijk,vjik′|θl•For each pairwise correspondence used in the registration process, infer the new uncertainty factorωnew=ωoldαexp-αεvijk,vjik′|θij∑i=1N∑j=i+1Nαεvijk,vjik′|θij,where for simplicity, ωnewindicates[ωijkˆ]l+1and ωoldindicates[ωijkˆ]lMaximization•Calculate the matricesA,BandC:A≡∑i=1N∑j=i+1N∑kˆ=1mijωijkˆcijkˆcijkˆTB≡eij∑i=1N∑j=i+1N∑kˆ=1mijωijkˆcijkˆTC≡∑i=1N∑j=i+1N∑kˆ=1mijωijkˆeijeijT•Estimateθl+1=R1l+1,…,RNl+1,t1l+1,…,tNl+1by minimizing Eq. (14)with the posterior expectationend

@&#CONCLUSIONS@&#
This paper presents our Bayesian-Based Multiview Registration (BBMR) method for the registration of multiple 3D scans. The main property of our BBMR method consists in the property of being tolerant to a certain number of incorrect correspondences which could be caused by different factors like an incorrect manual selection, symmetries on the scanned 3D object or repetitive patterns. This tolerance is achieved thanks to the use of an additional layer placed over an existing multiview registration method, by using weight values which are applied to the point correspondences depending on their reliability. The value of these weights is estimated iteratively by means of a Bayesian framework, and the global registration problem is solved thanks to the Expectation Maximization method.Results obtained show that the presented algorithm is able to register correctly approximately half of the 3D scenes with an incorrect pairwise correspondence tax between 30% and 35%. This result outperforms other existing registration methods, allowing a higher flexibility in the establishment of pairwise correspondences either by manual or automatic selection. In addition, in cases with a low degradation percentage, our BBMR method achieves also a better registration compared to the Krishnan algorithm, used as base method for our study. As a drawback the algorithm takes a relative high time, as it is basically composed of multiple iterations of this Krishnan algorithm.Possible studies to develop in the near future include the possibility of defining a distance metric in order to evaluate the compactivity or consistency of the registration result after each iteration of the BBMR method. In the experimental results section of this paper we partly solved this situation by comparing the resulting final registration against a pre-registered object, but in a more general situation it is not expected to have access to this reference object. Of course, this distance metric should be defined “from an external point of view” and independent of the beforehand obtained pairwise correspondences, because it could be the case that these pairwise correspondence could be incorrect. Methods like the ones explained by Huber and Hebert in [23] regarding the space violation with respect to the visibility or the Surface Interpenetration Measure presented by Silva et al. in [9] could be used and combined for this purpose.