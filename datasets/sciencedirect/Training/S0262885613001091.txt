@&#MAIN-TITLE@&#
Reliability measure for shape-from-focus

@&#HIGHLIGHTS@&#
The performance of focus measure depends on the optics and imaging conditions.The concept of reliability in focus measure is introduced.A method for computing the reliability of shape-from-focus is presented.The proposed reliability integrates efficiently to shape-from-focus.The proposed method is experimentally effective.

@&#KEYPHRASES@&#
Image sequences,Focus measure,Shape from focus,Reliability,Depth-map carving,

@&#ABSTRACT@&#
Shape-from-focus (SFF) is a passive technique widely used in image processing for obtaining depth-maps. This technique is attractive since it only requires a single monocular camera with focus control, thus avoiding correspondence problems typically found in stereo, as well as more expensive capturing devices. However, one of its main drawbacks is its poor performance when the change in the focus level is difficult to detect. Most research in SFF has focused on improving the accuracy of the depth estimation. Less attention has been paid to the problem of providing quality measures in order to predict the performance of SFF without prior knowledge of the recovered scene. This paper proposes a reliability measure aimed at assessing the quality of the depth-map obtained using SFF. The proposed reliability measure (the R-measure) analyzes the shape of the focus measure function and estimates the likelihood of obtaining an accurate depth estimation without any previous knowledge of the recovered scene. The proposed R-measure is then applied for determining the image regions where SFF will not perform correctly in order to discard them. Experiments with both synthetic and real scenes are presented.

@&#INTRODUCTION@&#
A great effort has been devoted in the field of image processing in order to develop and improve both active and passive techniques for depth recovery and 3D shape reconstruction. In particular, shape-from-focus (SFF) is a passive technique for depth recovery that requires a sequence of images from a scene captured by changing the focus configuration of the imaging device. This image sequence is usually referred to as focus sequence or focus sweep. The main interest of SFF is that, as a passive method, there is no physical interaction between the capturing device and the scene. In addition, since a single camera is used, correspondence problems typical of stereo or vergence are avoided. Moreover, the hardware complexity is low, with no special equipment being required, as in the case of active techniques such as optical triangulation, LIDAR imaging and laser scanning.An important step in the application of SFF is the computation of the focus level for every scene point in every image frame of the focusing sequence. Many focus measure (FM) operators have been proposed and tested in the literature. All of them require that the change in the focus level of the imaged points be detectable. This is an important limitation if SFF is to be applied to complex scenes captured with large depth-of-field (DOF) systems where the optical configuration of the capturing device and the image content may lead to erroneous detections of the change in focus. In this work, the term “large DOF systems” refers to conventional macroscopic cameras in which the DOF is large with respect to the working distance. In contrast, in microscopy imaging, the large focal lengths lead to very short DOFs; and the captured images are usually rich in texture due to the high magnification. In addition, the focus sweep is obtained by moving the captured object while the camera's optics remains fixed, yielding an acquisition with constant DOF. For this reason, SFF has typically been used in microscopy and in well-controlled scenarios, where favorable imaging conditions are guaranteed prior to the application of that technique. For instance, SFF has been applied in microscopy for PCB inspection and manufacturing [1].Due to the aforementioned reasons, the application of pure SFF in conventional cameras has been limited. For instance, in [2] and [3], a depth-from-defocus prototype that projects a light pattern in order to compensate for the lack of texture was developed. In [4], a hybrid system that combines SFF and stereo has been proposed. In [5,6], the result of SFF is improved using the information of relative defocus.The problem of applying SFF to complex scenes using conventional cameras is tackled in this work. With the proposed methodology, we show that even in complex scenarios, useful information about the scene depth can be obtained by means of SFF as long as a way for measuring the reliability of the depth estimation is available. For instance, Fig. 1(a) shows a synthetic scene that consists of a conical surface with a texture mapped on it. Fig. 1(b) shows the corresponding depth-map obtained through SFF. It is clear that some regions of the obtained reconstruction are inaccurate and highly corrupted by noise. In this case, traditional smoothing techniques such as median filtering [7,8], bilateral filtering [9] or non-local means [10,11] are of limited application since large areas of the recovered scene are unreliable. In contrast, Fig. 1(f) shows the depth-map of Fig. 1(b) after having been filtered by carving those pixels whose reliability is below a given threshold. The reliability measure allows identifying and removing less accurate pixels while preserving the useful information of the depth-map. In contrast to previous approaches, the reliability of each pixel is estimated before the computation of the depth-map based on the behavior of the focus measure over each pixel of the imaged scene. Experimental results on real and synthetic data are provided.The problem of estimating the reliability of the focus measure is analogous to confidence estimation in stereo and optical flow [12,13]. In that scope, the aim is to rank depth estimates in stereo vision or flow fields in optical flow according to the likelihood for being correct. To the best of our knowledge, the problem of determining the confidence of the focus measure estimation is tackled in this paper for the first time.This paper is organized as follows: Section 2 reviews the main concepts behind SFF and the relevant related previous work. Section 3 describes the proposed approach. Section 4 presents the experiments carried out on real and synthetic data, and discusses the obtained results. Finally, conclusions and future work are given in Section 6.

@&#CONCLUSIONS@&#
The concept of reliability for shape-from-focus has been introduced in this work. A reliability measure, R-measure, aimed at predicting the confidence of the depth-estimation using SFF has been presented. The proposed R-measure efficiently exploits the information of the focus signals corresponding to each pixel of the imaged scene in order to compute a reliability value.An application of the proposed R-measure for detecting and removing low-accuracy regions of the reconstructed depth-maps has been analyzed. The proposed approach is a step toward the application of SFF to complex scenes without previous knowledge or restrictions on the image content. In the literature, most results of applying SFF to real sequences have been limited to microscopic scenes, where an accurate control of the focus position and a shallow depth of field are more easily attainable. Alternatively, the proposed methodology provides a scheme for applying SFF to real macroscopic scenes by selecting the regions where SFF will yield accurate results. The proposed technique has been validated with both synthetic and real data and compared with different alternatives, showing a significantly higher performance.Future work will focus on denoising and recovering low-reliability regions of the filtered depth-maps. The problem of recovering lost data in images [41,42] and surfaces [43,44] is referred to as hole filling or surface filling. Intensive research is being devoted to this topic in the computer vision community. In this way, the aim is to integrate the R-measure with existing filling and regularization techniques.In this work, the R-measure has been applied successfully using the Gaussian model and the Lorentzian–Cauchy model for the focus profile. Notwithstanding, it can be readily extended to deal with different focus profiles. In this way, future research will be aimed at proposing new focus profile models for conventional cameras.