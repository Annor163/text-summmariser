@&#MAIN-TITLE@&#
Pricing derivatives with counterparty risk and collateralization: A fixed point approach

@&#HIGHLIGHTS@&#
A valuation framework for contracts with counterparty risk and collateralization.Propose a fixed point approach.Propose an accurate algorithm for computation.Apply our model to price equity and fixed-income derivatives.Show impacts of counterparty risk on bid-ask prices.

@&#KEYPHRASES@&#
Bilateral counterparty risk,Collateralization,Credit valuation adjustment,Fixed point method Contraction mapping,,

@&#ABSTRACT@&#
This paper studies a valuation framework for financial contracts subject to reference and counterparty default risks with collateralization requirement. We propose a fixed point approach to analyze the mark-to-market contract value with counterparty risk provision, and show that it is a unique bounded and continuous fixed point via contraction mapping. This leads us to develop an accurate iterative numerical scheme for valuation. Specifically, we solve a sequence of linear inhomogeneous PDEs, whose solutions converge to the fixed point price function. We apply our methodology to compute the bid and ask prices for both defaultable equity and fixed-income derivatives, and illustrate the non-trivial effects of counterparty risk, collateralization ratio and liquidation convention on the bid-ask spreads.

@&#INTRODUCTION@&#
Counterparty risk has played an important role during the 2008 financial crisis. According to the Bank for International Settlements (BIS)11See BIS press release at http://www.bis.org/press/p110601.pdf, two-thirds of counterparty risk losses during the crisis were from counterparty risk adjustments in MtM valuation whereas the rest were due to actual defaults. In order to account for the counterparty risk, recent regulatory changes, such as Basel III, incorporate the counterparty risk adjustments in the calculation of capital requirement. On the other hand, the use of collateral in the derivative market has increased dramatically. According to the survey conducted by the International Swaps and Derivatives Association (ISDA) in 201322Survey available at http://www2.isda.org/functional-areas/research/surveys/margin-surveys/, the percentage of all trades subject to collateral agreements in the over-the-counter (OTC) market increases from 30 percent in 2003 to 73.7 percent in 2013. OTC market participants continue to adapt collateralization and counterparty risk adjustments in their MtM valuation methodologies for various contracts, including forwards, total return swaps, interest rate swaps and credit default swaps.When an OTC market participant trades a financial claim with a counterparty, the participant is exposed not only to the price change and default risk of the underlying asset but also to the default risk of the counterparty. To reflect the counterparty default risk in MtM valuation, three adjustments are calculated in addition to the counterparty-risk free value of the claim. While credit valuation adjustment (CVA) accounts for the possibility of the counterparty’s default, debt valuation adjustment (DVA) is calculated to adjust for the participant’s own default risk. In addition, collateral interest payments and the cost of borrowing generate funding valuation adjustment (FVA). In the industry, the valuation adjustment incorporating CVA, DVA, FVA and collateralization, is called total valuation adjustment (XVA)33The terminology can be found in Carver (2013) and Capponi (2013), among others..In this paper, we study a valuation framework for financial contracts accounting for XVA. We consider two current market conventions for price computation. The main difference in the two conventions rises in the assumption of the liquidation value – either counterparty risk-free value or MtM value with counterparty risk provision – upon default. Brigo, Buescu, and Morini (2012) and Brigo and Morini (2011) show that the values under the two conventions have significant differences and large impacts on net debtors and creditors.With counterparty risk provision, the MtM value is defined implicitly via a risk-neutral expectation. This gives rise to major challenges in analyzing and computing the contract value. We propose a novel fixed point approach to analyze the MtM value. Our methodology involves solving a sequence of inhomogeneous linear PDEs, whose classical solutions are shown via contraction mapping arguments to converge to the unique fixed point price function. This approach also motivates us to develop an iterative numerical scheme to compute the values of a variety of financial claims under different market conventions.In related studies, Fujii and Takahashi (2013) incorporate BCVA and under/over collateralization, and calculate the MtM value by simulation. Henry-Labordère (2012) approximates the MtM value by numerically solving a related nonlinear PDE through simulation of a marked branching diffusion, and provides conditions to avoid a “blow-up” of the simulated solution. Burgard and Kjaer (2011) also consider a similar nonlinear PDE in their study of hedging strategies inclusive of funding costs, and taking into account closeout payments exchanged at the time when either party of the contract defaults. In contrast, our fixed point methodology works directly with the price definition in terms of a recursive expectation, rather than heuristically stating and solving a nonlinear PDE. Our contraction mapping result allows us to solve a series of linear PDE problems with bounded classical solutions, and obtain a unique bounded continuous MtM value.Our model also provides insight on the bid-ask prices of various financial contracts. The XVA is asymmetric for the buyer and the seller. As such, the incorporation of adjustment to unilateral or bilateral counterparty risk leads to a non-zero bid-ask spread. In other words, counterparty risk reveals itself as a market friction, resulting in a transaction cost for OTC trades. In addition, we examine the impact of various parameters such as default rate, recovery rate, collateralization ratio and effective collateral interest rate. We find that a higher counterparty default rate and funding cost reduce the MtM value, whereas the market participant’s own default rate and collateralization ratio have positive price effects. For claims with a positive payoff, such as calls and puts, we establish a number of price dominance relationships. In particular, when collateral rates are low, the bid-ask prices are dominated by the counterparty risk-free value. Moreover, the bid-ask prices decrease when we use the MtM value rather than counterparty risk-free value for the liquidation value upon default.The recent regulatory changes and post-crisis perception of counterparty risk have motivated research on the analysis of XVA. Brigo, Capponi, and Pallavicini (2014) consider an arbitrage-free valuation framework with bilateral counterparty risk and collateral with possible re-hypothecation. Capponi (2013) studies the arbitrage-free valuation of counterparty risk, and analyzes the impact of default correlation, collateral migration frequency and collateral re-hypothecation on the collateralized CVA. Thompson (2010) analyzes the effect of counterparty risk on insurance contracts and examines the moral hazard of the insurers. Brigo and Chourdakis (2009) focus on the valuation of CDS with counterparty risk that is correlated with the reference default. Hull and White (2012) investigate the wrong way risk – the additional risk generated by the correlation between the portfolio return and counterparty default risk.Let us give an outline of the rest of the paper. In Section 2, we formulate the MtM valuation of a generic financial claim with default risk and counterparty default risks under collateralization. In Section 3, we provide a fixed point theorem and a recursive algorithm for valuation. In Section 4, we compute the MtM values of various defaultable equity claims and derive their bid-ask prices. In Section 5, we apply our model to price a number of defaultable fixed-income claims. Section 6 concludes the paper, and the Appendix contains a number of longer proofs.In the background, we fix a probability space(Ω,F,Q),whereQis the risk-neutral pricing measure. In our model, there are three defaultable parties: a reference entity, a market participant, and a counterparty dealer. We denote them respectively as parties 0, 1, and 2. The default time τiof party i ∈ {0, 1, 2} is modeled by the first jump time of an exogenous doubly stochastic Poisson process. Precisely, we define(2.1)τi=inf{t≥0:∫0tλu(i)du>Ei},where{Ei}i=0,1,2are unit exponential random variables that are independent of the intensity processes(λt(i))t≥0,i ∈ {0, 1, 2}. Throughout, each intensity process is assumed to be of Markovian formλt(i)≡λ(i)(t,St,Xt)for some bounded positive function λ(i)(t, s, x), and is driven by the pre-default stock price S and the stochastic factor X satisfying the SDEs(2.2)dSt=(r(t,Xt)+λ(0)(t,St,Xt))Stdt+σ(t,St)StdWt,(2.3)dXt=b(t,Xt)dt+η(t,Xt)dW˜t.Here, (Wt)t ≥ 0 and(W˜t)t≥0are standard Brownian motions underQwith an instantaneous correlation parameterρ∈(−1,1). The risk-free interest rate is denoted by rt≡ r(t, Xt) for some bounded positive function. At the default time τ0, the stock price will jump to value zero and remain worthless afterwards. This “jump-to-default model” for S is a variation of those by Merton (1976), Carr and Linetsky (2006), and Mendoza-Arriaga and Linetsky (2011).A defaultable claim is described by the triplet (g, h, l), where g(ST, XT) is the payoff at maturity T, (h(St, Xt))0 ≤ t ≤ Tis the dividend process, andl(τ0,Xτ0)is the payoff at the default time τ0 of the reference entity. We assume continuous collateralization which is a reasonable proxy for the current market where daily or intraday margin calls are common (see Fujii & Takahashi, 2013). For party i ∈ {1, 2}, we denote by δithe collateral coverage ratio of the claim’s MtM value. We use the range 0 ≤ δi≤ 120 percent since dealers usually require over-collateralization up to 120 percent for credit or equity linked notes (see Ramaswamy, 2011, Table 1).We first consider pricing of a defaultable claim without bilateral counterparty risk. We call this value counterparty-risk free (CRF) value. Precisely, the ex-dividend pre-default time t CRF value of the defaultable claim with (g, h, l) is given by(2.4)Π(t,s,x):=Et,s,x[e−∫tT(ru+λu(0))dug(ST,XT)+∫tTe−∫tu(rv+λv(0))dv(h(Su,Xu)+λu(0)l(u,Xu))du].The shorthand notationEt,s,x[·]:=E[·|St=s,Xt=x]denotes the conditional expectation underQgivenSt=s,Xt=x.Incorporating counterparty risk, we letτ=min{τ0,τ1,τ2},which is the first default time among the three parties with the intensity functionλ(t,s,x)=∑k=02λ(k)(t,s,x). The corresponding three default events{τ=τ0},{τ=τ1}and{τ=τ2}are mutually exclusive. When the reference entity defaults ahead of parties 1 and 2, i.e.τ=τ0,the contract is terminated and party 1 receivesl(τ0,Xτ0)from party 2 at time τ0. When either the market participant or the counterparty defaults first, i.e. τ < τ0, the amount that the remaining party gets depends on unwinding mechanism at the default time. We adopt the market convention where the MtM value with counterparty risk provision, denoted by P, is used to compute the value upon the participant’s defaults (see Fujii & Takahashi, 2013; Henry-Labordère, 2012).Throughout, we use the notationsx+=x1{x≥0}andx−=−x1{x<0}. Suppose that party 2 defaults first, i.e.τ=τ2. If the MtM value at default is positive(Pτ2≥0),then party 1 incurs a loss only if the contract is under-collateralized by party 2 (δ2 < 1) since the amountδ2Pτ2+is secured as a collateral. As a result, with the loss rate L2 (i.e. 1 - recovery rate) for party 2 , the total loss of party 1 at τ2 isL2(1−δ2)+Pτ2+. On the other hand, suppose that the MtM value is negative(Pτ2<0). Party 1 has a loss only if party 1 puts collateral more than the MtM valuePτ2,i.e. the contract is over-collateralized (δ1 ≥ 1). In this case, party 1’s total loss is the product of the party 2’s loss rate and the exposure, i.e.L2(δ1−1)+Pτ2−. Therefore, the remaining value of the party 1’s position at the default time τ2 is(2.5)Pτ2−L2(1−δ2)+Pτ2+−L2(δ1−1)+Pτ2−.Next, we consider the case when party 1 defaults first, i.e.τ=τ1. We denote by L1 the loss rate of party 1. If the MtM value of party 1’s position at the default is negative(Pτ1<0)and the contract is under-collateralized (δ1 < 1), party 2’s loss isL1(1−δ1)+Pτ1−. Similarly, when the MtM value is positive(Pτ1≥0)and the contract is over-collateralized (δ1 ≥ 1), party 2 incurs a loss of the amountL1(δ2−1)+Pτ1+. Because of the bilateral nature of the contract, party 2’s loss is party 1’s gain. Therefore, at the default time τ1, the value of party 1’s position is(2.6)Pτ1+L1(1−δ1)+Pτ1−+L1(δ2−1)+Pτ1+.Moreover, the market participant is exposed to funding cost associated with collateralization over the period since the collateral rate and funding rate do not coincide with the risk-free rate. When the liquidation value of the contract Ptis positive to party 1 at time t, party 2 posts collateralδ2Pt+to party 1. To keep the collateral, party 1 continuously pays collateral interest at rate c2 to party 2 until any default time or expiry. On the other hand, when Ptis negative to party 1, party 1 borrowsδ1Pt−to post collateral to party 2. As a result, party 1 receives interest payments at rate c1 proportional to collateral amount. We call cithe effective collateral rate of party i(i=1,2),which is the nominal collateral rate minus the funding cost rate of party i. The rates c1 and c2 can be both negative in practice if the funding costs are high. Therefore, party 1 has the following cash flow generated by the collateral and effective collateral rates :(2.7)1{t<τ}(c1δ1Pt−−c2δ2Pt+),0≤t≤T.The aforementioned cash flow analysis implies that the pre-default MtM value with counterparty risk (CR) provision is given by(2.8)P(t,s,x)=Et,s,x[e−∫tT(ru+λu)dug(ST,XT)+∫tTe−∫tu(rv+λv)dv(h(Su,Xu)+λu(0)l(t,Xu))du+∫tTλu(2)e−∫tu(rv+λv)dv((1−L2(1−δ2)+)Pu+−(1+L2(δ1−1)+)Pu−)du+∫tTλu(1)e−∫tu(rv+λv)dv((1+L1(δ2−1)+)Pu+−(1−L1(1−δ1)+)Pu−)du+∫tTe−∫tu(rv+λv)dv(c1δ1Pu−−c2δ2Pu+)du].The first line accounts for the terminal cash flow, the dividend, and the payoff at the reference asset’s default (τ=τ0). The second line and the third line are the cash flows at party 2’s default(τ=τ2)in (2.5) and party 1’s default(τ=τ1)in (2.6), respectively. The last line results from the collateral and effective collateral rates in (2.7). To simplify, we introduce the following notations(2.9)r˜(t,s,x)=r(t,x)+λ(t,s,x),(2.10)α(t,s,x)=L2λ(2)(t,s,x)(1−δ2)+−L1λ(1)(t,s,x)(δ2−1)++c2δ2,(2.11)β(t,s,x)=L1λ(1)(t,s,x)(1−δ1)+−L2λ(2)(t,s,x)(δ1−1)++c1δ1,(2.12)f(t,s,x,y)=h(s,x)+λ(0)(t,s,x)l(t,x)+(λ(1)+λ(2)−β)(t,s,x)y+(β−α)(t,s,x)y+.This allows to express (2.8) in the equivalent but simplified form:(2.13)P(t,s,x)=Et,s,x[e−∫tTr˜udug(ST,XT)+∫tTe−∫tur˜vdvf(u,Su,Xu,Pu)du],wherer˜t≡r˜(t,St,Xt)as defined in (2.9).Remark 2.1As an alternative of MtM value with CR provision, the liquidation value at the time of default can be evaluated as the CRF value of the claim. In other words, at the default time τ < τ0, the liquidation value is evaluated as Πτrather than Pτ. Replacing Puin (2.13) with Πufor t ≤ u ≤ T gives the MtM value without CR provision (see Henry-Labordère, 2012):(2.14)P^(t,s,x)=Et,s,x[e−∫tTr˜udug(ST,XT)+∫tTe−∫tur˜vdvf(u,Su,Xu,Πu)du].To conclude this section, we summarize the symbols and their financial meanings in Table 1 which we will use frequently throughout this paper.In OTC trading, market participants, such as dealers, may take a long position as a buyer or a short position as a seller. Without counterparty risk, the buyer’s CRF bid price Πb(t, s, x) for a claim with payoff (g, h, l) is given by (2.4). The MtM value of the seller’s position satisfies (2.4) by replacing (g, h, l) with(−g,−h,−l),the negative of which gives the seller’s CRF ask price Πs(t, s, x). In fact, the bid-ask prices are identical, i.e.Πb(t,s,x)=Πs(t,s,x).Similarly for the case with counterparty risk provision, the buyer’s bid price isPb(t,s,x)=P(t,s,x)as in (2.13). The seller’s ask price is given by(2.15)Ps(t,s,x)=Et,s,x[e−∫tTr˜udug(ST,XT)+∫tTe−∫tur˜vdvf˜(u,Su,Xu,Pus)du],where(2.16)f˜(t,s,x,y)=h(s,x)+λ(0)(t,s,x)l(t,x)+(λ(1)+λ(2)−β)(t,s,x)y−(β−α)(t,s,x)y−.Sincef˜(t,s,x,y)is different from f(t, s, x, y) in (2.12), the symmetry observed in the CRF prices generally no longer holds in the presence of bilateral counterparty risk. Most importantly, such an asymmetry generates bid-ask spreads for defaultable claims. For any contract with counterparty risk provision, the participant can quote two prices: Pb(t, s, x) as a buyer or Ps(t, s, x) as a seller. In addition, since the payoff components (g, h, l) can be negative, the bid and/or ask prices also can be negative (see Fig. 4).The total valuation adjustment (XVA) is defined as a deviation of the MtM value from the CRF value, namely,Π−Pbfor a long position andPs−Πfor a short position. The bid-ask spread accounting for the XVA with CR provision is defined asS(t,s,x)=Ps(t,s,x)−Pb(t,s,x).The two factors α and β in (2.10) and (2.11) that appear in f andf˜summarize the effects of counterparty risk and collateralization on the bid-ask prices. Specifically, α explains the effect of positive counterparty exposure of the MtM valuePu+while β explains the effect of negative exposurePu−. When the two parameters have the same value (α=β), the two functions f andf˜in (2.12) and (2.16) are identical. Therefore, the bid-ask prices Pband Psare equal. Such a price symmetry also arises in a number of other scenarios: (i) when both parties have perfect collateralization ratio (δ1=δ2=1) and the same effective collateral rate (c1=c2); (ii) when both parties have zero collateralization ratio(δ1=δ2=0)with the same effective default rate (L1λ(1)=L2λ(2)), and (iii) when both parties have the same effective collateral rate(c1=c2)with the same effective default rate and collateralization ratio (L1λ(1)=L2λ(2),δ1=δ2).Remark 2.2When the counterparty risk-free value Π is used to estimate the liquidation value upon default, the seller’s bid price is given by(2.17)P^s(t,s,x)=Et,s,x[e−∫tTr˜udug(ST,XT)+∫tTe−∫tur˜vdvf˜(u,Su,Xu,Πu)du],wheref˜is defined in (2.16). In contrast to (2.13), the price function on the LHS does not appear on the RHS.The defining equation (2.13) has a recursive form whereby the price function P appears on both sides. Denote the spacial domain byD:=R+×R. For any functionw∈Cb([0,T]×D,R),we define the operatorMby(3.1)(Mw)(t,s,x)=Et,s,x[e−∫tTr˜udug(ST,XT)+∫tTe−∫tur˜vdvf(u,Su,Xu,w(u,Su,Xu))du].Then, we recognize from (2.13) that the MtM value with counterparty risk provision satisfiesP=MP. This motivates us to show that the operatorMhas a unique fixed point, and therefore, guarantees the existence and uniqueness of the MtM value P.We discuss our fixed point approach by first showing that the operatorMdefined in (3.1) preserves boundedness and continuity. To this end, we outline a number of conditions according to Heath and Schweizer (2000).(C1)We defineΓ(t,s,x)=[r(t,x)+λ(0)(t,s,x)b(t,x)]andΣ(t,s,x)=[σ(t,s)s0ρη(t,x)1−ρ2η(t,x)].The coefficients Γ and Σ are locally Lipschitz-continuous in s and x, uniformly in t. That is, for each compact subset F ofD,there is a constant KF< ∞ such that for ψ ∈ {Γ, Σ},|ψ(t,s1,x1)−ψ(t,s2,x2)|≤KF∥(s1,x1)−(s2,x2)∥∀t∈[0,T],(s1,x1),(s2,x2)∈F,where ‖ · ‖ is the Euclidean norm inR2.For all(t,s,x)∈[0,T)×D,the solution (S, X) neither explodes nor leavesDbefore T, i.e.Q(supt≤u≤T∥(Su,Xu)∥<∞)=1andQ((Su,Xu)∈D,∀u∈[t,T])=1.The functions h and g are bounded and continuous, and r, l and λ(i),   i ∈ {0, 1, 2}, are positive, continuous and bounded.Given any functionw∈Cb([0,T]×D,R),it follows thatv:=Mw∈Cb([0,T]×D,R).The boundedness of v follows directly from that of w, h, g, r, and λ(i) (see condition (C3)). To prove the continuity of v, we first observe that(3.2)(t,s,x)↦e−∫tTr˜udug(ST,XT)+∫tTe−∫tur˜vdvf(u,Su,Xu,w(u,Su,Xu))duis continuousQ-a.s. Indeed, the continuity of (S, X) implies that the mapping (t, s, x)↦g(ST, XT) is continuousQ-a.s. Also,(t,s,x,u)↦r˜(u,Su,Xu)and (t, s, x, u)↦f(u, Su, Xu, w(u, Su, Xu)) are uniformly continuous and boundedQ-a.s. on compact subsets of[0,T]×D×[t,T]. Hence, the mapping in (3.2) is continuousQ-a.s. Recall thatv=Mwis the expectation of the RHS in (3.2), which is bounded continuous, so v is also continuous for (t, s, x) ∈[0,T]×Dby Dominated Convergence theorem.□Next, we show that the mappingMis a contraction. By the boundedness of α(t, s, x), β(t, s, x) and λ(i)(t, s, x) for i ∈ {0, 1, 2}, we can define a finite positive constant byL=sup(t,s,x)∈[0,T]×D{|λ(1)(t,s,x)+λ(2)(t,s,x)−β(t,s,x)|+|β(t,s,x)−α(t,s,x)|}.Proposition 3.2The mappingMdefined in(3.1)is a contraction on the spaceCb([0,T]×D,R)with respect to the norm(3.3)∥w∥γ:=sup(t,s,x)∈[0,T]×De−γ(T−t)|w(t,s,x)|,for L < γ < ∞. In particular,Mhas a unique fixed pointw*∈Cb([0,T]×D,R).From (2.12), we observe that|f(t,s,x,y1)−f(t,s,x,y2)|≤L|y1−y2|,for(t,s,x)∈[0,T]×D. This implies f is Lipschitz-continuous in y, uniformly over (t, s, x). By Lemma 3.1, the operatorMmapsCb([0,T]×D,R)into itself. For(t,s,x)∈[0,T]×D,w1,w2∈Cb([0,T]×D,R),and γ > 0, we havee−γ(T−t)|(Mw1)(t,s,x)−(Mw2)(t,s,x)|=e−γ(T−t)|Et,s,x[∫tTe−∫tur˜vdv(f(u,Su,Xu,w1(u,Su,Xu)−f(u,Su,Xu,w2(u,Su,Xu)))du]|≤(i)e−γ(T−t)Et,s,x[∫tT|f(u,Su,Xu,w1(u,Su,Xu)−f(u,Su,Xu,w2(u,Su,Xu))|du]≤(ii)e−γ(T−t)Et,s,x[∫tTe−γ(T−u)L|w1(u,Su,Xu)−w2(u,Su,Xu)|eγ(T−u)du]≤(iii)e−γ(T−t)L∥w1−w2∥γ∫tTeγ(T−u)du≤Lγ∥w1−w2∥γ.We have used the condition thatr˜v≥0for (i), and the fact that f is Lipschitz in y for (ii). The inequality (iii) is implied by the norm in (3.3). As a result, for any γ > L ≥ 0,Mis a contraction.□The norm ‖ · ‖γis equivalent to the supremum norm ‖ · ‖∞ on the spaceCb([0,T]×D,R). A similar norm is used in Becherer and Schweizer (2005) and Leung and Sircar (2009) in their studies of reaction diffusion PDEs arising from indifference pricing.Using the fact thatMis a contraction proved in Proposition 3.2, there exists a sequence of functions (P(n))n ≥ 0 that satisfyP(n+1)=MP(n),∀n ≥ 0, and the sequence converges to the fixed point P. The convergence does not rely on the choice of the initial function. Indeed, one can simply pick any bounded continuous function as a starting point, e.g.P(0)=0∀(t, s, x), and iterate to have a sequence (P(n))n ≥ 0 that resides inCb([0,T]×D,R).Furthermore, we can show that for each n ≥ 1, P(n) ≡ P(n)(t, s, x) is a classical solution of the following inhomogeneous PDE problem:(3.4)∂P(n)∂t+LP(n)−r˜(t,s,x)P(n)+f(t,s,x,P(n−1))=0,P(n)(T,s,x)=g(s,x),where the operatorLis defined by(3.5)L:=12σ(t,s)2s2∂2∂s2+12η(t,x)2∂2∂x2+ρη(t,x)σ(t,s)s∂2∂s∂x+r˜(t,s,x)s∂∂s+b(t,x)∂∂x.In order to prove the result, we need the following additional conditions, adapted in our notation from(A3′)−(A3d′)of Heath and Schweizer (2000).(C4)There exists a sequence(Dn)n∈Nof bounded domains with closureD¯n⊂Dsuch that∪n=1∞Dn=Dand each Dnhas a C2-boundary.As in Heath and Schweizer (2000), one can takeDn=[1n,n]×[−n,n]⊂R+×R. For each n, we require that(C5)b(t, x), a(t, s, x) ≔ Σ(t, s, x) Σt(t, s, x), andr˜(t,s,x)be uniformly Lipschitz-continuous on[0,T]×D¯n,where Σtdenotes the transpose matrix of Σ,a(t, s, x) be uniformly elliptic onR2for (t, s, x) ∈ [0, T) × Dn, i.e. there is δn> 0 such that yta(t, s, x) y ≥ δn‖y‖2 for ally∈R2,f(t, s, x, y) be uniformly Hölder-continuous on[0,T]×D¯n×R.The conditions (C1) – (C7) are quite general, and they allow for various models, including the Heston, CEV, and thus, geometric Brownian motion models for equity, and the Ornstein–Uhlenbeck and Cox–Ingersoll–Ross models for the stochastic factor X (see (Heath & Schweizer, 2000), Section 2). The triplet (g, h, l), default intensities λ(i) and interest rate r can be easily chosen to satisfy the boundedness and continuity conditions in (C3), as we will do in our examples in Sections 4 and 5.Theorem 3.3Under conditions(C1)−(C7),there exists a sequence of bounded classical solutions(P(n))⊂Cb1,2([0,T)×D,R)of the PDE problem(3.4)that converges to the fixed pointP∈Cb([0,T)×D,R)of the operatorM.We provide the proof in Appendix A.1. The insight of Proposition 3.2 and Theorem 3.3 is that we can construct and solve a series of inhomogeneous but linear PDEs whose classical solutions converge to a unique fixed point price function P as in (2.13). Recent studies by Burgard and Kjaer (2011) and Henry-Labordère (2012) evaluate the MtM value P(t, s, x) by working with the associated nonlinear PDE of the form:(3.6)∂P∂t+LP−r˜(t,s,x)P+f(t,s,x,P)=0,for(t,s,x)∈[0,T)×D,with terminal conditionP(T,s,x)=g(s,x),for(s,x)∈D. The nonlinearity of (3.6) poses major challenges on analyzing and numerically solving for P. Henry-Labordère (2012) provides a method to approximate the solution that involves replacing the nonlinear term f with a polynomial and simulating a marked branching diffusion. This method, however, does not guarantee that the solution from simulation will resemble the solution of the nonlinear PDE, and does not ensure any regularity, such as continuity or boundedness of, either solution. Henry-Labordère (2012) provides conditions on the chosen polynomial to avoid a “blow-up” of the simulation algorithm. In contrast, our fixed point methodology circumvents this issue by establishing that the pricing definition in (2.13) is a contraction mapping, as opposed to working with the nonlinear PDE. As a result, we solve a series of linear PDE problems with bounded classical solutions. In the limit, a unique bounded continuous MtM value P is obtained.Our contraction mapping methodology lends itself to a recursive numerical algorithm. As mentioned in the previous section, we iteratively solve a sequence of linear inhomogeneous PDEs (3.4). At each iteration, the error is measured in terms of the maximum difference between two consecutive solutions P(n) andP(n−1)over the entire domain[0,T]×D. We continue the iteration procedure until the error is less than the pre-defined tolerance levelϵ¯.For implementation, we use the standard Crank–Nicolson finite difference method (FDM) to obtain the values (see, among others, Wilmott, Howison, and Dewynne (1995) and Strikwerda (2007)). We restrict the domain[0,T]×Dto a finite domainD¯={(t,s,x):0≤t≤T,X̲≤x≤X¯,0≤s≤S¯}. The parametersS¯,XandX¯are sufficiently large enough to preserve the accuracy of the numerical solutions. We discretize the function P(n)(t, s, x) as P(n)(ti, sj, xk) where i ∈ {0, … , N}, j ∈ {0, … , M} and k ∈ {0, … , L} withΔt=T/N,Δs=S¯/M,Δx=(X¯−X̲)/Landti=iΔt,sj=jΔs,xk=kΔx. Our numerical procedure is summarized in Algorithm 1.For the CRF value, we solve the linear PDE associated with Π ≡ Π(t, s, x) in (2.4), namely,(3.7)∂Π∂t+LΠ−r˜(t,s,x)Π(t,s,x)+h(s,x)+λ(0)(t,s,x)l(t,x)=0,for(t,s,x)∈[0,T)×D,with terminal conditionΠ(T,s,x)=g(s,x),for(s,x)∈D. The CRF value becomes an input to the PDE problem for the MtM value without provision, given by(3.8)∂P^∂t+LP^−r˜(t,s,x)P^+f(t,s,x,Π(t,s,x))=0,for(t,s,x)∈[0,T)×D,andP^(T,s,x)=g(s,x),for(s,x)∈D. Again, we apply the Crank–Nicolson FDM method to compute their values.Remark 3.4The assumption on the boundedness of the default intensities does not encapsulate the local intensity model, where the reference default intensity function is of the form:λ(t,s)=cs−p,for some p, c > 0. See Carr and Linetsky (2006); Carr and Madan (2010); Linetsky (2006); Madan and Unal (1998), among others. As a close alternative, one can cap the exploding intensity and setλ(t,s)=cs−p∧Mfor some arbitrarily chosen large constant M. With this modification, our model and contract mapping results still apply. Since the default intensity function is finite except ats=0,in numerical implementation using finite difference, one can set the default intensity at the layers=0to be the large value M instead of an infinite value.We now apply our valuation methodology to value a number of defaultable equity claims. Specifically, we will derive and compare the MtM values with and without counterparty risk provisions as well as the CRF value. Moreover, we will analyze and illustrate the bid-ask prices.As a special case of (2.2), we model the pre-default stock price process by(4.1)dSt=(r+λ(0))Stdt+σStdWt,where we assume constant interest rate r and default rates λ(i), i ∈ {0, 1, 2}. In addition, we letλ=∑k=02λ(k),and set(4.2)α=L2λ(2)(1−δ2)+−L1λ(1)(δ2−1)++c2δ2,(4.3)β=L1λ(1)(1−δ1)+−L2λ(2)(δ1−1)++c1δ1.Let us consider a generic call spread with the terminal payoff:(4.4)g(ST)={m2ifST>K+ϵ2,(m1+m2)ϵ1+ϵ2(ST−K)ifK−ϵ1≤ST≤K+ϵ2,−m1ifST<K−ϵ1,withm1,m2,ϵ1,ϵ2>0,wherem1/ϵ1=m2/ϵ2=:M. The payoff resembles that of a long position of M call options with strikeK−ϵ1,a short position of M call options with strikeK+ϵ2and short m1 notional of zero coupon bond with the same maturity. Similar positions can be achieved when two OTC traders buy and sell call options with different strikes, plus/minus some cash. Asϵ1andϵ2in (4.4) go to zero, the payoff converges to that of a digital call position covered in Henry-Labordère (2012).With the terminal payoff g in (4.4), dividendh=0,and value at reference defaultl(τ0)=−m1e−r(T−τ0),the CRF value of the spread contract admits the formulaΠ(t,s)=M(CBS(t,s;T,K−ϵ1,r+λ(0),σ)−CBS(t,s;T,K+ϵ2,r+λ(0),σ))−e−r(T−t)m1,where CBS(t, s ; T, K, r, σ) is the Black–Scholes call option price at time t with spot price s, maturity T, strike price K, risk-free rate r and volatility σ. From (2.13), the MtM value with counterparty risk provision is given by(4.5)P(t,s)=Et,s[e−(r+λ)(T−t)g(ST)+∫tTe−(r+λ)(u−t)f(u,Su,Pu)du],wheref(t,s,y):=λ(0)l(t)+(λ(1)+λ(2)−β)y+(β−α)y+. The MtM value without counterparty risk provisionP^(t,s)is similarly obtained replacing Puin (4.5) with Πu.The model for S in (4.1), the triple (g, h, l), and other (constant) coefficients satisfy the conditions (C1)–(C7) with domainD=R+(see also Heath and Schweizer, 2000, Section 2). We numerically compute the MtM value P(t, s) by Algorithm 1 from Section 3.2. For the iterative PDE (3.4), we adopt the coefficients in this section and the terminal payoff g(ST) given in (4.4). In Table 2, we show the convergence of the MtM values with provision for three different contracts whereϵ1=ϵ2={2,1,0.01}. The first column of each contract shows the value of the MtM value of the contract at spots=10for each step 0 ≤ n ≤ 5. The second column of each contract shows the supremum normϵ=∥P(n)−P(n−1)∥∞for each step 0 ≤ n ≤ 5. The algorithm stops atn=5for all three contracts.Let us visualize the convergence of the MtM value with CR provision P(n)(0, s) in Fig. 1(left). Using the tolerance levelϵ¯=10−5for the maximum difference over each iteration, the algorithm stops after 4 iterations. As we can see, the price functions P(3)(0, s) and P(4)(0, s) over0≤s≤S¯=40are not visibly distinguishable.In Fig. 1 (right), we plot three different values Π(0, s),P^(0,s)and P(0, s) for0≤s≤S¯. As we can see, the ordering of these three values can change completely depending on the spot price. For example, for large spot prices, we observe that the CRF value dominates the other two MtM values, but it is lowest when the spot price is small. Furthermore, the value without provision dominates the value with provision for high spot prices, and the opposite holds true for low spot prices.Next, we look at the sensitivity of the MtM values with respect to the counterparty’s or own default risk, collateralization ratio and effective collateral rate. In Fig. 2, the MtM values are decreasing in the counterparty default rate (left) and increasing in the participant’s own default rate (right), as is intuitive. Note that the MtM value with provision moves more rapidly with respect to the counterparty default rate, but the MtM value without provision is more sensitive in the participant’s own default rate.In Fig. 3(left), an increase in δ2 reduces counterparty-risk exposure, and therefore, increases the MtM values with and without counterparty risk provision. The rate of increase in contract value slows down when the collateralization ratio exceed 1. In the over-collateralized range [1, 1.2], party 1 is no longer exposed to the counterparty’s default risk. The increase in the contact value (from party 1’s perspective) results from the possibility of collecting the excess collateral upon party 1’s own default.In practice, if the participant’s funding cost rate is high, the effective collateral rate can be negative (see Burgard & Kjaer, 2011). This implies a net interest payment by the participant for the long position due to collateralization. As the effective collateral rate becomes more negative, the contract values with and without provision decrease as we observe on the right panel of Fig. 3.We illustrate the bid-ask prices Pband Psof a call spread in Fig. 4. On the left panel where the participant is assumed to be default-free, we observe the dominance of the three prices: Ps≥ Π ≥ Pb. However, in the bilateral counterparty-risk case, the ordering of prices is different in in-the-money (ITM) and out-of-money (OTM) ranges. We see that Π ≥ Ps≥ Pbin the ITM range, but Ps≥ Pb≥ Π in the OTM range.Equity forward contracts are commonly traded in the OTC market. With stock S as the underlying asset, we consider a forward with maturity T. The initial forward price F0 is set so that the contract has zero value at inception. When the underlying stock defaults, the stock price goes to zero, and the buyer has to pay the discounted valuee−r(T−τ0)F0at the default time. The contract cash flow is described by the triplet(g,h,l)=(ST−F0,0,−e−r(T−τ0)F0). As the underlying stock price fluctuates over time, the MtM value also varies.The MtM value of a long forward contract P(t, s) with provision (see (4.5)) is computed using Algorithm 1. In Table 3, we show the convergence result of the MtM value at timet=1when the stock priceS1=20,with initial forward priceF0=10. The first column of each case shows the value of the forward contract for each stepn∈{1,…,6}. The second column of each case shows the error in terms of the supremum norm∥P(n)−P(n−1)∥∞over the whole domain[0,T]×D,and with toleranceϵ¯=10−5the algorithm stops atn=6in both cases. The number of iterations may depend on the initial value P(0), thresholdϵ¯and upper boundS¯. As we observe, for sufficiently large upper boundsS¯∈{30,40},the convergent prices are the same.At time t, when the stock price is s, the CRF value of a long forward is given by(4.6)Π(t,s)=(s−e−r(T−t)F0).In order to compute the MTM value of a long forward contractP^bwithout counterparty risk provision, we apply (4.6) to (2.14) and obtainP^b(t,s)=Π(t,s)+Et,s[∫tTe−(r+λ)(u−t)((β−α)Π+(u,Su))−βΠ(u,Su)du]=Π(t,s)+Et,s[∫tTe−(r+λ)(u−t)((β−α)(Su−e−r(T−u)F0)+−β(Su−e−r(T−u)F0))du]=Π(t,s)+∫tTe−λ(u−t)((β−α)Et,s[e−r(u−t)×(Su−e−r(T−u)F0)+]−β(s−e−r(T−u)F0))du.To simplify the above equation, we notice thatEt,s[e−r(u−t)(Su−e−r(T−u)F0)+]=CBS(t,s;T,e−r(T−u)F0,r+λ(0),σ).We apply similar arguments to the seller’s MtM value, and summarize as follows.Proposition 4.1The bid-ask prices without counterparty risk provision,P^b(t,s)andP^s(t,s),of a stock forward without counterparty risk provision are given byP^b(t,s)=Π(t,s)+∫tTe−λ(u−t)((β−α)CBS(u,s;T,e−r(T−u)F0,r+λ(0),σ)−β(s−e−r(T−t)F0))du,P^s(t,s)=Π(t,s)+∫tTe−λ(u−t)((α−β)CBS(u,s;T,e−r(T−u)F0,r+λ(0),σ)−α(s−e−r(T−t)F0))du,with Π(t, s) satisfying(4.6).The fair forward price makes the MtM value of the contract equal to zero at the start of the contract. The CRF value in (4.6) implies thatF0=erTS0. However, the fair forward price in presence of bilateral counterparty risk is found implicitly. Precisely, the fair forward priceF0*of a long (resp. short) position makes the MtM value with counterparty risk provision satisfiesPb(0,S0;F0b)=0(resp.Ps(0,S0;F0s)= 0).In Fig. 5, we plot the bid-ask prices Pband Psof the forward contract with counterparty risk provision together with the CRF value. On the left panel, all three values increase as the underlying stock price increases. Similar to the call spread case, the price ordering changes from Π ≥ Ps≥ Pbin the ITM range to Ps≥ Pb≥ Π in the OTM range. On the right panel, both MtM values decrease significantly as the counterparty default rate increases. However, the MtM with provision moves more rapidly, similar to Fig. 2.Remark 4.2Total Return SwapTotal return swaps (TRS) are also traded over the counter as an alternative to equity stock forwards. The swap buyer will receive the increase in equity value at swap expiration date T,ST−S0. On the other hand, the buyer continuously pays a premium rate p ≥ r until the expiration date and also pays the decrease in the equity value at the expiration date to the swap seller. The TRS is represented as the triplet(ST−S0,−p,−S0e−r(T−τ0)).Some derivatives have positive payoffs, i.e. the triplet g, h, l ≥ 0, including calls, puts and digital options. For both conventions, the nonlinear property of the price function disappears since we can substitute the nonlinear functionsP+(t,s)andΠ+(t,s)in (3.6) and (3.8) by the linear functions P(t, s) and Π(t, s). From this observation, we derive the formulae for the bid-ask prices of derivatives with positive payoffs.Proposition 4.3For any claim with g, h, l ≥ 0, the bid-ask prices of with counterparty risk provision satisfy(4.7)Pb(t,s)=Et,s[e−(r+α+λ(0))(T−t)g(ST)+∫tTe−(r+α+λ(0))(u−t)(h(Su)+λ(0)l(u,Su))du],(4.8)Ps(t,s)=Et,s[e−(r+β+λ(0))(T−t)g(ST)+∫tTe−(r+β+λ(0))(u−t)(h(Su)+λ(0)l(u,Su))du].Without counterparty risk provision (see Remark2.1), the bid-ask prices satisfy(4.9)P^b(t,s)=Π(t,s)−Et,s[∫tTαe−(r+λ)(u−t)Π(u,Su)du],(4.10)P^s(t,s)=Π(t,s)−Et,s[∫tTβe−(r+λ)(u−t)Π(u,Su)du].We apply these results to call options on a defaultable stock.Example 4.4The bid price of a European call option with provision is given by(4.11)Pb(t,s)=e−α(T−t)CBS(t,s;T,K,r+λ(0),σ).Moreover, the bid price of a European call option without provision is given by(4.12)P^b(t,s)=(1−αλ(1)+λ(2)(1−e−(λ(1)+λ(2))(T−t)))×CBS(t,s;T,K,r+λ(0),σ).In both (4.11) and (4.12), the bid prices have two components: the CRF value of the call option, i.e. Black–Scholes price, and a multiplier that depends on the parameter α (see (4.2)). First, suppose thatα=0. This happens, for example, when the contract is perfectly collateralized and effective collateral rate is zero, i.e.δ2=c2=0. In this case, both bid prices are identical to the CRF valueΠ(t,s)=CBS(t,s;T,K,r+λ(0),σ). The parameter α is positive when the contract is under-collateralized by party 2, i.e. δ2 < 1. In this case, the call option buyer is exposed to counterparty default risk, and consequently, the bid prices are less than the CRF value Π(t, s). On the other hand, α becomes negative when the contract is over-collateralized by party 2 and the collateral rate is negligible, i.e. δ2 > 1 andc2=0. The call buyer receives additional financial benefit from excess collateral since the buyer only returns a fraction1−L1of the over-collateralized amount at the buyer’s own default. As a result, the bid prices are greater than the CRF value.Fig. 6 illustrates the two bid prices (with and without provision) for various maturities and spot prices. We observe the dominance of the price without provision over the price with provision. Moreover, the difference of two prices increase as maturity or spot price increases. This wider level of difference is attributed to the fact that the difference of counterparty risk exposure increases as the maturity increases.Next, we derive a number of price dominance relationships for the bid-ask prices and the CRF value of claims with positive payoffs.Proposition 4.5Consider any claim with the triplet g, h, l ≥ 0. If α, β ≥ 0, then the following price dominance relationships hold:(4.13)P^b(t,s),P^s(t,s)≤Π(t,s)andPb(t,s),Ps(t,s)≤Π(t,s).Furthermore, ifλ(1)+λ(2)≥α,β≥0,then we have(4.14)Pb(t,s)≤P^b(t,s)≤Π(t,s)andPs(t,s)≤P^s(t,s)≤Π(t,s).We provide a proof inAppendix A.3. In market conditions where the effective collateral rates c1, c2 are much lower than the counterparty/own default rates λ(1), λ(2), the conditions for (4.13) and (4.14) are satisfied. In turn, since the buyer’s (resp. seller’s) MtM value with provision assumes Pb(resp. Ps) as the liquidation value, which is lower than the liquidation value Π in the case without provision according to (4.13), this implies the price dominance relationships in (4.14), as is presented in Fig. 6.We now consider defaultable fixed-income claims under bilateral counterparty risk setting. We model the stochastic factor X by two affine diffusions: Ornstein–Uhlenbeck (OU) and Cox–Ingersoll–Ross (CIR) processes. Under the OU model, the factor process X followsdXt=κ(θ−Xt)dt+σdW˜t,with positive constant parameters κ, θ, σ > 0 that represent the speed of mean reversion, long-term mean, and volatility, respectively. In the CIR model, the factor process X followsdXt=κ(θ−Xt)dt+σXtdW˜t,where the positive parameters {κ, θ, σ} satisfy κ , θ , σ > 0 and the Feller condition 2κθ > σ2 so that X stays positive at all times a.s. Both models for X satisfy the corresponding conditions among (C1)–(C7) (Heath and Schweizer, 2000, Sections 2.1and 2.2), and we will consider here swaps whose payoff are bounded continuous.A generic fixed-income contract is described by the triplet (g(x), h(x), l(t, x)), with default times{τi}i=0,1,2as in (2.1) and Markovian intensities of the formλt(i)=λ(i)(t,Xt). From (2.13), the MtM value with counterparty risk provision is given by(5.1)P(t,x)=Et,x[e−∫tT(r(u)+λ(u,Xu))dug(XT)+∫tTe−∫tu(r(v)+λ(v,Xv))dvf(u,Xu,Pu)du],wheref(t,x,y)=h(x)+λ(0)(t,x)l(t,x)+(λ(1)(t,x)+λ(2)(t,x)−β(t,x))y+(β(t,x)−α(t,x))y+. The parameters α(t, x) and β(t, x) are defined similarly to the definitions (2.10) and (2.11). Noticing that P(t, x) in (5.1) is a special case of P(t, s, x) in (2.13), we use Algorithm 1 to find the MtM value by solving iteratively the following PDE:(5.2)∂P(n)∂t+LXP(n)−(r(t)+λ(t,x))P(n)+f(t,x,P(n−1))=0,for(t,x)∈[0,T)×R,withP(n)(T,x)=g(x)forx∈R(x∈R+for the CIR case). The MtM value without counterparty risk provisionP^(t,x)is similarly obtained by replacing P(u, Xu) with Π(u, Xu) in the right hand side of (5.1).For numerical examples, we assume the constant interest rate r and constant default rates λ(1) and λ(2). The reference default intensity is modeled byλt(0)=(Xt)+∧X¯under the OU or CIR model for X. In other words, we impose an upper boundX¯and a lower boundX̲=0on the reference default intensity, and this allows us to apply our contraction mapping result in Theorem 3.3. For implementation, we apply the FDM and Algorithm 1 in Section 3.2 to (5.2) to obtain the MtM value with counterparty risk provision.After the 2008 financial crisis, CDS contracts are traded in a new standardized way whereby the protection buyer pays at a fixed premium rate, along with a non-zero (positive/negative) upfront payment at the start of the contract. A long position of a CDS contract written on the default event {τ0 ≤ T} is summarized by the triplet notation(0,−p,1).In Table 4, we show the convergence of the CDS MtM values. The first and second columns for each model show the values of the CDS atx=2percent andx=8percent, respectively. In addition, the third column shows the error in terms of the supremum normϵ=∥P(n)−P(n−1)∥∞over the entire grid for each stepn=1,2,…,7. The algorithm stops atn=5under the OU model, and atn=7under the CIR model with the common tolerance levelϵ¯=10−5.In Fig. 7, we compare the three MtM values in terms of the counterparty recovery rateR2=1−L2and the counterparty default rate λ(2). The CRF value is given by (A.9) and is independent of R2 and λ(2), so it is flat across the x-axes in Fig. 7. An increase in counterparty recovery rate or a decrease in counterparty default rate improves both MtM values, whereas the CRF value does not change. In both cases, the MtM value without provision dominates the MtM value with provision.Total return swaps (TRS) on defaultable bonds are OTC traded, and their MtM values are subject to counterparty risk. A TRS is also referred to as a bond forward (see Schönbucher, 2003, Chap. 2.5). Fix a maturity of T years, we consider a TRS on a zero-recovery defaultable bond with maturity T′ ≥ T. The value of the defaultable bond, denoted by C, is given in (A.5) for the OU model and in (A.6) for the CIR model. Given no default up to the swap maturity T, the swap buyer receives the difference between the bond price C(T, XT; T′) and the pre-specified strikeK=C(0,X0;T′)from the swap seller. If the bond defaults before time T, the swap buyer pays the strike K to the seller. Until the first default time τ or expiration date T, the buyer continues to pay at the risk-free rate plus a spreadr+p. For the MtM upfront value P(t, x) with counterparty risk provision, we follow (5.1) with the tripletg(x)=C(T,x;T′)−K,h(t,x)=−K(r+p),l(t,x)=−K.In Fig. 8, we obtain the bid-ask upfront prices with provision for a CDS and a TRS, along with the counterparty risk-free upfront values, under the CIR model. Since both CDS and TRS are swaps, the MtM values can be positive or negative, depending on the reference default intensity. As buying a CDS is similar to longing default risk, the CDS upfront value is increasing in the reference default intensity (left). On the other hand, since the TRS buyer is shorting default risk, the TRS upfront value decreases as the reference asset’s default intensity λ(0) increases (right).

@&#CONCLUSIONS@&#
