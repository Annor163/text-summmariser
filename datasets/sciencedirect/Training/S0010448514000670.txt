@&#MAIN-TITLE@&#
Robust localization to align measured points on the manufactured surface with design surface for freeform surface inspection

@&#HIGHLIGHTS@&#
A method is developed for predicting variances of localized measurement points.Robust rough localization is conducted by matching various geometric properties.Robust fine localization is conducted by selecting the optimal coordinate system.

@&#KEYPHRASES@&#
Freeform surface inspection,Measurement,Localization,Robustness,Uncertainty,

@&#ABSTRACT@&#
Inspection of a manufactured freeform surface can be conducted by sampling measurement points on the manufactured surface and comparing the measurement points with the ideal design geometry and its tolerance. Since the measurement coordinate system and design coordinate system are usually different, these measured points should be first aligned with the design surface through localization. In this research, robust localization methods are developed for both rough localization and fine localization processes. For rough localization, some target measurement points are selected and their corresponding points on the design surface are obtained based on similarities in curvatures and distances of these points. Compared with curvatures that are often used in localization, the distances are less sensitive to the errors introduced in manufacturing and measurement processes. In fine localization, uncertainties in the measurement and localization processes are considered to predict the uncertainties of the localized measurement points. The optimal design coordinate system is also selected such that the uncertainties of the localized measurement points can be minimized. Two case studies are provided to demonstrate the effectiveness of the developed methods for freeform surface inspection.

@&#INTRODUCTION@&#
Freeform surfaces, such as turbine blades, car bodies and boat hulls, have been widely used in different industries including automotive, aerospace, marine, and biomedical engineering. Advanced manufacturing technologies, such as 5-axis CNC machining, are used to manufacture parts with freeform surfaces. Since performance of a part with freeform surfaces is significantly influenced by its correct geometry, inspection is often carried out to compare the geometry of the manufactured freeform surface with the ideal design surface and its tolerance requirement defined in a CAD system.Inspection of a freeform surface is usually conducted by sampling measurement points on the manufactured surface and comparing these measurement points with the design surface. Since the measurement coordinate system is often different from the design coordinate system, the localization process has to be carried out to transform the measured points from the measurement coordinate system to the design coordinate system. Localization is usually conducted in two steps: rough localization and fine localization  [1]. Measurement points on a manufactured freeform surface can be acquired by using either contact measurement devices such as coordinate measuring machines (CMMs) or non-contact measurement devices such as three-dimensional (3-D) laser scanners  [1]. The number of measured points and the distributions of these measured points influence the accuracy of the localization result  [2]. In addition, the accuracy of the measurement device also influences the quality of localization  [3].In the rough localization process, a rough coordinate transformation matrix is obtained to approximately align the measurement points with the design surface. When the measurement coordinate system is quite different from the design coordinate system, the measured points cannot be directly projected onto the design surface to find their corresponding points. In rough localization, the intrinsic geometric properties that are independent of coordinate system, such as curvatures, are often used for identifying the corresponding points. In this research area, Yamany and Farag  [4] introduced a method to match surface signatures that distinctly represent the surface curvature information observed from certain points. Ko et al.  [5] developed a method to select three measured points and match them to their corresponding points on the design surface based on similarities of Gaussian and mean curvatures. Li and Gu  [6] extracted and matched geometrical features on the measured and design surfaces based on similarities of Gaussian curvature and some other evaluation measures. The main problem in rough localization is the sensitivity of curvature to geometrical error. Trying to solve this problem, OuYang et al.  [7]developed a robust initial matching scheme by matching the Delaunay pole sphere (DPS) as an orientation independent property rather than matching curvatures. OuYang’s method is robust but demands four computationally expensive processes for initial matching including: triangulation, identification of characteristic points, checking of the DPS radius constraints and checking of the length constraints.In the fine localization process, an accurate coordinate transformation matrix is obtained to optimally match the measurement points with the design surface. Since the transformation result achieved in rough localization is usually used as initial guess for the fine localization, the measurement coordinate system and the design coordinate system are close. In fine localization, the roughly localized measured points can be projected onto the design surface to find their corresponding points. In this research area, Besl and McKay  [8] employed the iterative closest point (ICP) method through iteratively minimizing the sum of squared residual errors between the measured points and their closest points on the design surface. This ICP method and its variations have been primarily used in the past for fine localization. Research on fine localization focused on two aspects: (1) development of new fine localization methods to improve localization accuracy, and, (2) estimation of uncertainties of the localization results based on the uncertainties of the measurement points and/or uncertainties introduced in the fine localization process. In the first aspect, Li et al.  [9] used least-median-of-square instead of least-squares on residual errors to improve the accuracy in local deformation detection for surface matching. Sharp et al.  [10] developed the ICPIF method in which both the differences between the intrinsic geometric properties such as curvature and the residual errors were minimized to find the corresponding points. Orazi and Tani  [11] developed a fine localization method based on the extended Gaussian curvature to compare the principal curvatures of the corresponding points. In the second aspect, Che and Ni  [12] presented a generic approach to obtain the uncertainty in coordinate transformation from noisy measurements based on constrained optimization uncertainty analysis. Yan and Menq  [13] developed a method to approximate the uncertainties of the obtained transformation parameters in the fine localization process based on measurement and manufacturing errors. Poniatowska  [14] introduced a method to determine the uncertainty in the coordinate transformation parameters based on geometric deviations of the manufactured surface from the design surface. Mehrad et al.  [3] studied the influences of measurement uncertainties and the uncertainties introduced in the localization process on the localized measurement points in freeform surface inspection.The main problem in curvature-based localization methods is the sensitivity of curvatures to the manufacturing errors and/or measurement errors at the measurement locations. In curvature-based localization methods, the curvatures of the manufactured surface at measurement points are estimated and the design surface is searched to find the possible corresponding points. During this search process, when the acceptable difference between two similar curvatures is set too tight, the true corresponding points could be easily missed. On the other hand when the acceptable difference is assigned with a large value, many possible corresponding points, including wrong corresponding points, can be obtained. This problem is critical when the Gaussian curvature is used for comparison due to its small values especially in the flat regions of the surface. In addition, usually alignment of three pairs of corresponding points is used in the presently developed methods [5,7], leading to the alignment of two planes with the possibility of upside-down positions.In this research, new robust localization methods are developed for both the rough and the fine localization processes. In rough localization, four or more measured points are selected and their corresponding points on the design surface are obtained in two steps: (1) identification of an initial list of possible corresponding points with similar curvatures based on curvature similarity constraints, and (2) elimination of non-feasible corresponding points based on distance constraints among measurement points. The calculated distances among measurement points are less sensitive to geometric errors on the freeform surface compared with the estimated curvatures. In fine localization, the uncertainties of finely localized measurement points are estimated from the uncertainties of roughly localized measurement points and the uncertainties of the six transformation parameters for the fine localization. The optimal design coordinate system is also identified to minimize the uncertainties of the finely localized measurement points.The rest of this paper is organized as follows: in Section  2, the method developed for robust rough localization to match the measured points on the manufactured surface with the design surface is provided. In Section  3, a method to minimize the uncertainties of the finely localized measurement points is described through identification of the optimal design coordinate system. In Section  4, case studies are provided to show the effectiveness of the developed methods. In Section  5, major influencing factors on the computation efficiency of the developed methods are discussed. In Section  6, conclusions are summarized.Before the rough localization, the measurement coordinate system and the design coordinate system are usually quite different. For each measured point, its corresponding point on the design surface needs to be identified to obtain the transformation parameters for localization. Geometric properties that are independent of the coordinate system, such as curvature, have to be used for identifying the corresponding points. The measures of curvature such as Gaussian and mean curvatures have been often used in the developed rough localization methods. The curvatures of points on the design surface can be accurately calculated based on the given mathematical model of the design surface. The curvatures of manufactured surface at the measurement points, however, can only be approximated using the coordinates of the measured points near this location. The approximated curvature for each measurement point contains the estimation error and is also sensitive to the manufacturing and/or measurement errors near this location. The maximum change in curvature occurs when a measured point moves towards or away from the center of curvature due to manufacturing and/or measurement errors. Fig. 1shows three measurement points in a 2D case and the influence of the error in the radial direction on the approximated curvature. The curvature,C, is the reciprocal of the radius of curvature,R, and its value can be obtained by the Pythagorean theorem as shown in Eq. (1). The maximum sensitivity of the curvature to the geometric error at a measured point can be obtained as shown in Eq. (2).(1)C=1/R=2h(s2+h2)(2)∂C∂h=2s2×1−(h/s)2(1+(h/s)2)2≈2s2.Whensis small, the sensitivity ofCto geometric error is high. Whensis large, the estimated curvature lacks the local geometric property near the measurement points.Since distances among measurement points are also independent of the selected coordinate system, distances can also be used for rough localization. The distance between two measurement points on the manufactured surface should be the same as the distance between their corresponding points on the design surface. When two measurement points are far from each other, values of the manufacturing and measurement errors are significantly smaller than the values of the distances. The maximum sensitivity of the distance between two measurement points to the error occurs when measurement points move towards or away from the direction linking these two measurement points. The maximum sensitivity of the distance,D, to the geometric error,h, is calculated by:(3)∂D∂h=1.Based on the above discussion, matching of corresponding points in terms of distances among measurement points and their corresponding points on the design surface is more robust than matching of these points in terms of curvatures. In this research, matching of the corresponding distances among points is used together with the matching of the corresponding curvatures to improve the robustness in rough localization.Localization based on the distances between all of the measured points and their possible corresponding points on the design surface is computationally expensive. To reduce the computation effort, the robust rough localization in this research is conducted in three steps: (1) selection of sufficient and proper target measurement points on the manufactured surface, (2) identification of the corresponding points on the design surface by matching curvatures and distances of the target points, and, (3) alignment of the target measurement points to their corresponding points on the design surface.In rough localization, only a few target measurement points are selected to search for their corresponding points on the design surface to reduce the computation effort. When too many target measurement points are selected, a great computation effort is required although the achieved localization result is unique and reliable. When the number of target measurement points is not sufficient, multiple and wrong localization results can be obtained. Therefore it is essential to first discuss the minimum number of target points that are required for rough localization. In addition, locations of these target measurement points should be properly selected such that the rough localization result is the least sensitive to the manufacturing and measurement errors.Assume that two pointsC1andC2are selected as target measurement points on the manufactured surface and the pointsC1′andC2′are their corresponding points on the design surface respectively. Suppose a third measured pointPhas distancesR1andR2from the pointsC1andC2respectively. In order to find the corresponding pointP′on the design surface, the locus of points with distanceR1from the pointsC1′and distanceR2from the pointC2′on the design surface (i.e.,L1,2) should be achieved. The locusL1,2is a circle obtained as the intersection of the sphere with centerC1′and radiusR1and the sphere with centerC2′and radiusR2, as shown in Fig. 2(a).Since the locusL1,2is not a unique point, more than two target measurement points are required to obtain a unique corresponding point on the design surface. Assume that a pointC3is selected as the third target measurement point such thatC1,C2andC3are not collinear, and its corresponding pointC3′is obtained on the design surface. The locus of points with distancesR1,R2andR3from pointsC1′,C2′andC3′(i.e.,L1,2,3) is composed of two points obtained as the intersection of the locusL1,2and the sphere with centerC3′and radiusR3as shown by square symbols in Fig. 2(b).Since the locusL1,2,3is not yet a unique point, more than three target measurement points are required for rough localization. Assume that another pointC4is selected as the fourth target measurement point such thatC1,C2,C3andC4are not coplanar, and its corresponding pointC4′is obtained on the design surface. The locus of points with distancesR1,R2,R3andR4from pointsC1′,C2′,C3′andC4′(i.e.,L1,2,3,4) is a unique point obtained as the intersection of the four spheres as shown by the star symbol in Fig. 2(c). Therefore the minimum number of required target measurement points for rough localization is four.Among all the measurement points, the selection of the proper locations of these target measurement points also plays an important role on the quality of rough localization. When these target measurement points are far from each other, the manufacturing and/or measurement errors have insignificant influences to the distances among these target measurement points. The target measurement points can be selected manually. In this work, a heuristic method has also been developed to automatically select these target measurement points.Since the approximated curvature measures at the boundaries of measured region of the manufactured surface could be inaccurate, the target measurement points should not be selected on the boundaries of the measured region of the manufactured surface. The points on the boundaries are identified by a method developed based on the method introduced by Duckham et al.  [15]. First, the best fit plane is obtained by minimizing the least squared errors between the measured points and the fitted plane, and the measured points are then projected onto the best fit plane, as shown in Fig. 3.The planar Delaunay triangulation method is then applied to create triangular patches from the measured points. Suppose triangleT1is called a neighbor of triangleT2whenT1andT2share an edge, the triangles that have less than three neighbors can be detected as the boundary triangles and the points only belonging to boundary triangular patches are the boundary points. The locations of the identified boundary points and centroid of the measured points on the best fit plane are shown in Fig. 4(a).The location of the farthest non-boundary measured point from the centroid on the best fit plane is selected as the location of the first target measurement point (i.e., point A in Fig. 4(b)). Then the location of the farthest non-boundary point from point A on the best fit plane is selected as the location of the second target measurement point (i.e., point B in Fig. 4(c)). The locations of the two non-boundary points on the bisector line of angle BGA with the largest distances from the centroid are subsequently selected as the locations of the third and fourth target measurement points (i.e., points C and D in Fig. 4(d)).After the target measurement points are selected, their corresponding points on the design surface should be identified based on similarities in curvatures and distances of these points. The method to identify the corresponding points is explained with a simple example as shown in Fig. 5.A corresponding point on the design surface should have similar curvature as the target measurement point. Suppose that the design surface is a flat plane with 5 spherical indentations, and only a portion of the manufactured surface that contains the two large spherical indentations is measured as shown in Fig. 5(a). Since the indentations have spherical shapes, the indentations with similar spherical radius also have similar curvature. For the smaller indentation on the measured portion of the manufactured surface, there is only one possible corresponding spherical indentation on the design surface. For the larger spherical indentation on the measured portion of the manufactured surface, however, there are two spherical indentations on the design surface with the same radius. When only similarities in curvature are considered, the measured portion of the manufactured surface cannot be localized with the design surface.In this research, the distances among target measurement points are also used to identify the corresponding points on the design surface. Suppose that the distance between centers of the two spherical indentations in the measured portion of the manufactured surface isd(M), and the distances between the center of the smaller indentation sphere and the centers of the two larger indentations spheres on the design surface ared1(D)andd2(D)as shown in Fig. 5(b). Since only the distanced1(D)matches with the distanced(M), the correct corresponding features can be identified. Fig. 5(c) shows the result of matching the identified corresponding features.When the surface is a freeform surface, the curvature properties of any point on the surface can be obtained either using the measurement points near the selected location or using the mathematical model of the surface. The Gaussian and mean curvatures are often selected to match the measurement points with the corresponding points on the design surface. The Gaussian curvature is the multiplication product of the two principal curvatures (also called major and minor curvatures) and the mean curvature is the average of the two principal curvatures. In the flat regions of the surface, since both of the major and minor curvatures are small, the Gaussian curvature is very small. Therefore the manufacturing and/or measurement errors near the selected location have significant impacts on the Gaussian curvature. Compared with the Gaussian curvature, the major and minor curvatures are less sensitive to the manufacturing and measurement errors. In this research, the major and minor curvatures have been selected as the measures for improving robustness of rough localization. Fig. 6shows the regions on the design surface with similar curvature measures with a selected target measurement point. Search for regions with similar curvature measures is conducted by selecting a grid of points (e.g.,30×30=900points) on the design surface and calculating their major/minor curvatures.Several regions on the design surface may have the similar curvature measures as the selected target measurement point as shown in Fig. 6(c). The distances among the target measurement points are then used to identify the correct region by eliminating the non-feasible regions. For the four selected target measurement points, a total of six distance measures are used to identify the corresponding points on the design surface as shown in Fig. 7. First all candidate corresponding points for each of the four target measurement points on the design surface are obtained based on similarities in curvatures and the candidate corresponding points for the four target measurement points are stored on the listsC1(D),C2(D),C3(D)andC4(D)as shown in Fig. 7. Then the six distance constraints are evaluated through the following two steps:Step 1:From the listsC1(D),C2(D),C3(D)andC4(D), find all possible loops with 4 pointsP1P2P3P4that can satisfy distance constraints defined byd1,2,d2,3,d3,4andd1,4.From the loops identified in Step 1, find the loops that can satisfy distance constraints defined byd1,3andd2,4.Since the curvature measures are obtained and matched based on a grid of points on the design surface, the distances among possible corresponding points are described by discrete values. Therefore the similarity criteria for matching of the distances should be selected according to the selected grid values on the design surface. In the matching process, first a large grid value is selected for the design surface to evaluate the distance constraints with loosely defined similarity criteria to eliminate non-feasible regions. Then the remaining regions of the design surface are further discretized with smaller grid value (e.g., 20% of the previous grid value) for matching the distances with tighter similarity criteria. Suppose that the maximum manufacturing process error is ±A and the maximum measurement process error is ±B; then it is reasonable to select the grid value on the design surface to be larger than A + B to avoid influences of these errors in searching for the corresponding points on the design surface.When four pairs of corresponding points are obtained, the coordinate system alignment is then conducted as illustrated in Fig. 8. The four target measurement points are shown with stars in Fig. 8. These points are connected together to form a tetrahedron. Each of the connecting lines in Fig. 8 is associated with a distance between two target measurement points. The corresponding points on the design surface are shown with dots in Fig. 8 and they are connected to form another tetrahedron where the six edges are associated with the six distances among the corresponding points on the design surface.As shown in Fig. 8, the transformation matrixTrcan be used to align the measurement coordinate system to the design coordinate system. The transformation matrixTrcan be obtained by matching the four corresponding pairs of points as follows  [16]:(4)Tr=(Q(c)Q(t)T)(Q(t)Q(t)T)−1whereQ(t)andQ(c)are the matrices of homogeneous coordinates of the target measurement points and their corresponding points on the design surface respectively in the following form:(5)Q(λ)=[x1(λ)x2(λ)x3(λ)x4(λ)y1(λ)y2(λ)y3(λ)y4(λ)z1(λ)z2(λ)z3(λ)z4(λ)1111]4×4whereλrepresents eithertfor target measurement points orcfor corresponding points on the design surface.Fine localization is the process to finalize the matching between the measurement coordinate system and the design coordinate system. In this section, first the details of fine localization process are introduced. Then the uncertainties of the coordinates of finely localized measurement points are obtained. The selection of the optimal design coordinate system is subsequently discussed to minimize the uncertainties of the finely localized measurement points. The framework of the robust fine localization is provided in Fig. 9[17].In this work, the fine localization process is conducted using the iterative closest point (ICP) method. Suppose thatnmeasured points are digitized on a manufactured surface and then roughly localized towards the design surface. The homogeneous form of the coordinates of the roughly localized measurement points is described by a matrix:(6)P(r)=[x1(r)x2(r)..xn(r)y1(r)y2(r)..yn(r)z1(r)z2(r)..zn(r)11..1]4×n.The finely localized measurement points can be obtained by transforming the roughly localized measurement points from the roughly localized coordinate system to the design coordinate system as follows:(7)P(f)=P(d)+ε=TfP(r)=[cycz−cyszsydxczsxsy+cxsz−sxsysz+cxcz−cysxdy−cxczsy+sxszcxsysz+czsxcxcydz0001]P(r)whereP(r)is the4×nmatrix defined in Eq. (6),P(f)is the4×nmatrix with coordinates of the finely localized measurement points,P(d)is the4×nmatrix with coordinates of the normal projections of the finely localized measurement points on the design surface,cλandsλstand forcos(θλ)andsin(θλ)whereθλis the rotation angle about theλ(i.e.,X,YorZ) axis,εis the matrix of residual errors between the finely localized measurement points and their closest points on the design surface inX,YandZdirections, andTfis the4×4transformation matrix defined by:(8)Tf=dRxRyRzwhereRx,RyandRzare the rotation matrices about theX,YandZaxes, respectively, anddis the translation matrix. Suppose that the sum of squared Euclidean distances between the finely localized measurement points,P(f), and their closest points on the design surface,P(d), is defined asL; then the 6 fine localization transformation parameters,dx,dy,dz,θx,θyandθz, can be obtained based on the orthogonal least squares method by solving the following 6 equations:(9)gj=∂L/∂τj=0,j=1,2,…,6whereτjrepresents thej-th fine localization transformation parameter (i.e.,τ1,τ2,τ3,τ4,τ5andτ6stand fordx,dy,dz,θx,θyandθzrespectively).Each of these 6 equations is a non-linear function of the 6 independent fine transformation parameters. Iterative numerical method can be employed to identify the values of these 6 fine localization transformation parameters to minimizeL[8].In this work, the uncertainties are measured by variances  [17]. Based on the relationships between theX,YandZcoordinates of thei-th roughly and finely localized measurement points given in Eq. (7), the variances ofX,YandZcoordinates of the finely localized measurement points can be calculated by the following equation  [18]:(10)var(λi(f))=(∂λi(f)/∂θx)2var(θx)+(∂λi(f)/∂θy)2var(θy)+(∂λi(f)/∂θz)2var(θz)+(∂λi(f)/∂dx)2var(dx)+(∂λi(f)/∂dy)2var(dy)+(∂λi(f)/∂dz)2var(dz)+(∂λi(f)/∂xi(r))2var(xi(r))+(∂λi(f)/∂yi(r))2var(yi(r))+(∂λi(f)/∂zi(r))2var(zi(r)),i=1,2,…,nwhereλi(f)stands for eitherxi(f),yi(f)orzi(f),var(θλ)is the variance of the obtained rotation angle about theλaxis,var(dλ)is the variance of the obtained translation value along theλaxis, andvar(λi(r))is the variance ofλcoordinate of thei-th roughly localized measurement point.var(θλ)andvar(dλ)can be statistically estimated by repeating the fine localization process.var(λi(r))can be statistically estimated by repeating the rough localization process.In Eq. (10), covariance terms are not considered since their values are either zeros or insignificant compared with the variance terms. All of the terms in Eq. (10) can be expanded by substituting respective coordinates using Eq. (7). For instance, the expanded form of one of the terms is provided in Eq. (11).(11)∂xi(f)/∂θy=−syczxi(r)+syszyi(r)+cyzi(r),i=1,2,…,n.In this research, the Cartesian location of a finely localized measurement point is assumed to follow a multivariate normal distribution with components of itsX,YandZcoordinates. The variance–covariance for a finely localized measurement point can be described by:(12)∑(Pi(f))=[var(xi(f))cov(xi(f),yi(f))cov(xi(f),zi(f))cov(xi(f),yi(f))var(yi(f))cov(yi(f),zi(f))cov(xi(f),zi(f))cov(yi(f),zi(f))var(zi(f))],i=1,2,…,n.In Eq. (12), since the variance terms are positive and larger than the covariance terms, the sum of the variance terms is selected as a measure to evaluate uncertainty:(13)Λ(Pi(f))=var(xi(f))+var(yi(f))+var(zi(f)),i=1,2,…,n.Eqs. (10)–(13) show that the uncertainty of thei-th finely localized measurement point is a function of coordinates of roughly localized measurement points,xi(r),yi(r)andzi(r). Therefore if the values of these coordinates are changed, the variances of the finely localized measurement points will also be changed. For a set of points in the space, when the location and orientation of the coordinate system are changed, the coordinate values of the same points will also be changed. Therefore the uncertainty of finely localized measurement points, which are calculated from the coordinates of the roughly localized measurement points, can be reduced by proper selection of the location and orientation of the coordinate system.In order to summarize the influences of the input uncertainties (i.e., uncertainties of the 6 fine localization transformation parameters and uncertainties of the coordinates of roughly localized measurement points) on the output uncertainties (i.e., uncertainties of the finely localized measurement points), Eq. (13) can be rewritten as follows  [17]:(14)Λ(Pi(f))=Ci(1)var(θx)+Ci(2)var(θy)+Ci(3)var(θz)+var(dx)+var(dy)+var(dz)+Ci(4)var(xi(r))+Ci(5)var(yi(r))+Ci(6)var(zi(r)),i=1,2,…,nwhere each ofCi(1),Ci(2),Ci(3),Ci(4),Ci(5)andCi(6)is a positive coefficient obtained from Eqs. (10) and (13). According to Eq. (14), if these six coefficients get smaller, the sensitivity of the output uncertainty to the input uncertainties will be reduced. Since the input uncertainties are inevitable, when these coefficients are minimized, the fine localization process becomes more robust. The location and orientation of the coordinate system can be selected such that theΛ(Pi(f))in Eq. (14) is minimized.Assume that the original roughly localized coordinate system is modified using the following transformation matrix for robust fine localization:(15)Tm=[Rx(α)][Ry(β)][Rz(γ)]DwhereTmis the modification transformation matrix for robust fine localization,Dis the 3-D translation matrix with translation parameters ofDx,DyandDzinX,YandZdirections, and[Rx(α)],[Ry(β)]and[Rz(γ)]are the rotation matrices with rotational angles ofα,βandγaboutX,YandZaxes, respectively.When the original roughly localized coordinate system is transformed into the modified coordinate system, coordinates of thei-th roughly localized measurement point will change from(xi(r),yi(r),zi(r))to(xi(R),yi(R),zi(R)). Since only the coefficientsCi(1),Ci(2)andCi(3)in Eq. (14) are functions ofxi(r),yi(r)andzi(r), their values will be changed in the modified coordinate system as shown in Eqs. (16)–(18) respectively.(16)Ci(1)=((cxczsy−sxsz)xi(R)+(−cxsysz−czsx)yi(R)−cxcyzi(R))2+((czsxsy+cxsz)xi(R)+(−sxsysz+cxcz)yi(R)−cysxzi(R))2,i=1,…,n(17)Ci(2)=(−czsyxi(R)+syszyi(R)+cyzi(R))2+(cyczsxxi(R)−cysxszyi(R)+sxsyzi(R))2+(−cxcyczxi(R)+cxcyszyi(R)−cxsyzi(R))2,i=0,1,…,n(18)Ci(3)=(−cyszxi(R)−cyczyi(R))2+((−szsxsy+cxcz)xi(R)+(−sxsycz−cxsz)yi(R))2+((cxszsy+sxcz)xi(R)+(cxsycz−szsx)yi(R))2,i=1,2,…,nwherexi(R),yi(R)andzi(R)are the coordinates of thei-th roughly localized measurement point in the modified coordinate system.SinceCi(1),Ci(2)andCi(3)are always positive, when equal weighting factors are assumed forvar(θx),var(θy)andvar(θz), the sum of three coefficients,Ci(1),Ci(2)andCi(3), can be used to represent the uncertainty of thei-th finely localized measurement point:(19)Ci=(Ci(1))+(Ci(2))+(Ci(3)),i=1,2,…,n.In Eq. (19), since the coordinates of the roughly localized measurement points (i.e.,xi(R),yi(R)andzi(R)) are functions of the six coordinate system modification variables for robust fine localization (i.e.,Dx,Dy,Dz,α,βandγ), the optimal values of these six coordinate system modification variables can be achieved through optimization to minimize theCias follows:(20)Minimizew.r.t.Dx,Dy,Dz,α,β,γ(Ci)whereCiis the sum of three positive coefficientsCi(1),Ci(2)andCi(3)based on Eqs. (16), (17), (18) and (19).When the original coordinate system is modified using the 6 coordinate system modification parameters obtained from Eq. (20), the uncertainty of theith finely localized measurement point due to uncertainties of the coordinates of the roughly localized measurement points and uncertainties of the 6 fine localization parameters can be minimized.The obtained location and orientation of the optimal coordinate system based on Eq. (20) can only minimize the uncertainty of thei-th finely localized measurement point. Whennmeasured points are considered, uncertainty evaluation measures considering allnmeasured points have to be developed. In this research, two measures are developed considering the worst uncertainty of the finely localized measurement points and the mean uncertainty of the finely localized measurement points. The identification of the coordinate system for robust fine localization considering the worst uncertainty of the finely localized measurement points is defined by:(21)Minimizew.r.t.Dx,Dy,Dz,α,β,γ(Max{C1,C2,…,Cn}).Identification of the coordinate system for robust fine localization considering the mean uncertainty of the finely localized measurement points is defined by:(22)Minimizew.r.t.Dx,Dy,Dz,α,β,γ∑i=1nCin.First an initial guess for the location and orientation of the modified coordinate system is selected for optimization. The coordinates of the center of gravity for all the particles representing the roughly localized measurement points are used as the initial values for location of this coordinate system,Dx,DyandDz. The initial values for three rotation anglesα,βandγare obtained by a step-wise search of different combinations of angles within their upper and lower boundaries. The rotation boundaries about theXandYaxes are obtained such that the modifiedZaxis has only one intersection point with the measurement surface. The rotation boundary about theZaxis is from 0° to 360°. The obtained initial guesses for the location and orientation of the coordinate system are then used for optimization based on Eq. (21) or Eq. (22) to obtain the 6 coordinate system modification parameters.The developed method has been applied to two case studies in freeform surface inspection to demonstrate its effectiveness. In the first case study, the geometry of the freeform surface is simple. In the second case study, the geometry of the freeform surface is more complicated and the measured portion of the manufactured surface has a long and narrow shape, making the localization process more challenging. These case studies were conducted on a computer with the Core™ 2 Duo 2.0 GHz processor and 4 GB RAM.In the first case study, the design surface was defined by the following equation:Z=0.2(X+25)cos(π(X−75)/120)+0.4(Y+24)cos(π(Y−76)/120)(mm), whereXandYwere bounded within[−80,80](mm) and[−80,80](mm) respectively.XandYwere selected as the input variables, andZwas selected as the output (response) variable. To simulate the measurement process for surface inspection, a sample of 225 measured points were digitized on the design surface. The measurement sample contained a grid of randomly distributed points within four boundaries defined by the following equations:Y=(X+20)/62−19,X=42−(Y+18)/35,Y=X/2+32andX=(Y−32)/2.55. TheXandYcoordinates of the 75 points on the boundaries and 150 points inside these boundaries were created randomly using the low-discrepancy sequence method  [19]. The measured points were modified by adding random manufacturing errors with a standard deviation of 0.05 mm and random measurement errors with a standard deviation of 0.01 mm. The obtained points were subsequently transformed from the design coordinate system to the measurement coordinate system by three rotations of23°,6°and−35°aboutZ,YandXaxes, and three translations of −60, −60 and 50 mm inZ,YandXdirections. The design surface and the 225 simulated measurement points are shown in Fig. 10(a).For rough localization, four target points were selected based on the method provided in Section  2.1. The four target points before and after rough localization processes are shown in Fig. 10(a) and (b).In rough localization, first the design surface should be searched to identify the regions with similar curvature characteristics for each target measurement point. For this reason, the design surface was digitized to a grid of size 1 mm in bothXandYdirections. The major and minor principal curvatures at each grid point on the design surface were calculated based on the mathematical model of the freeform surface  [20]. The major and minor principal curvatures on the manufactured surface were estimated based on a reconstructedB-spline surface with 10 × 10 control points and uniform knot vectors over the measured points following the methods introduced by Ma and Kruth  [21] and Piegl and Tiller  [22]. At the beginning, all of the points were considered as possible corresponding points (candidate points) for a target measurement point. When the difference between the curvature of a grid point and the curvature of the target measurement point was larger thanmax{0.01×curvature range,0.15×curvature value}, the point was eliminated from the list of candidate points for this target point. The program can adjust the curvature similarity criteria to obtain a proper number of candidate points. The regions of design surface with similar curvatures for the four target measurement points are shown in Fig. 11.Then the distances among the four target points on the manufactured surface were calculated. The identified regions with similar curvatures (shown in Fig. 11) were narrowed down by eliminating the points that do not satisfy the distance constraints. The distance criterion was selected such that the difference between the corresponding distances should be smaller than0.3(XG+YG), whereXGandYGwere the grid values on the design surface. The program has the capability to adjust the criteria to avoid too few or too many corresponding points to be created for each target measurement point. The remaining four regions on the design surface contained the corresponding points of the four target points as shown in Fig. 12. The obtained regions were further narrowed down by reducing the grid values ofXGandYGon the design surface.The coordinates of the corresponding points were estimated by averaging the coordinates of points in each tiny region. The coordinates of corresponding points obtained through the rough localization process are shown and compared to the ideal coordinates of the corresponding points in Table 1. The CPU time to estimate the curvature properties at measurement points was 195 s. The CPU time for selection of target measurement points, identification of corresponding points on the design surface and alignment of the two coordinate systems in rough localization was 2.5 s.Rough localization for this case study was also tested using the ICP method, the most popular localization method. The ICP method can only handle the situation where the measurement and design coordinate systems are close. Since the measurement and design coordinate systems for this case study are quite different, the localization process converged to a wrong solution using the ICP method.The transformation matrix for rough localization was obtained based on Eq. (4) provided in Section  2.3 and the results are shown in the second row of Table 2. The fine localization using ICP method was also conducted and the respective results are shown in the third row of Table 2. The iterations of the fine localization process were continued until the change in sum of squared errors in two consecutive iterations became less than 0.002 (mm2). The fine localization was converged after 28 iterations. The computation time for the fine localization process was 88 s. The sum of squared errors between the localized measurement points and their corresponding points on the design surface are also provided for both rough and fine localization processes in Table 2.The obtained translational transformation parameters (i.e.,dx,dyanddz) and rotational transformation parameters (i.e.,θx,θyandθz) for fine localization were assumed to have standard deviations of 0.012 (mm) and 0.012 (°) respectively. The coordinates of the roughly localized measured points (i.e.,xi(r),yi(r)andzi(r)) were assumed to have a standard deviation of 0.2 (mm). The fine localization was conducted based on three coordinate systems with different locations and orientations: (1) the original coordinate system,S0, shown in Fig. 13(a), (2) the modified coordinate system to minimize the maximum uncertainty among the finely localized measurement points,S1, shown in Fig. 13(b), and (3) the modified coordinate system to minimize the average uncertainty of the finely localized measurement points,S2, shown in Fig. 13(c). The differences among computation times for fine localization based on the three coordinate systemsS0,S1andS2were insignificant.The optimization results to modify the coordinate systemS0to obtain the coordinate systemsS1andS2are provided in Table 3.When different coordinate systems are used, the nominal values of the 6 obtained transformation parameters in the fine localization process are very similar. However the variances of the finely localized measurement points using the 3 coordinate systems are noticeably different as shown in Table 4. The smallest maximum uncertainties and the smallest mean uncertainties among the measured points and the respective evaluation measures are shown in bold font in Table 4. The results showed a noticeable decrease in the maximum or mean uncertainty among the localized measurement points by modification of the coordinate systems.The six sigma variation boundary around the location of each finely localized measurement point(xi(f),yi(f),zi(f))can be compared with the design tolerance zone at the location of the corresponding point on the design surface(xi(d),yi(d),zi(d))in freeform surface inspection.In the second case study, the design surface was defined by:Z=−0.25(X+75)cos(π(X+75)/40)−0.167(Y+75)cos(π(Y+75)/40)(mm), whereXandYwere bounded within[−75.5,75.5](mm) and[−76.5,76.5](mm) respectively.XandYwere selected as the input variables, andZwas selected as the output (response) variable. To simulate the measurement process for surface inspection, a uniform grid of 217 points (grid of 7 points parallel to theXaxis and 31 points parallel to theYaxis) were digitized on the design surface for−0.5<X<17.5and−50.3<Y<39.7. The measured points were modified by adding random manufacturing errors with a standard deviation of 0.05 mm and random measurement errors with a standard deviation of 0.01 mm. The obtained points were subsequently transformed from the design coordinate system to the measurement coordinate system by three rotations of52°,45°and−45°aboutZ,YandXaxes, and three translations of −20 mm, −60 mm and 50 mm inZ,YandXdirections, respectively. The design surface, the 217 simulated measurement points, and the four target points are shown in Fig. 14(a).The four target points on the manufactured surface were selected manually to discuss a special case in which a fifth target point can be added to find a unique match for each target point. The measurement points on the manufactured surface after the localization process and all of the five matched pairs of points are shown in Fig. 14(b).In rough localization, the design surface was digitized to a grid of size 1 mm in bothXandYdirections. The major and minor principal curvatures at each grid point on the design surface were calculated based on the mathematical model of this surface. The major and minor principal curvatures on the manufactured surface were estimated numerically based on the gradient calculation function in MATLAB and the method provided by Struik  [20]. The curvature similarity criterion was the same as that used in the first case study. The regions of the design surface with similar curvature measures for the four target points are shown in Fig. 15.Then the distances among the four target points on the manufactured surface were calculated. The identified regions with similar curvatures (shown in Fig. 15) were narrowed down by eliminating the points that do not satisfy the distance constraints. The distance similarity criterion was similar to that used in the first case study. The remaining four regions on the design surface contained the corresponding points of the four target points as shown in Fig. 16.From Fig. 16, multiple solutions are identified in the search of the corresponding points on the design surface. This special case rarely happens and can be probably avoided by refining the grid values on the design surface. In this case study, instead of refining the grid values, an additional target point was added to eliminate non-feasible solutions. When the fifth target point was added, the candidate points for each of the five target points were narrowed down to a single position. The corresponding points were then estimated by averaging the coordinates of the remaining points in each tiny region. The coordinates of the corresponding points obtained through rough localization are shown and compared to the ideal coordinates of the corresponding points in Table 5.The CPU time for the estimation of curvature properties at the grid of measurement points was 0.5 s due to the small region of measurement area. The CPU time for selection of target measurement points, identification of corresponding points on the design surface and alignment of the two coordinate systems in rough localization was 3.5 s.Rough localization for this case study was also tested using the ICP method, the most popular localization method. The ICP method can only handle the situation where the measurement and design coordinate systems are close. Since the measurement and design coordinate systems for this case study are quite different, the localization process converged to a wrong solution using the ICP method.The transformation matrix for rough localization was obtained based on Eq. (4) provided in Section  2.3, and the results are shown in the second row of Table 6. The fine localization using the ICP method was also conducted and the respective results are shown in the third row of Table 6. The iterations of the fine localization process were continued until the change in sum of squared error in two consecutive iterations became less than0.03(mm2). The fine localization was converged after 55 iterations. The computation time for the fine localization process was 189 s. The sum of squared errors between the localized measurement points and their corresponding points on the design surface for rough and fine localization processes are also provided in Table 6.Due to the high aspect ratio of the measured portion of the manufactured surface, the uncertainties of the localized measurement points were expected to be larger than those in the first case study. Therefore the obtained translational transformation parameters (i.e.,dx,dyanddz) and rotational transformation parameters (i.e.,θx,θyandθz) for fine localization were assumed to have standard deviations of 0.02 (mm) and 0.02 (°) respectively. The coordinates of the roughly localized measured points (i.e.,xi(r),yi(r)andzi(r)) are assumed to have a standard deviation of 0.25 (mm). The fine localization was conducted based on three coordinate systems with different locations and orientations: (1) the original coordinate system,S0, shown in Fig. 17(a), (2) the modified coordinate system to minimize the maximum uncertainty among the finely localized measurement points,S1, shown in Fig. 17(b), and (3) the modified coordinate system to minimize the average uncertainty of the finely localized measurement points,S2, shown in Fig. 17(c). The differences among computation times for fine localization based on the three coordinate systemsS0,S1andS2were insignificant.The optimization results to modify the coordinate systemS0to obtain the coordinate systemsS1andS2are provided in Table 7.When different coordinate systems are used, the nominal values of the 6 obtained transformation parameters in the fine localization process are very similar. However the variances of the finely localized measurement points using the 3 coordinate systems were noticeably different as shown in Table 8. The smallest maximum uncertainties and the smallest mean uncertainties among the measured points and the respective evaluation measures are shown in bold font in Table 8. The results showed a significant decrease in the maximum or mean uncertainty among the localized measurement points by modification of the coordinate systems.Similar to the first case study, the six sigma variation boundary around the location of each finely localized measurement point(xi(f),yi(f),zi(f))can be compared with the design tolerance zone at the location of the corresponding point on the design surface,(xi(d),yi(d),zi(d)), for tolerance verification in the freeform surface inspection process.The developed method has also been tested through experiment. After machining of the freeform surface, a sample of points was collected on the manufactured surface. Then the collected measurement points were successfully localized with the design surface defined by:Z=(0.012)X+6sin(0.07X+3.185)+(0.036X+1.638)cos(−0.1Y−4.55)+0.006(Y+45.5)2−4.8×10−5(Y−45.5)3−10.708(mm), where bothXandYwere bounded within[−45,45](mm).XandYwere selected as the input variables, andZwas selected as the output (response) variable. The designed surface was machined on HAAS Mini Super Mill CNC machine tool through rough and fine machining steps. In order to inspect the geometric accuracy of the manufactured surface, a uniform grid of10×10measurement points was digitized on the manufactured surface for−40≤X≤41and−40≤Y≤41. The coordinates of measurement points were acquired using Renishaw OMP40-2 touch trigger probe with a M4 Ruby probe stylus (6 mm diameter). This probe was installed on the machine tool spindle using a CAT40 shank adapter. When the probe touches the surface, the touch detection sensor inside the probe sends the touch signal to the light indicators using an OMI-2 transmitter. During the measurement process, first the probe center location was identified and saved in machine tool computer by touching the probe to the flat datum planes at top and two perpendicular sides of the manufactured part. Collection of the measurement points on the manufactured surface was subsequently conducted. The probe was first located above the surface to avoid collision. Then the probe was moved inXandYdirections to the desired measurement location(X,Y)and subsequently moved downward to measure theZcoordinate. The experimental setups for machining and measurement of the freeform surface are illustrated in Fig. 18.Many factors influence the computation efficiency for rough localization and fine localization. The major influencing factors are summarized as follows:•The method to estimate curvatures of measurement points. In this work, since aB-spline surface is reconstructed to estimate the curvatures at the measurement points, this method takes considerable time.The number of measurement points. This factor influences the time required for the estimation of curvatures at these measurement points and the time required for automated selection of target measurement points.The number of target measurement points. This factor influences the number of the distance constraints and the time to search for the candidate corresponding points on the design surface.The initial grid value for the design surface and its reduction rate for sub-division of surface. These factors influence the time to search for the corresponding points on the design surface.Initial similarity criteria on curvature and distance constraints and their reduction rates for convergence of computation. These factors influence the time to search for the corresponding points on the design surface.•The number of measurement points. For each iteration in the ICP localization method, the closest points of all the measurement points on the design surface need to be identified.The convergence stopping criteria. The number of iterations in the ICP localization method is determined by the convergence stopping criteria.

@&#CONCLUSIONS@&#
New methods have been developed in this research to improve the robustness in rough and fine localization processes to align the measurement points in the measurement coordinate system with the design surface in the design coordinate system for freeform surface inspection. Characteristics of this research are summarized as follows.1.By using the similarities between the distances of the target measurement points and the distances of their corresponding points on the design surface in addition to the similarities in major and minor curvatures, the rough localization process is more robust to the errors introduced in the manufacturing and measurement processes.By selecting the optimal design coordinate system, uncertainties of the localized measurement points can be minimized to improve the robustness for fine localization.