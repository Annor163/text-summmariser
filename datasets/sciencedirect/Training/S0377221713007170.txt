@&#MAIN-TITLE@&#
Portfolio optimization in a regime-switching market with derivatives

@&#HIGHLIGHTS@&#
Optimal asset allocation problem in a continuous-time regime-switching market.The portfolio contains an option, an underlying stock and a risk-free bond.The problem is solved by introducing a functional operator.We use the dynamic programming approach which is a often used method in operational researcher.

@&#KEYPHRASES@&#
Functional operator,Elasticity approach,Portfolio optimization,Regime switching,Dynamic programming principle,

@&#ABSTRACT@&#
We consider the optimal asset allocation problem in a continuous-time regime-switching market. The problem is to maximize the expected utility of the terminal wealth of a portfolio that contains an option, an underlying stock and a risk-free bond. The difficulty that arises in our setting is finding a way to represent the return of the option by the returns of the stock and the risk-free bond in an incomplete regime-switching market. To overcome this difficulty, we introduce a functional operator to generate a sequence of value functions, and then show that the optimal value function is the limit of this sequence. The explicit form of each function in the sequence can be obtained by solving an auxiliary portfolio optimization problem in a single-regime market. And then the original optimal value function can be approximated by taking the limit. Additionally, we can also show that the optimal value function is a solution to a dynamic programming equation, which leads to the explicit forms for the optimal value function and the optimal portfolio process. Furthermore, we demonstrate that, as long as the current state of the Markov chain is given, it is still optimal for an investor in a multiple-regime market to simply allocate his/her wealth in the same way as in a single-regime market.

@&#INTRODUCTION@&#
It is well known that the basic idea of option pricing in the Black–Scholes model (see Black & Scholes (1973)) is the construction of a non-arbitrage portfolio, which hedges the option’s position by taking a position of the opposite sign in the underlying asset with units equal to the option’s delta. This so-called delta hedge can render the value of a portfolio first order-insensitive to the change in the underlying price, but does not optimize the portfolio’s asset allocation. Mean–variance portfolio optimization in a discrete-time one-period model was proposed by Markowitz (1952). The portfolio optimization problem was further investigated by Merton (1969) and Merton (1971) in a continuous-time setting, which consider an agent who aims to maximize the conditional expectation of the portfolio’s utility of the terminal wealth. In these papers, the portfolio consists of only a stock and a risk-free bond, which is known as the reduced portfolio optimization problem and can be solved using the stochastic dynamic programming approach. The martingale and dual approaches to portfolio selection were introduced by Karatzas, Lehoczky, and Shreve (1987) and Cox and Huang (1989, 1991). A review of the developments in this area can be found in Korn (2008), which also considers portfolios with option.In this paper, we optimize a portfolio that comprises an option, an underlying stock and a risk-free bond, and show that the optimal solution is a mixture of Merton’s result and the delta hedging strategy. To solve this optimization problem, we adopt the elasticity approach proposed in Kraft (2003). The elasticity of a derivative with respect to the underlying asset price is defined as the ratio of the percentage change in derivative value to the percentage change in the underlying asset price. By introducing elasticities of the option and portfolio with respect to the stock price, Kraft (2003) demonstrated that the return of an option can be represented in terms of the returns of the stock and the risk-free bond and that the elasticity of the portfolio can be used as the control variable in this optimization problem. In other words, by updating the elasticity of the portfolio rather than the percentage or the amount of wealth invested in the available assets, the portfolio is optimized, and the optimal portfolio process can be obtained by tracking the optimal elasticity.Here, to model possible changes in the underlying economics, we employ a regime-switching model for the prices of the underlying assets, i.e., the mean rate of return, volatility of the underlying asset price, and return of the risk-free bond depend on a Markov chain. There is a vast body of literature considering the regime-switching model, including Hamilton (1989), Bekaert and Hodrick (1993) and Gray (1996), to name just a few. In addition, Bollen, Gray, and Whaley (2000) considered the regimes in the volatilities of currency option prices. More evidence of the regimes in the returns of stocks or bonds can be found in Garcia and Perron (1996), Ang and Chen (2002) and Guidolin and Timmermann (2007). Considering a regime-switching model, the portfolio optimization problem is studied by Çelikyurt and Özekici (2007) with mean–variance criterion, and by Çanakoğlu and Özekici (2012) with HARA utility functions.However, the market becomes incomplete under the regime-switching model, which results in difficulties using the elasticity approach, because the option cannot be completely replicated by the stock and risk-free asset in an incomplete market. To overcome these difficulties, we take the following steps. First, we introduce a functional operator and then generate a sequence of value functions by applying this operator repeatedly. Second, we prove that the optimal value function is the limit of this sequence. Third, to obtain the explicit solution for each function in the sequence, we propose an auxiliary optimization problem in a single-regime market in which the elasticity approach is applicable. Finally, the original optimal value function can be approximated by taking the limit. Additionally, the optimal value function can be shown to satisfy a dynamic programming equation, which leads to a PDE. Hence, the exact solution for the optimal value function and the optimal portfolio process are also available. In sum, the original problem in a multiple-regime market can be reduced to an optimization problem with only a single regime. And it shows that, as long as the current state of the Markov chain is given, an investor in a multiple-regime market simply needs to allocate his/her wealth in the same way as in a single-regime market to achieve an optimal strategy.The remainder of the paper is organized as follows. Section 2 formulates the portfolio optimization problem in a regime-switching market. Section 3 introduces the functional operator and derives a number of properties. On the basis of these properties, Section 4 provides an approximate solution by solving an auxiliary optimization problem. Section 5 then gives an exact result by solving the dynamic programming equation, and obtains the optimal portfolio process. Finally, Section 6 concludes the paper.In the following, we denote the matrices and vectors by letters in boldface, and their transpose by a superscript Tr. Considering a fixed time horizon [0, T], we divide the market mode into d different regimes. We model the market mode by a continuous-time stationary Markov chain {α(t)} that is defined on the complete probability space(Ω,F,P), where P denotes physical probability.Without loss of generality, we can identify the state space of {α(t)} as a finite set of unit vectorsE≔(e1,e2,…,ed), whereei∈Rdare column vectors with unity in the ith position and zero elsewhere. We callEthe canonical space of the chain {α(t)}. Denote by Q=(qij)d×dthe generator of the chain {α(t)} under P. We then have the following semi-martingale representation for the chain,α(t)=α(0)+∫0tQα(s)ds+M(t),where M(t) is anRd-valued martingale with respect to the filtration generated by {α(t)}.In a regime-switching market, the risk-free bond process {M(t)} and a risky stock price process {S(t)} are assumed to evolve asdM(t)M(t)=〈r,α(t)〉dt,dS(t)S(t)=〈μ,α(t)〉dt+σ,α(t)dB(t),where r=(r1, r2, …, rd)Tr,μ=(μ1, μ2, …, μd)Tr,σ=(σ1, σ2, …, σd)Trwith σi>0 for alli∈D≔{1,…,d}, and {B(t)} is a standard Brownian motion independent of {α(t)}. Both of these processes are{Ft}-adapted with{Ft}satisfying the usual conditions.For a portfolio comprising an option, an underlying stock and a risk-free bond, let {O(t)} be the price process of the option which is written on the stock. Let πSand πOdenote the percentages of wealth invested in the stock and option, respectively, and π(s)≔(πS(s), πO(s)) for all s∈[t, T]. Then, the wealth process {Wπ(t)} of the portfolio evolves asdWπ(t)Wπ(t)=πS(t)dS(t)S(t)+πO(t)dO(t)O(t)+1-πS(t)-πO(t)dM(t)M(t).Here, the subscript of π represents the dependence of wealth process on portfolio process{π(s)}s=tT.At any time t⩽T, our objective is to maximize the expected utility of the terminal wealth. Denote byΠt≔{π(s)}s=tTthe set of all admissible strategies over [t, T]. Then defineVπ(t,w,i)≔Et,w,i[U(Wπ(T))],V(t,w,i)≔supπ∈ΠtVπ(t,w,i),where U(·) is a utility function with U′>0 and U″<0, andEt,w,i[·]=E[·|Wπ(t)=w,α(t)=ei].It is obvious that V satisfies the following boundary condition:V(T,w,i)=Vπ(T,w,i)=U(w),∀w⩾0,i∈D.In summary, given a pair of(t,i)∈[0,T]×D, our optimization problem is to find a strategyπˆ∈Πtsuch thatVπˆ(t,w,i)=V(t,w,i),∀w∈[0,+∞[,and to obtain function V(t, w, i) for each(t,w,i)∈[0,T]×[0,+∞[×D.In this section, after introducing a functional operator, we show that the aforementioned optimal value function can be obtained by applying this operator repeatedly.In what follows, unless otherwise specified, a vector function in the form ofv(t,w)=(v(t,w,1),v(t,w,2),…,v(t,w,d)),means that v(t, w, i)≔v(t, w, ei) for alli∈D, and, when we use ⩽ or ⩾ for two vectors, it means that the relation holds for each element.For a test function v, we introduce a functional operator denoted byM:(1)Mv(t,w,i)≔supπ∈ΠtEt,w,ivξt,1∧T,Wπ(ξt,1∧T),α(ξt,1∧T)=supπ∈ΠtEt,w,i[1{ξt,1<T}v(ξt,1,Wπ(ξt,1),α(ξt,1))+1{ξt,1⩾T}U(Wπ(T))],where ξt, ndenotes the nth jump time of Markov chain{α(s)}s=t∞forn∈Nwith ξt,0=t, and the use of ξt,1 indicates that the right-hand side of (1) is an optimization problem in a single-regime world. We also writeMv(t,w)≔(Mv(t,w,1),Mv(t,w,2),…,Mv(t,w,d)).This functional operatorMhas the following properties.Lemma 3.1Ifv1(t, w)⩾v2(t, w), ∀(t, w)∈[0, T]×[0, +∞[, thenMv1(t,w)⩾Mv2(t,w),∀(t,w)∈[0,T]×[0,∞[.For any(t,w,i)∈[0,T]×[0,∞[×D, define(2)H0(t,w,i)≔Et,w,iUw·exp∫tT〈r,α(s)〉ds,which is the expected utility of the terminal wealth if we allocate all of the wealth in the risk-free bond over [t, T], and(3)Hn+1(t,w,i)≔MHn(t,w,i),forn∈N.Then, for any(t,i)∈[0,T]×D,Hn(t,·,i)n∈Nis an increasing sequence of functions on [0, ∞[.SinceH1(t,w,i)=MH0(t,w,i),∀(t,w,i)∈[0,T]×[0,∞[×D,we haveH1(t,w,i)=supπ∈ΠtEt,w,i1{ξt,1<T}H0(ξt,1,Wπ(ξt,1),α(ξt,1))+1{ξt,1⩾T}U(Wπ(T))=supπ∈ΠtEt,w,i1{ξt,1<T}Eξt,1,Wπ(ξt,1),α(ξt,1)UWπ(ξt,1)·exp∫ξt,1Tr,α(s)ds+1{ξt,1⩾T}UWπ(T)=supπ∈ΠtEt,w,i1{ξt,1<T}UWπ(ξt,1)·exp∫ξt,1Tr,α(s)ds+1{ξt,1⩾T}UWπ(T)⩾Et,w,iUw·exp∫tTr,α(s)ds=H0(t,w,i),whereE·,·,ei=E·,·,i. The result then follows from Lemma 3.1.□For any(t,w,i)∈[0,T]×[0,∞[×D, letVn(t,w,i)≔supπ∈Πt,nVπ(t,w,i),whereΠt,n≔{π(s)}s=tT:πS(s)≡πO(s)≡0,∀s⩾ξt,n,forn∈N,which is the set of strategies over [t, T] allocating all of the wealth in the risk-free bond after the nth jump of the Markov chain{α(s)}s=tT. Then, for any (t, w)∈[0, T]×[0, ∞[, we haveVn(t,w)=Hn(t,w),∀n∈N.We can prove the result through mathematical induction. First, by the definition of H0, it is obvious thatV0(t,w)=H0(t,w),∀(t,w)∈[0,T]×[0,∞[.Second, based on the assumption thatVn(t,w)=Hn(t,w),∀(t,w)∈[0,T]×[0,∞[,we prove that the equality also holds for n+1 as follows.To show that Vn+1(t, w, i)⩽Hn+1(t, w, i), it suffices to show that(4)Vn+1(t,w,i)-ε⩽Hn+1(t,w,i),∀ε>0.Indeed, for an arbitrarily given ε>0, we can find a strategy π∈Πt, n+1 over [t, T], such that(5)Vπ(t,w,i)⩾Vn+1(t,w,i)-ε,and, by defining a strategy over [ξt,1, T] asπ∗(s)≔π(s),fors∈[ξt,1,T],we can obtainπ∗∈Πξt,1,nandVπ(t,w,i)=Et,w,i[U(Wπ(T))]=Et,w,i1{ξt,1<T}Vπ∗(ξt,1,Wπ(ξt,1),α(ξt,1))+1{ξt,1⩾T}U(Wπ(T))⩽Et,w,i1{ξt,1<T}Vn(ξt,1,Wπ(ξt,1),α(ξt,1))+1{ξt,1⩾T}U(Wπ(T))=Et,w,i1{ξt,1<T}Hn(ξt,1,Wπ(ξt,1),α(ξt,1))+1{ξt,1⩾T}U(Wπ(T))⩽Hn+1(t,w,i),which, combined with (5), implies (4).To show that Vn+1(t, w, i)⩾Hn+1(t, w, i), we need only show that(6)Vn+1(t,w,i)+2ε⩾Hn+1(t,w,i),∀ε>0.Indeed, for an arbitrarily given ε>0, we can find a strategy π∈Πt, such that(7)Hn+1(t,w,i)⩽Et,w,i[1{ξt,1<T}Hn(ξt,1,Wπ(ξt,1),α(ξt,1))+1{ξt,1⩾T}U(Wπ(T))]+ε.In addition, for this ε we can also find another strategyπ′∈Πξt,1,nover [ξt,1, T], such that(8)Vn(ξt,1,Wπ(ξt,1),α(ξt,1))⩽Vπ′(ξt,1,Wπ(ξt,1),α(ξt,1))+ε.Then, by defining a strategyπ̃∈Πt,n+1over [t, T] asπ̃(s)=π(s),t⩽s<ξt,1⋀T;π′(s),ξt,1⋀T⩽s⩽T,it follows from (7) and (8) thatHn+1(t,w,i)⩽Et,w,i[1{ξt,1<T}Vπ′(ξt,1,Wπ(ξt,1),α(ξt,1))+1{ξt,1⩾T}U(Wπ(T))]+2ε=Vπ̃(t,w,i)+2ε⩽Vn+1(t,w,i)+2ε,which is the same as (6). □For any(t,w,i)∈[0,T]×[0,∞[×D, we havelimn→∞Hn(t,w,i)=V(t,w,i).For any(t,w,i)∈[0,T]×[0,∞[×D, owing to Lemma 3.2, limn→∞Hn(t, w, i) is well defined, and it follows from Lemma 3.3 thatH(t,w,i)≔limn→∞Hn(t,w,i)=limn→∞Vn(t,w,i)⩽V(t,w,i).To prove the opposite inequality, it suffices to show that, for any π∈Πt,(9)H(t,w,i)⩾Vπ(t,w,i),∀(t,w,i)∈[0,T]×[0,∞[×D.Indeed, for an arbitrarily given strategy π∈Πt, we can define a strategy πn∈Πt, nover [t, T] asπn(s)=π(s),t⩽s<ξt,n⋀T;0,ξt,n⋀T⩽s⩽T,and we then haveVπ(t,w,i)-Vπn(t,w,i)=Et,w,i1{ξt,1<T}[Vπ(ξt,1,Wπ(ξt,1),α(ξt,1))-Vπn(ξt,1,Wπ(ξt,1),α(ξt,1))]=Et,w,i1{ξt,1<ξt,n<T}[Vπ(ξt,1,Wπ(ξt,1),α(ξt,1))-Vπn(ξt,1,Wπ(ξt,1),α(ξt,1))]→0,as n→∞. Hence, for any ε>0, there exists ann(ε)∈Nsuch thatH(t,w,i)⩾Hn(ε)(t,w,i)=Vn(ε)(t,w,i)⩾Vπn(ε)(t,w,i)⩾Vπ(t,w,i)-ε,which implies (9).From this proposition, the optimal value function can also be shown to be the fixed point of the functional operator ofM. □The optimal value functionVis the smallest non-negative solution of the dynamic programming equationV=MV, i.e., for any(t,w,i)∈[0,T]×[0,∞[×D,Vsatisfies(10)V(t,w,i)=supπ∈ΠtEt,w,i1{ξt,1<T}V(ξt,1,Wπ(ξt,1),α(ξt,1))+1{ξt,1⩾T}U(Wπ(T)).From Proposition 3.1, it is obvious thatV=MV. Suppose that there is another fixed point ofMdenoted byṼ. Then, by the definition of Hnfor anyn∈N, for any(t,w,i)∈[0,T]×[0,∞[×D, we haveV∼(t,w,i)⩾H0(t,w,i), andV∼(t,w,i)=MV∼(t,w,i)⩾MH0(t,w,i)=H1(t,w,i),which further implies thatV∼(t,w,i)⩾Hn(t,w,i)for anyn∈N, andV∼(t,w,i)⩾V(t,w,i),∀(t,w,i)∈[0,T]×[0,∞[×D.The proof is completed. □In Proposition 3.1, we conclude that the optimal value function V can be obtained by the limit of a sequence of functions, which leads to an auxiliary optimization problem. An approximate solution for V is given in the next section. Proposition 3.2, however, shows that V is also the solution to a dynamic programming equation, which is considered in Section 5.By Proposition 3.1, optimal value function V can be obtained by iteration (3). Then, we need only consider, for an given function v, how to obtain the explicit form ofMv. Note that we can simplify the right-hand side of (1) as follows.(11)Mv(t,w,i)=supπ∈ΠtEt,w,i[1{ξt,1<T}v(ξt,1,Wπ(ξt,1),α(ξt,1))+1{ξt,1⩾T}U(Wπ(T))]=supπ∈ΠtEt,w,i∫tTe-qi(s-t)∑j≠iqijvs,Wπ(i)(s),jds+e-qi(T-t)UWπ(i)(T)=eqit·supπ∈ΠtEt,w,i∫tTe-qis∑j≠iqijvs,Wπ(i)(s),jds+e-qiTUWπ(i)(T),whereqi≔∑j≠iqij,andWπ(i)denotes the wealth process driven by π in the single-regime world i, which is given by (18). We have thus obtained an auxiliary dynamic programming problem, which, for each fixedi∈D, is an optimization problem in a single-regime world.To solve this auxiliary problem, we derive the dynamics ofWπ(i)(t)using the elasticity approach. In single-regime world i, let S(i)(t) and M(i)(t) denote the prices of the stock and risk-free bond, respectively. Then,(12)dS(i)(t)S(i)(t)=μidt+σidB(t),(13)dM(i)(t)M(i)(t)=ridt,and we can obtain risk-neutral probabilityQi, under which(14)dS(i)(t)S(i)(t)=ridt+σidBQi(t),whereBQiis a standard Brownian motion underQi. Let O(i)(t, S(i)(t)) denote the value of a given contingent claim traded on the stock at time t. Application of Itô’s formula to its discounted value, which is a martingale underQi, yields(15)∂O(i)(t,S(i)(t))∂t+riS(i)(t)∂O(i)(t,S(i)(t))∂S+12σi2(S(i)(t))2∂2O(i)(t,S(i)(t))∂S2=riO(i)(t,S(i)(t)).Next, for a delta-neutral portfolio that takes the form(16)X(i)(t)=-O(i)(t,S(i)(t))+∂O(i)(t,S(i)(t))∂S·S(i)(t),from the self-financing property, we havedX(i)(t)=-dO(i)(t,S(i)(t))+∂O(i)(t,S(i)(t))∂SdS(i)(t)=-∂O(i)(t,S(i)(t))∂tdt-12σi2(S(i)(t))2∂2O(i)(t,S(i)(t))∂S2dt=riS(i)(t)∂O(i)(t,S(i)(t))∂S-O(i)(t,S(i)(t))dt.Rearrangement of this equation then implies thatdO(i)(t,S(i)(t))=-riS(i)(t)∂O(i)(t,S(i)(t))∂S-O(i)(t,S(i)(t))dt+∂O(i)(t,S(i)(t))∂SdS(i)(t)=riO(i)(t,S(i)(t))+∂O(i)(t,S(i)(t))∂S(μi-ri)S(i)(t)dt+σiS(i)(t)∂O(i)(t,S(i)(t))∂SdB(t),which further leads to(17)dO(i)(t,S(i)(t))O(i)(t,S(i)(t))=ri+εO(i)(μi-ri)dt+εO(i)σidB(t),where we introduce the elasticity of the option price with respect to the stock price defined asεO(i)≔∂O(i)(t,S(i)(t))∂S·S(i)(t)O(i)(t,S(i)(t)).Recall that the wealth processWπ(i)(t)of a portfolio comprising an option, an underlying stock and a risk-free bond evolves as(18)dWπ(i)(t)Wπ(i)(t)=πSdS(i)(t)S(i)(t)+πOdO(i)(t,S(i)(t))O(i)(t,S(i)(t))+(1-πS-πO)dM(i)(t)M(i)(t).Substituting (12), (13) and (17) leads to(19)dWε(i)(i)(t)Wε(i)(i)(t)=πOri+εO(i)(μi-ri)+πSμi+1-πS-πOridt+πOεO(i)+πSσidB(t)=πOεO(i)(μi-ri)+πS(μi-ri)+ridt+πOεO(i)+πSσidB(t)=ε(i)(μi-ri)+ridt+ε(i)σidB(t),where ε(i) denotes the elasticity of the entire portfolio with respect to the stock price, i.e.,ε(i)≔πOεO(i)+πS.Since the ε(i) is the single control variable for the dynamics of the wealth process in the single-regime world i, we replaced the subscript of π of the wealth process by the new control variable ε(i). For this single-regime optimization problem, we first determine the optimal elasticity, which in a complete market is independent of a specific asset. Then a strategy is computed which tracks this optimal elasticity (see SubSection 5.3).For auxiliary optimization problem (11), because ε(i) is a single control variable, as derived in the foregoing section, we rewrite (11) and denote(20)M(t,w,i)≔Mv(t,w,i)=eqit·supε(i)Et,w,i∫tTe-qis∑j≠iqijvs,Wε(i)(i)(s),jds+e-qiTUWε(i)(i)(T).We then obtain a PDE for M(·, ·, i) on [0, T[×]0, +∞[.Proposition 4.1For eachi∈D, the function of M(·, ·, i) satisfies(21)σi2Mt(t,w,i)+riwMW(t,w,i)-qiM(t,w,i)+∑j≠iqijv(t,w,j)MWW(t,w,i)=12(μi-ri)2MW2(t,w,i)on [0, T[×]0, +∞[ and has boundary conditionM(T,w,i)=U(w),w∈[0,+∞[.For each fixedi∈D, considering (20) and the dynamics ofWε(i)(i)(t)given by (19), we have the following Hamilton–Jacobi–Bellman equation.0=supε(i)Mt(t,w,i)-qiM(t,w,i)+ε(i)(μi-ri)+riwMW(t,w,i)+12σi2(ε(i))2w2MWW(t,w,i)+∑j≠iqijv(t,w,j)on [0, T[×]0, +∞[, with its first-order condition leading to the optimal elasticity(22)εˆ(i)=πˆOεO(i)+πˆS=-(μi-ri)MW(t,w,i)σi2wMWW(t,w,i).By substitution, we can then obtain PDE (21). The boundary condition follows immediately from (20). Furthermore, it follows from the standard verification theorem (see, e.g. Fleming & Soner (2006)) that the solution to the PDE (21) is indeed the function M(t, w, i).Although solving this PDE for M appears difficult, we know that M is the result of one-step iteration (3), and the first step of this iteration involves findingMH0, with H0 given by (2). Accordingly, we first attempt to solve the PDE with v replaced by H0, and then obtain a general explicit form of Hn. In addition, we restrict ourselves to the constant relative risk aversion (CRRA) utility, i.e.,U(x)=xγγ,γ<1,γ≠0;lnx,γ=0,for x>0. We then obtain the following result. □If the agent has a CRRA utility ofU(x)=xγγ,forx⩾0,where γ<1 and γ≠0, then the value functions defined by the iteration(3)admit(23)Hn(t,w,i)=wγγ·an(t,i),∀(t,w,i)∈[0,T]×[0,+∞[×Dand∀n∈N,where the sequence of the functions of{an(t,i)}n=0∞is defined as follows.a0(t,i)≔〈exp[(QT+γR)(T-t)]·ei,1〉,R≔diag(r1,r2,…,rd)∈Rd×d,1≔(1,1,…,1)Tr∈Rd,and(24)an+1(t,i)=Nan(t,i),∀n∈N.Here,Nis a functional operator, and, for function a(t, i) on[0,T]×D, it is defined asNa(t,i)≔e-(λi+qi)(T-t)+∫tTe-(λi+qi)(s-t)∑j≠iqija(s,j)ds,where(25)λi≔12μi-riσi2γγ-1-riγ.If the agent has a CRRA utility (γ=0) ofU(x)=lnx,forx>0,then, for value functions{Hn(t,w,i)}n=0∞, we haveHn(t,w,i)=lnw+bn(t,i),∀(t,w,i)∈[0,T]×[0,+∞[×Dand∀n∈N,where the sequence of the functions of{bn(t,i)}n=0∞is defined as followsb0(t,i)≔∂a0(t,i)∂γγ=0=expQT(T-t)·R(T-t)·ei,1,and(26)bn+1(t,i)=N∼bn(t,i),∀n∈N.Here,N∼is also a functional operator, and, for function b(t, i) on[0,T]×D, it is defined asN∼b(t,i)≔∫tTe-qi(s-t)λ∼i+∑j≠iqijb(s,j)ds,whereλ∼i≔ri+12μi-riσi2.First, for the utility function ofU(x)=xγγ,forx⩾0,where γ<1 and γ≠0, according to (2), we haveH0(t,w,i)=wγγEexpγ∫tTr,α(s)dsα(t)=ei=wγγa0(t,i),where the second equality follows from the characteristic function of the occupation times in the regime-switching model, which has been derived in Buffington and Elliott (2002). We conjecture thatH1(t,w,i)=MH0(t,w,i)=wγγg(t,i),∀(t,w,i)∈[0,T]×[0,+∞[×D,where g is a function on[0,T]×D. BecauseH1=MH0must satisfy the PDE of (21), with v replaced by H0, by substitution we can derive the following ordinary differential equation (ODE), that is satisfied by g(·, i) on [0, T] for each fixedi∈D.gt(t,i)=(λi+qi)g(t,i)-∑j≠iqija0(t,j),g(T,i)=1,which yieldsg(t,i)=Na0(t,i),andH1(t,w,i)=MH0(t,w,i)=wγγNa0(t,i)=wγγa1(t,i).Then, by the same idea, we can conclude that ifHn-1(t,w,i)=wγγan-1(t,i),for an n⩾2, thenHn(t,w,i)=MHn-1(t,w,i)=wγγNan-1(t,i)=wγγan(t,i).Second, for the utility function (γ=0) ofU(x)=lnx,forx⩾0,according to (2), we haveH0(t,w,i)=lnw+E∫tT〈r,α(s)〉dsα(t)=ei=lnw+∂a0(t,i)∂γγ=0=lnw+b0(t,i).We conjecture thatH1(t,w,i)=MH0(t,w,i)=lnw+g̃(t,i),∀(t,w,i)∈[0,T]×[0,+∞[×D,whereg̃represents a function on[0,T]×D. Considering (21) with v replaced by H0 in a similar way, we can derive the following ODE forg̃(·,i)on [0, T] for each fixedi∈D.g̃t(t,i)=qig̃(t,i)-λ∼i-∑j≠iqijb0(t,j),g̃(T,i)=0,which yieldsg̃(t,i)=N∼b0(t,i),andH1(t,w,i)=MH0(t,w,i)=lnw+N∼b0(t,i)=lnw+b1(t,i).Then, by the same idea, we can conclude thatHn(t,w,i)=lnw+bn(t,i),∀n∈N.The proof is completed. □From the explicit form of (23), we can use the sequence of the value functions {Hn} to approximate the optimal value function V in the original problem. For a desirable level of accuracy, ε>0, iteration (3) can be carried out in the following way.•Step 1: Set n=0 andH0(t,w,i)=wγγ·a0(t,i), wherea0(t,i)≔〈exp[(QT+γR)(T-t)]·ei,1〉.Step 2: Let n=n+1, obtain an(t, i) through (24) and setHn(t,w,i)=wγγ·an(t,i).Step 3: Stop whensupt,w,i|Hn(t,w,i)-Hn-1(t,w,i)|⩽ε;otherwise, return to Step 2.Here, we consider only the case of γ<1 and γ≠0, although the case of γ=0 can be considered in a similar way.Recall that optimal value function V satisfies the dynamic programming problemV=MV.Then, using (21), we can obtain a PDE for V and solve this PDE for the CRRA utility.Proposition 5.1For each fixedi∈D, the optimal value function of V(·, ·, i) satisfies(27)12(μi-ri)2VW2(t,w,i)=σi2Vt(t,w,i)+riwVW(t,w,i)+∑j=1dqijV(t,w,j)VWW(t,w,i)on [0, T[×]0, +∞[ and has boundary conditionV(T,w,i)=wγγ,γ<1,γ≠0;lnw,γ=0.When γ<1 and γ≠0, this PDE has a solution given byV(t,w,i)=a(t,i)wγγ,∀(t,w,i)∈[0,T]×[0,+∞[×D,where a(t, i) is the ith component of anRd-valued column ofa(t)≔(a(t,1),a(t,2),…,a(t,d))Tr.It can also be shown that(28)a(t)=exp[-(Λ-Q)(T-t)]·1,withΛ≔diag(λ(1),λ(2),…,λ(d))∈Rd×d,λ(i)≔12μi-riσi2γγ-1-riγ.When γ=0, this PDE has a solution given byV(t,w,i)=ã(t,i)lnw+g(t,i),∀(t,w,i)∈[0,T]×[0,+∞[×D,whereã(t,i)is the ith component of anRd-valued column of(29)a∼(t)=exp(Q(T-t))·1,and g(t, i) is the ith component of anRd-valued column of(30)g(t)=exp(-Qt)·∫tTexp(Qs)b(s)dswithb(t)≔(b(t,1),b(t,2),…,b(t,d))Tr,b(t,i)≔12μi-riσi2ã(t,i)+riã(t,i).By replacing v by V in (21), we can obtain a PDE forMV(·,·,i). Then, (27) follows fromMV(·,·,i)=V(·,·,i), and the boundary condition holds trivially. To solve this PDE, we also consider the two following cases for the value of γ.First, for the utility function ofU(x)=xγγ,forx⩾0,where γ<1 or γ≠0, we conjecture thatV(t,w,i)=a(t,i)wγγ,where a(·, i) is a continuous function on [0, T], with a(T, i)=1 for eachi∈D. It then follows thatVt(t,w,i)=at(t,i)wγγ,VW(t,w,i)=a(t,i)wγ-1,VWW(t,w,i)=a(t,i)(γ-1)wγ-2.Substituting the foregoing into (27), for eachi∈D, we haveat(t,i)=12μi-riσi2γγ-1-riγa(t,i)-∑j=1dqija(t,j),where the subscript of t represents the derivative of a(·, i) with respect to t. We can also rewrite it in compact form as(31)at(t)=(Λ-Q)a(t),whereat(t)=(at(t,1),at(t,2),…,at(t,d))Tr.Then, (28) follows.Second, for the utility function ofU(x)=lnx,forx⩾0,we conjecture thatV(t,w,i)=ã(t,i)lnw+g(t,i),whereã(·,i)and g(·, i) are both continuous functions on [0, T], withã(T,i)=1and g(T, i)=0 for eachi∈D. It then follows thatVt(t,w,i)=ãt(t,i)lnw+gt(t,i),VW(t,w,i)=ã(t,i)1w,VWW(t,w,i)=-ã(t,i)1w2.Substituting the foregoing into (27), for eachi∈D, we haveãt(t,i)=-∑j=1dqijã(t,j),gt(t,i)=-∑j=1dqijg(t,j)-12μi-riσi2ã(t,i)-riã(t,i),and, in compact form,a∼t(t)=-Qa∼(t),gt(t)=-Qg(t)-b(t),from which (29) and (30) follow. □It is easy to see that we cannot get a closed form solution to the optimal value function for a general utility function. However, since the characteristic function of the occupation times of the Markov chain is known (see Buffington & Elliott (2002)), H0 defined by (2) can always be calculated (numerically). Then the iteration (3) provides a numerical method to solve the PDE (27) together with the initial point H0.In addition to the optimal value function, our original problem also requires us to specify an optimal portfolio process. Here we show that, even in a multiple-regime market, given any current statei∈D, it remains optimal to invest our wealth in the same way as that given by the auxiliary problem in single regime i.Proposition 5.2For the dynamic programming problem in a single-regime market ofi∈DMV(t,w,i)=supπ∈ΠtEt,w,i1{ξt,1<T}V(ξt,1,Wπ(ξt,1),α(ξt,1))+1{ξt,1⩾T}U(Wπ(T)),letπˆ(i)denote an optimal strategy, which can maximize the expectation on the right-hand side. Then, the optimal stratey for our original problem can be given by〈α(t),πˆ(t)〉,∀t∈[0,T],whereπˆ(t)=(πˆ(1)(t),πˆ(2)(t),…,πˆ(d)(t))Tr.Letπˆdenote an optimal strategy for our original problem. Then for a fixedi∈Dand t∈[0, T], we can define strategyπ̃∈Πtover [t, T] asπ̃(s)=πˆ(i)(s),t⩽s⩽ξt,1⋀T;πˆ(s),ξt,1⋀T<s⩽T,and then we haveMV(t,w,i)=Et,w,i1{ξt,1<T}Vξt,1,Wπˆ(i)(ξt,1),α(ξt,1)+1{ξt,1⩾T}UWπˆ(i)(T)=Et,w,i1{ξt,1<T}Eξt,1,Wπˆ(i)(ξt,1),α(ξt,1)[U(Wπˆ(T))]+1{ξt,1⩾T}UWπˆ(i)(T)=Et,w,i[U(Wπ̃(T))],where, considering the meaning ofπˆ, for the second equality we can useV(t,w,i)=Et,w,i[U(Wπˆ(T))],∀(t,w,i)∈[0,T]×[0,+∞[×D.Furthermore, it follows fromV(t,w,i)=MV(t,w,i)thatV(t,w,i)=Et,w,i[U(Wπ̃(T))],which is equivalent to saying that the strategy ofπ̃is also an optimal strategy for our original problem. Therefore, at any point in time t∈[0, T], given thatα(t)=ei, to maximize the expected utility of the terminal wealth, it is optimal to follow the strategyπˆ(i)=πˆS(i),πˆO(i), which is the optimal solution to the problem in a single-regime market ofi∈D.From this proposition, by replacing the M by V in (22), we can show that the optimal strategy for our original problem in case of γ<1 and γ≠0, provided that the current state is i, satisfiesπˆO(i)εO(i)+πˆS(i)=-(μi-ri)VW(t,w,i)σi2wVWW(t,w,i)=μi-ri(1-γ)σi2.□At any point in time, the optimal portfolio in case of γ<1 and γ≠0 satisfiesπˆOεO+πˆS=μ-r(1-γ)σ2,πˆO+πˆS+πˆM=1,where we suppress the superscript of i.If we do not allow the risk-free bond in the optimal portfolio, i.e.,πˆO+πˆS=1,then this implies thatπˆS=μ-r(1-γ)σ2·11-εO-εO1-εO,πˆO=-μ-r(1-γ)σ2·11-εO+11-εO.In Merton’s well-known reduced optimization problem (see Merton (1969, 1971)), which considers a portfolio of a stock and a risk-free bond,μ-r(1-γ)σ2is exactly the optimal percentage of wealth invested in the stock for CRRA utility. Therefore, we call the first term in our solution,μ-r(1-γ)σ2·11-εO,the modified term of speculation. We call the second element,-εO1-εO,the term of delta hedging, because it is the solution of the delta hedging strategy. In fact, to render a delta-neutral portfolio containing a stock and an option, we need only set the portfolio’s elasticity with respect to the stock to be equal to zero, i.e.,(32)ε=πS+εOπO=0,which, combined with πS+πO=1, results inπS=-εO1-εO.If investment in a risk-free bond is permitted, then the optimal portfolio process cannot be determined uniquely, and we have onlyπˆS=μ-r(1-γ)σ2-πˆOεO.In contrast to the situation without a risk-free bond, the first term is a pure rather than modified term of speculation, and, according to (32), the second element is still called the term of delta hedging.Therefore, for a portfolio comprising an option, an underlying stock and a risk-free bond, the allocation of wealth in the stock has the dual purpose of speculating for profits and hedging the risks involved in the option. More specifically, the smaller the γ, the less wealth will be invested in the stock for speculation. This is consistent with the Arrow–Pratt index of risk aversion for the CRRA utility-xU″(x)/U′(x)=1-γ,which implies that the smaller the γ, the more risk averse the investor will be. And as γ decreases, the investor becomes more risk averse, and the optimal investment strategy changes gradually from a speculative strategy to a delta hedging strategy.

@&#CONCLUSIONS@&#
