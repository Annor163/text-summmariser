@&#MAIN-TITLE@&#
Non-rigid registration using gradient of self-similarity response

@&#HIGHLIGHTS@&#
For non-rigid registration, a hierarchical piece-wise affine transform is examined.We propose a metric to quantify the ability of being correctly registered.We examine ROC analysis on the proposed metric and Moran's spatial correlation.Proposed metric reflects the ability of being registered better than Moran's.Registration error is reduced by using the proposed metric as a sub-image indicator.

@&#KEYPHRASES@&#
Non-rigid registration,Locally affine transformation,Hierarchical elastic registration,

@&#ABSTRACT@&#
Graphical abstract

@&#INTRODUCTION@&#
Non-rigid image registration involves finding the non-linear geometric transformation (the deformation field) between two images [12]. It is broadly applied to medical image registration since most anatomical structures undergo non-rigid movement across time and the difference between body structures across patients cannot be fully described by rigid transformations. Generally, non-rigid registration can be classified into feature-based registration and intensity-based registration. The first type requires image preprocessing to extract the object features such as edges, surfaces and anatomical landmarks which are assumed to exist in both source and target images [11]. The goal is to find the deformation field that best matches the location of the features in both images. Without using intensity information, this approach largely reduces the computational complexity during optimization. However, this approach highly relies on the accuracy of image preprocessing tools such as segmentation and contour detection. Moreover, feature-based registration is not able to solve for non-rigid deformation without proper model assumption, which is usually case-dependent.In contrast to matching features, intensity-based image registration uses intensity information to define a similarity function. It aims to determine the deformation field that maximizes the similarity between the deformed source image and the target image. Optical flow, which exploits a differential framework to estimate the motion vectors, is often applied to solve the registration problem [7,8]. However, having a high degree of freedom in the deformation model increases the computational complexity. For this reason, parametric model such as free-form deformation (FFD) has been proposed to represent the non-rigid deformation with a set of control points [10]. Another way to achieve non-rigid registration is by globally interpolating local deformation modeled by rigid or affine transformation while keeping the invertibility of global deformation [6,2]. The sub-image can be defined by segmentation based on the image intensity or recovered motion. Pitiot et al. [9] use a hierarchical clustering algorithm to partition the image into regions with similar motion, which is roughly estimated by a block matching algorithm. Based on the same idea, Zhuang et al. [13,14] develop a registration-based cardiac segmentation algorithm that maintains a global diffeomorphic transformation by interpolating the local affine transformation defined on a given set of regions, e.g. cardiac chambers. However, these methods are suitable for the objects with piecewise-affine motion and moreover, the number of local regions must be defined by the user based on prior knowledge, which is tedious and case-relevant. Non-rigid registration with locally affine transformation using sub-images defined on uniform grid is applied to general-purpose registration without any prior assumption [5]. A coarse-to-fine strategy sequentially decreases the size of sub-images and refines the cumulated deformation. Using the registration result from the coarse level as the starting point for searching the motion vector in the finer level speeds up the computation. Current study tries to improve the registration by only registering those sub-images which contain well-defined structure. Using mutual information as the similarity metric, [1] showed that a structure-less sub-image such as background and noisy data results in a misleading global optimum. The author used Moran's spatial correlation as the metric to detect such image patches. However, not all of the sub-images with well-defined structure can be correctly registered. In this paper, we propose a new approach to analyze the sub-image based on the gradient of the self-similarity response (GSR) which identifies not only the structure-less patch but also the patch having multiple optima in similarity function.The remaining of this paper is constructed as the following. In Section 2, we describe the problem of Moran's spatial correlation as the motivation for GSR. We then introduce two sub-image quality metrics and discuss how to incorporate them into a non-rigid registration scheme using hierarchical locally affine transformation. Section 3 compares the performance of Moran's metric and GSR using receiver operating characteristic (ROC) analysis. We also compare the registration accuracy with known non-linear deformation as ground truth to give us a quantitative performance results. Finally, in Section 4 we provide some conclusions and point out several possible directions for future work.

@&#CONCLUSIONS@&#
We have developed a new sub-image analysis method based on the gradient of the self-similarity response. Comparing to Moran's spatial correlation test, the proposed method takes into account the problematic structures such as the sub-image with constant intensity in one direction, which are prone to cause mis-registration in the direction perpendicular to the gradient of image intensity. Using ROC analysis, we have shown that the proposed method has better performance for identifying problematic sub-images than Moran's metric for different noise levels and sub-image block size. Since the problematic structure could still be capable of recovering the displacement in certain direction, we proposed another metric to quantify the reliability of recovered displacement. Incorporating the proposed metrics with a non-rigid registration scheme based on hierarchical locally affine transformation, we have shown that the proposed method achieves higher registration accuracy on average at different noise levels. Several possible future works will be considered such as extending the technique for multi-modality non-rigid registration with mutual information as similarity metric, designing a weighted GSR to improve the classification accuracy, taking second-order derivative into account, e.g. Hessian matrix, and determining the non-uniform image partition that maximizes the GSR.