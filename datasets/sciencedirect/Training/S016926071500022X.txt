@&#MAIN-TITLE@&#
Improvement of retinal blood vessel detection using morphological component analysis

@&#HIGHLIGHTS@&#
A novel scheme for extracting retinal blood vessels based on morphological component analysis (MCA) algorithm is presented in this paper.We separate lesions from retinal images to improve the final vessel map results.The Morlet Wavelet Transform is used to enhance retinal blood vessels.Adaptive thresholding is employed in order to segment retinal vessels.

@&#KEYPHRASES@&#
Retinal blood vessel,Diabetic retinopathy,Morphological component analysis (MCA),Morlet Wavelet Transform,Adaptive thresholding,

@&#ABSTRACT@&#
Detection and quantitative measurement of variations in the retinal blood vessels can help diagnose several diseases including diabetic retinopathy. Intrinsic characteristics of abnormal retinal images make blood vessel detection difficult. The major problem with traditional vessel segmentation algorithms is producing false positive vessels in the presence of diabetic retinopathy lesions. To overcome this problem, a novel scheme for extracting retinal blood vessels based on morphological component analysis (MCA) algorithm is presented in this paper. MCA was developed based on sparse representation of signals. This algorithm assumes that each signal is a linear combination of several morphologically distinct components. In the proposed method, the MCA algorithm with appropriate transforms is adopted to separate vessels and lesions from each other. Afterwards, the Morlet Wavelet Transform is applied to enhance the retinal vessels. The final vessel map is obtained by adaptive thresholding. The performance of the proposed method is measured on the publicly available DRIVE and STARE datasets and compared with several state-of-the-art methods. An accuracy of 0.9523 and 0.9590 has been respectively achieved on the DRIVE and STARE datasets, which are not only greater than most methods, but are also superior to the second human observer's performance. The results show that the proposed method can achieve improved detection in abnormal retinal images and decrease false positive vessels in pathological regions compared to other methods. Also, the robustness of the method in the presence of noise is shown via experimental result.

@&#INTRODUCTION@&#
Retinal vessel segmentation and quantitative measurement of vessel variations is crucial in many research efforts related to vascular features. Analysis of vascular structures could be used to diagnose several diseases such as diabetic retinopathy, glaucoma and hypertension. In many clinical investigations, segmentation of retinal blood vessel becomes a prerequisite for the analysis of vessel parameters such as tortuosity and vessel width. Manual segmentation of blood vessels is a time consuming task that requires remarkable skills. Therefore, the development of algorithms for automatic vessel segmentation and vessel diameter estimation is of paramount importance. It is commonly acknowledged in the medical community that the first stage in the development of a computer-assisted diagnostic system is the automatic quantification of retinal vessels [1].Retinal vessel segmentation is still a challenging issue that has been widely studied in the literature. These studies can be classified into six categories: (1) matched filtering, (2) multi-scale algorithms, (3) pattern recognition methods, (4) vessel tracking, (5) model-based techniques and (6) mathematical morphology [1].In matched filtering methods, retinal images are filtered by various vessel-like kernels which are designed to model a specific feature in the image at different positions and orientations. The presence of the desired feature is recognized using the matched filter response [1]. Jiang and Mojon [2] proposed a method based on a verification-based multi-threshold probing scheme. In this method, the image was probed with different thresholds and a vessel map was obtained by combining images derived from probed thresholds followed by post-processing algorithms. The method was evaluated on the DRIVE dataset, reporting an average accuracy of 0.92 and an area of 0.94 under the ROC curve. In [3] a 2D Gaussian matched filter was used to enhance the retinal images and simplified pulse coupled neural network (PCNN) was employed to segment the blood vessels by firing neighborhood neurons. Then, a 2D Otsu thresholding was used to search for the best segmentation results. The final vessel map was obtained through the analysis of regional connectivity. The evaluation of the methodology yielded a true positive rate of 0.80 and a false positive rate of 0.02 on the STARE dataset. Bankhead et al. [4] proposed a method based on Wavelet Transform. The methodology achieved a sensitivity of 0.7027 and specificity of 0.9717 on the DRIVE dataset. A method based on Gabor Wavelet and multilayered thresholding was proposed in [5]. The evaluation of the method on the DRIVE and STARE datasets achieved an average accuracy of 0.9502. The objective of the multi-scale approaches is to detect vessels with varying widths. Vlachos and Dermatas [6] proposed a multi-scale line tracking vessel detection method, which started from seed points derived from a brightness selection rule from a normalized histogram, and terminated when a cross-sectional profile condition became invalid. The multi-scale confidence image map was achieved by combining the multi-scale line tracking results. The final vessel network was derived from the quantization map of the multi-scale confidence matrix followed by a post-processing step which removed erroneous artifacts. The method attained an average accuracy of 0.92, a sensitivity of 0.74 and a specificity of 0.95. A vessel detection method based on line detection was proposed in [7]. This algorithm is based on the fact that changing the length of a basic line detector produces line detectors with varying scales. The final vessel map was obtained by combining line responses at varying scales. The method was evaluated on the DRIVE and STARE datasets, yielding an average accuracy of 0.9407 and 0.9324, respectively.Pattern recognition methods are divided into two subclasses: supervised and unsupervised methods. Supervised methods use some prior information to create the vessel map, while detection of vessels in the unsupervised methods is performed without any prior labeling information. Niemeijer et al. [8] created a feature vector comprising of the green channel of the image and the responses of Gaussian matched filter. Then, the K-Nearest Neighbor (KNN) algorithm was used to estimate the probability map. Finally, the retinal vessel map was created by thresholding the probability map. Staal et al. [9] introduced an algorithm based on the extraction of image ridges, which coincided approximately with vessel centerlines. With line elements, the image was partitioned into patches by assigning each image pixel to the closest line element. A feature vector was created for each pixel using the patch properties and the line elements as inputs to the KNN classifier. In [10] a method based on radial projection and semi-supervised self-training was proposed for vessel segmentation using SVM. The vessel centerlines were located using radial projection and the major structure of vessels was extracted by applying a semi-supervised self-training classifier. The average accuracy, sensitivity and specificity were 0.94, 0.74 and 0.97, for DRIVE dataset and 0.94, 0.72 and 0.97 for STARE dataset, respectively. Kande et al. [11] proposed an unsupervised fuzzy-based vessel segmentation algorithm. In this method, first the contrast of retinal images was enhanced by a matched filter, and then a weighted fuzzy C-means clustering algorithm was used to identify the vascular tree structures. The combination of 2-D Gabor Wavelet and supervised classification was employed by Soares et al. [12] for retinal vessel segmentation. A feature vector comprising of pixel intensity and Gabor Wavelet Transform responses at multiple scales was used as inputs for a Gaussian mixture model classifier to classify each pixel as either a vessel or non-vessel pixel. The method achieved an average accuracy of 0.9466 and 0.9480 on the DRIVE and STARE datasets, respectively. A method based on neural networks was proposed in [13], which used a 7-d feature vector composed of moment invariant and gray level features. Finally a neural network was employed for the purpose of training and classification. The method was evaluated on the DRIVE and STARE datasets, yielding an accuracy of 0.9452 and 0.9526, respectively. Ricci and Perfetti [14] introduced a method based on line operators and SVM classifier for pixel classification. The line operator was based on the evaluation of the average gray level along lines of fixed length that passed through the target pixel at different directions. The evaluation of the method yielded an average accuracy of 0.9563 and 0.9584 on the DRIVE and STARE datasets, respectively.The vessel tracking methods segment vessel map between two points based on local information. An automatic model-based algorithm for vessel segmentation was proposed in [15]. The algorithm utilized a parametric model of a vessel which exploited geometric properties for parameter definitions.In model-based approaches, the retinal vessel map was extracted by applying the explicit vessel models. Diri et al. [16] proposed a method for retinal vessel segmentation using a Ribbon of Twins active contour model. This method used two pairs of contours to capture each vessel edge, while maintaining the width consistency. The method proposed by Lam et al. [17] was based on regularization-based multi-concavity modeling. The method was evaluated on the DRIVE and STARE datasets, yielding an accuracy of 0.9472 and 0.9567, respectively. Espona et al. [18] proposed a vessel segmentation method based on classical snake in combination with blood vessel topological properties. The method achieved an accuracy, sensitivity and specificity of 0.9316, 0.6634 and 0.9682 on the DRIVE dataset, respectively.Miri [19] proposed a vessel segmentation method based on Fast Discrete Curvelet Transform (FDCT) and multi-structure mathematical morphology. The contrast of the image was enhanced using FDCT and multi-structure morphological operations were used for vessel detection. The method achieved an accuracy, sensitivity and specificity of 0.9458, 0.7352 and 0.9795, respectively on the DRIVE dataset. Fraz et al. [20] proposed a vessel segmentation method using a combination of vessel centerline detection and morphological bit plane. The centerlines were extracted using a first order derivative of a Gaussian filter. A multidirectional morphological top-hat operator with linear structural elements followed by bit plane slicing of the vessel enhanced image was used to determine the shape and orientation of the vessels.Nevertheless, one of the challenges in reliable segmentation of retinal blood vessels is the appearance of several structures in retinal images such as exudates, microaneurysms and hemorrhages. These components degrade the performance of the vessel detection algorithm. To overcome this problem, it is recommended to separate these areas from retinal images before applying the vessel map segmentation algorithm. Recently, decomposing signals into their building components has attracted a growing attention to signal and image processing. Successful separation of signal content is pivotal to its analysis, enhancement and compression. A number of approaches have been presented to expand this idea [21–27]. In recent papers [28–30], a new decomposition method called Morphological Component Analysis (MCA) that is based on sparse representation of signals has been presented. In the MCA, it is supposed that each signal is a linear mixture of different layers, or Morphological Components, which are distinctive in terms of morphology. Moreover, a range of decomposition applications including texture separation from non-texture parts [19,28,31,32], denoising [28,33], inpainting applications [34] and medical image processing [35] have been investigated by researchers.One way to detect retinal lesions is the use of segmentation algorithms. Several segmentation algorithms have been proposed in the literature with each focusing on detecting a certain type of lesion [36–39]. In order to detect and remove all lesions from retinal images, different segmentation algorithms are needed, since the lesions may be different in terms of color and size. In this paper, a different approach to lesion detection has been employed. The main contribution of the proposed method is using MCA to separate lesions from vessels and handle noise. Since vessels and lesions are morphologically distinct, MCA can be utilized to separate different lesions without any segmentation algorithms. In other words, the lesions can be separated using the MCA algorithm without employing segmentation algorithms. Then, the final vessel map is obtained from a clean retinal image using a segmentation algorithm. The removal of lesions from retinal images can improve the results of vessel map segmentation.Experimental results have shown the efficacy of the proposed algorithm for vessel map segmentation since it has a high segmentation accuracy not only in the normal retinal images but also in the images with signs of diabetic retinopathy. Also, we demonstrate that in addition to lesion separation, the noise is well removed from the retinal images since MCA naturally handles the data disturbed by additive noise. Thus, the proposed vessel detection algorithm is effectively robust to the presence of noise in the image.The rest of the paper is organized as follows. In Section 2 a brief review of the concept of MCA algorithm and the dictionaries used in it is presented. The proposed vessel detection method is presented in Section 3. Experimental results are provided in Section 4. Finally, in Section 5, concluding remarks are stated.In the past decade, sparsity has developed as one of the primary concepts in a variety of signal-processing applications such as restoration, feature extraction, source separation and compression. For a long time, sparsity has attracted researchers about theoretical and practical signal properties in several areas of applied mathematics such as computational harmonic analysis, statistical estimation and theoretical signal processing [40].Starck et al. [28,29] proposed a new decomposition method, i.e. Morphological Component Analysis (MCA), based on sparse representation of signals. In the MCA, it is supposed that each signal is a linear mixture of different layers, namely Morphological Components, which are distinctive in terms of morphology. For this method to be successful, it is assumed that a dictionary of atoms is available for separation of every component that allows its construction by a sparse representation. The signal content is often complex, and there is no single dictionary that is optimal enough to efficiently represent all the signal components. Thus, it is presumed that each morphological component of the signal is sparsely represented in a specific transform domain. When all transforms (each linked to a morphological component) are aggregated in a single dictionary, each brings about the sparse representation of the part of the signal it is serving, yet still inefficient in representing other contents in the mixture.Here, we show how to decompose a signal into its building components using the MCA algorithm proposed by Stark et al. [29], starting with the model of the problem. Since the choice of dictionaries plays a pivotal role in separating different components from each other, Shearlet transform [41] and Non-Subsampled Contourlet transform [42] which are applied to MCA algorithm will be discussed later.Suppose that the sample signal y∈RNis the linear combination of K morphological components xkand it is possibly noisy:(1)y=∑k=1Kxk+εσε2=var[ε]<+∞The MCA framework aims at solving the inverse problem associated with the recovering of components (xk)k=1, …, Kfrom their observed linear mixture. MCA assumes that each component xkcan be sparsely represented in an associated basis Φk, i.e.(2)xk=ϕkαkk=1,…,Kwhere αkis a sparse coefficient vector (that is, only a few coefficients are large enough). Thus, by aggregating several transforms (Φ1, …, Φk), a dictionary can be developed in a way that for each k, the representation of xkin Φkwill be sparse, but not in other Φlfor l≠k. That is, the sub-dictionaries (Φ1, …, Φk) need to be mutually incoherent. Therefore, the sub-dictionary Φkhas a discriminating role in different types of content, favoring the component xkover all other parts. Drawing on recent advances in computational harmonic analysis, the efficacy of a number of novel representations such as the Wavelet Transform, Curvelet, Contourlet, steerable or complex Wavelet pyramids in sparse representation of certain kinds of signals and images have been shown. Thus, with regard to the decomposition, the dictionary is developed by taking the union of one or several (sufficiently incoherent) transforms, with each corresponding to an orthogonal basis.The augmented dictionary (Φ1, …, Φk), nonetheless, presents an over-complete representation of x. Given that the number of unknowns is greater than the number of equations, the system x=Φα is underdetermined. In [28,29] a method of estimating the components (xk)k=1,…,Khas been proposed which is based on solving the following constrained optimization problem:(3)minα1,…,αk∑k=1K||αk||pps.t.y−∑k=1KΦkαk2≤σwhere||α||ppis sparsity promotion (the most interesting regime is for 0≤p≤1) and σ is typically chosen as τσɛ, whereσε2is the noise variance and τ is a constant. The constraint in this optimization problem is related to the presence of noise and the model used for imperfections. In the absence of any noise and the exactness of the linear superposition model (σ=0), the inequality constraint replaces with an equality constraint.In general, finding a solution to problem (3), especially for p<1 is very difficult. It is even an NP-Hard problem for p=0. However, if all component coefficients αlexcept for the kth one are constant, then a solution can be obtained by hard thresholding (for p=0) or soft thresholding (for p=1) of the coefficients of the marginal residualsrk=y−∑l≠kΦlαlin Φk. Other components, free of these marginal residuals rk, contain potentially significant information about xk. This concept is derived from the coordinate relaxation algorithm [43], which is cycled through the components at each iteration, and applies a thresholding to the marginal residuals.In addition to coordinate relaxation, iterative thresholding with varying thresholds is another critical ingredient of MCA. As such, MCA can be regarded as a stage-wise hybridization of matching pursuit (MP) [44] with block coordinate relaxation (BCR) [43] that enables it to approximately solve (3). Therefore, MCA is a salient-to-fine process in which the most salient contents of each morphological component is calculated iteratively at each iteration. Then, these estimates are gradually refined as the threshold λ is reduced to λmin.As mentioned earlier, the choice of dictionaries plays an important role in separating content of signals. Obviously, the best dictionary is the one that leads to the sparsest representation. In this study, known transforms have been used for representing image components. Thus, a brief description of these transforms is given here.The important information of an image is often located around its edges which separate image objects from the background. These features correspond to the anisotropic structures in the image [41]. Since Wavelets have isotropic support, they fail to capture image geometric information such as lines and curves. If the basis of a transform is nearly parallel to the image edges, they can exploit the anisotropic regularity of a surface along edges [45]. Shearlet Transform is designed to efficiently encode such anisotropic features [41].Scaling of the Shearlets is according to a parabolic scaling law which is encoded in matrices A2jorA˜2j, exhibiting directionality by parameterizing slope encoded in the shear matrices SkorS˜k, which are defined by (4) and (5) for j≥0, k∈Z:(4)A2j=2j002j/2,Sk=1k01,A˜2j=2j/2002j,S˜k=1k01.forϕ,ψ,ψ˜∈L2(R2)the cone-adapted discrete Shearlet systemSH(ϕ,ψ,ψ˜;c)is defined by (5). The parameter c is a positive constant which controls the sampling density.(5)SH(ϕ,ψ,ψ˜;c)=Φ(ϕ;c1)Ψ(ψ;c)Ψ˜(ψ˜;c),where Φ is a scaling function and Ψ andΨ˜as Shearlets which are defined as follows:(6)Φ(ϕ;c)=ϕm=ϕ(⋅−cm):m∈z2Ψ(ψ;c)=ψj,k,m=23j/4ψ(SkA2j⋅−cm):j≥0,|k|≤[2j/2],m∈Z2Ψ˜(ψ˜;c)=ψ˜j,k,m=23j/4ψ˜(SkYA˜2j⋅−cm):j≥0,|k|≤[2j/2],m∈Z2Shearlets are obtained by applying translation, anisotropic scaling matrices A2j and shear matrices Skto fixed generating functions Ψ. The matrices A2j and Sklead to windows which can be elongated along arbitrary orientations, and the geometric structures of singularities in images can be efficiently represented by them [45]. Fig. 1shows the tiling of frequency plane using Shearlet Ψ. As can be seen, Shearlet Ψ can provide a nearly optimal approximation for a piecewise smooth function f with C2 smoothness except at points lying on C2 curves.The main objective of Contourlet Transform is to obtain an optimal approximation rate of piecewise smooth functions with discontinuities along twice continuously differentiable curves. Accordingly, it covers areas with smooth subsection contours [46]. The NSCT is a shift-invariant version of Contourlet Transform. The Contourlet Transform employs the low-pass filter for multi-scale decomposition, and the directional filter bank for directional decomposition. To achieve the shift-invariance and get rid of the frequency aliasing of the Contourlet Transform, the down-samplers and the up-samplers are eliminated during the decomposition and reconstruction of the image. The NSCT is built based on the non-subsampled pyramids filter banks (NSFB) and the non-subsampled directional filter banks (NSFB) [42,47], which is shown in Fig. 2.In this section, the proposed vessel detection algorithm based on component separation is discussed in detail. Here, the input of the developed system is a color retinal image taken by a fundus camera, and its output is the retinal vessel map. The proposed method is composed of three fundamental parts: (1) preprocessing, which involves green channel selection, the removal of useless parts of retinal images, and illumination enhancement, (2) retinal image cleaning, which includes removing lesions and noise from the retinal images and (3) vessel segmentation.Among the color image components, green channel exhibits the best vessel-background contrast of the RGB-representation in retinal images, whereas the red channel can still be saturated, and the blue channel offers poor dynamic range [13]. With the purpose of vessel map segmentation, at first the green channel IGis extracted from the RGB retinal images. The use of gray-level images instead of color-images decreases the computational time.Retinal images normally contain a region of interest (ROI) at the center of the image, which is surrounded by a dark background. Given that only ROI pixels are used for vessel detection, these useless parts (i.e. the additional dark background) are removed from retinal images to accelerate further processing stages. To find the retinal ROI, the Otsu thresholding algorithm [48] is applied to the green channel of the retinal image. The resulting binary image is represented by one large connected region, which is the retina FOV. However, some missed labeled pixels on the retinal background and foreground are created. Theses noisy regions are removed through morphological opening and closing, respectively. Empirically, the size of the structuring element is assumed to be 7. The useless parts of the retinal image are removed by finding the bounding box which only contains retinal FOV. Finally, the cropped retinal image is resized to 512×512 pixels to accelerate further processing stages. The removal of useless parts of retinal images is shown in Fig. 3.Fundus images often contain background intensity variation caused by non-uniform illumination. This effect may degrade the performance of the vessel segmentation algorithm. To remove these background lightening variations, the retinal image background IBis created by a median filter of size 30. Then, the enhanced retinal image IEis computed by subtracting IBfrom IGaccording to (7). Finally the values of IEare normalized to the range of 0 and 1.(7)IE(i,j)=IG(i,j)−IB(i,j).As mentioned earlier, the abnormal signs of diabetic retinopathy make the detection of retinal vessels very difficult. Retinal lesions may be wrongly detected as vessels and may produce false positives in the final vessel map. Thus, the removal of retinal lesions before applying the vessel segmentation algorithm can significantly improve the final retinal vessel map. As shown in Fig. 4, blood vessels appear as curved-like structures, whereas lesions appear as spot-like structures. Since vessels and lesions have different morphological structures, the MCA algorithm can be used to separate these components. In other words, we use the MCA algorithm to remove lesions from retinal images and produce clean images before applying vessel segmentation algorithm. For perfect separation of these components from each other using the MCA algorithm, it is crucial to choose two appropriate dictionaries, each of which sparsely represents one of the morphologically different components. In the following subsection, a description on the selected dictionaries has been given.As mentioned in the preliminary section, for the MCA method to be successful, there should be a dictionary or a transform for every component to be separated that enables its construction through a sparse representation, even though it is highly inefficient in representing other contents of the mixture. Using appropriate dictionaries, each of which sparsely represents one of the components, the MCA algorithm can successfully separate the morphologically distinct components. In this paper, the authors intend to separate two structurally distinct components of retinal images, i.e. lesions and vessels. Thus, transforms known for sparse representation of either curved-like structures or spot-like structures were chosen. These dictionaries are highly structured and have fast implementation. In this section, a brief description of our candidate dictionaries is presented and then the MCA algorithm which uses the candidate dictionaries to decompose retinal images is discussed.The blood vessels appear as curved-like structures in retinal images. The curved-like features correspond to the anisotropic structures of data, which can be distinguished by their location and orientation. Thus, the efficient representation of vessel parts requires a directional transform which is optimal for representing curved-like features in the image. Of many directional representation systems proposed in the last decades, Shearlet is considered to be the most versatile and successful one, as it has an extensive list of desirable properties. To name a few, note that Shearlet systems can be produced by only one function; they offer an exact resolution of the wavefront sets; they enable compactly supported analyzing elements; they are related to the fast decomposition algorithms, and they present an integrated treatment of the continuum and digital realm [41]. In this paper, Non-Subsampled Shearlet Transform (NSST) is used for representing vessel parts of retinal images. Using NSST, the retinal images were decomposed into 4 scales and 8 orientations in each level. Following the NSST decomposition, one low-pass image and 24 band-pass images were obtained, all of which have the same size of the input image.Algorithm 1: MCA decomposition algorithm1.Parameters: The image IEwhich is represented as a 1D vector, the dictionaryΦ=[Φv,Φl], number of iterations per layer Niter, stopping threshold λmin.2.Initialize: number of sub-dictionaries K=2,Φ=[Φv,Φl]where Φvand Φlcorrespond to NSST and NSCT, respectively.Φl+andΦv+are also pseudo-inverse of sub-dictionaries. Letk*=argmaxkΦky∞k=1,…,K; setλ=λ0=maxk≠k*Φky∞; set y=IEand initial solutionxv=0,xl=0.3.Perform Nitertimes:Part A – Update of xvassuming xlis fixed:– Calculate the residual r=y−xv−xl.– Calculate the NSST of xv+r and obtainαv=Φv+(xv+r).– Hard threshold the coefficient vector αvwith the λ threshold and obtainαˆv.– Reconstruct xvbyxv=Φvαˆv.Part B – Update of xlassuming xvis fixed:– Calculate the residual r=y−xl+xv.– Calculate the NSCT of xl+r and obtainαl=Φl+(xl+r).– Hard threshold the coefficient vector αlwith the λ threshold and obtainαˆl.– Reconstruct xlbyxl=Φlαˆl.4.Update the thresholdλ=λ×λ0τσε1/(1−Niter)5.If λ>λmin, return to Step 2. Else, finish.6.Output: Morphological componentsxvandxlThe retinal lesions appear as spot-like structures in retinal images. Efficient representation of these structures requires a directional transform which is optimal for representing the areas. The Contourlet Transform achieves an optimal approximation rate of piecewise smooth functions with discontinuities along twice continuously differentiable curves. Therefore, it captures areas with smooth subsection contours [49]. In this paper, the Non-Subsampled Contourlet Transform (NSCT) is selected to represent the lesion parts of retinal images. It utilizes the Laplacian pyramid [50] to capture point discontinuities and directional filter banks with the aim of linking point discontinuities into linear structures. In the DFB stage, the McClellan Transform of filter derived from the VK book is used [51]. Using these filters, images were decomposed into 4 scales with 8 orientations in each level. Following a 4-level NSCT decomposition, one low-pass sub-band image and 24 band-pass directional sub-band images were obtained, all of which have the same size of the input retinal image.As discussed in the previous subsections, NSST and NSCT provide optimally sparse expansions for curved-like structures and areas with smooth subsection contours, respectively. The MCA algorithm [29], which is used to separate vessels from lesions in the enhanced retinal imageIE, is shown in Algorithm 1.In this algorithm, xvand xlthat are initialized to zero are the vessel and the lesion parts of the retinal image, respectively. In the first part of the algorithm, the lesion partxlis fixed and a vessel part xvis sought. The component xl, is removed from the residual r, and is likely to contain the salient information of xvasΦvoptimally provides a sparse representation for curved-like structures. In the NSST decomposition, if a Shearlet with a specific scale and angle is approximately aligned along a curve, the corresponding coefficient in the αvwill be large. Otherwise, it would be close to zero. Then, a solution can be achieved by hard thresholding the coefficients αvwith threshold λ and choosing the largest coefficientsαˆv. The initial value of the threshold λ=λ0 can be automatically set to an adequately large value (λ0=maxk≠k*||Φky||∞ wherek*=argmaxkΦky∞). Hard thresholding in the algorithm denotes component-wise thresholding: HTλ(u)=uif|u|>λ, and it is equal to zero otherwise. In the following part, similar steps are performed for the other component, i.e. lesion part xlby choosing a sub-dictionary Φlwhich is appropriate for representing sparsely spot-like structures. Therefore, the most salient content of each morphological component is iteratively computed. The threshold λ is reduced across the iterations of the MCA algorithm. In a precise representation of the data with the morphological components, λmin should be set to zero. However, MCA is naturally capable of handling data disturbed by additive Gaussian noise ɛ with bounded varianceσε2as noted earlier. In fact, this algorithm is a coarse-to-fine iterative procedure, and the bounded noise can be controlled by ceasing iteration when the residual is at the noise level, thus λmin=τσɛ, is chosen, where σɛ is the noise standard deviation and is known also τ is a constant, typically between 3 and 4. The robustness of the algorithm in the presence of additive noise will be shown in the next section. As such the algorithm can be potentially successful in separating the contents of the image, in such a way thatΦvαˆvis mainly the vessel andΦlαˆlis mostly the lesion part. As noted earlier, this expectation is based on the assumptions according to whichΦvand Φlare highly efficient in representing one content type and yet highly ineffective in representing the other. In Fig. 5, the separation of the vessel and the lesion parts by the MCA algorithm has been shown.Fig. 6shows the results of the vessel and lesion separation using NSST and NSCT. As it can be seen, the retinal lesions are completely separated from the vessels. The additional contents of the image which are not represented sparsely by these dictionaries are also allocated to the noise part.Fig. 7shows more examples of applying the MCA sparse decomposition algorithm to abnormal retinal images selected from the MESSIDOR dataset [52]. Fig. 7(a) depicts the original abnormal retinal images, and the results of lesion and vessel separation are shown in Fig. 7(b and c). As shown in Fig. 7, the MCA algorithm with the selected transforms can separate lesions from vessels in such a way that clean retinal images are prepared for further processing stage.Blood vessels have Gaussian cross sections with varying width and orientation. In order to enhance these structures, the Morlet Wavelet ψMTransform, which is a multi-resolution analysis technique with a Gaussian kernel, is employed:(8)ψM(t)=exp(jk0t)exp−12|At|2wherej=−1andA=diagε−1/2,1,ε>1is a diagonal matrix that defines the anisotropy of the filter. The nonzero parameter k0∈R2 is the wave vector of the plane wave (spatial frequency). The angular selectivity increases with |k0|, and the use of anisotropy ϵ>1 in the matrix A. As such, the modulus becomes a Gaussian elongated in the x direction [53]. We empirically set the ϵ parameter to 5 and k0=[0,2].Before applying the Wavelet Transform to the vessel part of retinal images (xv), the green channel of the vessel image is inverted to make vessels brighter than the background. Then, retinal image xvwhich is represented as a 1D vector, is decomposed by Morlet Wavelet ψMat scale a and direction θ as follows [53]:(9)wψ(b,θ,a)=c−1/21a∫ψM*(a−1r−θ(t−b))xv(t)d2twherec,ψM*,θ,band a are the normalizing constant, complex conjugate Morlet Wavelet, rotation angle, displacement vector and scale parameters, respectively.In each scale, the Wavelet Transform is applied over orientations from 0° to 180° with a step angle of 20°. We select the coefficients with maximum modulus over all directions as a response. Fig. 8shows the maximum modulus over all directions at scale 2 and 3.(10)Mψ(b,a)=maxθ|Wψ(b,θ,a)|The final enhanced image IFis computed as the maximum modulus of the coefficients obtained in all scales as follows(11)IFmaxaMψ(b,a)The retinal vessel map is achieved by thresholding the enhanced image IF. The threshold value is computed by using the x value corresponding to the 0.88 of the Cumulative Density Function (CDF) of the enhanced image IFobtained from its histogram. Since the vessel pixel percentage in the FOV is typically around 12–14% [4], the threshold value is set to the value with a CDF value of 88%. Fig. 7(d) shows the enhanced retinal images using the Morlet Wavelet transform and Fig. 7(e) depicts the final vessel map of the clean retinal images.

@&#CONCLUSIONS@&#
