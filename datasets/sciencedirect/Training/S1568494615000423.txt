@&#MAIN-TITLE@&#
Automatized fuzzy evaluation of CT scan heart slices for creating 3D/4D heart model

@&#HIGHLIGHTS@&#
A new method of evaluation of CT scan heart slices is proposed.The proposed method is based on classification of histograms of brightness of CT scan heart slices.The quality evaluation is based on fuzzy classification.The algorithmic approach to the construction of the membership functions of given in advance classes is introduced.The experiment showed that the fuzzy selection is absolutely consistent with the one done by an expert.

@&#KEYPHRASES@&#
CT scan heart slices,Ultrasonography simulator,Algorithmic method of a membership function construction,Structural features,

@&#ABSTRACT@&#
A new method of evaluation of CT scan heart slices is proposed in this paper. CT images, acquired from different patients, are stored in PACS database. In order to create 3D/4D model of heart it is necessary to choose these CT images that have sufficient quality. The proposed method is based on classification of histograms of brightness of CT scan heart slices. Some structural features of these histograms are correlated to the images quality which is evaluated in the context of creating an ultrasonography simulator on the basis of CT scan heart slices. They constitute computed tomography scan sets. The quality evaluation is based on fuzzy classification. A new methodology of the membership function construction in relation to structural features of the examined images is proposed. The algorithmic approach to the construction of the membership functions of given in advance classes is introduced. The experiments have shown that the proposed method is effective in selection of high quality CT scan heart slices that can be the basis for the simulator construction. The experiment showed that the proposed fuzzy selection is absolutely consistent with the one done by an expert.

@&#INTRODUCTION@&#
Medical education in the 21st century is based not only on theoretical knowledge and activities with patients but also on training by using systems that simulate the process of selected examinations and operations like endoscopy [46], anesthesia [58], surgery [31,47] and ultrasonography [11,57]. Familiarization with the problems of the examination and treatment as well as the presentation of a selected disease details are the purpose of such simulations. The construction of medical simulators is not a new idea. In the field of ultrasonography both scientific and commercial applications are available. The transesophageal echocardiography simulator with mannequin [57] as well as ultrasound simulators for cardiovascular and urological examinations [10,17,20,24,44,49,50,61] can be put as the examples. The number of reviews of quality, accessibility and usability of the mentioned simulators has been increasing continuously [9,30,45,48].There are several approaches to simulate the ultrasound [61]. The use of computed tomography (CT) images in order to create a patient's organ model is one of the ways of such simulations [12,20,24,38,50]. On the basis of CT data the ultrasound waveform is simulated. This approach, described in detail in [24,39,44,49], is satisfactory in the field of the echocardiography [24,38]. More general approach that considers other organs requires an implementation of refraction and diffraction [53].Differences and common features of ultrasound and CT are the key issue of simulations. CT images provide information about the absorption of X-rays whereas the ultrasound images are more complex because they are related to absorption, reflection, refraction and diffraction phenomena. CT images provide precise information about the region of absorption whereas ultrasound images are not so accurate.A simulation of the sound beam requires the determination of both examined tissue density and the speed of sound in it as well as the rate of absorption for the tissue through which the sound passes. In the case of creating of the heart images the detailed discussion of these aspects can be found in [38]. The tissue localization determines the spatial distribution of the sound absorption. Therefore, in order to use CT images to model US image, it is necessary to define a transformation function that transforms X-ray absorption into US absorption. The CT images that constitute the base for the heart model have to be high quality images. The images quality evaluation done by an expert is a time consuming task. Therefore, automatization of the task is demanded. In this paper a quality evaluation algorithm, based on fuzzy approach, is proposed.Assignment an object to a fuzzy class is one of the most frequent tasks in classification problems. There are at least a few levels on which this task is considered. On the lower ones, so called fuzzy clustering, two main approaches are used [59]. The first approach, based on objective functions, is effective and studied intensively [1,18,19,37]. The second one is based on a relation matrix such as correlation coefficient, equivalence relation, similarity relation and fuzzy relations [2,15,16,27,55,60]. In both aforementioned categories of the problems, the set of objects is given and the task consists in clustering it. However, there is a group of problems in which the recognized classes are known in advance according to the structural properties of their objects. As a result, a problem of objects recognition according to their structural features occurs and it is an example of fuzzy classification on the high level of abstraction. The mentioned structural properties can be described in the terms of fuzziness. In this approach the membership function should be defined in such a way that it reflects syntactic aspects of the problem. This paper is situated in this stream of investigations and it is a continuation of the studies described in [4]. First of all, in Section 3, a general methodology of construction of membership functions, that describe the given a priori classes, is introduced. The described method is then applied to classification of the CT scan heart slices quality. In general, there are numerous problems with automatic CT scan heart slices processing, caused by the CT scan examination nature, among others high noise level, low contrast between the examined tissue and its background and high variability in the level of gray due to differences in tissues thickness and absorption level of radiation [8,23]. The considered images can be characterized fast with the histogram that shows whether the brightness ranges of objects are selective [52]. In this paper – see Section 4 – the proposed algorithmic construction membership functions method is applied for the mentioned histograms analysis due to the fact that their structural properties are correlated with the CT scan heart slices quality. The considered histograms are function-type curves divided in advance into four classes: uni-, bi-, three- and four-modal ones and the membership functions are defined in such a way that they reflects their structural properties [3,4].The paper is organized in the following way. In the next section the computed tomography is discussed in the context of creating three- and four-dimension heart model. The methodology used for evaluation the CT scan images is described in Section 3. The proposed approach is based on fuzzy classification of histograms of brightness of CT scan heart slices. The fact that the image quality is strongly correlated with structural features of the histogram is utilized in the proposed method. An application of the proposed methodology is described in Section 4.The 3D/4D model of the heart can be created on the basis of CT examination sets that consist of a great number of heart projection images [13]. The analysis of full 3D/4D CT sets requires to load data into memory and often a rendering, which is time-consuming. Thus, the fast automatic analysis of set quality is required. The used approach is based on the method proposed for rock images analysis introduced in [25,29]. Similarly, the analyzed CT images are stored in PACS databases. It should be stressed that alternative approaches for selection such as, for instance, SVM, that are widespread used in computer vision in general and in medical imaging in particular, require data extraction from the PACS system, loading them and then analyzing. In the proposed approach, however, extracting the whole data set is not necessary – the evaluation can be done on the side of database server. Therefore, such method allows us to explore the database in short time and quick sort of the CT scan heart slices according to their quality. This allows us to perform quick and effective preliminary qualification of the images and decide whether the analyzed data set contains sufficient number of good quality images for creation the three-dimensional or four-dimensional heart model. The quality of the examined images can be characterized fast with histograms that can show if the brightness ranges of objects (heart structures) are selective. The analysis of histograms allows us to reject those CT scan slices which quality is insufficient to use them for creating a 3D/4D model of a heart for the ultrasonography simulator. The histograms are regarded as function-type curves and they are analyzed due to their structural properties that reflect the image quality.The model of a heart can be constructed by using data which were obtained from the multiphase computed tomography by using a group of cardiac protocols (e.g. CCTA – Coronary Computed Tomography Angiography). This technique is described in [33,41]. CT data are collected in DICOM files that contain uncompressed 2D CT images of the body scan in vertical and horizontal axis. The spatial dimension of that images is either 512×512 or 256×256, a set contains 200–400 2D CT slices per one heart phase, the voxel data resolution is 12 bits per pixel but aligned to 16 bits. A set of files from a single examination creates a three-dimensional block of data. Blocks may represent different heart stages of the cycle and for this reason a set of these blocks can be used to simulate an animation of a heart activity as it is presented in Fig. 1One CT examination provides large amount of data (from 1.2 up to 4GB) that should be evaluated in the context of the use in the CT2TEE simulator – see [52].CT sets, created especially for imaging the coronary arteries (CCTA), can in a few percent of cases visualize also the other elements of the heart. The most required data should allow to show left and right atrium and ventricle, and four valves of the heart. Verification of the sets for using in the simulation can be made in the standard way (by manual reviewing of sets) or in the automatic way (by carrying out the revision in the database and the qualifying the sets by using a custom measurement).The standard approach to construction of the heart model consists in the extraction of a set from database, a 3D reconstruction [32] and selection of images that have sufficient quality by an expert. Due to large amount of data that have to be sent from the PACS system, the evaluation of such sets requires significant CPU and memory resources, and is a very time consuming task – see Fig. 2. The involvement of staff is an additional problem.In this paper the evaluation of the quality of a set of CT scan heart slices, based on histograms of their brightness, is proposed. The histograms provide information about tissues visibility in images. The system that reads the data at the PACS server side can be built by utilizing the aforementioned approach. Such system does not need to extract the data as a full volume of the subsequent phase of 3D blocks of the heart, but it calculates the histogram for each slice and analyze them by using the proposed measure. Such the approach, presented in Fig. 3, is similar to the proposal presented in [25,29] and allows us to operate in the entire PACS database without data transferring. Such organization reduces both the size of the data stored in the memory and CPU load. In addition, it allows us to carry out the process of CT images evaluation without staff supervision.Usually, CT images are acquired from different patients. The images differ in the terms of the brightness bands for different kinds of tissues. Another problem is caused by the applied radiologic contrast agent that makes overlap of brightness levels for several tissue types, such as bones and blood with contrast. Using different types of equipment can also affect the output images and their histograms. An example of a CT image and its histogram is presented in Fig. 4. The first peak on the left represents lungs. In the simulation this part of the histogram is removed (truncated to 0) as the ultrasound waves cannot propagate in this medium because of the high difference of the acoustic impedance on the tissue-air border [51]. The most important part of the histogram is the range of tree peaks, usually between 800 and 1300 level of brightness, as presented in Fig. 5. The first one of them, from the left, usually in the range of 800–1000, represents a heart muscle, the next one is correlated with contrasted blood and the last one is associated with contrasted blood (saturated – for Angio-CT) and bones (sternum and ribs). If the quality of the CT image is very high, then these three peaks are clearly visible.As a source of data for the simulation, a retrospective analysis of the data stored in the hospital PACS systems has been used. Some CT examinations have been performed with an X-ray dose reduction during the selected cardiac phase and therefore cannot be used for a heart model reconstruction. This issue have been discussed in details in [52]. As it has been already mentioned, manual search and evaluation of collected CT examinations is an extremely time-consuming task. Thus, an automatic evaluation would be very useful in the selection these CT sets that allow to visualize four heart chambers and four valves. The other problems like artifacts (metal clips, movement of the body during examination) can be checked in the next step (manually or automatically – not described in this article).In the presented approach the recognized classes of objects are studied due to structural properties of their elements. The classes are considered to be fuzzy sets. Thus, membership functions for each fuzzy set should be introduced. The system, that classifies the recognized objects, uses the values of membership functions calculated for each class. The construction of membership functions is a theoretical stage of the task. The algorithmic method, allows us to find analytical formulae of membership functions, is proposed below.Step 1. Division of a set of objects into classes. Division of a set of objects into classes must be done if it is not given a priori. In the case when information about structural features is complete, the division can be done by reference to the given knowledge. Otherwise, it has to be done by an expert or automatically, for example, by a neural network trained by using unsupervised methods. We can also take advantage of taxonomic methods.Step 2. Selection of distinctive features. If the information about structural features of classes is not given then the following steps should be undertaken.1.FeaturesCik,typical of each class, where k is the index of a class whereas i is the number of a feature in the class, are selected by analyzing a learning set X. Provided that Yiis a set of values of the ith feature, a function ci:X⟶Yiis defined as a result of features selection.A hypothesis that a founded feature is distinctive i.e. values of functions ciare correlated with particular classes, is stated.The hypothesis is verified by using a statistical test.If the feature has turned out to be a distinctive one then, for each class, a normalized histogram of relative frequencies of the feature values is plotted.Three last steps are repeated until a sufficient number of distinctive features is selected.Step 3. Creation of membership functions features describing the specified classes. For the effective specification of a membership function properties, implied by characteristics of objects from the analyzed fuzzy class, the following problems should be considered.1.How do the membership function depend on a given feature? In particular, intervals of monotonicity should be specified, existence of local extrema, asymptotes, points of discontinuity should be analyzed.What way do relations between features, if exist, have influence on the form of the membership function?How the parameters of the membership function should be introduced?How do the distortions of patterns affect the form of the membership function?What important are individual features? In particular, the components of the membership function should be weighed according to the importance of the corresponding feature.How should be the conditions of limiting transitions from the membership function to another one specified?Step 4. Construction of membership functions by using the specified properties. Assuming that the features have been listed (in step 3) analytical form of the membership functions that describe individual classes are postulated. Then, the calibration of the parameters of the functions – see step 3, point 3 – is done.Step 5. Definition of a decision function. For the given problem classification criteria are postulated. The simplest way is to assign the recognized patterns to the class for which the calculated value of membership function is the highest. However, also a more sophisticated classification algorithm should be taken into account, especially in the case when either all values are small or value of the difference between at least two of them is too low.It should be mentioned that if the problems with classification mentioned in Step 5 occurred then hierarchical approach to classification or to membership function creation can be applied – see [14,15,40,42,43]. The scheme of the above method is presented in Fig. 6. It should be stressed that the proposed method includes both instances when full information is given and when features have to be selected. In the last case there are several methods that allow us to find them – see, for instance [22,28,56]. In the paper [4] the case in the proposed algorithm when the structural features of objects belonging to the individual classes had not been known in advance and they had to be selected was considered. In this paper – see Section 4 – the structural features are known in advance and they should only be reflected in the algebraic formulae that are definitions of the membership functions.The methodology presented in Section 3 has been applied to classification of heart CT images. The classified objects are brightness histograms created for each CT image which quality can be assessed on the basis of these histograms. The obtained histogram is preprocessed. The histogram smoothing, by using the moving average method, allows us to remove small, meaningless distortions. The quality of the examined image is high if its brightness histogram has three clear peaks – Fig. 7. Otherwise, the quality is low – Fig. 8. According to this fact, selecting clear three-modal histograms is the task of the classifying system.Let us follow up the proposed algorithm – see Section 3. The task – selection of three-modal histograms – implies univocally the classes specification. Thus, each of the mentioned classes is characterized by the number of clear peaks in the histogram and, in the context of the task, we have unimodal, bimodal, three-modal and multimodal classes. In the last one, the number of clear peaks is equal to, at least, four. Therefore, according to the classes characteristics, the number of clear peaks is the only distinctive feature of the classified objects. Thus, the form of the membership functions has to depend only on the number of clear peaks. First of all, it should be stressed that only clear peaks should be taken into consideration. Furthermore, the assessment whether the peaks are clear, can be based only on a fuzzy measure. For instance, two maxima separated by a very narrow or very shallow niche should be regarded rather as one distorted clear peak than as two clear peaks.Let us describe the algorithm of the membership functions calculation. Let μ1, μ2, μ3, μ4 denote the membership functions of the four analyzed classes. In the simplest case, when only one maximum exists in the considered histogram, it is obvious that the membership functions values are following: μ1=1, μ2=0, μ3=0, μ4=0. If there are two maxima, then either a given histogram is unimodal with a distortion or it is a clear bimodal one. In such a case we have μ3=0 and μ4=0 but the functions μ1 and μ2 should be defined in such a way that these two cases are distinguished. Let x be a variable that is a measure of the grade of distortions calculated as follows:(1)x=Pmax−PminPmax,where Pmaxdenotes the area between the axis OX and the broken line which joins the graph maxima and Pminis the area between the axis OX and the broken line which joins the graph minima – see Fig. 9.A feature h1 is a relative measure of a value of a minimum:(2)h1=min1min{maxl,maxr}.wheremin1is a value of a histogram in its minimum,maxlandmaxrare values of a histogram in its left and right maximum respectively.On the basis of it, the new variable d1 is defined:(3)d1=1−h1,if0.8<h1,−0.5·h1+1,if0.66<h1≤0.8,1,ifh1≤0.66.The proposed border values for h1 are established in experimental way and this establishment corresponds to membership functions calibrations – see Fig. 6. Thus, the arguments for membership functions μ1 and μ2 have the form:(4)arg1=(1−x)·(1−d1)arg2=x·d1and respectively(5)μ1=sin(π·arg1/2);μ2=sin(π·arg2/2);μ3=0;μ4=0.To make the value of the proposed membership functions smooth the sine function was used but any increasing continuous function can be used. The μ1 and μ2 are defined in such a way that if x and d1 converge to 0, then μ1 increases to 1 whereas μ2 decreases to 0. In turn, if x and d1 converge 1, then μ1 decreases to 0 whereas μ2 increases to 1.If there are three maxima, then the analyzed histogram can be an element of the unimodal or bimodal class with distortions or three-modal one. Therefore it is obvious that μ4=0. In the case of three maxima two niches are constructed for every pair of successive maxima. This construction is exactly the same like creation of Pmax.As a result two niches between the first and the second maximum and between the second and the third one are separated. Their surfaces measure, p1 and p2 respectively, have influence on the grade of membership to the bimodal class. A histogram that has three maxima should be regarded as bimodal in the case when the surface of one of the created niches is considerably smaller in comparison to the other. The next vital variable h2, similar to h1, is the relative measure of the second minimum:(6)h2=min2min(maxl,maxr),wheremin2is the histogram value in the second minimum. On the basis of it the variable d2 is defined as follows:(7)d2=1−h2,if0.8<h2,−0.5·h2+1,if0.66<h2≤0.8,1,ifh2≤0.66.Thus the arguments for membership functions μ1, μ2, μ3 have the form:(8)arg1=(1−x)·(1−d1)·(1−d2),arg2=max(p1,p2)(p1+p2)·x·(1−min{d1,d2})·max{d1,d2},arg3=x·d1·d2,and respectively(9)μ1=sin(π·arg1/2);μ2=sin(π·arg2/2);μ3=sin(π·arg3/2);μ4=0.The functions μ1, μ2, and μ3 are calibrated in such a way that if x, d1 and d2 converge to 0, then μ1 increases to 1 whereas μ2 and μ3 decreases to 0. If x is increases to 1 and one of the niches is much bigger than the other, what usually means that one of them is a disturbance, then μ1 and μ3 decreases to 0 whereas μ2 increases to 1. Finally, if x, d1 and d2 increase to 1, then μ3 increases to 1 whereas μ1 and μ2 decrease to 0.If there are four maxima, then the analyzed histogram can be a distorted element of unimodal, bimodal or three-modal class or an element of multimodal class. In this case there are three niches p1, p2, p3. The parameter h3, similar to h1 and h2, is the relative measure of the third minimum. Thus, analogically as in the case of existence of three maxima, the arguments for membership functions μ1, μ2, μ3 and μ4 have the form:(10)arg1=(1−x)·(1−d1)·(1−d2)·(1−d3)arg2=max{p1,p2,p3}p1+p2+p3·x·(1−min{d1,d2,d3})·max{d1,d2,d3}arg3=sp1+p2+p3·x·(1−min{d1,d2,d3})·mid{d1,d2,d3}·max{d1,d2,d3}arg4=x·d1·d2·d3,where mid{a, b, c} is equal to the second element of the sequence consists of a, b, c sorted increasingly according to their values, s=max{p1, p2, p3}+mid{p1, p2, p3}. Thus(11)μ1=sin(π·arg1/2);μ2=sin(π·arg2/2);μ3=sin(π·arg3/2);μ4=sin(π·arg4/2).The functions μ1, μ2, μ3 and μ4 are calibrated in such a way that if x, d1, d2 and d3 converge to 0 then μ1 increases to 1 whereas μ2, μ3 and μ4 decreases to 0.To sum up, in the first step of the membership function values calculation, the number of maxima is checked. The number of clear peaks is the distinctive feature. The measure of the grade of distortions x, the relative measures of a minima values h1, h2 and the measures of the niche surfaces p1, p2 and p3 determine how many maxima constitute clear peaks. Definitions of these parameters imply properties of the membership functions μ1, μ2, μ3, and μ4. These parameters are the basis on which variables that are used in the membership functions algebraic formulae, are defined. The membership functions are calibrated in such a way that their asymptotic properties are consistent with expected properties of the membership of the recognized histograms to the specified classes.As it has been already mentioned, the introduced algorithmic method of the classes description and their membership functions definition has been applied for selection the high quality CT scan heart slices in order to create the ultrasound simulator. Fifty CT scan heart slices have been given as the data set. Each image has been evaluated by an expert as a high quality or a low quality image – column quality in Table 1. Then, the image brightness histogram has been created and its membership functions values have been calculated by using formulae (11).In order to obtain the precise rules of the final classification we followed the paper [26] in which explicit formulae for modifiers calculation are given. According to [26] we have:(12)Smfalse=(b−a)n4,for n∈[0, 1],(13)Smtrue=(b−a)(n−1)nfor n∈[2, +∞) and(14)St=(b−a)n4,for n∈[1, 2], where Smtrue, Smfalseand Stare areas under the membership functions. The value n corresponds to the modifier m. The interval [2, +∞) characterizes the terms with a linguistic truth value greater than or equal to true, whereas [0, 1] characterizes the terms with a linguistic truth value less than or equal to false, and that (1, 2) allows all the possible variants between true and false to be expressed. Thus, in our problem for n=1 we identify the label false with an area(15)Smfalse=(π/2)−0)·14=π8≈0.39.whereas for n=2 we identify the label true with an area(16)Smtrue=(π/2)−0)·(2−1)2=π4≈0.78.The borders of the defined modifiers are shown in Fig. 10. This means that, according to the used modifiers, the image clearly belongs to the ith class if the value of its membership function μi≥0.78. In order to introduce approximate membership in the final classification let us apply the root square as a standard dilation operator. The image will be classified as approximately belonging to the ith class ifμi≥0.78.The values of membership functions describing unimodal, bimodal, three-modal and multi-modal classes, calculated for a given CT image, are presented in Table 1 in columns 1-mod, 2-mod, 3-mod and multi-mod respectively. According to the applied modifiers, the decision rules describing the final classification of the examined CT images can be described in the following way:if μi≥0.78 then the image clearly belongs to the ith class;if0.78>μi≥0.61≈0.78then the image almost belongs to the ith class;if 0.61>μi>0.39 then the classification to the ith class is unclear;if 0.39≥μithen the image does not belongs to the ith class.The results of classification is presented in Table 1 in column classification. The high quality image selection is based on the aforementioned fact that the image quality refers strongly to its number of peaks – the high quality images histograms are three-modal ones – see Figs. 7 and 8. The results of classification based on histogram structure are shown in the column selection of Table 1. It can be seen that the fuzzy selection is absolutely consistent with the one done by an expert. Examples of various quality heart images with its brightness histogram transformed according to the proposed algorithm are shown in Fig. 11. The computed values of the membership functions calculated on the basis of the images brightness histograms are given as well.As it has been aforementioned, the selection of high quality CT scan heart slices is a crucial point in the first stage of creation of an ultrasonography simulator. A structural analysis of their brightness histograms, considered as function-type curves, turned to be an effective tool for such selection. The source data show that the image quality depends strongly on the structural properties of its histogram i.e. an image has high quality if and only if its histogram is clearly three-modal. Furthermore, the proposed fuzzy evaluation, based on brightness histograms classification, allows us to recognize histograms corresponding to the high quality images with one hundred percent efficiency. It should be also stressed that in the proposed approach, loading the whole data set is not necessary – the evaluation can be done on the side of database. Therefore, such method allows us to search the base in short time and quick sort of the CT scan heart slices according to their quality. The experiment showed that the fuzzy selection is absolutely consistent with the one done by an expert – see Table 1. It should be mentioned that, in general, the presented CT scan heart slices analysis is located in the important stream of application of artificial intelligence methods to medical images processing and analysis – papers [5–8,21,23,34–36,54] can be put as examples.The analysis of the considered histograms has been performed as an application of a very general approach to construction fuzzy pattern classification systems. The theoretical frame that has been worked out and proposed in Section 3 is one of the main results of this paper as well.

@&#CONCLUSIONS@&#
