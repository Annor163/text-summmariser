@&#MAIN-TITLE@&#
Electricity market clearing with improved scheduling of stochastic production

@&#HIGHLIGHTS@&#
Day-ahead markets should not be cleared with the expected stochastic production.The stochastic dispatch maximizes market efficiency, but producers may incur losses.The conventional dispatch is revenue adequate per scenario.A bilevel program determines the optimal stochastic production schedule.The optimal schedule makes the conventional dispatch closer to the stochastic ideal.

@&#KEYPHRASES@&#
OR in energy,Electricity market,Stochastic programming,Electricity pricing,Wind power,Bilevel programming,

@&#ABSTRACT@&#
In this paper, we consider an electricity market that consists of a day-ahead and a balancing settlement, and includes a number of stochastic producers. We first introduce two reference procedures for scheduling and pricing energy in the day-ahead market: on the one hand, a conventional network-constrained auction purely based on the least-cost merit order, where stochastic generation enters with its expected production and a low marginal cost; on the other, a counterfactual auction that also accounts for the projected balancing costs using stochastic programming. Although the stochastic clearing procedure attains higher market efficiency in expectation than the conventional day-ahead auction, it suffers from fundamental drawbacks with a view to its practical implementation. In particular, it requires flexible producers (those that make up for the lack or surplus of stochastic generation) to accept losses in some scenarios. Using a bilevel programming framework, we then show that the conventional auction, if combined with a suitable day-ahead dispatch of stochastic producers (generally different from their expected production), can substantially increase market efficiency and emulate the advantageous features of the stochastic optimization ideal, while avoiding its major pitfalls.A two-node power system serves as both an illustrative example and a proof of concept. Finally, a more realistic case study highlights the main advantages of a smart day-ahead dispatch of stochastic producers.

@&#INTRODUCTION@&#
The penetration of stochastic production in electric energy systems is notably increasing worldwide, primarily owing to a booming wind power industry. There is a broad consensus in the research community that today’s electricity market designs are to be revisited so that stochastic producers can enter the competition in a fair and efficient manner.In its most basic form, an electricity market consists of a forward (typically day-ahead) market and a balancing market. On the one hand, the day-ahead market is required to accommodate the generation from the inflexible power plants, i.e., from those generating units that need advance planning in order to efficiently and reliably set their production levels. On the other, the balancing market clears the energy deployed to maintain the constant balance of supply and demand over periods of time with finer resolution, commonly spanning from minutes to one hour. Being cleared shortly before real time, balancing markets allow the trade of energy between flexible firms, which can adjust their output quickly, and stochastic producers, whose generation is predictable only with limited accuracy at the day-ahead stage.Conventionally the day-ahead and the balancing markets are settled independently. Furthermore, with respect to the participation of stochastic producers, the day-ahead market is typically cleared considering their expected production at a very low marginal cost (e.g., zero). The eventual energy adjustments needed to cope with the associated forecast errors are left then to the flexible units participating in the balancing market. Consequently, if this market is not provided with enough flexible capacity, balancing costs may escalate dramatically. It is expected that this problem becomes exacerbated as the penetration of stochastic production increases (Holttinen, 2005; Doherty & O’Malley, 2005; Helman et al., 2010).To face this challenge, two main solution strategies have been considered, namely:1.To establish reserve markets, where flexible capacity is procured sufficiently in advance of energy delivery and then made available to the balancing market, where it is dispatched if needed. The reserve demand in these markets is exogenously specified by the Transmission System Operator, which opens up a number of different ad hoc criteria, see e.g. Ela, Milligan, and Kirby (2011).To clear the forward market using stochastic programming (Birge & Louveaux, 2011), which allows modeling future balancing needs and costs in a probabilistic framework, thus yielding the day-ahead energy dispatch that minimizes the expected system operating costs. One of the major advantages of this approach is that it endogenously solves for the optimal amount of reserve capacity to be left to the balancing market, weighing the expected costs and benefits of such capacity (Galiana, Bouffard, Arroyo, & Restrepo, 2005; Bouffard & Galiana, 2008; Morales, Conejo, & Pérez-Ruiz, 2009; Papavasiliou, Oren, & O’Neill, 2011).Ideally, the stochastic solution method attains maximum market efficiency (as it minimizes the expected system operating cost) and therefore, it is used here as a reference in this respect. For its practical application within a market environment, though, it must be first complemented with a set of prices and payments that make market participants satisfied with the resulting day-ahead dispatch. In this vein, Galiana et al. (2005) and Wong and Fuller (2007) define prices for both energy and reserve capacity. However, determining who should pay for such reserve and to which extent is still a major source of conflict and debate (Hogan, 2005).In this paper, we follow the approach of Pritchard, Zakeri, and Philpott (2010) and Morales, Conejo, Liu, and Zhong (2012), where the stochastic dispatch is supported by energy prices only. However, this approach is not without its problems either. Indeed, Morales et al. (2012) illustrate that the energy-only market settlement associated with the stochastic dispatch requires flexible producers to accept losses for some realizations of the stochastic production, which also raises concerns on its practical applicability.Starting from this point, the objective of this paper is to show that, if cleared with an appropriate value of stochastic production, generally different from the expected value, the conventional settlement of the day-ahead market can notably approach the behavior of the ideal stochastic dispatch, while sidestepping its theoretical drawbacks. For this purpose, we construct a bilevel programming formulation that determines the optimal value of stochastic production that should be used to clear the day-ahead market under the conventional settlement.The rest of this paper is organized as follows. Section 2 presents the conventional and stochastic dispatch models that we use as references in our work, and provides the mathematical insight to calculate the optimal day-ahead schedule of stochastic production under the conventional market settlement. Section 3 discusses results from a small example and a case study. More specifically, the example serves to illustrate the different dispatch models, which are subsequently compared and tested using a more realistic setup in the case study. Lastly, Section 4 concludes the paper.Consider the sequence of a day-ahead and a balancing market. The day-ahead market is cleared on dayd-1(e.g., by 10am) and covers energy transactions for delivery on day d, typically on an hourly basis. The balancing market settles the energy imbalances with respect to the day-ahead production and consumption schedule. These imbalances are computed throughout day d, usually over time intervals ranging from minutes to 1h.Let us begin by outlining a standard model for the dispatch of energy. This will serve to present the notation and provide a starting point for the developments of the rest of the paper. The setting will be an electric power system comprising a collection N of nodes.LetpGandpWdenote the vectors of decisions on the day-ahead dispatch of conventional and stochastic producers, respectively. For simplicity and without loss of generality, the demand at each node n of the system,ln, is considered to be known with certainty. As we will clarify later, though, the following discussion also holds in the case that demand is elastic or uncertain, provided that the dispatch model below is linear. We also assume that power flows in the transmission network are determined by the vectorδ0of nodal voltage angles.The conventional economic dispatch model (ConvDM) identifies the optimal schedulepG∗,pW∗that minimizes day-ahead generating costs,CD(pG,pW), as follows:(1a)MinimizepG,pW,δ0CDpG,pW(1b)s.t.hDpG,pW,δ0-l=0:λD,(1c)gDpG,δ0⩽0,(1d)pW⩽W^,whereW^is the forecast vector of stochastic production. The equality constraints (1b) enforce the day-ahead balancing conditions, stating that the dispatch plus the net power flow equals the demand at each node. The inequalities (1c) include upper and lower bounds to the dispatch of conventional producers and scheduled power flows, as well as declarations of non-negative variables. Constraints (1d) limit the day-ahead schedule of stochastic producers to their expected generation.The dispatch model (1) can be understood as a network-constrained auction that follows a least-cost merit-order principle, i.e., the cheapest generators are dispatched first. Consequently, because stochastic producers enter the market with very low or zero marginal cost, their dispatch up to the forecast meanW^is prioritized (provided that the network allows for it). Note that we have intentionally made the cost functionCD(·)in (1a) dependent onpWto cover the more general case in which the marginal cost of stochastic production is considered different from zero.Notice that the vector of dual variables associated with constraint (1b), which is indicated in (1) byλD, constitutes the vector of day-ahead locational marginal prices.Once the optimal day-ahead schedulepG∗,pW∗has been obtained from (1), the balancing market must deal with the energy imbalance caused by the stochastic production. Consider a specific realization vector of this production, denoted byWω′. The energy imbalance is then given byWω′-pW∗, which represents a surplus of generation, if positive, or a shortage, if negative. To accommodate an excess of production, several actions may be taken, namely:•To decrease the power production of flexible generating units. In market terms, this is equivalent to say that flexible producers repurchase a certain amountrω′-of energy in the balancing market.To spill a partWω′spillof the stochastic production.To increase the power output of flexible units, which is equivalent to say that flexible producers sell an additional amountrω′+of energy in the balancing market.To shed a portionlω′shedof the demand. This action is, in general, very costly, as the so-called value of lost load is normally very high.It should be noticed that the previous decision vectorsrω′-,rω′+,Wω′spill, andlω′shedhave been intentionally augmented with the subscriptω′to underline their implicit dependence on the specific realizationWω′of stochastic production. For ease of presentation, we group all these decision variables into one single vectoryω′(the notation introduced here will become relevant later on in the illustrative example of Section 3). Thus, the vectoryω′∗that minimizes the cost of balancing the energy deviationWω′-pW∗is the solution to the following optimization problem:(2a)Minimizeyω′,δω′CByω′(2b)s.t.hByω′,δω′,δ0∗+Wω′-pW∗=0:λω′B,(2c)gByω′,δω′,pG∗;Wω′⩽0,whereδω′is the vector of nodal voltage angles at the balancing stage. The equality constraints (2b) ensure that generating units and loads are redispatched so that the system remains in balance. The vectorλω′Bof dual variables associated with these constraints define the locational marginal prices at the balancing market. Similarly to (1c), the inequalities (2c) comprise upper and lower bounds on the re-dispatch of generating units, load shedding, wind spillage, actual power flows, and declarations of nonnegative variables.If we now denote the optimal vector of balancing actions byyω′∗, the overall cost of operating the power system under the realizationWω′of stochastic production is given byCDpG∗,pW∗+CByω′∗.It is important to stress that both constraints (2b) and (2c), and hence also the balancing costsCByω′, are dependent on the optimal day-ahead schedulepG∗,pW∗,δ0*. Since the conventional dispatch model (1) is blind to such dependency, the market becomes more and more inefficient as the penetration of stochastic production increases. In this vein, the stochastic dispatch model presented next intends to capture precisely the interaction between day-ahead and balancing decisions.Finally, it should be mentioned that the conventional dispatch model is generally run with a reserve market on the side, which can be cleared either prior to, after, or simultaneously to the day-ahead energy market (Stoft, 2002; Kirschen & Strbac, 2004). However, our following discussion assumes an energy-only electricity market, as this allows us to illustrate and compare more clearly the features of the considered dispatch models.Consider that the electricity production from stochastic producers can be efficiently modeled by a finite setΩof scenarios, each characterized by a vector of power valuesWωand a probability of occurrenceπω. It must hold thatπω⩾0, for allω∈Ω, and∑ω∈Ωπω=1. The scenario setΩis assumed to be available to the Transmission System Operator.The stochastic dispatch model writes as follows:(3a)MinimizepG,pW,δ0;yω,δω,∀ωCDpG,pW+EωCByω(3b)s.t.hDpG,pW,δ0-l=0:λD,(3c)gDpG,δ0⩽0,(3d)pW⩽W‾,(3e)hByω,δω,δ0+Wω-pW=0,∀ω∈Ω,(3f)gByω,δω,pG;Wω⩽0,∀ω∈Ω,whereW‾is the vector of capacities of stochastic producers andEω[·]is the expectation operator over the scenario setΩ. Notice that, based on this set, the dispatch problem (3) explicitly models and thus anticipates the balancing operation of the power system by means of constraints (3e) and (3f) and the expectation of the balancing costs in the objective function (3a). This way, the stochastic programming problem (3) yields the day-ahead dispatchpG∗,pW∗that maximizes market efficiency, provided that the scenario setΩis properly constructed. As we shall see later, according to (3), flexible producers may be dispatched out of merit order in the day-ahead market to provide the power system with sufficient flexible capability to cope with the energy imbalances caused by stochastic producers in real time.Finally, notice that formulation (3) makes the day-ahead priceλDavailable to us as the dual variable of Eq. (3b). Furthermore, by enforcing (3b) and (3c), separately from (3e) and (3f), we guarantee a feasible day-ahead dispatch.In an attempt to increase the performance of the conventional dispatch model (1), we address now the following question: Which valuepWmaxshould the forecast vectorW^in(1d)be replaced with to maximize market efficiency? The answer to this question is naturally given by the following bilevel programming problem (Vicente & Calamai, 1994; Dempe, 2002):(4a)MinimizepG,pW,δ0,pWmax;yω,δω,∀ωCDpG,pW+EωCByω(4b)s.t.hByω,δω,δ0+Wω-pW=0,∀ω∈Ω,(4c)gByω,δω,pG;Wω⩽0,∀ω∈Ω,(4d)0⩽pWmax⩽W‾,(4e)pG,pW,δ0∈argMinimizexG,xW,θCDxG,xW(4f)s.t.hD(xG,xW,θ)-l=0:λD,(4g)gDxG,θ⩽0,(4h)xW⩽pWmax.The lower-level problem (4e)–(4h) is equivalent to the conventional dispatch (1), except for the upper bound of the day-ahead schedule of stochastic producers in (4h), which is, in this case, endogenously computed by the upper-level problem (4a)–(4d) to minimize the sum of day-ahead dispatch costs and the expected balancing costs. Notice that the upper-level decision variablepWmaxhas an impact on the lower-level decision variablespG,pW, andδ0, which in turn influence the expected total system cost through Eqs. (4a)–(4c). Consequently, the bilevel model (4) manages to dispatch the stochastic producers on the basis of the cost of their uncertainty, which is estimated by (4a)–(4d), while the traditional least-cost merit-order principle that characterizes ConvD still applies to the conventional producers.If the conventional dispatch model (1) is linear—note that this includes the family of dispatch models that consider piecewise linear supply costs functions, piecewise linear demand utility functions, a DC power-flow network model, a piecewise linear approximation of the transmission losses, ramping constraints, etc. (see e.g. Motto, Galiana, Conejo, & Arroyo, 2002)—the lower-level problem (4e)–(4h) can be replaced by its KKT conditions, thus resulting in a mathematical program with equilibrium constraints (Luo, Pang, & Ralph, 1996; Gabriel, Conejo, Fuller, Hobbs, & Ruiz, 2012). In turn, the associated complementarity conditions can be recast using the equivalent mixed-integer formulation proposed by Fortuny-Amat and McCarl (1981). The steps required to transform a bilevel programming problem of the type of (4), with a linear lower level, into a manageable single-level optimization problem are well known in the technical literature (see e.g. Fernández-Blanco, Arroyo, & Alguacil, 2012) and are omitted here for conciseness. However, this transformation is illustrated later, in Section 3, using a small example.For ease of comparison, the short form “ImpD” is used to refer to the conventional dispatch model (1) whereW^in (1d) is replaced with the optimal value ofpWmaxthat results from (4).Lastly, it should be noticed that both StochD and ImpD assume that producers’ bids to the balancing market are known at the time of clearing the day-ahead market. This information is needed to compute the expectation of the balancing costs in (3a) and (4a), respectively, and thus improve the overall market efficiency under a high penetration of stochastic generation (Bouffard & Galiana, 2008; Pritchard et al., 2010; Morales et al., 2012).We now introduce a standard settlement scheme whereby market participants are paid for energy only.Consider a certain market participant k and defineEkDas the amount of energy sold (if positive) or purchased (if negative) in the day-ahead market, andEkω′Bas the amount of energy sold (if positive) or purchased (if negative) in the balancing market in scenarioω′. These quantities are directly derived from the power schedule that is solution to the dispatch model under consideration. The payment to (if positive) or from (if negative) market participant k under scenarioω′is then given by(5)λs(k)DEkD+λs(k)ω′BEkω′B,wheres(k)indicates the node where market participant k is located. The locational day-ahead market priceλs(k)Dis obtained from either ConvD, StochD, or ImpD, while the locational balancing market priceλs(k)ω′Bis computed from (2) after the day-ahead market is cleared and the actual realizationω′of the stochastic production becomes known.Morales et al. (2012) shows that, if generating units are fully dispatchable from zero to their maximum capacities (the problem of pricing in markets with non-convexities is not treated here; see e.g. Bjørndal & Jörnsten (2008) for further information on this topic), the energy-only settlement scheme (5) under the stochastic dispatch model (3) guarantees cost recovery for flexible producers only in expectation. This expectation is, besides, contingent on the probabilistic characterization of the stochastic production at a market-wide level, which is in possession of the TSO and out of the control of the individual producers. Furthermore, we show in the illustrative example of Section 3 that StochD may actually dispatch flexible units in the day-ahead market in a loss-making position.On the contrary, the conventional dispatch model, either in the traditional form of ConvD or in the variant ImpD proposed in this paper, ensures cost recovery for flexible producers for any possible realization of the stochastic production.

@&#CONCLUSIONS@&#
This paper deals with the clearing of a day-ahead electricity market that includes a significant number of stochastic producers. Our study uses two reference models for generation scheduling: on the one hand, a conventional network-constrained auction based on a least-cost merit order for dispatch, where stochastic generation enters with its expected production and a very low marginal cost; on the other, a full stochastic dispatch method that maximizes market efficiency by anticipating balancing costs. The conventional dispatch may turn out to be very uneconomical, while the stochastic one leads to an energy-only market settlement that does not guarantee cost recovery for flexible producers in some scenarios.We show that the conventional auction, if cleared with an appropriate value of stochastic production, generally different from the mean, can significantly approach the stochastic dispatch ideal. We construct a bilevel program that optimally computes this value. Our analysis prompts two fundamental conclusions, namely:1.Current day-ahead markets should not clear the expected stochastic production by default. There is indeed room for substantial improvement in market efficiency by abandoning this practice, in particular in those markets with a high share of stochastic generation.The amount of stochastic production to be cleared in the day-ahead market should be driven not only by the marginal cost of stochastic generation, which is usually very low or zero, but also by the cost of its uncertainty, understood as its economic impact due to system balancing.As future research, it is necessary to develop computationally efficient methods that allow us to determine a day-ahead schedule for stochastic producers better in terms of market efficiency than their expected power outputs without having to directly solve a computationally costly bilevel program. Likewise, the idea introduced in this paper is compatible with the implementation of reserve capacity markets or the flexible ramping products that are currently under development in CAISO (Abdul-Rahman et al., 2012) and Midwest ISO (Navid & Rosenwald, 2012). The combination of these strategies may bring current market efficiency closer to the full stochastic optimization ideal.