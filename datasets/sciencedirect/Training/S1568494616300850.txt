@&#MAIN-TITLE@&#
An adaptive modeling and asset allocation approach to financial markets based on discrete microstructure model

@&#HIGHLIGHTS@&#
An adaptive modeling and trading approach to financial time series is proposed based on DTMS model.A hybrid optimization method is proposed to estimate parameters of DTMS model.The adaptive modeling-based asset allocation method may obtain satisfactory investment return.

@&#KEYPHRASES@&#
Market microstructure model,Parameter estimation,Receding horizon optimization,Particle swarm optimization,Asset allocation,

@&#ABSTRACT@&#
In previous works, it was verified that the discrete-time microstructure (DTMS) model, which is estimated by training dataset of a financial time series, may be effectively applied to asset allocation control on the following test data. However, if the length of test dataset is too long, prediction capability of the estimated DTMS model may gradually decline due to behavior change of financial market, so that the asset allocation result may become worse on the latter part of test data. To overcome the drawback, this paper presents a semi-on-line adaptive modeling and trading approach to financial time series based on the DTMS model and using a receding horizon optimization procedure. First, a long-interval identification window is selected, and the dataset on the identification window is used to estimate a DTMS model, which will be used to do asset allocation on the following short-term trading interval that is referred to as the trading window. After asset allocation is over on the trading window, the length-fixed identification window is then moved to a new window that includes the previous trading window, and a new DTMS model is estimated by using the dataset on the new identification window. Next, asset allocation continues on the next trading window that follows the previous trading window, and then the modeling and asset allocation process will go on according to the above steps. In order to enhance the flexibility and adaptability of the DTMS model, a comprehensive parameter optimization method is proposed, which incorporates particle swarm optimization (PSO) with Kalman filter and maximum likelihood method for estimating the states and parameters of DTMS model. Based on the adaptive DTMS model estimated on each identification window, an adaptive asset allocation control strategy is designed to achieve optimal control of financial assets. The parameters of the asset allocation controller are optimized by the PSO algorithm on each identification window. Case studies on Hang Seng Index (HSI) of Hong Kong stock exchange and S&P 500 index show that the proposed adaptive modeling and trading strategy can obtain much better asset allocation control performance compared with the parameters-fixed DTMS model.

@&#INTRODUCTION@&#
Financial markets generally present strong randomness, nonlinearity and stochastic volatility. Many researches on financial time series have been developed and are mainly to find the feature of some financial time series and to predict buying/selling assets to obtain high returns. Some researches capture the stochastic features of a time series by extracting a set of fuzzy rules or relying on probabilistic reasoning [1,2]. Some mathematical models have been applied to characterize the financial markets and predict their returns [3,4]. For instance, AR (autoregressive) model [5] and its extended models (e.g. ARMA (autoregressive moving-average) model and ARIMA (autoregressive integrated moving-average) model) [6,7] were used to model and predict the returns in econometrics, financial economics and microeconomics. ARCH (autoregressive conditional heteroskedasticity) model [8,9], GARCH (generalized autoregressive conditional heteroskedasticity) model [10,11] and SV (stochastic volatility) model [12], which use different volatility equation to present the time-varying process of the variance of return, were proposed to model the volatility of returns. Neural network models [13,14] were also applied to describing the nonlinearity of financial time series because of their good function approximation. However, these models mentioned above mainly focus on modeling the dynamics of asset price or its return itself and especially its conditional variance.Recently, some economists and physicists have begun to explore the dynamic mechanism of market price-varying processes. In fact, it is necessary to deal with the dynamics of a financial market from microscopic point of view. Some researchers have proposed phenomenological models by identifying different processes influenced by the demand and supply of the market. One of the most interesting of these models is the microstructure model proposed by Bouchaud and Cont [15], which is on the basis of market microstructure theory [16] and presents the relationship between price, excess demand and liquidity of a market. This model provides an abstract description for market price driven by market liquidity and excess demand. However, the two market variables (market liquidity and excess demand) are unobservable and would not be easily measured directly. If the two hidden variables can be estimated from an observable price series, it would help investors make buying or selling decision to obtain higher return. Based on this modeling theory, Iino and Ozaki [17] expanded this model and built three continuous time stochastic differential equations to describe the relationship of market price, excess demand and liquidity, which was called the continuous time microstructure (CTMS) model. Peng et al. [18] improved the diffusion term of price in the continuous model. Its corresponding discrete time microstructure (DTMS) model was proposed by Peng et al. [19] using Euler discretization method. Some improvements of the discrete microstructure model were also presented in [20,21]. The previous works mainly apply Kalman filtering and the maximum likelihood method to estimate the model parameters by training dataset of a financial time series, and then use the identified microstructure model to recursively predict the market excess demand and liquidity and make investment decisions based on the predicted information on the following test data. However, if the length of test dataset is too long, the built model may not characterize the latest data sufficiently, so that the model prediction precision and the model-based asset control performance may gradually decline over time. Therefore, it is important to timely update the model to allow it to describe the dynamics of the changing financial market.Moving window method is an advisable choice for overcoming the above problem. Peng et al. [22] used moving window technique to build an AR model with time-varying coefficients for fitting finance time series, which improved the ability of predicting the expected return and variance of a portfolio. Gao et al. [23] proposed a windowing-based random weighting method to fit the systematic model errors and the covariance matrices of observation vector in Kalman filtering method, and predicted the state vector within a moving window, which can effectively resist the disturbances of systematic model errors on system state estimation. McAlister et al. [24] used a five-year moving window to examine the impact of a firm's advertising and research-development (R&D) on its systematic risk, and concluded that the two market manifestations lower systematic risk of the firm's stock. The moving window method is an on-line approach.In this paper, from the viewpoint of improving adaptability of a model and on the basis of the previous works, we design two moving windows: a long-interval identification window on which the dataset is used to estimate a DTMS model, and a short-interval trading window on which the dataset is used to do asset allocation on the basis of the estimated DTMS model. After asset allocation is over on the trading window, the length-fixed identification window is then moved to a new window that contains the previous trading window, and then a new DTMS model is estimated by using the updated dataset. Next, asset allocation is continued on the next trading window that follows the previous trading window as well as the new identification window. Thus, the modeling process will be repeated for the updated dataset, and a set of DTMS model will be built over time and their parameters will be optimized successively. These models with time-varying parameters are referred to as the adaptive DTMS (ADTMS) models. Furthermore, asset allocation process will be carried out successively according to the above steps. The modeling and trading process is a receding horizon optimization procedure [25,26] and is also a semi-on-line adaptive approach. For each ADTMS model in the adaptive modeling process, the parameters and the initial value of conditional mean, conditional variance and state variables are all estimated by a hybrid algorithm proposed in this paper, which incorporates PSO (particle swarm optimization algorithm) [27], the Kalman filter and the maximum likelihood method. This estimation method is very flexible and can automatically search for the optimal parameters within the setting span. Furthermore, a modeling evaluation approach is reported based on the feature of the estimated market excess demand and liquidity, which may eliminate some unreasonable modeling results to ensure the acquired model more appropriate for characterizing financial time series.The purpose of building a financial model is to obtain more effective information of financial markets and to predict the market price better and to achieve the optimal asset allocation. Theoretically and practically, asset allocation is a very interesting issue for investors. One of key problems is still to forecast the returns. Markowitz's mean-variance theory is a well known portfolio method, and it achieves asset allocation by maximizing investment return and minimizing investment risk [22,28–30]. The prediction of return on assets may be gotten based on the AR [22,31], ARCH, GARCH and SV model [10,11]. In general, the predictive error of asset price is close to a white noise with zero mean due to the randomness of financial markets. Usually, it is not easy to acquire satisfactory dynamic allocation results based on the predicted price. Dourra and Siy [32], Sevastianov and Dymova [33] and Michalak [34] applied a fuzzy logic technique to construct an experts trading knowledge base and carry out the assets allocation. From the estimated DTMS model, one can obtain information about future market trend provided by the directly-immeasurable excess demand, which shows much better stability than the market trend information obtained from the prediction of price itself, so the assets allocation based on the predicted excess demand may acquire higher profits. Peng et al. [19] achieved the effective assets allocation based on the identified excess demand. In this paper, based on the prediction of the excess demand obtained from the proposed ADTMS model that is estimated on each identification window, an adaptive dynamic asset allocation strategy, which optimizes the allocation threshold parameters by PSO algorithm on each identification window and controls the proportion of buying/selling assets on the trading window, is applied to enhance investment returns.Finally, some examples utilizing the adaptive modeling and dynamic asset allocation strategy for real financial data, such as Hong Kong stock exchange and S&P 500 index, are studied. Comparing with the previous method, the proposed adaptive modeling and asset allocation method may make the updated model over time capture the dynamics of stock prices better, and may also make the new model-based asset control obtain higher profit.Market microstructure model is proposed by Bouchaud and Cont [15] based on market microstructure theory [16]. It is one of phenomenological models and may capture the dynamics of a financial time series by representing the relationship between price, excess demand and market liquidity in a financial market.The continuous time microstructure model [17,18] using the stochastic differential equation to describe the relationship of asset price, excess demand and liquidity is given as follows(1)dPt=ϕteσtdt+γ3eσt/2dW1,tdϕt=(α1+β1ϕt)dt+γ1dW2,tdσt=(α2+β2σt)dt+γ2dW3,twhere Ptis the price, ϕtis the excess demand that is the difference between the demand and supply, which also indicates whether the market is under-valued (ϕt>0, which tends to push the price up) or over-valued (ϕt<0, which tends to push the price down), eσt/2 is the stiffness and its inverse represents the market liquidity, which is always positive; W1,t, W2,tand W3,tare three independent Wiener processes; α1, α2, β1, β2, γ1, γ2 and γ2 are all constant parameters. Model (1) is a continuous-time microstructure (CTMS) model and implies that the price Ptis driven by the excess demand ϕt, and the amplitude of price changes is dependent on the liquidity of the market, i.e. e−σt. Therefore, if the liquidity is lower, or the stiffness is larger, a smaller excess demand may lead to larger price changes, whereas when the liquidity is higher, the price of the market may not swing away too much from the present price whether the market is over-valued or under-valued.In model (1), the excess demand and market liquidity are the hidden immeasurable state variables. This model also expresses the variation of conditional variance of the price by the change of market liquidity. Such a relation between the liquidity and the conditional variance is a natural feature of the market mechanism. Therefore, from model (1), one can gain more useful information about the internal characteristics of a price-varying process than gained just by looking at the price data itself or its prediction.Model (1) may be approximated by using Euler discretization method, and the discrete-time microstructure (DTMS) model [19] is presented as follows(2)Pk=Pk−1+ϕk−1eσk−1+γ3eσk−1/2ξ1,kϕk=α1+(1+β1)ϕk−1+γ1ξ2,kσk=α2+(1+β2)σk−1+γ2ξ3,kwhere ξ1,k, ξ2,kand ξ3,kare independent standard normal distributed random variables, i.e. ξj,k∼N(0, 1) j=1, 2 or 3, the other parameters and variables are the corresponding discretization of parameters and variables in model (1). One can see that model (2) is actually a stochastic volatility (SV) model, and various SV models have been widely used to analyze financial time series. Different to general SV model, model (2) can exhibit not only the stochastic volatility behavior of a market but also the physical mechanism of driving price change. In model (2) the noise variance of price Pkis stochastic and time-varying, and depends on the market liquidity.From model (2), one can also see that the change of price, ΔPk=Pk−Pk−1 is driven by excess demand ϕk−1 and (inverse of) liquidity eσk−1. The liquidity eσk−1is positive, so the change trend of price is mainly reflected by excess demand ϕk−1. Therefore, it may be inferred that the curve of excess demand could be smoother than that of ΔPk=Pk−Pk−1, and then a trading strategy based on the excess demand could obtain better control results than that based on the prediction of price. If excess demand and market liquidity can be well estimated from the historical price data, these estimates will help us effectively control the proportion of selling/buying financial assets. A critical problem here is how to implement the estimation using the past price data. Ozaki et al. [35] used the local linearization technique to estimate continuous model (1). Peng et al. [19] estimated model (2) by using Nelder–Mead optimization method, the Kalman filter and the maximum likelihood method.Because the parameters of model (2) are constant and financial market is highly random, with the increase of recursion step, the precision of the identified model-based prediction may decline even though model (2) can be estimated accurately. Therefore, this paper presents an improved modeling strategy and estimation method, which apply a moving window method so as to update the model parameters using the latest data. In the method, the estimated model on the identification window is only used for forecasting and filtering asset price, excess demand and market liquidity on the following trading window, then the identification window is moved to a new window containing the previous trading window, and the trading window is also updated. Next, a new identification process is carried out. Thus, a set of DTMS models will be built and their parameters will vary with the move of windows, so we refer to them as the adaptive DTMS (ADTMS) models. Each estimated ADTMS model is able to contain more information about recent data and to characterize the market better. It may be inferred that, compared with the previous single modeling method, the forecast accuracy based on the continually updated model should increase substantially.Consider the ith identification window with Ntr data points (i.e. the identification window width is Ntr), and the ith trading window with Nte data points (i.e. the trading window width is Nte). The representation of the ADTMS model may be given as follows(3)Pi,k=Pi,k−1+ϕi,k−1eσi,k−1+γi,3eσi,k−1/2ξi,1,kϕi,k=αi,1+(1+βi,1)ϕi,k−1+γi,1ξi,2,kσi,k=αi,2+(1+βi,2)σi,k−1+γi,2ξi,3,kwhere subscript i denotes the ith ADTMS model, k(k=1, 2, …, Ntr) denotes the kth trading date in the identification window. All parameters and variables in model (3) are the corresponding parameters and variables of the ith ADTMS model, whose definition are the same as previously described in (2).To estimate model (3) by using a hybrid optimization method combining Kalman filtering technique, we need to build a state space model with state observability. First, define the state vectorXi,k=Pi,kϕi,kσi,kT, then the state equation of the ith ADTMS model (3) may be derived as follows:(4)Xi,k=Ai(Xi,k−1|θi)Xi,k−1+Ωi,k,Ωi,k∼N(0,Qi,k)where(5)Ai(Xi,k−1|θi)=1eσi,k−10αi,1Pi,k−11+βi,10αi,2Pi,k−101+βi,2Qi,k=diagγi,32eσi,k−1γi,12γi,22andθi=αi,1αi,2βi,1βi,2γi,1γi,2γi,3Tincludes all the constant parameters to be estimated in model (3). The ADTMS model (4) is a linear structure state-space model whose matrix elements are state-dependent, and is driven by Gaussian noise. This state space model (4) is obtained without calculating the derivative, so there is no any information loss in the modeling process. It differs from UKF (unscented Kalman filter) and EKF (extended Kalman filter). Therefore, the Kalman filter is applicable for the state estimation of ADTMS model (4).In state equation (4), only price Pi,kis observable and is regarded as observation variable. However, if the output equation includes only observation variable Pi,kso that only the conditional mean is considered, it is easy to check that the state space representation is state-unobservable. Therefore, it is necessary to extract more information on the observations by considering the conditional mean and also the conditional variance simultaneously so that the state-observability condition is satisfied. To this end, squaring both sides of the first equation in model (1), and noting that in the Ito mean square sense(6)(dt)2=0,(dw1,t)2=dt,dtdw1,t=0yields(7)(dPt)2=γ32eσtdtDiscretizing Eq. (7), it follows(8)(Pk−Pk−1)2=γ32eσkThen taking logarithms for both sides of Eq. (8), finally, one obtains(9)log[(Pk−Pk−1)2]=logγ32+σkBecause γ3 is a constant, we set another constant parameter δ to replacelogγ32, which may compensate the loss of Ito process and increase the flexibility of the parameters. Eq. (9) may be written as follows(10)log[(Pk−Pk−1)2]=δ+σkFurthermore, for real financial time series, it is possible that Pkis equal to Pk–1. Therefore it is necessary to avoid the problem of zero logarithms in Eq. (10). We use an approximation below suggested by Fuller [36] to deal with the problem in real cases.(11)log[(Pk−Pk−1)2]≈log[(Pk−Pk−1)2+ησP2]−ησP2(Pk−Pk−1)2+ησP2whereσP2is the sampling variance of Pk−Pk−1, and η is a constant.If Pkand log[(Pk−Pk−1)2] are regarded as two observation variables and relation (11) is applied, a state space representation of the ith ADTMS model (3) satisfying state observability condition could be built as follows(12)Xi,k+1=Ai(Xi,k|θi)Xi,k+Ωi,k+1,Ωi,k+1∼N(0,Qi,k+1)Yi,k=CXi,k+Ψi,k,Ψi,k∼N(0,Ri,k)whereXi,k=Pi,kϕi,kσi,kT,Yi,k=Pi,klog[(Pi,k−Pi,k−1)2]T,Ai(Xi,k|θi)=1eσi,k0αi,1Pi,k1+βi,10αi,2Pi,k01+βi,2,Ci(Xi,k|θi)=100δiPi,k01,Qi,k+1=γi,32eσi,k000γi,12000γi,22,Ri,k=εi,1200εi,22Here, ɛi,1 and ɛi,2 are constants and are the standard variance of two observation variables. The state space representation (12) is actually a locally Gaussian, locally linear and discretized model of continuous-time microstructure model (1) in the ith process. Furthermore, its system matrix Ai(Xi,k|θi), output matrix Ci(Xi,k|θi) and the variance Qi,k+1 of noise are dependent on the state vectorXi,k=Pi,kϕi,kσi,kTat time k. Therefore, model (12) is also called a state-dependent model. The corresponding adaptive estimation method for the parameters of the model is presented in Section 3.The very important problem is how to estimate model (12) through the observation data. It includes determining all constant parameters in the ith ADTMS model (12), and estimating the state Xi,kfrom the observation data using model (12). This is a type of nonlinear filtering problem. Peng et al. [19] used the maximum likelihood method and the Kalman filter to estimate the parameters and the state. In order to adapt to the modeling method with two moving windows, this paper proposes a hybrid estimation method, which combines PSO (particle swarm optimization) algorithm, Kalman filter and the maximum likelihood method. Furthermore, this paper also constructs an evaluation standard to choose more appropriate modeling results.First, for the ith ADTMS model, useAi(Xˆi,k|k|θi)andCi(Xˆi,k|k|θi)to approximate Ai(Xi,k|θi) and Ci(Xi,k|θi) at each step, respectively. Then letXˆi,k|k−1and Vi,k|k−1 denote the conditional mean and covariance of Xi,k,Γˆi,kbe the estimated innovation,Sˆi,kbe the covariance ofΓˆi,k, θibe the parameters vector including all the constant parameters to be estimated in the ith ADTMS model (12). Therefore, the prediction equation using the recursive Kalman filter is given as follows(13)Xˆi,k|k−1=Ai(Xˆi,k−1|k−1|θi)Xˆi,k−1|k−1Γˆi,k=Yi,k−Ci(Xˆi,k−1|k−1|θi)Xˆi,k|k−1Vi,k|k−1=Ai(Xˆi,k−1|k−1|θi)Vi,k−1|k−1Ai(Xˆi,k−1|k−1|θi)T+Qi,kand the filtering equations is(14)Xˆi,k|k=Xˆi,k|k−1+Ki,kΓˆi,kVi,k|k=[I-Ki,kCi(Xˆi,k−1|k−1|θi)]Vi,k|k−1Sˆi,k=Ci(Xˆi,k−1|k−1|θi)Vi,k|k−1Ci(Xˆi,k−1|k−1|θi)T+Ri,kKi,k=Vi,k|k−1Ci(Xˆi,k−1|k−1|θi)TSˆi,k−1In Eqs. (13) and (14), including the constant parameters of model (12), the initial state Xi,0|0, the initial conditional varianceVi,0|0=diagvi,1vi,2vi,3and the observation noise variance Ri,kalso need to be estimated. The parameters to be estimated areθi=αi,1αi,2βi,1βi,2γi,1γi,2γi,3δiPi,0ϕi,0σi,0vi,1vi,2vi,3εi,1εi,2T. Because the innovationΓˆi,kobeys Gaussian distribution in the Kalman filter, we may use the maximum likelihood method (ML) to obtain the estimation of θi, in which the likelihood function is set as the objective function.From Eq. (13), the estimated innovation of observation data {Yi,k;k=1, 2, …, Ntr} based on Xi,k|k−1 is given by(15)Γˆi,k=Yi,k−Ci(Xˆi,k−1|k−1|θi)Xˆi,k|k−1Γˆi,kis a 2-dimensional Gaussian white noise vector with covariance matrixSˆi,k, and its joint conditional density can be written as(16)p(Γi,k|Yi,k−1,…,Yi,1,θi)=12πSi,k(θi)1/2exp−12Γi,kT(θi)Si,k−1(θi)Γi,k(θi)where |•| denotes the determinant. Therefore, (-2)log-likelihood of model (13) can be derived as follows(17)f(θi)=(−2)logpYi,Ntr,…,Yi,1|θi=∑k=1Ntr(−2)logpYi,k|Yi,k−1,…,Yi,1,θi=∑k=1Ntr(−2)logpΓi,k|Yi,k−1,…,Yi,1,θi=∑k=1Ntr{log|Si,k(θi)|+(Γi,k(θi))T(Si,k(θi))−1Γi,k(θi)}+2Ntrlog2πThen one may obtain the optimal estimates of the parameters by minimizing the (-2)log-likelihood function(18)θi*=argminθif(θi)=argminθi∑k=1Ntr{log|Si,k(θi)|+(Γi,k(θi))T(Si,k(θi))−1Γi,k(θi)}+2Ntrlog2πIt is clear that the selection of the initial values of parameters and states in estimation of the microstructure model significantly affects the modeling performance. For the financial microstructure model (2), Peng et al. [19] applied the Nelder–Mead method to carry out the parameter optimization of (-2)log-likelihood function (18). If the initial values of parameters to be estimated are chosen appropriately, the gradient optimization may find the optimal parameters quickly. However, for a nonlinear optimization problem having many local extremum points, this method may pose a high risk of becoming stuck in a local optimum and obtains the global optimal solution with difficulty. A better approach could be a procedure that can globally search for the optimal parameters. Particle swarm optimization algorithm (PSO) is a evolutionary computing technology based on swarm intelligence methods and was proposed by Eberhart and Kennedy [37] in 1995. It is a robust and powerful optimization technique. Moreover, the optimization method does not require derivative of the objective function. Deb [38] investigated a population-based algorithm for parameter optimization, which divides the searching process into four independent tasks, i.e. selection, generation, replacement and update. In this paper, the used PSO method sets initial parameters and initial states of ADTMS model as particles, and the Kalman filter (13-14) and the maximum likelihood method are used to recursively obtain the states and parameters of the system. (-2)log-likelihood function of ADTMS model (12) is set as the fitness function of each particle. The fitness function of particle i is given in (17). The algorithm is implemented as follows.Algorithm 1The PSO algorithm combined with Kalman filter and ML methodStep 1. Initialization: Set the length of particle L, the size of population M, the inertia factor ω, the weight factor c1 and c2, and the limit velocity vmax and vmin that are determined by the active range of particle. For problem (18), θiis regarded as particle, and set L=16, M=50, ω=0.8, c1=2, c2=2. An initial population of particles, denoted asx→1,x→2,…,x→M, is produced in accordance with an uniform distribution that ranges over the problem space to represent a possible parameter set. Then, calculate particles’ fitness function f(θi) in (17) by using Kalman filter in (13-14) and maximum likelihood method; selectx→l(l=1,2,…,M)whose fitness value is smallest as the globally best solution, and it is denoted as gbest;x→1,x→2,…,x→Mis the individual best solution respectively, and they are denoted as pbestl(l=1, 2, …, M).Step 2. Generation: Record the particle’ s movement and then produce the next position of particlex→l. The process is given as follows.(19)vldt+1=wvldt+c1r1(pbestldt−xldt)+c2r2(gbestdt−xldt)vldt+1=vmax,d,ifvldt+1>vmax,dvldt+1=vmin,d,ifvldt+1<vmin,dxldt+1=xldt+vldt+1where r1 and r2 are random factors between 0 and 1, t is the generation;v→l=[vl1,vl2,…,vlL]Tis the moving velocity of particlex→l, which may be replaced by the arithmetic mean of the cumulative difference of historical best solution pbestldof particlex→l[39].(20)vldt=∑g=2t(pbestldg−pbestldg−1)t=vldt−1+(pbestldt−pbestldt−1)tStep 3. Replacement: Compute particles’ fitness function (17). If the fitness value of the new particle is reduced, i.e.f(x→lt+1)<f(x→lt), then it is replaced by the new particle, else no replacement will happen.Step 4. Update: Obtain the new pbest, gbest and the population.Step 5. Repeat the evolution process Steps 2–4 until the comprehensive evaluation indexes meet the following requirements (I–IV). The evaluation indexes (I–IV) are developed according to the physical feature of excess demand and market liquidity, and are presented as follows.(I)The set maximum number of generations was reached.The minf(θi) does not change for 20 generations.The excess demand is very smooth compared to the modeling residual.Market liquidity is not a very smooth curve.In the ith ADTMS model (3), the excess demand ϕi,krepresents the market's state and its plus/minus sign denotes the difference of supply and demand. That is, when ϕi,k>0, the market is under-valued or demand is larger than supply, and the price will be pushed up, so one should buy the financial product to increase the investor's total asset; if ϕi,k<0, the market is over-valued or demand is smaller than supply, and the price will be pushed down, so one should sell the financial product, such as stock, to avoid the loss of total assets. Peng et al. [19] has achieved effective assets allocation based on the identified excess demand information using a parameters-fixed DTMS model (2). In this paper, based on the predictionϕˆi,k+1|kof the estimated excess demandϕˆi,k|kby the ith estimated ADTMS model (3), an asset dynamic allocation control strategy with moving windows is applied to determine to buy/sell assets as follows(21)ωi,k+1,s=1,ifϕˆi,k+1|k>τi,1ωi,k+1,s=0.8,ifτi,2<ϕˆi,k+1|k≤τi,1ωi,k+1,s=0.5,if−τi,3<ϕˆi,k+1|k≤τi,2ωi,k+1,s=0.2,if−τi,4<ϕˆi,k+1|k≤−τi,3ωi,k+1,s=0,ifϕˆi,k+1|k≤−τi,4where ωi,k,s(k=1, 2, …, Ntr) represents the proportion of stock assets in total assets on the kth trading day of the ith moving window,τi=τi,1τi,2τi,3τi,4Tare the switching threshold parameters in the ith identification window.The purpose of asset allocation is mainly to attain higher asset returns. Simultaneously, the return should be kept stably and the volatility of assets during the allocation control process should be as small as possible. Therefore, an asset-evaluation function in the ith identification window is defined as follows(22)J(τi)=μiNtr∑k=1NtrAi(k|τi)−Ai(0)+kNtr(Ai(Ntr|τi)−Ai(0))2−Ai(Ntr|τi)where μiis the weight factor of the volatility of assets, τiis the threshold parameter to be optimized in the ith identification window, Ai(k|τi) denotes the total assets on the kth trading day of the ith moving window, Ai(0) is the given initial assets, Ntr is the identification window width, and(23)Ai(k|τi)=ωi,k,cAi(k−1)+ωi,k,sAi(k−1)Pi,k−1Pi,kwhere ωi,k,cis the proportion of cash assets in total assets on the kth trading day of the ith moving window, and ωi,k,c+ωi,k,s=1.The first part of Formula (22) is the fluctuation amplitude of assets, which is also a punishment for asset volatility. In an identification window, the threshold parameters τiis optimized by minimizing function (22) and by also using the PSO method in Section 3.3. Of course, τiis also regarded as particle in the PSO method. Then one can predict the proportion of stock assets in the following trading window based on the allocation strategy (21). Next, the identification window is moved to a new window, which contains the previous trading window, and the trading window is also renewed. The asset allocation process will go on according to the above steps.In this section, some real financial time series, which are daily closing price and are selected from constituents of HSI and S&P 500 index, are modeled and the asset allocation is carried out based on the proposed ADTMS modeling and dynamic asset control strategy with two moving windows (identification window and trading window). For each time series, the modeling and asset allocation process will be completed independently. In order to illustrate what improvements can be obtained under the ADTMS-based asset allocation control, the previous parameters-fixed DTMS modeling and asset allocation method is also applied into the same financial time series, and several cases shown in Peng et al. [19] and Dourra and Siy [32] are also modeled and controlled. Assume that the total number of observation data is N, the width of identification window is Ntr, and the width of trading window is Nte. In the process, the first Ntr data points are used to estimate the first ADTMS model (3) and to optimize its parameters of asset allocation strategy (21), the following Nte data points are used to test the modeling and control performance, and then Nte training data and Nte testing data are updated and a new identification and allocation process will start. The above steps will continue over time. These observation data usually are transformed by(24)Pk=100×logZkwhere Zkis the closing daily price. This transformation may improve the stationarity of financial time series.In Peng et al. [19], the first applied data is the daily time series of the JPY/USD exchange rate from 17/01/1990 till 26/12/1997, in which N=2000, Ntr=1000, Nte=1000 and is implemented into the JPY/USD currency asset allocation; the second applied data is the daily time series of the Japan TOPIX (Tokyo stock Price IndeX) from 01/10/1993 to 29/10/2000, in which N=1891, Ntr=1000, Nte=891, and is used to carry out the stock/current dynamic asset allocation. To compare with the previous results, in this paper, we select the same Ntr as in Ref. [19] for training, and Nte=5 which denotes to predict 5 daily excess demand by Kalman filtering, and then update training data and build a new ADTMS model using the method in Section 3 to control assets allocation over time. The two observation data Pkare shown in Fig. 1, and their modeling and control results are presented in Figs. 2–3, respectively. It is noteworthy that the training result of the first ADTMS model is consistent with that of the parameters-fixed DTMS model in Ref. [19].Fig. (a) in Figs. 2–3 presents the estimated innovation and its histogram, as well as the estimated potential excess demandϕˆi,k|kand market liquidityeσˆi,k|k/2of the first ADTMS model for training data. From them, one can see that the estimated innovation is close to white noise and Gaussian distribution, which may verify that the Kalman filter is applicable for the ADTMS model. The estimated excess demandϕˆi,k|kis capable of capturing the volatility of asset price, i.e.ϕˆi,k|k>0when price Pi,kis up andϕˆi,k|k<0when price Pi,kis down. Furthermore, the excess demand mainly reflects the tendency of asset price, and is smoother than the return of asset price. It can be inferred that an investor can obtain better control results based on the estimated excess demand than on the predicted price.Fig. (b) in Figs. 2–3 shows the total asset Akof the ADTMS model-based asset control, including the training results for the dataset of the first identification window (‘ADTMS(1)’ in the top subfigure) and the testing results for all subsequent moving trading window (as shown in the third subfigure). The initial total assets are all 1000 shares. It is noteworthy that the dataset on the first identification window of ADTMS models in all cases here is the same as the training dataset of the parameters-fixed DTMS model. Therefore, the modeling and asset allocation results of ADTMS(1) and DTMS are the same, and they are depicted using one line. The second and forth subfigure in Fig. (b) are the switching actions ωk,sin the process, which indicates how many assets are transferred to USD in Fig. 2, or the proportion of keeping the stock asset in Fig. 3.In the first and third subfigure of Fig. (b) in Figs. 2 and 3, as well as Figs. 5–12 and Figs. 14–17, the black line marked by ‘ADTMS’ shows the gross asset under the control of the ADTMS models-based asset allocation, the red line marked by ‘DTMS’ shows the gross asset under the control of the parameters-fixed DTMS model-based asset allocation, and the blue line marked by ‘Original’ shows the gross asset without executing any buy-and-sell strategy in the market. It means that an investor buys the financial product on the first trading day, and then does not execute any buy-and-sell trading.It is clear that, from the third subfigure of Fig. (b) in Figs. 2–3, the asset allocation performance of ADTMS model-based control is better than that of DTMS-based control, and the obtained assets with the control strategy (21) are more than that without control. The control results for training data and testing data are also presented in Table 1. It can be seen that the asset allocation control may effectively keep the total assets growth or prevent assets loss; moreover the ADTMS model-based control may obtain much more total assets than the DTMS model-based control. It illustrates the effectiveness and significance of the proposed ADTMS modeling and the model-based asset allocation with two moving windows for the financial time series.The applied observation data from 31/05/2011 to 06/04/2015 (totally 1000 trading dates) in Hong Kong stock exchange is the daily closing price of the individual asset listed in Table 2. Note that all data come from http://finance.yahoo.com. Their observation data are plotted in Fig. 4. These stocks in Table 2 are modeled using the adaptive DTMS method with two moving windows in Section 3, and the future change of their asset price is forecasted based on the estimated potential excess demand. For all stocks, N=1000, Ntr=500 and Nte=5. The estimated parameter θ1 for the first ADTMS model is reported in Table 3, and the modeling and control results are presented in Figs. 5–12and Table 4.In Fig. (a) in Figs. 5–12, the predictive innovation of stock price is very small and is substantially normal distribution as seen from their histogram. The estimated excess demand can reflect the trend up/down of stock price. When the stiffness eσk/2 becomes large, the innovation increase and the amplitude of stock price change also increases. This situation is consistent with the definition of market liquidity (the inverse of eσk/2), and that eσk/2 is the time-varying standard variance of price in the first equation of model (2). In particular, about from the 80th point to the 120th point in Fig. (a) of Figs. 5–12 for the eight stocks, the market liquidity (the inverse of eσk/2) is very small, which verifies that the financial market of Hong Kong from September 2011 to December 2011 were in the downturn.In Fig. (b) in Figs. 5–12, the implication of the color lines are the same as mentioned in Section 4.1. Note that the initial total assets are all 1000 shares, and the unit of the asset Akis Hong Kong dollar (HKD) and ωk,sin Fig. (b) denotes the proportion of keeping the stock. Figs. 5–12 and Table 4 show the asset allocation results of the eight stocks in HSI under the control of three different methods, from which one can see that for the testing data, the rate of returns without control ranges from −49.869% (KL) to 24.194% (CB), and the rate of returns with control based on the parameters-fixed DTMS model ranges from −19.902% (HL) to 21.102% (CB). The final total assets using the ADTMS model, whose rates of returns range from 2.181% (HJ) to 33.737% (CB), are much higher than that in other two methods. This illustrates that the ADTMS model can better capture the dynamics of the financial time series and thus the ADTMS model-based control can obtain much better control performance compared to other two method.The observation data from 04/03/2011 till 24/02/2015 (totally 1000 trading dates), which are the constituents of the S&P 500 index, are the daily closing price of four individual assets listed in Table 5. Their transformed observation data based on Eq. (24) are plotted in Fig. 13. For all stocks, N=1000, Ntr=500 and Nte=5. The estimated parameters θ1 for the first ADTMS model are reported in Table 6, and the modeling and control results based on the method in Section 3 are presented in Figs. 14–17and Table 7. In Figs. 14–17, Fig. (a) shows the modeling results, and Fig. (b) shows the asset allocation results for the training data in the first identification window and for the testing data in all trading windows.From Fig. (a) of Figs. 14–17, the predictive innovations of Pkare small, and their histograms are substantially normal distribution, which illustrates validity of the estimates. The estimated excess demandϕˆk|kvaries around zero, and is much smoother compared with the innovation of Pk. From the 100th point to the 200th point in Fig. (a) of Figs. 14–17, the stiffness eσk/2 and the innovation of Pkboth increase obviously. This demonstrates that, from July 2011 to December 2011, the financial market in the United States also depressed and the market liquidity was insufficient. It almost happened in Hong Kong financial market simultaneously.In Fig. (b) of Figs. 14–17, the implication of the color lines are also the same as mentioned in Section 4.1. Note that the initial total assets are 1000 shares, and the unit of the asset Akis United State dollar (USD) and ωk,sin Fig. (b) denotes the proportion of keeping the stock. From Figs. 14–17 and Table 7, one can see that the final assets based on the ADTMS model obtained by moving the identification window and the trading window are much higher than the assets with control of the parameters-fixed DTMS model-based asset allocation and that without control, whether for the training data or for the testing data. Table 7 gives the final asset allocation results of the four stocks in S&P500 under the control of three different methods, from which it is clear that for the testing data, the rate of returns without control ranges from −13.413% (SHLD) to 20.501% (KIM), and the rate of returns with control based on the parameters-fixed DTMS model ranges from 1.493% (COH) to 27.699% (KIM). The final total assets based on the ADTMS models, whose rates of returns range from 26.047% (COH) to 96.686% (SHLD), are much higher than that of the others. This also illustrates that the ADTMS model can better capture the dynamics of the financial time series and the ADTMS models-based control can obtain much better control performance compared to the other methods.From model (2) and above case studies, one can see that the excess demand not only reflects the price increase/decrease, but also reflects the magnitude of its change. Therefore the trading strategy (21) which allocates 0%, 20%, 50%, 80% or 100% of money in total assets (five-level strategy) is designed in this paper. Here, we compare the strategy with buying/selling 100% of stocks (two-level strategy) and the final values for the SHLD, CB and HL stocks are given in Table 8.From Table 8, for the training and testing data, using the five-level strategy the investor can obtain higher profit than using the two-level strategy. For HL stock, the testing results of the two control strategies are similar. It is clear that the two-level strategy will enlarge the change amplitude of proportion of stock assets so that the transaction costs will increase. Usually, the trading results of the five-level strategy are better than that of the two-level strategy in most cases.At last, the performance of the proposed method is compared with the fuzzy logic method in Refs. [32,33]. In Ref. [32], a case study on Western Digital Corp. (WDC) stock was done, and the result is given in Table 9. In Ref. [32], two daily closing price datasets of WDC stock, from 28/08/1995 till 05/09/1997 and from 06/09/1997 till 27/08/1999, are used to do asset allocation using the fuzzy logic method, respectively. For fair comparison under the same condition, the dataset from 28/08/1995 to 05/09/1997 is used as the training data for estimating the first ADTMS model that is also the parameters-fixed DTMS model, and the dataset from 06/09/1997 to 27/08/1999 is used as the testing data for the ADTMS/parameters-fixed-DTMS modeling and asset allocation, where N=981, Ntr=468, Nte=5. The result in Ref. [32] and the results using the previous method based on the parameters-fixed DTMS model and using the proposed method based on the adaptive DTMS model are all shown in Table 9.From Table 9, one can see that the final total profit based on the parameters-fixed DTMS model is higher than that of the fuzzy logic method in Ref. [32], and the final profit based on the adaptive DTMS model is highest among three methods. This further illustrates that the proposed modeling and asset allocation approach in this paper is effective and feasible.

@&#CONCLUSIONS@&#
For a class of strongly stochastic financial time series, this paper proposed a semi-on-line adaptive modeling and asset allocation method to overcome the shortcoming that the prediction accuracy of the previous parameters-fixed DTMS model may gradually decline if the length of test dataset is too long. In the method, first, a long-interval identification window is used to estimate a DTMS model, and then the estimated DTMS model is used to carry out asset allocation on the following short-interval trading window. Next, the identification window and the trading window are both moved to the next new windows, and a new DTMS model and asset allocation strategy are obtained by using the dataset on two new windows. The process is implemented repetitively by moving the windows. To do so, a set of adaptive DTMS models can be estimated to capture the dynamics of the stochastic volatility financial markets over time. The models are locally linear and Gaussian at local time, and are globally nonlinear and time-varying in a long interval.For improving the flexibility and adaptability of the ADTMS models, a hybrid optimization method was proposed to estimate the ADTMS model parameters and states within their effective ranges. This method could reduce the dependence on the initial value, which may appear in Nelder–Mead method, and could improve the search efficiency. Furthermore, based on the estimated directly-immeasurable excess demand, the asset allocation control strategy with two moving windows was designed to help investors buy/sell assets. Through the successful application to some real stocks from the HSI and the S&P 500 constituents, it was illustrated that the ADTMS model with moving windows are capable of capturing the dynamics of the financial time series, and the estimated excess demand could characterize the trend of the stock price change. It was verified that the ADTMS model-based asset allocation can obtain much higher asset return than the non-adaptive DTMS model-based asset control. This demonstrates that the proposed adaptive modeling technique and the model-based asset allocation strategy are effective, feasible and suitable for modeling and asset trading for some financial time series.In this paper, the width of identification window and the trading window are set to 500 and 5 for each application, respectively. In fact, for different stocks or different periods, one may need to change the width of the windows to achieve the better modeling and asset allocation control result. In future work, we will further improve the structure and estimation method of the ADTMS model for enhancing the model adaptability to financial markets.