@&#MAIN-TITLE@&#
Using retrospective sampling to estimate models of relationship status in large longitudinal social networks

@&#HIGHLIGHTS@&#
Estimation of statistical models for social networks is challenging.Dyads with no relationship (“null-dyads”) are common in large social networks.Propose to subsample the “always-null” dyads.Develop weighted likelihood Bayesian estimation method.Method enables large social networks to be analyzed feasibly and accurately.

@&#KEYPHRASES@&#
Conditional independence,Longitudinal,Retrospective sampling,Social network,Sociocentric design,Sparse data,Weighting,

@&#ABSTRACT@&#
Estimation of longitudinal models of relationship status between all pairs of individuals (dyads) in social networks is challenging due to the complex inter-dependencies among observations and lengthy computation times. To reduce the computational burden of model estimation, a method is developed that subsamples the “always-null” dyads in which no relationships develop throughout the period of observation. The informative sampling process is accounted for by weighting the likelihood contributions of the observations by the inverses of the sampling probabilities. This weighted-likelihood estimation method is implemented using Bayesian computation and evaluated in terms of its bias, efficiency, and speed of computation under various settings. Comparisons are also made to a full information likelihood-based procedure that is only feasible to compute when limited follow-up observations are available. Calculations are performed on two real social networks of very different sizes. The easily computed weighted-likelihood procedure closely approximates the corresponding estimates for the full network, even when using low sub-sampling fractions. The fast computation times make the weighted-likelihood approach practical and able to be applied to networks of any size.

@&#INTRODUCTION@&#
In this paper we develop, apply, and evaluate a new method of estimating a dynamic model of the relationship status of all dyads (pairs of individuals) in a social network, where both the number of individuals (N) and the number of observation times (T) can be large. Analyses of complete lattices of dyadic data (referred to as sociocentric network data) in general seek to identify the important determinants of dyadic relationships and gain insights into properties or determinants of the network. For example, one phenomena that is often thought responsible for the formation of relationships is homophily–commonly described as “birds of a feather flock together”–whereby individuals with similar attributes are more likely to form or maintain relationships, leading to clusters of individuals with similar traits within the network. However, the primary objective of this paper is demonstrating that the new estimation method is feasible to implement on networks of anyNandT, overcoming the practical limitations of existing methods. The following two publicly-available social network datasets, judiciously chosen due to the difference inNandTbetween them, will be analyzed and used to appraise our method of computing estimates.The smaller network is from the excerpt of 50 schoolgirls in the Teenage Friends and Lifestyle Study (TFLS) described in Snijders (2014). Students in the study named up to 12 close friends at three surveys conducted during 1995–1997 (Michell and Amos, 1997; West and Sweeting, 1995). After dropping the two girls who did not nominate and were not nominated by anyone, the final network comprisedN=48girls (1128 dyads) observed onT=3occasions (two relationship change opportunities). The number of friends named by each schoolgirl (out-degree) could range from 0 to 12 while the number of times a girl could be named by others as their friend (in-degree) had a range from 0 to 47. The students were also asked about substance use and adolescent behavior associated with lifestyle, sporting behavior and tobacco, alcohol and cannabis consumption. A particular question of importance is whether homophily of smoking behavior exists; were girls who were both smokers or both non-smokers more likely to become friends.The second and larger longitudinal friendship network is from the offspring cohort of the Framingham Heart Study (FHS). Since the offspring cohort’s inception in 1971, its members have been followed from 1971–2008 through eight periodic health exams, at which an extensive array of personal and medical information (e.g., height, weight, age, smoking status) was collected. Friendship ties at each exam were ingeniously obtained from the nomination of close-friends who might be in a position to know where the study member would be in two to four years (Christakis and Fowler, 2007, 2008). Subjects were not restricted from naming multiple friends but on most occasions only named a single friend, resulting in a sparsely-connected network. Out-degrees were typically 0 or 1 while in-degrees were more widespread with values≥2relatively common. Emulating Paul and O’Malley (2013), all FHS offspring members who named or were named by another offspring cohort member over any two consecutive exams were included in the analysis, yieldingN=831individuals observed at up toT=8exams (7 relationship change opportunities). A plethora of personal characteristics (gender, age, BMI, smoking status, various medical quantities) are available although herein we focus on age. More details of both the FHS and TFLS networks appear in Paul and O’Malley (2013).In these networks relationship status (close friendships between schoolgirls or between study members) is presumed known for allN(N−1)/2dyads, yielding complete sociocentric data. Close friendship is represented as a binary random variable (1 = yes, 0 = no) with the presence thereof referred to as a tie. Because there is no constraint that a tie from one individual to another implies that a tie exists in the reverse direction the networks are directional.To identify the presence of homophily or some other relationship feature (e.g., reciprocity) in the network, other possible explanations for the formation and dissolution of ties need to be statistically adjusted for or controlled. Finding the important determinants of a network is aided by longitudinal data. However, such data has historically been elusive. Not surprisingly, methods for longitudinal analysis of sociocentric data are scarce and those that do exist are confronted by computational challenges. For example, we previously developed a novel model for a longitudinally-observed sociocentric network that allowed homophily effects and other network phenomena to be estimated. Although the methodology was sound, implementation was restricted to small- to mid-sized networks by CPU and time constraints (Paul and O’Malley, 2013). One of the reasons for the challenging computations is that the number of dyads in a sociocentric dataset has orderN2as opposed to the orderNnumber of observations in individual level analyses. Because large networks withN≥1000are becoming commonplace, the development of methods of estimating models of networks for anyNandTis timely.The method proposed herein adapts ideas from survey sampling methodology to accurately approximate estimates of the full network in minimal computational time. The genesis of the method is the observation that asNincreases the number of dyads that remain null (no ties) over time increases. Therefore, as long as the sampling design is accounted for in the analysis, in large networks only a small fraction of the always-null dyads may be needed to accurately approximate the estimates computed on the full network. To account for the dependences introduced by sampling, we develop a novel weighted likelihood (WL) estimation procedure that weights the observations for each dyad by the inverse of the probability of sampling that dyad. The proposal to subsample null-dyads is not without precedent (Raftery et al., 2012; Kleinbaum, 2012). However, to our knowledge we are the first to consider subsampling in the context of longitudinal sociocentric networks.In Section  2 we define notation and specify models for longitudinal analysis of sociocentric data. In Section  3 we describe our proposed sampling design and develop associated WL estimation and implementation procedures. To evaluate the efficacy of the WL estimation procedure, we compare it to a full information observed data likelihood (ODL) procedure on the smaller TFLS network data for which estimation of the ODL procedure is feasible and discuss the limitations of ODL methods on larger or more intensely observed networks. The estimation methods are applied to the two longitudinal sociocentric network datasets described above in Section  4 with comparisons between the methods and other results reported in Section  5. Section  6 reviews the primary findings and discusses limitations.LetYijtdenote the presence of a tie (1 = friend, 0 = not a friend) from individualito individualj(i,j∈{1,…,N})at timet∈{1,…,T}. The bivariate random variableDijt=(Yijt,Yjit), the status of dyadijat timet, is the primary unit of analysis and the subject of our statistical model. Clearly,Dijtcontains 0 (null friendship), 1 (directional friendship), or 2 (mutual friendship) ties. For notational convenience, the sequence of states held by a dyad is collated asDij=(Dij1,…,DijT), the whole network at a given time asDt={Dijt}i<j, and the sequence of networks beyond baseline (t=1) asD=(D2,…,DN).In both the TFLS and FHS networks several network phenomena are of interest. If the prevalence of mutual dyads is greater than expected (i.e., if knowinginamedjas a friend makes it more likely than otherwise thatjnamedias a friend) all else equal then reciprocity is present. A distinct phenomena from reciprocity is the propensity of an individual to name others as friends being correlated with the propensity of them being named by others as a friend. A positive correlation suggests that expansive individuals are also popular while a negative correlation might suggest the presence of powerful individuals who keep few close friends despite many others wanting to be their friend. Transitivity, the phenomena commonly referred to as a “friend of a friend is a friend”, is the most well-known form of between-dyad dependence. In addition, various forms of homophily may be present and as in any longitudinal study, observations may be serially dependent (O’Malley and Marsden, 2008). A model for longitudinal sociocentric network data is needed to distinguish the effects of each of these and other terms (Handcock et al., 2003; Robins et al., 2007; Lewis et al., 2008). The statistical model considered in this paper was developed in our own prior work (Paul and O’Malley, 2013), which built off or was motivated by the work of several others (van Duijn et al., 2004; Zijlstra et al., 2006; Hoff, 2005, 2008).A vector of covariatesxijtincludes the homophily (or similarity) measures (e.g., difference in age, both smokers or both non-smokers) for actorsiandjat timet, any observed predictors specific to individualsiandjat timet, and any network-based covariates capturing transitivity or other forms of triadic dependence determined fromDt′fort′<tas elements. An example of the latter is the common source covariate, given byI(∑k≠i,jYki(t−1)Ykj(t−1)>0)whereI(event)=1if event is true and 0 otherwise, allowing an individualk≠i,jnaming bothiandjas a friend att−1to have an effect on the likelihood of ties betweeniandjatt. Time-lagged versions of such triadic-type covariates are used in place of contemporaneous predictors in order to ensure that the resulting model is well-defined and self-consistent (Paul and O’Malley, 2013). To allow different effects on tie-formation and tie-retention, two versions of the common source covariate are created through multiplication by1−Yij(t−1)andYij(t−1), respectively.The bivariateDijtmay be represented as a four-category multinomial random variable and the transitionDij(t−1)→Dijtis represented by a 4×4 transition matrix. We focus on dyadic models with assumed Markov dependence across time so that the transition matrix is a sufficient representation of the serial dependence of a dyad on its prior states. However, this assumption could be relaxed to allow dependence on earlier states of the dyad (and more generally the network). We further assume that transitions in dyad status follow a generalized mixed effect logistic regression equation (an alternative link function such as the inverse of the standard normal cumulative distribution function as for probit regression could instead be considered). Letθij=(ai,bi,aj,bj)denote the individual-specific propensities ofiandjto form (a) and receive (b) friendships. The probabilities of the four possible states ofDijtare represented in the form:(1)Pr(Dijt=dijt,∣Dt−1=dt−1,xijt,θij)=kijt−1exp(μijtyijt+μjityjit+ρijtyijtyjit),where(2)kijt=1+exp(μijt)+exp(μjit)+exp(μijt+μjit+ρijt),(3)μijt=β0+β1yij(t−1)+β2yji(t−1)+β3yij(t−1)yji(t−1)+βxTxijt+ai+bj,and(4)ρijt=λ0+λ1(yij(t−1)+yji(t−1))+λ2yij(t−1)yji(t−1).In (1) the termsμijtandρijtare linear predictors that relate the systematic components of (3) and (4) to the four state probabilities of dyadijatt. The termμijtincludes factors associated with the likelihood thatYijt=1but not necessarily with the likelihood thatYjit=1. Dependence betweenYijtandYjitnot attributed to observed characteristics of the individuals is quantified by the extent thatρijt=ρjitand is known as reciprocity. The furtherρijtis from 0 the greater the difference betweenPr(Yijt=Yjit=1∣Dt−1=dt−1,xijt,θij)andexp(μijt+μjit)/kijt, its value under statistical independence ofYijtandYjit.The density parameterβ0reflects the rate of tie-formation in dyads whose current state is null. The reciprocity parameterλ0allows the rate of formation of a tie fromitojto be correlated with that of a tie fromjtoiin dyads whose current state is null. The parametersβ1,β2, andβ3; andλ1andλ2are modifications ofβ0andλ0when the dyad is in the various non-null states att−1. For example,λ1measures the increased propensity of a bidirectional tie attif it is asymmetric as opposed to null att−1.We assume that the sender and receiver effects inθijonly impactμijtand are time invariant although these assumptions could be relaxed. To complete the model we assume(ai,bi)are random effects from a bivariate normal distribution having mean 0 and covariance matrixΣ(standard deviationsσaandσb; correlation coefficientν). The model in (1)–(4) is then a longitudinal extension of theP2model (Duijn et al., 2004).The joint likelihood function of the observed data and the random effects is given by(5)p(D=d,θ∣D1=d1,x)=(∏i<j∏t=2Tp(dijt∣θij,dt−1,xijt;Ω))∏ip(ai,bi;Σ),whereΩ=(β,λ,θ)andΣdenote the transition model and random effect parameters, respectively. The factorization evident in (5) follows from the conditional independence of the dyadic observations given(a,b)and the independence of the random effects.Due to the hierarchical structure of the model, Bayesian methods are natural to use for estimation. As in Paul and O’Malley (2013) we complete a Bayesian specification of the model by assuming diffuse normal priors (mean 0 and variance 106) for the regression coefficients(β,λ). Instead of specifying priors directly forΣ, for additional flexibility we express the joint distribution of the random effects(ai,bi)in the product normal form (Spiegelhalter, 1998; Cooper et al., 2007). The product-normal form is advantageous compared to assuming (e.g.) the conjugate inverse-Wishart prior forΣas it allows the prior for the variance and correlation components ofΣto be specified with different levels of precision. In the analyses of the TFLS and FHS networks we assumeai∼N(0,σa2)andbi∣ai∼N(ϕai,τb2), whereσa2andτb2in-turn have inverse-gamma priors with mean 1 and variance 103, andϕ∼N(0,106).In previous work we found that model estimation rapidly became too CPU intensive and time-consuming due to theO(N2)number of dyads. However, because the proportion of dyads that remain in their null state throughout (“always-null dyads”) naturally increases withN(Dunbar, 1992; Gladwell, 2000), it is reasonable to expect that sampling such dyads will result in minimal loss of precision. Therefore, we propose the sampling-design that samples non always-null dyads with probability 1 and always-null dyads with probabilityπ0. Letrij=∏t=1T(1−yijt)(1−yjit)so thatrij=1if dyadijis an always-null dyad andrij=0otherwise, andSij=1if dyadijis sampled and 0 otherwise. Then the associated sampling probability is given byPr(Sij=1∣Dij,θij,xij)=Pr(Sij=1∣rij)=π0rij.The above sampling scheme is easily extended by allowing the sampling probabilities to depend onxij. For example, settingPr(Sij=1∣Dij)=1if individualsiandjare both friends with an individualk≠i,jat sometand 0 otherwise would ensure that the dyads that contain the most information about triadic effects are assured of being sampled. Such sampling designs are highly desirable when certain levels of a predictor occur infrequently to ensure the model is estimable on the sample data.Because the sample inclusion indicators depend onDijthey are informative and ignoring them is likely to lead to sample selection bias. The joint likelihood function ofDandθgiven the sample inclusion indicatorsShas the formp(D,θ∣S,X,D1), whereXcontains the matrix of covariates from across the observations andD1is the initial state of the network. Becausep(D,θ∣S,X,D1)=p(D∣S,θ,X,D1)p(θ∣S,X,D1)it is convenient to considerp(D∣S,θ,X,D1)andp(θ∣S,X,D1)separately. Although the likelihood function is well-defined and maximum-likelihood or Bayesian estimators inherit the associated optimality properties, conditioning onSleads to non-standard expressions. As illustrated in the Appendix,p(D∣S,θ,X,D1)is available in closed-form but is laborious to evaluate whenTis large, whilep(θ∣S,X,D1)is not available in closed-form and so exact computation would entail numerical evaluation of an unresolved integral. Therefore, while traditional estimators exist theoretically, computation of them would be onerous. To avoid such bias we propose to use a WL procedure to estimate the model parameters.In the design-based approach to the analysis of survey data, weighted estimators are often used to account for informative sampling designs. The general procedure is to weight observations by the inverse of their sample inclusion probability, thereby ensuring that inferences pertain to the individuals in the sampled population. The analogy for the sociocentric network is to weight each sampled dyadic observation by the inverse of its sampling probability.Because we are interested in estimating the parameters of the model in (1)–(4), we propose to weight the contribution of each sampled observation to the likelihood function. This procedure emulates an approach to estimating hierarchical models on survey data given informative sampling weights (Browne et al., 2002; Pfeffermann et al., 1998). We first ignore the presence of random effects and focus on the weighted-likelihood alternative top(D∣S,θ,X,D1). For our sampling scheme, the weighted log-likelihood function conditional onθis(6)L=∑i<jwijLij,whereLij=∑t=2T{μij2yijt+μji2yjit+ρijtyijtyjit−log(kijt)}andwij=Pr(Sij=1∣rij)−1=π0−rijare the likelihood contribution and sampling weight, respectively, for dyadij. The WL in (6) is not a true likelihood function as the weights do not represent the frequency of observations. However, from the perspective of approximating the estimates that would have obtained had the full sociocentric network been analyzed, theory suggests maximizing (6) is a more desirable procedure than the naïve unweighted alternative.To accommodate the random effectsθ, we extend (6) to(7)L=∑i<jwijLij+∑ilog(p(ai,bi;Σ)).The unweighted second term on the right-hand-side of (7) arises because the sample design does not directly depend onθij; therefore, the information contained inSaboutθis likely to be minimal. Therefore, we make the approximationp(θ∣S,X,D1;Ω)≃p(θ;Σ)=∏ip(ai,bi;Σ). Raftery et al. (2012) similarly argues that information in the sample inclusion indicators about an individual’s position in the latent “social space” (the random parameters in this context) need not be used to construct individual-level weights.An advantage of using (7) (or (6) if no covariates) for point estimation is that it is easily maximized. However, because it is not a true likelihood function, the WL is not calibrated to the information in the sample and so standard MCMC-derived variance estimates cannot be assumed to adequately represent the precision of knowledge about the true parameters. Therefore, we use a non-parametric bootstrap to compute interval estimates for the WL procedure. The resulting100(1−α)-level intervals are used to approximate the exact100(1−α)%equal-tailed Bayesian credible intervals. For the analyses conducted herein we assumeα=0.05.The following pseudo-code describes the bootstrap procedure:1.Fork=1:nboot:(a)Re-sample with replacementN(N−1)/2dyads from the network, keeping the set of observations attached to each dyad intact. Denote the re-sampled data byDk.Sample the always-null dyads inDkwith probabilityπ0and augment these with the non always-null dyads (sampled with probability 1). Denote the sampled data byDsubk.Use the WL procedure to fit the model toDsubk. Denote the posterior mean estimates of the model parameters byΩk=(βk,λk,θk)andΣk.Take the100α/2and100(1−α/2)percentiles of each element of{Ωk,Σk}k=1:nbootas the 95% interval estimate.The key assumption underlying the bootstrap is that the units of observations being re-sampled are independent. In the case of the model in (1)–(4), dyadic independence does not hold as multiple dyadic observations depend on the same elements ofθij. Furthermore, a two-stage bootstrap re-sampling scheme that re-samples clusters and observations within clusters does not solve the problem as the sender (a) and receiver (b) random effects are cross-classified between dyads. Therefore, the proposed bootstrap procedure is in general an approximation that warrants evaluation.A theoretically supported estimation procedure is to evaluate the likelihood function of the observed data conditional onS={(i,j):Sij=1}, the set of the sample inclusion indicators. Maximization of the resulting observed data likelihood (ODL) function is a statistically efficient procedure as all the information in the sample is utilized, including the information contained in the sample inclusion indicators. The ODL procedure emulates estimation of models for case-control studies, an approach that has been previously considered for cross-sectional network data (Raftery et al., 2012; Kleinbaum, 2012) but not for longitudinal network data.Becausep(D∣S,θ,X,D1)has a closed-form expression for allT(see Appendix), exact full information likelihood-based estimates can be computed for the case when(ai,bi)are constant acrossi. In general, becausep(θ∣S,X,D1;Ω)does not separate into disjoint components due to the involvement ofaiandbiin multiple dyads (see Eq. (10) in the Appendix), the ODL function involves a2N-dimensional integral that does not have a closed-form. Therefore, exact likelihood-optimization or Bayesian evaluation is computationally challenging. However, becauseSonly depends onθijindirectly throughDij, it is reasonable to assumeSis only weakly informative aboutθ. Therefore, we approximatep(θ∣S,X,D1;Ω)byp(θ;Σ)=∏ip(ai,bi;Σ)and use the resulting “pseudo ODL”,(8)L=∏i<jp(Dij∣Sij=1,xij,D1;Ω)∏ip(ai,bi;Σ),as a “working” likelihood function for computing estimates against which to evaluate the performance of the WL procedure.In those cases when ODL is available and able to be evaluated exactly, it provides a gold standard against which to evaluate the WL procedure. However, the above approximations notwithstanding, application of the ODL procedure is limited to situations whereTis small (see Appendix for details).In analyzing the TFLS and FHS networks, we assume(ai,bi)is a bivariate normal random variable with unknown covariance. When using the ODL procedure to assess the WL procedure, we also consider the special case where the variances are 0 (i.e., the random effects are constant across dyads). Because the objective of the WL procedure is to recover the estimates obtained from the full sample, theπ0=1case yields an upper bound on the performance of the WL procedure.In the TFLS analysis,xijtconsists of indicators of whether individualsiandjeither both smoked or both did not smoke (“same smoking status”) attand whether a third individual named both individuals as a friend att−1(“lagged common source”). The common source covariate allows a test of whether a new tie is more likely to form or an existing tie is more likely to remain intact if the presence of that tie would result in a transitive triad.The smaller (N=50,T=3) TFLS network allows the impact of sampling always-null dyads to be evaluated efficiently for each of: (1) naïve analysis of the sampled data (ignoring the fact that sampling has occurred), (2) the WL approach, and (3) the ODL procedure to assess the efficacy of the WL procedure. We evaluate results whenπ0=0.005, 0.01, 0.02, 0.05, 0.10, 0.25, 0.5, and 1 to assess the extent to which WL recovers the estimates for the full network asπ0→0. To determine which parameters are the most sensitive toπ0, results are compared between the elements of(β,λ,Σ).The model for analysis of the FHS network is analogous to that for the TFLS network except thatxijtincludes the absolute difference of age for actorsiandjas a homophily covariate in place of the same smoking status covariate. BecauseT=8, the denominator of each contribution of the ODL function evaluates and sums47=16,384terms, a laborious computation that needs to be frequently performed (see Appendix). Therefore, we only apply the WL procedure to the FHS Network.To fully evaluate the utility of WL on the FHS network we evaluate its performance withπ0as small as 0.001. For the purpose of the bootstrap we treat dyads as independent units—a reasonable assumption in the FHS due to the fact that individuals seldom name more than one close-friend at a single wave. Computations were performed using computer code written in the C programming language and, for preliminary testing, the R statistical language. The bootstrap was implemented by running analyses in parallel on a machine with eight dual-core processors. CPU times are reported for the evaluation of point estimates of the parameters.

@&#CONCLUSIONS@&#
