@&#MAIN-TITLE@&#
An intelligence-based route choice model for pedestrian flow in a transportation station

@&#HIGHLIGHTS@&#
We developed an artificial neural network (ANN) model to mimic route choice behaviour in crowds which achieved a prediction accuracy of 86%.We demonstrated the feasibility of applying the ANN approach to decision-making in pedestrian flows. Both safety and comfort level inside the stations are potentially improved.This model is useful for both station design and daily operation, as escalators are a critical transportation facility in transportation stations.This ANN approach provides a rapid method for engineers to estimate the loadings of escalators, even for new stations, so that they can optimise their utilisation to achieve maximum efficiency.

@&#KEYPHRASES@&#
Artificial neural networks,Intelligent system,Crowd movement,Evacuation,Human behaviour,Transportation,

@&#ABSTRACT@&#
This study proposes a method that uses an artificial neural network (ANN) to mimic human decision-making about route choice in a crowded transportation station. Although ANN models have been developed rapidly and widely adopted in various fields in the last three decades, their application to predict human decision-making in pedestrian flows is limited, because the video clip technology used to collect pedestrian movement data in crowded conditions is still primitive. Data collection must be carried out manually or semi-manually, which requires extensive resources and is time consuming. This study adopts a semi-manual approach to extract data from video clips to capture the route choice behaviour of travellers, and then applies an ANN to mimic such decision-making. A prediction accuracy of 86% (ANN model with ensemble approach) is achieved, which demonstrates the feasibility of applying the ANN approach to decision-making in pedestrian flows.

@&#INTRODUCTION@&#
To cope with rapid population growth, increasing numbers of railway systems have been constructed across the world, ranging from high-speed railways such as the Eurostar in Europe to the more recent magnetic levitation trains such as the Shanghai airport train in China. The projected trend is that railway systems will continue to increase in size, and thus crowd movement and evacuation planning will play a more important role in railway systems than ever before. The Hong Kong transportation system is characterised by high passenger flows, a short train headway and limited capacity in the transportation stations. The failure of facilities inside a station may cause accidents and threaten passengers’ lives. A study of route choice between escalators and stairways in subway stations in Hong Kong was carried out [1] to explore the optimisation of station facilities, which is critical for both safety and operational efficiency.In the past three decades, several dynamic evacuation and pedestrian models have been developed for modelling complex crowd movements. These models include social force (SF) models [2], cellular automata (CA) models [3], lattice gas (LG) models [4], fluid-dynamic model [5], agent-based (AB) models [6] and SGEM model [7,8]. They provide important information about the spatial design of complex buildings, underground stations and other public amenities. In addition to these microscopic [2–4,6–8] and macroscopic models [5], network models [9,10] have proved useful in the design of emergency evacuation plans, because they allow the detailed modelling of human cognitive processes. However, most of the existing pedestrian flow models that simulate the dynamic movement of pedestrians are based on mathematical models, which may not be able to sufficiently mimic actual human behaviour. Indeed, the movement decisions that are obtained by these models are determined by either empirical equations (e.g., Bradley [5] employed Navier–Stokes equations that govern fluid motion to describe crowd movement at high densities) or by assumptions (e.g., the SF models [2], CA models [3], and LG models [4] treat individuals or groups as homogeneous, and do not consider heterogeneous human behaviour such as herding). Even with AB models such as Simulex [11] and buildingEXODUS [12], occupant behaviour is assigned by the operator according to his or her preference, and the resultant simulated pedestrian flow patterns may not reflect real-life situations.One of the critical behavioural reactions of humans during evacuation and in moving crowds is route choice. Route choice is influenced by many factors, including personal experience, building geometry, interactions among occupants and environmental factors [8,12,13]. In general, passengers will choose the path with the shortest travel time, travel distance or a combination of both [14]. However, Proulx [15] pointed out that evacuees tend to prefer familiar routes rather than the shortest path to the exit, because they feel that unknown paths increase the threat. Proulx's pioneering work depicted the complexity of route choice in human movement. Gwynne et al. [12] proposed an exit selection behaviour model that is based on “Queuing and Familiarity Behaviour”. Lo et al. [8] introduced a game theory based exit selection model for evacuation. Hoogendoorn and Bovy [16] proposed a new theory of pedestrian route choice behaviour under uncertainty based on the concept of “utility maximisation”.These route choice models all use mathematics to simulate the human decision-making. In contrast, this paper proposes the alternative approach of applying an ANN model to capture human decision-making behaviour by data collected from actual passengers.In transportation stations, escalators, stairways and elevators serve as vertical transport between the concourse and the platforms. Passengers tend to use escalators rather than stairs or lifts. They avoid climbing stairs to save energy and avoid spending time waiting for lifts. Escalators play an important role in transportation around a station. Optimising the use of escalators is thus the first priority in the internal transportation system of stations.This study presents an example of route choice in a transportation station. Passengers approach two escalators and choose one of them to travel to the upper floor. The decision-making involves the consideration of various factors, which are explored in the following sections.Initial research in this area [17,18] focused on the correlation between throughput capacity and the width of exits. Fig. 1shows the layout of a compartment with two exits. In an emergency (e.g., the outbreak of fire), each occupant inside the compartment will choose one of the exits to leave the compartment. This is a typical example of route choice decision-making. In predicting the evacuation time from the origin of an evacuee to the exit of the compartment, Togawa [18] established empirically that the evacuation time Tecan be expressed as a sum of the flow time (To) and the travel time (Tf) of the evacuee as follows.(1)Te=To+TfIn the simplest form, Tocan be further expressed in Eq. (2), where ksis the distance from the point of the evacuee to the destination, andvrepresents the walking speed of the crowd.(2)To=ksvThe travel time Tfis estimated by Eq. (3), where Nais the total number of evacuees,f′prepresents the flow rate per unit width of the exit and B′ is the width of the exit.(3)Tf=Naf′pB′Usually, pedestrians choose the route with the least travelling time. According to Togawa [18], the factors that contribute to the travelling time are as follows.1.The walking velocity of the pedestrian.The distance from the origin of the pedestrian to the exit.The maximum flow capacities of the exits.These factors form the basis of this study to investigate the parameters in human route choice decision-making for ANN model training.The remainder of this paper is organised as follows. Section “Artificial neural network” introduces the ANN for route choice in moving crowds. Section “Data collection” discusses how the data was collected from the transportation station. Section “Development of the MLP model” outlines the development and architecture of the ANN model. Sections “Model training” and “Results and discussion”, respectively, present the model training process and evaluate the performance of the ANN model. Section “Conclusion” concludes the paper.ANN models have developed rapidly in the last few decades, to the extent that they are now able to mimic the correlation of system parameters that are unknown or complex [19] and capture the nonlinear behaviour of a system via a “learning” process (also known as the “training” of the network function) from historical system data. ANN models have also become a popular approach to the prediction of non-linear functions in the past decade. Among the various ANN models, the multi-layered perceptron (MLP) [20] is one of the most widely used for forecasting due to its simple and flexible nature. MLP has been successfully used to predict the weather, flank wear in drills and thermal load predictions [21–26]. However, researchers have seldom applied ANN models to simulate pedestrian decision-making in moving crowds or evacuation planning due to the extensive resources required for the data collection and pre-processing.One of the merits of ANN models is that they do not require highly specialised human expertise nor any assumptions. The learning feature of ANN models is especially useful for human decision models, as the relationships between the input parameters are less well known than in highly structured expert systems or equation-base approaches [19]. In this study, the MLP is adopted to predict route choice in pedestrian flows.The data was collected from a transportation station in Hong Kong. A bank of escalators inside the station, as shown in Fig. 2, was offered by the transportation company for the study. There are three escalators, one of which had been stopped to save energy. The other two escalators were moving upward at an equal and constant speed. The passenger flow was unidirectional. All passengers are required to ascend to the upper floor via escalator to leave the station. Passengers approaching the escalators have to choose one of the two escalators to ride to the upper floor. This is the decision making that is investigated and mimicked by the MLP model.It is normal practice in Hong Kong, as in some other countries, for passengers not in a hurry to stand on one side of the escalator and leave the other side for passengers in a hurry to walk up to shorten the time spent riding the escalator. Both of the escalators shown in Fig. 2 are 60m long. This long length prevents most passengers from walking all the way up the escalators and simplifies the decision-making process. According to our site observations, the general behaviour of passengers is in line with our assumption, with most passengers in the video footage standing on the escalators and just a few walking up.The video technology used to collect pedestrian movement data in crowded conditions is still primitive, and existing image processing techniques are unable to fully overcome the occlusion problem [36]. Therefore, data collection was carried out manually or semi-manually, which requires extensive resources and is time consuming. In this paper, the locations of the passengers at different time steps were extracted from the video clips by using a semi-manual approach with a “Passenger Trap”, which was presented by Teknomo [36]. The “Passenger Trap” is an imaginary rectangle marked as a boundary for counting passengers on the video clips. Only the passengers who pass the trap are considered. The trap width is perpendicular to the path of the passenger, and the trap length is parallel to the walkway. Therefore, the area and the coordinates of this rectangle can be obtained more easily.In this study, the data were collected from video clips captured by a closed-circuit television (CCTV), as shown in Fig. 3a. Fig. 3b shows a typical snapshot (front view) of the train station. The locations of the passengers at different time steps were extracted from the video clips using a semi-manual approach. A computer program was developed to play the video on the computer screen. At each time step, the computer mouse was moved over the screen to click on the feet of passengers shown on the screen. The data on the passengers’ locations were then converted to geometrical data by the computer program. These data were further processed to obtain the input and output data for the training of the ANN model. Details of the input and output parameters of the ANN model are discussed in Section “Development of the MLP model”.The MLP architectural model consists of several layers: the input layer, hidden layer(s), and output layer. Fig. 4shows the architecture of a typical MLP model. The neurons in each layer are interconnected with the neurons in the adjacent layers. There may be more than one hidden layer in a model, but it has been proven that an MLP with a single hidden layer is a universal function approximator [27], subject to the provision of a sufficient number of hidden neurons. A three-layered (input layer, hidden layer and output layer) MLP model was thus adopted in this study.The number of neurons in the input layer corresponds to the number of input parameters in the model. As mentioned in Section “Routes choice behaviour”, the main factors affecting the evacuation time according to Togawa [18] are (1) the walking velocity of the evacuee, (2) the distance from the origin of the evacuee to the exit and (3) the flow rate of the exits. However, non-linear human behaviour such as queuing and familiarity behaviour is obviously not included in Togawa's mathematical model, and further modification based on empirical equations is necessary. We used the following six parameters as inputs for the ANN model to decide which escalator would be chosen by each passenger.Normally, the walking speed of a passenger reflects how much of a hurry he or she is in. Passengers in a hurry will walk faster. Passengers in a hurry may also be impatient to board the nearest escalator, and may overtake other passengers [11,28]. Alternatively, they may choose the escalator that is not the nearest one but has less people using it. Passengers walking slowly are less likely to be in a hurry, and may choose a less dense escalator to avoid collision with hurrying passengers.Pedestrians dislike taking detours or moving contrary to their desired walking direction, even in crowded conditions [29]. However, due to the high population density in Hong Kong, passengers usually move as a crowd due to the limited capacity of stations. The initial position of passengers entering the crowd will affect their route choice, in that such decisions a prevented when the density reaches a certain level. In this situation, a passenger is most likely to follow the crowd or follow the path of the passenger in front to avoid collisions with nearby passengers [29]. Sudden changes of direction are seldom found in normal situations, as this action may cause collisions and block the routes of passengers nearby. The initial position of the passenger was thus also selected as one of the inputs for the ANN model training.According to our onsite observations, the initial position of the passengers entering the crowd resulted in different probabilities of passengers choosing the escalators. In our data capturing process, we evenly divided the initial position of the passengers into six locations, as shown in Fig. 5.Humans are required to make decisions when they face two or more options. Similarly, the passengers in this study were required to make a decision as they walked to a position where they could see the two escalators (i.e., where the two escalators fell into their line-of-sight). We denote this location as the initial position, which is chosen as one of the parameters influencing the decision of passengers and an input in the ANN training model. Fig. 6illustrates the initial decision point of passengers according to the concept of the minimum line-of-sight.The densities at the platform and on the steps of escalators 1 and 2 are captured when the passengers approach the initial decision point as input parameters 3 and 4, respectively. The idea of level of service (LOS) proposed by Fruin [30] reveals that the walking velocity of a pedestrian and the density of the surrounding area are highly correlated. Passengers approaching the two escalators and deciding which escalator to use may also consider the densities at the entrances of the escalators to avoid being blocked in by other passengers. Passengers typically make their initial decision at the initial decision point based on their walking velocity, position and the densities at the escalator entrance. If an alternative route of the same length is available, then according to [29] passengers will make the route choice decision as late as possible, meaning that a change of mind is still possible at the last minute. Our model accounts for this observation and considers the scenario at a final decision point, as shown in Fig. 7. The densities at the landing platforms of the escalators 1 and 2 when the passengers approach the final decision point are respectively recruited as input variables 5 and 6.The number of neurons in the input and output layers is equal to the number of input parameters and output parameters. This is defined by the system itself. The required number of hidden neurons is crucial to the performance of the model. Currently, there is no analytical approach to determine the number of hidden neurons, but different rules of thumb are available to provide heuristic hints to the user. The rule of thumb adopted in this study is the rule developed by Ward [31] as described in Eq. (4), where Nh, Ninand Noutare respectively the number of neurons in the hidden layer, the input layer and the output layer, and Nsis the number of training samples.(4)Nh=(Nin+Nout)/2+NsBefore the adoption of the rule-of-thumb, the sensitivity of the performance of the model to the number of hidden neurons was studied. However, it was found that a change in the number of hidden neurons did not significantly affect the model performance in terms of the mean of the accuracy of the actual outputs and the outputs predicted by the model obtained from the training (described in Section “Model training”). The number of hidden neurons examined was set at Nh±5. For each number of hidden neurons, 5000 trials were performed to determine the model performance with a 95% confidence level. If the 95% confidence intervals of the models with different numbers of hidden neurons overlap, then from a statistical point of view it can be concluded that the performance of the models with different numbers of hidden neurons is comparable. It was thus concluded that the model performance is insensitive to the number of hidden neurons, and the rule of thumb could be adopted.The output of the MLP model is whether passengers choose escalator 1 or 2, which is represented by “0” or “1”, respectively. The inputs and output of the MLP model are listed in Table 1. The architecture of the MLP model is illustrated in Fig. 8.Back-propagation (BP) [32] is the traditional training algorithm used for the MLP model. It feeds back the prediction errors from the output layer to the input layer and adjusts the weights of the links between the neurons. Upon completion of the weight adjustment, a new prediction is carried out to evaluate a new prediction error for the next epoch of weight adjustments. These procedures are repeated numerous times until a satisfactory prediction is achieved.A total of 621 samples were collected in August 2010 for the network training and testing. Fifty per cent of the samples were used for network training, 25% were hidden during the network training phase and the remaining 25% served as a testing set to evaluate the performance of the trained network. The training set was used to train the model with the BP algorithm, whereas the validation set was used to monitor and stop the BP training using the early-stop validation approach. The testing set did not play a role in the training of the MLP model. Upon completion of the model training, the testing set was used to evaluate the performance of the trained model.To prevent overfitted training, the intermediate-state trained model in every training epoch was applied to the validation set to evaluate the prediction error (i.e., the validation error). The network training was stopped when the validation error reached the minimum value. As we had no prior knowledge of the trend of the validation error, “early-stop” training was adopted. This records the status of the model continuously in the course of the training. When there is no reduction in the validation error over a predefined number of epochs (the number of epochs selected here was 150), the model state with the minimum validation error is taken to be the trained model. Fig. 9illustrates the early-stop training process.Upon completion of the network training, the trained MLP was applied to the testing set to evaluate the performance indices by comparing the target values of the testing set and the values predicted by the trained model. The performance index used here was the fraction of correct predictions(a¯),as defined in Eq. (5), where N is the total number of samples and{ti=pi}i=1Nare the target values and the predicted values, respectively. A fraction of correct predictions of 1 indicates that 100% of the test samples are correctly predicted.(5)a¯=∑i=1N(ai)/Nwhereai=1ifti=pi0ifti≠piIt should be noted that a random process is normally involved in the network training of an MLP model, especially when the available samples are divided into training and validation sets. It is thus possible for the random process to result in “fortuitous” samples that show favourable evaluated performance indices. Instead of reporting only the best simulation result, a less-prejudice statistical approach was adopted to minimise the effect of randomisation. We carried out the network training and performance evaluation process 5000 times. The 5000 results were statistically analysed by evaluating the mean and limit of the 95% confidence intervals of the results.In the model training, the training, validation and testing sample sets were obtained by random sampling. The performance of the trained model might not always be favourable, as it very much depends on the quality of the training sample. It is possible that the sample batch favours the network training, and thus produces a better model. To verify the performance of the trained model, it is thus necessary to evaluate it statistically.As the sample extraction process is random, we carried out 5000 trials of model training and testing (i.e., the results converged at 5000 trials). In each trial, the training, validation and testing samples were randomly grouped. The model was trained and tested with the samples and the performance index of that trial was obtained. The 5000 trials gave 5000 performance indices. As the performance indices (i.e., the fractions of correct predictions) were well bounded between 0 and 1, a beta distribution was used to represent the probability distribution of the accuracy of the model, as shown in the example in Fig. 10. The limit of the one-sided 95% confidence level from the right (i.e., x95) represents the fraction of correct predictions of the model. This statistical approach alleviates the effect of randomness in evaluating the model performance.

@&#CONCLUSIONS@&#
