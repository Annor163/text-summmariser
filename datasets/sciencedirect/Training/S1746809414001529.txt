@&#MAIN-TITLE@&#
Postprandial response improvement via safety layer in closed-loop blood glucose controllers

@&#HIGHLIGHTS@&#
The paper presents and intensively evaluates a method for reducing the incidence of postprandial hypoglycemia in patients with type 1 diabetes.The method adapts the glucose set-point when the insulin-on-board estimation reaches a given clinical constraint.Through a very challenging test scenario it is shown that the method not only reduces the hypoglycemia events but also allows reducing the postprandial glucose excursion.

@&#KEYPHRASES@&#
Artificial pancreas,Glucose control,Hypoglycemia,Insulin-on-board,Constrained control,Postprandial,Sliding mode control,Safety layer,

@&#ABSTRACT@&#
Traditional type 1 diabetes therapies are prone to show poor glucose regulation especially in the postprandial period owing to both physiological and technological limitations. Although a closed-loop controller for glucose regulation has to be tuned to minimize the postprandial excursion and avoid late hypoglycemia, the intrinsic limitations of the problem lead to a trade-off between postprandial peak and late hypoglycemia risk. This paper reveals through an intensive in-silico study with multiple controller tuning combinations that a novel safety layer for glucose controllers, the so-called SAFE loop (Revert et al., 2013), not only reduces the hypoglycemia events but also allows reducing the postprandial glucose excursion, thus breaking the implicit trade-off present in single controllers. The SAFE outer loop monitors the estimated amount of insulin on board, and modifies the control action if it is close to a unique constraint which can be adjusted with clinical criteria. A very challenging test scenario is here implemented including the rate of blood glucose appearance from intakes of mixed meals, diurnal and day-to-day time-varying metabolic changes, inherent drawbacks in sensor and actuator, and other realistic conditions. The results show a significant reduction of hypoglycemia events when SAFE is added, regardless the closed-loop glucose controller, together with a potential postprandial response improvement.

@&#INTRODUCTION@&#
Treatments with multiple daily injections (MDI) or continuous subcutaneous insulin infusion (CSII) have been widely used by type 1 diabetes patients to keep their glucose near normoglycemia. Insulin pumps used for CSII therapy have shown more advantages over MDI allowing a more comfortable lifestyle. Modern insulin pumps incorporate bolus advisors that help patients to calculate prandial boluses, a customizable basal insulin flow to daily sensitivity changes, preventive alarms, etc. [3,4]. Similarly, the increasingly reliable continuous glucose monitoring (CGM) systems has enabled the development of more corrective actions improving the performance of these open-loop treatments. Even so, imprecise estimation of the amount of carbohydrates ingested, metabolic changes in the glucose-insulin system, stress, physical activity, etc., are prone to cause hypoglycemia [2,6,7].The concept of artificial pancreas (AP) arises to overcome drawbacks from conventional therapies. This consists of a CGM system connected to an automatic closed-loop controller responsible for continuously calculating an appropriate dose to infuse through an insulin pump. However, current CGM systems are not reliable enough to ensure an accurate glucose measurement due to large drift, lags and bias errors. Moreover, the subcutaneous route used by the insulin pumps involves a serious lag in the insulin action.Main concern in scientific community has focused on developing safe and robust closed-loop glucose controllers. To this end, a wide range of control approaches have been proposed, including model predictive control (MPC) [8–10],H∞[11,12], or sliding mode control [13,14] Another main research line is based on PID control techniques widely used in industry, well-established, reliable, having few parameters and intuitive tuning [15–17]. Readers are referred to [18,19] for a comprehensive state of the art of the topic. On the other hand, only few of these approaches, mainly MPC and PID techniques, have been assessed in clinical trials, particularly to perform glucose control in conditions as overnight, postprandial, ambulatory, and including consumption of alcohol or exercise among others [8,20]. Regarding the postprandial response, a single control loop for the AP has to be tuned to: (1) minimize the postprandial excursion and (2) avoid late hypoglycemia. Meal compensation through semi-closed control schemes allows for better performance than fully automatic ones. Limitations related to the subcutaneous route and the large disturbance caused by the meal encourage the use of a feed-forward action combined with the feed-back controller [16,21,22].Regardless the scheme used, the trade-off between postprandial peak and late hypoglycemia risk is one of the distinctive challenges of blood glucose control for closed-loop systems. The more aggressive the controller, the lower the postprandial peak but the higher the hypoglycemia risk and vice versa.Several proposals mainly focused on PID and MPC control approaches have been designed in order to improve postprandial performance. For example, pole placement techniques are used to compensate for delays in the subcutaneous route implementing a negative feedback of the estimated plasma insulin in the so-called ePID-IFB algorithm [23,24]. In [17], the PID controller is switched off just before the ingestion with a restarting time calculated as function of the current blood glucose concentration and its corresponding rate of change. In MPC approaches, risk management strategies, auto-tuning nonlinear strategies, model individualization or meal compensation have been proposed [26,25]. In the same way, constraints based on insulin-on-board (IOB) have been incorporated to the optimization algorithm of an MPC, which needs to be shaped as function of the meal size and the current glucose measurements [27,28].Recently, a novel safety scheme based on sliding mode reference conditioning technology has provided a new approach to prevent hypoglycemia events, both for fully closed-loop control (the so-called Safety Auxiliary Feedback Element, SAFE [1]) and for hybrid configurations (the hybrid adaptive PD controller [29]). This safety layer employs an IOB estimation along with a flexible constraint which can be set based on individual parameters. According to its mathematical basis, the variable structure systems and the sliding mode control [30], the SAFE algorithm can be applied to any practical closed loop controller and used to improve their response in a safe way.In this paper, the SAFE algorithm is revisited and extensively evaluated against a number of control schemes currently used by researchers in the Artificial Pancreas field. Unlike the precedent study [1], in this work we used a single IOB limit to reduce the risk of late postprandial hypoglycemia. This limit is related to the upper IOB constraint and its value is considered constant here. This assumption greatly simplifies the process of tuning the algorithm, which can be changed intuitively with medical criteria. A procedure based on common clinical practices to determine the IOB limit is used here. Additionally, in this work a more realistic simulation scenario including different types of uncertainties and disturbances is implemented. It includes estimated profiles of blood glucose rate of appearance from mixed meals data, diurnal and day-to-day variations in insulin sensitivity and insulin absorption, controller mistuning, discrete measurement and actuation, and sensor errors. Therefore the results obtained here provide increased impact than those of preliminary investigations, and allow observing the performance potential that has the method in realistic circumstances. The results obtained in this paper present the SAFE approach not merely as a safety net against hypoglycemia but also as a useful tool for re-tuning the inner controller in a safe way towards an overall improvement of the postprandial response. It is shown that the method not only reduces the hypoglycemia events but also allows reducing the postprandial glucose excursion.In this section, we briefly present the method to be refined.11The reader is referred to [1] for further details.Fig. 1presents a block diagram of a general glucose control loop to which the SAFE layer has been added. In the main control loop, the control action ucis the pump's insulin infusion rate, whereas ufrepresents the feed-forward action of priming bolus in meal announcement schemes. The glucose controller can be of any type, even nonlinear. For simplicity, the controller is assumed biproper (i.e., with a direct path from the error to the control action), which is of practical significance.The SAFE algorithm implements an outer safety loop for glucose control with the main objective of reducing the number and severity of postprandial hypoglycaemic events. The algorithm automatically adjusts the desired glucose reference Gdto a safety referenceGdSwhen the residual insulin in the subcutaneous tissue, the IOB, exceeds a given upper limitIOB¯. That is, the outer control loop is only active when the IOB changes to undesirable values beyond the imposed constraints.As the IOB is inaccessible, it must be estimated. From the estimatedIOBˆ, a switching law is defined to generate the correct signal for the glucose reference Gd, which prevents surpassingIOB¯. The main advantage of this approach is that it is applicable to any main control loop controller and thus provides a generalised method to address the over-reaction problem. The following paragraphs describe how the switching function of the SAFE layer is implemented in this study.As already mentioned, the amount of administered insulin that is still active in the body is also known as the insulin on board. IOB estimation is used by smart pumps to prevent from excessive insulin stacking, particularly when boluses are given close together [5]. An individualization of IOB estimation is usually characterized by the duration of insulin action (DIA), a parameter that clinicians are used to tune when setting up insulin pumps [4].Here, the IOB estimation is represented by a two-compartment dynamical model [31], although any of the published insulin absorption models (see for instance [32,33]) could have also been used:(1)dC1dt(t)=ud(t)−KDIAC1(t)dC2dt(t)=KDIA(C1(t)−C2(t))IOB(t)=C1(t)+C2(t)where C1 and C2 are the two compartments and u(t) is the insulin dose. The constant KDIAis tuned for each patient so as model (1) replicates its corresponding DIA. Table 1shows the corresponding values of KDIAfor several DIA values.Only an upper constraintIOB¯for IOB is considered as the main objective to mitigate the problem of postprandial hypoglycaemic incidence. To fulfil this constraint, the following switching law is proposed.(2)w(t)=w+ifσ(t)>00otherwise,with(3)σ(t)=IOB−IOB¯+τ(IOB˙−IOB¯˙)where τ can advance the reference conditioning as a function of the rate of change of IOB; for τ small the comparison is performed with theIOB¯, for τ large the comparison is performed in advance.When the upper bound is violated (or about to be violated), thewswitches tow+≠0to increase the safety referenceGdSand reduce the control action uc, with the aim of preventing hypoglycaemia due to excess insulin.The resulting discontinuous signalwduring the IOB limitation is smoothed out by the first-order filter represented in the block F before being added to Gdto produceGdS.22Note that the filter F has been replaced with respect to [1] as we assume Gdis constant.. The reference returns to Gdonce the IOB is under the safety level (as the auxiliary signal equals zero in such a case, i.e.w=0).For the sake of this study, the determination of theIOB¯is based on open-loop postprandial tests [29]. A complete description of this procedure is beyond the scope of the present paper [34]. We applied the following postprandial open-loop clinical test:1Achieve an initial condition of preprandial blood glucose concentration between 80 and 120mg/dL without insulin bolus administration during the previous 5h.Administer a meal with 40–100g of carbohydrates together with an insulin bolus.Observe blood glucose evolution during the following 10h,•If minimum glucose is outside the set (70,90), then repeat step 2 adjusting the bolus. Alternatively the correction factor, for a retrospective calculation of bolus, can be used.Else, use asIOB¯the IOB value obtained at time:CHO+80g60g/h, where CHO (g) is the amount of carbohydrate intake. This time can take values between 2 and 3h according to amounts of CHO between 40 and 100g.The open loop tests performed to obtain this method showed a low dependency of theIOB¯with the meal size used. In tests using a 40g meal, the bestIOB¯was found 2h after, while in tests using a 100g meal, the bestIOB¯was found 3h after. BothIOB¯were found to be almost the same value [34]. Note that unlike the approach presented in [1], theIOB¯derived in this way is almost independent of the meal size used. This encourages implementing a constant value ofIOB¯in order to evaluate the robustness using a single upper limit, which simplifies the tuning procedure. However, the possibility to compute a time-varyingIOB¯could be investigated.It is also worthy noting that the boundIOB¯, calculated as suggested before or in any other way, can be intuitively adjusted with medical criteria according to the closed-loop response exhibited by the patient. For instance, the physician should decreaseIOB¯in the case of frequent hypoglycemia, or increase it if the controller action is too conservative or the restriction is active during too long time.The evaluation about the significance of the SAFE layer in the control performance includes the main glucose controllers implemented for artificial pancreas in clinical trials. Two PID-like glucose controllers and a basic MPC controller with and without the SAFE method are addressed in this study.The first controller is the classical PID algorithm, in which the integral term is replaced by the basal insulin from the open-loop therapy, and a prandial bolus defined by the patient's insulin-to-carbohydrate (I:CHO) ratio and the corresponding meal size is implemented. This scheme is referred to as the PDBasal hybrid controller, as shown in Fig. 2.The second controller is the well established fully closed-loop PID with insulin feedback (PID-IFB) algorithm presented in [24], see Fig. 3. The control law is as follows:(4)ud(t)=uc(t)−γIp(t)uc(t)=kpe(t)+1τI∫e(t)dt+τDde(t)dtwhere γIpis the feedback component. The estimated plasma insulin Ipis a two-compartment model assumed for the pharmacokinetics of insulin, with a bi-exponential impulse response given by:(5)Ip(t)=IBKcl(τ2−τ1)(e−t/τ2−e−t/τ1)where τ1 and τ2 are time constants (in minutes) associated to the subcutaneous absorption of insulin, Kclis the insulin clearance, and IBis the magnitude of the impulse (bolus) of insulin delivered at time t=0.This insulin pharmacokinetic model is represented by the following equations:(6)dL(t)dt=ud(t)−a2L(t)dIp(t)dt=a1a2KclL(t)−a1Ip(t)where udis the input insulin, L is an intermediate compartment, a1=1/τ1 and a2=1/τ2. The values for the model time constants are τ1=55min and τ2=70min, and for insulin clearance Kcl=1L/min. According to [24], the PID algorithm with insulin feedback must deliver the same insulin-infusion rate to the subject as in the case without insulin feedback (i.e., when γ=0). Therefore, for a given controller gain selected for the case without insulin feedback, such as the nominal value given in [24], it can be adjusted by multiplying it by the factor:(7)f=1+γKclA basic constrained MPC controller is based on a linear model representing the glucose-insulin system for prediction. The model in state-space is represented as follows(8)x(k+1)=Ax(k)+Bu(k)y(k)=Cx(k)where x(k), u(k), and y(k) are the future states of the system, the input insulin, and the blood glucose concentration at the kth sampling instant respectively. The basic formulation of the MPC cost function in this study is defined as(9)minu∈RysTys·wy+usTus·wu+ΔuTΔu·wΔusubject to(10)umin≤us(k)≤umaxΔumin≤Δu(k)≤Δumaxwhere ysare blood glucose concentrations after subtraction of the set point, and usis the future insulin moves after the subtraction of the basal insulin. umin, umax, Δumin, and ▵umaxdenote lower and upper bounds on the insulin input and insulin increments respectively; andwy,wu, andw▵uare optimizations weights for the glucose concentrations, future insulin moves, and insulin increments, respectively. The size of ysand usdefines the prediction and control horizon implemented in the cost function respectively.A realistic and very challenging simulated scenario is created to evaluate the robustness performance of each control strategy with and without the SAFE layer. Concerns about the control algorithm as hypoglycemic protection and its consequence on patient safety are especially observed with this scenario design.A cohort of 10 virtual patients from Dalla Man et al model [35] is subjected to individualized circadian variations in insulin sensitivity, see Fig. 4. In addition, sinusoidal day-to-day variations of 20% amplitude with 19 and 29h period in the insulin sensitivity and in the insulin absorption respectively, were implemented. Moreover, rate of blood glucose appearance profiles corresponding to six different meals from [36] were implemented in a 18-meals simulation trial per patient, for a total of 180 meal tests. The corresponding profile of the rate of blood glucose appearance for each meal used is shown in Fig. 5.Each meal test covers a day starting at 12:00 with a preprandial glycemia near to 90mg/dL. However the focus of the analysis is on the 8h postprandial period. Each meal is administered three times during the simulation of the virtual patient, but under different intra-patient variability conditions (the diurnal and day-to-day variations). The simulation sampling period is 1min. However, the control action performed to the patient is updated every 10min. The sensor error considered is non-white, non-Gaussian proposed by [37], where an autoregressive-moving-average (ARMA) model is used along with a Johnson transformation of a unbounded system. Constrained performance of the insulin pump is included.

@&#CONCLUSIONS@&#
