@&#MAIN-TITLE@&#
A hierarchical construction of LR meshes in 2D

@&#HIGHLIGHTS@&#
The paper discusses bivariate LR splines with the non-nested support (N2S) property.Conditions on LR mesh refinement for preserving this property are presented.A hierarchical construction for LR meshes with the N2S property is proposed and analyzed.We prove the completeness of LR splines on the resulting hierarchical meshes.

@&#KEYPHRASES@&#
LR B-spline,Local linear independence,Completeness,Hierarchical B-splines,

@&#ABSTRACT@&#
We describe a construction of LR-spaces whose bases are composed of locally linearly independent B-splines which also form a partition of unity. The construction conforms to given refinement requirements associated to subdomains. In contrast to the original LR-paper (Dokken et al., 2013) and similarly to the hierarchical B-spline framework (Forsey and Bartels, 1988) the construction of the mesh is based on a priori choice of a sequence of nested tensor B-spline spaces.

@&#INTRODUCTION@&#
In the last decade the use of spline spaces has spread from the field of applied geometry, in particular Computer Aided Design (CAD), to that of numerical analysis of Partial Differential Equations (PDEs). This is largely due to the influence of the seminal paper by Hughes et al. (2005). The use of B-spline generated spaces in Galerkin methods was attempted before by Höllig (2003), but Hughes et al. (2005) recognized it as a possible way to remove the compatibility layer that is in-between the CAD tools and the Finite Element Method (FEM). The compatibility layer contains the mesh generation process and, in some cases, can be computationally more expensive than the simulation itself (Hughes et al., 2005). The method that reduces the compatibility layer proposed by Hughes et al. (2005) is called IsoGeometric Analysis (IGA) and is based on the isoparametric approach: the solution fields of the PDE are in the same B-spline or NURBS space used for the parametrization of the geometry.IGA sprouted new research in numerical methods due to the availability of basis functions with higher smoothness and with strong algebraic properties that allow for new numerical schemes like compatible discretizations. It had the same effect in the applied geometry field: the numerical simulation of PDEs requires high quality parametrizations of the domain while in CAD it is common to parametrize only the boundary and to allow both for small gaps and singularities.Both CAD and IGA applications require the use of function spaces that allow for local changes in spatial resolution. This is necessary to obtain a good approximation with fewer degrees of freedom. The standard tensor-product B-spline spaces do not allow for local changes in spatial resolution and thus different generalizations providing adaptive refinement were proposed in the last 25 years. Forsey and Bartels (1988) introduced the hierarchical splines, later studied by Kraft (1997) and more recently by Giannelli et al. (2012) and Mokriš et al. (2014), Sederberg et al. (2003, 2004) introduced T-splines of which an Analysis Suitable subset (AST) was described by Beirão da Veiga et al. (2012), Deng et al. (2008) introduced PHT-splines and Dokken et al. (2013) introduced LR-splines whose local linear independence was studied by Bressan (2013). Each of these approaches has their own strengths and weaknesses determined by the focus with which they were developed. In this article we try to combine the LR-splines framework with the hierarchical approach.Our aim is to obtain a space that has strong properties such as local linear independence and that can be efficiently implemented. Johannessen et al. (2014) applied LR-spline spaces to IGA and explored different refinement techniques. In contrast to their work, we study refinement strategies that are based on theoretical guarantees. In detail we present a method to construct a box meshMon a domain Ω whose element size is small in a neighborhood of some given regions and for which the associated LR-spline collectionLR(M)is a basis composed of locally linearly independent functions. This implies that the basis is also a partition of unity.In Section 2 we recall LR-spline definitions and results. Compared to the paper of Dokken et al. (2013) we only target the bi-variate case and we can therefore use a simpler notation. In particular we focus on the equivalence for the LR-spline collection to be a partition of unity, to be a set of locally linearly independent B-splines, and the non-nested support property (N2S for short).In Section 3 we describe a subset of the domain Ω in which it is possible to add vertical segments while preserving the N2S property. We describe another subset that behaves similarly for the addition of horizontal segments.In Section 4 we define a hierarchical approach to the construction of box meshes. Then we provide sufficient conditions under which the associated LR-spline space has the N2S property.In Section 5 we study the completeness of the hierarchically constructed LR-space, that is, whether it equals the piecewise polynomial space that is associated to the mesh.Section 6 describes our construction of LR meshes that guarantees both the N2S property (and thus local linear independence of the basis functions) and completeness. We comment on the locality of the refinement and show some examples in the case of dyadic refinement.Section 7 compares the proposed space with the truncated hierarchical B-spline space (THB) on the same Bézier mesh.We usePdto denote the space of polynomials of degree less than or equal to d. The space of bivariate polynomials of degreedxin the x variable and degreedyin the y variable is denoted using a vectord=(dx,dy)for the degree:Pd=Pdx⊗Pdy.For our purpose the degreed=(dx,dy)can be considered fixed at the beginning and it will be omitted in the notation.A knot vector Θ is a monotone non-decreasing sequence of real numbersθ1≤…≤θn.The number of repetitions of a knot z in a knot vector Θ is called the multiplicity of z in Θ and denoted with:(1)μΘ(z)=#{j:θj=z}.We say that two knot vectorsθ1≤…≤θnandξ1≤…≤ξmare compatible on the overlap11In the context of T-splines this property is called overlap (Beirão da Veiga et al., 2012). We prefer the name compatible because two separate knot vectors withθn<ξ1orξm<θ1are compatible, but it would be counter-intuitive to call them overlapping.if they can be seen as two parts of a larger knot vectorζ1≤…≤ζm+n. More precisely if there existsζ1≤…≤ζm+n, and two indexess,tsuch that(2){θi=ζs+i,i=1,…,n;ξi=ζt+i,i=1,…,m.Note that ifθn≤ξ1or ifξm≤θ1than the two knot vectors are compatible.The B-spline of degree d defined by the knot vectorΘ=(θ1,…,θd+2)(withθ1<θd+2) is denoted withB[Θ]. Bi-variate B-splinesR2→Rare the product of two univariate B-splines and are defined by a pair of knot vectorsΘ=(Θx,Θy)B[Θ](x,y)=B[Θx](x)B[Θy](y).The definition of the LR-spline spaces is based on knot insertion. More precisely, two new knot vectorsΘ+andΘ−are defined by insertingθ¯∈]θ1,θk+2[into a given knot vectorΘ=(θ1,…,θk+2). The new knot vectorsΘ+andΘ−contain the knotsθ¯,θ1,…,θk+1andθ¯,θ2,…,θk+2in non-decreasing order, respectively.There is a linear relation involving the B-splinesB[Θ],B[Θ+]andB[Θ−]. In the bivariate setting, givenB[Θx,Θy]andθ¯in[θx,i,θx,i+1[it holds(3)B[Θ]=α+B[Θx+,Θy]+α−B[Θx−,Θy],whereα+={1i=dx,θ¯−θx,1θx,dx+1−θx,1otherwise,α−={1i=1,θx,dx+2−θ¯θx,dx+2−θx,2otherwise.We say thatB[Θx+,Θy]andB[Θx−,Θy]are obtained fromB[Θx,Θy]by the insertion ofθ¯. The insertion of knots inΘyworks similarly. Based on the knot insertion is the notion of nested B-splines.Definition 1Let S be a space of functions. A B-spline B is nested in a B-splineB′relatively to S and it is writtenB≺SB′if there exists a sequence of B-splinesB′=B1,…,Bn=Bsuch that:•Bi∈S, fori=1,…,n;Bi+1is obtained fromBiby the insertion of a knot,i=1,…,n−1.Note that≺Sis a partial order relation on B-splines. As such it is possible to describe≺Susing a directed acyclic graph. Minimal and maximal elements of S with respect of≺Scorrespond to sinks and sources of the graph. Comparable pairs, i.e. pairsB1,B2such thatB1≺B2orB2≺B1, correspond to pairs of elements that are connected by an oriented path in the graph.It is important to note thatB≺SB′impliesB≺B′, but not vice versa. In particular if B is a maximal or a minimal element in S with respect to ≺ then it is also a maximal or minimal element for≺S. The minimal elements for≺Sin S are called minimal support B-splines in S.The definition of LR-spline spaces is based on≺Swhere S is an appropriate piecewise polynomial space over box elements. A box η is a Cartesian product of two closed intervals:[a,b]×[e,f]. A box inR2can be:•a vertex ifa=bande=f;a horizontal segment ifa<bande=f;a vertical segment ifa=bande<f;a rectangle ifa<bande<f.A box meshRon a rectangle Ω is a finite collection of rectangles such that:•⋃η∈Rη=Ω;∀η1≠η2∈R,η1∘∩η2∘=∅.Definition 2A box mesh with multiplicityMon Ω is a pair(R,σ)whereRis a box mesh andσ:E(R)→Nis a function representing the multiplicity of the edges. The spline space of degree d associated to a box mesh with multiplicity isS(M)={f:Ω→R:∀η∈R,f|η∈Pd,∀γ∈Ev(M),∂xdx−σ(γ)fis continuous onγ∘,∀γ∈Eh(M),∂ydy−σ(γ)fis continuous onγ∘}.We say that a B-splineB:R2→Ris inS(M)whensuppB⊆ΩandB|Ω∈S(M). When the component ofMare not specified we will refer toE(R)byE(M).Throughout this paper we will assume that the multiplicity of horizontal and vertical edges does not exceeddy+1anddx+1, respectively.Box meshes with multiplicity can be refined by adding mesh-lines to them. Given a meshM=(R,σ)and a segment γ we defineM+γas the meshM˜=(R˜,σ˜)obtained by dividing all rectangles split by γ into two. More precisely(5)R˜={C¯:∃η∈R:Cis a connected component ofη∖γ}and forα∈E(R˜)(6)σ˜(α)={σ(β)α⊈γ∧∃β∈E(M):α⊆βσ(β)+1α⊆γ∧∃β∈E(M):α⊆β1α⊆γ∧∄β∈E(M):α⊆β.An LR mesh is a box mesh with multiplicity that can be constructed by a sequence of additions starting from a tensor mesh.For all meshesMthe spaceS(M)contains the Bernstein polynomials on Ω. Moreover they are always maximal elements inS(M)for both ≺ and≺S(M).Definition 3The LR-spline collectionLR(M)is the set of the minimal support B-spline that are comparable with respect to≺S(M)to at least one Bernstein polynomial. The LR-spline space isLR(M)=spanLR(M).With this definition the LR-spline collection can be constructed using a recursive algorithm that, starting from the set of Bernstein polynomials, replaces at each step a non-minimal support B-spline with two B-splines obtained by knot insertion. This iterative construction is described in detail by Dokken et al. (2013). The set of minimal support B-splines can indeed be larger thanLR, see for an example Fig. 2 of Bressan (2013). The question of completeness of the LR-space, i.e. ifLR(M)isS(M)is not trivial. Dokken et al. (2013) described sufficient conditions for the equality, these are the base of our discussion on completeness.Linear independence of the B-splines inLR(M)is also a not fully resolved issue. Dokken et al. (2013) provided an algorithm that allows to check for linear relation efficiently, but in the literature there is no (non-trivial) construction that guarantees linear independence. The construction we describe is based on the theoretical results from Bressan (2013) where it is proved that local linear independence is equivalent to the fact that all B-splines inLR(M)are minimal elements with respect to ≺, see Theorem 4 below for details.Recall that a finite system of functions is linearly independent on a set A if the fact that a linear combination of these functions is equal to zero on the set A implies that the coefficients of all functions with a support intersecting A vanish. This property is preserved by taking the union of two sets: If the system of functions is linearly independent on two open sets A andA′then it is also linearly independent onA∪A′. A system of functions is said to be locally linearly independent if it is linearly independent on any open set A.Theorem 4LetMbe a box mesh with multiplicity, then the following are equivalent:1.∀B1,B2∈LR(M):B1≺B2⇒B1=B2;∀f∈Pd,f=∑B∈LRB[f](B)BwhereB[f](B)is the blossom of f evaluated at the internal knots of B (Ramshaw, 1989);LR(M)is a partition of unity;the functions inLR(M)are locally linearly independent;∀η∈R,#{B∈LR(M):suppB⊇η∘}=(dx+1)(dy+1).ProofFor the equivalence of the statements1,2,3and 5 we refer to Bressan (2013). We prove the equivalence of the fourth statement with statement No. 5. On the one hand, if the latter one is not satisfied, then there exists a rectangle η, which is contained in the support of at least(dx+1)(dy+1)+1B-spline functions. SinceLR(M)|η∘=Pdthey are not linearly independent on the open setη∘, hence the condition in the fourth statement is violated. On the other hand, assume the latter statement is satisfied. SincePd⊂LR(M), we conclude that the functions inLR(M)are linearly independent on any set that is contained in any rectangleη∈Rand possesses a non-empty interior. This observation extends to any open set since linear independence of functions on sets is preserved when taking unions of sets and the intersections of an open set with the rectanglesη∈Rare either empty or have a non-empty interior.  □The property described in the first statement of this theorem will be called the non-nested support (N2S) property. The support can actually be nested in the physical space (this requires that some mesh edges have multiplicity >1), but they cannot be nested in the “index space”. Box meshes with multiplicity for whichLRhas the N2S property will be called N2S meshes.The functions involved in the linear dependency relation from Dokken et al. (2013, Example 6.4) violate the N2S property. All the B-splines in Dokken et al. (2013, Equation (40)) are inLR(M), but all the functions on the right-hand side of the equality are nested (≺) in the function on the left-hand side.In the following sections we will avoid specifying the mesh when there is no ambiguity: we will use the shorter notationSinstead ofS(M), similarlyEforE(M)etc.In this section we describe the setRxof horizontally refinable rectangles. Our result is that ifMis an N2S mesh and γ is a vertical segment “well contained” in⋃RxthenM+γis an N2S mesh.22We use the convention that⋃A=⋃a∈Aa.Similarly we define the setRyof vertically refinable rectangles. Here “well contained” means that only the vertices of γ can be in∂⋃Rxor equivalently thatγ∘⊂(⋃Rx)∘. We also provide additional conditions that guarantee that the N2S property is preserved for the limit case: when the intersection of γ with the boundary of⋃Rxis a union of segments (and similarly for horizontal γ).Definition 5Consider a rectangleη=[a,b]×[e,f]∈Rand letsη=max⁡{σ(γ):γ∈Eh∧γ⊆[a,b]×{e}}tη=max⁡{σ(γ):γ∈Eh∧γ⊆[a,b]×{f}}Ξη=(e,…,e︸sηtimes,f,…,f︸tηtimes).See Fig. 1for a graphical representation. We say thatη∈Ris horizontally refinable if for allB[Θx,Θy]∈LR(M)withsuppB[Θx,Θy]⊇ηit holds thatΘyis compatible withΞη. The set of horizontally refinable rectangles isRx. The setRyof vertically refinable rectangles is defined similarly.Note that from the definition it follows that for allη=[a,b]×[e,f]∈Rxandα∈Ehcontained in[a,b]×{e}it holds thatσ(α)=sη. Similarly ifα⊆[a,b]×{f}thenσ(α)=tη.Fig. 2shows the region covered by the rectangles inRxand inRyfor a simple mesh. Note that⋃Rxdoes not contain the regions near the endpoints of horizontal mesh lines and similarly⋃Rydoes not contain the regions near the endpoints of vertical mesh lines.Lemma 6LetMbe an N2S mesh. If γ is a vertical edge such thatγ∘⊆(⋃Rx(M))∘thenM+γis an N2S-mesh and⋃Rx(M+γ)⊇⋃Rx(M). Moreover all the B-splines inLR(M+γ)either are inLR(M)or are obtained from B-splines inLR(M)by the insertion of the abscissa of γ in the horizontal knot vector. Similarly if γ is a horizontal segment.Note that the addition of a vertical γ (satisfying the hypothesis) cannot reduce the region covered by⋃Rx. This means that once⋃Rxis computed it is possible to add many vertical segments well contained in it while preserving the N2S property. Conversely nothing is said about the behavior of⋃Ryand thus it should be recomputed after each addition of a vertical segment. Similarly for horizontal segments.ProofWe prove the lemma only for the addition of a vertical segmentγ={a}×[e,f]. Consider a B-splineB=B[Θx,Θy]∈LR(M)whose support is cut by γ in two connected components. This means that B is not a minimal support B-spline with respect to the meshM+γ=(R˜,σ˜)and thus there are two B-splines that are obtained from B by inserting a, the abscissa of γ, intoΘx. LetB′be one of the two B-splines obtained from B. First we prove by contradiction thatB′is a minimal support B-spline forS(M+γ)and then that there is no φ inLR(M+γ)such thatB′≺φ. LetΘx′be the horizontal knot vector ofB′.Assume thatB′is not a minimal support B-spline forS(M+γ). Then there existsφ∈S(M+γ)that is obtained fromB′by knot insertion. Consider first the case of a horizontal knot insertion so thatφ=B[Θx″,Θy]and letθ¯be the knot that has been inserted inΘx′. Let A be the set of the vertical edges inEv(M+γ)that are contained in({θ¯}×R)∩suppB. The existence of φ implies(7)∀α∈A,σ˜(α)≥μΘx″(θ¯)>μΘx′(θ¯).From the definition ofM+γit follows(8)μΘx′(θ¯)=μΘx(θ¯)+cwherec=1ifθ¯=aand 0 otherwise. From the fact that B is inLR(M)it follows (with the same c)(9)∃α∈A:σ˜(α)=σ(α)+c.Equations (7), (8) and (9) are in contradiction.Consider now the insertion of a vertical knotθ¯andφ=B[Θx′,Θy′]. Let A be set of horizontal edges inEh(M+γ)contained in(R×{θ¯})∩suppB. SinceB∈LR(M)andγ∘⊆(⋃Rx(M))∘it follows that for allα∈Asuch thatα∩γ≠∅it holds(10)σ˜(α)=μΘy(θ¯).On the other hand forα⊂suppB′it must also hold(11)σ˜(α)≥μΘy′(θ¯)>μΘy(θ¯).Equations (10) and (11) are in contradiction because there must be at least an α that is contained insuppB′and intersects γ. We can now conclude thatB′is inLR(M+γ). Thus the B-spline inLR(M+γ)whose support intersect⋃Rx(M)have the same vertical knot vector of a B-spline inLR(M)and thus we can conclude that⋃Rx(M+γ)⊇⋃Rx(M).Assume the existence ofφ∈LR(M+γ)such thatB′≺φ. Then there existsφ′=B[Ξx,Ξy]∈LR(M)such thatB′≺φ≺φ′. Leta1<⋯<anbe the ordinates of the horizontal edges contained in suppB and intersecting γ. Letαi=[a,bi]×{ai}be the edge intersecting γ in the left endpoint at ordinateai. From the hypothesis thatγ∘⊂(⋃Rx(M))∘we conclude thatαi⊂⋃Rx(M)and thus thatΞyis compatible with(a1,…,a1︸σ(α1)times,…,an,…,an︸σ(αn)times).Moreover fromB′≺φ′it follows thatΞy=Θy. SinceB′≺φ≺φ′and all have the same vertical knot vector we conclude thatφ=B′. This proves thatM+γis an N2S mesh.  □In Lemma 6 we addressed the preservation of the N2S property for the addition of edges that are well contained inRxorRy. This does not cover the limit case, when the added edges intersect the boundary of the refinable region. The problem is that by adding a segment on the boundary ofRxit is possible to obtain a new B-spline B whose support does not intersect(⋃Rx)∘. On these B-splines we have no control and they can be further refined and destroy the N2S property. We provide sufficient condition for this case in Lemma 7. In Fig. 3there are some examples of vertical segments whose addition preserve the N2S property because they satisfy the hypothesis of Lemma 6 (left) or Lemma 7 (right).Lemma 7Letγ={a}×[e,f]be a vertical segment contained in⋃Rx(M). Letη1,…,ηmbe the maximal (with respect to inclusion) vertical segments contained inγ∩∂⋃Rx(M). Finally letρ1,…,ρnbe the horizontal edges inEh(M)that intersect one of theηiand are not contained in⋃Rx(M)(see the picture below where⋃Rx(M)is filled with the chessboard pattern). If for eachρithere existsρˆi∈Eh(M)prolongingρiand contained in⋃Rx(M)such thatσ(ρˆi)≥σ(ρi)thenM+γis an N2S-mesh,⋃Rx(M+γ)⊇⋃Rx(M)and all B-splines inLR(M+γ)∖LR(M)are obtained from a B-splines inLR(M)∖LR(M+γ)by inserting the abscissa of γ in the horizontal knot vector. Similarly if γ is a horizontal segment.ProofThe proof follows the pattern of the proof of Lemma 6. First we prove that ifB=B[Θx,Θy]∈LR(M)is split by the insertion of γ then any obtained B-splineB′=B[Θx′,Θy]is inLR(M+γ).Assuming that there isφ=B[Θx″,Θy]inS(M+γ)obtained fromB′by inserting a horizontal knot we reach the same contradiction as in Lemma 6. Now assume the existence ofφ=B[Θx′,Θy′]inS(M+γ)obtained fromB′by insertingθ¯inΘy. Let A be the set of the edges inEh(M+γ)contained inR×{θ¯}∩suppB′. Then for all α in A it holds(12)σ˜(α)=σ(α)≥μΘy′(θ¯)>μΘy(θ¯).Letαˆbe an edge in A that intersect γ. If it is possible to chooseαˆ⊂⋃Rxthen we reach a contradiction as in Lemma 6. Otherwise there must be an index i such thatαˆ=ρi. Then by the additional hypothesis it follows(13)σ˜(αˆ)=σ(ρi)≤σ(ρˆi)=μΘy(θ¯).Equations (12) and (13) contradict. ThusB′is inLR(M+γ)and as in Lemma 6 we conclude that⋃Rx(M+γ)⊇⋃Rx(M).Letφ∈LR(M+γ)be such thatB′≺φ. Then there existsφ′=B[Ξx,Ξy]∈LR(M)withB′≺φ≺φ′.Leta1<⋯<anbe the ordinates of the horizontal edges contained in suppB and intersecting γ. Letαi=[a,bi]×{ai}be the edge intersecting γ in the left endpoint at ordinateai. Note that ifαiis not contained in⋃Rx(M)then it must be one of theρj. Call itρji. Let(14)αˆi={αiifαi⊂⋃Rx(M),ρˆjiotherwise.Thussuppφ′contains all of theαˆiand since they are contained in⋃Rx(M)its knot vectorΞyis compatible with(a1,…,a1︸σ(αˆ1)times,…,an,…,an︸σ(αˆn)times).This and the fact thatB′≺φ′implyΞy=Θy. SinceB′≺φ≺φ′and all have the same vertical knot vector we conclude thatφ=B′. This proves thatM+γis an N2S mesh.  □When proving both Lemma 6 and Lemma 7 we derived the following partial result to which we will refer later.Corollary 8If γ satisfies the hypothesis ofLemma 6orLemma 7then the B-splines obtained from B-splines inLR(M)∖LR(M+γ)by the insertion of the knot corresponding to γ (either intoΘxorΘydepending on the direction of γ) belong toLR(M+γ).This means that, differently from the case of general LR splines, the addition of a segment does not trigger a chain of refinements, but only causes the refinement of the directly affected functions inLR(M).In this section we introduce a hierarchical construction of box meshes. By hierarchical we mean that it starts from a sequence of box meshes associated with nested tensor-product B-spline spaces (tensor meshes). After the definition we describe sufficient conditions for the N2S property.LetV0⊂…⊂Vmbe a sequence of nested tensor-product B-spline spaces having the same degree d and defined on the same domain Ω. LetBℓbe the canonical basis of the spaceVℓ. Each spaceVℓis defined by a pair of knot vectorsΘℓ=(Θxℓ,Θyℓ)whose components areΘxℓ=(θx,1ℓ,…,θx,nxℓℓ),Θyℓ=(θy,1ℓ,…,θy,nyℓℓ).In this construction we assume that at each step only one of the two components is refined: eitherΘxℓorΘyℓ. We say that the refinement at step ℓ is horizontal ifΘxℓ≠Θxℓ−1andΘyℓ=Θyℓ−1. Similarly we say that it is vertical ifΘxℓ=Θxℓ−1andΘyℓ≠Θyℓ−1.LetΩ0=Ω⊇…⊇Ωmbe a corresponding sequence of nested domains such that for each level ℓ the domainΩℓis a union of Bézier elements forVℓ. That meansΩℓ=⋃(s,t)∈Iℓ[θx,sℓ,θx,s+1ℓ]×[θy,tℓ,θy,t+1ℓ]whereIℓis a subset of{(i,j):i=1,…,nxℓ−1,j=1,…,nyℓ−1}. LetRℓbe the set of the elements from level ℓ contained inΩℓ, that meansRℓ={η=[θx,sℓ,θx,s+1ℓ]×[θy,tℓ,θy,t+1ℓ]:(s,t)∈Iℓ,η∘≠∅}.Definition 9Given a sequence of levels0,…,mas above, the associated hierarchical LR mesh isH=(R,σ)with(15)R=⋃ℓ=0m{η=β∖Ωℓ+1¯:β∈Rℓ,η≠∅}and σ defined in terms of the knot multiplicities as follows(16)σ(α)={μΘxℓ(a)ifα={a}×[e,f]∈EvμΘyℓ(e)ifα=[a,b]×{e}∈Ehwhere ℓ is the biggest index such thatΩℓ⊃α.Note that all the elements ofRare rectangles because at each step only one direction is refined. Note also that the elements inRare not necessarily Bézier elements for one of the spacesV0,…,Vm, see Fig. 4for a counterexample.Hierarchical LR meshes can be constructed by iteratively adding segments to a tensor mesh. This justifies the name. LetM0be the box mesh corresponding toV0. There are many possible choices of sequences of segmentsγ1,…,γNsuch that(…((M0+γ1)+γ2)+…)+γN=H.For our purposes it is convenient to define a canonical sequence that we will use in induction proofs. LetTℓ,ℓ=0,…,mbe the hierarchical box meshes associated to the levels0,…,ℓ. ThusT0is the mesh associated toV0andTm=H. We describe a sequences of additions that constructTℓfromTℓ−1. The canonical sequence is then the concatenation of these. Assume that the refinement at step ℓ is horizontal, then we add vertical segments. For eachi=1,…,nxℓwe add the connected components ofΩℓ∩({θx,iℓ}×R)in order of increasing ordinateμΘxℓ(θx,iℓ)−μΘxℓ−1(θx,iℓ)times. Similarly for vertical refinement steps.Restricting to hierarchical box meshes allows us to find sufficient conditions for the N2S property that can be expressed as constraints on the geometries ofΩ0,…Ωm. It is indeed sufficient for the N2S property that there is enough separation between the boundary ofΩℓand that ofΩℓ−1in the direction of the refinement. To describe this we introduce a separation distance.Definition 10Letp=(a,e)andq=(b,f)be points in Ω, then the vertical separation distance between p and q relative to level ℓ is a positive integer defined bysepyℓ(p,q)={#{j:θy,jℓ∈[e,f]}a=b,+∞a≠b.Similarly the horizontal separation issepxℓ(p,q)={#{j:θx,jℓ∈[a,b]}e=f,+∞e≠f.For a set of pointsA⊆Ωthe separationsepyℓ(p,A)is defined assepyℓ(p,A)=infq∈A⁡sepyℓ(p,q)and similarly forsepxℓ.Based on the above separations we define the shadow operatorsSℓthat map subsets of Ω to bigger subsets of Ω:SℓA={{p∈Ω:sepxℓ(p,A)≤dx}¯if the refinement at stepℓ+1is horizontal,{p∈Ω:sepyℓ(p,A)≤dy}¯if the refinement at stepℓ+1is vertical.See Fig. 5for an example ofSℓin which the refinement at stepℓ+1is horizontal.Theorem 11If the domains associated to the levels are such thatΩℓ⊇SℓΩℓ+1,ℓ=0,…,m−1thenHhas the N2S property.ProofWe prove the theorem by induction: we assume that•Tℓ−2andTℓ−1are N2S-meshes;if the refinement at levelℓ−1is horizontal thenΩℓ−1⊆⋃Rx(Tℓ−2);if it is verticalΩℓ−1⊆⋃Ry(Tℓ−2);Tℓis an N2S-meshΩℓ⊆⋃Rx(Tℓ−1)if the refinement at step ℓ is horizontal;Ωℓ⊆⋃Ry(Tℓ−1)if the refinement at step ℓ is vertical.First we prove thatΩℓ⊆⋃Rx(Tℓ−1). There are two cases: either the refinement at stepℓ−1is horizontal and thus the above holds as stated in Lemma 6 and Lemma 7 or the refinement at stepℓ−1is vertical. In the second case we prove that all elementsη=[a,b]×[e,f]ofR(Tℓ−1)that intersectΩℓare inRx(Tℓ−1). Letp=(px,py)be a point inη∘∩Ωℓandα1,…,αkbe the vertical edges inEv(Tℓ−1)that intersectR×{py}∩Ωℓ−1, see Fig. 6.Leta1,…,akbe their abscissa andZbe the knot vector(17)Z=(a1,…,a1︸μΘxℓ−1(α1),a2,…,a2︸μΘxℓ−1(α2),…,ak,…,ak︸μΘxℓ−1(αk)).Since allαiare contained inΩℓ−1⊆⋃Ry(Tℓ−2)it follows that for allB[Ξx,Ξy]∈LR(Tℓ−1)such thatsuppB[Ξx,Ξy]⊇η,Ξxis compatible withZ. Moreover by the definition of the shadow operator it holds(18)∑i:ai<pxμΘxℓ−1(ai)≥dx+1,∑i:ai>pxμΘxℓ−1(ai)≥dx+1,and thus we conclude thatsuppB[Ξx,Ξy]⊂[a1,ak]×R.Since all edges inRh(Mℓ−1)contained in[a1,ak]×{e}∩Ωℓ−1have multiplicityμΘℓ−1(e)it follows that e must be a knot inΞywith maximum multiplicity:μΞy(e)<μΘℓ−1(e)implies that e is either the first or the last knot. Similarly for f and thusΞyis compatible with(e,…,e︸μΘyℓ−1(e),f,…,f︸μΘxℓ−1(f)).SinceB[Ξx,Ξy]is arbitrary we conclude that η is contained in⋃Rx(Tℓ−1). Since also η is arbitrary we conclude thatΩℓ⊂⋃Rx(Tℓ−1).Recall thatTℓcan be obtained fromTℓ−1by a sequence of additions of segments. Letγ1,…,γNbe the segments described in Section 4.1 whose addition toTℓ−1producesTℓ. Then theγiare contained inΩℓ⊆Rx(Tℓ−1). The addition of theγisuch thatγi∘⊂(⋃Rx(Tℓ−1))∘preserves the N2S property according to Lemma 6. The others must satisfy the hypothesis of Lemma 7 because of the hierarchical construction. That is: γ cannot intercept pairs of aligned connected edges(δi,δe)withδi⊂⋃Rx(Tℓ−1),δe⊄⋃Rx(Tℓ−1)andσ(δe)>σ(δi). So the induction is proved.  □We are also interested in the completeness of the provided space, i.e. whetherLR(H)equalsS(H)or not. Describing which refinements preserve completeness was one of the themes of Dokken et al. (2013) and was pursued using homology based techniques. We restrict our attention to hierarchical LR meshes with the N2S property and we prove that if theΩℓare “thick enough” in the direction orthogonal to the refinement then the resulting space isLR(H)=S(H). This is made precise in the following result.Theorem 12LetHbe a hierarchical mesh satisfying the hypothesis ofTheorem 11: i.e. for allℓ=1,…,mit holdsΩℓ⊇SℓΩℓ+1.If for all horizontal refinement steps ℓ and all connected componentA={a}×[e,f]of{a}×R∩Ωℓit holds(19)sepyℓ((a,e),(a,f))≥dy+2,and similarly for vertical refinement steps and all connected componentA=[a,b]×{e}ofR×{e}∩Ωℓit holds(20)sepyℓ((a,e),(b,e))≥dx+2,thenLR(H)=S(H). SeeFig. 7for a graphical representation of the hypothesis.ProofAs described in Section 4,Hcan be obtained by refining the tensor meshM0corresponding to the spaceV0:H=M0+γ1+⋯+γn.LetMi=M0+γ1+⋯+γi. We know that completeness holds for tensor meshes and thus that#LR(M0)=dim⁡S(M0).We prove the induction stepLR(Mi−1)=S(Mi−1)⇒LR(Mi)=S(Mi).Assume thatMiis finer thanTℓ−1and coarser thanTℓand that refinement at step ℓ is horizontal. Thenγiis vertical segment contained in⋃Rx(Mi−1)and a connected component ofΩℓ∩{a}×R. Lete1,…,ekbe the ordinates of the intersections ofγiwith horizontal edges inEh(Mi−1),pi=(a,e1)andqi=(a,ek)be the endpoints ofγiandΞ=(e1,…,e1︸μΘyℓ−1(e1),e2,…,e2︸μΘyℓ−1(e2),…,ek,…,ek︸μΘyℓ−1(ek)).From Theorem 11 we know thatMiis an N2S mesh and thus from Theorem 4 that#LR(Mi)=dim⁡LR(Mi)≤dim⁡S(Mi).In order to prove the induction step we show thatΔLR≥ΔSwhereΔLR=#LR(Mi)−#LR(Mi−1)andΔS=dim⁡S(Mi)−dim⁡S(Mi−1).Reasoning as in the proof of Theorem 11, we deduce thatγisatisfies the hypotheses of Lemma 6 or Lemma 7. Thus Ξ is compatible with all the vertical knot vectorsZyof the B-splinesB[Zx,Zy]∈LR(Mi−1)such that(suppB[Zx,Zy])∩γi≠∅. This means that all theZyas above are composed ofdy+2consecutive knots of Ξ.SinceMiis an N2S mesh, it follows (Bressan, 2013, Lemma 3.4) that for each pointv=(vx,vy)and integerss∈{1,…,dx+1},t∈{1,…,dy+1}there existsB[Zx,Zy]∈LR(Mi−1)such that#{ζ∈Zx:ζ≤vx}=s,#{ζ∈Zy:ζ≤vy}=t.For each edge that is contained inγi, we apply this result to one inner point choosings=dx+1and considering all possible values of t. We then observe that for each knot vector composed ofdy+2consecutive knots of Ξ, there exists at least one B-spline inLR(Mi−1), which is defined by this knot vector with respect to the y-direction and by another one with respect to the x-direction. This B-spline is refined by the addition ofγiand the obtained B-splines are inLR(Mi), see Corollary 8. ConsequentlyΔLR≥∑i=1kμΘyℓ−1(ei)−dy−1=sepyℓ−1(pi,qi)−dy−1.Dokken et al. (2013, Theorem 5.5) provide a formula fordim⁡S(Mi). The formula is based on previous research from Mourrain (2014). From the formula it follows that(21)ΔS=sepyℓ(pi,qi)−dy−1+h0(Mi)−h0(Mi−1)−h1(Mi)+h1(Mi−1)whereh0,h1are two non-negative functions of the mesh that can be computed with homological techniques. According to Dokken et al. (2013, Note 1 after Theorem 5.5),h0(Mi)=0ifS(Mi)≠{0}and this is our case. The homological termh1(M0)is 0 (Note 2) since the initial mesh is a tensor-product mesh. Moreoverh1(Mi)is non-increasing with respect to i because of (19), (20) and Dokken et al. (2013, Note 3). Consequently, all homological terms vanish and we may complete the proof of the induction step by observing that(22)ΔLR≥sepyℓ(pi,qi)−dy−1=ΔS.□In a slightly different setting, the fact that the homological terms vanish when the mesh is constructed from a tensor mesh by adding a sequence of “long enough” segments was already stated by Mourrain (2014, Theorem 3.7).In this subsection we present a construction for hierarchical box meshes that guarantees both the N2S property and completeness. We assume that the spacesV0,…,Vmare fixed and that a minimum refinement level is specified for some regions.The input of our construction is a sequence ofω1,…,ωmof subsets ofΩ=[0,1]2and the output is a mesh such that all basis functions that are active on a point inωℓare refinements of basis functions fromBℓ. Theωℓdo not need to be nested and can be empty. For example they can be a discrete set of points, a curve or a region or a union of those.Fromω1,…,ωmwe construct the domainsΩ1⊇…⊇Ωmstarting fromΩmand back toΩ1. First we define the auxiliary setsω˜ℓforℓ=1,…,m:ω˜ℓ=⋃{suppB:B∈Bℓ,suppB∩ωℓ≠∅}.SetΩmtoω˜m. ThenΩℓ−1withℓ=m−1,…,1is defined to be(23)Ωℓ−1=ω˜ℓ−1∪Sℓ−1Ωℓ.By construction the domains associated to the levels satisfy Lemma 11 and Lemma 12 and thusHis an N2S-mesh for whichLR(H)=S(H).We conclude this section with some examples of the meshes constructed with our method in case of dyadically refined knot vectors. LetΘxℓ=[0,…,0︸dx+1times,…k2⌈ℓ/2⌉…,1,…,1︸dx+1times],0<k<2⌈ℓ/2⌉Θyℓ=[0,…,0︸dy+1times,…k2⌊ℓ/2⌋…,1,…,1︸dy+1times],0<k<2⌊ℓ/2⌋.We show the meshes constructed from the input regionsω1,…,ωmwithωℓ={Gℓ=m,∅otherwisefor different choices of G and m.In Fig. 8the set G is a polygonal chain composed of two segments and m is4,6,8,10,12,14. In Fig. 9it is a spiral centered in(0.5,0.5)and m is4,6,8,10,12,14. In both figures the degree isd=(2,2).As can be seen in Figs. 8 and 9 the refined region follows G closely and does not propagate. This statement can be made more precise. For simplicity we assume that the degree is the same in both coordinate directionsdx=dy=dand that the maximal level m is even.The size of an elementη=[a,b]×[e,f]∈R(H)contained inΩℓ∖Ωℓ+1is bounded by2−⌈ℓ/2⌉−1≤b−a≤2−⌈ℓ/2⌉2−⌊ℓ/2⌋−1≤f−e≤2−⌊ℓ/2⌋.The distance of such an element fromωmcan be estimated using a geometric sum. Indeed the distance betweenωmand∂Ωmis in[d2−m/2,(d+1)2−m/2+1/2].The operatorSℓ−1extends the domainΩℓin one direction by a length contained betweend2−ℓ/2+1and(d+1)2−ℓ/2+1. It follows that the distance betweenΩℓand the boundary ofΩℓ−2(in the case of ℓ even) is contained betweend2−ℓ/2+1and(d+1)2−ℓ/2+3/2.The distance betweenη⊆Ωℓ∖Ωℓ+1andωmcan be bounded using a geometric sum and forℓ<m−1it is contained in[d(2−ℓ/2−2−m/2),23/2(d+1)2−ℓ/2].So we proved that any point contained in an element of size≈2−ℓ/2is at a distance≈2−ℓ/2fromωm. This means that the obtained meshes are geometrically refined only near the requested regions.It is interesting to compare the described approach with the THB-spline approach developed by Giannelli et al. (2012) and Mokriš et al. (2014). We do this in the simplified setting in whichΩℓis a union of rectangles of levelℓ−1. In this setting we can compare the spaceLR(H)to the THB-spline spaceTH(H)having the same Bézier elements and defined from the same levels. This means thatLR(H)andTH(H)are defined by the same sequence of tensor-product spacesVℓand domainsΩℓ.The hierarchical spline construction selects a subsetCℓfrom the tensor-product basisBℓofVℓ. PreciselyCℓ={B∈Bℓ:suppB⊆Ωℓ∧suppB⊈Ωℓ+1}.The set of generators is then⋃ℓ=0mCℓ.The THB-spline approach uses the same selection procedure, but the selected B-splines are truncated in order to guarantee that they are a partition of unity and to obtain better locality. In particular each B-spline B selected from level ℓ whose support intersectsΩℓ+1is replaced by the functionBˆℓ+1obtained by expressing B as a linear combination of B-splines from levelℓ+1and by setting the coefficients of the B-splines inCℓ+1to 0. The procedure is then repeated for each lower levelℓ+2,…,m. At this point the collection of truncated B-splines is taken as the basis of the space. The truncated functions are always a partition of unity.The spaceTH(H)is a subset ofS(H)and equality is proved for meshes such that for each level ℓ andB∈Cℓthe intersection(suppB)∘∩(Ω∖Ωℓ+1)is connected. Sharper results can be obtained for specific degrees and weaker conditions are needed for the decoupled version of the THB-basis that was proposed by Mokriš et al. (2014). This condition is not always satisfied by the type of meshes we are considering as can be seen in Fig. 10.So in selected cases the space we are proposing is bigger than the THB-spline space. Two other advantages are that the basis functions are B-splines and that the basis functions are locally linearly independent.On the other hand the locality of the refinement with our approach is degree dependent and decreases as the degree increase. This does not happen in the THB-spline setting. Related to this is the fact that THB-splines do not require “alternating” refinement and thus can be refined more locally.

@&#CONCLUSIONS@&#
We restrict our attention to the subset of bi-variate box meshes that have the N2S-property. We describe two subdomains of Ω where respectively vertical and horizontal refinement preserves the N2S property. Using this knowledge we provide an explicit construction that is based on a hierarchy of tensor spaces and domains. The LR-space associated to the constructed meshHhas the N2S property, i.e. it has a basis of locally linearly independent functions. MoreoverLR(H)is the whole spaceS(H)of piecewise polynomials associated to the mesh.The fact that our construction guarantees the N2S property is based on the results from Bressan (2013) that apply to the n-variate case. It seems thus reasonable that the construction can be generalized to n-variate case with similar definitions and proofs. Future work will be devoted to the generalization of Lemmas 6 and 7 to this situation. The proof of completeness (Theorem 12), however, relies on the results from Mourrain (2014) that are available for bi-variate splines only. It is expected that more effort is required to extend the completeness proof to n-variate constructions. Some results concerning the homology term for 3D meshes are reported in Berdinsky et al. (2014).