@&#MAIN-TITLE@&#
Computationally efficient MIP formulation and algorithms for European day-ahead electricity market auctions

@&#HIGHLIGHTS@&#
We provide a new MIP formulation of the European day-ahead electricity market problem, avoiding complementarity constraints and auxiliary variables.We also derive a Benders decomposition procedure with locally strengthened cuts.Computational tests are carried out on real data provided by main European power exchanges.Both approaches are very powerful, depending on the type of the instance.

@&#KEYPHRASES@&#
Integer programming,OR in energy,Auctions/bidding,Large scale optimization,

@&#ABSTRACT@&#
We consider the optimization problem implementing current market rules for European day-ahead electricity markets. We propose improved algorithmic approaches for that problem. First, a new MIP formulation is presented which avoids the use of complementarity constraints to express market equilibrium conditions, and also avoids the introduction of auxiliary continuous or binary variables. Instead, we rely on strong duality theory for linear or convex quadratic optimization problems to recover equilibrium constraints. When so-called stepwise bid curves are considered to describe continuous bids, the new formulation allows to take full advantage of state-of-the-art MILP solvers, and in most cases, an optimal solution including market prices can be computed for large-scale instances without any further algorithmic work. Second, the new formulation suggests a Benders-like decomposition procedure. This helps in the case of piecewise linear bid curves that yield quadratic primal and dual objective functions leading to a dense quadratic constraint in the formulation. This procedure essentially strengthens classical Benders cuts locally. Computational experiments using 2011 historical instances for the Central Western Europe region show excellent results. In the linear case, both approaches are very efficient, while for quadratic instances, only the decomposition procedure is appropriate. Finally, when most orders are block orders, and instances are combinatorially very hard, the direct MILP approach is substantially more efficient.

@&#INTRODUCTION@&#
The liberalization of electricity markets in developed countries has led to market design and algorithmic issues addressed now for many years, that still provide with interesting research questions. In Europe, efforts are currently made toward greater integration of electricity markets, with for example the Price Coupling of Region (PCR) project supported by the Europex consortium (Europex, 2012). In the particular case of day-ahead markets and related power exchanges, this integration relies on a common market model whose underlying algorithmic problem is the main subject of this article. This market model has been studied previously, and from different points of view (Martin et al., 2014; Meeus et al., 2009; Van Vyve, 2011; Zak et al., 2012). It is more generally an interesting model for such combinatorial auctions. Our contribution here is the presentation of new algorithmic results relying on a new MIP formulation. Well-known issues in non-convex electricity markets are recalled in Section 1.1, European market rules in Section 1.2, while Section 1.3 details the contribution and structure of the rest of the article.Day-ahead electricity markets are designed as two-sided auctions in which participants submit orders to buy or sell electric power during some hours of the following day, in some given areas. A market operator collecting these orders is in charge of defining an optimal matching, as well as market prices. Participants agree on a set of rules driving the clearing process, such as rules for bid acceptance and price determination (Stoft, 2002). Order matching and market prices depend in particular on network constraints, and computed prices should ideally support a market equilibrium (for price-taker participants, the market clears for these prices and no excess demand/supply remains, see e.g. Mas-Colell et al., 1995). The literature about ‘equilibrium among spatially separated markets’, thought in a different setting, has been studied in Enke (1951),Samuelson (1952), and Takayama and Judge (1971). Samuelson has proposed the term Cournot–Enke equilibrium(Samuelson, 1952) for such kinds of equilibria.The most complicating feature in day-ahead electricity markets, from both the market design and algorithmic perspectives, is the fact that some orders may be non-convex, in the sense that they yield, in the mathematical formulation of the market clearing problem, objects that do not have the convexity property (e.g. non-convex feasible sets). For example, a participant can submit a block order for which a “fill-or-kill condition” must hold: the order can only be fully accepted or fully rejected. These block orders allow participants to reflect more accurately their production constraints and cost structures. This is mainly due to (i) non-convex production sets (e.g. minimum output levels at which a plant can operate) and (ii) fixed (start-up) costs (Meeus et al., 2009).A primal program optimizing welfare and defining the optimal selection of bids ensures that the allocation is dispatchable, i.e. respects network security constraints. When there are no non-convexities (e.g. no block orders), it is well-known that optimal dual variables (shadow prices) of this primal program provide with equilibrium prices, as expressed by complementarity constraints relating primal and dual optimal variables. In a mixed integer context, classical strong duality fails, and it is also well-known that a market equilibrium with uniform prices is most of the time mathematically impossible (Gabriel et al., 2012; O’Neill et al., 2005; Ruiz et al., 2012; Van Vyve, 2011; Zak et al., 2012). Uniform prices mean that payments depend only and proportionally on exchanged quantities, via the unique commodity price per time slot and market area, or the price per transmission resource. In particular, this prevents the use of transfer payments for executed bids that would otherwise incur a loss to the bidder. These elements are formally recalled below.Several interesting approaches have been proposed to clear electricity markets with non-convexities. O’Neill et al. (2005) propose to solve a primal problem, then to fix integer variables to their optimal value to obtain a convex program whose optimal dual variables are used to form contracts yielding an equilibrium situation. Gribik et al. (2007) propose a ‘convex hull’ approach where transfer payments (uplifts) ensuring a market equilibrium are minimized, while Ruiz et al. (2012) propose to use uniform prices in such a way that producers recover their costs, and minimizing the duality gap caused by integer constraints. Other propositions are given in Araoz and Järnsten (2011),Bjørndal and Järnsten (2008),Toczyłowski and Zoltowska (2009), and Van Vyve (2011). Except Ruiz et al. (2012), all these propositions implement non-uniform pricing schemes.In Europe, the choice has been made to use uniform prices to avoid discriminating participants. The chosen counterpart is that some block orders providing with a gain to the bidder for the computed market prices may be paradoxically rejected, and are not financially compensated. This is for example the solution adopted in coupled markets such as CWE (Central Western Europe market, pooling Belgium, France, Germany, Luxembourg and the Netherlands), which has just been extended to the North Western Europe market (NWE), including Nordic-Baltic countries and Great-Britain. The market clearing optimization problem of these markets is the main topic of this article, see Cosmos (2011) for a full list of requirements. The only requirements of CWE not included in the model we consider below are linked and exclusive block orders, but adding them is straightforward and would only make notations less clear.The classical way to formulate common European market requirements in a mathematical model is via the addition of dual and complementarity constraints to the primal program defining feasible dispatches. These complementarity constraints form a subset of those that would be a consequence of duality theory holding in a well-behaved convex situation (without block orders), see Martin et al. (2014); Van Vyve (2011). To handle these formulations, special purpose algorithms have been designed. The two best algorithms so far have been developed independently Cosmos (2011); Martin et al. (2014),Cosmos (2011) being used in practice in the CWE region since 2010, and on which the algorithm described in Euphemia (2013) used in the NWE region is based. Both are decomposition-based branch-and-bound algorithms solving a main optimization problem and adding cuts to exclude incumbents for which no uniform prices fulfilling auction requirements exist.On the other hand, so far, all mixed integer linear programming formulations proposed are using auxiliary variables. For example, Meeus et al. (2009) use a formulation with auxiliary binary variables equal to twice the number of hourly (continuous) orders, and is intractable as such when dealing with real large-scale instances. This is similar to the formulation that could be obtained by linearising complementarity constraints, also introducing at least two binary variables per hourly order. A last recent proposition (Zak et al., 2012) needs a number of auxiliary variables proportional to the number of block orders and submarkets (a given location and time slot), and is also not suitable for large-scale instances, according to numerical results presented.In this article, we provide with a non-trivial reformulation of the European Market Model (EMM) that has several advantages. Precisely, we show how EMM can be modelled as a mixed integer linear program without the introduction of auxiliary variables, when stepwise bid curves (see definitions below) are considered, beside block orders and network constraints. When piecewise linear bid curves are considered, EMM can be formulated as a mixed integer quadratically constrained program (MIQCP) with one non-linear convex quadratic constraint (with integer variables). In the linear case, the new formulation allows to take full advantage of the power of well-known state-of-the-art MILP solvers, and we are able to solve real large-scale instances without further algorithmic work. In both cases, the new formulation allows the use of a classical Benders decomposition. In particular, we derive in Section 4 a Benders-like decomposition procedure with cuts that are stronger than those proposed in Martin et al. (2014). The new cuts are obtained by strengthening classical Benders cuts derived from the new formulation locally (i.e. in branch-and-bound subtrees, using information provided by node solutions). This decomposition algorithm is needed when piecewise linear bid curves are considered, since today solvers are not able to deal with large-scale MIQCP problems of the kind presented below.The organization of the paper is the following. Section 2.1 recalls with the notation of the article well-known results about market equilibrium with uniform prices in the presence of indivisible orders. Sections 2.2 and 2.3 present known MPCC formulations (Martin et al., 2014; Van Vyve, 2011) of EMM with stepwise bid curves and with general piecewise linear bid curves respectively. Adaptations presented in Section 2.3 use the classical Dorn’s quadratic programming duality results. In Section 3, we present the new MIP formulations in both the linear and the quadratic case. In Section 4, we show how to derive a decomposition procedure by the use of a Benders-like argument, again both in the linear and quadratic cases. Finally, Section 5 is devoted to computational experiments.We first fix the notations, describe the market coupling problem (Cosmos, 2011; Gabriel et al., 2012; Martin et al., 2014; Meeus, 2006; Van Vyve, 2011), and recall why a market equilibrium with uniform prices (see definition below) most of the time does not exist in the presence of indivisible orders.Sets:I is the set of (continuous) hourly orders, J is the set of block orders, and K is the set of network elements (e.g. high voltage power lines or nodes, depending on the network model). The set of bidding locations and time slots are L and T respectively, while N is a set indexing network constraints.Decision variables: The variables xi∈ [0, 1], i ∈ I and yj∈ {0, 1}, j ∈ J are decision variables which define the level of execution of a given order. The other variables nkare used to describe feasible dispatches, according to the network model (see below).Objective function: The market coupling problem is modelled as a welfare maximisation program. This amounts to maximize the total seller and buyer surplus.For each time slot t ∈ T and each location l ∈ L, participants submit a piecewise linear bid curve specified by a finite set of breakpoints {(Qs, Ps)}s ∈ S. These bid curves give the limit (buy or sell) prices, in relation to bid quantities (see Fig. 1). Aggregated supply and demand bid curves are then computed, containing all the information needed for the clearing process. Each two consecutive points (Qs, Ps) and (Qs + 1, Ps + 1) correspond to a hourly order i of quantity Qi= (Qs + 1 − Qs). The decision variable xidetermines which fraction of this quantity is executed.For offer bid curves, Ps≤ Ps + 1 (the curve is non-decreasing), while for demand bid curves, Ps≥ Ps + 1 (the curve is non-increasing). Stepwise bid curves are such that Ps= Ps + 1 if Qs≠ Qs + 1 while for piecewise linear bid curves in general, one can have Ps≠ Ps + 1 and Qs≠ Qs + 1. An hourly order i ∈ I always comes from a bid curve corresponding to a given area and a given time slot. However, we will be slightly more general, allowing an order to bid quantities in several areas and time slots. This eases the formal description of the market clearing problem. The parameters associated to an hourly order i are: Pi,Ql,ti,for step orders, andP0i,P1i,Ql,tifor interpolated orders which come from general piecewise linear bid curves. For example, according to the left diagram of Fig. 1, a decision variable x1 is associated to an order with bid quantity Q1 ≔ (Q2 − Q1) and a bid price P1 ≔ P1 = P2. We deal with piecewise linear bid curves and interpolated orders in Section 2.3. Instead of partitioning all orders into the sets of buy orders and sell orders, quantities for buy orders are counted positively, and negatively for sell orders. This is convenient to derive economic interpretations, to state network balance constraints, or the welfare maximizing objective.Block orders: In practice, a block order j ∈ J is related to a given area l ∈ L and specified by a price Pjand quantitiesQtjfor several periods t ∈ T. However, we will again be slightly more general, allowing to consider quantities over multiple areas. The parameters for a block j are PjandQl,tj. The binary decision variable yjdetermines if the order is entirely accepted or entirely rejected. Again, quantities are counted positively for buy orders, and negatively for sell orders.The DC linear network model in Ruiz et al. (2012), or the network models currently used in European day-ahead markets such as the “Available-to-Transfer Capacity” model (ATC) (Cosmos, 2011; Euphemia, 2013; Martin et al., 2014) or flow-based models (FB) relying on so-called PTDF matrices (Cosmos, 2011; Euphemia, 2013; Gabriel et al., 2012), are all linear network representations. We therefore consider an abstract and very general linear network model to emphasize the fact that the new algorithmic approaches we propose here work with all these usual models. In this setting, the set K contains network elements (inter-connectors or network nodes), variables nkdenote quantities related to each element, and coefficientsel,tkin (4) describe, for a given submarket (l, t), how these elements are related to the net export position of this market. Then, constraints (5) describe the most general kind of linear constraints on these network elements. For example, in the case of ATC models, the set K denotes the set of cross-border lines, variables nkcorrespond to flows through these lines, and constraints (5) would then be capacity constraints on these flows. For flow-based models, they correspond to ‘critical network elements’ (Cosmos, 2011).DA-PRIMAL:(1)maxxi,yj,nk∑i(∑l,tQl,tiPi)xi+∑j(∑l,tQl,tjPj)yjsubject to:(2)xi≤1∀i∈I[si](3)yj≤1∀j∈J[sj](4)∑iQl,tixi+∑jQl,tjyj=∑kel,tknk,∀(l,t)∈L×T[pl,t](5)∑kam,knk≤wm∀m∈N[um](6)xi,yj≥0,∀i∈I,j∈J(7)yj∈Z∀j∈JLet us consider the continuous relaxation of DA-PRIMAL, denoted by DA-CR. Its dual is:DA-CR-DUAL:(8)minsi,sj,pl,t,um∑isi+∑jsj+∑mwmumsubject to:(9)si+∑l,tQl,tipl,t≥∑l,tQl,tiPi∀i∈I[xi](10)sj+∑l,tQl,tjpl,t≥∑l,tQl,tjPj∀j∈J[yj](11)∑mam,kum−∑l,tel,tkpl,t=0∀k∈K[nk](12)si,sj,um≥0∀i∈I,j∈J,m∈NAnd the related complementarity conditions are:DA-CC(13)si(1−xi)=0∀i∈I(14)sj(1−yj)=0∀j∈J(15)xi(si+∑l,tQl,tipl,t−∑l,tQl,tiPi)=0∀i∈I(16)yj(sj+∑l,tQl,tjpl,t−∑l,tQl,tjPj)=0∀j∈J(17)um(∑kam,knk−wm)=0∀m∈NSolving the market coupling problem implies to find prices supporting, ideally, a market equilibrium. In a convex situation where all orders are continuous orders, classical shadow prices (pl, t, umhere) are uniform equilibrium prices (see definitions below) for the optimal bid allocation. We review here this equilibrium property implied by dual and complementarity constraints.Definition 1Uniform pricesA price system for the auction process will be called a system of uniform prices if all money transfers between market participants depend only and proportionally on a single commodity price pl, tper location l ∈ L and time slot t ∈ T.Let pl, tbe uniform prices. An hourly or block order i ∈ I∪J is said to be:(i)in-the-money (ITM) if∑l,tQl,ti(Pi−pl,t)>0. This essentially means that for the given market prices, the bidder (producer or consumer) has an economic surplus. For hourly orders, since an order has a precise location and time slot, the sum has only one termQl0,t0i(Pi−pl0,t0). So ifQl0,t0i<0(sell order), thenPi<pl0,t0and ifQl0,t0i>0(buy order), thenPi>pl0,t0.at-the-money if∑l,tQl,ti(Pi−pl,t)=0. For hourly orders, this meansQl0,t0i(Pi−pl0,t0)=0,and (assumingQl0,t0i≠0),Pi=pl0,t0: both bid and market prices are equal.out-of-the-money if it is not ITM nor ATM (i.e. its execution would incur a loss):∑l,tQl,ti(Pi−pl,t)<0.For a given primal solution (x, y, n) and prices p, there is a network equilibrium if there exist network resource prices um≥ 0, m ∈ N such that (11) and (17) hold. When the abstract network model is specialized to usual linear network models (e.g. ATC or flow-based (Cosmos, 2011)), these conditions mean that transmission of electricity has a value only if transmission capacities are scarce. The network resource prices are given by the variables um≥ 0, m ∈ N. In that situation, for the given market prices, the TSO cannot be more profitable by transporting more or less electricity than in the current situation.Let us note that for an ATC network model (Cosmos, 2011), a price difference pl, t< pk, tcan only occur when the line from the market with lower price to the market with higher price is congested. In that case the price difference equals the congestion price.Definition 4Market equilibrium with uniform pricesLet (x*, y*, n*) be a feasible point for DA-PRIMAL, i.e. satisfying (2)–(7), and p* uniform prices. Then (x*, y*, n*) and p* form a market equilibrium with uniform prices if and only if:I.(a) Fully executed orders are ITM or ATM, (b) fractionally executed orders are ATM, and (c) rejected orders are ATM or OTM.Network equilibrium conditions, given at Definition 3, are satisfied.The definition essentially means that for the given pricespl,t*,no excess demand or excess supply remains, and no other level of execution could be more profitable to the bidders or the TSO. For example, for a given order i:∀xi∈[0,1],∑l,tQl,ti(Pl,ti−pl,t*)xi≤∑l,tQl,ti(Pl,ti−pl,t*)xi*.The two following results are then classical. Proofs are given in Appendix A.Theorem 1Let (x*, y*, n*) be a feasible point for DA-PRIMAL, i.e. satisfying (2)–(7).(I)A market equilibrium with uniform prices exists if and only if there are dual variablessi*,sj*,pl,t*,um*such that dual and complementarity constraints (9)–(17) are satisfied.This is the case if and only if (x*, y*, n*) is optimal for the continuous relaxation DA-CR,si*,sj*,pl,t*,um*is optimal for the dual DA-CR-DUAL, and both objective values are equal.Consider DA-PRIMAL (i.e. the primal program, including integer constraints). There exists a solution (x, y, n) and uniform pricespl,t*forming a market equilibrium if and only if the continuous relaxation DA-CR admits an optimal solution(xi*,yj*,nk*)withyj*∈Z,∀j∈J.Theorem 1 and Corollary 1 show that a market equilibrium with uniform prices exists if and only if there is no duality gap caused by integer constraints, which is not the case for most instances.We describe here the model used everyday in Europe to clear day-ahead markets (Cosmos, 2011) and recall its classical MPCC formulation (Martin et al., 2014; Van Vyve, 2011). Since a market equilibrium with uniform prices often does not exist, the solution adopted in Europe is to compute uniform prices such that hourly orders and the network are both ‘at equilibrium’, and only paradoxically rejected block orders (PRB) are tolerated as deviations from a perfect market equilibrium. These PRB, if executed with the given market prices, would provide with a gain to the bidder, but are rejected by the market operator.Market clearing price range condition: The following technical condition (used in Theorems 2 and 3) rules out arbitrarily large market clearing prices.(18)pl,t∈[−P¯,P¯]∀(l,t)∈L×THereP¯can be chosen large enough to avoid making infeasible any extreme solution of the feasible set (see Lemma 2.1 in Papadimitriou and Steiglitz, 1998 for example). However, let us note that in practice, bid prices are constrained to lie in a range[−P¯bid,P¯bid],andP¯is set toP¯bid,which is usually fine, though in some rare cases can make the problem infeasible. See also O’Neill et al. (2005) on related issues about ranges for bid prices and market clearing prices.Definition 5European pricesThe main requirements of EMM are: (i) uniform prices, (ii) OTM orders must be rejected (block and hourly orders as well), (iii) ITM hourly orders must be accepted, (iv) network equilibrium constraints must be satisfied and (v) computed market prices must lie in a specified interval[−P¯,P¯].The classical way to state a maximisation problem formulating European market rules is to write primal, dual and all complementarity constraints excepted those of type (14) (see e.g. Van Vyve (2011)). According to the interpretation given above, this corresponds to drop for block orders the requirement that they should be accepted if they are ITM. This yields a mathematical program with complementarity conditions (MPCC).EMM-MPCC:(19)maxx,y,n,p,u∑i(∑l,tQl,tiPi)xi+∑j(∑l,tQl,tjPj)yjsubject to constraints: Primal and dual constraints: (2)–(7), (9)–(12), the price range condition (18) and the subset of complementarity constraints: (13), (15)–(17), but not subject to complementarity constraints of type (14).This formulation involves non-linear constraints, and instances, which are very large in practice, would be hard or even impossible to solve as it is with current MINLP solvers. For this reason, special purpose algorithms have been designed (see above).The adaptation needed to consider piecewise linear bid curves rely on duality results for convex quadratic programs. We first recall the market equilibrium conditions expressed by dual and complementarity constraints in this different setting. Let us consider the right diagram of Fig. 1. A segment of a piecewise linear bid curve now corresponds to an hourly order with a price P0 at which the order starts to be accepted, a price P1 at which it is fully accepted, and bid prices for intermediate quantities are obtained by linear interpolation (see e.g. the hourly order associated with the first segment and variable x1 in the right diagram of Fig. 1). For a sell order i,P1i≥P0i(because the bid curve is non-decreasing), while for a buy order i,P1i≤P0i(because the bid curve is non-increasing). The objective function giving the welfare now depends quadratically on the levels of executions xi(cf. the area below a bid curve segment limited by an execution level xi).DA-PRIMAL-QUAD:(20)maxxi,yj,nk∑i(∑l,tQl,tiP0ixi+∑l,tQl,ti(P1i−P0i)xi22)+∑j(∑l,tQl,tjPl,tj)yjsubject to (primal constraints remain unchanged): (2)–(7)The objective function is trivially concave as factorsQl,ti(P1i−P0i)are non-positive, and the continuous relaxation of DA-PRIMAL-QUAD, noted DA-QUAD-CR, is a convex quadratic program. Strong duality still holds in this setting (see e.g. Dorn (1958); Geoffrion (1971); Vajda (2009)). Compared to the dual DA-CR-DUAL above, the dual objective function has additional quadratic terms:DA-QUAD-CR-DUAL:(21)minsi,sj,pl,t,um,vi∑isi+∑jsj+∑mwmum−∑i(∑l,tQl,ti(P1i−P0i))vi22and feasibility inequalities of type (9) in DA-CR-DUAL have an additional linear term:(22)si+∑l,tQl,tipl,t≥∑l,tQl,tiP0i+∑l,tQl,ti(P1i−P0i)vi∀i∈I[xi],while other constraints (10)–(12) remain unchanged.Lemma 1If (x, y, n) is an optimal solution of the continuous relaxation DA-QUAD-CR, there exists a dual optimal solution (si, sj, pl, t, um, vi) such that vi= xi∀i ∈ I.It is a direct application of Dorn’s quadratic duality theorem (see e.g. Dorn (1958),Geoffrion (1971) or Vajda (2009)).□When stating primal, dual and complementarity constraints, or primal and dual constraints with equality of objective functions, we will thus be allowed to replace viwith xi, since such a solution of the dual program exists. This is indeed needed for the economic interpretations.Concerning complementarity constraints, compared to the previous case with stepwise bid curves and complementarity constraints (13)–(17), one has just to replace complementarity constraints of type (15) by:(23)xi(si+∑l,tQl,tipl,t−∑l,tQl,tiP0i−∑l,tQl,ti(P1i−P0i)xi)=0Lemma 1 has been used to replace viby xi. Using this, the definition of ITM, ATM or OTM can be adapted for these interpolated hourly orders, as well as Theorem 1 and Corollary 1:Definition 6Bid surplus for hourly orders, quadratic settingLet pl, tbe a set of uniform prices and xithe execution level of the hourly order i. The order is said to be:(i)in-the-money (ITM) if∑l,tQl,ti(P1i−pl,t)>0. Recalling that there is in practice only one term in the sum and the sign convention for quantities, this means thatpl,t>P1ifor sell orders andpl,t<P1ifor buy orders.at-the-money (ATM) if∑l,tQl,tiP0i+∑l,tQl,ti(P1i−P0i)xi=∑l,tQl,tipl,t,with xithe execution level. In this case, again considering orders for one market segment (l0, t0):pl0,t0is equal toP0i+(P1i−P0i)xi,i.e. the market price equals the interpolated bid price given by the piecewise linear bid curve for this level of execution.out-of-the-money (OTM) if∑l,tQl,tiP0i<∑l,tQl,tipl,t. This means thatpl,t<P0ifor sell orders andpl,t>P0ifor buy orders.Definition 4 of a market equilibrium with uniform prices given above is still valid when considering interpolated hourly orders and Definition 6. The adaptations of Theorem 1 and Corollary 1 are straightforward and only concern constraints related to hourly orders: just replace dual and complementarity constraints (9) by (22) and (15) by (23), respectively. Lemma A.3 in Appendix A details what needs to be adapted in Lemmas A.1 and A.2 of Appendix A to prove the analogue of Theorem 1 for markets with piecewise linear bid curves.EMM-QUAD-MPCC:As in the previous case, a MPCC formulation here denoted EMM-QUAD-MPCC can be given by just replacing in the formulation EMM-MPCC the welfare objective function by the quadratic one (20), as well as dual constraints (9) by (22) (using Lemma 1 to replace viby xias above), and complementarity constraints (15) by (23).When stepwise bid curves are considered beside block orders, the new formulation consists in an exact linearisation of EMM-MPCC, avoiding the use of any auxiliary variable. When more generally piecewise linear bid curves are considered as well, EMM-QUAD-MPCC can be reformulated as a MIQCP with one convex quadratic constraint (with integer variables). The advantage of these new formulations is twofold. First, in the MILP case, it allows to solve real large-scale instances without any special purpose algorithm, using state-of-the-art MILP solvers. Second, one can derive in both cases a Benders-like decomposition algorithm, particularly useful to deal with piecewise bid curves where a MIQCP must be solved. The strengthened Benders cuts obtained improve on the exact cuts provided in Martin et al. (2014), also using Benders decomposition to solve a formulation similar to the formulation EMM-QUAD-MPCC. These cuts are derived in Section 4.The new formulation involves all primal and dual constraints as well as an equality of objective functions condition (instead of a subset of complementarity constraints). To ensure the existence of a solution and to reflect the choice of allowing some ITM block orders to be rejected, dual constraints of type (10) are modified, yielding constraints of type (31) below, where the Mjare large enough to deactivate the constraint when yj= 0, and chosen in such a way that constraints (31) do not reduce the range of prices given by the market rule (18). Using the price range conditions above, it is direct to see thatMj:=∑l,t2P¯|Ql,tj|is a sufficient choice.EMM-MILP:(24)maxx,y,n,p,u,s∑i(∑l,tQl,tiPi)xi+∑j(∑l,tQl,tjPj)yjsubject to:pl,t∈[−P¯,P¯]∀(l,t)∈L×T(18)(25)∑i(∑l,tQl,tiPi)xi+∑j(∑l,tQl,tjPj)yj≥∑isi+∑jsj+∑mwmum(26)xi≤1∀i∈I(27)yj≤1∀j∈J(28)∑iQl,tixi+∑jQl,tjyj=∑kel,tknk,∀(l,t)∈L×T(29)∑kam,knk≤wm∀m∈N(30)si+∑l,tQl,tipl,t≥∑l,tQl,tiPi∀i∈I(31)sj+∑l,tQl,tjpl,t≥∑l,tQl,tjPj−Mj(1−yj)∀j∈J(32)∑mam,kum−∑l,tel,tkpl,t=0∀k∈K(33)xi,yj,si,sj,um≥0,yj∈Z∀i∈I,∀j∈J,∀m∈NTheorem 2The formulation EMM-MPCC and the new MILP formulation EMM-MILP are equivalent in the following sense:(i)for each feasible point (x, y, n, p, u, s) of EMM-MPCC, there existss˜such that(x,y,n,p,u,s˜)is feasible for EMM-MILP.Conversely, for each feasible point of EMM-MILP (x, y, n, p, u, s), there existss˜such that(x,y,n,p,u,s˜)is feasible for EMM-MPCC.See Appendix A.□We give here the new formulation analogue to the one presented above, where (25) and (30) are replaced by their quadratic analogues (35) and (40) respectively. For the sake of clarity, we rewrite here all constraints in extenso, as they will be used in Section 4.EMM-QUAD-MIQCP:(34)max∑i(∑l,tQl,tiP0ixi+∑l,tQl,ti(P1i−P0i)xi22)+∑j(∑l,tQl,tjPl,tj)yjsubject to:pl,t∈[−P¯,P¯]∀(l,t)∈L×T(18)(35)∑i(∑l,tQl,tiP0ixi+∑l,tQl,ti(P1i−P0i)xi22)+∑j(∑l,tQl,tjPl,tj)yj≥∑isi+∑jsj+∑mwmum−∑l,tQl,ti(P1i−P0i)xi22(36)xi≤1∀i∈I(37)yj≤1∀j∈J(38)∑iQl,tixi+∑jQl,tjyj=∑kel,tknk,∀(l,t)∈A×T(39)∑kam,knk≤wm∀m∈N(40)si+∑l,tQl,tipl,t≥∑l,tQl,tiPi+∑l,tQl,ti(P1i−P0i)xi∀i∈I(41)sj+∑l,tQl,tjpl,t≥∑l,tQl,tjPj−Mj(1−yj)∀j∈J(42)∑mam,kum−∑l,tel,tkpl,t=0∀k∈K(43)xi,yj,si,sj,um≥0yj∈Z∀i∈I,∀j∈J,∀m∈NTheorem 3Both EMM-QUAD-MPCC and EMM-QUAD-MIQCP formulations are equivalent in the following sense:(i)for each feasible point (x, y, n, p, u, s) of EMM-QUAD-MPCC, there existss˜such that(x,y,n,p,u,s˜)is feasible for EMM-QUAD-MIQCP.Conversely, for each feasible point of EMM-QUAD-MIQCP (x, y, n, p, u, s), there existss˜such that(x,y,n,p,u,s˜)is feasible for EMM-QUAD-MPCC.See Appendix A.□Here, we derive from our new formulation a Benders-like decomposition algorithm, where cuts are added within the branch and bound tree used to solve the primal program DA-PRIMAL or DA-QUAD-PRIMAL, when no European prices exist for a given node solution incumbent. By a node solution incumbent, we mean a new best primal feasible solution obtained as the optimal solution to the LP relaxation at a given node of the branch and bound tree. It is in this sense similar to the two best algorithms Cosmos (2011); Martin et al. (2014) mentioned earlier (the algorithm briefly described in Cosmos (2011) is the proprietary algorithm in charge of solving CWE market instances on which further technical developments for European market integration relies). The cuts we propose are stronger than the cuts proposed in Martin et al. (2014). Quadratic instances of the new formulation cannot be solved with today solvers, and such an algorithm is needed to solve efficiently real life instances. The derivation is in a first stage very close to Benders (1962), and in particular relies on the Farkas lemma and the finiteness of the number of vertices of the polytope defining the feasible set of a so-called slave program.To simplify notations, in all this section, only one area and one time slot are considered, but all of what follows can be carried out with several areas, time slots, and a network model. We are sometimes referring to corresponding previous constraints involving the network structure, but the adaptations needed are minor and direct. In all this section, we neglect the price range condition (18), assuming as explained above thatP¯is sufficiently large not to exclude any relevant solution. Hence, the decomposition as presented here actually solves EMM-MILP minus (18). Exposition is made first in the linear case. It is shown hereafter how to handle the quadratic case in a similar way.Consider the primal problem DA-PRIMAL of Section 2:maxobj:=∑iQiPixi+∑jQjPjyj,subject to(2)–(7), with only one market (no network and only one period), i.e. with N empty and∑kel,tknk:=0,to simplify notations.Consider now a branch-and-bound procedure and let (x*, y*) be a node solution incumbent. According to constraints (25), (29)–(33) of the new formulation EMM-MILP, a supporting European price exists if and only if there exist si, sj, pm(pmdenoting the market price) such that:(44)−si−Qipm≤−QiPi∀i∈I[ui](45)−sj−Qjpm≤−QjPj+Mj(1−yj*)∀j∈J[uj](46)∑isi+∑jsj≤obj*[uσ](47)si,sj≥0where obj* denotes the corresponding optimal value∑iQiPixi*+∑jQjPjyj*of the objective function for this node solution.According to the Farkas lemma (Schrijver, 1986), a solution to a linear system Ax ≤ b, x ≥ 0 exists if and only if ∀y ≥ 0, yA ≥ 0⇒yb ≥ 0. The existence of a European price is so equivalent to:∑i−QiPiui+∑j−QjPjuj+∑jMj(1−yj*)uj+obj*uσ≥0∀(ui, uj, uσ) such that:(48)−ui+uσ≥0(49)−uj+uσ≥0(50)−∑iQiui−∑jQjuj=0[pm](51)ui,uj,uσ≥0,The condition being trivially satisfied if uσ= 0, we can assume uσ≔ 1 (normalization).Rearranging terms, a European price exists if and only if :∑iQiPiui+∑jQjPjuj−∑jMj(1−yj*)uj≤∑iQiPixi*+∑jQjPjyj*∀(ui, uj) ∈ P with P defined by the constraints:(52)ui≤1(53)uj≤1(54)∑iQiui+∑jQjuj=0(55)ui,uj≥0This yields:Lemma 2For a given node solution(xi*,yj*),a European price exists if and only if:(56)max(ui,uj)∈P∑iQiPiui+∑jQjPjuj−∑jMj(1−yj*)uj≤obj*.Let(ui*,uj*)denote an optimal solution to the optimization problem in the left-hand side of (56), stated in Lemma 2. Thenyj*=0⇒uj*=0.Because the numbers Mjare very (arbitrarily) large fixed numbers, ifyj*=0,the objective could not be optimal for any vertex of P with uj≠ 0. Accordingly, this could also be shown by noting that constraints of the dual of the left-hand side program are constraints (30)–(33) withyj=yj*fixed, and that ujare the shadow prices of constraints (31). Ifyj*=0,the corresponding constraint (31) is not binding because of the choice of the Mj(sj≥ 0 is binding instead), and uj= 0.□Note that the numbers Mjare used here only in proofs, and will be avoided in the final procedure described below. The criterion of Lemma 2 admits a nice interpretation. Let us consider the continuous relaxation DA-CR with the additional constraints that all blocks at 0 in the node solution are held at 0 in this relaxation. From the two previous lemmas, it follows that the optimal objective value for this modified relaxation cannot be greater than the current node solution value:Theorem 4For a node solution (x*, y*), consider the polytopePF*:=P∩{(ui,uj)|uj=0ifyj*=0}. Then a European price exists if and only if(57)max(ui,uj)∈PF∑iQiPiui+∑jQjPjuj≤obj*,where obj* denotes the optimal value associated with the node solution, in which case equality holds as well.It is a direct corollary of Lemmas 2 and 3. Also, since (x*, y*) is feasible for the left-hand side, if the inequality holds, equality holds as well.□When no European price exists, Lemma 2 provides with a classical Benders cut, where(ui*,uj*)is optimal for the left-hand side of (56):Classical Benders cut, linear case(58)∑iQiPiui*+∑jQjPjuj*−∑jMj(1−yj)uj*≤∑iQiPixi+∑jQjPjyj.Let us note that these cuts are globally valid. Moreover, suppose that (58) is violated by (x*, y*). As in EMM-MILP (or EMM-MPCC), the welfare ∑iQiPixi+ ∑jQjPjyjis univocally determined by the selection of accepted and rejected block orders (see DA-FixedBlocks and proof of Theorem 2 in Appendix A or also Corollary 6.1 in Martin et al., 2014), any other solution (x, y) with y = y* would also violate (58), since the right-hand and left-hand sides would be the same. This allows to recover the “no-good” cuts proposed in Martin et al. (2014):∑j|yj*=1(1−yj)+∑j|yj*=0yj≥1. At this stage, we can already note that there is a finite number of inequalities (58) to add, which is bounded by the number of vertices of the bounded polyhedron P. These cuts are not strong as such because of the Mj(a small change in the variables allows to satisfy the new constraint when LP relaxations are considered), but it is possible to strengthen them and the “no-good” cuts locally:Theorem 5Strengthened Benders cutsFor each node solution in the branch-and-bound for which no European price exists, the inequality∑j|yj*=1(1−yj)≥1is valid in the subtree.Consider any other feasible solution (x, y) in the subtree originating from the current node solution(xi*,yj*)for which no European price exists, that is for which, according to Lemma 2:obj*<∑iQiPiui*+∑jQjPjuj*−∑jMj(1−yj*)uj*,where(ui*,uj*)is optimal for the left-hand side of (56). According to Lemma 3, this inequality reduces to:obj*<∑iQiPiui*+∑jQjPjuj*If∑j|yj*=1(1−yj)=0for the new feasible solution (x, y), using Lemma 3,∑jMj(1−yj)uj*=0and the Benders cut (58) valid for (x, y) reduces to:(59)∑iQiPiui*+∑jQjPjuj*≤∑iQiPixi+∑jQjPjyj.Using the fact that this other solution (x, y) is in the subtree originating from (x*, y*),∑iQiPixi+∑jQjPjyj=obj≤obj*<∑iQiPiui*+∑jQjPjuj*,which violates (59), and no such new solution can admit a European price.□Again, for a node solution (x*, y*) in a branch-and-bound solving the primal problem, we apply the Farkas lemma to constraints (35) and (39)–(43) of the new formulation to test the existence of European prices. This yields the equivalent condition (again considering only one area and one time slot to ease the notation):(60)∀(ui,uj)∈P,∑iQiP0iui+∑iQi(P1i−P0i)xi*ui+∑jQjPjuj−∑jMj(1−yj*)uj≤∑iQiP0ixi*+∑iQi(P1i−P0i)(xi*)2+∑jQjPjyj*where P is the polytope defined by (52)–(55) above in the linear case.Note that we can only apply the Farkas lemma to the new formulation because it incorporates ‘dual variables’ for which vi= xi∀i ∈ I: if we consider inequality (35) with unknown viinstead ofvi=xi*∀i∈Ifixed to the given values in the right-hand side (corresponding to the objective function of DUAL-QUAD-CR-DUAL), the inequality is not linear any more in the unknown ‘dual variables’ and the Farkas lemma does not apply.Mainly two things should be noted concerning this condition. First, it is a linear condition which relates two ‘quadratic quantities’ (with fixed values x*), which are close to the original quadratic objective function of DA-QUAD. Second, contrary to the condition (56) in the linear case, both right and left-hand sides do not correspond exactly to the original objective function of the primal program (here DA-QUAD) or its continuous relaxation with additional terms involving Mj. This last point was used in the preceding arguments to derive the new locally valid strengthened Benders cuts.Nonetheless, though it is not direct, it is possible to recover the analogue result:Lemma 4For a given node solution(xi*,yj*),a European price exists if and only if:(61)max(ui,uj)∈P∑iQiPiui+∑iQi(P1i−P0i)ui22+∑jQjPjuj−∑jMj(1−yj*)uj≤obj*,where obj* denotes the optimal value of the quadratic objective function associated with the current node solution.See Appendix A.□Observe however that condition (60) asks to solve a linear program and is more efficient as a tester for the existence of European prices than condition (61).We can now adapt to the quadratic case the decomposition algorithm with exactly the same cuts:Theorem 6In the quadratic case also, for each node solution in the branch-and-bound for which no European price exists, cuts of the form∑j|yj*=1(1−yj)≥1are valid in the subtree.The proof is exactly the same as in Theorem 5. Just replace condition (58) by its counterpart derived from (61) (i.e. with quadratic terms).□Note also that like in the previous linear case, a consequence of Lemma 4 is:Theorem 7For a node solution (x*, y*), consider the polytopePF*:=P∩{(ui,uj)|uj=0ifyj*=0}. Then a European price exists if and only if(62)max(ui,uj)∈PF*∑iQiP0iui+∑iQi(P1i−P0i)ui22+∑jQjPjuj≤obj*,where obj* denotes the optimal value of the quadratic objective function associated with the node solution, in which case equality holds as well.In this section, we mainly address four questions related to the new formulation. First, how state-of-the-art solvers behave on real instances, when the whole model EMM-MILP is provided? Second, how the Benders-like algorithm behaves in comparison to the first approach? Third, how efficient is Benders-like algorithm for quadratic instances involving piecewise linear bid curves? Fourth, how both approaches behave on very combinatorial linear instances? APX and EPEX kindly provided us with real data from 2011. Statistics computed over the whole year 2011 (i.e. 365 instances) are presented. All instances include full ATC network models as used in actual day-ahead markets and in Martin et al. (2014). In Appendix B, we present in more details results for 20 representative instances, cf. Tables B.1–B.3. Computational experiments have been carried out with AIMMS (Bisschop and Entriken, 1993) with the solver CPLEX 12.5, on a computer running Windows 7 64 bits, with a four cores CPU i5 @ 3.10 gigahertz, and 4 gigabytes of RAM. Even with such a modest platform, results turn out to be very positive. The decomposition procedure has been implemented using lazy constraint callbacks with locally valid lazy cuts. Concerning practical requirements for an algorithm, main European power exchanges ask for a time limit of 10 minutes, and we have adopted this stopping criterion for all tests below.For both approaches (the new formulation and the decomposition procedure), we have computed the number of instances solved up to optimality, the (geometric) average time needed to find these optimal solutions, and the (geometric) average of the final absolute MIP gap when only a suboptimal solution is available in time. We also provide with the number of visited nodes for the new MILP approach, and the number of cuts generated in the decomposition approach. Finally all heuristics proposed by CPLEX have been deactivated. This is necessary to obtain an exact algorithm using the decomposition approach, and it turned out to be inefficient when directly using the new formulation. Finally, we always explore the down branch (xi= 0) first in the branch-and-bound tree. This has a substantial impact on the performance of both approaches, by allowing to find very good solutions quickly.Piecewise linear bid curves have been transformed into stepwise bid curves to get MILP instances. To do this, for each two consecutive points of a bid curve such that Qi≠ Qi + 1 and Pi≠ Pi + 1, a point (Q*, P*) has been inserted in between, with P* = Piand Q* = Qi + 1.A particular attention has been devoted to numerical issues. One drawback of the new formulation is the so-called big-M constants involved in the constraints. As it is well-known, this may result in numerically ill-conditioned instances. It appeared that very tight tolerance parameters must be set to obtain correct solutions (e.g. an integer feasibility tolerance of 10−9).Instances contain orders for four areas (Belgium, France, Germany and the Netherlands), and span the whole day (24 hours, excepted twice per year, 23 and 25 hours respectively). There are approximatively 50 000 hourly orders (bid curve segments) and 600 block orders per instance.Table 1shows that EMM-MILP allows to solve most of the instances without any algorithmic work and to obtain very good suboptimal solutions when the instance cannot be solved up to optimality. The decomposition procedure is much faster on most instances but most of the time does not help to solve hard instances that the MILP approach cannot solve. The fact that the new MILP formulation approach takes in average more time for solved instances is mainly due to the time needed to solve the root node relaxation.Comparing runs with and without solver’s cut generation procedures, it turned out that they were not useful and were indeed slowing down the process in both the decomposition procedure and the full model approaches. In fact, for the full model approach, this may be explained by the presence of big-Ms and the fact that most of the cuts generated may be very weak in practice. Concerning the decomposition procedure, in most cases, many good solutions to the primal program are easily found and cuts are not of main interest, the main part of the procedure (from a running time point of view) consisting in rejecting incumbents when no European prices exist. Note also that all CPLEX heuristics have been deactivated.When piecewise linear bid curves are considered, the new formulation EMM-QUAD-MIQCP cannot be solved with today’s solvers (e.g. CPLEX or GUROBI), and only the decomposition procedure can be relevantly assessed.To check for the existence of prices for a given new best node solution, the linear condition (60) is used, and the locally valid local cut of Theorem 6 is added when no European prices exist.As it can be seen from Table 2, most of instances are solved up to optimality, and a very small gap remains when only a suboptimal solution is found within ten minutes.We have built 50 instances where orders are almost all block orders in the following way. Starting from historical instances, all block orders have been relocated to one area only and are spanning only 1 hour of the day. Two small continuous orders (one buy order and one sell order) have been added for the sole purpose to have an instance with at least one feasible solution (a matching of orders is possible). The difference between both approaches in this case is remarkable, see Table 3.In this case, the new MILP formulation approach is much more powerful. One possible explanation is the high number of block order selections for which no European prices exist, which are enumerated by the decomposition. On another hand, with the full model approach, the solver may be able to branch more efficiently. The difference of performances between the two approaches was more impressive on a less powerful platform. This difference would therefore certainly be more important for instances with more block orders.

@&#CONCLUSIONS@&#
We have proposed a new formulation for European day-ahead electricity markets that turns out to be (a) tractable and (b) very competitive as long as stepwise preference curves describing hourly orders are considered. More than 80 percent of the historical instances of 2011 can be solved up to optimality, and for the other ones, the final gap is very small. We have also compared this approach with a decomposition procedure derived directly from the new formulation, which appeared to solve most instances faster but was not helpful on hard instances that the new formulation approach was not able to solve. Unfortunately, the simple use of the analogue new formulation is no longer successful when piecewise linear preference curves are considered. Today’s state-of-the-art MIQCP solvers are not able to deal with large-scale programs with this structure. On the other hand, the Benders-like decomposition approach derived from the new formulation allows managing these cases in an efficient way. Finally, the new MILP formulation performs much better than the decomposition approach on small very combinatorial linear instances, and this could be exploited in auctions with more block orders. Another interesting point is that an approach similar to the new formulation allows considering other objective functions over the set of constraints defining European market rules. In particular, with a similar modelling technique, it would be possible to consider, for example, an objective function minimizing the total opportunity costs of paradoxically rejected block orders. In an article in preparation, we study how this modelling technique can be used from a market design analysis point of view.