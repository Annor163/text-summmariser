@&#MAIN-TITLE@&#
Real time identification of active regions in muscles from high density surface electromyogram

@&#HIGHLIGHTS@&#
A new algorithm is proposed for the localization of the sources of muscle activity from high density surface EMG.The algorithm provides approximate estimates, but they are real time.The method is tested on simulated signals.Suggested potential applications: cross-talk removal, biofeedback, load sharing, MUNE, prosthesis, rehabilitation.

@&#KEYPHRASES@&#
Electromyography,Inverse problem,Source localization,Real time,

@&#ABSTRACT@&#
Graphical abstractThe paper proposes an innovative method to identify the regions of a muscle which are active from high density surface electromyogram (EMG). The same problem was addressed in very few studies in the literature, by either using a set of predetermined waveforms to approximate the recorded signal or by computationally expensive regularized techniques. No method available in literature is both robust and real time. The algorithm proposed in the paper is based on a set of waveforms adapted to the investigated subject and a regularization technique. It is separated into two steps: a preliminary processing in which the waveforms are selected and most of the computations are performed (off-line step) and a fast algorithm, requiring only a few matrix multiplications, which can be used in real time (main innovation of the paper). An example of application is shown in Fig. 1.A sensitivity analysis is performed in simulation. The perturbation of different parameters determines a bias in the estimation of the active regions which is interpreted and discussed in the paper. Even in the presence of a bias, the relative depth of the sources is maintained, with an uncertainty of a few mm. An experimental validation of the algorithm is beyond the aims of the paper. It is very difficult to address such a problem, as it is not simple to locate the sources in experiments. Some ideas for future works for the experimental validation of the algorithm are discussed.The estimation of the active regions may substantially contribute to many open issues in the surface EMG research field: for example, cross-talk removal, force estimation, biofeedback, prosthesis control, load sharing among muscles acting on the same joint and motor unit number estimation. Some of these problems would benefit of even an approximate estimation, but it should be real time (processing time is shown in Fig. 2). Thus, the proposed algorithm could give a valuable contribution to the work of many researchers focused on one of these challenging problems.Fig. 1. Example of application of the algorithm. (A) Simulated monopolar interference EMG from the central channel and examples of four epochs (50ms of duration) corresponding to four distinct active regions. (B) Active MUs (firing at least one time within the epoch), contour plot and barycentre of the estimated activity distribution. (C) Comparison between estimated and simulated location of the active region (from left to right: depth and transverse displacement, each across different epochs and together).Fig. 2. Processing time (mean and standard deviation) of epochs of different durations obtained using a personal computer (Intel(R) Core i7-2630QM, Quad-Core, with clock frequency of 2GHz, 6GB of RAM, 64bits operating system).

@&#INTRODUCTION@&#
Surface electromyogram (EMG) is the potential recorded over the skin resulting from the generation (at the innervation zone—IZ), propagation (along muscle fibres, across the membrane), extinction (at the tendon endings) of current sources that induce fibre contraction. High density surface EMG (HDsEMG) has been proposed to investigate the muscle activity on a wide spatial area with a good selectivity [1]. Indeed, spatial filters allow to overcome in part the smaller selectivity with respect to needle EMG [2]. As a result, HDsEMG may find many clinical applications, some of them similar to those of the routinely used needle EMG (e.g., concerning the recruitment strategy of different motor units—MU [3]), but without requiring invasive procedures [4–6]. Moreover, as a wide area is considered, many important features (not attainable from needle EMG) can be extracted, e.g. concerning the anatomy of the muscle (positions of IZ and tendon endings [7–11]) and the velocity of propagation of MU action potentials (MUAP) [12].An important information on muscle contraction is the position of the active regions. In principle, this information could be extracted from HDsEMG by estimating the location of the current sources generating the surface potential. However, identifying the sources from the recorded EMG is not simple, as it is an inverse problem. The localization of sources within the brain was studied extensively from surface electroencephalogram (EEG) [13]. In the field of EMG, some studies have been proposed [14–20]. The identification of the source of a single MUAP was addressed by considering that the decay of the potential in the transverse direction with respect to the fibres is slower when the MU is deeper [17]. This method requires the (computationally intensive) decomposition of the surface EMG as a preliminary step, if interference EMG is considered. Sophisticated methods, based on advanced simulations by the finite elements method (FEM), were also proposed to investigate interference EMG [14–18]. More recently, FEM simulations combined with regularization techniques were applied [19–20]. All these methods have a high computational cost. Thus, they are not feasible for real time applications, like prosthesis control or rehabilitation guidance with a biofeedback (where an estimation of the active regions would be beneficial, to improve prosthesis control without introducing an unpleasant delay or to examine the activity of the muscle during a rehabilitation program [20]). As an alternative, a simple and fast method was proposed to estimate the relative depth of the sources from interference surface EMG [21]. Such a method, together with a simple algorithm to estimate the location of the sources in the directions parallel to the skin (e.g., based on the mean amplitude of the signal) could provide real time estimates. However, this approach has some limitations: it provides only relative depth information (i.e., the region activated in a period is deeper or more superficial than in another moment), it gives an average estimate of depth (for example, if there are two active regions at different depths, the information obtained by the method is related to the average depth among the two regions, weighted by the amplitude of the sources and the distance from the detection channels) and it does not estimate the contributions of different sources (that could be useful, e.g. to reduce cross-talk [20]).Here, an innovative method is proposed to provide a rough localization of the sources of interference surface EMG in real time. It is based on a set of pre-determined waveforms, each associated with a source in a specific location (as in [14][18]), recorded by a HDsEMG system (with number of electrodes higher than the number of waveforms). A regularization method is used, in order to stabilize the estimates (as in [19][20], where an expensive FEM model is used). The problem is stated in terms of the minimization of a functional in the least mean squares sense, whose solution is achieved with a series of matrix multiplications, which can be obtained quickly, opening new potential real time applications.The method and the simulated signals used to test it are described in the following.Assume to describe the recorded EMGb(x,t)by the following expression(1)b(x,t)=∑n=1NR∑k=1NτXn,kan(x,t−τnk)wherean(x,t)is a normalized waveform representing the activity of fibres in a specific muscle region (NRis the number of regions considered), x is the space variable indicating the position of the recording channel, t is the time variable,τnkis a delay (Nτis the number of considered delays),Xn,kare unknown coefficients to be determined, indicating which muscle region is active and the average intensity of the source. The functionsan(x,t)(referred to as basis waveforms in the following) could be simulated using a model replicating as far as possible the investigated physiological system: for example, the geometry of the tissues could be measured (by ultrasound scanning [22] or MRI [15,16,18–20,23]), their conductivity could be taken from the literature [24,25] and the anatomy of the muscle fibres (positions of the IZ and tendons) could be investigated by preliminary surface EMG recordings [8–11]. Another possible choice is to measure the surface potential resulting from the activity of a specific region: needle EMG can be recorded from different locations and decomposed in order to identify the activity of single MUs [26]; then the surface response related to each identified MU can be estimated by spike triggered averaging [27], obtaining very selective information on the surface EMG response of the activity of specific muscle regions.Eq. (1) can be rewritten in matrix form(2)AX=bwhere A contains the basis waveforms, b the measurements, X the unknowns(3)where the arrows indicate that a vector is formed listing the values corresponding to each detection channel and time sample.There are some problems in solving the linear system (2): inverting A is not possible because it is usually rectangular; the measurement vector b is not in the image of A, as it should be smooth (as it is the solution of a problem of potential [28]), but it is not, due to the noise (always present in the experimental data [29]).The problem could be solved in the least mean squares sense(4)minX‖AX−b‖2with solution(5)X=(ATA)−1ATbHowever, this solution could result in many contributions, which compensate each other. In order to get a reliable solution, a-priori information can be included by introducing penalization terms and imposing constraints [13]. Tikonov regularization is obtained solving the following problem(6)minX‖AX−b‖︸residualnorm2+α‖X‖2︸solutionnormin which the solution is imposed not to have a large norm (ruling out oscillating solutions), by properly tuning the penalization parameter α (equal to the maximum eigenvalue of the matrixATAdivided by 1000, in this paper). The problem has an analytical solution obtained considering that(7)‖AX−b‖2+α‖X‖2=‖[AαI]X−[b0]‖2=‖BX−c‖2from which we have(8)BTBX=BTc⇒(ATA+αI)X=ATb⇒X=(ATA+αI)−1ATbThis solution is less sensitive to noise than (5) (as the condition number of the matrix to be inverted was decreased), but it could have unphysical negative values. To avoid this problem, the solution was constrained to be non-negative. The projected Landweber method [30] was used. It updates the solution in the direction of steepest descent of the square error functional and then employs projections onto the constraint set, i.e. the non-negative orthant, which is a closed convex set. The algorithm is the following(9){Initialization:X0yk+1=Xk−μAT(AXk−b),μ=0.9λmax(ATA)Xk+1=max(yk+1,0)where the initialization for X0 is given by the Tikonov method (Eq. (8)),λmax(ATA)is the maximum eigenvalue of the square matrixATA, the step size parameter μ was chosen in order to achieve convergence in a few steps (5 iterations were used here) and the maximum operator in the definition of Xk+1 is evaluated component-wise [30]. In order to have a fast algorithm, the matrix A was obtained considering a fixed geometry and a constant velocity of propagation of the current sources along the fibres (4m/s). Thus, the matrixM=(ATA+αI)−1AT(needed to compute the Tikonov solution (8)), the matrixATAand its maximum eigenvalue can be computed before the application of the method to the signals. As a result, the algorithm (9) consists only of a few matrix multiplications, which could be performed very quickly (see Section 3 for details).As the considered geometry is fixed, the method could be applied in isometric conditions or in situations in which the movement is limited. If dynamic conditions are considered, a set of matrixes could be saved, each corresponding to a specific geometrical configuration of the muscle fibres and the matrix corresponding to the actual condition could be selected on the basis of the measured joint angle. In the following, isometric conditions are simulated (however, the effect of different IZ positions and fibre lengths is considered).The average muscle fibre conduction velocity (CV) can change during a contraction, for example due to the recruitment of different MUs with different CV (e.g., when a non-isotonic contraction is studied [31]) or as a myoelectric manifestation of muscle fatigue [32]. Muscle fibre CV was estimated from the linear electrode array aligned to the muscle fibres that corresponded to the maximum average rectified value (ARV). CV was computed with a multichannel least mean squares approach [33], applied to monopolar signals to which the common mode (CM) was subtracted. This method, tested on a few signals, appeared to be more stable than applying the algorithm to double differential (DD) signals (as often done in the literature [33]). This is probably due to the larger number of monopolar channels and to a lower effect of noise with respect to DD (fully testing this hypothesis is beyond the aims of this paper). For the specific application considered here, using monopolar signals is beneficial also because they have a larger detection volume than DD. Once an estimate of CV was obtained, all the signals were rescaled in time in order to compensate the CV variation with respect to the simulated waveforms. In different tests, CV compensation was included or excluded, indicating the effect of such an additional step.Another important consideration is required on the number of conditions and of unknowns in the inverse problem to be solved. Preliminary tests indicated that more accurate results were obtained using an over-determined system. The number of measurements (equal to the number of rows in the matrix A and reflecting conditions) is given by the number of detection channels (most of the tests, described in Section 2.2.1, were performed considering nine linear arrays of seven monopolar channels, aligned to the fibres) multiplied by the number of time samples in the considered epoch of signal (indicated by τEPOCH in the following). The number of unknowns (equal to the number of columns in the matrix A) is given by the number of waveforms considered (given by the number of considered depths multiplied by the number of positions along the direction transverse to the fibres), multiplied by the number of time delays. In most of the simulation tests (Section 2.2.1), I considered six depths (one every 2mm, in the range 1 to 11mm), nine transverse displacements (one every 8mm, from −32 to 32mm), delays from −τWF to τEPOCH, where τWF is the duration of a simulated waveform (defined as the simulated length of the fibre divided by CV plus 10ms, added in order to consider the time needed for the generation/extinction of the source). This range of delays includes all non-zero contributions of the waveforms to the recorded potential. In order to decrease the number of unknowns, the delays were down-sampled of a factor 2 with respect to the sampling rate. In this way, considering a number of source positions to be estimated less than or equal to the number of channels in the detection grid, the linear system (2) is over-determined, irrespective to the duration of the epoch.As an estimate of the dimensionality of the problem, consider the case of processing an epoch of signal with duration 100ms: the number of conditions is 9 (arrays)×7 (channels)×100 (number of samples in the epoch, sampled at 1kHz)=6300; the number of unknowns is 6 (depths)×9 (transverse displacements)×60 (number of considered delays, equal to 50, which is the number of samples in an epoch sampled at 500Hz, plus 10 samples to cover a waveform)=3240.To test the algorithm, interference surface EMG was simulated. A plane layer volume conductor model was used to simulate single fibre action potentials (SFAP) [34], assuming time sampling frequency of 1kHz and muscle fibre CV equal to 4m/s. The thickness and conductivity of the tissues were the followings: skin thickness 1mm, conductivity 2.2×10−2S/m [24]; fat thickness 3mm, conductivity 4×10−2S/m [24]; muscle longitudinal conductivity 40×10−2S/m and transverse conductivity 9×10−2S/m [25].A sensitivity analysis (Section 2.2.1) was performed on the basis of a dataset simulating an active region moving around the muscle. The geometry of the volume conductor is shown inFig. 1A. The performances of the algorithm in localizing the centroid of the active region were tested (Figs. 2–7). Then, a specific example of application was considered (Section 2.2.2), in which four distinct muscles were considered and all their possible co-activations were simulated (Fig. 8). The algorithm was used to identify which muscle was active in order to discriminate between different activation patterns (Table 1).Monopolar surface EMGs were simulated as detected by a two dimensional grid of nine parallel arrays of seven electrodes, centred at 25mm distal to the IZ, aligned to the muscle fibres, with 8mm inter-electrode distance (IED, Fig. 1A). Muscle fibres were simulated inside a rectangular cross-section area with 70mm of lateral extension and 10mm of maximal depth. Symmetrical muscle fibres (with IZ half way between the tendons) were simulated with semi-length 50mm.Each SFAP was used to simulate single MUAPs, approximating the smoothing due to the spread of the IZs and tendon endings (8mm) by a time convolution with a Gaussian window function [32]. The number of fibres in the MUs was distributed as an exponential function [35], with the largest MU including a number of fibres 20 times greater than that of the smallest one. The distribution of single MU CV was assumed to be Gaussian, with a mean of 4m/s and standard deviation of 0.3m/s. MUs were recruited according to the recruitment threshold excitation function proposed in [35] with range of thresholds equal to 60%. The discharge statistics were modelled assuming minimum and maximum discharge rates of 8 and 35 pulses per second (pps), a linear increase of the discharge rate with force once the MU was recruited (0.5pps/% of maximal voluntary contraction—MVC, between the minimum and maximum rates stated above) and a Gaussian distribution of the inter-pulse interval variability (coefficient of variation equal to 0.2). The MUs were recruited from low to high CV [36].An interference surface EMG of duration 20s was simulated, imposing a contraction level of 50% of MVC (a few tests with different contraction levels provided equivalent results). Different regions within the muscle were activated during the simulation. Specifically, the simulation time was divided into 100 epochs. In each epoch, only the MUs included in a specific region were activated: such a region was an ellipse with semi-axes 2.5 and 10mm, in the depth and transverse direction respectively, as shown in Fig. 1B. The active region was displaced during the simulation so that its centre toured around an elliptical path, with semi-axes 4 and 30mm, in the depth and transverse direction, respectively (Fig. 1B).The algorithm was applied to non-overlapped epochs of the simulated surface EMG of 50, 100 or 150ms, in different tests. In order to check the accuracy of the algorithm in detecting the active region, for each epoch, the mean position of the firing MUs was computed and compared to the mean of the estimated distribution (cumulated over the considered time delays and removing the values under the 30% of the maximum, in order to reduce the contribution of noisy estimates and of the blurring). The mean and the standard deviation of the distances (across different epochs) between the mean position of the firing MUs and the mean of the estimated distribution was considered to measure the performance of the method.First, a reference test was considered in which the basis waveforms were obtained using the same simulation model as that used to simulate the MUAPs. Then, a sensitivity analysis was performed, assuming that there was a mistake between the actual investigated physiological system and the simulated or experimental waveforms used to fit the EMG data (by Eq. (1)). Indeed, errors could be done in estimating the geometry or the conductivity of the tissues and the anatomy of the investigated muscle fibres. The same simulated interference signal was considered for the tests, but different models were used to simulate the waveforms included in the matrix A in (3). The following parameters were changed one at a time or altogether, in different sets of simulations: skin thickness, fat thickness, skin conductivity, muscle conductivity, IZ location and fibre length. Moreover, technical problems were considered: misalignment of the detection system with respect to the fibres and Gaussian additive noise was added to the interference EMG (with SNR between 10 and 25dB). In order to test the effect of a change on CV, instead of using the reference CV of 4m/s (which is equal to the average CV of the simulated MUs), a different CV (between 3 and 5m/s) was used to simulate the waveforms.Moreover, different spatial filters were considered, as an alternative to the monopolar potential used as a reference (which assumes a common reference electrode for all channels): a variation of the monopolar derivation (borrowed from EEG), using the average potential across all electrodes as the reference (it is the so-called virtual reference [1]); single differential (SD); double differential (DD); Laplacian (NDD).The algorithm was implemented in Matlab and tested on the three following personal computers (acquired between 5 and 2 years ago), in order to investigate the time required to process an epoch:•PC1: Intel(R) Dual-Core, T5500, with clock frequency 1.66GHz, 2GB of RAM, 32bits operating system;PC2: Pentium(R) Dual-Core, with clock frequency of 2.8GHz, 4GB of RAM, 64bits operating system;PC3: Intel(R) Core i7-2630QM, Quad-Core, with clock frequency of 2GHz, 6GB of RAM, 64bits operating system.Monopolar interference surface EMGs were simulated using the same simulator described in Section 2.2.1. Four different muscles were simulated (muscle geometry is represented in Fig. 8A). They had rectangular cross-sections with 30mm of lateral extension and were either superficial (maximal depth lower than 8mm) or deep (range of depth between 9 and 16mm). The muscle fibres were 200mm long, with two IZs uniformly distributed among the MUs of the muscles and located 20mm apart from each other. An interference signal (20s in duration, force level 75% MVC) was simulated for each muscle as recorded by electrode grids covering the same portion of muscle (centred half way between the tendons, with dimension 50mm along the fibres and 100mm in the transverse direction) with different densities: IED between 5 and 10mm were considered. The basis waveforms simulated sources with 6 possible depths (between 1 and 16mm), 11 transversal distances (between −50 and 50mm) and either of the 2 IZs: thus, a total number of 132 waveforms were simulated (notice that, having 2 randomly distributed IZs implies that the number of waveforms, and thus also of unknowns, is doubled). It is worth noticing that the number of electrodes was larger than the number of basis waveforms only for IED=5mm and the investigated mathematical problem was over-determined only in such a case. The algorithm was first applied to 5s of each of the 4 signals simulating the selective contraction of a single muscle: the distribution of sources was computed for each 50ms epoch and then averaged to estimate the mean distribution associated to the activity of each muscle. This phase was a sort of training of the algorithm, which learned the distribution associated to the activity of each of the four investigated muscles. Then, the signals of different muscles were summed in order to simulate all the 15 possible co-contractions (4 single muscle contractions plus 6 pairs of co-contracting muscles plus 4 triplets and 1 case in which all muscles were co-contracted). The algorithm was tested on these 15 patterns of activations, considering epochs of 50–200ms. The estimated distribution was decomposed in the least mean squares sense as a linear combination of the 4 distributions associated to the selective activation of each of the 4 muscles. The rational of this decomposition is that the distribution estimated from the activity of the muscles is well approximated by the sum of the distributions obtained processing the activation of each muscle separately (correlation coefficient above 98%). Indeed, the contribution of each source is linearly combined in the recorded signal. Moreover, the algorithm requires mostly linear operations, with the exception of the imposition of the positivity constraint. This property allows to identify the contribution in a co-contraction of each of the considered muscles.

@&#CONCLUSIONS@&#
This paper proposes an innovative, real time method for the localization of the muscle sources from HDsEMG. The method provides accurate estimates of the mean location of the sources of activity and is stable to possible detection problems or inaccurate knowledge of the anatomical or physical properties of the investigated tissues. The algorithm provides estimates in real time, opening potential future applications for prosthesis control or biofeedback.The author has no conflict of interest concerning the publication of this work.