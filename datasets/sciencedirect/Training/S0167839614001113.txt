@&#MAIN-TITLE@&#
Biquintic

@&#HIGHLIGHTS@&#
Multi-sided holes in a bicubic patch complex are filled by a curvature-continuous cap.The cap is of degree bi-5 and has good and flexible shape.The space of n-sidedG2caps of degree bi-5 is explored via functionals.

@&#KEYPHRASES@&#
Curvature continuity,Surface,Functionals,Multi-sided,G2,Reparameterization,

@&#ABSTRACT@&#
Graphical abstract

@&#INTRODUCTION@&#
Tensor-product splines of degree bi-3 represent the simplest choice for creating curvature continuous surfaces for a regular grid-like layout. Several such regular grids can be joined into a bi-cubicC2surface complex leaving multi-sided holes to be filled. When the surfaces are to be completed by curvature-continuous (G2) multi-sided blends, the construction of degree bi-5 in Karčiauskas and Peters (2013) is likely to be of least polynomial degree – unless the shape is compromised. The construction in Karčiauskas and Peters (2013) leverages several carefully-chosen reparameterizations and intermediate, structurally simpler ‘guide surfaces’ to, step-by-step, establish the surface shape by prolonging and distributing curvature from the bi-cubic complex into a multi-sided cap. By generating well-shaped n-sided curvature continuous surface caps for a wide variety of challenging input data, the construction established that the space of bi-5 patches is sufficiently rich for such high-end modeling.The main point of this paper is to further explore the space of bi-5 constructions, but without intermediate guide surfaces. To control the many degrees of freedom that surface caps of degree bi-5 offer after enforcing smoothness, we tested a variety of functionals that act separately on each of the coordinates f of the surface cap and have the form(1)Fκf:=∫01∫01∑i+j=κ,i,j≥0κ!i!j!(∂sif(s,t)∂tjf(s,t))2dsdt,as well as their tensor-analoguesFκ⁎f:=∫01∫01(∂sκf(s,t))2+(∂tκf(s,t))2dsdt. The functionalF4⁎was used in Loop (2004), Loop and Schaefer (2008) and combinationsF2+λF1for various λ have been used to approximate functionals based on first and second fundamental forms (e.g. Halstead et al., 1993; Greiner, 1994, 1996; Loos et al., 1999; Westgaard and Nowacki, 2001; Sarraga, 2000; the last additionally appliesF3). Setting degrees of freedom by such functionals may be considered less predictable (see Fig. 1) than successive approximation via guide surfaces, since the effect of minimizing such a functional over a complex blend of splines is difficult to predict – and may even fail to yield well-distributed highlight lines as our extensive experiments for 3-sided caps revealed. However, forn>4, we could always find some functional that achieved quality comparable to Karčiauskas and Peters (2013) over all test cases:F4works well for caps of valencen=5,F5forn=6,F7forn=7andF8forn=8and beyond. Forn=3, all tested functionals failed to yield satisfactory highlight lines, i.e. yielded poorly distributed highlight lines on at least one and typically many test cases. But we discovered a simpler guided construction whose quality is on par with Karčiauskas and Peters (2013).Overview. Section 2 gives an overview of the cap construction. Section 3 provides the details and summarizes the algorithm. Section 4 focuses on the special casen=3. Section 5 shows the result of the modeling with functionals for challenging input configurations, and compares the new approach to Karčiauskas and Peters (2013), Loop and Schaefer (2008), as well as to Catmull–Clark subdivision (Catmull and Clark, 1978). First, we review the literature.Curvature continuous n-sided surface cap constructions have to be able to locally model any and all quadratic expansions at the central n-valent extra-ordinary point – and some cubic expansions to match higher-order saddles. Otherwise we would simply extend the boundary data to a plane and generate a flat facet to satisfy curvature continuity. This requirement of ‘flexibility’ (local approximation order) forces a minimal polynomial degree for piecewise polynomial surface constructions. For example, flexibleG1tensor-product caps based on quad meshes (and with possibly adjacent extraordinary points of valencen≠4) must have degree bi-3 or higher (and then3×3polynomial pieces per quad) to avoid flat spots when modeling higher-order saddles (Peters and Fan, 2009). A similar lower bound theorem forG2surfaces is not yet proven, but it appears unlikely that a flexibleG2cap of aC2bicubic B-spline complex can be constructed exclusively with polynomial patches of degree bi-4; or that such caps can always be constructed using just one bi-5 patch per quad. For, while the bi-5 construction in Gregory and Zhou (1999) is interesting from an algebraic point of view, the resulting shape generally disappoints, see Fig. 3.Focusing on constructions that use a finite number of tensor-product spline pieces arranged in an unrestricted patch layout, the constructions of Grimm and Hughes (1995), Cotrina Navau and Pla Garcia (2000) are high-degree rational and Ying and Zorin (2004) use root and exponential functions. (Flexibility with degree bi-3 can be achieved for ‘polar configurations’ via subdivision. But here we focus on the more common ‘star-like’ configurations of Catmull–Clark subdivision (Catmull and Clark, 1978), and allow only a finite number of polynomial pieces.) Among polynomialG2constructions using a single patch per quad, the degree can be as high as bi-18 (Gregory and Hahn, 1989). The degree of Ye (1997), Kiciak (2013) is bi-9. The constructions in Prautzsch (1997), Reif (1998) offer solutions of degree bi-6 – but only if their flexibility is restricted to second order. To attain third order flexibility, as is necessary to correctly model higher-order saddles, the constructions in Prautzsch (1997), Reif (1998) need to be of degree bi-9. The constructions of Loop (2004), Loop and Schaefer (2008) explore the space of degree bi-7 surfaces to fill an n-sided hole in a bi-3 spline complex. The formulas of Loop and Schaefer (2008) were derived by minimizingF4⁎.To separate central points, i.e. extraordinary points where more or less than four patches meet, or to reduce the sudden change in curvature at the transition between the cap and the surrounding bi-cubic surface, a number of surface constructions assume that the input control net is the result of two or more Catmull–Clark refinement steps. Such preprocessing may introduce shape problems due to the dominance of the hyperbolic terms (Karčiauskas et al., 2004).Guiding polynomials were introduced in Prautzsch (1997), Reif (1998) primarily to ensureC2continuity at the central point of the cap. Entire polynomials were also chosen as ‘guide shapes’ in the non-rational constructions (Ying and Zorin, 2004 and Levin, 2006). Restricting the guides to be entire polynomials makes the resulting surfaces less flexible than using piecewise polynomial guides (Peters, 2002). For controlling shape, ‘guided splines’ (Karčiauskas and Peters, 2009) specifically advocate the use of piecewise guides over (global) optimization via functionals. The construction in Karčiauskas and Peters (2013) refined and improved this approach. Here, we revisit optimization via functionals, but only after careful reparameterization of the boundary data.As illustrated in Fig. 4, our space of spline caps consists of n four-sided patches that each consist of2×2bi-5 pieces.Definitions and setup. We consider a network of quadrilateral facets or quads with vertices called control points. These control points are called regular points if they are surrounded by four quads and star points when surrounded by more or fewer than four quads. The analogous surface point, where more or fewer than four surface pieces (patches) meet, are called central points.We assume, for simplicity of exposition, that each star point is surrounded by at least one layer of regular points. We denote as cap-netc the two-ring of one star point, i.e. the star point plus 6n points forming two layers of quads surrounding it. (Note that the second layer of quads is allowed to have star points.) The corresponding n-sided surface piece is called a surface cap. Fig. 5a displays a cap-net, and Fig. 5c displays an extended cap-net i.e. a cap-net plus one additional layer. This additional layer is not used for the construction of the cap but provides a surface ring (green in Fig. 5d) surrounding the cap for visual context and to assess the continuation of curvature from the surrounding complex into the cap.Each4×4sub-grid of points of the network is interpreted as the B-spline control net of a bi-cubic tensor-product spline surface. The well-known formulas for converting from the B-spline to the Bernstein–Bézier form (BB-form; see e.g.  Farin, 2002; Prautzsch et al., 2002) can be applied to the cap-net – except at star points. Along the boundary of a surface cap, this provides Hermite data in bi-degree 3 form (fine meshes in Fig. 5b, d). We refer to these Hermite data in the following as the tensor-borderb (of depth 2 and degree 3) of the cap construction.A tensor-product patch f of bi-degree d in Bernstein–Bézier form (BB-form) is defined by its BB-coefficientsfijviaf(u,v):=∑i=0d∑j=0dfijbid(u)bjd(v),bkd(t):=(dk)(1−t)d−ktk,(u,v)∈□:=[0..1]2,i.e. all patches will be parameterized over the unit square.Crcontinuity of surfaces can be achieved byGrconstructions, i.e. by relating adjacent surface pieces by reparameterization ρ so that, up to rth order,f˜=f∘ρ. While the smoothness of the resulting surface can be expressed in the language of differential geometry, i.e. in terms of charts, it suffices, and is often more efficient, to express as agreement of one-sided r-jets along the boundary where two surface pieces are glued together. We use this approach in the following. Although ρ is just a change of variables, its choice is crucial for the properties of the surface cap.Definition 1Two surface piecesf˜and f sharing a boundary curve e joinG2if there exists a suitably oriented and non-singular reparameterizationρ:R2→R2so that the jets∂kf˜and∂k(f∘ρ),k=0,1,2, agree along e.Throughout, we will choose e to correspond to surface patch parameters(u,0=v). Then the relevant Taylor expansion up to and including degree 2 of the reparameterization ρ with respect to v is(2)ρ=(u+b(u)v+12e(u)v2,a(u)v+12d(u)v2).By the chain rule of differentiation, this yields the well-known constraints(3)∂vf˜=a(u)∂vf+b(u)∂uf,(4)∂v2f˜=a2(u)∂v2f+2a(u)b(u)∂u∂vf+b(u)2∂u2f+e(u)∂uf+d(u)∂vf.For this section, we assume that the valence of the star point isn>4. The casen=3will receive special attention in Section 4. We construct the cap from n spline patches each of which consists of2×2pieces of polynomial degree bi-5 (see Fig. 6). This section explains the principles and main equations that yield the algorithm in Section 3.3. The final implementation of surface caps can be reduced to forming a linear combination of tabulated generating functions weighted by the cap-net pointscjk, see Section 3.4.Treating adjacent patches without bias for one side, we choose the reparameterization along the inter-sector boundary (cf. Fig. 6a) so that formula (2) simplifies toa(u):=−1ande(u):=b(u)(b′(u)−d(u)2); i.e.(5)ρ=(u+b(u)(v+12(b′(u)−d(u)2))v2,−v+12d(u)v2).We name asρothe reparameterization between the domains ofp`:=po,k−1andp´:=po,kand asρrlthe reparameterization between the domains ofq`:=pl,k−1andq´:=pr,k(see Fig. 7). We chooseforρo:b(u):=2c(1−u)+23cu,d(u):=0,c:=cos⁡2πn;forρrl:b(u):=23c(1−u)2,d(u):=0.Since adjacent patches share the BB-coefficients along their common boundary, enforcing (3) locally betweenp`andp´by setting to zero each coefficient of the polynomial (in the boundary parameter u) that is the difference between the left side and the right side of (3). This yields a system of 6 linear equations. Enforcing (4) adds another 6 linear equations. Enforcing (3) and (4) locally betweenq`andq´yields another7+8linear equations for a total of 27 linear equations. It is straightforward to compute the symbolic solution of this local system to express dependent BB-coefficients in terms of locally independent BB-coefficients as defined in Fig. 7b. We account for the interactions between the n such local systems of equations at a central pointp`00as follows.(i)We select the six BB-coefficients{plmo,0}0≤l+m≤2that define the quadratic expansion of the first sector (indexk=0) and then express the corresponding (initially independent) BB-coefficients of the other sectors recursively via (6)(6)p´00:=p`00,p´10:=p`10,p´20:=p`20;p´01:=−p`01+2cp`10+2(1−c)p`00;p´11:=−p`11+8c5p`20+2(1−11c15)p`10−2c15p`00;p´02:=p`02−5cp`11+4c2p`20+(5c−4)p`01+c(9−26c3)p`10+(4−9c+14c23)p`00.The assignment in each local system of(7)p´12=−2cp`21+p`12+2cp´21+(11c3−4)p`11+4c15(12−11c)p`20+(4−33c5+106c245)p`10+c3p`01+c45(26c−27)p`00leads globally to a circulant system for computingp12o,k(sincep12o,k−1=p`21andp12o,k=p´12, marked as ⊗, respectively × in Fig. 7b). This circulant system has a solution that is unique except forn=6, where onep12o,k, sayp12o,0, is additionally free to choose. (The casen=3leads to a singularity at the central point and is treated in Section 4 using a different construction.)Lemma 1For any choice of BB-coefficients inPρ, adjacent patchespk−1andpkjoinG2under the reparameterization ρ.TheG1andG2assignments atmk(see the hollow boxes for (8) and diamonds ⋄ for (9) in Fig. 7b)(8)q`i1:=q`i0+14(q`i2−q´i2),q´i1:=q`i0−14(q`i2−q´i2),i=4,5,(9)q`31:=q`30+14(q`32−q´32)+w1(q`52−q´52)+w2(q`42−q´42)+w3(q`50−q`40),q´31:=q`30−14(q`32−q´32)−w1(q`52−q´52)−w2(q`42−q´42)+w3(q`50−q`40),w1:=−c96,w2:=c96,w3:=c30,are incompatible with theC2tensor-border data. Therefore we define for each edge of one sector of the tensor-border b, the reparameterization piecesβmandβlof degree bi-3 (see Fig. 8b). We choose the reparameterization to preserve the first cross-derivative along the border of the cap, i.e.a(u):=1,b(u):=0in (2), and we enforceC2continuity betweenβmandβland symmetry about the diagonal ofβm. Then the choice(10)β22m:=(13+c216,13+c216),β32m:=(12+7c1296,13+c72),β32l:=(1,13+c18)definesβmandβlup to second order along the tensor-border and makes compatible the prolongation of the tensor-border data and the smoothness constraints between sectors of the cap. Let β denote the reparameterization for the whole tensor-border andβkits (identical) pieces, one for each sector.Lemma 2The reparameterized tensor-borderb∘βisC2within each sector and adjacent piecesbk−1∘βk−1andbk∘βkjoinG2by satisfying(8)and(9)(see squares inFig. 7b).We complete the patchespkso that they are internallyC2. This leaves free the set of9n=(3×3)nunconstrained BB-coefficients that determine the center of eachpkwhere its four pieces join (see circles in Fig. 7a). Combining Lemma 1 and Lemma 2 this yields overall curvature continuity.Theorem 1For any choice of BB-coefficientsp2ho,k,plmo,0,pijo,k,h=1,2,3,4,5,0≤l+m≤2,i,j=3,4,5,k=0,…,n−1,(plusp12o,0ifn=6), the just-defined cappis curvature continuous and joins the input patch complex with curvature continuity.We can now succinctly state the full construction.Input: A cap-net of6n+1pointscjk,j=1,…,7with star pointc7=c7k,k=0,…,n−1of valence n (cf. Fig. 8c) – or – an n-sided tensor-border b of degree 3 and depth 2 (cf. Fig. 5b).Output: (Cf. Fig. 4.) A surface cap p consisting of n spline patchespk,k=0,…,n−1. The patchespk−1andpkare joinedG2and the cap joins with b bothC1andG2. Each spline patchpkis internallyC2and consists of2×2polynomial piecespo,k,pr,k,pm,k,pl,kof degree bi-5.Algorithm (forn>4, cf. Fig. 6)1.Set the central pointp00=p00o,kfor all k to the limit point of Catmull–Clark subdivision (Halstead et al., 1993)p00:=nn+5c7+∑i=0n−1(γ5c5i+γ6c6i),γ5:=1n(n+5),γ6:=4n(n+5).Set the tensor-border of p tob∘β.Expressing all dependent BB-coefficients in terms ofp00and the9n+5n+5(9n+5n+6ifn=6) BB-coefficients ofP:={p2ho,k,plmo,0,pijo,k},h=1,2,3,4,5,1≤l+m≤2,i,j=3,4,5(plusp12o,0ifn=6), the surface is determined by minimizing(11)minP⁡Fκ(n)p,κ(n):={n−1,forn=5,6n,forn=7,88,forn>8.The cap construction is linear and coordinate-wise. Due to the relatively short, explicit formulas for the dependent BB-coefficients in terms of the independent BB-coefficients, the construction steps of the algorithm are simple and stable. With the central point set to the Catmull–Clark limit point of the cap-net, (11) requires only solving a linear system of sizeN×N, whereN:=9n+5n+5(14n+6whenn=6). For all reasonable values of n, we have solved this system and computed seven generating functions of the cap-net. The final surface cap is a linear combination of these tabulated generating functions weighted by the cap-net  points.Specifically, since the algorithm works for each coordinate separately, it can be applied to when all cap-net points have value 0, except forcm0=1, for one ofm=1,…,7(cf. Fig. 8c). This yields the scalar-valued bi-5 coefficients(12)hijk,m∈R,k=0,…,n−1,m=1,…,7,i,j∈{0,…,5},wherehij0,7=…=hijn−1,7of the pieces attached to the central point. Then the central patchespo,κ,κ=0..n−1have the BB-coefficients(13)pijo,κ:=hij0,7c7+∑k=0n−1∑m=16hijk,mcmκ−k,where the superscript ofcmκ−kis interpreted modulo n. The remaining pieces are determined by the re-parameterized tensor-border and byC2-extending the central piecespo,κ.The failure of formula (7) to provide adequate shape whenn=3calls for special treatment. By choosing to join the patchespo,k−1andpo,kwith reparameterization(14)ρo:b(u):=−(1−u)3,d(u):=−6(1−u)3,we resolve theG2constraints between thepo,kand retain as independent the BB-coefficients shown in Fig. 9a as black disks. As in Karčiauskas and Peters (2013), the construction results in better shape when the location of the central point is provided. The algorithm sets one of the three neighbors of the star point so that their average equals the limit formula for Catmull–Clark subdivision, except for a slight, shape-wise important perturbation ofγ5.(15)central point=(1−3γ5−3γ6)c7+∑i=02(γ5c5i+γ6c6i),γ5:=596,γ6:=16.The patchespl,k,pm,kandpr,kare fully determined byC2connection to the central patchespo,kand by matching the (degree-raised and split) tensor-border b. The tensor-border is not reparameterized but matched directly. This yields aC2join atmk.Together, the construction now has 45 unconstrained BB-coefficients, all associated withpo: the coefficientspijo,k,i>2,j>2that determinepo,kwhere its four pieces join plus19−1coefficients involved in theG2constraints betweenpo,k−1andpo,k. We tested a broad range of functionals includingFkandFk⁎to determine these coefficients. The best result, obtained by minimizingF4, is shown in Fig. 10c (together with the result of minimizingF2+14F1and the construction of Loop and Schaefer, 2008).Since even the best choice of functionalF4disappoints for valence 3, we construct a 3-pieceG1guide surface g, albeit a simpler one than in Karčiauskas and Peters (2013). Initially, the guide consists of three bi-5 patches (see Fig. 9c) and the patches joinG1via a reparameterization ρ whose relevant part up to first order is defined bya(u):=−1andb(u):=2c(1−u)2=−(1−u)2. The tensor-border BB-coefficientsgijk,i>2orj>2are defined without reparameterization by the surrounding complex and are rendered green in Fig. 9c; In particular, the bi-5 guide isC1connected to the surrounding complex. TheG1constraints leave free the coefficients marked as disks, except that one additional coefficient is fixed to stabilize the central point according to (15). The remaining 14 coefficients are set by minimizingF4(other functionals resulted in poorer shape). Appendix A gives the technical details of how to modify g to have the same layout and a compatible parameterization to p. Analogous to general case, but including the central point, we finally determine p whenn=3by minimizing over the45+1unconstrained coefficients the functional(16)∑k=02∑s∈{o,r,m,l}F4(ps,k−gs,k).That is, we minimize the difference between the guide g and the cap p with respect toF4.We note that the choice (14) does not require reparameterizing the tensor-border so that the cap construction forn=3applies directly to tensor-borders of degree 5. By contrast, the approach of Loop and Schaefer (2008) requires a transition ring. And, if the degree3×5blend is replaced by a sequence of bi-3 patches as in Fig. 11b, the approach of Loop and Schaefer (2008) does not apply since it requires a single cubic per half-edge. The bi-5 construction naturally fits a split boundary. (The resulting highlight line distribution is very similar to that of Fig. 11c shown in Fig. 11d, e and hence is not displayed.)We compared and selected functionals based on a series of basic hard test cases. Here the sectors of the extended cap-net are intentionally planar in order to generate easily understood, namely zero curvature at parts of the tensor-border. (If the tensor-border has itself a complex curvature distribution, it will be more difficult to predict the expected or desirable curvature distribution of the surface cap.) Fig. 12illustrates the effect of different choices of κ when minimizing with respect toFκ. Differences can be subtle and are best observed by moving the surfaces with respect to light sources. Fig. 13and Fig. 14compare the new construction based on minimizing functionals with those of Loop and Schaefer (2008), Catmull–Clark subdivision and Karčiauskas and Peters (2013). Fig. 13 shows limitations of the otherwise good bi-7 construction of Loop and Schaefer (2008). The highlight lines of theF8construction developed in this paper and shown in Fig. 13b are more evenly distributed than of those of Loop and Schaefer (2008) but slightly less so than those of Karčiauskas and Peters (2013) in Fig. 13d. Applying a single Catmull–Clark subdivision step to make the data less extreme improves highlight lines both for Loop and Schaefer (2008) and the present algorithm. More than one step of subdivision not only increases the number of polynomial pieces but also negatively affects the highlight line distribution. Fig. 14 shows the artifacts of Catmull–Clark subdivision when applied to difficult saddle input and to convex input.Fig. 15and Fig. 16illustrate that the construction applies and good shape is obtained also for immediately adjacent caps.Valences aboven=8are exotic in design applications. Here all functionals failed (see Fig. 17b) and, as in Karčiauskas and Peters (2013), we had to make the layout less distorted. In checking functionalsFk, we can restrict k to at most the total degree 10 of the bi-5 patches – but in fact, alreadyF9turned out to be ineffective. A 3-layer construction, analogous to the one explained in Karčiauskas and Peters (2013), with the Catmull–Clark-like 7-partition of Fig. 17d, yields a remarkably well-distributed layout of BB-coefficients. We say remarkably, since Fig. 17d shows the BB-coefficients (uniformly scaled in the y-direction) of this (technically more elaborate) construction forn=1000on input of the tensor-border of the characteristic ring of Catmull–Clark subdivision.

@&#CONCLUSIONS@&#
