@&#MAIN-TITLE@&#
Calibration of a microdialysis sensor and recursive glucose level estimation in ICU patients using Kalman and particle filtering

@&#HIGHLIGHTS@&#
The importance of filtering to the enhancement of the data of a CGMS is illustrated.Kalman filtering applied to simple models of glucose dynamics performs well.Particle filtering performs both filtering and calibration further reducing error.A fault detection scheme is proposed, recognizing faulty intervals or recordings.The error reduction obtained can help integrating a CGMS into an Artificial Pancreas.

@&#KEYPHRASES@&#
Continuous glucose monitoring systems,Artificial Pancreas,Kalman filtering,Particle filtering,Stochastic models,Intensive care unit,

@&#ABSTRACT@&#
This paper deals with the estimation of glucose levels in ICU patients by the application of statistical filter theory to the data provided by a commercial continuous glucose monitoring system using a microdialysis sensor. Kalman and particle filtering are applied to simple models of the glucose dynamics. The particle filter enables the joint filtering and calibration of the sensor. The results show that the proposed filters lead to significant reduction in the estimation error with computational cost well within the capabilities of modern digital equipment. Additionally, the filters can be used for the automatic recognition of sensor faults. These results show that suitable filters can help in the construction of an artificial pancreas.

@&#INTRODUCTION@&#
Diabetes mellitus, referred to also as Diabetes, is a group of metabolic disorders characterized by hyperglycemia (increased blood glucose levels) and intolerance to glucose due to insulin deficiency or reduced insulin action, or both [1]. The three main Diabetes types are Type 1 diabetes, Type 2 diabetes and gestational diabetes. There also exist more, special, types of Diabetes.Type 1 diabetes is an autoimmune disease in which the immune system destroys the insulin-producing beta cells of the pancreas. It has both short-term and long-term consequences. Without insulin treatment it is fatal. It has been estimated [2] that in 2000, 2.8% of the world population was affected by Diabetes, while the same estimate for 2030 is 4.4%. Concerning Type 1 diabetes, and only for the age group up to 14 years, 70,000 new cases appear annually (estimation for 2007, [1]).According to [3], for Type 1 diabetes patients, the administration of insulin in quantities such that the glucose levels are as close as possible to the normal levels, reduces its long-term consequences. This administration can be done either with a higher number of injections or with a continuous infusion pump. The regulation of the glucose levels can be more accurate if the infusion pump is combined with a continuous glucose monitoring system (CGMS). Such a device provides feedback, thus enabling the application of closed-loop control. An infusion pump combined with a CGMS and a suitable control law is frequently called Artificial Pancreas, although the pancreas performs additional functions except for glucose regulation, and does not achieve this goal only through the secretion of insulin. The control strategy for blood glucose regulation as well as the modeling of the underlying system have been a topic of extensive research, see e.g. [4–13].Hyperglycemia and insulin resistance are frequently observed in intensive care unit (ICU) patients, even if previously they did not suffer from Diabetes [14]. Cortisol performs a significant role in this mechanism. As explained in [15], in the past it was considered that the increased glucose levels are acceptable and the hyperglycemia due to stress is beneficial for the ICU patients. However, according to studies [15,16], the regulation of the glucose levels in normal levels reduces significantly the mortality and morbidity of the patients.It has to be noted that in the ICU the patients are fed through a pump. Consequently, the glucose supply rate due to feeding is not unknown, acting as a disturbance from the viewpoint of Control Theory, but is an additional control input. Moreover, if hypoglycemia is detected, which is a more dangerous situation than hyperglycemia, it is possible to increase temporarily the feeding supply rate so as to restore the glucose to normal levels. Furthermore, the insulin infusion pump is administrating the insulin intravenously instead of subcutaneously thus the insulin action is more direct. Therefore, if an accurate and reliable measurement of the blood glucose concentration for the ICU patients is available, its regulation to normal levels presents less difficulties in comparison to the case of Type 1 diabetes patients.The above, combined with the fact that the patients in ICU are closely monitored and many data are recorded for them, suggest that the ICU is a very suitable field for research concerning the Artificial Pancreas.The proper function of the CGMS is of paramount importance for the construction of an artificial pancreas, since the system under control is highly uncertain, thus if the glucose levels are not measured accurately, then it is impossible to control them accurately. The existing systems, however, provide data with non-negligible measurement error and the need for a filter estimating the glucose levels from the available measurements has been pointed out in the literature (see, e.g., [17]). Numerous works have recently addressed this topic [18–22].The extraction of useful information from noisy data is a very old problem, dating at least back to Legendre and Gauss [23–25] who studied problems of astronomy. When the data concerns a dynamical system, the knowledge about the underlying system dynamics can be used to get improved estimates. Moreover, in many engineering applications, new measurements are continuously made and it is desirable that they are incorporated in the estimation recursively, avoiding doing all computations from scratch each time a new measurement is available. Such techniques derive from the fields of telecommunications and navigation [25,26], but have been also applied to a vast variety of applications, including robotics, electric machinery, chemical processes and biomedical engineering.The Kalman filter provides the exact solution in the case of linear systems. For nonlinear systems many approximate techniques have been proposed, including a recent category of techniques called particle filters which take advantage of the computational power of modern computers. As will be explained in the next section which provides a basic background on the problem of recursive state estimation, these techniques assume that the system dynamics and output are described by random variables. Detailed information about these techniques can be found in [25,27–33] and references therein.For the presented research, the continuous glucose monitoring system (CGMS) used was Glucoday S of Menarini Diagnostics. This device has been used in 10 patients in the ICU of the University General Hospital “Attikon”. Glucose measurements are available for these patients with a rate of one measurement every 3min. Many other variables have been recorded, including the insulin delivery rate and the feeding rate. It is important to note that the glucose levels have been measured in parallel (about 10 measurements for every patient) with alternative methods such as the blood gas analyzer, so as to enable calibration and accuracy validation of the CGMS.The data yielded by the CGMS are, as will be evident in the following, subject to a very significant amount of noise. This implies that these data can become suitable for control purposes only if they are filtered and an estimate of the glucose levels with reasonable accuracy is obtained. An additional issue is that in some cases the device ceases to function normally. Therefore it is necessary to develop suitable fault detection algorithms that are able to determine these cases so that no action is taken based on invalid data.Techniques based both on Kalman filtering and particle filtering are presented in this paper and it is shown that particle filtering performs better. This finding is of particular importance since in the existing literature of glucose measurements filtering, Kalman filtering seems to be the method of choice. It is also explained that, at least for the specific sensor used in this study, using supplementary signals provided by the sensor can improve the filtering performance. The influence of the calibration frequency is also investigated and the possibility to automatically recognize periods of unreliable data is illustrated.The paper is structured as follows. The next section provides a basic background about the recursive state estimation techniques for nonlinear stochastic systems that are used in this work. In Section 3 the outputs of the sensor are described and the data it provides are briefly presented illustrating the need for filtering. In Section 4 a first filtering technique, based on the Kalman filter applied to a very simple model of the underlying system, is presented as well as the numerical results obtained. Section 5 concerns the use of more complex models and of Particle Filters. Finally, in Section 6 the results are discussed, the on-line fault detection is studied and conclusions are drawn.The general nonlinear filtering problem for dynamic systems is to estimate the state of systems of the form(1)xk+1=fk(xk,uk,wk),k=0,1,2,…(2)yk=hk(xk,uk,vk),k=1,2,…where xkis the state of the system, ukis the applied input and ykthe measured output at time k.wkis the disturbance, also referred to as process noise, andvkis the measurement noise. A basic assumption is that the random variables x0,wk,k=0,1,2,…andvk,k=1,2,…are mutually independent, otherwise the noise has to be modeled as the output of a suitable coloring filter, which is combined with the system under study to form the augmented system. The filter is then applied to the augmented system. For more details see [27,28].The applied input uk, on the other hand, is known. This implies that for each xk, from (1) it is possible to find the conditional density p(xk+1|xk). Similarly, for each xk+1, (2) corresponds to a specific p(yk+1|xk+1). For example, in the additive noise case it holds pY|X(yk|xk)=pV(yk−h(xk, uk, 0)) andpXk+1|Xk(xk+1|xk)=pW(xk+1−f(xk,uk,0)), wherepV(vk)is the probability density function (pdf) of the measurement noise andpW(wk)is the pdf of the process noise. Suppose thatpX0(x0)is the pdf of x0. In the rest of the text, the subscripts of probability density functions will be omitted for convenience. Let us define y1:k={y1, y2, …, yk}. Our goal is to compute p(xk|y1:k).Using Bayes rule [34–36] the following recursive equations can be shown:(3)p(xk+1|y1:k)=∫p(xk+1|xk)p(xk|y1:k)dxk,(4)p(xk+1|y1:k+1)=p(yk+1|xk+1)p(xk+1|y1:k)/ck,where(5)ck=∫p(yk+1|xk+1)p(xk+1|y1:k)dxk+1.Therefore from p(x0), when y1 is available it is (theoretically) possible to find p(x1|y1), then when y2 is available it is possible to find p(xk|y1:k) for k=2, and so on. However the above integrals cannot be evaluated analytically in most cases. Numerical integration for a sufficiently dense mesh of xkat each time step is also impractical, so (3)–(5) are mainly of theoretical interest.As stated in the introduction, the problem can be solved exactly when the system is linear. This is done as follows: Suppose that a dynamical system is described byxk+1=Akxk+Bk+wk,yk=Ckxk+Dk+vkwherewkandvkare normally distributed with zero mean, while their covariance matrices are Q and R, respectively. Suppose also that it is known that xkfollows the normal distribution with meanxˆkand covariancePxk. Then, a priori with respect to yk+1, xk+1 follows the normal distribution with meanxˆk+1−and covariancePxk+1−given byxˆk+1−=Akxˆk+Bk,Pxk+1−=AkPxkAkT+Q. The predicted value of yk+1 is thenyˆk+1−=Ck+1xˆk+1−+Dkwhile its covariance isPyk+1−=Ck+1Pxk+1−Ck+1T+R,and the cross covariance of xk+1 and yk+1 is equal toPxk+1yk+1−=Pxk+1−Ck+1T. The value of yk+1 can be then used to refine the distribution, according to the following equations:(6)Kk+1=Pxk+1yk+1−Pyk+1−1,xˆk+1=xˆk+1−+Kk+1yk+1−yˆk+1−,Pxk+1=Pxk+1−−Kk+1Pyk+1−Kk+1T.Remark 1If the Gaussian assumption is removed, the KF gives the linear minimum covariance estimate of the state [28,37].For nonlinear systems, even if the noise is Gaussian, the state distribution is not Gaussian. There have been developed some techniques which approximate the state distribution using a Gaussian, and in each step they renew its parameters. More details can be found in [32,33,38,39].Remark 2One more reason that the approximate techniques try to estimate the mean value of the state is that it is the least square error estimator. Specifically, if x is a r.v.,Exis its expected value,Vxits variance andxˆan estimate of x, it holds thatE(x−xˆ)(x−xˆ)T=Vx+(Ex−xˆ)(Ex−xˆ)T.[40] proposes the approximation of the pdf by the sum of the pdf of Gaussians. The pdf obtained in this paper are guaranteed to have the properties that a function must have so that it is a pdf. Several variants are presented in [40] and the case of linear systems with non-Gaussian noise is studied in detail. In all variants the filter is functioning deterministically.In the ‘90s, the particle filter (PF) appeared. Today the respective literature is very extensive (see, e.g., the reviews [30,41]). Many variants exist, often called with other names, such as “Condensation Filter”, “Sequential Monte Carlo Filter”, “Sequential Imputations” as well as others.In the PF, the pdf of the state is approximated by a set of particles, each of them representing a Dirac function with a corresponding weight, namely the approximation is(7)p(xk|y1:k)≈∑i=1NWkiδxki(xk).Then, the mean value of a function g of the state can be estimated using the following equation.(8)E[g(xk)]≈∑i=1NWkig(xki).It is reasonable to conjecture that with a sufficiently large number of particles, the approximation will be satisfactory, however the asymptotic analysis of the PF is a difficult problem [42,43].There exist many different algorithms (see, e.g., [30,41,44,45]) for the renewal ofWkiandxki. The simplest such algorithm, and probably the first which appeared in the literature [46] is as follows:Initially, N random samples are drawn according to the initial state distribution. This set is used as an approximation of the latter. Then, as in the aforementioned filters, a prediction and a correction step are done separately.For the prediction step, letxki,i=1,…,Nbe the set that approximates the distribution of xk(the weights at this point will be always equal, as they are also for k=0). For each particle, a disturbance sampleWkiis drawn according to the disturbance distribution, and the new particlexk+1i,−is computed. The set of the new particles constitutes the approximation of the a priori with respect to the measurement yk+1 distribution of xk+1.For the correction step, the likelihoodlki=p(yk+1|xk+1i,−)of each particle is initially computed. Normalizing so that the sum of all weights is equal to 1 yields(9)Wk+1i=p(yk+1|xk+1i,−)∑n=1Np(yk+1|xk+1n,−).The set of particlesxk+1i,−with weightsWk+1iconstitutes an approximation of the a posteriori distribution of xk+1. The correction step is completed with the resampling process, which serves to avoid the “weight degeneracy” phenomenon. Indeed, if the above renewal procedure were repeated perpetually, and the weights were repeatedly multiplied, then after many steps all particles except for one would have almost zero weight (more detailed explanation of this phenomenon may be found in the related literature [47]).The resampling procedure consists of drawing N random samples from the distribution∑i=1NWk+1iδxk+1i(xk+1), namely for all particlesxk+1j,j=1,…,Nit holds thatP(xk+1j=xk+1i,−)=Wk+1i. This way, it is more probable that more new particles will be created from the particles which had high likelihood, thus more emphasis is given to regions of the state space where it is more probable that the state of the system lies in. The new particles, since have been chosen randomly, have equal weights.The biosensor of the device used converts the glucose levels to an electric current, and based on the current value it is possible to compute the glucose. The current is intended to be proportional to the glucose, though the conversion factor has to be determined making a measurement of the glucose with a different method (e.g. with a test strip). The device also records other variables (e.g. the voltage of the battery), including an auxiliary variable (pressure) which, as will be shown, can help in the estimation of the glucose value.In Fig. 1we present the current and the glucose values (obtained taking blood samples and using a blood gas analyzer11As will be made apparent in the following, the proposed algorithms do not impose any constraint on the intervals among these samples.) for the first patient. Some spikes are observed, which sometimes last for a short time and sometimes last more. Careful observation of the values in the 7th, 8th and 12th glucose sample shows that these values have to be filtered, otherwise the measurement error will be very high. Additionally, we observe that frequent calibration is needed to keep the error small, taking into account that the current/glucose ratio varies as time passes.Fig. 2depicts in a common diagram the current and pressure waveforms. We notice that the current spikes usually coincide with pressure spikes, a feature that can be exploited in the filter design.In Fig. 3the current and pressure waveforms as well as the recorded glucose values for the third patient are presented. In this case we see that around time 1850 (minutes) a phenomenon happens which starts with an abrupt fall of the pressure level which is eventually stabilized except for a brief time period, while during this phenomenon the current initially undergoes a drastic increase and then it is reduced and finally converges (thus stops to carry any information). It is obvious that the current values after the start of this phenomenon cannot be used to estimate the glucose levels, while divergence is also observed during the period 400–500min. There were also two patient cases in which the whole recording could not be used.These diagrams show that the data are such that a filter has to be deployed and careful calibration is required.The filter used is based on the Kalman filter, however its design includes simplifications and assumptions that were determined making observations on the whole dataset and doing experimentation.The central idea is the use of a fictitious variable xkwhich stands for the “correct” value of the current, namely the current value that would be measured if there were no noise. xkis related to the measured current value Ikthrough the equationIk=xk+vk, namely Ikis considered as a noisy measurement of xk. As explained later, the noise variance is assumed to depend on the pressure waveform, since it has been shown that when the pressure is destabilized, the current error is high.With respect to the dynamics of xk, letwk=xk+1−xk, so thatxk+1=xk+wk. Ifwkwere a sequence of random variables (r.v.) with known characteristics, then it would be possible to apply the Kalman filter equations. In reality,wkare not independent. However, given that we do not have enough information about these r.v., we can compute the Kalman Gain that corresponds to the case of independentwkand do the correction step with this gain. This constitutes the applied algorithm. Letσwbe the standard deviation ofwkandσvkbe the standard deviation ofvk. Then, the Kalman Filter equations for the model under consideration are given below:(10)xˆk+1−=xˆk,Pxk+1−=Pxk+σw2(11)Kk+1=Pxk+1−Pxk+1−+σv2(12)xˆk+1=xˆk+1−+Kk+1Ik+1−xˆk+1−,Pxk+1=Pxk+1−σv2Pxk+1−+σv2The standard deviation ofwk,σw, is a parameter of the algorithm. In the following we explain the algorithm that utilizes the pressure waveform to compute a value of the standard deviation ofvk,σvk(again, this is just a value that will be used in the Kalman Filter equations and the following procedure cannot be claimed to accurately findσvk).As seen above, the pressure is normally fluctuating around a baseline which changes slowly and deviates from this level abruptly during the periods of high error. The first stage of the algorithm aims to detect this baseline. Specifically, for each time instant the last 100 samples (up to step 100 all the available samples are used) are taken into account. These samples are sorted and the 10th percentile value is chosen. The samples whose pressure is not more than 20% higher than this level are considered valid, and from these samples the median is extracted. Letpk(n)be this median value. This value is used to computeσvkin the following way.Let pkbe the value of pressure at the time step k. We computerk=pk−pk(n)pk(n). If the relations rk−1≤H, −0.1≤rk≤H hold (H is a parameter), then it holdsσvk=σvwhereσvis the standard deviation of the error when there is no abrupt change (this is what the aforementioned relations express) and is also a parameter. In the opposite case, it holds thatσvk=5|pk−pk(n)|σv.Henceforth, the parameter values used will beσw=0.25,σv=0.1,H=0.06. These values will be used for all recordings; they have been chosen after careful experimentation aiming to optimize the performance of the filtering algorithm. The initial state (namely electric current) estimation is the third sample. The only consequence of this is that the algorithm cannot be used for 6min after taking the first current sample. The initial variance is set equal to 3. In Fig. 4we present the current waveform together with the estimation derived (the estimation is green-colored). It is verified that the filter works, cutting most spikes.Applying the filtering procedure of the previous subsections to all patients (the two cases of unsatisfactory recording and the invalid part in patient 3 are excluded), we get the current and glucose pairs depicted in Fig. 5.Given that the ratio current/glucose changes as time evolves, when a new glucose measurement is made (with a blood gas analyzer or another technique), it is of purpose to perform recalibration. The following algorithm is used. When the first measurement is taken, we compute the coefficientc1=g1/xk1, where g1 is the glucose value of the first measurement, whilexk1is the value of the filtered current at the time of the first measurement (this time is denoted by k1). For the next glucose measurements we apply the relation(13)cn=0.4cn−1+0.6gn/xknto compute the new coefficient; a first-order linear model has been chosen because of its simplicity while the specific parameter values have been selected by experimentation.Having computed this coefficient, the values of (filtered) current are converted to glucose values through the relation g=c·x. Obviously, when we compute the error at time knin order to evaluate the device and the methods of filtering and calibration, we use the coefficient cn−1, namely the estimation error isen=gn−cn−1·xkn.The efficiency of the proposed techniques is evaluated comparing the rms values of the relative estimation error with the respective values of the error in the case that these techniques are not applied. With respect to the filter, the alternative approach would be to use the electric current values without any filtering. With respect to the calibration, it would be also possible to use the last value of the glucose/current ratio to convert the current values to glucose values, namely to use(14)cn=gn/xkn.Therefore we have four different cases.Additionally, it is interesting to study the effect of the calibration frequency to the magnitude of the estimation error. Table 1presents the rms value of the error for the four aforementioned cases as a function of the number of calibrations. The cases considered for this number are 1, 2, 4, 6 as well as the case of using all the samples taken for each patient (last row of the table). The table includes the 7 recordings without problems and the part of the recording of Fig. 3 (patient 3) up to the 10th (glucose) sample. Moreover, in the cases that the first sample was taken too early, it is not taken into account.The results show that in almost all cases the application of the proposed techniques leads to reduction of the error, in many cases important. More specifically, the use of the filter always reduces the error irrespectively of the calibration technique and the number of calibrations. The use of a more complex calibration technique is, expectedly, significant only when the number of calibrations is high, and in this case it leads to error reduction. On the contrary, when only one calibration is done, in both cases the initial coefficient is used until the end and thus the results are identical.The joint use of filter and more complex calibration, compared to the simplest possible estimation, leads always to error reduction, even for one calibration, while for more calibrations the reduction is up to 27%.Table 2presents the results if the whole recording for patient 3 is exempted. In this case, too, it is possible to achieve significant error reduction, up to 25%. The error is now smaller, thus the contribution of the cases with problems in the mean error is significant. If the other patients are included, then the estimation error becomes very high either with or without filters, and it is possible to achieve only a small reduction with careful choice of the parameters.The model used in the previous section takes into account for its prediction only the current value of the estimated electric current, namely it is considered that there is no information about whether this value will be increased or decreased (and how much). This assumption is an oversimplification, since the time step is small, thus the rate of change of the current is not expected to change considerably in one step.Therefore, in order to improve our model we will now consider as a state variable not only the value of the current but also its rate of change. For the rate of change we will assume that in the mean case it is reduced in every time step by a constant percentage. Additionally, we assume that the random changes are multiplicative, based on the grounds that when the glucose levels are higher, it is more likely to have greater (in absolute magnitude) changes. Thus the model considered is:(15)xk+1=1101−rxk+xk,1wk,1wk,2,(16)yk=10xk+vk.The r.v.vk,wk,1andwk,2are assumed independent. Experimentation led to the choice of the following values for the standard deviations:sw,1≈0.018andsw,2=0.005. The value ofsw,1has been chosen so that the hourly relative change has a standard deviation equal to 0.08, using the relation22It is easy to show that if z1, z2, …, zNare independent and equidistributed r.v. with zero mean and variance Q, then it holdsV(1+r1)(1+r2),…,(1+rN)=(1+Q)N−1⇔Q=V+1N−1.Vwk1=1+0.08220−1. The nonlinear termxk,1wk,1is thus taken into account as a noise term of standard deviation equal toxˆk,1sw,1(the nonlinearity was in fact introduced for this reason as already explained; applying the EKF to the model (15)–(16) also leads to the same result).For the parameter r the value chosen was r=0.18, which corresponds to “half-life time” for the rate of change equal to about3log0.5log0.82≈10.5min. For the measurement noise we choosesv=0.085, and the same procedure as in the previous section is followed concerning the pressure waveform. Moreover, for the cases when|yk−xˆk−|>2,35Pk,11−, namely when the measurement deviates more than 2.35 standard deviations from the expected value, the measurement is not taken into account at all, since at that time instant a jump has occurred. Because of the fact that the jumps are now also detected in this way, we increase the value of the parameter H to 0.1. The initialization is done according to the first five current samples, while in the next subsection the first value from the blood gas analyzer is used together with the five current samples just before the blood sample was taken.Fig. 6presents the estimation obtained by the application of the above filter to the current waveform of patient 1. In comparison to the first-order filter, the spikes are smoothed more effectively. The black-colored waveform is 1 when the current value was considered non-predictable and 0 when it was considered predictable. It is verified that, indeed, the samples are considered non-predictable after a jump, and the part with non-predictable values has longer duration when the jump is greater or when the current value does not return to the pre-jump levels.The numerical results obtained by the application of this filter are presented in Subsection 5.3.In this subsection the details about the application of particle filters are presented. Motivation for the use of particle filters constitutes the fact that they offer the possibility to treat jointly filtering and calibration, while up to this point these problems have been dealt with separately.Indeed, with the filters described previously, during the period between two blood samples all changes in the current are considered as changes in the glucose levels, and the current to glucose conversion coefficient is adapted only when a new sample is taken. In reality, however, this coefficient is continuously changing. Therefore, independently of the glucose system dynamics, it is purposeful to consider this coefficient as an additional state variable. It should be clear that, in this case, the glucose dynamics is studied directly and not indirectly as current dynamics.For the correction step, at every step there exists a measurement of the current, which is the product of the coefficient and the glucose. It is this product that introduces nonlinearity to the system and makes necessary the use of particle filters. When a measurement from the blood gas analyzer is taken, in the correction step the particles are assigned a weight proportional to the likelihood of this measurement, therefore the particles with glucose value close to the measurement are favored.Experimentation (with the PF/SIR variant of particle filters) showed that in this case there is no advantage by the use of a model for the glucose dynamics with order greater than one. Therefore as state variables we consider the glucose level and the glucose to current conversion coefficient. The model is:(17)xk+1,1=xk,1(1+wk,G)(18)xk+1,2=xk,2(1+wk,c)(19)yk,C=xk,1xk,2+vk,C(20)yk,G=∑n=1Nδk,kn(xk,1+vk,G)kn, n=1…, N are, as in Subsection 4.2, the instances at which a blood sample is taken and δ is the Kronecker delta.vk,Gis the measurement error of the blood gas analyzer. It has been assumed that its standard deviation is equal to 10mg/dL (all the parameter values have been determined incorporating the available knowledge of the underlying system and after experimentation).With respect toVwk,GandVwk,cit has to holdVwk,G>Vwk,c, otherwise the conversion coefficient would change more rapidly than the glucose thus the performance of the device would be very bad. The hourly deviations considered are 10% and 2%. These values lead, as explained in the previous footnote, to the valuesVwk,G≈0.0005andVwk,c≈0.00002.Additionally, when a jump occurs we assume that the coefficient may change instantaneously. For this reason, when a jump is detected, for the prediction step the second component of every particle is also multiplied by a factor with mean value 1 and varianceVwk,G. A jump is detected at a step when the condition|yk−xˆk,1−|>2Pk,11−holds while at the previous step it did not hold.Fig. 7shows the estimated glucose levels for patient 1, assuming that only the four blood samples marked by a double circle have been taken into account. The performance is very good, as highlighted by the fact that in one of the three recalibrations there is no jump in the estimation, while for the other two it is very small. These jumps are normal since when a new sample is taken the estimation has to be adapted. For the initial calibration there is a jump because the initialization has been based on the unfiltered values, but the sample was taken during a spike, so the filtered values are significantly different. Again with black color we see the non-predictable samples, with values 10 or 0 in this case.In the next subsection the numerical results of this method are compared to those of the previous methods.In the case that the recording of Fig. 3 is also included, the second-order model (15) and (16) incorporating the glucose rate of change as a second state variable does not behave so well. This can be attributed to the fact that an increase in complexity leads to a decrease in robustness. On the contrary, the results show that the model (17)–(20) combined with the use of particle filtering yields very good results, however in this case we do not increase the value ofVwk,cwhen a jump occurs, for the same reason.Table 3shows the values of the rms error. In all cases the more complex model yields better results. The particle filter used is PF/SIR with 100,000 particles. In this case few tenths of a second are required for every step, a computational time that would be prohibitive in many other applications, but in the specific one the time step is equal to 3min so the algorithm is practically applicable. The only consequence of the increased computational cost is that it is not easy to find experimentally the optimal parameter values.Table 4presents the corresponding results for the case that the recording of Fig. 3 is not included. In this case the second-order Kalman Filter leads to error reduction compared to the first-order one. Even in this case, the best results are given by the use of particle filtering to the model (17)–(20). It is remarkable that this model yields the best results even for one calibration, while ostensibly the only advantage of the model is that it combines calibration and filtering. The reason for which the results can be better is that the multiplicative model can explain the current deviation in one more way, as change in the conversion coefficient and not only as change in glucose, thus it is possible to achieve better estimation of the glucose probability distribution.This work studied filters in order to estimate as accurately as possible the glucose value. It is verified that in the majority of cases it is possible using a filter or/and a suitable calibration method to significantly reduce the error.The effect of the calibration frequency to the error has been also studied and the conclusion is that, depending on the method, there is significant improvement up to 4–6 calibrations (total number during the recording, which is equal to around 48h).The main point that has been highlighted is the importance of detecting the periods when the sensor measurement deviates from the real value. During the rest of the time the error is not high, and then the correct calibration is most important. The use of a more complex model for glucose dynamics therefore helps only when there are spikes.For the spikes, as shown earlier, the pressure waveform can help. As mentioned, in some cases the waveform was too problematic to be used. If the estimation algorithms presented are to be embedded in a closed-loop control system, it is of uppermost importance that these cases are automatically recognized.Fig. 8presents the results obtained applying the filter of Subsection 5.1 to the data of the fourth recording. It is obvious both that the recording cannot be used, and that the filter “perceives” this fact by classifying most samples as non-predictable. The difference of Fig. 8 with Fig. 6 with respect to the number of non-predictable samples is striking. Thus this percentage can be used as a criterion for the automatic recognition of cases with problems.It is noted that the particle filter works even better as, except for the initial part, most other samples with few exceptions are marked as non-predictable.The analysis shows that based on these 10 recordings we reach the conclusion that the sensor provides data that, with the aid of suitable recursive state estimation techniques, can be used to estimate satisfyingly the glucose levels, though not in all cases and not during the whole recording. However, it is feasible to recognize automatically the cases and the segments that are not valid.In order to verify that the above conclusions are right, more recordings are needed. For example, with respect to the fault recognition, if we have only two or three cases it is easy to set a threshold in the number of non-predictable samples to make the desired classification, but it is not guaranteed that the same threshold will classify correctly any new recording. Further investigation is thus required.It should be mentioned that the results, especially those concerning the detection of spikes and faults as well as the processing of the pressure waveform, concern the specific device. The application, however, of state estimation techniques will be probably effective in many other devices and this work will be helpful in the choice of algorithms, for example the results of this paper suggest that a suitable particle filter will be expectedly capable of jointly handling calibration and filtering. The modeling principles used are also transferable to the case of other devices.The considerable error reduction and the detection of invalid segments can play an important role in the incorporation of the CGMS into an artificial pancreas. Further research could focus on the combination of filtering and fault detection algorithms with a suitable control strategy.

@&#CONCLUSIONS@&#
