@&#MAIN-TITLE@&#
Non-invasive prediction of hemoglobin level using machine learning techniques with the PPG signal's characteristics features

@&#HIGHLIGHTS@&#
A prediction algorithm method is developed by entering the characteristic features of the PPG signal into machine learning algorithms in order to measure the hemoglobin value non-invasively.We have used the PPG signals in the prediction of hemoglobin levels.As the machine learning algorithms, CART (classification and regression trees), LSR (least squares regression), GLR (generalized linear regression), MVLR (multivariate linear regression), PSLR (partial least squares regression), GRNN (generalized regression neural network), MLP (multilayer perceptron) and SVR (support vector regression) are used.The methods of RELIEFF feature selection (RFS) and correlation-based feature selection (CFS) are used to decrease the number of features.

@&#KEYPHRASES@&#
Photoplethysmography (PPG),Hemoglobin (Hb),Feature extraction,Regression models,Feature selection,Prediction,

@&#ABSTRACT@&#
Hemoglobin can be measured normally after the analysis of the blood sample taken from the body and this measurement is named as invasive. Hemoglobin must continuously be measured to control the disease and its progression in people who go through hemodialysis and have diseases such as oligocythemia and anemia. This gives a perpetual feeling of pain to the people. This paper proposes a non-invasive method for the prediction of the hemoglobin using the characteristic features of the PPG signals and different machine learning algorithms. In this work, PPG signals from 33 people were included in 10 periods and 40 characteristic features were extracted from them. In addition to these features, gender information (male or female), height (as cm), weight (as kg) and age of each subjects were also considered as the features. Blood count and hemoglobin level were measured simultaneously by using the “Hemocue Hb-201TM” device. Using the different machine learning regression techniques (classification and regression trees – CART, least squares regression – LSR, generalized linear regression – GLR, multivariate linear regression – MVLR, partial least squares regression – PLSR, generalized regression neural network – GRNN, MLP – multilayer perceptron, and support vector regression – SVR). RELIEFF feature selection (RFS) and correlation-based feature selection (CFS) were used to select the best features. Original features and selected features using RFS (10 features) and CFS (11 features) were used to predict the hemoglobin level using the different machine learning techniques. To evaluate the performance of the machine learning techniques, different performance measures such as mean absolute error – MAE, mean square error – MSE, R2 (coefficient of determination), root mean square error – RMSE, Mean Absolute Percentage Error (MAPE) and Index of Agreement – IA were used. The promising results were obtained (MSE-0.0027) using the selected features by RFS and SVR. Hence, the proposed method may clinically be used to predict the hemoglobin level of human being clinically without taking and analyzing blood samples.

@&#INTRODUCTION@&#
Hemoglobin (Hb) is the basic component of the red blood cells. The Hb concentration in human blood is an important parameter both for each blood count and the evaluation of the physiologic state of an individual. Many invasive methods, (in which blood is taken from the patient physically and then analyzed) are used to measure the Hb concentration in today's technology. Besides the ailment experienced while taking the blood samples, the disadvantage of such invasive methods is the delay between the bloodletting and blood analysis [1].Knowing the hemoglobin content in blood helps doctors to diagnose many diseases and to know about their healthy status as well. For instance, the anemia, which is responsible for a major part of death, is easily diagnosed with the decrease in the hemoglobin content in blood. Similarly, the daily measurement of the hemoglobin content in blood is significant for the treatment of patients with dengue fever [1,2].In this study, photoplethysmography (PPG) signal was used (non-invasively) to measure the hemoglobin concentration level in blood. Below, information is given about the PPG signal.PPG is obtained through the light that illuminates the relevant area of the body, is reflected or transmitted. In order to obtain the PPG, a light source with a wavelength of λ is placed on one side of an extension, for example a finger, and the photodetector, which will catch the light transmitted right across the source, is positioned on the other side. A typical PPG signal is comprised of a big DC component which passes through skin, muscle and bone without moving through the blood vessels, a small AC component which directly passes through blood vessels by leaving the skin, muscle and bone and the component in the heart beat frequency, which results from the light passing through the arterial blood vessels as well. The blood amount in arteries increases right after the systole, and therefore the light intensity received decreases. The blood amount in arteries is reduced during the diastole and an increase is observed in the light transmission. In a basic measurement area, 99% of the signal comes from the skin, muscle and bone, 0.9% from the vein and 0.1% from the arteries [3].PPG is a photoelectrical method, which is used for measuring the tissue blood volume based on the change in the blood volume at every heartbeat. PPG has been prevalently used for the detection of many basic physiologic parameters such as the oxygen amount in blood [4], heart rate, respiration [5] and blood pressure [6] so far [7]. PPG can also reflect some other significant cardiovascular (related to heart and blood vessels) parameters like embolism [8]. Therefore, it is meaningful and important to deeply analyze the PPG signal for the purpose of discovering various physiologic parameters with high accuracy [9].There are numerous studies available in the literature with regard to the non-invasive measurement of the hemoglobin level in blood. Among these, Masakazu Iwasaka et al. used optical absorption to measure the hemoglobin and red blood cells under the magnetic field in 2001 [10]. In 2007, Gregory D. Jay et al. used the fiber optic reflectance spectroscopy to measure the value of the hemoglobin level [11]. In 2009, Linda M. Head et al. developed the wireless fNIR spectroscopy for the detection of Hb (hemoglobin) and HbO2 (oxy-hemoglobin concentration) [12]. In 2009, U. Timm et al. developed an optical sensor system to determine the hemoglobin value [13]. In 2011, they used the near infrared spectroscopy to detect the hemoglobin concentration of the newborns while breathing [14]. In 2013, Luangrat et al. developed an impact detector system, which can be used at home, in order to measure the hemoglobin level in blood non-invasively and used the single infrared LED for calculating the hemoglobin value [15]. In 2014, Ding et al. formed a broadband light source consisting of nine LEDs with the grating spectrography and Si (silicium) photodiode array and developed a high-performance spectrophotometric system to measure the hemoglobin value [16]. In 2014, Nirupa J. et al. suggested a system relying on the estimation with empirical formulas from the PPG signal based on two different wavelengths to measure the oxygen saturation in blood, change in the heart rate and hemoglobin value [1].In this study, a method based on machine learning associated with characteristic features of the PPG signal has been developed to measure the hemoglobin value non-invasively. Hence, PPG signals of 33 people were included in 10 periods and 40 characteristic features were extracted from the PPG signal of each person. In addition to these features, gender information (male or female), height (as cm), weight (as kg) and age information about them were also added and the number of features was increased up to 44. Blood count and hemoglobin measurement were performed simultaneously by using the “Hemocue Hb-201TM” device during the reception of the PPG signals. Afterwards, these 44 features were entered into the machine learning algorithms and hemoglobin values of the people were estimated. Additively, the methods of RELIEFF feature selection (RFS) and correlation based feature selection (CFS) have been used to decrease the number of features. For evaluating the performance of the machine learning methods, MAE (mean absolute error), MSE (mean square error), R2, RMSE (root mean square error), MAPE (mean absolute percentage error) and Index of Agreement (IA) were used.The outline of this paper is organized as follows. Section 2 depicts the material and method. The results and discussion have been explained in the Section 3. Section 4 concludes the paper.In this study, the PPG signal was received from 33 subjects through the data obtainment card without taking any blood sample. Meanwhile, blood count and hemoglobin measurement of these subjects were also carried out simultaneously while receiving the PPG signals through the “Hemocue Hb-201TM” device. 10-PPG signals were received from 33 subjects and Table 1gives the statistical information about those subjects. Measurement mechanism is given in Fig. 1.The PPG signal is produced with the periodical heartbeat. Therefore, heart rate has a close relation to the beating period because it can be extracted. Another aspect is that this blood flow in vessels influences the vessel flexibility and blood viscosity (resistance against fluidity). Moreover, plenty of cardiovascular (related to heart and blood vessels) information can be selected from the PPG signal. All the physiologic parameters of this type are reflected within the feature points of the PPG signal as shown in Fig. 2[9,37].In a typical PPG signal, the section from S to M point is the fast beating phase and the part from M to P point is the delaying phase. M is the main peak point of the PPG signal. At this point, the blood pressure (BP) has the highest value within the whole period. Another peak is the dicrotic wave of the artiole, which is called Q and reflects its adaptation. The P point is named as dicrotic notch. Heart rate is obtained from the duration between two main peaks (tpp). The M–Q time slot is an index of the arteriosclerosis (vessel stiffness). However, it is difficult to directly obtain the feature points for the real PPG signal because of the presence of various factors. For this purpose, it is important to find useful pre-processing and feature extraction methods to determine the PPG signal accurately [9,37].The PPG signals were obtained from their right index fingers while the people were seated in a calm position. Prior to the acquisition of data, information regarding the study was given to the volunteers, the questions they were curious about were answered, the explanations as to the privacy of the data and their personal information and keeping them within the limits of scientific studies were made, and they were given a form to fill out the information about their consent and approval of volunteering to participate in this study.In this work, the PPG signals have been obtained by means of an STM32F103xC ARM-based PPG data-acquisition card with a 2kHz sampling frequency, a 32-bit microcontroller, and a DCM03 reflection sensor on it. The circuit schematic diagram of used PPG data acquisition system has been shown in Fig. 3.Various pre-processing steps were used to eliminate the noise in the PPG signals after their reception. In order to remove the noise in PPG signals as a pre-processing, a low-pass FIR filter with an N=200 points and 10Hz cut-off frequency has been used.During the feature extraction from the PPG signal, 40 time-domain features were extracted by using the status of the PPG signal after the pre-processing, the first derivative of its status after the pre-processing and the second derivative of its status after the pre-processing. Distribution of these features was obtained as follows: 21 time-domain features from the PPG signal, 8 time-domain features from the first derivative of the PPG signal, 7 time-domain features from the second derivative of the PPG signal and the remaining 4 features from the combination of the first and second derivatives of the PPG signal. Fig. 4shows the feature extraction block diagram from PPG signal, and its derivatives.In this stage, the 40 characteristic properties are obtained from the first and second derivations of PPG signals. Fig. 5shows the relationship of the PPG signals with the first and second derivations. By using these relationships, the points of properties are defined. For more information about these forty characteristic points from both PPG signal and its derivatives, the readers can refer to [36].In this paper study, a new method has been suggested based on the PPG signal, which is a non-invasive method without taking blood sample from the human body, and machine learning methods for the non-invasive and distant prediction of the hemoglobin value. First of all, blood count and hemoglobin measurement were simultaneously performed by using the “Hemocue Hb-201TM” device. Meanwhile, 10-period PPG signals were received from the related person right after the measurement through the device. Then, 40 characteristic features were extracted from the PPG signal and the number of the features was increased up to 44 with the addition of the physical attributes that belonged to the person. Two methods were used to decrease the number of the features: RELIEF feature selection and correlation based feature selection. The total data amount was increased up to 330 with the 10-period signals of 33 people by using a dataset with 44 features. The numbers of the features were respectively reduced down to 10 and 11 after the application of the RFS and CFS methods onto the dataset with 44 features. After the feature selection process, eight different machine learning methods were implemented to estimate the hemoglobin values.The feature selection algorithms are often used for the purpose of selecting the relevant features associated with the output label and minimizing the computational time during classification process of classification. There are mainly two objectives in feature selection: the first is to minimize the classification cost by reducing the number of features and thus, forming a more compact classification model; and the second is to improve the classification performance [38]. Here, we have used two different feature selection methods including RELIEF feature selection and correlation based feature selection.RELIEF is a feature selection algorithm suggested by Kira and Rendell in 1992 and used in the binary data classification [20]. Being independent on the heuristic structure it has many strong aspects and it needs only linear time for the number of the given features and training samples. It has a structure, which can be applied to continuous or binary data. However, it cannot make a good distinction in case of the existence of unnecessary features and less training samples. Kononenko et al. made improvements in the system by applying the RELIEFF algorithm on attributes such as generalization for multiclass datasets and strength in incomplete data [18,19]. After RELIEFF based feature selection being applied to PPG dataset with hemoglobin prediction, the number of features has been decreased from 44 to 10. The selected features are as follows:The selected features by RELIEF based feature selection:The selected features by means of RFS method (from 44 features to 10 features)4143424410126372716Correlation is a criterion used to measure whether a feature is relevant to other features in dataset and relevant to outputs or not. A feature is good if it is relevant to the class but is not redundant to any of the other relevant features. Applied with correlation, the good side of a feature is measured according to whether it is highly correlated with the class or not highly correlated with any of the other features [21,22]. Here, we have used the correlation coefficient probability (p-value) to select the significant features from all dataset. In this work, the p values has been chosen as p<0.01. After CFS method applied to PPG dataset with hemoglobin prediction, the number of features has been decreased from 44 to 11. The selected features are as follows:The selected features by means of CFS method:The selected features by means of CFS method (from 44 features to 11 features)1418232627343841424344In this study, 40 characteristic features were extracted from the PPG signal of each person; in addition to these features, gender information (male or female), height (as cm), weight (as kg) and age information about them were also added and the number of features was increased up to 44. Afterwards, these 44 features were entered into the machine learning algorithms and hemoglobin values of the people were estimated. The used machine learning algorithms are as follows: CART (classification and regression trees), LSR (Least Square Regression), GLR (generalized linear regression), MVLR (multivariate linear regression), PLSR (partial least squares regression), GRNN (generalized regression neural network), MLP (multilayer perceptron), and SVR (support vector regression). The machine learning methods used are explained under titles below. The parameters used in the machine learning methods are shown in Table 2.In this work, conventional validation was performed. 70% of the data were used for training and the remaining 30% of the data were used for testing. Same training and testing data were used for all the classifiers. Training and testing were repeated for 25 times and the results were presented in terms of mean and standard deviation.Classification and regression trees are machine learning methods for constituting prediction models from the data. Models are obtained with successive data space partitioning and the concordance of a simple prediction method within each division. As a result, splitting can be shown in a schema as a decision tree. Classification trees are designed for dependent variables, which take the foreseen error measured in terms of wrong classification costs (expenses) and the irregular values at a finite number. Regression trees are generally for variables, which take permanent or sequential disjoint values and depend on the estimation error measured with the quadratic difference between the observed and predicted values [23].The least squares method is a standard approach for the approximate solution of the over-determined systems; that is, they are the equation sets in which there are more equalities than unknowns. “The least squares” method is the minimization of the sum of the errors made in equality result within the general solution. The least squares method divides the problems into two categories: linear or ordinary least squares and nonlinear least squares, depending on whether each unknown value of the redundancies is linear. The linear least squares problem occurs in statistical regression analysis; there is a closed-form solution available. A closed-form solution (or a closed expression) is a formula, which can assess the standard operation at a limited number. A nonlinear problem doesn’t have a closed-form solution and it is generally solved through the iterated treatment, which is approximated to the system by a linear problem at each repetition and in which the kernel calculation is made similar in both situations [24].In statistics, the generalized linear regression is a flexible generalization of the ordinary linear regression, which provides response variables – error distribution models out of a normal distribution. The generalized linear regression generalizes the linear regression by allowing the associated linear model between a connection function and the response variable and providing the variance (deviation) size of each measurement as a function of the expected value [25].Multivariate regression models aim at defining the behavior of many response variables in terms of other variables. Multivariate regression models expand the main thought (idea) of only one response variable or linear regression models with many response variables. These models have broad applicability and can be used in training area as well. In this paper, easily digestible mathematical formulation of the multivariate linear regression model is given. The assembly model is described with the least squares method and the implementation of the monte-regression model is shown with a simple example [26].Partial least squares regression (PLS regression) is a statistical method, basic components of which carry some relationships of the regression; it discovers a linear regression model by reflecting the estimation variables and observable variables on a new space instead of finding the minimum variance hyper-planes between the response and independent variables, because both X and Y data design new spaces. The PLS method family is known as bilinear factor models. The partial least squares method is a variety of the Discriminant Analysis (PLS-DA) that is used when Y is categorical. PLS is a latent variable approach for modeling covariance structures in these two spaces; that is, it is used to find the basic relationships between two matrices (X and Y). A PLS model tries to find the multidimensional direction in X space explaining the maximum dimensional variance in Y space. The PLS regression model is especially applicable when there are more variables in feature predictions than the observations, and multiple connections exist between X values. On the contrary, standard regression is unsuccessful in these situations [27].GRNN is a variety of the radial basis neural networks based on kernel regression networks [28]. GRNN doesn’t require a repeated training procedure like back-propagation networks. These training data directly approximate the function estimation to an arbitrary function between plotting, input and output vectors. Additionally, the estimation error approaches zero as the size of the training set expands.GRNN consists of four main layers; these are input, model, summation and output layers as shown in Fig. 6. The number of input units in the input layer depends on the total number of the observation parameters. The first layer is connected to the pattern layer and each neuron in this layer points at a training pattern and output. Model layer is connected to the summation layer. The summation layer is comprised of two different parts as a single division unit and summation units. Summation and output layers have an influence normalizing the output set. And the network training uses the radial basis and linear activation functions as hidden and output layers [28,39,40].Multilayer perceptron (MLP) is a feed-forward artificial neural network that maps sets of input data onto a set of appropriate outputs. A MLP consists of many layer structures that combine each layer, which is fully connected to the next one, and directed nodes in a graph. Except for the input nodes, each node is a neuron (or processing element) with a nonlinear activation function. MLP utilizes a supervised learning technique called back-propagation for training the network. [30][31]. MLP is a modification of the standard linear perceptron and can distinguish data that are not linearly separable [29].The Support Vector Machine algorithm (maximum-margin) can be used as a regression method by protecting all the basic features characterized. The support vector regression (SVR) method utilizes the same principles with the classified SVM structure with only a few small differences. First of all, it becomes quite difficult to predict the present information with endless possibilities, because the output is a real number. In case of this regression, tolerance (epsilon) is the approximated setting of the SVM model that is already claimed from the problem. Besides this reality, there is however another complicated reason, and therefore, the situation to consider is more complexes. But the main idea is always the same: customization of the maximized margin sub plane for the minimization of the error by keeping in mind that the part of the error is tolerated [32].

@&#CONCLUSIONS@&#
The measurement of the hemoglobin content in blood does not only give information about the health of a patient, but also helps the doctor to decide on a treatment for many diseases. Hemoglobin in blood is normally measured after taking blood sample from the body. This causes inconvenience for the patients whose hemoglobin is continuously measured. A new non-invasive hemoglobin measurement method, which is based on PPG signal and machine learning, has been proposed in this study. In this method, the hemoglobin values of the people were estimated by receiving PPG signals from them, extracting time-domain features from those signals and entering them into machine learning algorithms. 8 different regression methods were used for the prediction of the hemoglobin value, including the CART (classification and regression trees), LSR (least squares regression), GLR (generalized linear regression), MVLR (multivariate linear regression), PLSR (partial least squares regression), GRNN (generalized regression neural network), MLP (multilayer perceptron) and SVR (support vector regression) methods. Besides, the methods of RELIEF feature selection (RFS) and correlation based feature selection (CFS) methods were used to decrease the number of features. The number of the features was considerably decreased down to 10 and 11 (RFS and CFS) with the application of these feature selection algorithms onto the dataset with 44 features. According to the R2 performance criteria, the support vector regression has been found to be the best machine learning method in the prediction of hemoglobin level. As the hybrid model, the combination of RFS and SVR has obtained very good results in the prediction of hemoglobin level. The obtained results have shown that the combination of RFS and SVR could be confidently used in the prediction of hemoglobin level as the non-invasive method based on PPG signal.