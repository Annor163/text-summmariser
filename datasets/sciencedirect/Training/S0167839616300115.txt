@&#MAIN-TITLE@&#
On constructing RAGS via homogeneous splines

@&#HIGHLIGHTS@&#
Piecewise rational functions, called rational geometric splines (or RAGS), are studied.RAGS are suitable for representing surfaces of arbitrary genus and continuity.A construction of parametric homogeneous splines is proposed.Interpolation and approximation methods for constructing smooth splines are presented.It is shown how homogeneous splines can be used to obtain RAGS.

@&#KEYPHRASES@&#
Splines on triangulations,Piecewise rational function,Unstructured mesh,Arbitrary topological genus,Homogeneous geometry,Homogeneous spline,

@&#ABSTRACT@&#
Recently, a construction of spline spaces suitable for representing smooth parametric surfaces of arbitrary topological genus and arbitrary order of continuity has been proposed. These splines, called RAGS (rational geometric splines), are a direct generalization of bivariate polynomial splines on planar triangulations. In this paper we discuss how to construct parametric splines associated with the three homogeneous geometries (spherical, affine, and hyperbolic) and we also consider a number of related computational issues. We then show how homogeneous splines can be used to obtain RAGS. As examples of RAGS surfaces we consider direct analogs of the Powell–Sabin macro-elements and also spline surfaces of higher degrees and higher orders of continuity obtained by minimizing an energy functional.

@&#INTRODUCTION@&#
In a recent paper (Beccari et al., 2014), we have proposed a general method of defining rational splines, so-called RAGS (or rational geometric splines), capable of representing surfaces of general topological genus. The main advantage of RAGS surfaces in comparison to alternative representations, for example those based on so-called manifold splines (Grimm and Hughes, 1995; Navau and Garcia, 2000; Della Vecchia et al., 2008; Gu et al., 2008; Tosun and Zorin, 2011), subdivision methods (Warren and Weimer, 2001; Sabin, 2005; Peters and Reif, 2008; Cashman, 2012), and T-splines (Sederberg et al., 2003; Li and Qin, 2012; Scott et al., 2013), is that they mimic the standard bivariate splines on planar domains and their constructive aspects, and as such, they are closer in spirit to the traditional NURBS representation. The point of departure for constructing RAGS is a given mesh, which is a triangulation inR3and an appropriate collection of so-called transition maps that are linear rational transformations. Such transformations allow one to “glue” together neighboring triangles of the mesh and have also been recently considered in Peters and Fan (2010), Peters and Sarov (2015). As was pointed out in our mentioned paper, a possible way of finding such transition maps is by means of a homogeneous geometry. Our purpose in the current paper is to give more details on this approach and also to report on our initial numerical experience with RAGS.Before we delve into details, we point out that the idea of using homogeneous geometry in connection with defining splines is not new. One attempt in this direction is reported in Alfeld et al. (1996a, 1996b, 1996c) where the authors consider the so-called spherical splines, which are in essence piecewise spherical harmonic functions. In Liu and Schumaker (1996), such spherical splines are also used to define a class ofC1andC2interpolating splines on the sphere that are piecewise rational functions and, as it turns out, they represent special instances of RAGS. Another kind of homogeneous geometry, namely the hyperbolic geometry, can be used to model surfaces of genus larger than one. This was initially noticed in Ferguson and Rockwood (1993) and later also considered in Wallner (1996), Pottmann and Wallner (1997). It was also pointed out in these last two references that such surfaces can be parameterized as piecewise rational surfaces. For a more detailed historical perspective on these topics, we refer to the discussion in Beccari et al. (2014).The paper is organized as follows. The first part is concerned with the construction of parametric homogeneous splines and a number of algorithmic issues. Then we describe several specific interpolation and approximation methods for constructing smooth splines, including analogs of the Powell–Sabin method and a global energy-minimization method. Finally, we show how homogeneous splines can be used to obtain RAGS and present a few numerical examples.The starting point for the construction of splines in this paper is a mesh Δ. We assume that Δ is a triangulation of a finite set of points inR3. Thus, Δ will be thought of as a surface or, more precisely, a closed 2-manifold (orientable or non-orientable) embedded inR3. The assumption that Δ has no boundary is not essential, it merely serves here to simplify the exposition. Depending on its genus, this surface can be equipped with one of the standard homogeneous geometries, spherical, affine, or hyperbolic. This means that one can find a triangulation, denoted byΔH, which is combinatorially equivalent to Δ, corresponding to one of these homogeneous geometries (hence the subscript “H” in the notation). In particular,ΔHwill be a collection of triangles that are either spherical (if the genus g is 0), planar (or affine,g=1), or hyperbolic (g>1). More precisely, “triangles” inΔHwill be equivalence classes of congruent triangles. To work with such triangles, we will either select a specific representative, i.e. a triple of vertices in one of the three homogeneous planes (denoted by the generic symbolP, so thatPwill either be the sphere, the affine plane, or the hyperbolic plane), or we will represent such a triangle as a triple of its interior angles.In order forΔHto be a well-defined triangulation, triangles inΔHmust be compatible in the following sense. Let v be a vertex of Δ and letC(v)be the set of all trianglesT1,…,Tν∈Δcontaining v. We callC(v)the cell corresponding to vertex v. Here ν denotes the valence of v, i.e., the cardinality ofC(v). Without loss of generality, we will assume that the triangles ofC(v)are ordered such thatT1=〈v,v1,v2〉,…,Tν−1=〈v,vν−1,vν〉,Tν=〈v,vν,v1〉, wherev1,…,vνare the vertices of Δ that are connected to v by an edge of Δ. Next, letC(v)={T1,…,Tν}be the set of triangles inΔHcorresponding toC(v). The mentioned compatibility condition onΔHis that there must exist a set of pointsu,u1,…,uν∈P, such that triangles〈u,u1,u2〉,…,〈u,uν,u1〉have disjoint interiors (i.e. are non-overlapping) and are congruent toT1,…,Tν, respectively. Thus, we can think ofC(v)as a set of physical triangles inP, sharing a common vertex u.The above compatibility condition implies the following fact, to be used later. LetT,T′be adjacent triangles of Δ, i.e. such that they share a common edge, and letT,T′be their corresponding counterparts inΔH(we also call suchT,T′adjacent.) Then one can find four pointsu1,u2,u3,u3′such that the triangles〈u1,u2,u3〉,〈u1,u2,u3′〉do not overlap and that they are congruent withT,T′, respectively.To explain the construction of a spline space corresponding to Δ (or, equivalently, toΔH), we first consider a single triangleTinΔHand define appropriate spaces of “polynomials” that will be used as building blocks for the desired splines.Given three linearly independent vectorsu1,u2,u3∈R3, any vectoru∈R3can be expressed in a unique way as a linear combinationu=b1(u)u1+b2(u)u2+b3(u)u3. The numbersb1,b2,b3are linear homogeneous functions of u and are called the trihedral or homogeneous barycentric coordinates of u with respect tou1,u2,u3(Alfeld et al., 1996b). Recall that a function f defined onR3is said to be homogeneous of degree n providedf(αv)=αnf(v),α∈R,v∈R3. Thus, the coordinatesb1,b2,b3are trivariate homogeneous polynomials of degree one.In this paper we will be interested in the cases where the pointsu1,u2,u3are vertices of a triangle in one of the three homogeneous planesP. In particular, we assume thatPis one of the standard surfaces, i.e. either the sphere,S={(x,y,z)∈R3|x2+y2+z2=1}, the affine plane,A={(x,y,z)∈R3|z=1}, or the hyperbolic plane,H={(x,y,z)∈R3|−x2−y2+z2=1,z>0}, and we will consider the restrictions ofb1,b2,b3toP. In the first case, these restrictions have been termed spherical barycentric coordinates (Alfeld et al., 1996a), in the second case, one obtains the standard planar or affine coordinates (since(b1+b2+b3)|A=1), and, lastly, ifP=H, the restrictions could be dubbed hyperbolic barycentric coordinates. However, for simplicity, we will use the generic term barycentric coordinates, or b.c.s, for short.Barycentric coordinates share many properties with their planar counterparts. Letu1,u2,u3∈Pbe linearly independent and letV(u1,u2,u3):={u∈R3:b1(u),b2(u),b3(u)⩾0}be the corresponding trihedron. ByT=〈u1,u2,u3〉⊂P, we denote the triangle obtained as the intersection ofV(u1,u2,u3)withP. We list the following facts without proof. Fori=1,2,3, one has(P1)bi(uj)=δij,j=1,2,3, whereδijis the Kronecker delta;bi(u)⩾0,u∈T;bi(u)=0, foru∈P, if and only if u is on the geodesic containing edgeεiofTopposite toui. In the canonical setting, wherePis one of the three standard surfaces considered above, a geodesic is the intersection ofPwith a plane inR3passing through the origin;foru∈T\{u1,u2,u3}, one hasb1(u)+b2(u)+b3(u){>1,P=S,=1,P=A,<1,P=H.Property (P3) implies that a point u on an edge ofTcan be expressed by means of its b.c.s with respect to the endpoints of that edge, oru=b1u1+b2u2,u∈u1u2ˆ, whereu1u2ˆdenotes the edge (or geodesic arc) ofTwith endpointsu1,u2. The next three propositions provide means for the evaluation of b.c.s. The following result is stated without proof (but see Alfeld et al., 1996a for the spherical case).Proposition 1LetT=〈u1,u2,u3〉⊂Pbe a non-degenerate triangle, i.e. such thatu1,u2,u3are independent, and letu∈P. Then(1)bi(u)=ρ(ri)ρ(si),i=1,2,3,whereri,siare the respective signed distances ofu,uifrom the geodesic containing edgeεi(Fig. 1(left)) andρ(t):={sin⁡(t),P=S,t,P=A,sinh⁡(t),P=H.We use the convention thatsi>0and thatri<0, ifu,uiare on the opposite sides of the plane passing throughεiand the origin, andri⩾0otherwise.Another useful property of b.c.s is that they are invariant under congruence transformations. This can be seen as a direct consequence of the following formulas for b.c.s, showing that the b.c.s depend only on internal angles of associated triangles.Proposition 2LetT=〈u1,u2,u3〉⊂Pbe non-degenerate andu∈P. Then(2)bi(u)=sin⁡αisin⁡βisin⁡γisin⁡δisin⁡αi−1sin⁡αi+1,i=1,2,3,where the expression on the right is defined as 0 ifδi=π, and where we assume that the indicesi−1,i,i+1are a cyclic permutation of1,2,3. Here we denoted byβi,γi,δithe interior angles of the triangle〈ui+1,ui−1,u〉, seeFig. 1(right).ProofWe adopt the convention thatβi,γi∈[0,π],δi∈(0,π]if u anduiare on the same side of edgeui−1ui+1ˆ, whereasβi,γi∈[π,2π],δi∈[π,2π)otherwise. We will prove the statement for the casei=3, the other cases being similar. If u is on the geodesic containing edgeε3=u1u2ˆ, orδ3=π, then by property (P3),b3(u)=0. Otherwise, identity (2) can be proved by a repeated application of the law of sines. In particular, for triangle〈u1,u2,u〉and one of its subtriangles, we getρ(t3)ρ(d3)=sin⁡γ3sin⁡δ3,ρ(r3)ρ(t3)=sin⁡β3sin⁡(π/2),whereas for triangle〈u1,u2,u3〉and one of its subtriangles, one hasρ(d2)ρ(d3)=sin⁡α2sin⁡α3,ρ(s3)ρ(d2)=sin⁡α1sin⁡(π/2).Formula (1), together with the above identities, yields the desired equalityb3(u)=ρ(r3)ρ(s3)=sin⁡α3sin⁡β3sin⁡γ3sin⁡δ3sin⁡α1sin⁡α2,which completes the proof. □The result above allows us to prove the following important formulas for b.c.s associated with adjacent triangles.Proposition 3Consider two adjacent trianglesT=〈u1,u2,u3〉andT′=〈u1,u2,u3′〉inP, with angles〈α1,α2,α3〉and〈α1′,α2′,α3′〉. Letλ1,λ2,λ3be the b.c.s ofu3′w.r.t.T. Then(3)λ1=sin⁡(α2+α2′)sin⁡α1sin⁡α1′sin⁡α3′sin⁡α1sin⁡α2,λ2=sin⁡(α1+α1′)sin⁡α2sin⁡α2′sin⁡α3′sin⁡α1sin⁡α2,λ3=−sin⁡α3sin⁡α1′sin⁡α2′sin⁡α3′sin⁡α1sin⁡α2.We follow the notation in Fig. 2, where anglesγ1,δ1are the interior angles of triangle〈u2,u3,u3′〉corresponding to verticesu3,u3′, respectively. The expression forλ3is an immediate consequence of Proposition 2, withi=3,u=u3′,δ3=2π−α3′,β3=2π−α1′,γ3=2π−α2′. As forλ1, suppose first thatδ1=0. Then the three pointsu2,u3,u3′lie on a single geodesic and hence, by property (P3),λ1=0. On account ofα2+α2′=π, this is consistent with the first identity in (3). Next, we proceed under the assumption thatδ1≠0. Then formula (2), withi=1,β1=α2+α2′, givesλ1=sin⁡α1sin⁡(α2+α2′)sin⁡γ1sin⁡δ1sin⁡α2sin⁡α3.Therefore, to prove the assertion of the proposition, it remains to show thatsin⁡α1sin⁡γ1sin⁡α3′sin⁡δ1sin⁡α3sin⁡α1′=1.However, this can be easily verified by applying the law of sines to triangles〈u3,u3′,u2〉,〈u1,u2,u3〉, and〈u1,u2,u3′〉. The proof forλ2is analogous. □The above proposition states that the interior angles associated with trianglesT,T′readily determine the b.c.sλ1,λ2,λ3. This is not surprising, given the mentioned fact that the b.c.s are invariant under congruence transformations. Curiously, the formula is formally the same in all three cases (spherical, affine, hyperbolic). Moreover, the expressions forλ1,λ2,λ3are always well defined as long as the two triangles are non-degenerate, i.e., all associated angles are in(0,π). Lastly, in the affine case one hasα1+α2+α3=α1′+α2′+α3′=πand it is easy to see that thenλ1+λ2+λ3=1, as expected.We recall some elementary facts concerning homogeneous polynomials (Alfeld et al., 1996a). LetT=〈u1,u2,u3〉be a nondegenerate triangle inPand letb1,b2,b3denote the associated b.c.s. Homogeneous Bernstein basis polynomials of degree n are defined asBijkn(u):=n!i!j!k!b1i(u)b2j(u)b3k(u),i+j+k=n,u∈P.It can be easily proved that such functions are linearly independent and hence every p inπn, the space of homogeneous parametric polynomials of degree n, has a unique expansion of the form(4)p(u)=∑i+j+k=ncijkBijkn(u),u∈P,where thecijk∈R3are the so-called Bézier or control points of p. This equation is customarily referred to as the Bernstein–Bézier representation, or simply the B-form, of p.Due to their formal analogy with ordinary bivariate polynomials, homogeneous polynomials in the B-form inherit many of the properties of their planar counterparts. In particular, they can be evaluated by means of the well-known de Casteljau algorithm and conditions for two polynomials on adjacent triangles joining smoothly across their common edge are formally the same as those for ordinary polynomials, as can be seen below. We will omit the proof of the next result since it follows along standard lines (see e.g. Alfeld et al., 1996a).Proposition 4LetT=〈u1,u2,u3〉andT′=〈u1,u2,u3′〉be two adjacent triangles inPand letp=∑i+j+k=ncijkBijknandp′=∑i+j+k=ncijk′Bijk′nbe polynomials defined onTandT′, respectively. Then p andp′join withCmcontinuity,m=0,…,n, along the common edgeu1u2ˆif and only ifcijk′=∑ν+μ+κ=kci+ν,j+μ,kBνμκk(u3′),k=0,…,m,i+j+k=n.Homogeneous polynomials defined in the previous section can be used to construct spline spaces corresponding to a given mesh Δ by means of the combinatorially equivalent triangulationΔH. A spline s in such a space will simply be a piecewise-defined function composed of individual polynomial piecessT:=s|T∈πn|T, whereTwill vary over the triangles ofΔH. Note that by definition (4), for given fixed Bézier coefficientscijkofsT, this function will not depend on which particular representative of the equivalence class of congruent triangles withTis considered, given that b.c.s are invariant under congruence transformations. We will use the notations:ΔH→R3for composite parametric functions s such that, for anyT∈ΔH, the restrictionsTsatisfiessT(u)=sˆ(b(u)),u∈T, for some functionsˆindependent of the particular representative chosen forT, whereb(u)is the vector of b.c.s of u w.r.t.T.In addition to being piecewise (homogeneous) polynomials, our splines will be required to be globallyCmcontinuous, for somem≥0, i.e. they will belong to the classCm(ΔH). This will be the space of all functionsf:ΔH→R3that areCmcontinuous in the following sense. Let v be a vertex of Δ and letC(v)be the cell ofΔHcorresponding to cellC(v)of Δ, whose existence was postulated at the beginning of Section 2. Also, letU(v)⊂Pbe the union of all triangles ofC(v). We say that a functionf:ΔH→R3isCmcontinuous if f isCmcontinuous in the interior ofU(v), for all vertices v of Δ. We note that f is well defined in all ofU(v)since it is defined for allT∈C(v)and values off|Tdo not depend on the particular representative forTthat we choose (sincef|Tis a function of b.c.s).We are now ready to define a spline space of piecewise homogeneous polynomial functions associated with Δ. Letm,nbe nonnegative integers. We callSnm(Δ):={s∈Cm(ΔH):s|T∈πn|T,T∈ΔH}the space of homogeneous splines of degree n and smoothness m. We will refer to these spaces as spherical, affine, and hyperbolic splines in the casesP=S,A,H, respectively.To construct a spline for a given triangulation Δ, we will first need to find an appropriate triangulationΔH. This will be discussed in the next section. After that continuity conditions will be imposed between neighboring Bézier patches (i.e. polynomials associated with adjacent trianglesT,T′), specified in Proposition 4, which will give rise to a linear system of equations for the Bézier points of the individual patches.Of immediate interest is the problem of the dimension of the spaceSnm(Δ). This is known to be a difficult question even in the affine case and, in fact, the exact dimension is known only when n is sufficiently large relative to m, see the extensive discussion in Lai and Schumaker (2007). In the non-affine case, the situation is similar. For example, the spherical case has been dealt with in detail in Alfeld et al. (1996b) and we expect that in the hyperbolic case the results will be similar, especially in the tractable casen≥3m+2, since, as was pointed out earlier, smoothness conditions between neighboring polynomial pieces are formally the same for all three types of geometries. However, the dimension question and the construction of bases forSnm(Δ)will not be dealt with in this paper.Here we will content ourselves with stating the dimension in the special case ofC0splines. To this end we letnV,nE,nTdenote the respective numbers of vertices, edges, and triangles of Δ. Then(6)dimSn0(Δ)=nV+(n−1)nE+12(n−1)(n−2)nT,which is a direct consequence of theC0-continuity conditions (5) and the fact that the Bernstein basis polynomials in (4) are independent and in one-to-one correspondence with control pointscijk. We also note in passing the following well-known formulas for the numbersnV,nE,nT, and the genus g of Δ:nT=2nV+4(g−1),nE=3nV+6(g−1).Given the initial triangulation Δ, the definition of the spline space in previous section requires the knowledge of a triangulationΔH. In particular, there is a one-to-one correspondence between triangles in Δ andΔH. We will use the notationΔ={Ti}i=1nTandΔH={Ti}i=1nT.In this section we will introduce a possible way to obtainΔH. Since elements ofΔHare equivalence classes of congruent triangles inP, we will assume that triangles inΔHare represented as triples of angles rather than triples of points inP. We will henceforth use the notationTi=〈α1i,α2i,α3i〉, whereα1i,α3i,α3i∈(0,π). The lengths of the edges opposite to these angles will be denoted byd1i,d2i,d3i. It is well known that in the spherical case one has(7)cos⁡d3i=cos⁡α1icos⁡α2i+cos⁡α3isin⁡α1isin⁡α2i,whereas in the hyperbolic case the same formula holds, withcos⁡d3ireplaced withcosh⁡d3i(Ratcliffe, 2007). Formulas ford1i,d2iare analogous.We also recall that any tripleα1i,α2i,α3i∈(0,π)gives rise to a unique triangle (up to congruence) in one of the three homogeneous geometries, namely to a hyperbolic triangle, ifα1i+α2i+α3i<π, or affine, ifα1i+α2i+α3i=π, or spherical, ifα1i+α2i+α3i>π.The following are necessary and sufficient conditions on anglesα1i,α2i,α3i, for the existence of a consistent triangulationΔH:(T1)the sum of angles around each vertex is 2π;common sides of adjacent triangles have equal lengths.The problem of finding a suitable triangulationΔHcan be thought of as a parametrization problem and it has received considerable attention in the planar case, see for example Floater (1997). In the following we describe the algorithm we have used in our examples, although alternative approaches are possible.We use the convention that all angles surrounding vertex j of valenceνjare labeled asβjik, whereikis the index of the k-th triangle containing vertex j, and wherek=1,…,νj(Fig. 3(left)). We will seek a set of appropriate angles definingΔHas a solution of a constrained minimization problem with a suitable objective function and with nonlinear constraints represented by conditions (T1) and (T2). A possibility is to minimize the quadratic function(8)∑i=1nT(α1i−α2i)2+(α2i−α3i)2+(α3i−α1i)2,so as to obtain a triangulation which is as close as possible to being “uniform”. Moreover, by (7), condition (T2) gives rise to a set of distance constraints:(9)dij:=cos⁡α1icos⁡α2i+cos⁡α3isin⁡α1isin⁡α2i−cos⁡α1jcos⁡α2j+cos⁡α3jsin⁡α1jsin⁡α2j=0,for all pairs of adjacent trianglesTi=〈α1i,α2i,α3i〉,Tj=〈α1j,α2j,α3j〉, where anglesα3iandα3jare assumed to be opposite the common edge (cf. Fig. 3 (right)), whereas condition (T1) can be expressed as(10)∑k=1νjβjik=2π,j=1,…,nV.Equations (9) and (10) are constraints associated with vertices and edges ofΔH, and hence their total number isnV+nE. For meshes of moderate size, such as the one depicted later in Fig. 6, we have successfully solved the above optimization problem by the MATLAB routine FSOLVE, using the Levenberg–Marquard algorithm, with the tolerance set to the machine precision, and with initial valuesβjik=2πνj,k=1,…,νj,j=1,…,nV.It should be pointed out that the expression on the right-hand side of (7) is not related to the length of an edge in the affine case, i.e. whenα1i+α2i+α3i=π. In that case the expression equals 1 and hence condition (9) is automatically satisfied. We further note that the formulation of the optimization problem does not require the genus g as input and nor is it necessary to specify which of the three homogeneous geometries is to be used. Lastly, instead of (8), it would make sense to devise more sophisticated objective functions, for example ones that take into account the geometry of the mesh Δ, so as to minimize distortions in the parametrization. We view this as a separate problem of finding an optimal parametrization. Although not studied in the current paper, we think this problem deserves a thorough investigation.A distinct advantage of homogeneous splines is that standard bivariate spline methods — which are well suited for modeling (scalar and vector) functions over planar triangulations — can be adapted to surfaces of general topology without the need to invent entirely new approaches. To illustrate this point, we present in this section a few examples of local and global surface fitting methods.Local techniques are traditionally based on the use of so-called macro-elements. As a prototype of such splines, we have chosen the classical Powell–Sabin method, although other well-known types of elements can be obtained as a direct generalization of the affine case, such as the Clough–Tocher cubic element and many others (described for example in the recent monograph Schumaker, 2015).As for global methods, we describe here how to construct interpolating spline surfaces of arbitrary degrees and orders of continuity by minimizing a suitable energy functional.The Powell–Sabin scheme consists in subdividing each triangleT∈ΔH, called in this context a macro-triangle, into six subtriangles. A quadratic polynomial is then defined on each subtriangle in such a way that the resulting composite surface is globallyC1continuous (for more details on this construction in the planar case, see Lai and Schumaker, 2007; Schumaker, 2015). To explain this further, letT=〈u1,u2,u3〉, whereu1,u2,u3∈P. The splitting of the triangle can be done by considering the incenter ξ ofT, i.e., the intersection of the angle bisectors ofT. One way to compute the incenter is to radially project the incenter of the flat triangle with verticesu1,u2,u3ontoP. The next step in the subdivision is to split each of the three edges ofT. LetT′be an adjacent triangle toT, with common edgeu1u2ˆ, say, and letξ′be the incenter ofT′. We defineξ3to be the intersection ofu1u2ˆwith the geodesic line passing through the two incenters ξ andξ′. The reason for choosing incenters ofTandT′is that this guarantees thatξ3is strictly inside the edgeu1u2ˆ. This follows by a similar argument as in the plane (see Lemma 4.19 in Lai and Schumaker (2007)). Pointsξ1,ξ2are defined analogously.The four pointsξ,ξ1,ξ2,ξ3give rise to a subdivision ofTinto six subtriangles, as shown in Fig. 4(left). To associate a quadratic Bézier polynomial with each subtriangle, it will be necessary to determine appropriate Bézier points, which will be labeled as in Fig. 4 (right). These will be defined such that the resulting spline surface interpolates the vertices of Δ and is globallyC1smooth. The standard way to achieve the latter is to also interpolate directional derivatives at the vertices of each of the macro-elements. If these derivatives are not given, which is often the case, they can be estimated.A reasonable way of estimating the directional derivatives is to require that the resulting interpolating spline has the so-called quadratic reproduction property. This means that if the vertices of the mesh Δ are incident on a quadratic homogeneous polynomial surface, then locally the spline must be identical to this surface. Such reproduction property is usually necessary for the interpolation scheme to have optimal approximation order. More precisely, suppose that we desire to estimate directional derivatives at a vertexu1ofΔHand thatT=〈u1,u2,u3〉∈ΔHis a triangle containing this vertex. To this end, we first find a best quadratic fit of the mesh points of Δ in the vicinity ofv1, the mesh point of Δ corresponding to vertexu1. In particular, our objective is to find a quadratic parametric polynomialq∈π2, parameterized byb=(b1,b2,b3)t, the barycentric coordinates w.r.t. the reference triangleT, such thatq(b(u1))=q((1,0,0)t)=v1and that∑u∈U1‖q(b(u))−v(u)‖22=∑u∈U1‖∑i+j+k=2cijkBijk2(u)−v(u)‖22is minimized, where‖⋅‖2denotes the Euclidean norm, and wherev(u)denotes the mesh point of Δ corresponding to vertex u. The sum above is taken over all verticesU1ofΔHthat are in the vicinity ofu1. In our implementation, we considered the setU1of all mesh points ofΔHthat either belong to a triangle ofΔHcontainingu1, or to a triangle sharing an edge with a triangle containingu1. This guarantees that the size ofU1is at least 6, the dimension ofπ2, and that the above problem has a unique solution. Note that the minimization problem gives rise to three separate linear systems for thex,y,z-coordinates of the Bézier pointscijk∈R3. Moreover, the resulting quadratic fit will not depend on which reference triangleTcontaining vertexu1we select or which particular representative〈u1,u2,u3〉in the equivalence class of congruent triangles we consider forT.Once a local quadratic fit q is found for vertexu1, we can compute the sought-for directional derivatives in the direction of edges emanating fromu1as follows. Letu1uℓˆ⊂P,ℓ≠1, be one such edge and suppose thatt1ℓis the unit tangent vector to the arcu1uℓˆatu1, see Fig. 4 (left). The directional derivativeδ1ℓof q atu1in the directiont1ℓis given asδ1ℓ:=Dt1ℓq(b(u1)):=dq(b(u(h)))dh|h=0,whereu(h)is any smooth parametrization of the arcu1uℓˆ, such thatu(0)=u1andu′(0)=t1ℓ. Using the chain rule, one obtains the following formula:δ1ℓ=bt(t1ℓ)∇bq(b(u1)),where∇b=(∂b1,∂b2,∂b3)tandb(t1ℓ)is the column vector of b.c.s oft1ℓw.r.t. the reference triangleT=〈u1,u2,u3〉. We note that since q is quadratic, all three components of∇bq(b)are linear. As a result, one has∇bq(b(u1))=2(c200,c110,c101)t, which are coefficients of the obtained quadratic fit q.From now on, the construction of the Powell–Sabin macro-elements can proceed in a fully local way, as is standard in the classical setting (Schumaker, 2015). First, Bézier coefficients associated with the edges ofΔHare determined. For example, referring to Fig. 4 (right), for edgeu1u2ˆ, these are coefficientsc1,c2,c4,c5,c6. The first two of these are readily determined by the interpolation conditions,c1=v1,c2=v2. The coefficientsc4,c6are obtained by the requirement that the directional derivatives in the direction of the edge are equal toδ12,δ21, respectively. For example, for the macro-element to interpolate the directional derivativeδ12atu1, coefficientc4can be obtained as the solution ofδ12=Dt12p(b(u1))=2(b1c1+b2c4),whereb1,b2are the b.c.s oft12w.r.t. pointsu1,ξ3, i.e.t12=b1u1+b2ξ3, and where p is the quadratic polynomial associated with edgeu1ξ3ˆ(i.e. with coefficientsc1,c4,c5). Coefficientc5can now be determined by theC1conditions fromc4,c6, namelyc5=b1′c4+b2′c6,where nowb1′,b2′are the b.c.s ofξ3w.r.t.u1,u2, orξ3=b1′u1+b2′u2. All remaining Bézier coefficients, that are “interior” to a given triangle, say triangle〈u1,u2,u3〉(i.e. coefficientsc13,…,c19in Fig. 4 (right)), can be obtained fromC1-continuity conditions corresponding to adjacent subtriangles of the macro-element. For example, one hasc13=b1″c1+b2″c4+b3″c12,c14=b1′c13+b2′c15,c19=b1‴c13+b2‴c15+b3‴c17,whereb1″,b2″,b3″are the b.c.s of ξ w.r.t.u1,ξ3,ξ2andb1‴,b2‴,b3‴are the b.c.s of ξ w.r.t.u1,u2,u3.The above construction guarantees that adjacent macro-elements areC1continuous and thus so is the resulting composite spline surface. In particular, theC1continuity across the macro-edges (edges ofΔH) is due to the fact that the directional derivativesδℓℓ′are, by construction, compatible with a uniquely defined tangent plane at each vertex of Δ.In the previous section we considered a local construction of aC1surface, composed of macro-elements. An alternative to the above approach is not to subdivide individual triangles of the mesh Δ and instead use the spline spaceSnm(Δ)directly, as defined in Section 2.3. Such an approach is quite robust in that it can be in principle applied for any parametersm,nand can be used for a variety of data-fitting methods. In particular, if one wants to interpolate the vertices of the mesh Δ by a smooth spline, a standard possibility is to seek a solution of the following minimization problem: For givenm<n, find a splines∈Snm(Δ), such thats(ui)=vi,i=1,…,nV, and such that an energy or “fairness” functional,E(s), is minimized. In the context of CAGD, this minimization is done to uniquely determine available degrees of freedom (i.e. any spline control points that are not readily set by the interpolation and smoothness conditions) and in such a way as to obtain a visually pleasing surface, free of artificial undulations not suggested by the geometry of the mesh Δ.The above interpolation problem can be formulated explicitly in terms of the Bézier coefficients of the sought-for spline. Let us suppose that these coefficients are collected in a vectorc=(c1,…,cM)t, whereM=dim⁡Sn0(Δ)is as in (6). For convenience, we will assume that the coefficients are ordered such that the firstnVentries,c1,…,cnV, of c correspond to the Bézier points associated with verticesvi,i=1,…,nV, of Δ. Moreover, we assume that when two polynomial pieces join along an edge, the Bézier points along that edge are included in vector c just once. With this convention, the interpolating spline s can be determined as the minimizer of the energy functionalE(s), subject to the constraints(11)ci=vi,i=1,…,nV,and(12)Cc=0.Here, C is aK×Mmatrix that encodes the set ofCm-continuity conditions for s across all edges of Δ, specified in Proposition 4. These are linear homogeneous equations for the coefficients c.Frequently, the energy functional can be expressed as a quadratic form:(13)E(c)=ctQc,where Q is anM×Msymmetric positive definite matrix. In that case, the interpolation problem reduces to finding a solution to the linear system:(14)(QEtCtE00C00)(cμκ)=(0v0),where E is thenV×Mmatrix of the formE=(InV0)(InVis thenV×nVidentity matrix),v=(v1,…,vnV)t, andμ=(μ1,…,μnV)t,κ=(κ1,…,κK)tare vectors of Lagrange multipliers associated with (11) and (12), respectively.Some remarks on the above system are in order. If the full set of continuity conditions is considered, then the number of rows of C isK=(n+n−1+⋯+n−m+1)nE=(mn−(m2))nEsince there are nC1-continuity conditions per edge,n−1equations forC2continuity, etc. It turns out that such matrix C is rank deficient and therefore the system matrix in (14) is singular. This has been well known already in the context of ordinary splines (Lai and Schumaker, 2007) and even spherical splines (Alfeld et al., 1996b). However, the rank-deficiency of C does not affect the consistency of the linear system. There are two basic approaches to attempt to solve such a system. Either one employs a system solver that can handle consistent singular linear systems or, alternatively, instead of C one can consider a matrix with a reduced number of rows by eliminating dependent rows of C. The latter approach is tractable if m is small compared to n (in particular, ifn≥4m+1or evenn≥3m+2), for in that case one can identify explicitly and in a local way redundant continuity conditions.It is clear that the above-described approach is global, since all coefficients are the solution of a single linear system, which might be in fact quite large. However, the system is typically very sparse and hence system solvers taking advantage of the sparsity should be used. In particular, matrix Q is sparse for a variety of energy functionals, including the one considered below, and so is the matrix C. For example, forC1continuity (m=1) there are at most 4 nonzero entries in each row of C and at most 7 such entries forC2-continuous splines.Concerning the solvability of the system, because of the close resemblance of the splines considered here with the classical splines, we have reasons to believe that the system is uniquely solvable for any degree n and smoothness m, as long as n is sufficiently large relative to m. We plan to address this issue more rigorously elsewhere and, instead, we will content ourselves with pointing out that this claim is supported by our numerical experiments.In the remainder of this subsection, we will discuss a suitable choice of energy for (13) that we have implemented and used in our experiments. Our starting point is the operator(15)LP=∂x2+∂y2+σP∂z2,whereσP:={1,ifP=S,0,ifP=A,−1,ifP=H.Thus, in the first two cases,LPis the standard Laplacian operator. We can now define the Laplace–Beltrami operator,LP⁎, by(16)LP⁎f:=LPf(⋅/‖⋅‖P)|P,which should hold for all sufficiently differentiable functions f onP. Thus,LP⁎fis defined as the restriction toPofLPapplied to the homogeneous extension of f of degree 0. Here‖(x,y,z)‖P:=σP(x2+y2)+z2, so that(x,y,z)/‖(x,y,z)‖P∈P, for all(x,y,z)∈R3for whichσP(x2+y2)+z2>0.We now define the energy functionalE(s)of a splines∈Snm(Δ)asE(s)=∑T∈ΔH∫T(LP⁎s)2dτ,where dτ is the Lebesgue measure onPcorresponding to the standard metric onP. We can now work out the entries of matrix Q in (13). Clearly, if s is a spline with coefficient vector c, the above functional has the form (13), with matrix entries(17)Qℓ,ℓ′=∑T∈ΔH∫T(LP⁎Bℓn,T)(LP⁎Bℓ′n,T)dτ,ℓ,ℓ′=1,…,M.Here, the functionBℓn,Tdenotes the Bernstein basis polynomial corresponding to Bézier pointcℓ. Ifcℓis not associated withT, thenBℓn,Tis understood to be zero. Thus, it is not difficult to see that Q is sparse. Indeed, letℓ,ℓ′be such that the Bézier pointscℓandcℓ′correspond to interior Bézier points (i.e., points not associated with vertices or edges of Δ) of two separate trianglesTandT′. ThenQℓ,ℓ′=0, since all summands in (17) are trivially zero.To compute the non-zero entries of Q, we can use numerical quadrature. In our implementation, this has been done as follows. Consider a triangleT=〈u1,u2,u3〉∈ΔH. Then the value of∫T(LP⁎Bℓn,T)(LP⁎Bℓ′n,T)dτcan be computed by parameterizingTby the planar triangleT‾with the same vertices asT(Alfeld et al., 1996c). In particular, a pointu¯∈T‾can be mapped tou∈Tby the transformationu=Au¯‖Au¯‖P,where A is the matrix whose columns are vectorsu1,u2,u3. One can show that the surface integral of an integrable function f onTcan be evaluated as∫Tf(u)dτ=∫T‾f(Au¯‖Au¯‖P)‖N(u¯)‖Pdu¯,whereN(u¯)is a normal vector ofPatu=Au¯/‖Au¯‖P, such that‖N(u¯)‖P=|det⁡A|/‖Au¯‖P3. Thus, definingh(u¯):=LP⁎Bℓn,T(Au¯‖Au¯‖P)LP⁎Bℓ′n,T(Au¯‖Au¯‖P),we obtain∫T(LP⁎Bℓn,T)(LP⁎Bℓ′n,T)dτ=|det⁡A|∫T‾h(u¯)‖Au¯‖P3du¯.The value of this integral can be computed by any standard numerical quadrature. We used a Gauss quadrature formula in our implementation.The final issue that needs to be addressed is the evaluation ofLP⁎p, where p is a homogeneous polynomial of degree n, required in the computation of function h above. Similarly to the spherical case (Alfeld et al., 1996c), one can accomplish this by using the identityLP⁎p=LPp−σPn(n+1)p,which holds for any homogeneous trivariate polynomial p of degree n. This is a direct consequence of definitions (15) and (16). To evaluate the expressionLPp, we can view p as a homogeneous trivariate function of the barycentric coordinatesb1,b2,b3w.r.t.T. By differentiating w.r.t.b1,b2,b3instead ofx,y,z, we obtainLPp=bt(e1)Hb(p)b(e1)+bt(e2)Hb(p)b(e2)+σPbt(e3)Hb(p)b(e3),whereei,i=1,2,3are the unit coordinate vectors andHb(p)is the Hessian matrixHb(p):=(∂2p∂bi∂bj)i,j=13.Having discussed homogeneous splines in previous sections, it is natural to also consider rational versions of such functions. These turn out to be special cases of the rational geometric splines (or RAGS) introduced recently in Beccari et al. (2014), capable of representing smooth surfaces of arbitrary topological genus. To obtain RAGS from homogeneous splines, lets:ΔH→R3be a spline inSnm(Δ)and letw:ΔH→Rbe a scalar homogeneous spline of degree n and smoothnessCm(i.e., an element of the scalar counterpart ofSnm(Δ)). We now consider a rational spline of the formrH=s/w. In particular, for any triangleT∈ΔH, denoting byb(u)the b.c.s ofu∈Tw.r.t.T, one can write for the restrictionrHTofrHtoT:rHT(b(u))=∑cijkTBijkn,T(u)∑wijkTBijkn,T(u),u∈T,wherecijkT∈R3,wijkT∈Rare the respective Bézier coefficients ofs|Tandw|T, indexed byT∈Δ, the triangle associated withT∈ΔH, and where the summation is over alli,j,ksuch thati+j+k=n(see Fig. 5). For the above rational function to be well-defined, we will assume that all coefficientswijkT, which will be referred to as the weights, are positive. This is a sufficient condition for the spline w to be positive. Clearly, since both spliness,wareCmcontinuous, so isrH. Moreover,rHTcan be parameterized by the (flat) triangle T and, consequently, it can be viewed as an ordinary rational function (i.e. the quotient of two algebraic bivariate polynomials). This can be seen by invoking the homogeneity of the Bernstein polynomialsBijkn,Tas follows (cf. Beccari et al., 2014):(18)rHT(b(u))=∑cijkT(b1+b2+b3)nBijkn,T(v)∑wijkT(b1+b2+b3)nBijkn,T(v)=∑cijkTBijkn,T(v)∑wijkTBijkn,T(v)=:rT(b¯(v)),whereb¯(v):=(b1,b2,b3)t/(b1+b2+b3)are the affine b.c.s ofv:=b¯1v1+b¯2v2+b¯3v3∈T,v1,v2,v3are the vertices of T, and whereBijkn,Tare ordinary Bernstein polynomials (i.e. functions of affine b.c.sb¯). Note thatb¯(v)is well defined for allv∈Tsince by our definition of b.c.s,b1+b2+b3=b1(u)+b2(u)+b3(u)>0,u∈T. A consequence of the previous discussion is thatrHcan be viewed as a rational (algebraic) spline parameterized by the mesh Δ, namely the rational spliner:Δ→R3such thatr|T=rT,T∈Δ. Moreover, this spline, viewed as the image of the mappingr:Δ→R3, is aCmsurface. It follows that r is a RAGS spline in the sense of Beccari et al. (2014). However, it should be pointed out that while homogeneous geometry and the resulting homogeneous splines make it possible to construct RAGS, this is by no means the only way. We are currently exploring alternative methods of obtaining such splines.Offhand, it is not clear whether a smooth positive spline w needed for the above construction even exists. The answer is affirmative, at least in the case where n is even, for then we can set w to be identically equal to the constant function 1. This is because it is well known that the space of homogeneous polynomials of an even degree, restricted toP, contains constants. As a consequence, in the even-degree case, constants are also elements ofSnm(Δ), for all m. Note that this is not true for odd-degree polynomials, unlessP=A. The existence of a smooth positive spline w (with positive weights) for odd-degree splines is not guaranteed in general. However, we expect that such w will typically exist if n is “large enough” relative to m.Next, we restrict ourselves to the even-degree case and derive a formula for the weights corresponding to the constant spline w. It will be sufficient to consider the casen=2since for larger even values of n the weights can be determined by degree elevation. More precisely, ifwijkare such that the quadratic polynomialw=∑i+j+k=2wijkBijk2is identically equal to 1, we can obtain the weights corresponding to any other (even) degree n by expanding out the right-hand side of identity1=wn/2.Proposition 5Letw=∑i+j+k=2wijkBijk2be a quadratic polynomial associated with a triangleT⊂Pwith interior angles〈α1,α2,α3〉, and suppose that w is identically equal to one. Thenw200=w020=w002=1andw011=cos⁡α2cos⁡α3+cos⁡α1sin⁡α2sin⁡α3,w101=cos⁡α1cos⁡α3+cos⁡α2sin⁡α1sin⁡α3,w110=cos⁡α1cos⁡α2+cos⁡α3sin⁡α1sin⁡α2.The first set of identities follows from the interpolation property of the Bézier coefficients at the vertices ofT. As for the second set, we only prove the formula forw110, i.e. the Bézier coefficient associated with the edge ofTopposite to the third vertex ofT. Let us assume that a triangle with verticesu1,u2,u3∈Pis a representative of the equivalence class of triangles congruent toT. To obtainw110, the following must hold:(19)w200B2002(u)+w110B1102(u)+w020B0202(u)=b12+2w110b1b2+b22=1,for allu∈u1u2ˆ, whereb1,b2are the b.c.s of u w.r.t.u1,u2. It will be sufficient to select any point u in the interior of edgeu1u2ˆ(so thatb1b2≠0) and solve forw110. This will guarantee that equation (19) holds for three distinct values of u, and therefore it must be true for all u, given that constants are in the linear span ofB2002,B1102,B0202. For simplicity, we setu=u1+u2∥u1+u2∥P∈u1u2ˆ, which givesb1=b2=1/∥u1+u2∥P, or, by (19),w110=∥u1+u2∥P22−1.By an elementary calculation in the three separate cases,P=S,A,H, the previous expression simplifies tow110={cos⁡(d3),P=S,1,P=A,cosh⁡(d3),P=H,whered3is the length of edgeu1u2ˆ. The assertion of the proposition is now a consequence of formula (7) and the analogous formula in the hyperbolic case. □In the context of rational splines it is customary to express individual patches of r, defined in (18), in the form(20)rT=∑dijkTwijkTBijkn,T∑wijkTBijkn,T,where thedijkT:=cijkT/wijkT∈R3are called the control points of the rational spline. On account of the positivity of the weights, the control points are well defined. These control points are more convenient to work with since by (20), values ofrTare obtained as convex combinations of such control points and hence they are geometrically more meaningful than thecijkT's. In the usual way, the control points give rise to the so-called control net of r. By virtue of the convex hull property and the property that the control net is tangent to the corresponding surface at the vertices of the mesh, the control net mimics the behavior of the corresponding spline surface. In many other ways, working with RAGS is analogous to working with classical bivariate polynomial splines.The set of rational splines r considered here, corresponding to given fixedm,n, and Δ, is not a linear space. However, one can obtain a linear space by fixing the weightswijkT,T∈Δ, i.e. by fixing the denominator of each rational patchrT. In the setting considered here, in which RAGS are obtained from homogeneous splines, we propose to fix these weights, in the even-degree case, in accordance with Proposition 5 and the degree-elevation idea for degrees larger than two. Thus, one can think of the weights as being determined mainly by the combinatorial structure of the triangulation Δ, i.e. by its topology, whereas the control pointsdijkTcan be selected independently of the weights, with the aim to control the geometry of the resulting RAGS surface. Thinking of RAGS as linear spaces is of interest in connection with using such splines as finite elements for purposes of isogeometric analysis, i.e. for approximation as opposed to merely geometric modeling.The following numerical examples illustrate RAGS surfaces obtained by methods described in previous sections. The surfaces displayed in Figs. 7 and 8 are examples of local and global interpolation byC1Powell–Sabin macro-elements for the mesh in Fig. 6(left). In the former case, the required directional derivatives are estimated by the local approach presented in Section 4.1, which guarantees that the RAGS spline has the quadratic reproduction property. For the surface in Fig. 8, the derivatives are computed by requiring that the surface minimize the energy functional (13). As a consequence, the latter approach is global in nature and, as can be reasonably expected, it results in better aesthetic quality. Finally, the example in Fig. 9 is generated by the global interpolation method described in Section 4.2, employing degree-6 patches andC2-continuity conditions. It turns out that each surface is tangent to its respective control net at the vertices of Δ, in the same way as in the case of standard splines.The illustrations in Figs. 7, 8, and 9depict, from left to right, collections of individual surface patches, the final surface plots, the Gaussian curvature, and the zebra-line plots.

@&#CONCLUSIONS@&#
