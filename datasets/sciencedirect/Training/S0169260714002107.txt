@&#MAIN-TITLE@&#
Robust model predictive control for optimal continuous drug administration

@&#HIGHLIGHTS@&#
The model predictive control methodology was used to design an optimal drug administration scheme for continuous drug administration.A PBPK model served as the predictive model, after it is formulated as a state-space system.The methodology can impose constraints on all different compartments, even if drug concentration measurements are not possible by augmenting the control system with an observer.Through the application to the problem of distributing DMA in mice, it was shown that the method is not sensitive to the presence of measurement noise and intra-patient variability.

@&#KEYPHRASES@&#
Drug administration control,Drug dosing,PBPK modelling,Model predictive control,

@&#ABSTRACT@&#
In this paper the model predictive control (MPC) technology is used for tackling the optimal drug administration problem. The important advantage of MPC compared to other control technologies is that it explicitly takes into account the constraints of the system. In particular, for drug treatments of living organisms, MPC can guarantee satisfaction of the minimum toxic concentration (MTC) constraints. A whole-body physiologically-based pharmacokinetic (PBPK) model serves as the dynamic prediction model of the system after it is formulated as a discrete-time state-space model. Only plasma measurements are assumed to be measured on-line. The rest of the states (drug concentrations in other organs and tissues) are estimated in real time by designing an artificial observer. The complete system (observer and MPC controller) is able to drive the drug concentration to the desired levels at the organs of interest, while satisfying the imposed constraints, even in the presence of modelling errors, disturbances and noise.A case study on a PBPK model with 7 compartments, constraints on 5 tissues and a variable drug concentration set-point illustrates the efficiency of the methodology in drug dosing control applications. The proposed methodology is also tested in an uncertain setting and proves successful in presence of modelling errors and inaccurate measurements.

@&#INTRODUCTION@&#
Determining the best dose for a patient is a key question in medicine and is of equal importance to drug discovery in the narrower sense of finding a chemical compound with the desired therapeutic properties [1].Traditionally, drug administration scheduling is designed using average population pharmacokinetic and/or pharmacodynamic profiles [2,3]. This common practice yields suboptimal therapies and does not consider the distinct attributes of the patients treating them as a bulk. Outliers of the general distribution are likely to exhibit adverse effects due to violation of toxicity constraints or may fail to retain the therapeutic levels. The lack of any feedback that comes with the assumption of zero disturbances contributes even more to the probability of adverse effects. Nowadays, the grounds have shifted and the need for accuracy and efficiency calls for closed-loop practices thus introducing control theory into the field of drug administration. Drug dosing controllers should not only lead to a stable closed-loop system but also need to take into account the state and actuator constraints which in some cases are patient-specific [4]. Such constraints result from safety considerations against adverse effects and are qualified by means of the tissue-specific minimum toxic concentration (MTC) values. Upper bounds are also imposed on the influx rate when the administration is intravenous. Computer-aided drug administration can provide an optimal solution to the problem, with the guarantee that all safety requirements are fulfilled.The study of the disposition of the administered drug inside the body is the first step towards designing an administration policy. Physiologically-based pharmacokinetic (PBPK) models use knowledge of the physiology and the anatomy of the studied species to accurately describe plasma, tissue, and, in some cases, tumour concentrations, following drug delivery [5,6]. These models have found extensive use in toxicology studies, delivery of anaesthetics [7], treating diabetes [8], and, more recently, in describing chemotherapeutic distribution [9]. PBPK models rely on fundamental principles such as mass balance equations and reaction kinetics and mathematically are materialised as systems of ordinary differential equations (ODEs) [10]. The main reason why they have gained their remarkable popularity is that they provide a mechanistic explanation to the drug pharmacokinetics [11]. The distribution of a drug following intravenous administration is carried out by two main mechanisms that take place in parallel: perfusion over the capillary bed and diffusion within the organs [12]. Diffusion-driven pharmacokinetics – which appear primarily as molecule size increases – is well described by the model of capillary membranes that separate the tissue from the blood circulation. For that reason, all compartments are represented as pairs of their tissue and plasma counterparts and pairs of mass balance equations are formulated. Therein, permeability coefficients appear which characterise the diffusion-driven mass flow.From a systems theory point of view, PBPK models are single-input multiple-output (SIMO) dynamical systems where the input is the influx rate of the administered drug and the state consists of the concentration of the drug at each compartment that participates in the model. The applicability of the PBPK modelling approach can be extended to account for drug–drug interactions thus resulting to multiple-input multiple-output (MIMO) systems. Therefore, it is straightforward to use PBPK models in a feedback control setting.Model predictive control (MPC) originated mainly from the process industry and has become famous for its stability and inherent robustness properties and for the fact that it can take systematically into account the constraints imposed on the state and input variables of the system [13,14]. Recently, it has made its presence felt in medicine as well: Gaweda et al.[15] employed MPC to design a feedback controller for administration of recombinant human erythropoietin to patients with end-stage renal disease. The authors of the present paper employed a black-box modelling approach using Finite-Impulse Response (FIR) models to cast the drug dosing control problem as an MPC problem [16]. A nonlinear MPC scheme was employed by Day et al.[17] for the control of inflammation in critically ill patients however without taking into account any safety constraints. MPC was also identified by Parker [18] as a control methodology with many implications for drug concentration regulation.The MPC has also been adopted to tackle the drug dosing problem. For example, Dua et al.[19] combined multiparametric programming and MPC to derive an explicit expression of the feedback control law for the regulation of blood glucose levels in patients with Type-I diabetes. MPC control strategies for glucose control have also been proposed by Magni et al.[20] and Hovorka et al.[21]. MPC has also been used as a feedback control method in anaesthesia by Ting et al.[22], Ionescu et al.[23], Cardoso and Lemos [24], Caruso and Morari [25], and Ingole et al.[26]. In most of the above studies, there is a prevailing requirement which is not always possible to be met: at each instant the drug concentrations in the organs or tissues of interest should be measured and their values should be provided to the controller [27]. This, being true for simple settings such as the control of arterial pressure [28], is hardly the case for drugs that aim at the liver or the brain as any installation of sensors is fiercely pervasive. For that reason, it is requisite to design a state observer; a dynamical system which asymptotically reconstructs the concentrations that cannot be measured and feeds them to the controller. The overall system comprising of the PPBK model, the controller and the observer should provide closed-loop stability and satisfaction of the safety constraints.In this paper, it is shown that PBPK models perfectly fit a recently proposed advanced offset-free MPC method which requires a state-space representation of the PBPK model and the design of a state observer. A hypothetical PBPK model with 7 compartments (and overall 14 sub-compartments) is constructed using data available in the literature and is utilised as a case study to illustrate the advantages of the MPC methodology. A unified framework for controlling the intravenous administration of drugs is proposed based on a realistic administration scenario. The suggested offset-free setting allows the treating physician to modify the set-point concentration of the drug in the target organ so as to readjust the course of the therapy and achieve the expected effect. We apply the proposed MPC controller to a set of 200 patients considering the intra-patient variability that is present in practice and we demonstrate that the proposed methodology is resilient to measurement noise and modelling errors. Preliminary results of this work appeared in Sopasakis et al.[29].Generally speaking a PBPK model comprises four fundamental groups of compartments: Non-metabolising, metabolising and excretory, the lungs and the blood compartment. Each compartment is further subdivided in two sub-compartments; one aiming at describing the perfusion through the corresponding organ or tissue and the other describing the diffusion. Hereinafter we use the notationCvi[μg L−1]for the venous concentration of the drug through the flow-limiting sub-compartment of compartment i.Vi[L]andVbli[L]denotes the volume of tissue and the volume of blood in organ i whileCi[μg/L]is reserved for the concentration in the corresponding diffusion-limited sub-compartment. ByQi[L h−1]we denote the volumetric flow rate of blood through i. Finally,Cart[μg/L]is the arterial concentration of the drug,Qc[L h−1]denotes the cardial flow rate andu[μg/L]the externally controlled feed rate. Let us now focus on each group separately:LetI0be the set of indices referring to non-metabolising compartments. The following mass-balance equations describe the accumulation of the drug inside the tissue as a result of the arterial flow inside it and the diffusion between the blood inside the tissue and the extravascular tissue:(1)VblidCvi(t)dt=Qi(Cart(t)−Cvi(t))−πiCvi(t)−Ci(t)Pi(2)VidCi(t)dt=πiCvi(t)−Ci(t)Pifori∈I0.Examples of non-metabolising compartments are typically the skin and the bladder. The permeability of the membrane that separates the tissue from the blood is quantified by the permeability coefficientsπi.Piis a unitless constant known as the tissue-blood partition coefficient.LetI1be the set of indices referring to metabolising compartments. In this case, the mass-balance equations are augmented by certain terms in order to describe the metabolism of the drug that takes place in the tissue and/or its excretion which is assisted by the blood circulation. The prime metabolic organ is in most cases the liver in which the hepatocytes undertake its metabolism and bileary excretion. Urine excretion takes place in the kidneys from where the urine is directed to the bladder for the final removal from the body. In some cases it is possible that reabsorption from the bladder takes place [30]. The mass balance equations for a metabolising and/or excretory compartment are written as follows:(3)VblidCvi(t)dt=Qi(Cart(t)−Cvi(t))−πiCvi(t)−Ci(t)Pi=rexi(Cvi(t))Vbli(4)VidCi(t)dt=πiCvi(t)−Ci(t)Pi−rmeti(Ci(t))Viwherermetiis the metabolic rate andrexithe excretory rate function. When the metabolic and excretory elimination is of first order, then these functions are linear and have the following form:(5)rmeti(Ci(t))=kmetiCi(t)(6)rexi(Cvi(t))=kexiCvi(t)Linear elimination models are used when they are able to describe up to adequate accuracy the metabolic and excretory dynamics. Otherwise, nonlinear elimination models such as the Michaelis–Menten equations are used [31].The blood pool acts as the central compartment which upon intravenous administration u primarily distributes the drug to the other organs and tissues. The blood is subdivided into two subcompartments: the plasma and the red blood cells (RBCs). The outflux from all organs (metabolising and non-metabolising) ends up in the blood pool and is forwarded to the lung compartment. The mass balance equations for the blood compartment are:(7)VpldCpl(t)dt=u(t)+∑i∈I0∪I1QiCvi(t)+πrbcCrbc(t)−πplCpl(t)−QplCpl(t)(8)VrbcdCrbc(t)dt=πplCpl(t)−πrbcCrbc(t)The volume of plasma is usually expressed as a fraction over the blood volume, that is:(9)Vpl=hVblwhere h is the hematocrit. The rest of the volume is assumed that is corresponds to the red blood cells, thus:(10)Vrbc=(1−h)VblThe lung plays a major role in drug distribution as it closes the loop between the cardiac and the arterial circulation. The mass-balance equations for the bulk and extravascular sub-compartments yield:(11)VblludCart(t)dt=Qlu(Cpl(t)−C(t)art)−πluCart(t)−Clu(t)Plu(12)VludClu(t)dt=πluCart(t)−Clu(t)PluThe complete set of ordinary differential equations (ODEs) that constitute the PBPK model can be compactly represented as a state-space model in continuous-time as follows:(13)dc(t)dt=f0(c(t),u(t))wherec(t)∈ℝnis the vector of all concentrations at the various compartments andu(t)∈ℝmis the input vector (normally, in drug administration m is equal to 1, but for modelling drug–drug interactions m could be greater than 1). The state vector is partly revealed to the outer world through the output variable which consists of the concentration values we are able to measure; in most cases these consist of the plasma concentration exclusively. This state-to-output relationship is given by:(14)y(t)=g0(c(t))wherey(t)∈ℝpis the output vector of the system, that is the vector of measurements. Eqs. (13) and (14) can be discretised using some sampling periodTs>0to yield the following system of nonlinear difference equations:(15)ck+1=f(ck,uk)(16)yk=g0(Ck)Any discretisation method can be used. For instance if the model is linear the method of exact discretisation [32] can be employed, while for nonlinear models numerical methods such as the Runge–Kutta discretisation methods can be used [33]. If Eqs. (15) and (16) are nonlinear, they are linearised about an equilibrium point and yield the following linear time-invariant discrete-time dynamical system:(17)ck+1=Ack+Buk(18)yk=Cckhereinafter, we require that the pair (A, B) is stabilisable and (C, A) is observable.In this section we elaborate on the design of an observer, that is, a dynamical system which accepts as inputs the input u (typically the drug administration rate) and the measured concentrations y (usually, just the plasma concentration) of the administered compound and outputs an estimate of the concentration of the medicine in all other compartments. This estimate, although it may initially be inaccurate, it eventually converges asymptotically to the actual state of the system. The observer we employ here is an augmented state observer as it estimates both the state of the system as well as an additional disturbance signal which stands for the modelling uncertainty as we will rigorously explain in what follows.The linearisation as presented in (17) and (18) suggests the existence of residual functions R1(c, u) andR2(c)such that(19)ck+1=Ack+Buk+R1(ck,uk)(20)yk=Cck+R2(ck)with R1 and R2 having the property that||R1(c,u)||→0as||c||→0and||u||→0and||R2(c)||→0as||c||→0. These residuals can be cast as external disturbances to the system accompanied by a dynamical model to describe their evolution over time. This leads to the following augmented system [34]:(21)ck+1=Ack+Buk+Bddkdk+1=dkyk=Cck+Cddkwhose state is the augmented vectorξk=(ck,dk)T∈ℝn+m(Fig. 1). This disturbance term is essential for offset-free MPC (even when the system's model is linear) as it describes any additive uncertain disturbances that may act on the system. The disturbance model used in (21), which has been used among others by Maeder et al.[35] and by Rawlings and Mayne [14], is suitable for describing constant or slowly varying external disturbances. Additionally, the introduction of the additional disturbance termdk∈ℝmcompensates for the discrepancy between the nominal system and the actual (nonlinear and even uncertain) dynamics, thus, it attenuates the effect of modelling errors. Overall, the disturbance term captures the effect of constant and slowly varying disturbances as well as modelling errors.The aforementioned system can be concisely written as follows:(22)ξk+1=A¯ξk+B¯ukyk=C¯ξkwhere(23)A¯ABd0I,B¯=B0,C¯=[CCd]where I denotes the identity matrix. A state observer is designed for the augmented system in order to provide the controller with estimates of the system state and disturbance, that is the augmented state of the system [36]. These estimates are denoted bycˆanddˆrespectively. The observer is itself a dynamical system with input the input and output signals of the PBPK system – that is the administration rate and the plasma concentration – and outputs the aforementioned estimates. The linear Luenberger type observer which takes the form:(24)ξˆk+1=A¯ξˆk+B¯uk+Lekwhereξˆk=(cˆk,dˆk)Tis an estimator ofξkandekis the estimation error given by:(25)ek=C¯ξˆk−ykA Kalman filter [37] or any other tuning method (such as pole placement) can be used for the selection of L as long as (C, A) is observable and the matrix:(26)A−IBdCCdis full column rank [34]. The steady state of the observer above according to Maeder et al.[35] is given by the formula:(27)A−IBdCCdcˆ∞uˆ∞=−Bddˆ∞y∞−Cddˆ∞The resulting observer should be asymptotically stable, i.e., for a constant input u, the choice of L should be such that the observer's error defined asεk=ξˆk−ξksatisfies the condition||εk||→0ask→∞. For that it is necessary that the matrixA¯+L⁡C¯is strictly Schur, i.e., it has all its eigenvalues inside the unit circle.MPC can be conceived as a chess match strategy: using a discrete-time model of the system, at each time instant a performance index is optimised subject to the system constraints yielding a sequence of drug infusion ratesuk*;k∈ℕ[0,N]over a prediction horizon N; then, the first infusion rate is applied to the system for a time period equal to one sampling period Ts. At the end of the sampling period, the drug concentrations in the organs of interest are measured or estimated using the observer and the horizon moves forward to repeat the same procedure [14]. This optimisation-based control strategy, also known as receding horizon control, allows the controller to predict the future evolution of the system states (drug concentrations in different organs) and adapt its control actions (infusion rates) accordingly while it achieves the control objective using the least possible amount of control effort.MPC takes inherently into account the safety and operating constraints that are imposed on the input and state variables of the system. In particular, MTC-related constraints and influx rate restriction can be written as a set of s linear inequalities at each time instant:(28)Gck+Huk≤Mu,k∈ℕ[0,N]whereG∈ℝs×n,H∈ℝs×mandM∈ℝsand≤stands for the element-wise comparison of vectors inℝs.These constraints can be also modified in real time allowing the treating doctor to further supress the concentration of the drug at certain tissues or organs. The ability of MPC to take into account such constraints on the administration rate and the concentration of the drug gives it a clear advantage compared to other control methods that have been proposed for drug administration such as PID controllers. Since the observer provides real time estimations of non-measured states, drug concentration constraints can be imposed in organs and tissues, where no sensors are present.Maeder et al.[35] proposed a specific offset-free MPC formulation which is solved at every time instantj∈ℕand is written as the following minimisation problem, which computes the sequence of optimal drug administration rates as a function of current estimations of drug concentrations at different organs and tissues and the disturbances:(29)VN*(ξˆj)=VN*(cˆj,dˆj)=minπ={ui}i=0N−1VN(π,cˆj,dˆj)subject to the constraints:(30)ck+1=Ack+Buk+Bddk,k∈ℕ[0,N−1]dk+1=dk,k∈ℕ[0,N−1]Gck+Huk≤M,k∈ℕ[0,N]c0=cˆjd0=dˆjwhere(31)VN(π,cˆj,dˆj)=||cN−c¯j||P2+∑k=0N−1(||ck−c¯j||Q2+||uk−u¯j||R2)The notation||⋅||F2is meant as||c||F2=c′Fcwithc∈ℝn.In (31)Q is a positive semidefinite matrix, R is a positive definite matrix. The matrices Q and R are design parameters and are chosen by the designer so as to penalise the deviations of the concentration of the drug from the desired set-point and the administration rate that is used to achieve this goal. A standard and convenient choice for Q and R is to be taken as diagonal matrices with nonnegative entries which are used as penalties for the respective components of the state and input vectors. The matrixP∈ℝn×nis the unique solution of the following Riccatti algebraic equation whose solution can be determined numerically:(32)P=A′PA−A′PB(B′PB+R)−1B′PA+QIncluding this terminal cost in the cost function is crucial for the closed-loop system to be asymptotically stable. Omission of these conditions from the MPC formulation can lead to instability and unpredictable behaviour by the controlled system, but some authors use MPC without including these conditions into the problem formulation [38].In (31),c¯jandu¯jare calculated on runtime as the solution of the following linear system:(33)A−IBC0c¯ju¯j=−Bddˆjrj−CddˆjThis equation is used at every time instant j to determinec¯jandu¯jgiven the desired set-pointrj. The feedback control law that is calculated by the aforementioned optimisation problem is given by:(34)u(ξˆj)=π0*(ξˆj)i.e., only the first value of the sequence is applied to the system and the horizon moves forwards to repeat the same procedure. Finally, the controller's action is applied to the patient through a zero-order hold element, i.e.,u(t)=u(ξˆj)for allt∈[jTs,(j+1)Ts).

@&#CONCLUSIONS@&#
Linear offset-free MPC was used to tackle the optimal drug dose administration problem. The proposed approach is a suitable framework for controlling the concentration of drugs in any targetorgan using measurements that can be obtained easily such as blood concentrations. For that purpose, the controller was coupled with a linearstate observer so that the drug concentration can be controlled at any organ using only blood samples. All constraints are satisfied so the appearance of adverse effects is minimised and drug doses are kept within the recommended bounds. We demonstrated that the MPC controller performs well in presence of modelling errors and measurement noise, which renders it suitable for real medical applications.The overall setting allows the treating physician to modify the desired concentration at the target organ any time during the therapy and achieve the desired therapeutic effect while monitoring in real time the progress of the distribution of the drug in the patient's organism.We declare that there are no financial or personal relationships with other people or organisations that could inappropriately influence (bias) our work.