@&#MAIN-TITLE@&#
Nonlinear dynamical model of Costas loop and an approach to the analysis of its stability in the large

@&#HIGHLIGHTS@&#
Analytical computation of PD characteristic of Costas loop is done.The classical ideas of Gardner and Viterbi are developed and rigorously justified.Nonlinear analysis of Costas loop in the signal׳s phase space is demonstrated.

@&#KEYPHRASES@&#
Costas loop,BPSK,Phase-locked loop (PLL),Nonlinear analysis,Phase detector characteristic,Phase comparator,Simulation,Stability in the large,

@&#ABSTRACT@&#
The analysis of the stability and numerical simulation of Costas loop circuits for high-frequency signals is a challenging task. The problem lies in the fact that it is necessary to simultaneously observe very fast time scale of the input signals and slow time scale of phase difference between the input signals. To overcome this difficult situation it is possible, following the approach presented in the classical works of Gardner and Viterbi, to construct a mathematical model of Costas loop, in which only slow time change of signal׳s phases and frequencies is considered. Such a construction, in turn, requires the computation of phase detector characteristic, depending on the waveforms of the considered signals. While for the stability analysis of the loop near the locked state (local stability) it is usually sufficient to consider the linear approximation of phase detector characteristic near zero phase error, the global analysis (stability in the large) cannot be accomplished using simple linear models.The present paper is devoted to the rigorous construction of nonlinear dynamical model of classical Costas loop, which allows one to apply numerical simulation and analytical methods (various modifications of absolute stability criteria for systems with cylindrical phase space) for the effective analysis of stability in the large. Here a general approach to the analytical computation of phase detector characteristic of classical Costas loop for periodic non-sinusoidal signal waveforms is suggested. The classical ideas of the loop analysis in the signal׳s phase space are developed and rigorously justified. Effective analytical and numerical approaches for the nonlinear analysis of the mathematical model of classical Costas loop in the signal׳s phase space are discussed.

@&#INTRODUCTION@&#
The Costas loop [1,2] is a classical phase-locked loop (PLL) based circuit for carrier recovery. Nowadays among the applications of Costas loop there are Global Positioning Systems (see, e.g., [3–7]), wireless communication (see, e.g., [8–14] and others [15–23].A PLL-based circuit behaves as a nonlinear control system and its physical model in the signal space can be described by nonlinear nonautonomous difference or differential equations. In practice, numerical simulation is widely used for the analysis of nonlinear PLL-based models (see, e.g., [24–28]). However the explicit numerical simulation of the physical model of Costas loop or its mathematical model in the signal space (e.g., full SPICE-level simulation) is rather complicated for the high-frequency signals. The problem lies in the fact that it is necessary to consider simultaneously both very fast time scale of the signals and slow time scale of phase difference between the signals, so one very small simulation time-step needs to be taken over a very long total simulation period [29–31].To overcome this difficult situation it is possible, following the approach presented, e.g., in the classical works of Gardner and Viterbi, to construct a mathematical model in the signal׳s phase space, in which only slow time change of signal׳s phases and frequencies is considered. Such a construction, in turn, requires the computation of phase detector characteristic, which depends on PD physical realization and the waveforms of the considered signals [32–35]. Note that “understanding how phase detectors work is one of the major keys to understanding how PLLs work” [36].Nowadays the following scheme1.consideration of the physical model in the signal space;computation of phase detector characteristic and the construction of the mathematical model in the signal׳s phase space (phase-domain macromodel [29]);nonlinear analysis of the transient processes of the signal׳s phases adjustment and the estimation of the dependence of various important acquisition characteristics on circuit׳s parameters in the mathematical model in the signal׳s phase space by numerical and analytical methods,In the present paper a general effective approach to analytical computation of phase detector characteristic is presented; the classical ideas of analysis and design of PLL-based circuits in the signal׳s phase space are developed and rigorously justified; for various non-sinusoidal waveforms of high-frequency signals (see, e.g., various applications of PLL-based circuits with non-sinusoidal signals in [62–68]) its phase-detector characteristics are obtained for the first time and its dynamical model is constructed.Various modifications of analog and digital Costas loops and PLL with squarer are widely used for BPSK (Binary Phase Shift Keying) and QPSK (Quadrature Phase Shift Keying) demodulation in telecommunication. Because the realization of squaring circuits can be quite difficult, the Costas loop is the preferred variant [26]. In digital circuits, the maximum data rate is limited by a speed of ADC (Analog-to-Digital Converter). In the following classical analog Costas loop, used for BPSK demodulation (similar analysis can also be done for QPSK Costas loop), is considered.Consider the Costas loop operation (see Fig. 1) with the sinusoidal carrier and VCO (Voltage-Controlled Oscillator) signals with the same frequencies after transient processes. The input signal is BPSK signal, which is a product of the transferred datam(t)=±1and the harmonic carriersin(ωt)with the high frequency ω. Since here the Costas loop in lock is considered, VCO signal is synchronized with the carrier (i.e. there is no phase difference between VCO signal and input carrier). On the lower branch (Q branch) after the multiplication of VCO signal, shifted by 90°, and the input signal by the multiplier block (⊗) one has(1)Q=12(m(t)sin(0)−m(t)sin(2ωt))=−12m(t)sin(2ωt).From an engineering point of view, the high-frequency partsin(2ωt)in (1) is removed by a low-pass filter on Q branch. Thus, after filtration a signal on Q branch is zero (a constant in the general case when the initial frequencies are different).On the upper branch (I) the input signal is multiplied by the output signal of VCO:(2)I=12(m(t)cos(0)−m(t)cos(2ωt))=12(m(t)−m(t)cos(2ωt)).The high-frequency termcos(2ωt)is filtered by a low-pass filter. Thus, on the upper branch I after filtration one can obtain the demodulated data m(t).Then both branches are multiplied together and after an additional filtration one gets the signal g(t) to adjust VCO frequency to the frequency of input carrier signal. After a transient process there is no phase difference and the control input of VCO is zero. In the general case when the initial frequencies are different the control input of VCO is constant:(3)g(t)≈const.Consider the case (see Fig. 2) when the phase of the input carrierθ1(t)and the phase of VCOθ2(t)are different. The latter means that either (1) the frequencies are different or (2) the frequencies are the same but there is a constant phase difference. For engineers it is a well-known fact [69] that in the considered case of sinusoidal signals the input of loop filter can be approximated asφ(t)≈18sin(2θ2(t)−2θ1(t)).This approximation depends on the phase difference of signals and is called a phase detector characteristic of Costas loop for sinusoidal signals. When the phase difference of signals is small, using the linearizationφ(t)≈K(θ2(t)−θ1(t)), one can consider a linearized mathematical model of Costas loop for sinusoidal signals (see details in Section 4). This allows one to estimate approximately acquisition parameters by the same methods that were developed for the analysis and design of classical PLLs (see, e.g., [69–72] and others).In the next section a rigorous mathematical approach to the analytical computation of phase detector characteristic and the nonlinear analysis of classical Costas loop for non-sinusoidal waveforms is considered.The low-pass filters on the upper and the lower branches of Costas loop (Fig. 2) are responsible for demodulation process (see Fig. 1) and therefore they can be applied separately from the loop (see, e.g., [4]). From a point of view of the analysis of stability, the filter at the input of VCO executes their filtering functions.Thus one can consider a simplified physical open-loop model of Costas loop (Fig. 3) with only one filter at the input of VCO. In this case the transmitted data m(t) can be omitted (i.e.m(t)≡1) because after the multiplication of the upper and the lower branches at the input of filter the data are squared: (m(t)2=(±1)2=1). Here the signalf1(t)=f1(θ1(t))represents the carrier andθ1(t)represents its phase. In analogy,f2(t)=f2(θ2(t))represents the output signal of VCO, andθ2(t)represents its phase. The functionsf1,2(θ)are called waveforms.Consider the analysis of Costas loop for general periodic signal waveforms. Suppose that the waveformsf1,2(θ)are bounded2π-periodic piecewise differentiable functions11The functions with a finite number of jump discontinuity points differentiable on their continuity intervals.(this is true for the most considered waveforms, e.g., sinusoidal, squarewave, sawtooth, triangular, and polyharmonic). Consider the following Fourier series representation:fp(θ)=∑i=1∞(aipcos(iθ)+bipsin(iθ)),θ≥0aip=1π∫−ππfp(θ)cos(iθ)dθ,bip=1π∫−ππfp(θ)sin(iθ)dθ,p=1,2.The relation between the inputφ(t)and the outputg(t)of linear filter is as follows [73]:(4)g(t)=α0(t)+∫0tγ(t−τ)φ(τ)dτ,whereγ(t)is an impulse response function of filter andα0(t)is an exponentially damped function depending on the initial state of filter at t=0.By (4) the filter output g(t) has the form(5)g(t)=α0(t)+∫0tγ(t−τ)f1(θ1(τ))f2(θ2(τ))f1(θ1(τ))f2(θ2(τ)−π2)dτ.For solving the above problem, posed by D. Abramovitch, and applying the averaging methods it is necessary to consider mathematical properties of high-frequency signals. Here an approach is applied and used which is developed for the study of the classical PLL [32,35,48,74].A high-frequency property of signals can be reformulated in the following way. Suppose that for the frequencies22A phase of analog signal can be defined as an integral of instantaneous frequency of signal.(6)ω1,2(t)=θ̇1,2(t),there exist a sufficiently large number ωminsuch that on a fixed time interval[0,T], where T is independent of ωmin, the conditions(7)ω1,2(t)≥ωmin>0are satisfied. The frequency difference is assumed to be uniformly bounded:(8)|ω1(t)−ω2(t)|≤ωΔmax,∀t∈[0,T].Requirements (7) and (8) are obviously satisfied for the tuning of two high-frequency oscillators with close frequencies. Let us introduceδ=ωmin−1/2. Consider the relations(9)|ωp(t)−ωp(τ)|≤Ω,p=1,2,|t−τ|≤δ,∀t,τ∈[0,T],whereΩis independent of δ. Conditions (7)–(9) mean that the functionsωp(τ)are almost constant and the functionsfp(θp(t))are rapidly oscillating time functions on the small intervals[t,t+δ].To study the filtration of high-frequency signals by filter (4) it is assumed that the impulse response function of filter is a differentiable function with a bounded derivative (this is true for the most considered filters [73]). The boundedness of derivative ofγ(t)implies that(10)|γ(τ)−γ(t)|=O(δ),|t−τ|≤δ,∀τ,t∈[0,T].Consider a block diagram in Fig. 4. Here PD is a nonlinear block (describing the operation of all intermediate elements in Fig. 3 between inputs and filter) and its output is 2π-periodic functionφ(θ2(t)−θ1(t))(the phase detector characteristic of Costas loop); G(t) is the output of filter.Suppose that the characteristics and the initial state of filters in Fig. 3 and in Fig. 4 coincide. By (4) the output has the form(11)G(t)=α0(t)+∫0tγ(t−τ)φ(θ2(τ)−θ1(τ))dτ.Theorem 1Consider 2π-periodic functionφ(θ)of the form(12)φ(θ)=A01A024+12∑l=1∞((Al1Al2+Bl1Bl2)cos(lθ)+(Al1Bl2−Bl1Al2)sin(lθ)),where the coefficients Apland Bplare expressed via the coefficients of the waveformsf1,2(θ)in the following way:(13)Al1=a01al12+12∑m=1∞[am1(am+l1+am−l1)+bm1(bm+l1+bm−l1)],Bl1=a01bl12+12∑m=1∞[am1(bm+l1−bm−l1)−bm1(am+l1−am−l1)],Al2=a02αl22+12∑m=1∞[αm2(αm+l2+αm−l2)+βm2(βm+l2+βm−l2)],Bl2=a02βl22+12∑m=1∞[αm2(βm+l2−βm−l2)−βm2(αm+l2−αm−l2)],and(14)αk2={ak2,k=4p,bk2,k=4p+1,−ak2,k=4p+2,−bk2,k=4p+3,βk2={bk2,k=4p,−ak2,k=4p+1,−bk2,k=4p+2,ak2,k=4p+3.If high-frequency conditions(7)–(9)and condition on filter(10)are satisfied, then the relation(15)|g(t)−G(t)|=O(δ),∀t∈[0,T]is valid.In other words, this theorem separates the low-frequency error-correcting signal from parasitic high-frequency oscillations and proves that the considered functionφ(θ)is a phase detector characteristic of Costas loop. Thus the filter input can be approximated by the functionφ(θ)in the sense that a change in the filter output signal is sufficiently small (see (15)).For sinusoidal waveforms this fact was known to engineers [2] without rigorous justification.Remark 1Sincef1,2(θ)are piecewise-differentiable, then(16)Ak1,2=O(1k),Bk1,2=O(1k),andφ(θ)is a smooth function.For the most considered waveforms, infinite series (12) can be truncated up to the firstωminterms. By (13) and (16), the remainderR[1/δ]of series (12) can be estimated as|R[1/δ](x)|≤O(∑l=[1/δ]+1∞1l2)≤O(δ).The theorem allows one to compute a phase detector characteristic33It can be proved that the phase detector characteristic for Costas loop in Fig. 2 coincides with (12) under some essential conditions on frequency characteristics of filters on the upper and lower branches.,44Since there is an integration in VCO model (18), for the case of proportional-integrating filter one can easily prove an analog of the theorem with the estimation|∫0tG(t)−∫0tg(t)|=O(δ).for the following typical signals given below in the table.From a mathematical point of view, linear filter (4) can also be described by a system of linear differential equations(17)ẋ=Ax+bφ(t),σ=c⁎x,a solution of which has the form (4). HereAis a constant matrix,x(t)is the state vector of Filter,bandcare constant vectors. The model of VCO is usually assumed to be linear:(18)θ̇2(t)=ωfree+LG(t),t∈[0,T],where ωfreeis the free-running frequency of VCO and L is the gain of VCO. Similarly, one can consider various nonlinear models of VCO (see, e.g., [37]). Therefore the initial VCO frequency is as follows:θ̇2(0)=ωfree+Lc⁎x(0).By equations of filter (17) and VCO (18) one has(19)ẋ=Ax+bf1(θ1(t))f2(θ2(t))f1(θ1(t))f2(θ2(t)−π2),θ̇2=ωfree+Lc⁎x.Nonautonomous system (19) describes physical model of Costas loop in the signal space (see Fig. 5) and is rather difficult for the study.Suppose that the frequency of reference signal is a constant(20)θ̇1(t)≡ω1.Then Theorem 1 allows one to consider more simple autonomous system of differential equations (in place of nonautonomous (19)), which describes the mathematical model of Costas loop in the signal׳s phase space:(21)ẋ=Ax+bφ(θΔ),θΔ=ωfree−ω1+Lc⁎x,θΔ=θ2−θ1.Here the initial difference of frequencies (at t=0) has the formθ̇Δ(0)=ωfree−ω1+Lc⁎x(0).55Note that to consider one-dimensional stability domains, e.g., defined byωΔ=ω1−ωfree, one has to assume thatc⁎x(0)=0. In the general case one has to consider multi-dimensional stability domains taking into account the initial state of loop filter — vectorx(0).The well-known averaging method permits66Note that the derivation of dynamical model (21) and the rigorous justification of its adequacy for the analysis of stability are possible here only under condition (20), while formula (12) is obtained for PD characteristic in the general case without condition (20).to show that the solutions of (19) and (21) are close on time interval[0,T], whereT⪯¡ωmin, under some assumptions [75,76]. Thus the block diagram of Costas loop in the signal space (Fig. 5) can be asymptotically changed (for high-frequency generators, see conditions (7)–(10)) to the block diagram in the signal׳s phase space (Fig. 6). Here PD has the corresponding characteristics (12).Linearized model (21), whereφ(θΔ)is changed toKθΔ, may be used for analysis in the case when the considered circuit “is in lock, but analysis of the acquisition behavior cannot be accomplished using the simple linear models and nonlinear analysis techniques are necessary” [28]. Note that the linearization and the analysis of linearized models of control systems may result in incorrect conclusions,77See also counterexamples to the filter hypothesis, Aizerman׳s and Kalman׳s conjectures on the absolute stability of nonlinear control systems [77], and the Perron effects of the largest Lyapunov exponent sign inversions [78], etc.so one can read in [37] “the use of linear macromodels can lead to qualitatively incorrect prediction of important PLL phenomena”. At the same time the attempts to justify analytically the reliability of conclusions, based on simplified engineering approaches, and rigorous study of nonlinear models are quite rare and one of the reasons is that “nonlinear analysis techniques are well beyond the scope of most undergraduate courses in communication theory” [28].While the physical model of Costas loop in the signal space (19) is nonautonomous and its rigorous global analysis (transient processes, stability in the large, cycle slipping, etc.) is rather difficult and creative task, for the global analysis of nonlinear autonomous model (21) of Costas loop, the well-known methods of analysis of pendulum-like systems can be applied (see, e.g., [79,54,80,56,81,60]). Modification of direct Lyapunov method with the construction of periodic Lyapunov-like functions, the method of positively invariant cone grids, and the method of nonlocal reduction turned out to be most effective [82,83,80,81]. The last method, which combines the elements of direct Lyapunov method and bifurcation theory, allows one to extend the classical results of Tricomi [84] and his progenies to the multidimensional dynamical systems [83,85].Since in the block diagram in Fig. 6 and system (21) only slow time change of signal׳s phases and frequencies is considered, they can be effectively studied numerically.For the simulation of system (21) with the functionφ(·)of the form (12), in place of conditions (8) and (10) the conditions|ωΔmax|⪯¡ωmin,|λA|⪯¡ωminshould be considered, whereλAis the largest (in modulus) eigenvalue of matrix A. Also, it is necessary to considerT⪯¡ωminto justify the transition from Eqs. (35)–(39) (see Appendix) and to use Remark 1.The considered theoretical results are justified by the simulation88One can compare the numerical integration of systems (19) and (21) with the simulation of realization of block diagrams in Figs. 5 and 6, f.e., in Matlab Simulink (see, e.g., [28,86] and the patent application [87]).,99While we consider a very simple filter, sawtooth and triangle waveforms in simulation, one can consider similar effects for lag-lead or PI filters and other waveforms.of those considered in the previous section of Costas loop models in the signal and signal׳s phase spaces. In Fig. 7are shown the transient processes of VCO input in block diagrams in Figs. 5 and 6 (here it is important if and when VCO input becomes a constant, see (3)).Here the simulation in the signal׳s phase space is more than 100 times faster. Unlike the filter output in the signal׳s phase space, in the signal space the filter output contains additional high-frequency oscillation. These high-frequency oscillations interfere with qualitative analysis and efficient simulation of Costas loop. The passage to the analysis of autonomous dynamical model of Costas loop (in place of the nonautonomous one) allows one to overcome the difficulties that relate to the analysis of Costas loop in the signal space.The approach described can be adapted to digital Costas loops [4,88], where the filter and the VCO are digital unlike those in Fig. 5. If a discretization step is sufficiently small, then a digital filter acts similar to an analog filter. In this case it can be shown that the considered mathematical model in the signal׳s phase space is adequate (see Fig. 8).In conclusion it should be remarked that in the signal׳s phase space a similar numerical simulation of the whole transient process (around 10s – see Fig. 7) of Costas loop with frequencies around 1GHz=109Hz takes less than 1s. At the same time to perform the accurate simulation of Costas loop in the signal space for such frequencies one has to use a discretization step much less than 10−9, what results in a very long simulation time to oversee the whole transient process: during 10s of simulation in the signal space only 3.5×10−8s of 10s of transient process was obtained (see Fig. 9).These difficulties are described in [37]: “Direct time-domain simulation of PLLs at the level of SPICE circuits is typically impractical because of its great inefficiency. PLL transients can last hundreds of thousands of cycles, with each cycle requiring hundreds of small time steps for accurate simulation of the embedded voltage-controlled oscillator (VCO). Furthermore, extracting phase or frequency information, one of the chief metrics of PLL performance, from time-domain voltage/current waveforms is often difficult and inaccurate.”

@&#CONCLUSIONS@&#
