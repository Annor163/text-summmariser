@&#MAIN-TITLE@&#
OvaSpec – A vision-based instrument for assessing concentration and developmental stage of Trichuris suis parasite egg suspensions

@&#HIGHLIGHTS@&#
A scalable, objective method for in-process drug testing was developed.OvaSpec automatically assess concentration and embryonation percentage of TSO.Algorithms were tested on a large, annotated dataset of 42,894 eggs in 2970 images.Darkfield scattering and larval morphology enables classification accuracies of 99%.Computer vision agrees with manual microscopy but has superior precision.

@&#KEYPHRASES@&#
Parasite egg classification,Computer vision,Image analysis,Darkfield microscopy,Embryonation percentage,Concentration,Trichuris suis eggs,

@&#ABSTRACT@&#
BackgroundOvaSpec is a new, fully automated, vision-based instrument for assessing the quantity (concentration) and quality (embryonation percentage) of Trichuris suis parasite eggs in liquid suspension. The eggs constitute the active pharmaceutical ingredient in a medicinal drug for the treatment of immune-mediated diseases such as Crohn׳s disease, ulcerative colitis, and multiple sclerosis.MethodsThis paper describes the development of an automated microscopy technology, including methodological challenges and design decisions of relevance for the future development of comparable vision-based instruments. Morphological properties are used to distinguish eggs from impurities and two features of the egg contents under brightfield and darkfield illumination are used in a statistical classification to distinguish eggs with undifferentiated contents (non-embryonated eggs) from eggs with fully developed larvae inside (embryonated eggs).ResultsFor assessment of the instrument׳s performance, six egg suspensions of varying quality were used to generate a dataset of unseen images. Subsequently, annotation of the detected eggs and impurities revealed a high agreement with the manual, image-based assessments for both concentration and embryonation percentage (both error rates <1.0%). Similarly, a strong correlation was demonstrated in a final, blinded comparison with traditional microscopic assessments performed by an experienced laboratory technician.ConclusionsThe present study demonstrates the applicability of computer vision in the production, analysis, and quality control of T. suis eggs used as an active pharmaceutical ingredient for the treatment of autoimmune diseases.

@&#INTRODUCTION@&#
Trichuris suis ova (TSO), eggs of the pig whipworm, constitute the active pharmaceutical ingredient in a new medicinal product intended for the treatment of immune-mediated diseases such as Crohn׳s disease [1], ulcerative colitis [2], and multiple sclerosis [3]. The treatment, known as helminthic therapy, has been inspired by the hygiene hypothesis, which suggests a connection between the improved hygiene and the resulting lack of childhood exposure to pathogens and intestinal parasites and the rising incidence of immune-mediated diseases in industrialized countries [4,5]. Based on positive results from animal studies [4,6,7] and early human studies [1–3], the treatment is currently being evaluated in several clinical trials [8].Only the fully developed (embryonated) eggs that contain distinct larvae have the potential to hatch and invade the intestinal mucosa, which is believed to be the key factor inducing immunomodulation in the patients [9]. Eggs without visible larvae (seeFig. 1) do not have this effect, and therefore determination of the concentration of embryonated eggs in an egg suspension is essential for the dosing of the pharmaceutical ingredient.The concentration of embryonated eggs is often estimated as the product of two critical quality parameters of an egg suspension; the concentration (eggs/ml) and the embryonation percentage (embryonated eggs/total eggs). Traditionally, concentration and embryonation percentage (emb. pct.) of eggs in an egg suspension are assessed by manual microscopy of subsamples. The present OvaSpec instrument (seeFig. 2) was developed specifically for the analysis of T. suis eggs as an automated alternative to the manual process to improve objectivity (reduce subjectivity of operator), reproducibility, scalability (analyze thousands of eggs/day), and allow for validation of the process. In conjunction with ongoing clinical trials [8,10], the active pharmaceutical ingredient is subject to extensive regulatory requirements including the establishment of analytical methods for in-process control as well as potency-indicating assays. Thus, an important milestone was to develop a fully automated system for analyzing suspensions of T. suis eggs.Embryonated eggs are produced under controlled conditions by incubating egg suspensions at 25°C for 100 days. Depending on the quality of the egg suspension the embryonation percentage may be up to 95%. The standard concentrations used in the production are 20,000 and 40,000eggs/ml. Thus, the instrument should be able to assess egg concentrations from 15,000 to 50,000eggs/ml and embryonation percentages from 0% to 100%. In the blinded experiment described later, incubated and non-incubated eggs are mixed to obtain suspensions with a range of embryonation percentages for the study participants to assess.Coulter counters [11], known from cell counting, have been proposed for the task of automated egg counting, but their impedance change detection does not allow for distinction of eggs and impurities. Their size gating can exclude some of the small and large impurities, but it cannot sort out the egg-sized particles, which constitute the majority of impurities after a comprehensive sieving during egg isolation.Until recently, image analysis of eggs of helminths – parasitic worms – like T. suis was predominantly investigated for medical or veterinary diagnostic purposes, where eggs were detected and grouped according to genus, and in a few instances to species. Both the egg detection and the species recognition are based primarily on size and shape of the eggs [12–15], although the addition of texture features was shown to improve the classification of strongyle eggs [16]. Several of the systems target only the classification step and work directly with images of individual parasite eggs [13–16] or work only with a small number of images [12,14,15]. A notable exception is the recent work by Suzuki et al. [17] where elaborate machine learning algorithms were used to detect and distinguish 15 species of helminth eggs and protozoa in 793 images based on more than 20 geometric and textural features. In a follow-up paper [18] this analysis was optimized for speed and combined with an automated image acquisition system allowing for analysis of 7859 images containing 1791 parasites and 6068 impurities.The application of image analysis for analyzing the developmental stages of helminth eggs, specifically T. suis eggs, was introduced recently by Bruun et al. [19,20], who initially proposed the application of darkfield illumination. With the exception of Suzuki et al. [18], all previous papers [12–17,19] rely on manual image acquisition and focusing under a microscope in contrast to the fully automated system presented in this paper, which enables the acquisition of larger data sets leading to better characterization of the biological variation of the eggs and more robust analyses.The present paper describes the instrument development (Section 2.1) and applied image analysis (Section 2.2), and evaluates the assessment of concentration and embryonation percentage against image annotations at the individual egg level (Sections 3.1 and 3.2) and microscopic assessment at the egg suspension level (Section 3.3).The OvaSpec instrument was developed in collaboration with the Danish computer vision company Videometer A/S and uses several hardware and software components from the VideometerLab [21,22], a multispectral vision instrument for assessment food quality and related applications, e.g. of vegetables [23,24], meat [25,26], rice [27], and fish feed [28]. Like in the VideometerLab, the principle of multispectral imaging is used in OvaSpec, where a monochrome image sensor captures the transmission and scattering of LED light at various wavelengths. The main components of the instrument are the camera, the optics, the illumination, and the mechanics. The quality of the produced images is influenced by all of these as well as the choice of sample container, acquisition pattern, and autofocus strategy. The chosen components are presented inFig. 3.An early proof-of-concept analysis indicated that an egg length of at least 80 pixels, but preferably 120–180 pixels, was required to achieve an image quality appropriate for assessing the developmental stage of individual eggs. Since the eggs are approximately 60μm long, this corresponds to a resolution of 2–3pixels/μm. The chosen camera and optics resulted in a resolution of 2.87pixels/μm. Since the eggs sediment at the bottom of the sample container, the instrument is constructed as an inverted microscope. In order not to stir up the sample during acquisition, which could lead to some eggs being imaged multiple times, it was decided to have the motors move the camera and optics instead of the sample container unlike typical automated microscopy that uses a motorized stage.The standard method of counting T. suis eggs is to examine a known small volume of an egg suspension on a microscope slide, but this method is not suitable for automated imaging since the optimal focus level varies across the droplet and furthermore changes over time as the droplet evaporates. Instead, a single flat-bottomed well from an 8-well ELISA strip (Greiner Bio-One, Frickenhausen, Germany) is used, seeFig. 4.To prepare the sample, two-thirds of the well is filled with degassed, purified water, and the egg suspension sample is pipetted out into the water near the bottom of the well, where the eggs will settle quickly. The rest of the well is then filled with water until surface tension is reached and a cover glass is placed on top of the well to make the surface of the water flat, thereby reducing spatial focus differences. The pipetting of the sample is done using an electronic pipette in reverse pipetting mode where it aspirates 5μl more than the targeted amount and only dispenses the targeted amount, thereby avoiding having to use air blow-out to empty the pipette tip. Combined with the sample preparation above, this pipetting technique greatly reduces the risk of air bubbles forming at the bottom.To image the entire bottom of the sample container at the chosen resolution, a set of 99 multispectral images is acquired in an 11×9 grid pattern, seeFig. 5. An overlap zone of 120μm, corresponding to two egg lengths, was chosen in order to make sure that all eggs were imaged. The object extraction process, described in Section 2.2, keeps track of the positions of all detected foreground objects so that no object is counted twice.Getting the eggs in focus is crucial for the quality of the acquired images. Despite the above-mentioned measures for reducing focus variability across the sample, the small egg width of approx. 25μm makes it necessary to use autofocusing to make sure that all eggs are in acceptable focus.The autofocus strategy consists of two parts; an initial autofocusing and a local autofocusing. The initial autofocusing establishes the overall focus plane reference value. This is done by acquiring a tall z-stack (stack of images at different focus levels) at the center of the well (marked blue in Fig. 5) and selecting the focus level from the image best in focus. Following the initial autofocus, the actual acquisition of the multispectral images is carried out. At each position in the acquisition pattern, a smaller, local z-stack around the initial reference focus value is acquired and the best of these images is chosen. This has to be done for all 99 positions in the pattern and is the main contributing factor to the instrument׳s total runtime. Further analysis and possibly modeling of the focus distribution inside a well is believed to be essential for reducing the acquisition time.The instrument is built as a device plugin for the VideometerLab software stack with a custom front-end. It utilizes VideometerLab׳s underlying libraries for controlling illumination, mechanics, and the camera, as well as its set of image analysis libraries for segmentation, object handling, feature extraction, and classification. The software saves the acquired multispectral images in raw format and as color representations, seeFig. 6. For each of the five multispectral bands, seeFig. 7, an overview image of the entire well is saved at a quarter the original resolution. Additionally, all detected foreground objects are saved as individual subimages and a report of the classification results are produced. The saving of the raw image files makes it possible to go back and analyze earlier image sets when the classification model or image analysis routines are updated.The purpose of the image analysis is to detect all foreground objects in the acquired images and categorize them. The objects are detected using image segmentation, discussed below, and the categorization is constructed as a decision tree, illustrated inFig. 8. It consists of two main subtrees; one for assessment of egg quantity (right) and one for assessment of egg quality (left). The two subtrees are summarized here and further explained in detail in Sections 2.2.3 and 2.2.4.Each of the resulting foreground objects from the segmentation (called blobs) can contain zero or more eggs, since clumps of touching or overlapping eggs and impurities are detected as single objects. The first decision in the tree is used to identify the lateral, singularized eggs (denoted LS-eggs) among the extracted foreground objects. This is done using size and shape properties, as explained in Section 2.2.2.The quantity-related subtree is used to estimate the total number of eggs in the sample. In this subtree the number of eggs in each of the remaining, non-LS-egg objects is estimated using size and shape properties. These egg counts are added to the number of identified LS-eggs to get an estimate of the total egg count in the sample. The total egg count can then be divided by the sample volume to assess the concentration of eggs in the sample. For instance, 1600 eggs in a sample of 80μl correspond to a concentration of 20eggs/μl or 20,000eggs/ml, which is the common unit for concentrations of T. suis eggs.The quality-related subtree is used to assess the embryonation percentage of the sample. This is done by classifying each LS-egg as being either an embryonated egg (EE) or a non-embryonated egg (NEE). All non-incubated, partly developed, and degenerated eggs are considered non-embryonated in this classification. An estimate of the emb. pct. is then computed as the proportion of embryonated eggs out of all identified LS-eggs.Note that only the lateral, singularized eggs are used for the embryonation assessment, since upright, clumping, and especially overlapping eggs often make it harder to see if there are fully developed larvae inside the eggs, seeFig. 9. This assessment therefore assumes that the LS-eggs are representative with regards to embryonation of the sample, i.e. that embryonated and non-embryonated eggs are equally likely to clump, overlap, or position themselves upright at the bottom of the analyzed well. A small investigation showed that this assumption seemed reasonable; the proportion of embryonated upright eggs was very close to the proportion of embryonated lateral eggs for three investigated wells.The following sections describe the image segmentation and object categorization in further detail.Fig. 6 shows a color rendition of one of the 99 positions of the well in Fig. 5. The color image is composed from the red, green, and blue brightfield bands of the multispectral image, scaled to improve the white balance. The five multispectral bands are illustrated for a region of the image in Fig. 7. It is seen that the internal egg structures are best distinguished in the red band, while the contrast between foreground and background is largest in the blue band, so the blue band is used for segmentation.The first step in the segmentation is thresholding. Since the entire image acquisition process and illumination is under control, a fixed threshold value is used. Fixed thresholding reduces the influence of the image contents on the segmentation. In this case, the value was experimentally chosen to be 135 of 255 based on manual and adaptive thresholding of a set of “extreme” images. After the thresholding, holes in the binary image are filled up to an area corresponding to three eggs (30,000pixels or 3633μm2). The result of the segmentation process is shown inFig. 10(b). Following the segmentation, blobs representing the segmented foreground objects are extracted using connected component labeling with 4-connectivity. Blobs smaller than the area of a single polar plug (500pixels or 60.6μm2) are discarded.The segmentation and blob extraction is done for all 99 images in the set. During image acquisition, the software keeps track of the motor coordinates for each image. These coordinates are used to calculate the exact position of each blob, which is then used to discard already identified blobs from the overlap zone of neighboring images, thereby avoiding to extract the same blob multiple times. The identified blobs are passed on to the decision tree.The first decision in the tree identifies the LS-eggs from all other foreground objects based on 10 size and shape features. In order for an object to be classified as an LS-egg, the scores for each of these features have to be within predefined intervals, given inTable 1.The endpoints of the intervals were chosen based on an earlier training set, where all proposed LS-eggs were marked and their feature scores were computed. For each feature in the list, the initial endpoints were defined to be the minimum and maximum feature score of the marked LS-eggs. After plotting the scores of the LS-eggs and the remaining objects, some of these intervals were manually tightened to remove false positives. The definition of an LS-egg is not completely clear, so the intervals just had to make sure that no non-eggs or eggs with obscured contents were included. The approach was inspired by the idea of combining several weak classifiers into a stronger classifier, known from machine learning techniques such as ensemble learning and boosting [29].The objects remaining after the first decision in the tree are a mixture of touching, overlapping, and clumping eggs and impurities of various sizes and shapes. In order to assess the egg concentration of the sample, all eggs in the sample have to be counted. The proposed approach is to estimate the total egg count by summing the computed number of eggs in each of the detected objects.Six classes are introduced to aid the egg counting process, called C0, C1, C2, C3, C4, and C5+, where the C is short for Count. They represent the number of eggs identified in a given object. Ideally, all singularized and clumping impurities get assigned to C0, all pairs of touching or overlapping eggs get assigned to C2, and all clumps of five or more eggs are assigned to C5+ etc. The class C1 is for instance given to an object that is believed to be a single egg but which does not fulfill the criteria for being an LS-eggs, for instance because a small impurity touches the egg.The employed approach is to first identify all singularized eggs and then deal with clumps of eggs and particles. To do this, the remaining objects are divided into a “small” and “big” group, where the “big” group consists of all objects larger than the maximum size of a single egg (area≥13,460pixels or 1630μm2).The lateral, singularized eggs are already identified in the initial step of the decision tree, but both upright and inclined eggs occur in the images as well, as seen in the upper left corner of Fig. 6. So from the “small” group, these are identified by the features listed under “Upright eggs” in Table 1. The interval endpoints were again chosen based on an earlier training set, but with some manual tweaking and inspiration from the LS-egg intervals. The remaining objects in the “small” group are then finally divided between the classes C0 and C1, see Table 1. This step introduces a number of misclassifications, which should potentially be eliminated in the future.Finally, the group of “big” objects is classified, primarily based on area. First, oblong impurities such as long, thin hairs or fibers are classified as C0 if either Width<26μm or RatioWidthLength<0.24. The remaining blobs are classified based on their area (in μm2): C1 [1630; 2000[, C2 [2000; 3100[, C3 [3100; 4500[, C4 [4500; 5500[, and C5+ [5500; ∞[. A more sophisticated approach using template matching with egg-shaped templates was initially considered, but the low classification error of the area-based approach made it unnecessary to introduce additional complexity at this step.The embryonation percentage of the sample is computed as the proportion of LS-eggs that have a visible larva inside. The classification is based on two biologically inspired features, the longitudinal anisotropy and the darkfield glow, first introduced by Bruun et al. [19,20].Longitudinal anisotropy (LA) is a measure of linear structures of the egg contents in the longitudinal direction of the egg. It is defined as the ratio between the strength of longitudinal linear structures and the strength of the transverse linear structures. Due to the typical positioning of the larvae inside the eggs, this measure is on average high for embryonated eggs, as shown by Bruun et al. [19]. A slight modification was made to the earlier presented method in that background-correction with a kernel size of 21 pixels was applied before calculation of the orientation energy.Darkfield glow (DFG) is a measure of the mean scattering intensity of the egg contents under darkfield illumination. It was previously observed that the fine-grained structures of non-embryonated egg contents scatter light significantly more than those of embryonated eggs, and this can be used to distinguish the two [19]. Also here, a slight modification was introduced in that the glow was measured as a robust mean of the egg content region where the 0.5% smallest and largest values were removed. The classification performance of these features is presented in Section 3. An example of the darkfield illumination and corresponding classification results can be seen in Fig. 10(c and d).The VideometerLab Calibration Development Tool was used to create the egg classification models and inspect individual eggs and their features, seeFig. 11. The actual image acquisition and combined analysis of concentration and embryonation percentage are carried out as a batch process when the OvaSpec application is executed.A blinded data set was prepared in order to evaluate the performance of the instrument. It consists of six vials of TSO suspensions at a concentration of approximately 20,000eggs/ml with embryonation percentages ranging from 0% to 85%. They were obtained by mixing two stock suspensions; one of non-incubated eggs (0% embryonation) and one of incubated eggs (85% embryonation).The T. suis eggs are from a GMP-validated egg production, where they were isolated from fecal material of inoculated Göttingen minipigs under clean and controlled conditions. Cleaning procedures include sieving, flotation, and sedimentation [30], after which the eggs were re-suspended in sulfuric acid pH 1 to avoid bacterial growth and stored at 5°C. In principle, the procedure can be adapted to stool/fecal samples from a range of animals.An experienced laboratory technician analyzed the two stock suspensions microscopically before mixing. This was done according to the standard operating procedures for microscopic analysis of TSO suspensions. To assess concentration, a subsample of 10μl is pipetted out onto a microscope slide and the total number of eggs in the sample is counted. This is repeated 10 times and the concentration estimate is computed as the average of the 10 counts multiplied with 100 to get the number of eggs per ml. To assess embryonation percentage, a subsample of 10μl is pipetted out onto a microscope slide and the number of embryonated eggs out of the first 100 eggs on the slide is counted. This is repeated 10 times and the emb. pct. estimate is the average of the 10 embryonation counts. It is not possible to know the true concentration and emb. pct. of an egg suspension, so the results of the experienced technician׳s microscopic assessments are the current best estimates.The vial setup can be seen inTable 2. The mixing ratio and expected embryonation percentages were kept blinded until all analyses were carried out. The mixing ratios of all vials except vial 4 were decided up front, while the person in charge of mixing and blinding decided the ratio of vial 4 at the time of mixing.The six vials were analyzed using microscopy by an experienced laboratory technician and using computer vision by OvaSpec. From each of the six vials, five subsamples of 80μl were analyzed using OvaSpec, each in a separate sample container well. An analysis of a single well produces 99 images, resulting in 2970 images for 30 imaged wells with five wells per vial. A second laboratory technician later annotated all images in a separate software program by assigning one of the earlier presented categories to each detected object in the images. Due to a large number of objects in the data set (43,133), this annotation process took approximately seven days.As explained in Section 2.2, OvaSpec counts all eggs in the sample to estimate concentration and uses all lateral, singularized eggs in the sample to estimate embryonation percentage. The decision tree and embryonation classifier used in the instrument was constructed before the start of the experiment and trained on a separate training set, consisting of 594 images from six fully imaged wells. The images in the training set contain 8868 eggs of which 6538 are LS-eggs. Of these, 5223 are embryonated and 1315 are non-embryonated, resulting in an emb. pct. of 79.9%. This emb. pct. lies within the typical range of analyzed TSO suspensions.The performance of the image analysis is evaluated by overall accuracy and other measures derived from the concentration and embryonation percentage confusion matrices. Additionally, the instrument outcomes for the 30 wells are compared to their annotations by a paired t-test. The instrument estimates of concentration and emb. pct. for six blinded vials are both compared to manual microscopy using a two-way analysis of variance with repetitions (R 3.0.2, Vienna, Austria).

@&#CONCLUSIONS@&#
