@&#MAIN-TITLE@&#
Nonlocal linear minimum mean square error methods for denoising MRI

@&#HIGHLIGHTS@&#
We introduced four filters based on LMMSE estimation for denoising MR images produced with single coil MRI.The self-similarity and natural redundancy of the magnitude MR image are considered to achieve high denoising performance.Finding best samples for LMMSE estimation in DCT domain will improve the denoising performance.Nonlocal PCA domain shrinkage is used as a refinement stage to further remove the uncorrelated noise.

@&#KEYPHRASES@&#
Denoising,Discrete cosine transform,Linear minimum mean square error,Magnetic resonance image,Principal component analysis,Rician distribution,

@&#ABSTRACT@&#
The presence of noise results in quality deterioration of magnetic resonance (MR) images and thus limits the visual inspection and influence the quantitative measurements from the data. In this work, an efficient two stage linear minimum mean square error (LMMSE) method is proposed for the enhancement of magnitude MR images in which data in the presence of noise follows a Rician distribution. The conventional Rician LMMSE estimator determines a closed-form analytical solution to the aforementioned inverse problem. Even-though computationally efficient, this approach fails to take advantage of data redundancy in the 3D MR data and hence leads to a suboptimal filtering performance. Motivated by this observation, we put forward the concept of nonlocal implementation with LMMSE estimation method. To select appropriate samples for the nonlocal version of the LMMSE estimation, the similarity weights are computed using Euclidean distance between either the gray level values in the spatial domain or the coefficients in the transformed domain. Assuming that the signal dependent component of the noise is optimally suppressed by this filtering and the rest is a white and uncorrelated noise with the image, we adopt a second stage LMMSE filtering in the principal component analysis (PCA) domain to further enhance the image and the noise variance is adaptively adjusted. Experiments on both simulated and real data show that the proposed filters have excellent filtering performance over other state-of-the-art methods.

@&#INTRODUCTION@&#
Magnetic resonance imaging (MRI) is an invaluable diagnostic tool and an essential noninvasive imaging modality that provides a vast amount of anatomical and functional information useful for diagnosis and patient treatment. It is often the case that the noise in the magnitude MR images follows Rician distribution when acquired with single coil. Consideration of how noise affects the true signal is important for proper interpretation and analysis of MR images [1].Noise filtering plays an important role in the enhancement of MR images. A plethora of different denoising methods have been proposed in last two decades [2]. Many authors directly applied traditional smoothing filters and conventional classical denoising techniques to treat the noise in MR images with an assumption of the Gaussian distributed noise model. However, those attempts have been failed to minimize the bias due to Rician noise. The bias becomes particularly important in low SNR MR images and it increases with decreasing SNR.As a solution to the aforementioned problem, numerous methods have been proposed in the literatures that can be mainly classified into those based on partial differential equations (PDE) [3–8], wavelet based methods [9–11], nonlocal means (NLM) [12–16] or nonlocal maximum likelihood (NLMl) methods [17–21]. Wavelet-based filters are rooted in the processing of images in a transformed domain. Bao and Zhang [22] reduced the noise in MR images based on an adaptive multiscale products threshold which incorporates the merits of interscale dependencies into the thresholding technique for denoising. Other transforms that have been applied to denoise images include principal component analysis (PCA) [23] and discrete cosine transform (DCT) [24]. Many transform domain filters have derived based on the transform-threshold-inverse transform principles. An adaptive diffusion method for magnitude MR data was proposed by Sijbers et al. [4]. Also, the authors in [5] proposed a noise adaptive nonlinear diffusion technique to denoise MR images with spatially varying noise levels. The limitations of the above mentioned techniques are that they usually tend to remove the useful high frequency details of the image and generate unnatural structures due to the undesirable estimations at edges.Apart from the above discussed methods, another category of methods has been proposed for MR denoising that relied on the statistical estimation theorem. Sijbers et al. [25,26] estimated the noise variance from Rician distributed MR data and carried out signal estimation using a maximum likelihood (ML) method [19,27]. Other customized versions of the ML method have been addressed in [17,28,29]. He et al. proposed a nonlocal ML (NLML) estimation method to overcome the disadvantages of local ML method such as blurring of edges and the distortion of fine structures in the image. In that method, the samples for the ML estimation are selected in a nonlocal way based on the intensity similarity measurement of the pixel neighborhoods using the Euclidean distance. In 2014, Rajan et al. [20] presented a new NLML estimation method, for noise reduction in MR images that follows Rician distribution, in which the samples are selected in an adaptive and statistically supported way using the Kolmogorov–Smirnov test. Wong et al. [30] proposed a novel stochastic noise reduction method for MR data which utilizes Quasi-Monte Carlo estimation (QMCE) approach for estimating the noise-free signal. The QMCE approach learns the statistical characteristics of the underlying noise distribution, as well as taking into account the regional statistics of the observed signal, in a data-adaptive manner.Recently, Aja-Fernández et al. [31,32] suggested a computationally efficient noise-driven anisotropic diffusion filtering based on a closed-form Rician LMMSE estimator for the large 3D MR images. This method estimates the noiseless signal value using local statistics of the observed image contents, i.e., by selecting a set of pixels from a local neighborhood. So, the high frequency components of the image like edges and fine details where the different underlying gray levels in a local neighborhood lead to the different realizations of its Rician nature; as a result of which, adverse estimation will be obtained. In an attempt to avoid the problem, Sudeep et al. [33] proposed a hybrid algorithm by incorporating the goodness of LMMSE estimation approach with Split-Bregman TV denoising method through 3D wavelet-subband mixing method to improve the quality of the denoised image. Since the MR data intrinsically contain many similar samples (patches) that can be used to improve the estimation results, Golshen et al. [34] addressed this difficulty by developing an SNR adapted nonlocal LMMSE method that takes the advantage of the high degree of redundancy in the contents of MR images and using a similarity measure based on the local statistical moments of the image. In [35], a filter based on nonlocal neutrosophic set (NLNS) approach was proposed. Filter bank based nonlocal means [36], iterative bilateral filtering [37], MR denoising in the wavelet packet transformed domain [38] are the other latest trends of the research area.In this paper we proposed an improved LMMSE method for denoising magnitude MR images in which the data (in the presence of noise) follows Rician distribution. The rest of the paper is structured as follows: Section 2 presents the relevant background on the noise characteristics in MRI. Section 3 elaborates the proposed method. Section 4 deals with the experimental results, comparative evaluation and discussion, followed by the conclusions and remarks in Section 5.The real and imaginary part of the raw complex valued MRI data, with mean values ARand AIrespectively, are corrupted by white Gaussian noise with varianceσn2. Since the computation of magnitude image, as the root of the sum of squares (SoS) of the real and imaginary part of the complex signal, is a nonlinear operation, the distribution of the observed magnitude MR data with noise will be Rician distributed and is given by [39]:(1)pMM|A,σn=Mσn2e−(M2+A2/2σn2)I0AMσn2HMwhere I0 is the 0th order modified Bessel function of the first kind. Here, M denotes the Rician distributed random variable,A=(AR2+AI2)and H(·) represents the Heaviside step function. The shape of the Rician distribution depends on the signal to noise ratio (SNR), which is here defined as the ratio A/σn. At high SNR, i.e., when A/σn→∞, the Rician distribution approaches a Gaussian distribution and its probability density function (PDF) can be written as [39]:(2)pM(M,σn)=12πσn2e−(M−A2/2σn2)H(M)In the image background, where A equals zero, the Rician PDF simplifies to Rayleigh distribution [40]:(3)pMM,σn=pMM|A=0,σn=Mσn2e−(M2/2σn2)H(M)Although all information is contained in the real and imaginary parts of the complex data acquired by an MRI system, the usual output of the scanners are magnitude images. The straight forward and most reliable approach to estimate noise from the magnitude images is to use a double acquisition method. When two images of the same subject are acquired under identical imaging conditions, noise variance can be estimated using the averaged and single images. Many methods have been proposed in the literature to estimate the noise from magnitude MR images [41]. A survey of those methods are given in [42]. However most of the methods proposed in the literature exploit the Rayleigh distributed background region for noise estimation. These methods may not work properly when the background is very less. Recently some object based methods are proposed in literature [43,44] and these methods doesn’t depends on the background for noise estimation. In this paper, we followed [44] for estimating the noise from the MR images.The most extensively used estimator to obtain a closed-form solution for a signal that obeys a Rician PDF is the LMMSE estimator. Closed form estimation methods are more efficient with computations than optimization based solutions like maximum likelihood (ML) and expectation maximization (EM) techniques. Aja-Fernández et al. have shown that A2 instead of A can be used to achieve a closed form expression whereby all moments to be used will be even. The LMMSE estimator for Rician distributed data, that is simplified for point wise estimation, is defined as [34]:(4)Aˆi,j,k2=〈Mi,j,k2〉−2σn2+(Mi,j,k2−〈Mi,j,k2〉)×max1−4σn2(〈Mi,j,k2〉−σn2)〈Mi,j,k4〉−〈Mi,j,k2〉,0where the notation 〈·〉 is the sample estimator of the expectation,Aˆi,j,kis the estimated value of the original noiseless intensity value Ai,j,kin the voxel (i, j, k) and Mi,j,kthe observed intensity value.PCA is a classical decorrelation technique that uses factorization to transform data according to its statistical properties. It has been widely used in signal processing, pattern recognition, dimensionality reduction, etc. Often the directions in which the input dataset have largest variances called principal components (PCs) are regarded as important whereas the minor components (MCs) (i.e., those components with the smallest variances) are regarded as unimportant or associated with noise. Therefore, the signal and noise can be better distinguished in the PCA domain. By transforming the original dataset into PCA domain and preserving only the PCs, the noise and trivial information can be removed [45].In this brief presentation of the LPG-PCA technique, we closely follow [46], which the reader can refer for more details. A pixel in the noisy input image and its nearest neighbors are modeled as a m-component vector variable uvand perform noise reduction on the vector instead of the single pixel in order to preserve the edges. The n training samples of uvare selected by grouping the pixels with similar local spatial structures to the underlying one in the local window and forms the m×n dataset matrix Uv.Those local statistics of the variables is accurately computed using the local pixel grouping (LPG) technique so that the image edge structures can be well preserved after shrinkage in the PCA domain for noise removal. The LPG-PCA method is a spatially adaptive image representation so that it can better characterize the image local structures.The PCA domain shrinkage procedure is as follows: let us denote the noisy vectoruv=[u1v,…,umv]Tof u=[u1, …, um]Tby uv=u+v. If the dataset of noise variablev=[v1,…,vm]TisV=[V1T,…,VmT]TandU=[U1T,…,UmT]Tis the decorrelated dataset of vector u, the noise corrupted data setUv=[(U1v)T,…,(Umv)T]Tcan be modeled as Uv=U+V. Also, Ukdenotes the row vector containing the n samples of ukand Vkis the row sample vector ofvk. The dataset Uvis the sample matrix of uvand its kth row, denoted asUkv, is the vector ofuk(v)js with j is varying from 1 to n.Let the mean value of sample vectorUkvis μk. Then, it can be centralized asU¯kv=Ukv−μkand the centralized matrix of Uvcan be represented as,(5)U¯v=U¯+VSince the covariance matrixΩU¯of the centralized datasetU¯is symmetrical, it can be decomposed asΩU¯=ΦU¯ΛU¯ΦU¯T, whereΦU¯is the orthonormal eigenvector matrix andΛU¯is the diagonal eigen value matrix ofΩU¯respectively.In practical implementation, we can set the orthonormal transformation matrixPU¯=ΦU¯Tto decorrelateU¯vi.e.,S¯v=PU¯U¯v. The covariance matrix of noisy datasetΩS¯vcan be represented in terms of covariance matrix of decorrelated datasetΩS¯and the covariance matrix of the noise datasetΩvsas [46](6)ΩS¯v=ΩS¯+ΩvsIn the PCA transformed domain, the noise inS¯vis suppressed by using the LMMSE technique. The LMMSE of kth row ofS¯, denoted asS¯⇀k, can be achieved through the multiplication of theS¯v(i.e.,S¯⇀vk) with the shrinkage coefficientwk. i.e.,(7)S¯⇀ˆvk=wk·S¯⇀vkwherewk=ΩS¯(k,k)/(ΩS¯(k,k)+Ωvs(k,k))Assume the matrixS¯ˆcontains allS¯⇀ˆvk. Then, we can find the denoised resultU¯ˆofU¯vas,(8)U¯ˆ=PU¯TS¯ˆAdding the mean values μkback toU¯ˆgives the denoised datasetUˆ. Applying the above procedure to all the pixels leads to the full denoised image of the noisy image.The non-local principle exploits the fact that similar neighborhoods can occur anywhere in the image and is able to yield high-quality denoising results. So, the nonlocal version of LMMSE (NLLMMSE) estimation for Rician noise model is proposed in this paper for MR denoising. In this non-local method, the center voxel of two similar volumes in the magnitude MR data have a similar meaning for the image and thus similar gray values. They can be understood as two noisy measurements of the same noise-free patch.The common way for the measurement of similarity is by using the Euclidean distance between the two vectors formed by the neighborhood voxels in the similarity volume of the voxel i and j (i.e., in the spatial domain). Let(Ai)pand(Aj)pbe the pth elements in the vectors Aiand Ajrespectively. Then, the Euclidean distance is defined as,(9)∥Ai−Aj∥2=∑p=1P((Ai)p−(Aj)p)2Algorithm for NLLMMSE filter to denoise the Rician affected noisy image is provided in Algorithm 1.It was shown that the noise in MR images can adversely affect the selection of samples with similar underlying gray value and a restricted local ML (RLML) estimation method has been presented in [19] by creating a reference image using NLM method to address it. More recently, calculation of similarity weights in DCT subspace were proposed for improving the performance of 2D NLM filter [47]. This DCT based NLM filter computes the similarity accurately and with less computational burden.We can extend this concept of similarity weight calculation in DCT domain with 2D NLLMMSE Filter to get 2D NLLMMSE-DCT Filter. Since the availability of appropriate samples for LMMSE estimation is higher in the near neighborhood of 3D MR data points and hence an explicitly better performance for 3D filtering over 2D filtering, we have preferred to work with 3D NLLMMSE-DCT Filter and is summarized as in Algorithm 2. Notice that, the above mentioned 3D NLLMMSE-DCT filter have chosen the parameters such as search volume size, similarity volume size and the number of DCT coefficients to find the distance measure as same as that of NLLMMSE filter to ensure a similar experimental setup for both the filters. We can further improve the performance of 3D NLLMSE-DCT filter by selecting a very large search volume and a lesser DCT subspace.The DCT transform for 3D data can be defined as,(10)Cdi=Cl,m,n(i)Cdi=α(l)α(m)α(n)∑x=0r−1∑y=0r−1∑z=0r−1Aicosπ(2x+1)l2r×cosπ(2y+1)m2rcosπ(2z+1)n2r,l,m,n=0,1,…,r−1where Cdirepresents the coefficients in DCT subspace of Ai, r is the length, breadth or height of Aiand α(★), ★=l, m, n is defined as,(11)α(★)=1rfor★=0,12rfor★≠0.in the first dimension and followed by second and third dimensions. Notice that this way of 3D DCT computation will increase time complexity tremendously. Hence, we used a much faster multi-dimensional DCT implementation of Andriy Myronenko [48] which utilizes the advantage of Fast Fourier Transform (FFT), fast permutation through indices and persistent pre-computation.In order to obtain the DCT coefficient vector for the similarity check, we convert the input volume of size r×r×r around each voxel into the DCT volume of similar size [48]. Here, we fixed the value of r=3 to achieve better computational efficiency. The first element in the (1,1,1) position of the DCT coefficient matrix is the DC coefficient and most of the energy will be compacted in this coefficient. The second layer of the DCT volume, i.e., the 2×2×2 block except the DC coefficient, corresponds to the mid-frequency range signal and the rest of the coefficients correspond to the high frequency layer. In case of NLLMMSE-DCT filter, each of these subbands of two DCT volumes are compared in terms of the distance ∥Cd(Ni)−Cd(Nj)∥2, i.e., the samples are selected by comparing the energy in each subband of the DCT volumes. Those volumes having smaller value for the difference in sub-band energies will produce a small value (approximately zero) for the similarity measure. The results in the following sections will validate the effectiveness of this method.Most of the initial noise will be removed in the first stage of the algorithm and its outputFˆ=NLLMMSE[G]is an image with good PSNR. Even though the quality is much improved, there is still visually unpleasant noise residual in the denoised imageFˆ. Although once the image G is filtered with the Rician estimator in nonlocal way, the output model is no longer Rician. Hence, applying the recursive version of the filter can not handle the noise effectively. One another consequence of this recursive approach is the unnecessary computational burden. In order to reduce this noise residual,Fˆcan be applied to the LPG-PCA denoising procedure[46] with adaptively adjusted noise standard deviation.The underlying assumption for second stage filtering is that the first stage removes the signal dependent component (Rician) of the noise in the image effectively and the rest of it inFˆcan be treated as a white Gaussian noise. The LPG-PCA filter is a good choice to remove such noises in images. But, it is important that the noise level must update to work the LPG-PCA filter properly. The noise standard deviation estimateσsˆof second stage can be calculated from the local variance distribution as [31],(12)σs2ˆ=mode{σNi2}whereσNi2represents the local variance distribution obtained by using the neighborhood Niaround each pixel i. We used the neighborhood window of size 7×7.Algorithm 1Signal estimation using NLLMMSE filter1:Input: G ⇐ Noisy MR Data2:Noise standard deviation estimation: Find standard deviation σnfrom G [followed the method in [44]]3:for each voxel g(i) of G do4:Select a R×R×R SearchVolume around the voxel5:Ni⇐ Similarity volume of size r×r×r around the voxel6:Nj, j=1⋯(R3−1) ⇐ Neighbourhood volumes in the SearchVolume other than Ni7:Compute the distanceg(Ni)−g(Nj)2and create a list D8:O=sort(D)      i.e., rank D in ascending order.9:Choose the first l elements of O for applying next step.10:Computefiˆ2←LMMSE estimation of the samples using (4).11:Findfiˆ←square root offiˆ212:end for13:Output:Fˆ⇐Denoised MR DataAlgorithm 2Signal estimation using NLLMMSE-DCT Filter1:Input: G ⇐ Noisy MR Data2:Noise standard deviation estimation: Find standard deviation σnfrom G [followed the method in [44]]3:for each voxel g(i) of G do4:Select a R×R×R SearchVolume around the voxel5:Ni⇐ Similarity volume of size r×r×r around the voxel6:Nj, j=1⋯(R3−1) ⇐ Neighbourhood volumes in the SearchVolume other than Ni7:Transform Niand Njs using 3D-DCT as in (10) to obtain Cd(Ni) and Cd(Nj)s respectively.8:Compute the distanceCd(Ni)−Cd(Nj)2and create a list D9:O=sort(D)      i.e., rank D in ascending order.10:Choose the first l elements of O for applying next step.11:Computefiˆ2←LMMSE estimation of the samples using (4).12:Findfiˆ←square root offiˆ213:end for14:Output:Fˆ⇐ Denoised MR DataConsider a central block of size K×K and a training block of size L×L, where K<L, around a pixel to be denoised. Letu0vbe the column sample vector containing the central K×K block anduiv, i=1, 2, …, κ and κ=(L−K+1)2−1 of length K2 be the sample vectors corresponding to the other blocks in the training window. Since the training window contains very different blocks from the given central block, usage of all the K×K blocks as the training samples ofuv=[u1v,…,uiv,…,uK2v]Twill be directed to an inaccurate estimation of the PCA transformation matrix and deteriorates the quality of denoised output. To guarantee an efficient selection of training samples and the accuracy of the results, the LPG mechanism is implemented as in Eq. (13).(13)Ei=1K2∑k=1K2(u0v(k)−uiv(k))2For a preset value of γ, we will check whetherEi<γ+2σs2ˆ. All theuiv's that satisfies this criteria including the central vectoru0vform the sample vector of uv, i.e., the training data set Uv. In practice, we will use at least n=c·K2 training samples of uvin denoising, where c is a constant, to ensure the number of samples to find the PCA transformation matrixPU¯. The top n samples are robust to estimate the image local statistics, and this operation makes the algorithm more stable to calculatePU¯.The methodology as summarized below:1In case of real MRI, the noise level in the input image is unknown. So, estimation of noise standard deviation in the image is a prior requirement and can be achieved through the technique discussed in [44].In the first stage, an effective noise removal is attained through the nonlocal implementation of LMMSE estimator for Rician noise using Euclidean distance as the measure for blocks comparison. It can be performed either in spatial domain (in case of NLLMMSE filter) or in the transformed domain (in case of NLLMMSE-DCT filter).The rest of the noise in the denoised image obtained from the first stage is assumed as a white and uncorrelated one with signal. The noise standard deviation of the result image is updating by using (12).Local pixel grouping (LPG) in the PCA domain is used for selecting and grouping the training sample blocks with similar content to the central block.After the LPG block matching, the LMMSE based shrinkage is applied to the coefficients in the PCA domain for the removal of noise in the image.As the last step, the inverse PCA (IPCA) transformation is performed to obtain the final denoised image.

@&#CONCLUSIONS@&#
