@&#MAIN-TITLE@&#
Variational surface design under normal field guidance

@&#HIGHLIGHTS@&#
Two extended energy functionals are proposed for variational surface modeling.The guiding normal field can be used to control the shapes of the variational surfaces efficiently.The proposed technique can be used for various modeling purposes like editing, hole filling or transition surface design.

@&#KEYPHRASES@&#
Membrane energy functional,Thin plate energy functional,Normal vector field,Geometric modeling,

@&#ABSTRACT@&#
This paper proposes a novel method for shape design of a Bézier surface with given boundary curves. The surface is defined as the minimizer of an extended membrane functional or an extended thin plate functional under the guidance of a specified normal field together with an initial prescribed surface. For given boundary curves and the guiding normal field, the free coefficients of a Bézier surface are obtained by solving a linear system. Unlike previous PDE based surface modeling techniques which construct surfaces just from boundaries, our proposed method can be used to generate smooth and fair surfaces that even follow a specified normal field. Several interesting examples are given to demonstrate the applications of the proposed method in geometric modeling.

@&#INTRODUCTION@&#
Functional optimization technique is a general approach to fair surface design [1–4]. Moreton and Séquin [1] proposed a method for the creation of smoothly connected surfaces of any genus or topological type. Welch and Witkin [2] achieved fair surfaces by functional optimization of the surface shape. The users were able to control the surface shape by attaching points and curves to the surface. Fair surface design can also be formulated as solving partial differential equations (PDEs) subject to geometric or physical constraints [5–12]. In literature [6], a system was proposed for global and local deformations of PDE-based surface models subject to physical constraints. At the same time, the system also computed the B-spline finite element approximation of the PDE surface and allowed users to interactively manipulate the surface.The tensor product Bézier surfaces, B-spline surfaces and NURBS surfaces are widely used in surface shape design. By employing the technique of control points, these surfaces can be designed interactively. Generally, the parametric surfaces can be deformed by searching the control points and weights subject to the geometric constraints [13–19]. Hu et al. [20] proposed two methods for modifying the shape of NURBS surfaces with geometric constraints, such as points, normal vectors at selected points, and pre-constructed curves. Both methods are dedicated to changing the control points and weights of an initial surface. Sauvage et al. [21] addressed the deformation of B-spline surfaces while constraining the volume enclosed by the surface. Pusch et al. [22] proposed an algorithm for locally deforming either a parametric surface or a hierarchical subdivision surface to match a set of positional and energy minimizing constraints.Among all functionals for fair surface design, Dirichlet functional [23] and bi-harmonic functional [24] are popular for generating smooth and fair surfaces that interpolate given boundary curves. However, surfaces generated by these two functionals have few degrees of freedoms for shape adjustment, and they cannot represent even cylinder or cone like surfaces which are widely used in CAD. The geometric PDE method can generate typical surfaces for shape modeling [25] and surface restoration [26]. But, these equations are hard to have analytic solutions due to high nonlinearity. For applications like transition surface design or hole filling, the interpolating surfaces may have salient features which should be controlled by additional parameters. This motivates us developing new functionals for fair surface design that have enough degrees of freedoms for shape adjustment as well as explicit solutions.We propose to design Bézier surfaces with given borders by minimizing an extended membrane energy or an extended thin plate energy. Besides being as fair as possible, the resulting surface also fits to a prescribed normal vector field and an initial prescribed surface. Two shape parameters λ and γ are introduced to balance the effects of normal field and the initial surface. If λ and γ are chosen zero, the energy functional will degenerate to the Dirichlet functional or the bi-harmonic functional. The algorithm is easy to implement and the free control points of the surface are obtained by solving a linear system. For the convenience of adjusting the specified normal vector field, we can discretize the functional on a grid of parametric points and specify a discrete normal vector field. We have applied the proposed method for surface editing, hole filling and transition surface modeling.The paper is organized as follows. In Section 2, an extended membrane energy functional and an extended thin plate energy functional are introduced. In Section 3, we propose explicit formulae for variational surface design under the guidance of normal vector field with given borders. Variational surface design under the guidance of discrete normal field is given in Section 4. In Section 5 we present several interesting examples. Section 6 concludes the paper.In this section, we propose two new energy functionals for Bézier surface shape design. These functionals are defined on the space of Bézier patchesR:Ω→R3. AssumingR(u,v)=∑i=0n∑j=0mBin(u)Bjm(v)Pijis the Bézier surface to be designed,N(u,v)=∑i=0n1∑j=0m1Bin1(u)Bjm1(v)Nijis the prescribed normal function andS(u,v)=∑i=0n∑j=0mBin(u)Bjm(v)P^ijis the given Bézier surface. We would like to find a fair surfaceR(u,v)that lies close to the given surfaceS(u,v)and fits well to the known normal fieldN(u,v).First, we extend the membrane energy functional by allowing the surface to follow the shape of a given normal field and an initial surface. The extended membrane energy functional is given by(1)E1(R)=12∫Ω{Ru2+Rv2+λ[(Ru·N)2+(Rv·N)2]+γ(R−S)2}dudv,whereRu,Rvare the partial derivatives ofR, andλ(≥0),γ(≥0)are the coefficients chosen by users. Ifλ>0, the resulting surface fits to the prescribed normals. Ifγ>0, the resulting surface follows the shape of the initial given surface also. The corresponding Euler–Lagrange equation of the functional is0=(I+λNNt)(Ruu+Rvv)+λ[(NNut+NuNt)Ru+(NNvt+NvNt)Rv]−γ(R−S),where I is the identity matrix and t represents the transpose of a column vector. If both the coefficients λ and γ vanish, the functional reduces to the classical Dirichlet functional, and the corresponding Euler–Lagrange equation becomes the classical Laplacian equation.Second, we extend the thin plate functional by using the prescribed normal field. In addition to interpolating the given boundary curves, the thin plate energy can be used to optimize surfaces that interpolate given tangent planes at the boundaries. In a similar fashion to the functional (1), the extended thin plate functional is defined as(2)E2(R)=12∫Ω{Ruu2+2Ruv2+Rvv2+λ[(Ru·N)2+(Rv·N)2]+γ(R−S)2}dudv,whereRuu,Ruv,Rvvare the second derivatives of R. The corresponding Euler–Lagrange equation for this functional is0=Ruuuu+2Ruuvv+Rvvvv−λNNtRuu−λNNtRvv−λ[(NNut+NuNt)Ru+(NNvt+NvNt)Rv]+γ(R−S).When the coefficients λ, γ vanish, the functional degenerates to the thin plate functional. The corresponding Euler–Lagrange equation becomes the biharmonic equation.Though the minimizer of functional in Eq. (1) or in Eq. (2) can be characterized by the Euler–Lagrange equation, practical applications such as filling holes or designing transition surfaces usually need to solve fair surfaces with known boundaries. In the following we minimize the functional (1) or (2) by assuming the boundary curves or the boundary control points of a Bézier surface are already given. As the integrals in Eq. (1) or (2) can be computed explicitly, the free control points of the Bézier surface will be finally obtained by solving a linear system.When we model a surface by minimizing the extended membrane energy functional with the given boundary curves, the minimization problem can be converted to solving the following system of equations.∂E1∂Pij=0(i=1,…,n−1;j=1,…,m−1).Since the energy functionalE1(R)is a quadratic functional in terms of the unknown control points, the mentioned equations form a linear system.LetCklij=n2∫Ω{[Bi−1n−1(u)−Bin−1(u)]Bjm(v)Bkn−1(u)Blm(v)(I+λNNt)}dudv,k=0,1,…,n−1,l=0,1,…,mandDklij=m2∫Ω{Bin(u)[Bj−1m−1(v)−Bjm−1(v)]Bkn(u)Blm−1(v)(I+λNNt)}dudv,k=0,1,…,n,l=0,1,…,m−1fori∈{1,…,n−1}andj∈{1,…,m−1}, we have the following proposition.Proposition 1A Bézier surfaceR(u,v)=∑i=0n∑j=0mBin(u)Bjm(v)Pijis the extremal of the functional(1)with prescribed border if and only if the control points of the surface satisfy the following linear system:(3)0=∑k,l=0n,m(Fklij+Gklij+Wklij)Pkl−∑k,l=0n,mWklijP^klfor anyi∈{1,…,n−1},j∈{1,…,m−1}, whereFklij={−C0lij,k=0,Ck−1,lij−Cklij,k=1,…,n−1,Cn−1,lij,k=n,Gklij={−Dk0ij,l=0,Dk,l−1ij−Dklij,l=1,…,m−1,Dk,m−1ij,l=m,Wklij=∫ΩγBin(u)Bjm(v)Bkn(u)Blm(v)dudvI,We compute the gradient of the functional with respect to each control pointPij. DenoteΔ10Pkl=Pk+1,l−PklandΔ01Pkl=Pk,l+1−Pkl. For anyi∈{1,…,n−1}, and anyj∈{1,…,m−1}, the gradient of functional E1 is obtained as follows:∂E1∂Pij=∫Ω{n[Bi−1n−1(u)−Bin−1(u)]Bjm(v)Ru+mBin(u)[Bj−1m−1(v)−Bjm−1(v)]Rv+λn[Bi−1n−1(u)−Bin−1(u)]Bjm(v)N(Ru·N)+λmBin(u)[Bj−1m−1(v)−Bjm−1(v)]N(Rv·N)+γBin(u)Bjm(v)(R−S)}dudv=∫Ω{n[Bi−1n−1(u)−Bin−1(u)]Bjm(v)(I+λNNt)Ru+mBin(u)[Bj−1m−1(v)−Bjm−1(v)](I+λNNt)Rv+γBin(u)Bjm(v)(R−S)}dudv=n2∑k,l=0n−1,m∫Ω{[Bi−1n−1(u)−Bin−1(u)]Bjm(v)Bkn−1(u)Blm(v)(I+λNNt)}dudvΔ10Pkl+m2∑k,l=0n,m−1∫Ω{Bin(u)[Bj−1m−1(v)−Bjm−1(v)]Bkn(u)Blm−1(v)(I+λNNt)}dudvΔ01Pkl+∑k,l=0n,m∫ΩγBin(u)Bjm(v)Bkn(u)Blm(v)dudv(Pkl−P^kl).By denoting the coefficient matrices in above equation asCklij,DklijandWklij, respectively, and further reformulating the differencesΔ10PklandΔ10Pkl, we obtain∂E1∂Pij=∑k,l=0n−1,mCklijΔ10Pkl+∑k,l=0n,m−1DklijΔ10Pkl+∑k,l=0n,mWklij(Pkl−P^kl)=∑k,l=0n,mFklijPkl+∑k,l=0n,mGklijPkl+∑k,l=0n,mWklij(Pkl−P^kl)=∑k,l=0n,m(Fklij+Gklij+Wklij)Pkl−∑k,l=0n,mWklijP^kl.This leads the expression in Eq. (3).□The linear system (3) can be written in the form of matrix equation, which takes theX,Y,Zcoordinates of the control points as the unknowns. When the coordinates of all unknown control points are obtained, a fair surface that interpolates given boundary curves and fits the guiding normal field will be generated.Just like the thin plate energy functional, the extended thin plate energy functional permits the construction of surfaces with G1 continuity with the surrounding surfaces. To achieve such a goal the outer two arrays of control points of a Bézier surface can be given in advance based on the continuity conditions while the remaining control points will be obtained by minimizing the functional (2) under the guidance of a given normal field. In a similar way to Section 3.1, we compute the control points where the gradient of the functional vanishes. From Eq. (2) we have∂E2∂Pij=∫Ω{n(n−1)[Bi−2n−2(u)−2Bi−1n−2(u)+Bin−2(u)]Bjm(v)Ruu+2nm[Bi−1n−1(u)−Bin−1(u)][Bj−1m−1(v)−Bjm−1(v)]Ruv+m(m−1)Bin(u)[Bj−2m−2(v)−2Bj−1m−2(v)+Bjm−2(v)]Rvv+λn[Bi−1n−1(u)−Bin−1(u)]Bjm(v)N(Ru·N)+λmBin(u)[Bj−1m−1(v)−Bjm−1(v)]N(Rv·N)+γBin(u)Bjm(v)(R−S)}dudv=0fori∈{2,…,n−2}andj∈{2,…,m−2}.Particularly, we letHklij=∫Ω{n2(n−1)2[Bi−2n−2(u)−2Bi−1n−2(u)+Bin−2(u)]Bjm(v)Bkn−2(u)Blm(v)}dudv,Iklij=∫Ω{2n2m2[Bi−1n−1(u)−Bin−1(u)][Bj−1m−1(v)−Bjm−1(v)]Bkn−1(u)Blm−1(v)}dudv,Jklij=∫Ω{m2(m−1)2Bin(u)[Bj−2m−2(v)−2Bj−1m−2(v)+Bjm−2(v)]Bkn(u)Blm−2(v)}dudv,Lklij=∫Ωλn2[Bi−1n−1(u)−Bin−1(u)]Bjm(v)Bkn−1(u)Blm(v)NNtdudv,Mklij=∫Ωλm2Bin(u)[Bj−1m−1(v)−Bjm−1(v)]Bkn(u)Blm−1(v)NNtdudv,Wklij=∫ΩγBin(u)Bjm(v)Bkn(u)Blm(v)dudvI.The equation∂E2/∂Pij=0becomes(4)∂E2∂Pij=∑k,l=0n−2,mHklijΔ20Pkl+∑k,l=0n−1,m−1IklijΔ11Pkl+∑k,l=0n,m−2JklijΔ02Pkl+∑k,l=0n−1,mLklijΔ10Pkl+∑k,l=0n,m−1MklijΔ01Pkl+∑k,l=0n,mWklij(Pkl−P^kl)=∑k,l=0n,mH¯klijPkl+∑k,l=0n,mI¯klijPkl+∑k,l=0n,mJ¯klijPkl+∑k,l=0n,mL¯klijPkl+∑k,l=0n,mM¯klijPkl+∑k,l=0n,mWklij(Pkl−P^kl)=∑k,l=0n,m(H¯klijI+I¯klijI+J¯klijI+L¯klij+M¯klij+Wklij)Pkl−∑k,l=0n,mWklijP^kl=0,whereH¯klij={H0lij,k=0,H1lij−2H0lij,k=1,Hklij−2Hk−1,lij+Hk−2,lij,k=2,…,n−2,−2Hn−2,lij+Hn−3,lij,k=n−1,Hn−2,lij,k=n,I¯klij={Ik0ij−Ik−1,0ij,k=1,…,n−1,l=0,Ik−1,m−1ij−Ik,m−1ij,k=1,…,n−1,l=m,I0lij−I0,l−1ij,k=0,l=1,…,m−1,In−1,l−1ij−In−1,lij,k=n,l=1,…,m−1,Iklij−Ik−1,lij−Ik,l−1ij+Ik−1,l−1ij,k=1,…,n−1,l=1,…,m−1,I00ij,k=0,l=0,−I0,m−1ij,k=0,l=m,−In−1,0ij,k=n,l=0,In−1,m−1ij,k=n,l=m,J¯klij={Jk0ij,l=0,Jk1ij−2Jk0ij,l=1,Jklij−2Jk,l−1ij+Jk,l−2ij,l=2,…,m−2,−2Jk,m−2ij+Jk,m−3ij,l=m−1,Jk,m−2ij,l=m,L¯klij={−L0lij,k=0,Lk−1,lij−Lklij,k=1,…,n−1,Ln−1,lij,k=n,M¯klij={−Mk0ij,l=0,Mk,l−1ij−Mklij,l=1,…,m−1,Mk,m−1ij,l=m.From Eq. (4) we know that theX,Y,Zcoordinates of the unknown control pointsPij(i=2,3,…,n−2;j=2,3,…,m−2) satisfy a system of linear equations. From the definition of the extended thin plate functional we know that the generated surface can interpolate the given boundary curves and the given tangent planes at the boundaries.An expected way to define the guiding normal field for the extended membrane energy functional or the extended thin plate energy functional is by using unit normals. However, the continuous unit normal field is generally represented by irrational functions which makes the integrals hard to compute. To balance the computational efficiency and unit normal requirement the functional (1) or (2) can be defined discretely. Instead of defining a continuous normal field we assume that unit normal vectors are given at a dense set of sampled grid points.We now explain the main idea by computing the discrete integral for the extended membrane energy functional, the discrete integral for the extended thin plate functional can be computed in the same way. Assuming{N(uip,vjp)}ip,jp=0np,mpare a set of unit normals corresponding to a set of pointsS(uip,vjp),uip∈{0,1/np,2/np,…,1},vjp∈{0,1/mp,2/mp,…,1}on the Bézier surfaceS(u,v). The functional (1) can be computed discretely as follows:(5)E^1(R)=12∑ip,jp=0np,mp{Ru2(uip,vjp)+Rv2(uip,vjp)+λip,jp((Ru(uip,vjp)·N(uip,vjp))2+λip,jp((Rv(uip,vjp)·N(uip,vjp))2+γip,jp(R(uip,vjp)−S(uip,vjp))2}.The weightsλip,jpandγip,jpare non-negative numbers corresponding to the sampled normalsN(uip,vjp)or sampled pointsS(uip,vjp). These weights can be chosen as a same value or different values for different normals or different points depending on various application purposes. Particularly, one can highlight surface features in some region by defining proper normal vectorsN(uip,vjp)and choosing large values for the weightsλip,jp. An example of preserving surface features based on normal constraint was given in [27].With given boundary curves together with their control points, the objective functionalE^1(R)is just the function of the inner control points of the Bézier surface. It follows that the free control points can be obtained by solving the following system:(6)∂E^1∂Pij=0(i=1,…,n−1;j=1,…,m−1).LetC^klij=n2∑ip,jp=0np,mp[Bi−1n−1(uip)−Bin−1(uip)]Bjm(vjp)Bkn−1(uip)Blm(vjp)×(I+λN(uip,vjp)Nt(uip,vjp)),D^klij=m2∑ip,jp=0np,mpBin(uip)[Bj−1m−1(vjp)−Bjm−1(vjp)]Bkn(uip)Blm−1(vjp)×(I+λN(uip,vjp)Nt(uip,vjp)).Based on Eq. (6), the coordinates of the unknown control pointsPij(i=1,…,n−1;j=1,…,m−1) satisfy the following linear system:(7)∑k,l=0n,m(F^klij+G^klij+W^klij)Pkl−∑k,l=0n,mW^klijP^kl=0for anyi∈{1,…,n−1},j∈{1,…,m−1}, whereF^klij={−C^0lij,k=0,C^k−1,lij−C^klij,k=1,…,n−1,C^n−1,lij,k=n,G^klij={−D^k0ij,l=0,D^k,l−1ij−D^klij,l=1,…,m−1,D^k,m−1ij,l=m,W^klij=∑ip,jp=0np,mpγBin(uip)Bjm(vjp)Bkn(uip)Blm(vjp)I.The system can be solved in the same way as in the previous section and a final surface that interpolates the given boundary curves will be generated.In this section, we present a few examples to demonstrate the effects of surface shape design under normal field guidance. For each example we first construct an initial surface interpolating the given boundary curves, and then we design a guiding normal field for the surface. The final surface is obtained by solving the optimization problem. Besides the guiding normal field, the final surface can also be adjusted by changing the parameters λ and γ.Fig. 1illustrates an example of surface modeling by optimizing the extended membrane functional (1). An initial Bézier surface of order 5×5 is given with two different guiding normal fields; see Fig. 1(a) and (e) for the initial surface and the normal fields. By fixing the boundary curves and minimizing the energy functional with various choices of parameters λ and γ, we obtain several surface shapes shown as the remaining sub-figures of Fig. 1. From the figure we can see that the final surface follows the guiding normal field or the initial surface well when the parameter λ or γ has been increased, respectively.In the following two figures we present examples of surface modeling under the guidance of discrete normal fields. Particularly, the parameter γ is chosen zero for these two figures.Fig. 2(a) illustrates an initial Bézier surface of order 8×8. The prescribed normal field is drawn in red, as shown in Fig. 2(b). This is a hat shape with wave edge. Based on the initial Bézier surface and the prescribed normal field, we can edit the surface shape by choosing different values for the parameter λ when the extended membrane energy functional is minimized. Fig. 2(d)–(f) illustrates the surfaces obtained by choosing different values for the parameter λ but choosing zero for the parameter γ. Obviously, the top of the new hat is flat. As a comparison, the Bézier surface which minimizes the Dirichlet functional is given in Fig. 2(c).The initial surface illustrated in Fig. 3(a) is the same as the surface given in Fig. 2(a) but the prescribed normal field has been changed. The surfaces shown in Fig. 3(b)–(d) are generated by optimizing the discrete extended membrane energy functional with different choices of values for the parameter λ. For each figure the parameter λ is chosen the same value for all the sampled points. Clearly, the greater the value of λ is, the more obvious the feature of the resulting surface is.Fig. 4illustrates an example of hole filling by optimizing the thin plate functional or the extended thin plate functional. A hole with a set of surrounding patches is shown in Fig. 4(a) and we will fill the hole by a Bézier patch of degrees 7×7. To guarantee the G1 continuity at the borders, the outer two arrays of control points are given in advance based on the border curves and the tangent planes at the borders. When we compute the remaining control points for the Bézier surface by minimizing the thin plate energy, a smooth interpolating surface is obtained; see Fig. 4(b) for the filling surface and Fig. 4(e) for the control mesh of the surface. If we set a guiding normal field for filling the hole, a Bézier surface that interpolates the given boundary data but minimizing the extended thin plate energy is obtained. Fig. 4(c) and (f) illustrates the filling surface and the control mesh of the surface, respectively. Comparing with the ground truth surface (Fig. 4(d)), the guiding normal field can help to restore salient features well.Finally, we present two examples of blending surface modeling by optimizing the extended thin plate energy functional (2). For each example a bi-quintic Bézier surface is used as the transition surface between two given surfaces; see Fig. 5(a) and d for the initial surfaces. To guarantee the G1 continuity between the transition surface and the surrounding surfaces, two arrays of boundary control points of the Bézier surface are given in advance. The surfaces generated by minimizing the thin plate energy are given in Fig. 5(b) and (e), respectively. From the figures we can see that the surfaces do not preserve the features well. When we add a guiding normal field for each surface and refine the surface to a new one by optimizing the extended thin plate energy, we obtain two surfaces following the surface features very well; see Fig. 5(c) and (f) for the obtained two transition surfaces.

@&#CONCLUSIONS@&#
