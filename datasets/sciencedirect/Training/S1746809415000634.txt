@&#MAIN-TITLE@&#
Recurrence quantification analysis across sleep stages

@&#HIGHLIGHTS@&#
Recurrence Quantification Analysis (RQA) applied to cardiorespiratory data.195 RQA features derived from 313 healthy subjects for sleep stage analysis.Cohen's kappa, sensitivity, specificity and accuracy investigation of best features.High sleep/wake stage discrimination.

@&#KEYPHRASES@&#
Recurrence quantification analysis,Sleep stages,Feature extraction,Cardio-respiratory features,

@&#ABSTRACT@&#
In this work we employ a nonlinear data analysis method called recurrence quantification analysis (RQA) to analyze differences between sleep stages and wake using cardio-respiratory signals, only. The data were recorded during full-night polysomnographies of 313 healthy subjects in nine different sleep laboratories. The raw signals are first normalized to common time bases and ranges. Thirteen different RQA and cross-RQA features derived from ECG, respiratory effort, heart rate and their combinations are additionally reconditioned with windowed standard deviation filters and ZSCORE normalization procedures leading to a total feature count of 195. The discriminative power between Wake, NREM and REM of each feature is evaluated using the Cohen's kappa coefficient. Besides kappa performance, sensitivity, specificity, accuracy and inter-correlations of the best 20 features with high discriminative power is also analyzed. The best kappa values for each class versus the other classes are 0.24, 0.12 and 0.31 for NREM, REM and Wake, respectively. Significance is tested with ANOVA F-test (mostly p<0.001). The results are compared to known cardio-respiratory features for sleep analysis. We conclude that many RQA features are suited to discriminate between Wake and Sleep, whereas the differentiation between REM and the other classes remains in the midrange.

@&#INTRODUCTION@&#
In order to diagnose sleep or sleep related disorders, nowadays, polysomnography (PSG) is performed to record physiological data over a whole night in a sleep laboratory. Its key component is the measurement of cerebral activity with electroencephalography (EEG). Several electrodes have to be applied to the patients scalp at defined positions which can only be done by trained persons. In addition, electrocardiogram (ECG), respiratory activity, muscular activation, i.e. electromyogram (EMG), body temperature and eye movements, i.e. electrooculogram (EOG), are monitored. The amount of different parameters already evokes a high complexity of such recordings. With increasing age, chronic illnesses and sleep disorders occur more often. The demographic change will not allow each subject with potential sleep disorder to be analyzed in a sleep laboratory as this is too cost- and time-intensive. Alternatives need to be established to explore sleep in more convenient environments, for example at home. Several studies show that it is possible to perform sleep staging to a certain extent using cardio-respiratory signals and body movements [4,6,25,30,31,41]. For example frequency and time-frequency analysis are applied on cardiac data to determine sleep or sleep-related disorders, such as sleep disordered breathing or sleep apnea [17,23]. The measurement of cardiac and respiratory signals can be transferred to the home environment more easily than EEG measurements, e.g. by using wearable sensor suites [21] or integrating the sensors into the bed mattress or pillow [9]. New methods and algorithms have to be developed to extract relevant data and multi-modal (coupled) signals using less sensors. Park et al. and Mita for example show improved algorithms to derive respiration from ECG measurements [36,38]. The aim of the research in this domain is to get an accurate estimate of sleep stages without the need of EOG, EMG or even EEG recordings. Recording in a familiar environment helps reducing the so-called first night effect biasing the regular sleep behavior. It also allows long-term measurements that are more representative than only one single night.Sleep is a very complex physiological process, not yet completely understood, in which the parasympathetic nervous system (NS) predominantly controls the sleep depth by regulating the body temperature, heart rate and breathing activity. However, the sympathetic NS acts against it, so that the body is always alert to external stimuli [42]. It is obvious that sleep is essential and vital as sleep deprivation results in serious behavioral and psychological disorders that finally lead to obesity, cardiovascular morbidity, traffic accidents and death [1]. In this work we analyze cardio-respiratory signals across wake and sleep stages at night. We employ recurrence quantification analysis (RQA), which is known to be a powerful tool to study complex (physiological) systems. RQA has already successfully been applied to EEG data [44] to distinguish between sleep stages. Smietanoswki et al. determined several RQA features using recurrence plots on heart rate (HR) signals to derive dynamics of the heart rate variability (HRV) in healthy subjects and patients with obstructive sleep apnea (OSA) [43]. They found out that the change of recurrences between healthy and OSA subjects is different, arising from a more complex heart rate dynamic for the rapid eye movement (REM) stage. RQA is also an adequate method to study the nonlinear dynamic properties of QT and RR intervals during acute myocardial ischemia [39].Terrill et al. apply RQA features, amongst others, solely on respiratory effort (RE) signals to classify 30s epochs of infant sleep into Wake, REM and NREM stages [46]. They show that most of the computed RQA features are top-rated by a feature selection algorithm and contribute to better performance. Another promising approach for sleep staging is the exploration of phase synchrograms by means of RQA, as proposed by Nguyen et al. [37]. That study was also performed on data acquired from healthy infants and additionally on simulated data to show the improvements of the method compared to conventional methods to analyze synchrograms. Cardio-respiratory phase synchronization (position and number of heartbeats within respiratory cycles), which is often inspected with synchrograms, significantly changes with sleep stages, as discovered by Bartsch et al. [2].However, to the knowledge of the authors, no work was published employing RQA on both, exclusively raw cardiac and respiratory data, for adult sleep stage investigation. Therefore, in this work, we concentrate on extracting thirteen of the most common RQA features from ECG, RE, HR signals and the two combinations of {ECG+RE} and {RE+HR} to determine the most discriminative features between different sleep stages and wake.This paper first gives a general overview of RQA as a quantifying description of recurrence plots (RPs), succeeded by a list of extracted RQA features. Then, it describes the employed data set and signal preprocessing steps for RQA, followed by a summary of the RQA embedding parameters. Finally, the ability of 195 computed cardio-respiratory RQA features derived from 313 whole night recordings of different subjects – representing more than 2300h of data – to distinguish between NREM, REM and Wake stages is presented and discussed.Recurrence quantification analysis (RQA) is a method for describing recurring states in the phase space of dynamic systems. The concept of recurrence was introduced by Henri Poincaré in 1890: the trajectory of a classical system will return infinitely many times to a limited region in phase space [15,40]. Often, only one time series xn(t) of a complex systemx→in d dimensions (x→∈ℝD) is observable. For this case, Takens proposed in 1981 a time delay embedding technique to reconstruct the phase space of the original system. Embedding m≥2·D+1 (correlation dimension D) sampling points of the discrete time series with delay τ for each time ti, thenxˆ→is a reconstruction of the original trajectory:(1)xˆ→(ti)=∑k=1mxn·(ti+(k−1)·τ)·e→k,withe→kas the unit vector of the dimension k. A diffeomorphism exists, so the embedding preserves the properties of the original attractor [34,45].To visualize recurrences in multidimensional phase space, Eckmann et al. presented recurrence plots (RPs) in 1987 [11]. An RP is an illustration of the binary recurrence matrixR→. The entry Ri,jis set to 1 (black pixel in the plot) if two states at different times are similar, i.e. the pointsxˆ→(ti)andxˆ→(tj)in phase space fall inside a ball of radius ɛ:(2)Ri,j(ɛ)=Θ(ɛ−‖xˆ→(ti)−xˆ→(tj)‖)i,j=1,…,N,where Θ is the Heaviside step function and ||·|| is a norm, e.g. the Euclidean. RPs can be interpreted as a generalized form of autocorrelation. The main diagonal line represents the identity. Diagonal lines in general indicate deterministic behavior, regular patterns of parallel lines reveal a periodicity. Isolated points are typical for chaotic systems, whereas a rectangular patch results from an accumulation of subsequent states in a limited region of phase space during laminar sections of a process.For cross-recurrences of two time series xnand yn, embedded in the same phase space, (2) is modified for cross-recurrence plots (CRP) in an analog way [34,48,50]:(3)CRi,j(ɛ)=Θ(ɛ−‖xˆ→(ti)−yˆ→(tj)‖).Thus, it is possible to study interrelations between the two signals, e.g. synchronization, time shift or distortion. Unlike RPs, CRPs are usually not symmetric and therefore bowed lines may appear. Examples of RPs and CRPs applied to ECG, respiratory effort and heart rate samples are shown in Fig. 1. Their creation and interpretation will be discussed in the upcoming sections.In order to quantify the two dimensional plots for computerized analysis of complex dynamic systems, Zbilut and Webber offered in the 1990s a few features, that measure the percentage of recurring states REC and the amount of diagonal lines: DET describes the degree of determinism and ENT is the Shannon entropy concerning deterministic sections [47,49]. Additionally, Marwan et al. demonstrated in 2002, that the information contained in vertical structures (laminarity LAM, trapping time TT and maximum length Vmax) is useful to detect chaos-chaos transitions. These RQA features were successfully applied to heart-rate variability data to predict life-threatening cardiac arrhythmia [35]. Besides, recurrence times and their entropy describe the periodicity [14,27]. In recent years, features from graph theory were added, which quantify the density of recurring states in phase space [3,10,33].The Cross Recurrence Plot Toolbox for MATLAB®[32], which is used in this work, provides a way to compute windowed RQA. Especially for long data sets containing several hundreds of thousands data points and to achieve an acceptable resolution it is necessary to analyze small sub-RPs stepping through the signal. A total of thirteen different RQA features is computed. They are REC, DET, ENT, L, Lmax, LAM, TT, T(1), T(2), Vmax, Trec, clust and trans. Detailed descriptions and feature interpretations are specified in the following Section 2.2.On the one hand, particularly for physiological systems of complex dynamics an important advantage of RQA is that no assumptions on the time series are required, like linearity in Fourier transforms [50]. On the other hand, it is challenging to find optimum embedding parameters, because no strict rules exist. For an adequate embedding dimension to reconstruct the original trajectory we choose the lowest m for which the number of false nearest neighbors drops below a threshold [22]. The time delay τ is set to meet the recommended first minimum of the mutual information for all subjects [13]. For the choice of threshold ɛ, Marwan et al. [34] lists several “rules of thumb”. To cover a broad range of the dynamics, we select a subject-dependent threshold so that REC (percentage of entries in the RP above a certain threshold ɛ, which is a measure for auto-/cross-correlation, see Section 2.2) is about 10% for five randomly selected sections of each analyzed signal.In the next sections we describe the RQA features, the data set and the preprocessing of the cardio-respiratory data. Furthermore, we present how the RQA parameters are determined.This section aims at describing and giving possible interpretations of all thirteen RQA features computed using the Cross-Recurrence Plot (CRP) for MATLAB®[32,34].•Recurrence rate (REC)(4)REC=1N2∑i,j=1NRi,j:Percentage of black pixels in a recurrence plot of size N×N. It is a measure for the auto- (RP) or cross-correlation (CRP).Determinism (DET)(5)DET=∑l=lminNl·P(l)∑i,j=1NRi,j:Ratio of diagonal line structures and recurrence point density with(6)P(l)=∑i,j=1N(1−Ri−1,j−1)·(1−Ri+l,j+l)∏k=0l−1Ri+k,j+kas the histogram of the lengths l; lminis the minimal length. The RP of a continuous sinus, for example, contains only diagonal lines: the trajectory is predictable.Average (L) and maximum length (Lmax) of diagonal lines(7)L=∑l=lminNl·P(l)∑l=lminNP(l),(8)Lmax=max({li}i=1Nl):Corresponds to the mean and maximum time, for which the process is deterministic. Nlis the number of diagonal lines.Entropy (ENT)(9)ENT=−∑l=lminNp(l)·lnp(l),wherep(l)=P(l)Nl: degree of complexity. For uncorrelated noise with no diagonals as well as for deterministic systems with one diagonal, the entropy tends to zero.Laminarity LAM(10)LAM=∑v=vminNv·P(v)∑v=1Nv·P(v),with vertical line lengthv, minimum vertical line lengthvminand with(11)P(v)=∑i,j=1N(1−Ri,j)·(1−Ri,j+v)∏k=0v−1Ri,j+kin analogy to DET: The likelihood that the system will maintain in certain states, e.g. in the “quiet” section between two R-peaks in an ECG.Trapping Time (TT) and longest vertical line (Vmax)(12)TT=∑v=vminNv·P(v)∑v=vminNP(v),(13)Vmax=max({vl}l=1Nv).Corresponds to the mean and maximum time, in which laminar states will maintain.Recurrence times of 1st and 2nd type, T(1) and T(2) (cf. [14]):(14)Tj(1)=〈{ik−ik−1|Rik,j=1}〉,(15)Tj(2)=〈{ik−ik−1|Rik,j=1∧ik−ik−1>1}〉,k∈ℕare the mean times between consecutive points within the ɛ-ball aroundx→jwith (Tj(1)) and without counting sojourn points (Tj(2)), i.e. considering only the first point on each trajectory that enters the ball. The recurrence times of 1st and 2nd type, T(1) and T(2), are the averaged times ofTj(1)andTj(2)for all j=1, …, N.Recurrence period density entropy Trec(cf. [27]):(16)Trec=−1lnTmax·∑t=1TmaxP(t)·lnP(t),whereP(T)=R(T)/∑k=1TmaxR(k)is the recurrence time probability density, R(T) the histogram of recurrence times and Tmaxthe maximum recurrence time (within the meaning of the first time a trajectory re-enters the ɛ-ball of a statex→j). The entropy provides information about the aperiodicity.Clustering coefficient clust and transitivity trans[3,10,33](17)clust=∑i=1N∑j,k=1NRi,j·Rj,k·Rk,iRECi,(18)trans=∑i,j,k=1NRi,j·Rj,k·Rk,i∑i,j,k=1NRi,j·Rk,i,whereRECi=∑j=1NRi,j, are methods of graph theory, counting triangles and triples. clust specifies the mean amount of very close related states among the recurrent ones and trans characterizes how strong recurrent states are connected.One part of the data set used in this study comprises full-night PSG and simultaneously recorded actigraphy (Actiwatch, Philips Respironics) of 15 healthy subjects with a Pittsburgh Sleep Quality Index (PSQI) [5] of less than 6 and no evidence of respiratory or sleep diseases. The subjects had an average age of 31.0 (±10.4) year. Nine subjects were monitored in the Sleep Health Center, Boston, USA (Alice 5 PSG, Philips Respironics) and six subjects were monitored in the Philips Experience Lab, Eindhoven, the Netherlands (Vitaport 3 PSG, TEMEC). Sleep staging was performed by a sleep technician according to the guidelines of the American Academy of Sleep Medicine (AASM) [18], distinguishing between Wake, REM, N1, N2 and N3. The trials were approved by the ethics committee of the local organizations and all subjects signed a consent form.The other part of the data set consists of two-night recordings of 164 subjects (298 recordings in total). It was acquired in the context of the EU SIESTA project between 1997 and 2000 in seven different sleep laboratories all following the same measurement protocol [24]. The database was restricted to subjects considered to be healthy (e.g. no shift workers, no depression, usual bedtime before midnight), with a PSQI of 5 at most. Sleep stages were scored by trained sleep technicians in six classes (Wake, REM, S1, S2, S3, S4) according to the Rechtschaffen & Kales (R&K) guidelines [19].In this work we employ AASM annotations as they are more recent than the R&K and were derived from the R&K guidelines [18]. Note, that we only analyze feature differences in the classes Wake, NREM and REM, where N1–N3 and S1–S4 are merged into a common class NREM. In total, RQA is performed on 313 healthy subjects representing more than 2300h of sleep data (average record duration of 7.39h per night). Thirteen different RQA features are derived from the following three modalities and two signal combinations:1)RECG: RQA of the electrocardiogram (ECG)RRE: RQA of thoracic respiratory effort (RE)RHR: RQA of heart rate (HR), derived from ECGXECG,RE: cross-RQA of ECG and REXRE,HR: cross-RQA of RE and HRIn addition to the unnormalized data a ZSCORE normalization (remove mean value and scale by overall standard deviation) and a standard deviation filter with a sliding window of 30s are applied to each subject in order to remove subject-dependent properties. The latter works like a moving average filter, but instead of taking the mean value it computes the standard deviation of the window (windowed standard deviation filter). The subject-by-subject differences are either caused by the general physiology or the employed measurement technique itself. For example, the amplitude of the RE signal is affected by the positioning of the sensor whereas the baseline and the variations of the HR are very individual. The following symbols are used to indicate the transformation on the RQA feature ⇒ ★: no normalization, ▵: ZSCORE normalization, ∘: windowed standard deviation. Afterwards, the resulting features are interpolated to the ground truth annotation time stamps, resulting in 30s epoch time series aligned with the reference. This leads to a total count of 195 RQA features11(3 modalities+2 signal combinations)·(1 original feature data + 2 normalizations)·13 features = 195.that are analyzed concerning their discriminative power between sleep stages and wake. The total numbers of 30s epochs of each analyzed class are NNREM=178,667 (64.39%), NREM=45,695 (16.47%) and NWake=53,129 (19.15%).To ensure that all signals are in a valid range for RQA, they need to be normalized and, in the case of cross-RQA, resampled to a common time base. The employed procedures are described in the following section. Examples of three different sleep stages – Wake, REM and NREM – after normalization are shown in Fig. 1. The structures of the (cross-)recurrence plots are different for each sleep stage making it possible to distinguish them.Raw ECG acquisition was performed with different sampling rates of 100, 200, 256 or 500Hz, depending on the sleep laboratory. Since most of these sampling rates are too high for efficient RQA computations and need to be equal for all subjects the ECG was re-sampled to a common sampling rate of 150Hz. In addition, baseline drift has been removed with a high-pass filter (0.8Hz cut-off frequency) and an amplitude min/max-normalization to a range of ±10[a.u.]. Most of the ECG signal, except the QRS complex, is then located within a ±1[a.u.] range.The raw thoracic effort signal of the PSG has a sample rate of 10Hz, which is appropriate for RQA computations. Due to body motion and position changes of the subject, the signal is likely to change over time. RQA is working best, when the signals are normalized to similar amplitude ranges for different subjects. By default, each window within the RQA procedure of the CRP Toolbox is normalized to the standard deviation [32]. Not only valid respiration cycles, but also motion artifacts causing very high amplitudes would then be normalized in the same way. This makes it impossible to distinguish between valid and invalid respiration segments. Therefore the windowed normalization is deactivated and an alternative procedure is developed. We determine the fundamental frequency of the respiratory signal using the Hilbert transform and use an adaptive comb-like bandpass [8] to extract the real respiration signal envelope changing over time. Afterwards, the raw respiratory data is scaled with twice the envelope amplitude leading to a harmonized range of about±0.5a.u.of regular breathing. Motion artifacts are still present since they are generally much higher in amplitude than the respiratory signal and have a much higher frequency component that is not considered during the normalization procedure. An example of a normalized signal segment with corresponding RPs is presented in Fig. 2. At around 50s, the signal amplitude suddenly drops, although a breathing component is visible. By applying RQA to the raw signal segment it is possible to detect this artifact but it is impossible to extract information of the respiration itself. The main concern is the correct choice of ɛ. A too low/high ɛ destroys the RP structure, which is the basis for the computation of most RQA features (see Section 2.2). The choice of ɛ of a normalized RP is easier since the artifact is almost annihilated in the RP even if it is still visible in the time domain.The instantaneous HR is determined by localizing R-peaks in the raw ECG. The detection is using an improved QRS detector based on the well-known Hamilton–Tompkins algorithm [16]. The resulting differences in time intervals are used to determine the instantaneous HR. To obtain a signal with equidistant samples, the HR is up-sampled by linear interpolation to a sample rate of 10Hz, equal to the RE sampling rate. Generally, absolute HR and HRV are varying from subject to subject. To overcome the inter-individual differences the up-sampled HR is normalized by dividing the median HR over the whole night and subtracting 1 to obtain a zero-centered HR signal. The variation of the HR is about 10% of the median value, so we finally scaled the HR by 10:(19)HRˆa.u.=HRbpmmedian(HR)bpm−1·10a.u..The cross-RQA requires two signals with the same sample rate. Two different cross-RQA, between ECG-RE and RE-HR (see combinations 4 and 5 in listing in Section 2.3), are computed in this work. To avoid elimination of signal components that might be important for RQA, we up-sample the signal with the lower sample rate and equalize both, i.e. RE to match the 150Hz of the ECG in the first case. HR and RE are already at 10Hz and therefore do not need to be adapted.To obtain useful information from the signals, it is necessary to choose adequate RQA parameters as mentioned before: dimension m, time delay τ, threshold ϵ, window sizewsizeand window step sizewstep(see Table 1).•Time delay τ: It can be estimated by computing the mutual information (MI). The optimal value for τ is the occurrence of the first minimum of the MI. Afterwards, the embedding parameter m can be determined. For periodic signals τ is in the order of T/4, with T the period length of the signal. In the case of RECG, the period length TECGis in the order of the length of a PQRST complex in the ECG (i.e. TECG≈200–300ms). Since respiration and HR changes are slow physiological processes. Their τ values are higher than for ECG, i.e. average TRE≈4s and THR≈8s are used. When computing MI, it becomes apparent that for cross-RQA the values for τ should be smaller than or equal to the smallest τ of a single modality to achieve a good compromise for embedding both signals in the same phase space [34].Dimension m: On the one hand, high values for dimension are recommended to include the dynamics [50] and to prevent false recurrences [35]. On the other hand, each additional dimension increases the computational complexity. After applying the false nearest neighbors algorithm with the selected τ to estimate the embedding parameter m, we find that m=4 is sufficient for all signals and subjects.Window sizewsize: Since generating an RP for a continuous full-night signal exceeds the limits of memory and CPU resources on most personal computers, RQA was done on sliding windows of sizewsize. To ensure that enough data points are taken into account for the computations the windows are of different sizes for each modality: for ECG it is chosen to contain about five heart beats, for RE at least one respiratory cycle and for HR about thirty consecutive heart beats. For the cross-recurrence XECG,REand XRE,HRit is also ensured that at least five consecutive heart beats and one respiratory cycle are within the processing window. This suggests that the time stamps of the windowed analysis have to be shifted backwards bywsize−m−1·τsamples to match the original time stamps [32]. The corresponding window sizes for each modality are listed in Table 1.Progression step of the sliding windowwstep: For ECG, RE and HR signalswstepis chosen to guarantee an overlap of one heart beat for RECG/RHRand one respiratory cycle for RRE. Adequatewstepvalues for XECG,REand XRE,HRwere derived from RECGand RREin the same way, respectively.ɛ: As mentioned above, ɛ is determined subject-by-subject before the extraction of all RQA features. The aim is to obtain an ɛ so that the RQA feature REC, which is computed on five randomly chosen sections for each RECG, RRE, RHR, XECG,REand XRE,HR, is at about 10% [34]. It ensures a wide dynamic range of the RQA features.

@&#CONCLUSIONS@&#
In this work we apply RQA on ECG, RE, HR and the two combinations of {ECG+RE} and {RE+HR} to derive features for sleep stage detection from the results. In total we extract 195 features from 313 full-night PSG records. A couple of these are suited to distinguish between NREM, REM and/or Wake classes. The significance of class discrimination is p<0.001 for almost all of the selected features. Especially for Wake/Sleep distinction, we obtain κ values that indicate very acceptable discrimination.The introduced normalization procedure for the RE signal aims at reducing movement artifacts and regularizing the amplitude over time and different subjects. Another approach to detect Wake might be to analyze the differences between the normalized and non-normalized signals, since movements are likely to occur during the Wake stages. Also during REM the raw RE signal contains many artifacts compared to NREM[12]. Since we concentrate on the RQA features in this work, no further investigations were done on this matter.To conclude, although not all selected RQA features correlate they can be used together to enhance the differentiation between the classes. Note, that the features are not meant to replace existing features from literature. They can rather be used in addition to other cardio-respiratory features with classifiers to optimize sleep staging tasks since RQA aims at extracting the dynamic, often very non-linear, characteristics of data without the need for temporal or spectral a-priori knowledge or assumptions (see Section 2.1). Using two modalities to distinguish Sleep and Wake gives the opportunity to either enhance redundancy in case of corrupted measurement signals or to increase detection performance using additional information.