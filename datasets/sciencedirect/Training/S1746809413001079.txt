@&#MAIN-TITLE@&#
Continuous thickness measurement of rectus femoris muscle in ultrasound image sequences: A completely automated approach

@&#HIGHLIGHTS@&#
We propose a novel method to continuously detect the muscle thickness automatically in ultrasound images.The correlation coefficient of the detection results between the proposed method and manual method is 0.95±0.01, and the difference is −0.05±0.22mm, with linear aggression (R2=0.981).We provide an accurate, high repeatable and efficient approach for estimating fascicle thickness during human motion.The method has wide application in biological sciences.

@&#KEYPHRASES@&#
Muscle thickness,Continuous measurement,Ultrasound image,Optical flow,

@&#ABSTRACT@&#
Muscle thickness is one of the most widely used parameters for quantifying muscle function in both diagnosis and rehabilitation assessment. Ultrasound imaging has been frequently used to non-invasively study the thickness of human muscles as a reliable method. However, the measurement is traditionally conducted by manual digitization of reference points at the superior and inferior muscle fascias, thus it is subjective and time-consuming. In this paper, a novel method is proposed to detect the muscle thickness automatically. The superficial and deep fascias of a muscle are detected by line detection algorithm at the first ultrasound frame, and the image regions of interest (ROI) for the fascias are subsequently located and tracked by optical flow technique. The muscle thickness is geometrically obtained based on the location of the fascias for each frame. Six ultrasound sequences (250 frames in each sequence) are used to evaluate this method. The correlation coefficient of the detection results between the proposed method and manual method is 0.95±0.01, and the difference is −0.05±0.22mm. The linear regression of the total 1500 detections show that a good linear correlation between the results of the two methods is obtained (R2=0.981). The automated method proposed here provides an accurate, high repeatable and efficient approach for estimating fascicle thickness during human motion, thus justifying its application in biological sciences.

@&#INTRODUCTION@&#
Ultrasound imaging can provide real-time representation of the muscle fiber dynamics during contraction. This method is shown to be capable of investigating human skeletal muscles in both diagnosis and rehabilitation assessment [1–3], and has been introduced to quantify morphological changes of skeletal muscle [2,4,5], such as fascicle length [6–9], pennation angle [10–12], muscle thickness [13–15] and cross-sectional area [16,17]. Because these morphological parameters are directly related to the mechanical properties of muscle, they can potentially provide a flexible method [18–20] for examining the intrinsic characteristics of the muscle.Muscle thickness is one of the most widely used parameters for quantifying muscle function [21]. It can be applied to assess the diseases of cerebral palsy [7,22,23], stroke [24–27] and neuromuscular disorders [28–32]. A study of the mechanical properties of the gastrocnemius muscle shown that the muscle thickness for stroke survivors is smaller than that of healthy controls, and the differences are significant at ankle dorsiflexion and knee extension [24]. A hand muscle atrophy investigation shown that compared to healthy subject, thickness of the extrinsic flexors in stroke survivors is reduced by 8% in flexor digitorum superficialis and 12% in flexor digitorum profundus, while thickness of the extrinsic extensor muscles is diminished by 11% [27]. In addition, the neuromuscular disorders usually result in muscle atrophy and intramuscular fibrosis and fatty infiltration. For instance, it has been shown in that the muscle thickness in neuromuscular disorders is significantly diminished in the quadriceps muscle [31].Compared with static measurement, continuous detection of muscle thickness can reveal the muscle changes under different motion conditions, such as different joint angles, torque and motion mode. These changes can provide strong scientific basis for mechanics analysis, clinical diagnosis and treatment [13,21,33]. The study in [34] has shown that the continuous muscle thickness changes are correlated well with EMG activity (P<0.001, R2=0.87) and they conclude that changes in thickness of transversus abdominis can be used to indicate electrical activity in that muscle. It is found in [33] that the relationship between the torque and the muscle thickness change could be well represented by a linear regression. Therefore, to qualify the continuous change of muscle thickness is important to clinical diagnosis and rehabilitation assessment, and it has been shown that ultrasound is a reliable method to measure muscle thickness with a test-retest correlation of 0.98–0.99 with MRI [35].Traditionally muscle thickness is manually measured in the ultrasound image. This method relies on manual digitization of two reference points at the superior and inferior muscle fascias and use an on-screen caliper to obtain the muscle thickness [3,15,36]. The digitization process has to be repeated frame-by-frame if the measurements involve multiple images; and hence, it is time consuming, subjective, prone to error, and not suitable for the measurements of dynamic changes [21]. To our knowledge, a type of semi-automatic measurement method based on cross-corrlelation algorithm has been proposed [13,21]. In this method, at the first ultrasound frame, two rectangular windows are selected manually on the superior and inferior fascia of a muscle respectively, and the image patches in the windows are tracked using cross-correlation to find their locations in the subsequent frame. The distance between the two windows is calculated as the muscle thickness at this moment. The basic hypothesis of this method is that the image patch inside the windows is in rigid movement during muscle contraction. However, irregular deformations usually occur in the fascias of a moving muscle, thus the accuracy and robustness of this tracking technique is limited. Moreover, in this approach, manual segmentation of the muscle fascias is still necessary at the first ultrasound frame.In this study, we propose a novel and completely automated approach for continuous muscle thickness detection. First, the superficial and deep fascias of a muscle are automatically detected by line detection algorithm, and the image regions of interest (ROI) for the fascias are subsequently located. Second, optical flow is adopted to track these ROIs, and the muscle thickness is geometrically obtained based on the location of the ROIs. Optical flow [37] is a technique which aims to estimate the motion between two image frames taken at different time, and now it has been widely used in the field of computer vision, such as motion detection, object segmentation and video encoding [38]. For a moving object, the optical flow is the instantaneous velocity of each pixel in the observation imaging plane, the irregular deformation of the objects can be represented by estimate the motion model using the optical flow of the involved pixels. According to the coherence of the muscle contractions, the motion of the fascias can be efficiently captured by the optical flow. Finally, this new algorithm is evaluated by a group of clinical musculoskeletal ultrasound images.Six healthy male participants with no history of neurological, cognitive, metabolic, cardiovascular, pulmonary, or lower limb musculoskeletal impairment volunteered to participate in this study. The human subject ethical approval is obtained from the relevant committee in the authors’ institution and informed consents are obtained from subjects prior to the experiment. Each subject is seated with both right hip and knee angles of 90°. During measurement, the subject is instructed to perform voluntary knee extension and flexion during about 10s.In the experiments, the ultrasound images of the rectus femoris muscle are recorded using an ultrasound image scanner (DC-6, Mindray, China). A standard 7L4, 7.5MHz linear probe is fixed by a custom-designed multi-degree adjustable bracket. The user-adjustable parameters are determined by an ultrasound expert for the subjects, so as to obtain the best integrity and clarity of the muscle boundary in the image. The total gain of DC-6 ultrasound system is 100dB, and the dynamic range is set to 85dB. In the image processing module, the function of image smoothing and correlation is open, while the function of edge enhancement is off. The image contrast can not be directly changed in the system and is defaulted. To better evaluate the ultrasound scanner used in this study, we have tested the resolution of DC-6 ultrasound system (7L4, 7.5MHz linear probe) using resolution phantoms from Dansk Fantom Service, and the detected axial and lateral resolution are less than 0.5mm and 1mm, respectively, which is similar to the results claimed by Mindray (The manufacturer, Mindray Medical International Limited Company). The raw video signal is directly fed into a computer using a video grabber card with frame rate of 25fps. An ultrasound image sample is shown in Fig. 1(a).In this study, a novel image processing method, based on affine optical flow, is developed to track the continuous thickness change in ultrasound image sequence. The tracking process consists of four steps: (1) in the first frame of the sequence, the superficial and deep fascias are extracted using line detection algorithm. (2) Two ROIs are segmented in the ultrasound images for the superficial and deep fascias respectively. A pair of key points (corresponds to the cross fork in Fig. 1) on the fascia are defined in each ROI. The direction of the line between each pair represented the direction of the fascia. (3) For two successive ultrasound frames, an optical flow method is applied to estimate the motion model of the ROIs, and the coordinates of the two pairs of key points are subsequently updated for the current frame using the estimated motion model. (4) The thickness is calculated using the geometric relationships of the key points for the current frame, and the process jumped to step 3 for the next frame.The first step of the proposed method is to detection the superficial and deep fascia lines. In the ultrasound image, the traditional line detection algorithm, like Hough transform, will be compromised by the high level of ultrasound speckle. In this study, we use Radon transform to detection the fascia lines. The edge extraction procedure is not needed in this method, thus the robustness to speckle noise is enhanced [39]. The standard Radon transform over a 2-D Euclidean space is defined as(1)F(θ,ρ)=∬Df(x,y)δ(ρ−xcosθ−ysinθ)dxdywhere D is the image grid, f(x, y) is the image intensity at position (x, y), δ is Dirac delta function, ρ is the distance from the center of the image to the line, and θ is the angle between the x axis and the line. The Radon transform represents an intensity integration over the entire image plane. In Fig. 1(b), the Radon space of the image shown in Fig. 1(a) is presented using standard color bar. A large value in Radon space will represent a straight line feature. We use the fast implementation from Dr. Garcia to locate the maxima in Radon space (see Acknowledgments). As shown in Fig. 1, the two largest values in the Radon space are located and marked by white cross (line 1# and line 2#). In Fig. 1(c), the detected fascia lines are draught out in yellow.As shown in Fig. 1(d), the vertical center of the ROI (size: 120×50 in pixel) is located at the center of fascia line, and the horizontal center is located at the ‘measurement location’ (with distance of D to the left boundary). Two key-points are adopted to track the fascia line inside each ROI. By setting a fix horizontal distance between the key-points and the ‘measurement location’ in each ROI, the coordinates of the key-points can be automatically obtained based on the slope and intercept of the fascia line. These key-points are used in the subsequent step to track the fascias.The optical flow technique has been applied in ultrasound data [40] for strain estimation. However, in this study, the objects being tracked are muscle fascisas, which are in irregular movement under contractions, and the capability of the optical technique on modeling the motions of the muscle fascisas is still unknown. Assume two images taken at times t and t+Δt at every pixel position. The voxel at location (x, y, t) with intensity I(x, y, t) will have moved by, Δx, Δy and Δt between the two images, and the following image constraint equation can be given:(2)I(x,y,t)=I(x+Δx,y+Δy,t+Δt)Assuming the movement to be small, the image constraint at I(x, y, t) with Taylor series can be developed to get(3)I(x+Δx,y+Δy,t+Δt)=I(x,y,t)+∂I∂xΔx+∂I∂yΔy+∂I∂tΔt+εwhere ɛ is the higher-order terms. From these equations it follows that:(4)∂I∂xΔxΔt+∂I∂yΔyΔt+∂I∂tΔtΔt=IxVx+IyVy+It=0where Vx, Vyare the x and y components of the velocity or optical flow of I(x, y, t), and Ix, Iy, Itare the derivatives of the I with respect to x, y, and t.The definition of the motion model is important to the optical flow technique. When the muscle is under contraction, irregular deformations must exist in the fascias. In case of the residual error induced by the local non-rigid displacement between the two ROIs in the adjacent frames, we use an affine model to represent the motion. In this model, the image velocity can be defined by six parameters(5)Vx=a0+a1(x−xc)+a2(y−yc)Vy=a3+a4(x−xc)+a5(y−yc)where a0−a5 are the parameters related to the specific motions, including translation, rotation, dilation and shear, xc, yc are the velocity at the center. Substitute (5) into (4), we can get the optical flow constraint equation(6)ΔIT.V(a)+It=0where ΔI=[Ix, Iy]T, V=[Vx, Vy]T, a=[a0, a1, a2, a3, a4, a5].The Lucas–Kanade method is applied to estimate the vector a[38]. An example of the optical flow results is shown in Fig. 2. The arrows represent the optical flow of the pixels located in the ROI shown in Fig. 1(d), and its size and orientation denote the speed and direction of the motion respectively. From this figure, we can observe that optical flows in the image region are inconsistent at different locations. The motion speeds at up-right corner are obviously smaller than those at low-right corner, and the motion directions also varied from point to point.The obtained affine transformation is applied to the coordinates of the predefined keypoints in the ROIs. Thus from each frame, we will get the location of the two keypoint pairs which can decide the line of superficial and deep fascias respectively. Let (x1, y1), (x2, y2) and (x3, y3), (x4, y4) denote the key point pair in the top and bottom ROI respectively, x0 denote the distance of the horizontal location between the left boundary and the pre-defined ‘measurement location’ by the expert. As shown in Fig. 3, the expected muscle thickness can be obtained by measuring the vertical distance between point P1 and P2. The slope and intercept of the up line is(6′)k1=y1−y2x1−x2,b1=y2x1−y1x2x1−x2.Therefore the muscle thickness can be measured by(7)d=x0(k1−k2)+(b1−b2)where the slope and intercept of the bottom line, k2 and b2, can be obtained using same Eq. (6′) except that the involved points are located at (x3, y3), (x4, y4). Note that the unit of the thickness is pixel, which should be converted to millimeter based on ratio of the imaging depth to the number of pixels at longitudinal axis.In manual measurement, three ultrasound clinicians with at least one year of experience of ultrasonic instrument operation participated as examiners for manual analysis. Before the investigation, the examiners were trained by a senior ultrasound expert for 2h, and they attended a workshop of Medical Ultrasonic Measurements organized by School of Medicine, Shenzhen University. For each subject, an ultrasound video clip containing 300 frames was labeled by these examiners, and the measurement was completed by ImageJ software. The ultrasound image are not filtered or reconstructed to get ‘high-resolution’, but are zoomed by the examiners based on the operation interface provided by ImageJ, and the markers are placed on the fascias with high confidence [3,15,36]. The distance between the markers is measured as the muscle thickness. These digitization processes are repeated frame by frame to complete the measurement for the ultrasound sequences. The results from the three experts are averaged to obtain the final results. To guarantee the consistence between the results from different examiner, the experts are instructed to set the vertical locations of the reference points to be at the center of the fascias, and the horizontal distance between the left boundary and the pre-defined ‘measurement location’ is decided by the experts before the measurements begin. This ‘measurement location’ is also adopted in the automatic tracking algorithm as an important parameter to calculate the muscle thickness.There are totally 6 (subjects)×250 (frames) ultrasound images acquired in this study. To qualify the agreement of the results between the two methods, we introduce two objective measures: correlation coefficient (CC) and difference (mean±sd). CC can be used to measure the overall consistence of the results, while it is not able to measure the absolute difference. In this paper, mean difference is used to describe the distribution of the difference between the results in mean±sd style. In addition, 95% confidence interval (CI) of mean and variance of the difference are calculated for each subject. A linear regression is made between the automatic results and the manual results (including all 1500 frames). Further the difference between the automatic and manual results is illustrated in histogram.

@&#CONCLUSIONS@&#
