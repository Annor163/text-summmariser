@&#MAIN-TITLE@&#
Postprandial blood glucose control using a hybrid adaptive PD controller with insulin-on-board limitation

@&#HIGHLIGHTS@&#
We proposed a controller very simple to implement and intuitively tuned.Controller implements a gain adaptation based on insulin-on-board constraint.The Controller performance was assessed under a very challenging realistic scenario.We found a reduced number of hypoglycemia events without increasing hyperglycemia.

@&#KEYPHRASES@&#
Artificial pancreas,Glucose control,Hypoglycemia,Insulin-on-board,Constrained control,Sliding mode control,

@&#ABSTRACT@&#
This paper addresses the design of blood glucose control during the postprandial period for Type 1 diabetes patients. An artificial pancreas for ambulatory purposes has to deal with the delays inherent to the subcutaneous route, the carbohydrate intakes, the metabolic changes, the glucose sensor errors and noise, and the insulin pump constraints. A time response typically obtained in closed-loop insulin delivery shows hyperglycemia in the early postprandial period caused by the lag in the insulin absorbtion, followed by hypoglycemia caused by control over-reaction. A hybrid control system is proposed in this paper to overcome these problems. An insulin bolus is administered prior to the meals like in open-loop control, whereas a PD controller is used for robust glucose regulation. The controller gain is progressively increased after the bolus from zero up to its nominal value as function of the insulin on board, so that the PD controller becomes fully operational just when the insulin on board falls below a prescribed value. An excessive accumulation of active insulin is avoided in this way, drastically reducing the risk of hypoglycemia. The controller gain is adapted by means of a variable structure algorithm, allowing a very simple software implementation. The robust performance of the control algorithm is intensively assessed in silico on a cohort of virtual patients under challenging realistic scenarios considering mixed meals, circadian variations, time-varying uncertainties, discrete measurement and actuation, sensor errors and other disturbances.

@&#INTRODUCTION@&#
Type 1 diabetes mellitus is a chronic disease characterized by the irreversible destruction of the β-cells in pancreas, which are responsible for the excretion of insulin. This hormone, together with the counteracting glucagon, are released to regulate glycemia in the physiological range from 70 to 120mg/dL. The inability of the diabetic organism to produce insulin leads to hyperglycemia, which in turn may cause severe diseases in the long term. Early in 1993, Diabetes Control and Complications Trial Research Group reported the relation among hyperglycemia and the risk of chronic micro and macro vascular complications [1,2].Nowadays, diabetes patients undergo intensive insulin treatments to keep their blood glucose levels near normoglycemia. The therapy consists of either multiple daily injections or continuous subcutaneous infusion using insulin (CSII) pumps. In the latter case, a prandial bolus is given to counteract the effects of meals in addition to a basal insulin profile supplied to regulate glycemia during the day [3,4]. Currently, modern insulin pumps incorporate bolus advisors that help patients to calculate the prandial bolus [5].Regretfully, this sort of therapy is prone to cause hypoglycemia in the late postprandial period [1,6,2]. Furthermore, since insulin is supplied in open-loop, blood glucose level may range beyond its acceptable limits because of misestimated carbohydrate intakes, metabolic changes, physical activity, stress, etc.The research community in the field is involved in the so-called artificial pancreas project. That is, in the development of an automatic insulin delivery system capable of keeping normoglycemia in diabetes patients with minimal human intervention. The state of the art not only includes the subcutaneous CSII pumps, but also continuous glucose monitoring (CGM) systems. These pumps and sensors are already commercially available. They are currently combined in decision support systems or sensor-augmented insulin pumps. Up to now, for safety and regulatory reasons, automatic closed-loop therapies have only been administered under intensive supervision. Unfortunately, robust and reliable automatic control systems capable of providing satisfactory performance under different patient conditions are not accomplished yet. The readers are referred to [7–9] for a comprehensive review and state of the art of the topic.On the one hand, intensive research is aimed at developing more reliable and accurate devices. Particularly, current sensors are not reliable in the long term and may introduce large drift and bias errors. A serious technological problem of artificial pancreas is the lag in the insulin action introduced by the subcutaneous route.This entails a serious limitation to compensate for meals, particularly unannounced ones. This problem can be significantly reduced using intravenous devices, more suitable for intensive care therapies, or intraperitoneal insulin delivery systems. Another limitation is that insulin pumps are one-way actuators, i.e. they cannot take insulin out of the body. Research on bihormonal therapies considering administration of insulin and glucagon are in progress [10,11].From a control viewpoint, the following challenges arise when facing the design of a control algorithm for an artificial pancreas:•slow dynamic response to the control action.nonlinear, uncertain and time-varying models.large disturbances (the meals).nonnegative actuation.measurement errors including noise, drift and bias.This control task is being addressed by the control community mainly in two different ways. One approach is based on PID techniques widely used in industry, well-established, reliable, very robust, having few parameters and intuitive tuning [12]. The other approach is based on model predictive control (MPC), which entails an on-line optimization procedure that determines an optimal control signal for a given model [13–15]. One of the advantages of the latter control approach is that they can incorporate different constraints to the optimization algorithm from the very beginning. Although very powerful from the computational viewpoint, its performance strongly depends on the model validity. Additionally, its complexity and lack of friendly accessibility for the medical staff might be obstacles for its real implementation in artificial pancreas in the near future. Other model-based but robust techniques such asH∞[16,17], sliding mode control [18,19], as well as control based on neural networks [20] have also been explored. In any case, because of the large disturbances (meals) and long delays (subcutaneous route), a semi-automatic control with meal announcement usually performs much better than the fully automatic ones, particularly for patients showing low sensitivity to insulin. A hybrid control scheme combines a feed-back controller with a feed-forward action (bolus and basal insulin doses) [21].In the semi-automatic scheme, the most challenging control problem is to avoid late postprandial hypoglycemia, typically caused by controller over-reaction while maintaining a reasonable postprandial peak. Different proposals to limit the insulin administration have been published in both PID and MPC control approaches. For instance, [22] proposes to switch off the PID controller just before the ingestion, the restarting time being decided as function of the current blood glucose concentration and rate of change. In [23,24], negative feedback of the estimated plasma insulin is added to the PID action in the so-called ePID-IFB algorithm. In [25], the insulin delivery in a bihormonal control strategy is suspended while insulin-on-board (IOB) exceeds 20% of the total daily insulin requirement, whereas the controller parameters are adapted as function of an insulin sensitivity estimate. In [26], a strong dynamic IOB constraint is incorporated to the optimization algorithm of an MPC, which needs to be shaped as function of the meal size so as to avoid being violated.Inspired on the aforementioned works, we propose here a hybrid adaptive PD controller for the postprandial period.The main novelty of the proposal is a methodology to adapt the feedback gain as function of the insulin on board (IOB), so that the controller becomes fully operational just when the insulin on board falls below a prescribed value. A soft IOB constraint (IOB¯) delimiting a safety region is established, which can be violated after a bolus. In that case, the controller gain is automatically switched to zero, suspending the insulin administration until the IOB returns to its safety region. From then, the controller gain is progressively increased from zero up to its nominal value, so that the controller does not react too aggressively to the inevitable excursions of blood glucose after the meals. A variable structure algorithm is used to obtain the maximum gain compatible with the constraint, allowing a very simple software implementation. An open-loop method to determine the IOB target for the adaptation phase is also given. One of the most attractive features of the proposed controller is its tuning simplicity. In fact, just three easily realizable clinical tests are necessary to tune the main controller parameters, which can then be intuitively adjusted by the medical staff based on clinical evidence.The control algorithm is run in silico using virtual patients of the UVa simulator cohort. The testing scenario considers realistic conditions with different types of uncertainties and disturbances, so as to evaluate the robustness of the controller. It includes mixed meals, controller mistuning, circadian variations in the insulin sensitivity, discrete measurement and actuation, sensor errors and other disturbances. Performance is compared, based on time responses and some usual metrics, with other reproducible and similar structured strategies available in the literature to emphasize the attractive features of the proposed gain adaptation algorithm.The control scheme adopted in this paper is depicted in Fig. 1. The controller presents a hybrid structure combining open-loop and feedback control.The basis for the feedback control is a PID-like controller. The controller gain and derivative time constant can be designed as usual. However, we replace the integral action with an open-loop basal insulin profile. Of course, the integral action can eventually be switched on during the night. The main reason to remove the integral term during the postprandial period is that the control objective during this period is not to closely regulate glycemia at a given set-point but to reject a disturbance (the meal) without undershoots (hypoglycemia). In fact, an integral action strong enough to track the circadian variations will inevitably increase the risk of an overshoot in the glucose level because of the large glucose excursions during the early postprandial period. Note that this is not a limitation of the proposed algorithm but is inherent to the demanding testing scenario described in Section 3. Anyway, the validity of the proposed approach is not restricted to PD controllers. In fact, it can be extended to PID or other controllers in a straightforward fashion.The insulin on board can be defined as the amount of administered insulin that is still active in the body. In an attempt to reduce hypoglycemia events, some smart pumps estimate the IOB to correct the boluses in order to prevent from excessive insulin stacking, particularly when boluses are given close together. Each patient exhibits its own insulin activity dynamics, which is usually characterized by the duration of insulin action (DIA), a parameter that clinicians are used to tune when setting up insulin pumps. A method to calculate the patient DIA is detailed in Walsh and Roberts [27]. The above mentioned smart pumps estimate the actual IOB from a set of time decay curves parameterized by DIA. The shape of the curves used by the pumps depends on the manufacturer and the type of insulin, but they are often linear function of time.Here, the insulin activity is represented by a two-compartment dynamical model [28]:(1)dC1dt(t)=u(t)−KDIAC1(t)dC2dt(t)=KDIA(C1(t)−C2(t))IOB(t)=C1(t)+C2(t)where C1 and C2 are the two compartments and u(t) is the insulin dose. The constant KDIAis tuned for each patient so as model (1) replicates its corresponding DIA. Because the way KDIAis calculated, (1) encompasses both the kinetics and dynamics of the insulin action. Fig. 2shows the insulin activity curves obtained with model (1) for typical DIA values, while Table 1shows the corresponding values of KDIAfor typical DIA values.The IOB limitIOB¯proposed in this paper as hypoglycemic protection is a constant value, although a time varying limit following the circadian variation of insulin sensitivity could also be a sensible choice. Proper values ofIOB¯for each patient can be obtained, for instance, from glycemia and insulin records including events of hypoglycemia and normoglycemia. In this paper, we applied the following postprandial open-loop test:1.Achieve an initial condition of preprandial blood glucose concentration between 80 and 120 mg/dL without insulin bolus administration during the previous 5h.Administer a meal with 40–100g of carbohydrates together with an insulin bolus.Observe blood glucose evolution during the following 10h,•If minimum glucose is outside the set (75,90), then repeat step 2 adjusting the bolus. Alternatively the correction factor, for a retrospective calculation of bolus, can be used.Else, calculate the IOB limit using (1) and the next formula:(2)IOB¯=IOB(TIOB)TIOB=CHO+80g60g/hwhere CHO(g) is the amount of carbohydrate intake. TIOBvaries between 2 and 3h when CHO changes between 40g and 100g. It is important to note that theIOB¯limit derived in this way is almost independent of the meal used in the test. Fig. 3illustrates the method to obtainIOB¯from the insulin clearance curve and (2) for two different meals. It is verified that, although TIOBis significantly different for each meal, the corresponding limits are practically equal.Note that the boundIOB¯, calculated as suggested before or in any other way, can be intuitively adjusted with medical criteria according to the closed-loop response exhibited by the patient. For instance, the physician should decreaseIOB¯in the case of frequent hypoglycemia, or increase it if the restriction is active during too long time.Fig. 4shows the structure of the proposed hybrid controller. The closed-loop control output upd, which contains a term proportional to the blood glucose error Gref−Gsand a derivative term, is added to the basal insulin Ibasalprovided by the open-loop control. This signal is then multiplied by the time-varying adaptive gain γ, which takes values in the set 0≤γ≤1, to give uγ. Finally, the insulin dose administered to the patient u is the sum of the bolus (Ibolus) and the control signal uγ.Note that the adaptation gain γ not only affects the feed-back action but also the basal insulin dose. The equations describing the hybrid control action are:(3)upd=−Kp(Gref−Gs)−TddGsdtuc=upd+Ibasaluγ=γ(t)ucuI=uγ+IbolusAn adaptive algorithm described in the next subsection calculates on-line the maximum gain γ compatible with the IOB constraint so as to avoid excessive control action during the first postprandial period.Fig. 5displays the block diagram of the proposed adaptive algorithm for γ on-line adjustment. It runs every sampling period of the pump just before pump insulin dose updating. It predicts the evolution of IOB(t) during the following sampling period and determines, as explained next, the gain γ used to calculate the insulin dose to be supplied during that period.A variable structure algorithm based on sliding mode concepts previously developed by some of the authors [29] is proposed here to determine the maximum gain compatible with the safety constraint. Note that system inversion techniques could alternatively be used. However, the variable structure approach allows a very simple, robust and efficient implementation [29,30].The switching function σ is constructed with the IOB(t) estimator (1) and theIOB¯limit determined with (2). This signal σ commands the comparator. Its output ω takes the value 1 for positive inputs and 0 otherwise. Finally, the gain γ is obtained as the average value of ω during the pump updating period.The mathematical equations describing the adaptation algorithm are:(4)ω=1ifσ≥00otherwise,σ=IOB¯−IOBFrom (1) and (3), the time evolution of σ is governed by the equation:(5)dσdt=KDIAC2−Ibolus−ucωThat is,(6)dσdt=KDIAC2−Ibolus−ucifσ≥0dσdt=KDIAC2−Ibolusifσ<0The algorithm works as follows. Immediately after a bolus, the insulin on board increases largely surpassing the prescribed limit σ=0, hence σ<0. As a result, the signal ω switches to 0, so as to cancel the input to the IOB estimator. Therefore, IOB falls until crossing the surface σ=0. Just when σ becomes non-negative, ω switches to 1. Two things may happen then, depending on the sign of dσ/dt. If dσ/dt>0, σ increases further leaving theIOB¯and going to the interior of the safety region σ>0. Conversely, if dσ/dt<0, the constraint is reached again and ω switches to 0. In this case, a fast switching sequence occurs on the constraint σ=0 until the insulin administered by the controller is not enough to compensate for the insulin decay term KDIAC2. In other words, after a transient following the bolus administration (called reaching mode in variable structure systems theory), a transitory sliding regime is established on the sliding surface σ=0. During this mode, ω switches at very fast frequency between 0 and 1. Since the algorithm is implemented with a few lines of code running on a PC, the switching frequency can be made arbitrarily fast. When the sliding existence condition does not hold anymore (uc<KDIAC2), the sliding regime is left and the controller becomes fully operational. The discontinuous ω is averaged during the algorithm runtime, yielding γ. Fast switching at the pump command signal is thus avoided.The operation of the adaptive controller is illustrated here. The postprandial period after a 60g meal of patient 1 of the UVa cohort is displayed in Fig. 6. The responses obtained using the proposed hybrid PD controller with and withoutIOB¯limitation are shown in solid and dashed line, respectively. In the former case, it is seen that the adaptive gain is automatically switched to zero after the bolus, thus leading to a faster decrease in the IOB. Once the estimated IOB reaches the safety constraint, a sliding regime is established on it, characterized by a fast switching of ω between the extreme values of γ (0 and 1). Then, as the IOB does not try to go beyond its limit anymore, ω keeps constant at its maximum value and the IOB falls below its constraint until the following meal. The gain γ is the filtered version of ω during a 10min period. The insulin infusion profile and glucose response are also shown. It is observed that the proposed adaptive algorithm avoids the hypoglycemia event occurring with the unconstrained hybrid PD control. Note that this improvement in the late postprandial period does not entail an appreciable deterioration in the early one.A realistic and very challenging simulated scenario is created to evaluate the robustness performance of the proposed control algorithm as hypoglycemic protection and its consequence on patient safety. A cohort of 10 virtual patients is subjected to a 18-meals simulation trial per patient, for a total of 180 meal tests. The menu consists of six different meals taken from [32], whose nutritional compositions are listed in Table 2, whereas their corresponding rate of blood glucose appearance profiles are shown in Fig. 7. A mixed meal is given to the patients every day at 12:00, so that every meal is administered to each patient three times during the simulation run under different intra-patient variability conditions. The focus of the analysis is on the 8h postprandial period. A night controller is switched on at midnight to achieve a preprandial glycemia close to 100mg/dL.The physiological model of the glucose-insulin system implemented in the simulation test is based on the T1DM model of Dalla Man et al. broadly used in the literature [33]. The model has a cohort of 10 adult FDA-accepted virtual patients. This model includes two subsystems representing the glucose intestinal absorption and the insulin in liver and plasma, respectively. These subsystems are connected to a third subsystem modeling the control of insulin on glucose utilization and endogenous production. Furthermore, the model includes a subcutaneous insulin infusion module to simulate insulin transit from the subcutaneous space to plasma.To account for intra-patient variability, we have included circadian variations in the insulin sensitivity (IS) of the patients based on the basal insulin requirements of adult patients presented in [35]. Fig. 8shows this factor for the cohort. Furthermore, intra-patient time varying uncertainties are also included. More precisely, a sinusoidal variation of 20% amplitude and 19h period is added to the IS. Also, a sinusoidal variation of 20% amplitude and 29h period in the insulin absorbtion is included. In this way, both the insulin sensitivity and absorbtion are time varying and different every day. All these variations are incorporated to the model with the purpose of evaluating the tracking and robustness properties of the controller. Finally, since we are considering a mixed meal scenario, we have replaced the CHO absorbtion model with the rate of blood glucose appearance profiles of the mixed meals.The insulin dose administered to the patients and the glucose measure are updated every 10min. The minimum basal insulin dose and minimum bolus increment are selected according to commercial pump data sheets. The insulin pump model includes an uncorrelated error with zero mean and constant variance.Regarding the sensor, a model of blood-to-interstitial glucose and an autoregressive moving average (ARMA) model to account for the time dependence of consecutive sensor errors are taken from [34]. The error seeds used for patients 1–10 were the values 4–13 respectively. The values of sensor error were generated every 1min but measured every 10min as mentioned previously.Table 3summarizes the open-loop basal insulin profile for each patient accounting for the circadian variation in the insulin sensitivity shown in Fig. 8. Also, Table 4shows the insulin-to-carbohydrate ratio for each patient.As previously mentioned, three clinical trials were used to tune the adaptive PD controller. The proportional gain was tuned in proportion to the total daily dose insulin (ITDD):(7)Kp=60TdITDD1500where ITDDwas obtained using a protocol of 200g CHO distributed in 40g, 80g and 80g at 08:00, 13:00 and 19:00 respectively. The derivative gain was set to Td=90min for all patients. The KDIAparameter of the IOB estimator was derived from the DIA, which was calculated following the trial described in [27]. Finally, theIOB¯limit was obtained following the procedure described in Section 2.2. All the controller and relevant parameters are listed in Table 5.The performance and robustness of the proposed hybrid adaptive PD controller was assessed under the challenging testing scenario described above. The same controller without gain adaptation was also evaluated to put in evidence the effect of IOB limitation. The proposed controller is also compared with two PID-like controllers found in the literature. One of them is the fully automatic PID controller with insulin feedback [23]. The other, based on the proposal of Weinzimer and coauthors [21], is a hybrid PID controller with a 35% pre-bolus administered 15min before the meal. The proportional and derivative gains are the same for all controllers, whereas the integral gain of the PID controllers is set to 450min. The glucose set-point is set to 100mg/dL for all controllers as well as the initial condition.The results and metrics obtained for the 180 meal tests are depicted in Figs. 9 and 10, and in Tables 6 and 7. Fig. 9 displays the control variability grid analysis (CVGA) corresponding to the four controllers. CVGA is a graphical evaluation tool that measures the performance of a control algorithm on an observation period. Each data point represents the minimum/maximum values obtained during the glucose excursion. The observation period of interest corresponds to 8h postprandial glucose. A numeric assessment of the overall level of glucose regulation by the summary outcome of the CVGA is also tabulated by zones in Table 6. It is observed that the proposed hybrid controller avoids the cases of severe hypoglycemia (<50mg/dL) observed for the other controllers. After comparing with the same controller without gain adaptation, it can be concluded that this improvement is due to the IOB limitation. It is worthy to note that hypoglycemia (<70mg/dL) avoidance is not achieved at the cost of an increase in severe hyperglycemia (>180mg/dL) events. Furthermore, it can be observed that the proposed controller achieves the largest amount of points in A and B zones, whereas there are only 4 points in the C–D–E zone. This behaviour states the susceptibility of the rest of controllers to overcorrection of hyperglycemia and hypoglycemia.Table 7 displays some usual metrics such as the mean and standard deviation of the maximum glucose excursion, the number of hypoglycemia events, the time the patients were in hyperglycemia and in hypoglycemia. It is observed that only 2 hypoglycemia events occurred when using the proposed controller, whereas more than 75 events occurred when using the other ones. Moreover, the time in hypoglycemia was significantly reduced from around 15% to 0.11% when using the proposed controller. Meanwhile, the other metrics are very similar for all controllers. Finally, Fig. 10 depicts the time response of the blood glucose concentration during the postprandial period. A very distinctive feature of the proposed controller is that the standard deviation decreases with time. It is also worthy to note that the time response obtained with the proposed controller does not exhibit the undershoot observed in the other cases.

@&#CONCLUSIONS@&#
In this paper, a hybrid adaptive PD controller has been presented. The gain adaptation was thought to improve the blood glucose control during the postprandial period by avoiding an excessive accumulation of insulin in the body. The adaptation method establishes a boundary layer of the insulin-on-board in such a way that the control algorithm keeps working properly even when an insulin bolus violates the constraint. In that case, the algorithm automatically suspends the insulin administration until the IOB reenters the safety region.The proposed controller is very simple to implement and can be intuitively tuned after a reduced number of clinical trials. The PD strategy employed in the main loop is less model-dependent than, for instance, MPC and other PID-like controllers. Additionally, in order to gain robustness against parameter uncertainty and variability (which could lead to severe hypoglycemic events), this simple controller is combined with sliding mode invariant control in a secondary control loop.The strong invariance of sliding regimes and the corresponding robustness of the IOB limits have been addressed in a practical approach. The method’ robustness and performance is mainly evaluated by means of very challenging and realistic in-silico scenarios, including 10 adult patients of the UVa simulator cohort, intra- and inter-patient variability through diurnal and day-to-day variation in the insulin sensitivity and absorption, mixed meals disturbance and sensor errors. The proposed controller was very successful in reducing the number of hypoglycemia events without increasing the time in hyperglycemia. Furthermore, it showed robustness to overcorrection of hyper- and hypoglycemia.The absence of glucose undershoot in the time response and the time-decreasing standard deviation are two attractive features of the proposed control strategy. They suggest that a further improvement in the controller response could be accomplished lowering the set-point, providing a larger bolus or tuning the PD gains more aggressively.