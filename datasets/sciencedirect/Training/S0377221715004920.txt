@&#MAIN-TITLE@&#
Wind farm portfolio optimization under network capacity constraints

@&#HIGHLIGHTS@&#
We provide a methodology for wind farm portfolio optimization.We model interactions among demand markets as a Signaling Game.Each agent faces a bilevel optimization program.Existence and uniqueness of the resulting Nash Equilibria are characterized.The efficient portfolios frontier is simulated for a real case study.

@&#KEYPHRASES@&#
Game Theory,Market Design,Renewable capacity investment,Markowitz Frontier,

@&#ABSTRACT@&#
In this article, we provide a new methodology for optimizing a portfolio of wind farms within a market environment, for two Market Designs (exogenous prices and endogenous prices). Our model is built on an agent based representation of suppliers and generators interacting in a certain number of geographic demand markets, organized as two tiered systems. Assuming rational expectation of the agents with respect to the outcome of the real-time market, suppliers take forward positions, which act as signals in the day-ahead market, to compensate for the uncertainty associated with supply and demand. Then, generators optimize their bilateral trades with the generators in the other markets. The Nash Equilibria resulting from this Signaling Game are characterized using Game Theory. The Markowitz Frontier, containing the set of efficient wind farm portfolios, is derived theoretically as a function of the number of wind farms and of their concentration. Finally, using a case study of France, Germany and Belgium, we simulate the Markowitz Frontier contour in the expected cost-risk plane.

@&#INTRODUCTION@&#
Market Coupling is the most advanced Market Design in the restructuring of the European (EU) electricity market. Market Coupling is the current outcome of a long and possibly never ending process toward an integrated electricity market (Glachant & Ruester, 2014). The path toward Market Coupling developed from an initially very decentralized view of an electricity market that only cared for access to the grid; development toward centralization then came as one progressively became aware of the very particular need for coordination required by electricity. Market Coupling takes some of these requirements into account but still remains far from the central organization that drives the United States (US) Independent System Operator (ISO) system. Market Coupling indeed relies on a separation of the energy market (organized by Power Exchanges) and transmission services (congestion and grid support services) operated by Transmission System Operators (TSOs). As several other electricity markets, Market Coupling is a two tiered system with a day-ahead market followed by a real-time market or, more exactly, a balancing system. The system is zonal in the sense that the European (EU) market is decomposed into zones (often, but not always, corresponding to countries) where Kirchhoff’s laws are ignored and it is assumed that there is no congestion. Power Exchanges operate in national markets and a special supra national organization clears the global energy market on the basis of the bids submitted to the national Power Exchange and a representation of the grid coming from the TSOs (Euphemia Public Description, 2013).Our work can be related to two streams of previous work. The first stream of literature is that related to the application of stochastic programming models to the electricity markets. Because events can always occur between day ahead and real time, the TSO can encounter in real time network difficulties that have not been anticipated in the day ahead. This phenomenon is enhanced in Market Coupling because market clearing in the day ahead uses an imperfect representation of the grid. In their paper, Smeers, Oggioni, Allevi, and Schaible (2012) assessed the amount of counter trading that might arise in real time as a result of using an approximate description of the grid in the day ahead. This problem takes a further dimension with wind penetration as wind forecast remains imperfect and any market clearing based on such forecasts in the day ahead is bound to be in imbalance in real time. The issue was examined in Oggioni, Murphy, and Smeers (2014) under strong assumptions of perfect coordination among TSOs to organize counter trading. In both cases, the work compared the result of a stylized representation of Market Coupling with an equally stylized representation of nodal pricing. Our second stream for inspiration comes from the computer systems literature (Nair, Adlakha, & Wierman, 2014). In their model, Nair et al. explicitly characterized the impact of growing wind power penetration on electricity Market Design by optimizing the placement of an intermediate market between the day ahead and real time, assuming supply and demand balance each other (Nair et al., 2014). The originality of their model stemmed from its capability to derive closed form expressions for the optimal energy procurement strategy by making the analogy with a variant of the well-known newsvendor problem.Market Coupling is considered as a major achievement on the path to internal energy market; its progress has been discussed at length in EU circles such as the Regulatory Forum in Florence. Surprisingly the literature and in particular the formalized literature on the subject has remained relatively limited in contrast for instance with the extensive literature in the US nodal pricing system (Newbery, Strbac, & Viehoff, 2012).Our model extends the approach of Nair et al. by introducing competition among the geographic demand markets subject to Market Coupling and characterizing the optimal investment policy in renewable energy supply capacity, which is becoming a major consideration for utilities that are subject to aggressive renewable portfolio standards.Accurate short-term forecasts of wind farm power output over the next few hours to days are important factors for secure and low cost operations of power systems with high wind power penetration (Morales, Zugno, Pineda, & Pinson, 2014; Papavasiliou & Oren, 2013). According to Girard, Laquaine, and Kariniotakis (2013), it is difficult to quantify the economic benefit of improved forecasting. The recent literature dealing with the placement of wind turbines concludes that the aggregation of wind farms can produce significant effects in terms of variability and cost reduction (Girard et al., 2013) since forecast errors might compensate each other. Furthermore, a portfolio of wind farms is likely to give better results in terms of the trade-off between cost and profit and its variability than relying on a single wind farm (Green & Staffell, 2013). Considering both problems of wind farm expansion and optimal wind farm portfolio generation, Girard et al. checked, using real data from Western Denmark, that power generator revenue is linear with respect to the wind farm capacity factor and that the accuracy of short-term wind power forecasts has only a very small impact on revenue. However, as the authors explained, their results do not quantify the benefit of predictability from a global system point of view. Adopting a more systemic approach, Green showed, using 18 years of hourly wind speed data coming from 120 sites around Great Britain, that careful market analysis is needed if investors are to build optimal portfolios of wind stations (Green & Staffell, 2013). Baringo and Conejo already made the link, dealing with the optimization of a strategic wind power investor who sells wind power in a two tiered market (including a day-ahead and a balancing market) (Baringo & Conejo, 2014).The main contribution of our work is an analytical treatment of the strategic positioning of suppliers in two tiered electricity markets, where real-time conditions are dictated by the uncertainty of renewable energy supply. A by-product of this analysis is the characterization of the optimal investment policy in renewable energy supply capacity, for suppliers acting as investors in wind power.According to the literature mentioned above, a careful (simplified) modeling of Market Coupling is the most crucial modeling aspect. We consider a certain number of geographic demand markets, described in Section 2. Since we want to characterize the agents’ general behaviors, we do not consider explicitly Kirchhoff’s laws and aggregate the supply and the demand at the market level. The originality of our approach relies on its capability to cope with competition among suppliers that are operating in spatially separated electricity markets, which was ignored in the previously cited models. After having defined the agents’ roles in Section 2.1, we assume that a Signaling Game occurs over each geographic demand market in the day ahead. Its timing is described in Section 2.2. The link between day-ahead and real-time markets is guaranteed by the existence of a forward position in the day-ahead energy market that compensates for the uncertainty of supply and demand in real time. The Game is solved for two Market Designs: two tiered with exogenous prices in Section 3 and two tiered with endogenous prices in Section 4. Efficient wind farm portfolios are then characterized on the basis of the Markowitz Frontier definition. Its exploration is detailed in Section 5. Contrary to traditional approaches that ignore the occurrence of rare events when performing risk minimization, the Markowitz Frontier is defined in a context of rare events, guaranteeing the robustness of the wind farm distribution. Illustrations based on real wind speed and energy consumption data for France, Germany and Belgium are provided in Section 6.Parameters:tfDay-ahead market time of occurrenceReal-time market time of occurrenceNumber of geographic demand marketsEquivalent capacity between markets i and jGamma function evaluated in aIncomplete Gamma function evaluated in a, xGaussian density function centered in 0 and of standard deviation σDay-ahead price for one unit of conventional energyReal-time price for one unit of conventional energyMarket i cluster setCompensation tariff for wind over-supplySupplier expected costConventional generator expected profitSupply of conventional in the day aheadSupply of conventional in real timeMarginal cost of conventional at tfMarginal cost of conventional at t0Marginal cost parameters at tfMarginal cost parameters at t0Market i demand of conventional at tfMarket i demand of conventional at t0Market i over-supply of wind production at t0Day-ahead positionAverage wind production of a single wind farmNumber of wind farmsConcentration of the wind farmsBilateral trade between market i and j at tfBilateral trade between market i and j at t0Sum of market i trades in real time (energy balance)Sum of market i exports in real timeMarket i total demand in real timeDay-ahead forecast of market i total demandForecast error made on the demand predictionDemand forecast error standard deviationWind power produced in real timeDay-ahead forecast of wind power productionForecast error on wind power predictionDifference between wind power and demand forecast errorsWind power forecast error standard deviationForecast error difference standard deviationForecast error on a single wind farmSingle farm forecast error standard deviationComplementary cumulative distribution function associated with Δiϵi∼N(0;(σiϵ)2)Δi∼N(0;σΔi2)Δj,∀j=1,…,N,j≠iInvestment problem horizonMarket i supplier investment functionConstruction cost for a single wind farmConstruction cost for the wind farm portfolioMarket i supplier riskBalancing is offered by a different set of technologies than those used in the day-ahead market, as a proxy of the existing practice in Europe where the energy power exchange (administered by the power exchange operator) is separated from the operation of the balancing market (administered by TSOs).We invoke rational expectation of suppliers and generators with respect to the outcome of the real-time market, which implies that agents correctly anticipate the congestion patterns of the real-time market. This is an extension of the usual assumption of stochastic programming to a game context. In other words, first stage decisions are optimal with respect to the outcome that they influence. Suppliers then anticipate the outcome of the market (this does not imply anticipating the realization of demand and wind supply, which is inherently uncertain and cannot be inferred by rationality), and since line congestion in real time is an outcome of the market, suppliers are able of predicting real-time congestion patterns and optimally adapting their day-ahead strategy. Conventional generators are subject to market power in each stage: they are subject to the strategic decisions of suppliers.We assume, in our paper, that in the balancing phase, excess wind is compensated by a feed-in-tariff11The Feed-in-tariff, http://www.uswitch.com/solar-panels/guides/feed-in-tariff/.; whereas under-supply is penalized at the real-time price, higher than the compensation price. This is an extreme case of a monotone kinked deviation price where agents are charged more for a shortage than they are remunerated for excess supply. This form of balancing penalty is common in European balancing systems (Martin, Smeers, & Aguado, 2014; Potential Cross-Border Balancing Cooperation between the Belgian, 2014). Although the exact closed form solutions depend on this choice of penalty, the qualitative results (existence of an equilibrium) extend beyond this particular case.We consider suppliers (distributors or utility companies) with long term contracts for renewable energy. Given such a long term contract, the suppliers participate in a two tiered market for conventional energy production. It consists of a day-ahead market occurring at tf> 0 and of a real-time market, occurring at t0 > tf; meaning that t0 occurs after tf. It is worth mentioning that we do not address bilateral forward contracting but adopt a standard assumption in the literature focusing on two-settlement systems (Baringo & Conejo, 2014; Martin et al., 2014).In the European Union (EU), the real-time markets introduced in this article can be assimilated to the EU balancing system (Girard et al., 2013; Le Cadre & Bedo, 2014) where positive and negative deviations are treated asymmetrically. Positive deviations are reimbursed on the basis of a fixed tariff by excess unit, supposed smaller than the real-time price (this can be compared with the so called feed-in-tariff), whereas negative deviations pay the real-time price as in Nair et al. (2014) model. This reflects an uninstructed deviation penalty for discouraging an unscheduled over-supply of renewable power in real time, and is consistent with existing market practices. Asymmetric settlements of real-time deviations have also been modeled in the literature (Martin et al., 2014; Nair et al., 2014; Pritchard, Zakeri, & Philpott, 2010).Our model is based on the assumption that competition is pure and perfect within each geographic demand market in the day ahead and in real time. That is why we assume throughout the article that offer equals demand (and also, price equals marginal cost). Furthermore, we invoke rational expectation in order to argue that agents correctly anticipate the congestion of a certain set of lines.Inside the economic system formed by the power markets, bilateral trades occur among the markets. We letλi→jf(resp.λi→j0) be the bilaterally traded flow of energy between market i and market j in the day-ahead market (resp. real-time market). A negative sign indicates an import from j to i, whereas a positive sign indicates an export from i to j. Throughout the article, we will use the simplifying notations:Λi≜∑j≠iλi→j0,Λi+≜∑j≠i(λi→j0)+and the following conventions:(x)+≜max{x;0}and(x)−≜max{−x;0},∀x∈R.Market Coupling clears energy and transmission in the day ahead with an “implicit auction” of transmission capacity (Hagspiel et al., 2014; Neuhoff, Hobbs, & Newbery, 2011), and is followed by intra-day trading and real-time balancing. Commonly, markets having smaller prices export to markets having higher prices, until a common price is reached or congestion occurs due to limited Available Transmission Capacities at the interconnections (Daxhelet & Smeers, 2007; Kunz, 2013; Smeers et al., 2012). Congestion management remains a controversial issue in the restructured European electricity sector. Congestion occurs when the infrastructure constrains transactions, thereby influencing the long term evolution of generation and consumption (Daxhelet & Smeers, 2007).Our network model is based on a virtual representation of the European area where each node coincides with a geographic22The term “geographic” will be understood in the rest of the article.demand market containing one or more TSOs and is fully interconnected with other geographic demand markets. We give an illustration of this representation in Fig. 1for three geographic demand markets (N=3). Inside each demand market, the balancing markets (managed by the TSOs) are coupled whereas they are split with theN−1other demand markets. We introduce the following definition: geographic demand markets are coupled in real time if, and only if, their real-time prices coincide i.e., no congestion occurs in real time.33The case of uncongested markets in real time is studied in Le Cadre and Didier (2014).Otherwise, they are said to be split. We introduce the equivalent interconnection capacity between market i and market j:κi,j∈Rsuch thatκi,j<+∞,i≠j. According to Hutcheon and Bialek’s representation of the European system (Hutcheon & Bialek, 2013), for anyi,j=1,…,N,i≠j,κi, jcan be either positive or negative; furthermore, we have the relation:κi,j=−κj,i.We assume that all agents correctly anticipate the congestion of a certain set of lines leading to a virtual representation of the European area in N split demand markets. Such an anticipation has already been done by Borenstein, Bushnell, and Stoft (2000) for two geographic markets sharing a constrained transmission line. As a by-product of congestion anticipation, for any couple of demand markets, real-time trade equals equivalent interconnection capacity minus day-ahead trade i.e.,λi→j0=κi,j−λi→jf,∀i,j=1,…,N,i≠j.There is a certain number of geographic demand markets, each characterized by a price insensitive44We do not consider demand side management in the present article. Models dealing with decentralized demand response integration through distributed learning approaches can be found in Le Cadre and Bedo (2014). In Le Cadre and Mercier (2012), the end user’s demand is price responsive and storage is possible either at the end users’ level, or at the microgrid aggregator level.and random demand. Only forecasts of the demand are available in the day ahead and the true values of the demand (i.e., its realizations) are revealed in real time. Similarly, wind generation in each geographic market is price insensitive and random: only forecasts are available in the day ahead and the true values (i.e., the random variables realizations) are revealed in real time. We now describe the different categories of agents interacting in each demand market.•Suppliers (distributors or utility companies) deliver energy to consumers characterized by their aggregated demand. They are price takers in the first Market Design (MD 1) detailed in Section 3. In contrast with standard assumptions, they are not price takers in the second Market Design (MD 2), described in Section 4. In this latter Market Design, they are aware that their decisions modify prices and take that knowledge into account to minimize their procurement cost. Since consumers are exposed to a retail price that is unrelated to wholesale market conditions, we assume an inelastic consumer demand whose real-time level is uncertain in the day-ahead time frame. Additionally, we assume that the suppliers are driven by renewable portfolio standards to invest in renewable capacity. Suppliers have to decide how to compose an optimal wind farm portfolio for participating in the electricity market.Conventional energy generators are characterized by their supply function. There is conventional generation in each market. Marginal costs are higher in real time than in the day ahead for a given output level. We assume that generators do not exercise market power, and suppliers buy electricity at marginal cost.We make the assumption that a clearing price is reached at tf. Because the transfers are limited by the equivalent interconnection capacity, it will be harder to align the market prices at t0.We now describe the optimization program faced by each market. Over each market i, at time instant tf:(i)The suppliers optimize independently and simultaneously their purchase of conventional energy so as to minimize their expected cost while ensuring that the total purchased quantity satisfies the residual demand.Anticipating what will happen in the real time market i.e., at time instant t0, the conventional generators optimize independently and simultaneously the bilateral trades with the other markets so as to maximize their expected profit under equivalent capacity constraints.Under congestion anticipation of all the equivalent interconnection capacities, the trades at tfare linked to the optimal trades at t0 according to the relation:λi→jf=κi,j−λi→j0,∀i,j,i≠j.The distributed optimization of the program described above gives rise to a game belonging to the family of Signaling Games (Sobel, 2009). Here the signal is based on the suppliers’ forward positions which can be expressed as mappings of the suppliers’ wind and demand forecasts of the underlying state of the system (unknown in the day ahead):(wi,di)i=1,…,N.The bilevel game described above is solved by backward induction: we start by optimizing the generator’s bilateral trades, assuming that the suppliers’ forward positions are fixed. Then, the supplier’s expected cost are optimized by derivating their utility with respect to their purchase of conventional energy.Market i is defined by:•di, the end users’ total demand of energy at time t0. It satisfies the relation:di=d^i−νiwhered^iis the forecast made at tfof the end users’ total demand of energy at t0. νiis a random variable, representing the forecast error made on the demand prediction, and distributed according to a Gaussian density function centered in 0 and of standard deviationσiν:νi∼N(0;(σiν)2).wi, the energy produced at time t0 by the market renewable energy generators. It satisfies the relation:wi=w^i−ϵiwherew^iis the forecast made at tfof the quantity of renewable energy that market i generator will produce at t0.ϵiis a random variable, representing the forecast error made on the prediction of the renewable production, distributed according to a Gaussian density function centered in 0 and of standard deviationσiϵ:ϵi∼N(0;(σiϵ)2). The forecast error on the production of a single wind farm will be denotedϵ˜i. Being consistent with the assumption made onϵigeneration, it is distributed according to a Gaussian density function55Other density functions might be considered without adding any changes in the derived theoretical results except in the numerical illustrations where the Gaussian assumption greatly simplified the computations.centered in 0 and of standard deviationσ˜iϵ:ϵ˜i∼N(0;(σ˜iϵ)2).The relation betweenϵiandϵ˜iwill be discussed explicitly in Section 2.5.The forecast error vector for wind production and demand:(ϵi˜νi)T66.Tstands for the transpose of the vector.is also supposed to be a Gaussian random vector. According to Sinden (2007), wind power output in the United Kingdom (UK) has a weak positive correlation to current electricity demand patterns i.e.,E[ϵi˜νi]σiνσi˜ϵ>077Data analysis ran on 66 onshore weather recording sites for the period 1970–2003 in the UK showed a correlation of 0.28 (Sinden, 2007). This is the value that we will use in the simulations.. This implies thatΔi≜ϵi−νi,which is the difference between renewable production and demand forecast errors, is distributed according to a Gaussian distribution function centered in 0 and of varianceσΔi2=(σiϵ)2−2E[ϵiνi]+(σiν)2.In the rest of the article, we will let:Δi∼fΔi≡N(0;σΔi2);F¯Δiwill represent the associated complementary cumulative distribution function. Δiis supposed to be independent of anyΔj,∀j=1,…,N,j≠ii.e., the prediction errors made on one geographic market are independent of the ones made on the other geographic markets.sif(resp.si0) market i supply of conventional energy in day-ahead (resp. real-time) markets.cif(sif)=aif+bifsif(resp.ci0(si0)=ai0+bi0si0) the marginal cost function of conventional energy produced by market i and purchased at tf(resp. t0), withai0>aif>0andbi0>bif>0guaranteeing that the marginal cost on the real-time market remains larger than in the day-ahead market for a given output level. Indeed, balancing is often supplied from machines that are reserved on a long-term basis, and these are the older machines. The two supply curves are then different because they come from different machines. If so, the current formulation that separates day-ahead and real-time machines, the latter having a higher marginal cost than the former, may be seen as a simplification made to preserve analytical tractability but is also in line with EU type systems where there are separated fleets of capacity for balancing and for the day-ahead market. Balancing capacity is contracted one year in advance (ELIA, 2014a; 2014b; 2014c; Potential Cross-Border Balancing Cooperation between the Belgian, 2014). In addition, since the balancing market is pay-as-bid there is anyway no way of empirically verifying or refuting whether strong links between day-ahead market and balancing system exist. Our modeling approach is an alternative that facilitates the development of our analysis and approximates non-convexities associated with real-time operations such as the wear and tear of machinery in emergency operation (emergency startup costs, wear due to emergency ramping, etc.).qif(resp.qi0) market i demand of conventional energy in day-ahead (resp. real-time) markets.The amounts of conventional energy purchased by market i at tfand at t0 are defined as follows:qif=(d^i−w^i+ri)+andqi0=(di−wi−qif)+where riis a position in the day-ahead (lower cost) market. This day-ahead position is determined by the energy supplier in market i for the consumers’ demand dito be satisfied at t0 at the lowest possible cost; taking into account the uncertainty of supply at t0. Market i knowsd^iandw^i. Hence it is equivalent for the supplier to determineqifor ri. The hypothesis thatqif>0holds as long as the demand exceeds the average wind capacity.88It is sufficient to impose an upper-bound on the degree of wind penetration that we consider i.e.,d^i+riαi>γi,to ensure that this inequality holds.In the rest of the article, we will assume that:qif≜d^i−w^i+ri.The over-supply of wind production in real time is defined as:qi0˜=(Δi−ri)−.Depending on the market mechanism, excess wind supply can be:•Curtailed and compensated based on a feed-in-tariff. However, feed-in-tariffs are highly controversial and many countries wish that renewable energy generators directly participate to the market (Percebois, 2014; Rösner, 2014). We focus on this mechanism in this article.Bought by hydro-power generators and stored in their Energy Transfer by Pumping Stations. Hydro-power generators will re-inject extra supply later into the system in case of peak demand. This mechanism would require to introduce dynamicity in the agents’ decisions and explicitly model the storage capabilities of the hydro-power generators. It is therefore out of the scope of this article.Re-injected into the system. If the ramp down of conventional generators (especially, gas and coal) is not committed in the day ahead (the startup costs being so high that the generators prefer producing power in excess than turning off their units), negative prices might appear. This mechanism is also out of the scope of this article because it would require to explicitly model the unit-commitment and the start-up cost of the conventional generators.We let pfbe the day-ahead price,pi0be market i real-time price andpi0˜<pi0,the compensation price in case of excess wind. We define Ui, as the expected cost at tf, that the supplier has to pay for its end user energy consumption. The supplier is penalized paying the real-time price per missing unit and is compensated on the basis ofpi0˜per wind unit in excess (Pritchard et al., 2010):(1)Ui=qifpf+E[qi0pi0−qi0˜pi0˜]We let Πibe the expected profit at tfof market i conventional energy generator. It is defined as the difference between the price paid by all the markets for the purchase of conventional energy and the cost of the energy. We assume that all the supply is sold at each time. Then:(2)Πi=sifpf−∫0sifcif(s)ds+E[∑j≠i(λi→j0)+pj0]+E[(si0−∑j≠i(λi→j0)+)pi0]−E[∫0si0ci0(s)ds]The renewable wind energy production of market i is a function of the number of wind farms and of their concentration which is characterized by their spatial distribution over market i geographic area. To determine the renewable energy procurement for market i, we use the model of Nair et al. (2014). For market i, we introduce:•αi, the average wind production of a single wind farm over the geographic area of market i.γi, the number of wind farms over market i geographic area.θi∈[12;1](resp.1−θi∈[0;12]), a constant capturing the concentration (resp. the scattering) of the wind farm locations over market i geographic area. The more (resp. the less) concentration, the more (resp. the less) correlation there is between the wind farm productions.We suppose that, at tf, αiis the best forecast of wind energy procurement of a wind farm (Nair et al., 2014). Then:w^i(γi)=αiγi. The forecast error will depend on the wind farm concentration too, and we choose the coefficient θiso thatϵi(γi)=γiθiϵi˜whereϵ˜i,as already introduced, represents the forecast error for the production of a single wind farm. We propose the following interpretation for the scaling of θi: If the wind farms are co-located they will all produce the same quantity of energy at the same time i.e., their productions are strongly correlated. This is the case whenθi=1. This implies in turn that:ϵi=γiϵ˜iand that:w^i=wi+γiϵ˜i. On the contrary, if they are spatially distributed so that their productions are independent from one another i.e., uncorrelated, and under the assumption that the forecast errors are distributed according to Gaussian distribution functions, the Central Limit Theorem tells us that:σiϵ=γiσ˜iϵ(Nair et al., 2014). Therefore, the wind farm productions are independent from one another if, and only if,θi=12.Note that in case of more general forecast error distribution functions, it can be interpreted as an approximation for γilarge enough. Finally, in case whereθi∈]12;1[,the wind farms are randomly located over the market geographic area and their spatial distribution is intermediate between perfect independence and co-location. With these notations, we obtain:wi(γi)=w^i(γi)−ϵi(γi)=αiγi−γiθiϵi˜σiϵ(γi)=γiθiσ˜iϵϵi(γi)=γiθiϵi˜In the rest of the article, for the sake of simplicity, the dependence ofwi,σiϵandϵion γiwill be omitted.In the following sections, we solve the Signaling Game described in Section 2.2 for two Market Designs.In this first Market Design, the prices are supposed exogenous and such that:0<pf<pi0,∀i=1,…,NGoing backward, we start with Step (ii) in the bilevel game described in Section 2.2. Derivating market i generator’s expected profit with respect toλi→j0and assuming thatλi→j0≥0,we obtain:∂Πi∂λi→j0=−pf+aif+bif(d^i−w^i+ri+∑kκi,k−Λi)+pj0−ai0−bi0E[(Δi−ri)++Λi].We will now prove that market i generator’s optimal trades with the other markets is either zero or is reached at the saturation of the equivalent capacities.Reasoning by contradiction, if there exists aλi→j0≥0such that∂Πi∂λi→j0=0,this would mean thatpj0can be expressed exclusively as a function of market i parameters. Suppose that there exists another market k ≠ j and k ≠ i such thatλi→k0≥0,then necessarily,pk0andpj0should coincide. But, by assumption, real-time prices in different geographic demand markets do not coincide. Therefore, if there are more than two geographic demand markets, the maximum of Πiis reached at one boundary i.e., eitherλi→j0=0orλi→j0=κi,j.We now turn to Step (i) in the bilevel game described in Section 2.2. Market i supplier’s expected cost takes the form:Ui=qifpf+E[qi0pi0−qi0˜pi0˜]=(d^i−w^i+ri)pf+pi0E[(Δi−ri)+]−pi0˜E[(Δi−ri)−]We solve Step (i) of the optimization program described in Section 2.2. In Step (i), each market i supplier determines independently and simultaneously the quantity of energy to purchase,qif,or, equivalently, its day-ahead position, ri, so as to minimize its expected procurement cost:(3)minriUiThe decision variable riis in fact defined on a smaller space than the real coordinate space. Indeed, we need to have ri≥ 0 since otherwise this means that a supplier could be short in the day ahead, something that one may find unrealistic given that conventional plants are more expensive in real time.Derivating market i expected cost with respect to ri, we obtain:∂Ui∂ri=(pf−pi0˜)−(pi0−pi0˜)∂∂riE[Δi−ri|{Δi≥ri}]=(pf−pi0˜)−(pi0−pi0˜)F¯Δi(ri).Then:(4)∂Ui∂ri|ri=ri*=0⇔ri*=F¯Δi−1(pf−pi0˜pi0−pi0˜)Since∂2Ui∂ri2=(pi0−pi0˜)fΔi(ri)>0,it coincides with a minimum for Ui. Furthermore, market i’s optimal position being independent of the other markets’ optimal positions, Eq. (4) leads to a unique Nash Equilibrium for the market positions.In the following subsections, we derive analytically the endogenous prices in the day-ahead and in the real-time markets.The global day-ahead market is characterized by the equilibrium between the supply and the demand:qtotf(N)=∑i=1,…,Nqif=∑i=1,…,Nsifwhich is the global quantity of conventional energy exchanged on day-ahead markets. Furthermore, for any market i, we suppose, at t0, that the difference between the supply and the demand for conventional energy in market i coincides with the sum of bilateral trades with the other markets:(5)∑j=1,…,N,j≠iλi→j0=si0−qi0⇔Λi=si0−qi0We make the assumption that the prices pfandpi0paid by market i suppliers for the energy purchased at tfand t0 respectively equal the marginal costs. This assumption is justified in Section 2.3 by the decoupling of the cost functions at the day-ahead and real-time markets and the assumption of perfect competition which holds within each geographic demand market. In two-stage market models, represented by stochastic programming, such an assumption does not hold (Pritchard et al., 2010). There are two major reasons why we do not work with a two stage stochastic program at the generation side. One is the analytical character of our work. Our model assumes suppliers that obey a two-stage optimization paradigm with market power. Adding generators that also solve a two-stage optimization problem and finding the equilibrium between the suppliers and these generators is not amenable to an analytical solution. But, we also believe that this additional technical complexity would bring little in terms of realism in the EU context where the day-ahead market and the balancing are quite different systems that can in no way be modeled or approximated by two-stage stochastic program. The 2013 Survey on Ancillary Services Procurement and Electricity Balancing Market Design by ENTSO-E (Survey on Ancillary Services Procurement & Balancing Market Design, 2014) shows that there is no relation in EU mind between what takes place in the energy market and in balancing. The maps contained in Survey on Ancillary Services Procurement and Balancing Market Design (2014) also show that quite different systems can prevail in neighboring countries that are part of the Market Coupling, with the consequence that it is simply unrealistic to formulate the coupling of the day ahead and real time as a stochastic program. This separation is in fact our justification for our modeling of the system as two separate markets. It implies that:pif=cif(sif)andpi0=ci0(si0). Furthermore, we assume that a clearing price is reached at tfi.e.,pif=pjf≜pf,∀i,j=1,…,N,i≠jmeaning that all the markets are integrated in a single one at that time. Because the transfers are limited by the available transmission capacities, it will be harder to align the market prices at t0: if the markets clear thenpi0=pj0≜p0,∀i,j=1,…,N,i≠j; otherwise there exists at least one marketi∈{1,…,N}in which the supplier payspi0≠pj0forj∈{1,…,N}and j ≠ i. This raises a combinatorial problem since all the possible combinations of split/coupled markets should be included in the model. But, the number of countries involved in the Central Western Europe area is currently limited to 6 (Netherlands, Belgium, France, Luxembourg, Germany and Italy since February 2015). Therefore, the number of combinations of split/coupled markets remains reasonable.We set:Af≜∑i=1,…,Naifbif>0andBf≜∑i=1,…,N1bif>0.Lemma 1The coupling price for the day-ahead market is:pf=∑i=1,…,Nqif+AfBf.Using the assumption of the supply and demand equilibrium guaranteed by the day-ahead market rules, we have:qtotf(N)=∑i=1,…,Nqif=∑i=1,…,Nsif=∑i=1,…,Npif−aifbifundertheassumptionthatpif=cif.=∑i=1,…,Npf−aifbifsincetheNmarketsarecoupledattf.=pf(∑i=1,…,N1bif)−∑i=1,…,NaifbifWe infer from the following equations the day-ahead price on the coupling zone.□We set:Ai0≜ai0bi0>0andBi0≜1bi0>0.As in the proof of Lemma 1, we infer the real-time price on the ith split market.Lemma 2The N markets being split in N geographic areas, at time t0, market i price for the real-time market is:pi0=qi0+Ai0+[∑j=1,…,N,j≠iλi→j0]Bi0.Using the real-time market rules defined through Eq. (5), we have:qi0=si0−∑j=1,…,N,j≠iλi→j0.This implies that:qi0+∑j=1,…,N,j≠iλi→j0=pi01bi0−ai0bi0using the fact thatci0=pi0. Then:pi0=qi0+ai0bi0+[∑j=1,…,N,j≠iλi→j0]1bi0=qi0+Ai0+[∑j=1,…,N,j≠iλi→j0]Bi0by definition ofAi0andBi0.□Day-ahead and real-time prices being now determined analytically, we letr−ibe aN−1dimensional vector containing the day-ahead positions of all the suppliers except market i supplier.Proposition 3The sum of the bilateral trades of market i in the real-time market, Λi, can be expressed as a linear function in ri andr−i.By definition:qif=−∑j≠iλi→jf+sifandpf=aif+bifsif. This implies, in turn, that:∑j≠iλi→jf=qif−sifandsif=pf−aifbif. This implies that:∑j≠iλi→jf=qif−pf−aifbif=qif−∑jqjf+AfBfbif+aifbifusing the definition of pfobtained in Lemma 1. Then, under congestion anticipation:∑j≠iλi→j0=∑j≠iκi,j−∑j≠iλi→jf=∑j≠iκi,j−(qif−∑jqjf+AfBfbif+aifbif)=(1Bfbif−1)(d^i−w^i+ri)+1Bfbif∑j≠i(d^j−w^j+rj)+∑j≠iκi,j−1bif(aif−AfBf).□This means that there exists a linear functionφi:R+N→Rsuch thatΛi=φi(ri,r−i).As a corollary of Proposition 3, we obtain:∂Λi∂ri=∂∂ri(∑j≠iλi→j0)=1Bfbif−1and∂Λi∂rj=1Bfbif,∀j≠i.The Signaling Game assumes that the supplier substitutes the day-ahead and real-time prices with linear functions of riandr−i(this was proved in Proposition 3), and optimizes with respect to ri, givenr−i.Day-ahead positions and bilateral trades cannot be derived analytically since, as we will see, it is intractable to inverse the complementary cumulative distribution functionF¯Δiin the fixed point equation defining the Nash Equilibrium in the day-ahead positions.99Except for simple distribution functions such as the uniform density function.However, we provide conditions guaranteeing the existence and uniqueness of a Nash Equilibrium for the day-ahead positions and detail algorithmically how day-ahead positions and bilateral trades at the optimum should be computed.Assuming that the agents correctly anticipate the congestion of the lines, we observe that the supplies of conventional energy on day-ahead and real-time markets can be expressed as functions of the bilateral trades in real time:sif=∑j≠iλi→jf+qif=(∑j≠iκi,j−Λi)+(d^i−w^i+ri)andsi0=∑j≠iλi→j0+qi0=Λi+(Δi−ri)+.Proposition 4The optimal bilateral trade between market i and any market j ≠ i can be expressed as a linear function in rj,r−j,(E[(Δk−rk)+])k|pi0<pk0andE[(Δj−rj)+].Substitutingsifandsi0described above in the conventional energy generators’ expected profit given in Eq. (2), we obtain:Πi=(d^i−w^i+ri+∑j≠iκi,j−Λi)1Bf(∑j(d^j−w^j+rj)+Af)−aif(d^i−w^i+ri+∑j≠iκi,j−Λi)−bif2(d^i−w^i+ri+∑j≠iκi,j−Λi)2+∑j≠i(λi→j0)+E[(Δj−rj)++Aj0+ΛjBj0]−bi02E[((Δi−ri)++Λi)2]+E[(Δi−ri)+1Bi0((Δi−ri)++Ai0+Λi)]−ai0E[(Δi−ri)++Λi]+E[(Λi−∑j≠i(λi→j0)+)(Δi−ri)++Ai0+ΛiBi0]We suppose that there exists a j in{1,…,N}such thatλi→j0>0(meaning that market i is exporting to market j). We compute the derivative of Πiwith respect toλi→j0:∂Πi∂λi→j0=−∑k(d^k−w^k+rk)+AfBf︸pf+aif+bif(∑k≠iκi,k−Λi+d^i−w^i+ri)︸cif(sif)−1Bj0λi→j0+E[pj0]+1Bi0(Λi−∑k≠i(λi→k)++E[(Δi−ri)+])−ai0−bi0E[(Δi−ri)++Λi]We observe that the first line of the above equation vanishes since, by assumption,pf=cif(sif).Furthermore, sinceE[pj0]=1Bj0E[(Δj−rj)+]+cj0(Λj)and after a few simplifications, we obtain:∂Πi∂λi→j0=−1Bj0λi→j0+1Bj0E[(Δj−rj)+]+cj0(Λj)−ci0(Λi+)−ai0. Then:(6)∂Πi∂λi→j0=0⇔λi→j0=Bj0[cj0(Λj)−ci0(Λi+)]+E[(Δj−rj)+]Summingλi→j0over all the j such thatλi→j0>0i.e.,{j|pi0<pj0},we obtain:Λi+=∑j|pi0<pj0(Bj0[cj0(Λj)−ci0(Λi+)]+E[(Δj−rj)+])Separating the equation inΛi+we obtain:(7)Λi+=11+bi0∑j|pi0<pj0Bj0×{∑j|pi0<pj0(Bjcj0(Λj)+E[(Δj−rj)+])−ai0∑j|pi0<pj0Bj0}By substitution of Eq. (7) in Eq. (6), we obtain:λi→j0=Bj0[cj0(Λj)−ci0(11+bi0∑k|pi0<pk0Bk0{∑k|pi0<pk0(Bkck0(Λk)+E[(Δk−rk)+])−ai0∑k|pi0<pk0Bk0})]+E[(Δj−rj)+]This means thatλi→j0can be expressed exclusively as a linear function of Λj, rj,(E[(Δk−rk)+])k|pi0<pk0andE[(Δj−rj)+]. But, we proved in Proposition 3 that there exists a linear functionφj:R+N→Rsuch thatΛj=φj(rj,r−j). As a result, at the optimum,λi→j0can be expressed as a linear function in rj,r−j,(E[(Δk−rk)+])k|pi0<pk0andE[(Δj−rj)+].□We determined the analytical expressions of the endogenous coupling price for the integrated day-ahead market in Section 4.1 and of the endogenous prices for the split markets in real time in Section 4.2. Substituting these values in the suppliers’ expected costs and using Proposition 3, each market i supplier determines independently and simultaneously the quantity of energy to purchase,qif,or, equivalently, its position, ri, so as to minimize its expected procurement cost, as described in optimization Program 3.Market i supplier determines the best answer,riBA(r−i),which minimizes its expected procurement cost. The decentralized program output is a Nash Equilibrium,(ri*)i=1,…,N,defined by:ri*=riBA(r−i*),∀i=1,…,N.Proposition 5If market i energy balance is high enough (i.e.,Λi>(pi0˜Bi0−Ai0)), there exists a positive Nash Equilibrium solution of Program3. Otherwise, the result still holds provided the standard deviation of Δi is smaller than12π[∑j≠iλi→j0−(pi0˜Bi0−Ai0)12(1Bfbif−3)−2Bi0Bf].It is provided in Appendix A.□Using the methodology described in Proposition 5 proof, market i determines the best answer:ri*=riBA(r−i*)which minimizes its expected cost. Going a step further in the computations detailed in the proof of Proposition 5, we prove that this best answer is obtained as the solution of a fixed point equation:F¯Δi(ri*)=Bi0{Ai0+(1Bfbif−1)(d^i−w^i+pi0˜Bi0+ri*)+1Bfbif∑j≠i(d^j−w^j+rj*)+∑j≠iκi,j−1bif(aif−AfBf)−2ri*}−1[∑j(d^j−w^j)+∑j≠irj*+ri*+AfBf+d^i−w^i+ri*Bf−pi0˜+(1Bfbif+1)σΔiBi02πexp(−(ri*)22σΔi2)].This fixed point equation is solved simultaneously by all markets. Nash Equilibria are obtained at the intersections of the best answers.To show uniqueness of the resulting Nash Equilibrium, we apply the contraction mapping approach. As shown in Bertsekas (1999), it is sufficient to check that the Hessian of the expected cost functions fulfills the diagonal dominance condition i.e.,∑j≠i|∂2Ui∂ri∂rj|<|∂2Ui∂ri2|,∀i=1,…,N.We show, below, that the uniqueness of the Nash Equilibrium heavily relies on the number of geographic demand markets.Proposition 6We assume that market i energy balance is high enough (i.e.,Λi>(pi0˜Bi0−Ai0)). If there are less or exactly three geographic demand markets then there exists a unique Nash Equilibrium solution of Program3.The assumption thatΛi>(pi0˜Bi0−Ai0)guarantees that Proposition 5 holds. Derivating first Uiwith respect to riand then, a second time, with respect to rj, j ≠ i, we obtain:∂2Ui∂ri∂rj=1Bf+bi0bifBfF¯Δi(ri)>0.We remind that, by definition,Bfbif>1,∀i=1,…,N.The assumption thatΛi>(pi0˜Bi0−Ai0)implies, according to Proposition 5:∂2Ui∂ri2−∑j≠i∂2Ui∂ri∂rj=1Bf(3−N)+bi0(3−NbifBf)F¯Δi(ri)+Λi−(pi0˜Bi0−Ai0))Bi0fΔi(ri)>1Bf(3−N)+bi0(3−N)F¯Δi(ri)+Λi−(pi0˜Bi0−Ai0)Bi0fΔi(ri)︸>0,∀i=1,…,N.Then, it is sufficient to have1Bf(3−N)+bi0(3−N)F¯Δi(ri)>0⇔(3−N)[1Bf+bi0F¯Δi(ri)]︸>0>0to guarantee that the diagonal dominance condition holds. We conclude that if N ≤ 3 then diagonal dominance is checked.□We have proved in Propositions 5 and 6 that for less or exactly three geographic demand markets, there exist parameter values guaranteeing the existence of a unique Nash Equilibrium solution of the Signaling Game described in Section 2.2. There is no guarantee about the uniqueness of a Nash Equilibrium for N > 3. From a policy perspective, the existence of multiple Nash Equilibria implies that the outcome of the Market Design cannot be predicted. Computationally, multiple Nash Equilibria imply that the output of the model may depend on the initial conditions of the algorithm.When wind farm investor participates directly in an electricity market i.e., without subsidy-based supporting schemes, it influences the day-ahead positions, by putting wind in the system. In the following section, excess wind is not reimbursed anymore, leading topi0˜=0,∀i=1,…,N. We assume that the investment strategy in renewable capacity is defined over a finite horizon0<T<+∞. In this setting, the Signaling Game described in Section 4.3 is repeated over a finite horizon T.There can be significant year-to-year variations in wind conditions, which would have an impact on profitability, and these may differ between regions (Green & Staffell, 2013). Furthermore, the higher the terrain complexity, the lower the wind predictability. We assume that each market i is clusterized in a subsetCiof clusters where, overc∈Ci,the estimated demandd^i(c)and the wind mean production αi(c) are supposed constant and such that at each time period t:(8)di(c,t)=d^i(c)−νi(c,t)(9)wi(c,t)=w^i(c)−ϵi(c,t)We assume that the geographic market i clusters are defined so that there is no correlation among the cluster forecast errors because correlation among wind farms decreases with the distance (Girard et al., 2013) but that, inside each cluster, there remains a positive correlation between the wind production and the demand forecast error. Making the parallel with the previous notations, we have:di(t)=∑c∈Cidi(c,t)andαi=∑c∈Ciαi(c). Clustering may be performed through one of the automatic partitioning algorithms used in Machine Learning (Kogan, 2007), as illustrated for Germany in Section 6.We let Δi(c, t) be the difference between the wind power supply and the demand forecast errors in market i cluster c, at time period t. Transposing Section 2.3 assumptions to a finer scale (i.e., clusters instead of geographic markets), we assume that(Δi(c,t))c∈Ciis distributed according to a|Ci|-dimensional Gaussian density function centered in the zero|Ci|-dimensional vector and with a diagonal variance–covariance matrix having on its principal diagonal all the variances(σΔi(c))2,∀c∈Ciand zeros everywhere else since the covariance between anyΔi(c,t),Δi(c′,t),∀c,c′∈Ci,c≠c′vanishes. Furthermore, over each clusterc∈Ci,the wind production and the demand forecast errors are correlated due to the assumption that(ϵi˜(c,t)νi(c,t))Tis a Gaussian random vector centered in(00)and of variance–covariance matrix((σ˜iϵ(c))2E[ϵi˜(c,t)νi(c,t)]E[ϵi˜(c,t)νi(c,t)](σiν(c))2).Modern Portfolio Theory is an alternative to the traditional method of analyzing each investment’s individual merits. When investors look at each investment’s individual merits, they are analyzing one investment without worrying about the way the different investments will perform relative to each other. On the other hand, Modern Portfolio Theory places a large emphasis on the correlation between the investments. Markowitz defines as efficient the portfolios which are characterized by a maximum expected revenue for a fixed risk (or, equivalently, for a minimum risk for a fixed expected revenue) (Markowitz, 1952). Risk and volatility are treated as the same thing: Markowitz uses risk as a measurement of the likelihood that an investment still goes up and down in value, and how often and by how much. The theory assumes that investors prefer to minimize risk. The Efficient Frontier, also called the Markowitz Frontier (MF), is then defined as the set of all the portfolios which are efficient. In this article, the supplier applies Modern Portfolio Theory to determine the wind farm portfolio that minimizes its expected investment while minimizing its risk conditionally to the occurrence of rare events (Marling & Emanuelsson, 2012) caused by discrepancies between forecasts and realizations. Note that since wind generator directly participates to the market and excess wind is curtailed, only under-supply is considered as a rare event.In the numerical illustrations we will test two assumptions on the construction cost function for the wind farm portfolio on the clusterc∈Ci: either it is linear in the number of wind farms:Ξ(γi(c))=ξγi(c)or it is quadratic:Ξ(γi(c))=ξγi(c)2with ξ > 0 representing the construction cost for a single wind farm.In this subsection, we characterize analytically the MF in the (γi(c), θi(c)) plane. Theorem 7, described below, states that the optimal concentration of the wind farms θi(c) in clusterc∈Ciis obtained as the unique output of an explicit function of the number of wind farms γi(c), provided γi(c) satisfies the conditions of the second and third equations introduced in the theorem. This is a strong result as we prove that the form of this explicit function is identical for MD 1 and MD 2. It is worth mentioning that Theorem 7 does not define a unique optimal portfolio but, in fact, a multiplicity of solutions.Theorem 7Whatever the Market Design (i.e., two tiered with exogenous prices, two tiered with endogenous prices), the Markowitz Frontier in the(γi(c), θi(c)) plane is completely described by the following set of equations:θi(c)=lnE[ϵi˜(c)νi(c)](σi˜ϵ(c))2lnγi(c)E[ϵi˜(c)νi(c)](σi˜ϵ(c))2≤γi(c)≤(E[ϵi˜(c)νi(c)](σi˜ϵ(c))2)2γi(c)∈N*When optimizing its wind farm portfolio, market i supplier’s problem is to determine the optimal number of wind farmsγi(c)∈N*and their concentration12≤θi(c)≤1,over each clusterc∈Ci,such that its expected investment is minimal and the variance of its investment conditionally to the occurrence of rare events is minimal.MD 1: Over each geographic demand marketi=1,…,N,the supplier investment function is defined as the sum of the cost resulting from its conventional energy demand, repeated T times, and of the cost devoted to the construction of the wind farm portfolio:I(i,T)=∑t(qif(t)pf(t)+qi0(t)p0(t))+∑c∈CiΞ(γi(c))=∑t(∑c∈Ci(d^i(c)−αi(c)γi(c))+ri(t))pf(t)+∑t[(∑c∈Ci(ϵ˜i(c,t)γi(c)θi(c)−νi(c,t))−ri(t))+pi0(t)]+∑c∈CiΞ(γi(c))=∑t(∑c∈Ci(d^i(c)−αi(c)γi(c))+ri(t))pf(t)+∑t(Δi(t)−ri(t))+pi0(t)+∑c∈CiΞ(γi(c))where, we recall:Δi(t)=∑c∈Ci(ϵi(c,t)−νi(c,t))=∑c∈Ci(γi(c)θi(c)ϵi˜(c,t)−νi(c,t)).We obtain quite easily the analytical expression of the variance of Δi:(10)σΔi2=∑c∈CiσΔi2(c)=∑c∈CiVar(ϵi(c)−νi(c))=∑c∈CiVar(γi(c)θi(c)ϵi˜(c)−νi(c))=∑c∈Ci{(σi˜ϵ(c))2γi(c)2θi(c)−2γi(c)θi(c)E[ϵi˜(c)νi(c)]+σiν(c)2}Then, we compute the supplier’s risk i.e., the variance of its investment conditionally to the occurrence of rare events:Var(I(i,T)|{Δi(t)≥ri(t)}t)=Var(∑tΔi(t)pi0(t)−∑t(ri(t)pi0(t)+∑c∈Ci(di^(c)−αi(c)γi(c)+ri(t))pf(t))+∑c∈CiΞ(γi(c))).We note that it is only the first term of this equation that depends on Δi(t). Using properties of the variance operator (i.e., variance of a constant equals zero, variance is a quadratic operator) and the fact that there is no dependence between two time consecutive forecast error differences, we infer that:Var(I(i,T)|{Δi(t)≥ri(t)}t)=∑c∈CiσΔi2(c)∑tpi0(t)2=∑c∈Ci[(σi˜ϵ(c))2γi(c)2θi(c)−2γi(c)θi(c)E[ϵi˜(c)νi(c)]+σiν(c)2]∑tpi0(t)2using Eq. (10). In the rest of the article, we let:RVar(i,T)≜Var(I(i,T)|{Δi(t)≥ri(t)}t)be the risk of market i supplier.The expectation of the supplier’s investment is:E[I(i,T)]=∑t(∑c∈Cid^i(c)+F¯Δi−1(pf(t)pi0(t)))pf(t)−∑t(∑c∈Ciαi(c)γi(c))pf(t)+∑tpi0(t)E[(Δi(t)−F¯Δi−1(pf(t)pi0(t)))+]+∑c∈CiΞ(γi(c))Derivating RVar(i, T) with respect to θi(c) and solving∂RVar(i,T)∂θi(c)=0,we obtain:θi(c)=lnE[ϵi˜(c)νi(c)](σi˜ϵ(c))2lnγi(c).But12≤θi(c)≤1which is equivalent toE[ϵi˜(c)νi(c)](σi˜ϵ(c))2≤γi(c)≤(E[ϵi˜(c)νi(c)](σi˜ϵ(c))2)2.Using the fact thatE[ϵi˜(c)νi(c)](σi˜ϵ(c))2≤γi(c),we check that θi(c) coincides with a minimum for RVar(i, T) indeed:∂2RVar(i,T)∂θi(c)2=2γi(c)θi(c)ln(γi(c))2[2(σi˜ϵ(c))2γi(c)−E[ϵi˜(c)νi(c)]]>0.MD 2: In Eqs. (8) and (9),d^i(c)andw^i(c)do not depend on time. This implies that in the algorithms described in Section 4.3, the optimal positions are also independent on time; contrary to MD 1, where the optimal positions are functions of the day-ahead and real-time price ratio, which is time dependent. Using this observation, we infer that the day-ahead price is time independent; indeed:pf=∑j(dj^−wj^+rj)+AfBf.In case of endogenous prices, market i supplier investment takes the following form:(11)I(i,T)=∑t(∑c∈Ci(d^i(c)−w^i(c))︸d^i−w^i+ri)pf(t)+∑t[(∑c∈Ci(ϵi˜(c,t)γi(c)θi(c)−νi(c,t))︸Δi(t)−ri)+pi0(t)]+∑c∈CiΞ(γi(c))Compared to MD 1, we observe one additional difficulty: at the optimum rirelies onr−iand the bilateral trades rely on the decisions of the other markets.Market i supplier’s risk is similar to the one derived for MD 1:(12)RVar(i,T)=Var(I(i,T)|{Δi(t)≥ri}t)=σΔi2∑tpi0(t)2Therefore, the same result holds about the optimal wind farm concentration. In MD 1 and MD 2, the MF is completely described by the set of equations summarized in the statement of Theorem 7.□The representation of the MF in the(E[I(i,T)],RVar(i,T))plane is not straightforward. Indeed, in case of endogenous prices, the optimal number of wind farms to construct in each cluster cannot be computed analytically. The optimal positions and the optimal bilateral trades can only be obtained algorithmically, as explained in Section 4.3.In each clusterc∈Ci,the supplier can construct a fixed number of wind farms γi(c). For each combination of (γi(c))i, c, we derive the optimal wind farm portfolio concentration (θi(c))i, cusing Theorem 7. We substitute the resulting (γi(c), θi(c))i, cin(σΔi)ias derived in Eq. (10) and in the Nash Equilibrium in the positions and bilateral trades(ri*,Λi*)iobtained through the algorithm detailed in Section 4.3.We substitute(ri*,Λi*)iand (Δi(t))iin the real time price:pi0(t)=Ai0+(Δi(t)−ri*)++Λi*Bi0,∀i=1,…,Nderived in Section 4.2. From this, we can infer the supplier’s risk using Eq. (12).At the same time, we note that the expectation of market i supplier investment can be simplified to give:E[I(i,T)]=TBf(di^−wi^+ri){∑j(dj^−wj^+rj)+Af}+TBi0{Ai0+φi(ri,r−i)}E[(Δi(t)−ri)+]+TBi0E[(Δi(t)−ri)+2]+∑c∈CiΞ(γi(c))where, as detailed in Appendix A:E[(Δi(t)−ri)+]=E[(Δi(t)−ri)|{Δi(t)≥ri}]=σΔi2πexp(−ri22σΔi2)−riF¯Δi(ri)andE[(Δi(t)−ri)+2]=E[(Δi(t)−ri)2|{Δi(t)≥ri}]=σΔi2πΓ(32)Γinc(32,ri22σΔi2)−σΔi2πexp(−ri22σΔi2)+ri2with Γ(a) the Gamma function evaluated ina∈R+andΓinc(a,x)=1Γ(a)∫x+∞ua−1exp(−u)duthe Incomplete Gamma function with lower bound, evaluated ina,x∈R+.In the numerical illustrations, we consider three geographic demand markets: France, Germany and Belgium. Wind farm portfolio optimization is restricted to the French area, since our energy consumption data focus on this country.The marginal cost parameters are based on Chao and Peck’s six node toy network (Chao & Peck, 1998): for France (Fr) we takeaFrf=42.5,aFr0=4250,bFrf=bFr0=0.025; for Germany (Ge) we takeaGef=15,aGe0=1500,bGef=bGe0=0.05and for Belgium (Be)aBef=10,aBe0=1000,bBef=bBe0=0.05.The equivalent interconnection capacities are set so that:κBe,Ge=2(gigawatt),κBe,Fr=6(gigawatt)andκGe,Fr=5(gigawatt).For Germany, our database is made of time series of 75 sensors located all over Germany, providing one year wind speed measures (from 03/19/2013 until 03/18/2014) with one measure per hour (Deutscher Wetterdienst). The exact GPS coordinates of the sensors are depicted by circles in Fig. 2(a). We use two Machine Learning techniques to partition the sensors based on the mean and variance of their wind speed time series: firstly, k-means algorithm clusters data by separating samples in an a priori determined number of groups, minimizing a criterion known as the inertia of the groups. The optimal number of classes for the sensors (4) has been estimated a priori using an unsupervized clustering method known as affinity propagation (Scikit-Learn). Secondly, one-class Support Vector Machine (SVM) can be used as a type of unsupervised learning algorithm, for novelty detection: given a set of samples, it will detect the soft boundary of that set so as to classify new points as belonging to that set or not. Both techniques give identical (or, at least, very close) classes, which are represented in Fig. 2(a) and (b). The convex hull of the sensor classes gives an approximation to the clusters geographic area for Germany.For France and Belgium, we use data provided by the Météociel Platform for the year 2013. Each country is clusterized using one of the automatic partitioning tools, described above for Germany, applied on the historical wind speed measurements. We infer that France (resp. Belgium) can be partitioned in 8 (resp. 2) clusters, as represented in Fig. 2(c) for France. The geographic coordinates of the cluster areas can be found in Biégala and Coulondre (2011). We associate an index with each French cluster area. The wind power production at the various points in the clusters is then inferred from the wind speed measurements using the Betz limit.1010Source for Betz limit: http://www.wind-power-program.com/betz.htm.Finally, over each cluster, the wind power productions are averaged. The mean and standard deviations are then calculated on the basis of each cluster average time series of wind power production. We consider a constant average and standard deviation for wind power production throughout the time horizon. The numerical values of mean consumption and consumption standard deviation per French cluster are detailed in Table 1.Estimated wind production for Germany and Belgium is fixed so that:w^Ge=15(gigawatt)andw^Be=10(gigawatt). The forecast error difference standard deviations are set so that:σΔBe=σΔGe=5(gigawatt).For France, if 10 turbines were placed in each cluster,w^Fr=4.97(gigawatt)and the forecast error difference standard deviation would be:σΔFr=5.79(gigawatt).For estimating the variance associated to the demand forecast, we use a data base containing one year (2013) power measurements (in kW) for each French region, with a granularity of one measure per 30 minutes (French Regional Consumption Data). The French regions are then mapped to the French clusters, as defined in RTE report (Biégala & Coulondre, 2011). Then, over each cluster, we take the average of these time series to obtain one value per day.In Fig. 3, we compare the empirical distribution function of one French cluster (PACA region) energy consumption with the best fit Gaussian density function. This comparison validates our assumptions on demand forecasting, captured in Eq. (8).For France, the end users’ total demand is estimated by:d^Fr=56.173(gigawatt); for Germany and Belgium we fix:d^Ge=d^Be=40(gigawatt).In Fig. 4(a), we plot market i optimal position for the two tiered market with exogenous prices (MD 1) described in Section 3 as a function of the exogenous price ratiopFr0pfand of the forecast error standard deviationσΔFr. In Fig. 4(b), we plot the optimal position for the two tiered market with endogenous prices (MD 2) and positions described in Section 4 as a function of the wind forecastw^Frand of the forecast error standard deviationσΔFr.The endogenous prices corresponding to the interval of variation ofwi^andσΔiare such that pfbelongs to the interval [0; 95; 1.30] and p0 to the interval [3.52; 4.16]. For the exogenous prices, we choosep0=4which is close to the center of the interval of variation of the real-time endogenous price. The day-ahead endogenous price then varies in the interval [0.15; 1.35]. The endogenous and exogenous prices are now in the same range of values. We observe that in case of exogenous prices,p0pfweakly impacts the optimal position whereasσΔiclearly makes the position increase; in case of endogenous prices, bothwi^andσΔimake the position increase. Reciprocally, the increase of the position makesp0pfdecrease in case of endogenous prices whereas it has only a threshold effect in case of exogenous prices.In Fig. 5, we plot the MF for the wind farm portfolio over each French cluster as a function of the number of turbines and of the concentration of the wind farms over the cluster. These plots are issued from the theoretical relation derived in Theorem 7.We assume that the supplier can construct 0, 60 or 120 turbines over each cluster leading to 38 combinations for France. This choice of numerical values is justified by the fact that largest US wind farms nowadays have around 600 turbines1111For example, the Roscoe wind farm in Roscoe, Texas, is one of the world’s largest capacity wind farms with 634 turbines and a total installed capacity of 781.5 magawatt.and by coming down on the scale of France. Assuming that a wind farm counts on the average 60 turbines, the supplier has the choice between constructing 0, 1 or 2 wind farms per cluster. We observe in Fig. 6 that the value of ξ and the form of the investment cost (i.e., linear, quadratic, etc.) deeply influence the MF shape.

@&#CONCLUSIONS@&#
