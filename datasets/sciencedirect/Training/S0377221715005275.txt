@&#MAIN-TITLE@&#
Optimal routing for electric vehicle service systems

@&#HIGHLIGHTS@&#
We consider a general modeling frame’work for electric vehicle service systems.A class of routing policies are shown to maximise the throughput of the system.The perturbed Lyapunov function method is used to show system stability.Simulation is conducted to assess the sojourn-time metrics of the routing policies.

@&#KEYPHRASES@&#
Routing,Electric vehicle system,Maximum throughput,Perturbed Lyapunov function method,Sojourn time,

@&#ABSTRACT@&#
There is increased interest in deploying charging station infrastructure for electric vehicles, due to the increasing adoption of such vehicles to reduce emissions. However, there are a number of key challenges for providing high quality of service to such vehicles, stemming from technological reasons. One of them is due to the relative slow charging times and the other is due to the relative limited battery range. Hence, developing efficient routing strategies of electric vehicles requesting charging to stations that have available charging resources is an important component of the infrastructure. In this work, we propose a queueing modeling framework for the problem at hand and develop such routing strategies that optimise a performance metric related to vehicles’ sojourn time in the system. By incorporating appropriate weights into the well-known dynamic routing discipline “Join-the-Shortest-Queue”, we show that the proposed routing strategies not only do they maximise the queueing system’s throughput, but also significantly mitigate the vehicle’s sojourn time. The strategies are also adaptive in nature and responsive to changes in the speed of charging at the stations, the distribution of the vehicles’ point of origin when requesting service, the traffic congestion level and the vehicle speed; all the above are novel aspects and compatible with the requirements of a modern electric vehicle charging infrastructure.

@&#INTRODUCTION@&#
Over the last few years a strong push is occurring to reduce the use of hydrocarbons in the transportation sector. This trend is supported by the latest advances in battery and power electronics technology, along with government mandates on energy independence and resilience, as well as an increased emphasis on a smarter infrastructure. It is strongly enabled by the introduction of electric vehicles (EVs) and their close relatives Plug-in Hybrid Electric Vehicles (PHEVs) by major car manufacturers that have drastically increased consumer choices.According to a recent report of the International Energy Agency (2012a), the transportation ‘ accounted for 6.7 gigatons of emitted CO2 or 22 percent of the world’s total. Further, global fuel demand for transportation is projected to grow approximately 40 percent by 2035 International Energy Agency (2012b), driven by the rapid adoption of automobiles in the fast growing economies of China, India and more recently in the African continent. EV/PHEVs represent an innovative technology that could help address both environmental concerns and longer term reduce dependence on fossil fuels. However, fast EV adoption relies on a number of socio-economic, as well as technological factors. Key socio-economic factors include stringent emissions regulations, rising fuel prices and financial incentive programs OECD/International Energy Agency (2013), while the most pressing technological one is the large scale deployment of an efficient and well managed charging station infrastructure. At present, there are diverging forecasts on the growth rate of the EV population International Energy Agency (2011), although there is consensus that it is going to represent a sizable portion (at least 7 percent in the US) of the national fleet by 2025–30. Obviously, penetration rates could be significantly higher than these estimates depending on how the aforementioned socio-economic and technological factors evolve. Further, the impact of fast adoption of EVs on utilities and on the stability of the grid is mostly dependent on regional or even local penetration rates; e.g., Southern California Edison has projected a penetration rate larger than 7 percent in its service territory already by 2020.The key concern regarding rapid adoption of EVs by utilities is that they could have a disruptive impact on the power grid, since under Level 1 charging conditions, an EV represents a load equivalent to 50 percent of that of a house, while under Level 2 conditions it represents a 2.5-fold equivalent load. Obviously, the extent of their impact will depend on the degree and local/regional density of their penetration, charging requirements and the time of the day they are charged. However, studies have shown that a fleet of EVs can be effectively powered by the underutilised electric power grid during the off-peak hours with little need to increase the energy delivery capacity of the existing grid infrastructure (Taylor, Maitra, Alexander, Brooks, & Duvall, 2010) if scheduled carefully. Hence, the literature has focused on coming up with efficient schedules of charging EVs overnight, e.g. an incentive based energy consumption controlling scheme was introduced in Caron and Kesidis (2010), and a direct load control (DLC) scheme for residential energy control was discussed in Ruiz, Cobelo, and Oyarzabal (2009); Wu, Wang, and Goel (2010). To achieve a sustainable electrification of the transportation sector, a robust charging station infrastructure needs to be in place that would not interfere with regular grid operations and at the same time address EV driver’s range anxiety resulting from the limited ability to recharge EVs in a time commensurable with filling the tank of a gas-powered vehicle. Specifically, UCLA Smart Grid Energy Research Center argues that if 25 percent of all vehicles were pure EVs, the current US power grid would be challenged in meeting the demand for power. For some utilities, even adding Level-2 charging infrastructure may overload distribution transformers during peak hours. On the driver’s quality-of-service issue, note that charging EVs is an inherently slow process (it takes between 20 minutes to several hours to fully charge them, depending on the technology used (Lukic, Cao, Bansal, Rodriguez, & Emadi, 2008)), thus requiring careful planning and control to accommodate customers.In this study, we focus on the development of efficient routing strategies for a general model of EV charging systems with fully random environments, so as to provide quality service to EV drivers and release their range anxiety. This directly leads to the goal of minimising the strategy’s performance metrics related to “sojourn time” (including EV’s travel time, waiting time for charging, and charging time), which is different from the well-known Vehicle Routing Problem (VRP) (Dantzig & Ramser, 1959; Pillac, Gendreau, Guéret, & Medaglia, 2013) and Dynamic Traveling Repairman Problem (DTRP) (Bertsimas & Ryzin, 1990, 1993) that involve design of vehicle-delivery routes from a depot to a set of scattered demand locations, so as to minimise the overall routing cost (e.g., travel time/distance) under various side constraints (Baldacci, Toth, & Vigo, 2007; Ferrucci, Block, & Gendreau, 2013; Jaillet & Wagner, 2008; Kergosien, Lenté, Piton, & Billaut, 2011; Laporte, 2007, 2009; Li, Mirchandani, & Borenstein, 2009; Pavone, Frazzoli, & Bullo, 2007; Pillac et al., 2013; Solomon, 1987). We assume that service demands are placed by the EV drivers according to a general process, and the distribution of the locations of where EVs originate is arbitrary, although its support is determined by a compact Euclidean service region. There are K charging stations located in the service region, and each of them has a known charging speed (usually in kiloWatt-hours). Upon the request of service, each EV is directed to one of the stations according to some routing policy and heads to the station at a constant speed. After entering the station, EVs queue up to be serviced and their charging times are assumed to be randomly distributed from an arbitrary distribution. We also assume that real-time communication between vehicles and the decision maker is possible (e.g., advanced mobile phones or global positioning systems (GPS) can be integrated into the vehicle devices). These flexible assumptions are suitable for real-life settings, but also require more complicated routing strategies (e.g., dynamic/online routing) for solving the designated optimisation problem.Note that the way we formulate the problem allows us to depict the EV service system as an acyclic network with two layers of feed-forward parallel queues (see Section 2 for details), thus facilitating the development of routing strategies and fundamental analysis regarding throughput and stability. For example, it was shown that the dynamic routing strategy “Join-the-Shortest-Queue” (JSQ) along with a scheduling policy based on “maximal matching” maximises the throughput of a general acyclic network and achieves system stability defined by the uniform mean recurrence time (Hung & Michailidis, 2012). Although the EV system described here has different characteristics (see Section 2 for details), the JSQ strategy appears to retain the property of throughput maximisation (see Section 4 for details). However, to minimise a key performance metric -the vehicle’s sojourn time in the system- the routing strategy must in addition be responsive to other system states and control parameters. In this work, we show that the vehicle’s sojourn time can be significantly mitigated by incorporating the following two factors as “weights” into the JSQ policy: (i) the rate at which vehicles can be charged at the stations and (ii) the distance of the EV to each station upon its service request. Further, its performance is adaptive to the change of several control parameters, such as the speed of charging stations, the distribution of demand locations, the traffic congestion level, and the vehicle speed. It should be noted that the idea to integrate the elements of queue length, service rate and distance to the charging facility in the development of routing strategies for queueing systems has not been proposed in the literature, to the best of our knowledge.The remainder of this paper is organised as follows. Section 2 depicts a general model for the EV service system with fully random environments, characterises the system’s maximum throughput based on the capacity of each service station, and defines system stability via the uniform mean recurrence time property. Section 3 introduces some routing policies, some of which have been used in different settings in the literature, while others have to property of maximising the system’s throughput. The performance of some of these policies is assessed numerically in Section 5. Section 4 establishes that the proposed weighted versions of JSQ policies indeed maximise the system’s throughput under fairly weak stochastic assumptions on the arrival and service (charging) processes. Since appropriate dependence structures are allowed for the arrival, service, and routing processes, a technique called the “perturbed Lyapunov function method” (Hung & Michailidis, 2012; Kushner, 1967) was employed to obtain the result. Section 5 evaluates the proposed throughput-maximising policies in terms of their sojourn-time metrics under various control parameter settings through a simulation study. Some concluding remarks are presented in Section 6.Suppose there are K EV charging stations placed in a compact Euclidean regionR⊂R2,whose locations are denoted byS1,S2,⋯,SK. Service demands for charging are placed by EV drivers at random locations in regionRaccording to a general random process with rate λ, and we assume the demand locations follow an arbitrary distribution F over the regionR. Upon request of service, each EV is guided to one of the charging stations according to some routing policy π and heads to the station, for simplicity, at a constant speed v > 0. Note that the latter assumption is made to simplify the exposition, although in practice v can be a non-decreasing function of λ; e.g. one may imagine that vehicles slow down when the system is heavily loaded. We also assume that assigned EV routes do not change, while the EVs are in route to the assigned station. Finally, to simplify the formulation of the problem, we assume that each charging station comprises of an infinite buffer first-in-first-out (FIFO) queue and a charger with random service times. When the EV is charged (service completed), it leaves the system immediately.Denote the set of EV service demand times byA={a1,a2,…}and the set of times that EVs have finished charging at the station byD={d1,d2,…}. The collection of all event times is then denoted byA∪D={t1,t2,…},where tirepresents either the demand arrival or system departure time. Ifti∈A,then its associated demand location is denoted by li,li∈R. For any routing policy π, the associated routing process is given by(1)Ik(ti)={1ifti∈Aandthevehicleisdirectedtostationk,0otherwise,wherek=1,…,K. Denote the probability that an EV has the service-demand location l and is directed to station k by Pk(l),∑k=1KPk(l)=1. The routing policy π is then associated with K service regionsR1,…,RK,where(2)Rk={l∈R:Pk(l)>0}represents a set of possible locations that the EVs can be directed to station k, and⋃k=1KRk=R. Fig. 1illustrates the locations of three charging stations in a rectangular regionRand their corresponding service regions, whereRi⋂Rj=∅for i ≠ j.Note that given a routing policy π, if there exists at least one location l such that Pk(l) > 0 for each charging station k, the demand for charging stemming from arriving EVs to the system is then divided into K parallel flows passing through, respectively, the K charging stations. At any event timetn+,we denote the total number of EVs in flow k by(3)Qk(tn)=Mk(tn)+Nk(tn),where Mk(tn) represents the number of vehicles heading to, but not yet having reached the station k, and Nk(tn) represents the number of EVs waiting in station k (including the one being served). Based on the above set of notation, the process Qk(tn) evolves according to(4)Qk(tn+1)=Qk(tn)+Ik(tn+1)−Dk(tn+1),whereDk(tn+1)is the number of vehicles that complete service at station k during the time interval(tn,tn+1]. By definition, it is clear thatDk(tn+1)=1iftn+1is the departure time of a vehicle from station k andDk(tn+1)=0otherwise. Let us denote the queue length vectors at timetn+byQ(tn)=(Q1(tn),…,QK(tn)),M(tn)=(M1(tn),…,MK(tn)),andN(tn)=(N1(tn),…,NK(tn)).We now characterise the maximum possible input rate of the service system, so as to keep it stable. First, the input rate of demand for electric charging is defined as(5)λ=limt→∞1t∑i∈Z+1{ti≤tandti∈A},which is based on the property of ergodicity for long-term observation. Second, note that each divided flow k comprises of two queues in tandem, where the lengths of the first-layer (which is actually a virtual queue) and second-layer queues at time tnare Mk(tn) and Nk(tn), respectively. Fig. 2gives a graphical presentation of the system described above. Since there is “no delay” on the service of the vehicles in the first-layer queues (i.e., vehicles head to the designated service stations immediately after the service request), each one of the first-layer queues can be treated as a G/G/∞ (but not necessarily FIFO), with the mean service time (or mean travel time) being defined as(6)∇k=1|Rk|∫l∈Rk∥l−Sk∥vPk(l)dl,where |Rk| is the area of service region Rkand∥l−Sk∥represents the distance between location l and station k. By the above definition, the mean service rate of each first-layer queue is given by(7)Δk=1∇k,k=1,…,K.Third, let σk, jbe the charging time of the jth vehicle arriving at station k. Each one of the second-layer queues is simply a G/G/1, with the mean charging rate being defined as(8)μk=(limn→∞1n∑j=1nσk,j)−1,k=1,…,K.Note that in practice the charging time σk, jdepends on the EV battery capacity, the power consumption determined by the driver, and the output power provided by the charging station. Therefore, μksimply represents the charging speed of station k (e.g. a DC Quick Charger can offer more than 50 kiloWatt-hours output). Finally, let(9)rk=limn→∞∑i=1nIk(ti)∑i=1n∑k=1KIk(ti),which is the long-term proportion of the input traffic flow directed to station k. It is clear that 0 ≤ rk≤ 1 for allk=1,…,K,and∑k=1Krk=1. Since all input traffic can go unimpeded through the first-layer queues, the following conditions on the second-layer queues are necessary to stabilise the system:(10)rkλ<μkforallk=1,…,K.Since∑k=1Krk=1and 0 ≤ rk≤ 1 for allk=1,…,K,the conditions in (10) directly introduce an upper bound on the input rate, say,λ<μ1+⋯+μK. The quantityμ1+⋯+μKis known as the maximum throughput of the system in the queueing literature.The first step here is to develop a routing policy so that system stability can be established for any input rateλ<μ1+⋯+μKunder fairly mild assumptions. Since no strong assumptions are made for all the involved stochastic processes, the stability is defined via the “uniform mean recurrence time” property (Hung & Michailidis, 2012; Kushner, 1967). That is, the system is said to be stable if there exists some positive integer b0 and nonnegative real-valued function F( · ) such that for any n ands=min{t≥tn:|Q(tn)|≤b0}(11)En[s−tn]≤F(Q(tn))when|Q(tn)|≥b0.Here Endenotes the expected value conditioned on the σ-field that contains all system information up to time tn, and|Q(t)|=∑k=1KQk(t). This definition indicates that when |Q(t)| reaches a level bn> b0, the conditional expectation of the time required to return to the value b0 (or smaller) is bounded above by a function of bn, uniformly in n and in the past history. It should be noted that, stability defined in (11) directly implies thatP(Qk(t)<∞)=1for all t and k (i.e. weak stability) andlim inft→∞Qk(t)/t=0almost surely for all k (i.e. rate stability). A routing policy that satisfies the rate stability for all input ratesλ<μ1+⋯+μKis called the maximum throughput policy.We next introduce selected routing policies, some of which are popular in the literature, while others can potentially maximise the throughput of the system.The key objective of this policy is simple and straightforward - direct EVs to the nearest station upon their demand for service (Solomon, 1987). The associated routing processes are then given by(12)Ik(ti)={1ifti∈Aandk=argminj=1,…,K∥li−Sj∥,0otherwise,k=1,…,K. Note that under π1, the service regions satisfy thatRi⋂Rj=∅for all i ≠ j and⋃k=1KRk=R(please see Fig. 1 for an example). This also implies that for eachk∈{1,…,K},Pk(l)={1ifl∈Rk,0otherwise.If the distribution of originating demand locations is uniform overR,then we haverk=limn→∞∑i=1nIk(ti)∑i=1n∑k=1KIk(ti)=|Rk||R|,which are constant values. Thus, π1 is obviously not a maximum throughput policy.This policy directs EVs to the stations in turn upon their demand for service (Knust & Lücking, 2009; Wu & Down, 2009). The associated routing processes are then given by(13)Ik(ti)={1ifti=ajforsomej≤iandj=k(modK),0otherwise,k=1,…,K. Note that under π2, the service regions satisfy thatRk=Rfor allk=1,…,K. Also, π2 is not a maximum throughput policy sincerk=1Kfor all k.This policy directs each EV to the station having the largest service/charging rate upon its demand for service (Baras, Dorsey, & Makowski, 1985; Buyokkoc, Varaiya, & Walrand, 1985). The associated routing processes are then given by(14)Ik(ti)={1ifti∈Aandk=argmaxj=1,…,Kμj,0otherwise,k=1,…,K. Note that under π3, the service regions satisfy thatRk=RandRj=∅for all j ≠ k. Since nowrk=1andrj=0for all j ≠ k, the maximum throughput is simply μk. Thus, π3 is obviously not a maximum throughput policy.Let us consider the inequalities shown in (10), given the constraints that 0 ≤ rk≤ 1 for allk=1,…,Kand∑k=1Krk=1. For anyλ<μ1+⋯+μK,it is clear that there exists at least one solution (in fact, infinitely many)(r¯1,…,r¯K)such that(15)r¯kλ<μkforallk=1,…,K,where0≤r¯k≤1for allk=1,…,Kand∑k=1Kr¯k=1. For example, one can always chooser¯k=(μk/∑k=1Kμk)for allk=1,…,K. Therefore, if the input rate λ is known, each possible solution(r¯1,…,r¯K)then constitutes a policy associated with the routing processes, say, ifti∈A,(16)Ik(ti)=1withprobabilityr¯k,k=1,…,K; andIk(ti)=0otherwise. Based on the policy, each vehicle is directed randomly to a station based on the associated probabilitiesr¯1,…,r¯Kupon the demand of service (this is known as a static problem, see (Bertsimas & Simchi-Levi, 1996; Gendreau, Laporte &  Séguin, 1999) for examples). Thus, ifr¯k≠0for all k, then the service regions satisfy thatRk=Rfor allk=1,…,K. Although π4 appears to be throughput maximising, it is not practical from the following perspectives: (i) the information of the input rate λ is required so as to solver¯k; (ii) the solution of(r¯1,…,r¯K)is not unique; and (iii) it may result in bad performance with respect to delay or sojourn time metrics (see Section 5 for examples).This policy directs EVs to the station having the smallest weighted queue length upon their demand for service. The associated routing processes for this policy are given by(17)Ik(ti)={1ifti∈Aandk=argminj=1,…,K{wjQj(ti−1)},0otherwise,where wj> 0 is an arbitrarily weight chosen by the designer,k=1,…,K.Note that π5 can be viewed as the converse of the “maximal matching” discipline in the queueing literature (Armony & Bambos, 2003; Hung & Michailidis, 2012, 2008; Mekkittikul & McKeown, 1996) and many of the existing policies can be included under this framework. For example, if wjare the same for all j, then π5 reduces to the standard JSQ policy; if Qj(ti) are the same for allj=1,…,Kat time tiandwj=1μj,then π5 is equivalent to π3; if Qj(ti) are the same for allj=1,…,Kat time tiandwj=∥li−Sj∥,then π5 is equivalent to π1. However, the choice of wjwill not affect the system’s throughput and stability (see Section 4 for details).It is also worth noting that π4 and π5 are both maximum throughput policies. However, due to the shortcomings of π4 mentioned earlier, the theoretic aspects of system stability will be investigated by utilising merely π5 in the remainder of this work.We first show that policy π5 maximises the system’s throughput and achieves the stability defined in (11). Suppose relaxed assumptions such as correlated vehicle arrival times, correlated vehicle service times, and interdependent routing processes are made. These assumptions then lead to non-Markovian dynamics for the arrival and service processes of the system, for which a more general framework provided by the perturbed Lyapunov function method (Hung & Michailidis, 2012; Kushner, 1967) will be used. Note that to utilise the perturbed Lyapunov function method, one usually starts with a standard Lyapunov function V(Q(tn)) and then incorporates a perturbation term δV(tn) into V(Q(tn)). By placing a reasonable bound on δV(tn),V(Q(tn))+δV(tn)can then be used to show the desired system stability.The following assumptions are needed to establish the stability result.Assumption 1There exists a nonnegative bounded function ρ(m), which goes to zero as m → ∞, such that(18)En|1{tm+1∈A}En[tm+1−tm]−λ|≤ρ(m−n)form≥n.This assumption states that given all system information up to time tn, the conditional arrival rate converges to its long-term arrival rate asm−n→∞. It corresponds to a general condition on the arrival process, for which interdependence (whatever its nature may be) between arrival/inter-arrival times is allowed. When the future becomes less and less predictable, it is assumed that the conditional likelihood of such interdependence gets weaker.By (18), it is clear thatEn[tm+1−tm]is bounded below by a positive constant h0 for all m ≥ n. In addition, it is natural to assume thatEn[am+1−am](recall thatam+1−amis the(m+1)th inter-arrival time) is bounded above by a positive constant h1 for all m ≥ n. These together imply(19)h0≤En[tm+1−tm]≤h1form≥n.(20)En|λ{Ik(tm+1)−rk}|≤ρ(m−n)forallkandm≥n.This assumption states that given all system information up to time tn, upon the request of service, the conditional likelihood that a vehicle will be directed to station k converges to its long-term proportion asm−n→∞. Note that this assumption also incorporates the interdependence structure of each routing process.(21)En|Ik(tm+1)En[tm+1−tm]−rkλ|≤ρ(m−n)forallkandm≥n.This is basically a combination of Assumptions 1 and 2. Moreover, it allows the existence of a cross-dependence structure between the routing process and the arrival process. When the future becomes less and less predictable, it is assumed that the conditional cross-dependence gets weaker.(22)En|Dk(tm+1)En[tm+1−tm]−μk|≤ρ(m−n)forallkandm≥n.This assumption states equivalently that given all system information up to time tn, the mean service rate of each station over the time interval(tm,tm+1]converges to its long-term rate asm−n→∞. It corresponds to a general condition on each service process, for which interdependence between service times is allowed.We define first the individual “routing” Lyapunov function perturbation for each routing processδVkr(tn)=−2wkQk(tn)∑m=nn+N−1En[tm+1−tm]En[λ{Ik(tm+1)−rk}],where the value of N will be chosen in the proof shown later. We define next the “combined” Lyapunov function perturbation for each traffic flowδVkc(tn)=2wkQk(tn)∑m=nn+N−1En[tm+1−tm]En[Ik(tm+1)En[tm+1−tm]−rkλ].We define last the “departure” Lyapunov function perturbation for each traffic flowδVkd(tn)=−2wkQk(tn)∑m=nn+N−1En[tm+1−tm]En[Dk(tm+1)En[tm+1−tm]−μk].The full Lyapunov function perturbation δV(tn) is given byδV(tn)=∑k=1KδVkr(tn)+∑k=1KδVkc(tn)+∑k=1KδVkd(tn).Suppose the standard Lyapunov function is chosen asV(Q(tn))=∑k=1KwkQk2(tn)and the time-dependent Lyapunov function is given byV˜(Q(tn))=V(Q(tn))+δV(tn),we then have:Theorem 1UnderAssumptions 1-4, π5maximises the system’s throughput and achieves the stability defined in (11).The proof is sketched in the Appendix.□In this section, we evaluate the performance of the introduced maximal throughput policies in terms of the sojourn-time metrics via computer simulation. Note that the sojourn time in this setting corresponds to the amount of time that an EV spends in the system, which by definition includes its travel time (to the station), waiting time (for charging), and charging time. The core of the simulator was written in C++, while the simulation setup is described as follows.Let us consider a square regionR=[0,30]×[0,30]with three EV charging stations located in the vertices of an equilateral triangle, say,S1=(5,15−53),S2=(25,15−53)andS3=(15,15+53). A graphical representation of the service system is given in Fig. 3. To reduce the number of control parameters that will influence the sojourn time performance, here we assume the inter-arrival times between service demands and the charging times at each station are independent and exponentially distributed. The service rates at three charging stations are given byμ1=2,μ2=3andμ3=6(e.g. assume there are one Slow charger, one Rapid AC charger, and one Rapid DC charger), which induce the maximal system throughputμ1+μ2+μ3=11. The system is then simulated with the Poisson arrival process of ratesλ=6,7,8,9,10and 10.9 under various EV speedsv=0.1,0.5,2,5and 10. Except for the numerical results provided in Section 5.3.3, we also assume the service-demand locations are independent and uniformly distributed over the squareR,viz., F is a uniform distribution on [0, 30] × [0, 30]. Note that these setups can be easily calibrated so that practical situations can be met.For comparison purposes, the mean and 95th percentile (P95) vehicle sojourn time were recorded based on 2 × 105 collected events (the first 105 events obtained from the warm-up period were excluded) under policies (i) π4 with(r¯1,r¯2,r¯3)=(2/11,3/11,6/11)(Random Routing policy, abbreviated as RR); (ii) π5 with wj≡ 1 (i.e., the JSQ policy); (iii) π5 withwj=1μj(Join-the-Weighted-Shortest-Queue policy, abbreviated as JWSQ); and (iv) π5 withwj=∥li−Sj∥μj(Join-the-Doubly-Weighted-Shortest-Queue policy, abbreviated as JDWSQ). Note that wjassociated with the JDWSQ policy clearly represents a random process (not just a constant). However, the policy becomes more flexible by taking into account “the distance from the demand location to each service station”. The numerical results show that the sojourn time can be mitigated with respect to a large class of control parameters based on such a routing scheme.The mean sojourn times under the four policies RR, JSQ, JWSQ, and JDWSQ, for various choices of the input rate λ and EV speed v, are depicted in Fig. 4. As can be seen, the JDWSQ policy outperforms the other three policies for most of the simulation scenarios. An exception is found in the case that system is heavily loaded (λ=10.9) and EV speed is relatively low (v=0.5), for which the JWSQ policy appears to perform best in minimising the mean sojourn time. Note that as the EV speed increases, the difference between policies JWSQ and JDWSQ becomes less significant. Such a phenomenon will be further discussed in Section 5.3.1.The 95th percentile of the distribution of sojourn times under the four policies RR, JSQ, JWSQ, and JDWSQ, for various choices of the input rate λ and EV speed v, are depicted in Fig. 5. As can be seen, the JDWSQ policy performs best for various choices of EV speed when the system is lightly or moderately loaded. On the other hand, the JWSQ performs best for various choices of EV speed when the system is more heavily loaded. The results may come from the intuition that, when the EV speeds are slow, the JDWSQ policy would be largely affected by the “demand locations” generated by the underlying random mechanism, thus increasing the variation of the resulting sojourn time. Analogously, the difference between policies JWSQ and JDWSQ becomes less significant as the EV speed increases.The sojourn time performance is of particular interest in practice when the system is heavily loaded (i.e., λ is large). This usually coincides with a higher traffic congestion level and results in slower EV speeds (i.e., smaller values of v), as mentioned earlier in Section 2. In this section we introduce how to modify the JDWSQ policy so that the sojourn time metrics can be further mitigated when λ is large. We also show that the performance of the distance-based policies is fairly robust to a number of control parameters, such as the input rate λ, the EV speed v, the service rates μk, and the distribution F of demand locations.As can be seen from the numerical results in Section 5.1, the JDWSQ policy is not optimal in minimising the mean sojourn time when λ is large and v is small. Next, we provide insights on why policy JDWSQ may not be optimal for this metric in such a setting. Suppose there is a 2-station service system withμ=(6,2),Q1(tn−1)=10,andQ2(tn−1)=11. Assume that a service demand is placed at time tnwith the associated location lisuch that∥li−S1∥=30and∥li−S2∥=10. It is clear that policy JDWSQ will direct the vehicle to S1. Consider the scenario that the 10 vehicles on the first flow are all ahead of the current arriving vehicle (i.e., liis the farthest from S1 compared to other vehicle locations on the first flow) and the 11 vehicles on the second flow are all behind the current arriving vehicle (i.e., liis the closet to S2 compared to other vehicle locations on the second flow). Since v is small, it is expected that relatively few vehicles are waiting in both service stations most of the time. In this case, directing the arriving vehicle to S2 (though it has a smaller service rate) might be a better choice since its location is much closer to S2 and there are no vehicles ahead (thus has a shorter waiting time for service). The above example suggests that, instead of looking at all the vehicles on each flow, in the policy one may consider the number of vehicles “ahead of the arriving vehicle”. Therefore, the routing process associated with the JDWSQ policy can be justified by(23)Ik(ti)={1ifti∈Aandk=argminj=1,…,K{∥li−Sj∥μjHj(ti)},0otherwise,where Hj(ti) represents the number of vehicles ahead of the arriving vehicle at time tion the j-th flow. Note that by replacingQj(ti−1)by Hj(ti) in the routing process, the JSQ and JWSQ policy can be modified in a similar way. We next evaluate the performance of these modified policies under the heavy traffic assumption.Let us consider the same service system as in Sections 5.1 and 5.2 withλ=10.9(recall that the maximum throughput is 11). Tables 1and 2show the mean and 95th percentile sojourn times under policies JSQ, JWSQ, JDWSQ and their modifications based on Hj(ti) (denoted by JSQ*, JWSQ*, and JDWSQ*), with various choices of EV speed v. As can be seen, the modified version of the JDWSQ policy (i.e., the JDWSQ* policy) improves both the sojourn time metrics when the EV speeds are slow (i.e.,v=0.1and 0.5), while policies JSQ and JWSQ do not benefit from such modifications for most of the cases. It should also be noted that, though the distance-based policies (i.e., JDWSQ and JDWSQ*) are suboptimal in minimising the 95th percentile sojourn time (see Table 2), numerical results show that they remain fairly competitive (compared to policy JWSQ) under this particular simulation setup.In this section, we show that the proposed distance-based policies also work well for a system comprising of homogeneous charging stations. Consider the same service system as in Sections 5.1–5.3 withμ=(4,4,4),viz., the speeds of three charging stations are all the same. In this case, the two policies JSQ and JWSQ are obviously identical. Table 3shows the mean and 95th percentile sojourn times under policies JSQ/JWSQ, JDWSQ, and JDWSQ* with a heavily loaded input rateλ=11.9(the maximum throughput is 12) and various EV speedsv=0.1, 0.5, 2, 10. As can be seen from Table 3, the JDWSQ policy outperforms the JSQ/JWSQ policy in terms of both the mean and 95th percentile sojourn time for all EV speeds considered in this study. The numerical results strongly support that incorporating “distance” as another weight in the policy is beneficial for such systems. However, numerical results show that both the mean and 95th percentile sojourn time are not further improved by the JDWSQ* policy.In this section, we show that the distance-based policies also work well for the system with non-uniform demand locations. Let us consider the same service system in Sections 5.1–5.2 withλ=10.9,and the distribution F of demand locations is a mixture of three uniform distributions over the rectangular regions R1 (with vertices (0, 0), (30, 0), (30, 5) and (0, 5)), R2 (with vertices (0, 5), (30, 5), (30, 10) and (0, 10)), and R3 (with vertices (0, 10), (30, 10), (30, 30) and (0, 30)). Assume that the associated weights of the three uniform distributions are given byw1=1/10,w2=1/2,andw3=2/5,respectively. This then constitutes a system with half of the service demands uniformly located over R2 (image that this is a street with extremely heavy traffic) and another half of the service demands uniformly located over R1 and R3. Fig. 6illustrates 2 × 103 demand locations that were obtained by simulating the designated mixture distribution F over the service regionR.Tables 4and 5show the mean and 95th percentile sojourn times under policies JSQ, JWSQ, JDWSQ and their modifications JSQ*, JWSQ*, JDWSQ* with various EV speeds. As can be seen, for this particular case policy JDWSQ* outperforms all the other policies in terms of both sojourn time metrics. As the EV speed becomes slower, numerical results show that the improvement in both sojourn time metrics becomes more significant.We have introduced a general modeling framework for EV service systems and established that a class of dynamic routing policies maximises the throughput and maintains system stability defined via the uniform mean recurrence time under fairly weak stochastic assumptions. As the dependence structure is appropriately incorporated into the vehicle arrival, service, and routing processes, the theoretical results are established via a technique called the perturbed Lyapunov function method. Simulation results show that the proposed weighted versions of the JSQ policy, titled JWSQ, JDWSQ and JDWSQ*, outperform the existing policies in terms of both the mean and P95 of sojourn time for almost all the simulation scenarios. In addition, the performance is adaptive to the change of (i) input load λ (or traffic congestion level); (ii) EV speed v; (iii) service rates μk; and (iv) distribution F of demand locations. It is noted that for such service systems there always exist a number of control parameters that will influence the performance measures of interest. Therefore, it would be valuable to explore the optimisation problems with respect to other control parameters, e.g. how to best allocate the charging stations so as to minimise the vehicle’s mean sojourn time. Nevertheless, finding the solutions for this type of optimisation problems appears to be a challenging and involved task, and hence a topic for future work.The authors would like to thank the Editor and two anonymous referees for their valuable comments and suggestions that help improve this manuscript. The work of George Michailidis was supported in part by NSF grants CNS 1422078 and CCF 1442493.For any given input rateλ<μ1+⋯+μK,we will show that there exists a constant c > 0 such thatEn[V˜(Q(tn+1))−V˜(Q(tn))]≤−cwhen |Q(tn)| is large enough. This inequality together with the bound on δV(tn) will then imply (11). Note that(24)En[V˜(Q(tn+1))−V˜(Q(tn))]=En[V(Q(tn+1))−V(Q(tn))]+∑k=1KEn[δVkr(tn+1)−δVkr(tn)]+∑k=1KEn[δVkc(tn+1)−δVkc(tn)]+∑k=1KEn[δVkd(tn+1)−δVkd(tn)],and we will examine it term by term. By mimicking the proof provided in Hung and Michailidis (2012), we can show(25)En[V(Q(tn+1))−V(Q(tn))]≤2∑k=1KwkQk(tn){Ik(tn+1)−En[Dk(tn+1)]}+G,whereG=∑k=1Kwk;(26)En[δVkr(tn+1)−δVkr(tn)]≤2wkQk(tn)En[tn+1−tn]{Ik(tn+1)λ−rkλ}+2h1wkQk(tn)ρ(N)+Ckrfor some constantCkr>0;(27)En[δVkc(tn+1)−δVkc(tn)]≤−2wkQk(tn){Ik(tn+1)−rkλEn[tn+1−tn]}+2h1wkQk(tn)ρ(N)+Ckcfor some constantCkc>0; and also(28)En[δVkd(tn+1)−δVkd(tn)]≤2wkQk(tn){En[Dk(tn+1)]−μkEn[tn+1−tn]}+2h1wkQk(tn)ρ(N)+Ckdfor some constantCkd>0.Taking the full Lyapunov function perturbation based on (26)-(28) along with the bound given in (25), we have(29)En[V˜(Q(tn+1))−V˜(Q(tn))]≤2En[tn+1−tn]∑k=1KwkQk(tn)[Ik(tn+1)λ−μk]+ɛ′=2En[tn+1−tn](∑k=1KλwkQk(tn)Ik(tn+1)−∑k=1KμkwkQk(tn))+ɛ′,where ε′ is bounded above by(30)6h1ρ(N)∑k=1KwkQk(tn)+∑k=1K(Ckr+Ckc+Ckd)+G.Recall that for any givenλ<μ1+⋯+μK,there always existr¯1,…,r¯Ksuch thatr¯kλ<μkfor allk=1,…,K,where0≤r¯k≤1for all k and∑k=1Kr¯k=1. This means that there exists some constant c0 > 0 such thatr¯kλ−μk≤−c0for allk=1,…,K. Our proof proceeds by discussing two different cases:tn+1∈Aandtn+1∉A. Suppose nowtn+1∈Aandj=argmink=1,…,K{wkQk(tn)},thenIj(tn+1)=1andIi(tn+1)=0for i ≠ j. Thus, we have(31)En[V˜(Q(tn+1))−V˜(Q(tn))]≤2En[tn+1−tn]((∑k=1Kr¯k)λwjQj(tn)−∑k=1KμkwkQk(tn))+ɛ′≤2En[tn+1−tn](∑k=1Kr¯kλwkQk(tn)−∑k=1KμkwkQk(tn))+ɛ′=2En[tn+1−tn]∑k=1K(r¯kλ−μk)wkQk(tn)+ɛ′≤−2c0h0∑k=1KwkQk(tn)+ɛ′.Note that given |Q(tn)| > b for some positive constant b, we can always choose a large value of N in (30) so that6h1ρ(N)∑k=1KwkQk(tn)≤c0h0∑k=1KwkQk(tn).Therefore, (31) can be expressed as(32)En[V˜(Q(tn+1))−V˜(Q(tn))]≤−c0h0∑k=1KwkQk(tn)+C,whereC=∑k=1K(Ckr+Ckc+Ckd)+G>0. Eq. (32) directly impliesEn[V˜(Q(tn+1))−V˜(Q(tn))]→−∞as|Q(tn)|→∞.Thus, there exist c > 0 and b* > 0 such that(33)En[V˜(Q(tn+1))−V˜(Q(tn))]≤−cwhen|Q(tn)|>b*.Since we know that|δV(tn)|=O(|Q(tn)|),given a small γ > 0, this implies that for sufficiently large value of b*,|δV(tn)|=|V(Q(tn))−V˜(Q(tn))|≤γ·V(Q(tn)). Let tnbe such that |Q(tn)| > b* andτ=min{i>n:|Q(ti)|≤b*}. By (33), we then haveEn[V˜(Q(tτ))−V˜(Q(tn))]≤−cEn[τ−n].Thus,(1−γ)En[V(Q(tτ))]≤En[V˜(Q(tτ))]≤−cEn[τ−n]+V(Q(tn))(1+γ)≤−ch1En[tτ−tn]+V(Q(tn))(1+γ),where the last inequality comes from−cEn[tτ−tn]=−c{En[tn+1−tn]+En[tn+2−tn+1]+⋯+En[tτ−tτ−1]}≥−ch1En[τ−n].Thus,En[tτ−tn]≤h1c{V(Q(tn))(1+γ)−1+γEn[V(Q(tτ))]}.SinceV(Q(tτ))≤sup|Q(ti)|≤b*V(Q(ti)),this then implies the stability defined in (11). For the second case thattn+1∉A,we haveIk(tn+1)=0for allk=1,…,K. Thus, analogous to (31), we simply obtain(34)En[V˜(Q(tn+1))−V˜(Q(tn))]≤−2h0∑k=1KμkwkQk(tn)+ɛ′.Since the stability defined in (11) can be shown in a similar way, the proof is then complete.

@&#CONCLUSIONS@&#
