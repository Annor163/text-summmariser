@&#MAIN-TITLE@&#
Cluster analysis of CCA coefficients for robust detection of the asynchronous SSVEPs in brain–computer interfaces

@&#HIGHLIGHTS@&#
We propose a new method of SSVEP detection in multichannel, asynchronous BCIs.It is compared with three competitive spatial filtering and detection techniques.The methods are evaluated with the use of EEG signals measured for 21 subjects.The results show significant improvement of the ITR for a large group of users.Only a short calibration session is required to operate the interface.

@&#KEYPHRASES@&#
Brain–computer interface (BCI),Multiple channel electroencephalogram (EEG),Spatial filtering,Detection of steady-state visual evoked potentials (SSVEPs),

@&#ABSTRACT@&#
In this paper, a method for detection of steady-state visual evoked potentials in a non-invasive, multiple channel, asynchronous brain–computer interface is proposed. It is based on the canonical correlation analysis spatial filter for identifying optimal weighted combinations of electrode signals, followed by a cluster analysis of its coefficients for a fast and accurate SSVEP detection. High information transfer rates can be achieved after a short calibration session. The proposed algorithm, a standard spectrum analysis approach, and two competitive spatial filtering and detection methods were evaluated in a series of experiments with the use of data from 21 subjects. The obtained results showed a significant improvement in classification accuracy and in an average detection time for a large group of users.

@&#INTRODUCTION@&#
Brain–computer interfaces, communication systems independent from the brains regular output pathways of peripheral nerves and muscles [1] may enable people with disabilities, including paralyzed people to use the computer and other technical equipment, on a par with other users. Studies on the development of the BCI devices have more than 20-year history. The most widely represented group of devices are non-invasive BCI systems with electroencephalographic (EEG) brain activity monitoring, a few recent examples can be found in Refs. [2–4]. The most commonly used EEG-based BCI systems employ an event-related synchronization of μ and β rhythms (ERD/ERS), event-related potentials (ERP) and steady-state visual evoked potentials (SSVEP).Majority of laboratories and research groups use information transfer rate (ITR, introduced in Ref. [5]) to evaluate and compare BCI systems performance. This measure depends on three factors: number of targets (must be sufficient for a particular interfacing task), detection speed, and accuracy. Therefore, all of them are essential for making a BCI system a practical device. Currently, it is assumed that the fastest, the most reliable and promising communication paradigm for the implementation of a non-invasive BCI system is the SSVEP approach [6].There is a number of signal processing methods for detection and extraction of SSVEPs. The most widely used is a classical spectrum analysis method [7,8]. It examines EEG data measured in a single or a bipolar channel. Its recent modification allows finding the best bipolar combination of measurement channels. This combination cancels out unstimulated brain activity either by employing independent component analysis (ICA) to decompose EEG channels [9] or by analyzing all possible combinations in parallel and selecting the best ones afterwards (BBC method). The latest, multichannel spatial filtering and detection methods include canonical correlation analysis (CCA [10]), minimum energy combination (MEC [11]) and maximum contrast combination (MCC [11]).The paper presents a novel approach to multichannel detection of SSVEP responses. It uses CCA-based spatial filtering for identifying optimal weighted combinations of electrode signals, followed by a cluster analysis of CCA coefficients for a fast and accurate SSVEP detection. The method, named cluster analysis of canonical correlation coefficients (CACC), has been implemented in an offline brain–computer interface. The system after a short calibration session is able to work asynchronously with an improved detection speed and accuracy, providing higher information transfer rate, in comparison to a classical spectrum analysis, CCA, MEC, and MCC method.In this section, the proposed SSVEPs detection method is discussed. It is based on the coefficients derived by means of canonical correlation analysis, which was first used for SSVEP detection in Ref. [10] and was further developed in Ref. [12].Suppose a user of a SSVEP-based BCI focuses their sight on a target which is a light source flickering with a fixed frequency fi, i=1, 2, …, Nf. The user vision system is then stimulated by a periodic light source in such an interface. Each of the stimulus frequencyfi(i.e.f1,f2,…,fNf), corresponds to a different interface command Qi, respectively. The electrical brain activity of the user is monitored by measuring the EEG signal in Nychannels (Fig. 1). It is expected that there are stimulus-frequency-related signal components present in the brain responses [13]. A detection of the strongest electrical activity at a frequency fiis interpreted as a user intention of selecting the corresponding command Qi.Due to the user diversity effects [14], the strongest brain response may be a mixture of stimulation fundamental and harmonic-frequency signal components, dispersed over the multichannel recordings. In the CCA approach to identification and quantification of this response, a linear combination is defined as S=wTY of the recorded multichannel EEG signals and a linear combination U=vTX of the possible EEG patterns, Y=(y1, …, yn) and X=(y1, …, ym) (Fig. 1). The CCA method is aimed at finding vectors w and v, such that the correlation(1)ρ=cos(S,U)between S=wTY and U=vTX is maximized. S and U are called canonical variables.The problem of maximization of (1) was discussed in Ref. [15]. It was shown that there are several possible solutions to this problem, respectively related to eigenvalues and eigenvectors of the productCss−1CsuCuu−1Cus, where Css, Cuu are within-set and Csu, Cus are between-set covariance matrices. The largest correlation coefficient ρ1 corresponds to the largest eigenvalue and respective eigenvectors w1 and v1. In fact, eigenvalues are squared correlation coefficients. Consecutive canonical variablesSj=wjTY,Uj=vjTXand respective canonical correlation coefficients ρjcan be obtained for eigenvalues of decreasing values. The maximum number of correlation coefficients ρjis equal to the number of variables in the smallest of two sets, j=1, 2, …, Nz=min(n, m). The canonical variables of different solutions are uncorrelated.When the CCA method is used for SSVEP detection,Y=(y1,…,yNy)refers to the set of Nymultichannel EEG measurement data andX=(x1,…,x2Nh)refers to the stimulation response pattern, which is configured individually for each of the stimulation frequencies (sine and cosine components for all considered Nhharmonics). In this case, a maximum number of Nz=min(Ny, 2Nh) canonical correlation coefficients can be obtained. Thus, n=Nyand m=2Nh.In the SSVEP-based BCI system of Nftargets (stimulus frequencies:f1,f2,…,fNf), the same number of response patternsX1,X2,…,XNfshould be used, each corresponding to the respective stimulus frequency. For a measured multichannel EEG and each of the reference response patterns, a vector of correlation coefficientsρij=[ρi1,ρi2,…,ρiNz],ρi1≥ρi2≥⋯≥ρiNzis computed, i=1, 2, …, Nf, j=1, 2, …, Nz. In a standard application of CCA to SSVEP BCI, the intended command is recognized as Qk, where k is a stimulus frequency index (fk) for which the coefficient ρk1 is maximum compared to all other coefficients ρi1 for stimulus frequencies fi, i=1, 2, …, Nf, i≠k.The original CCA method does not seem reliable in a practical, asynchronous SSVEP BCI system (even in conjunction with thresholding of maximum canonical correlation coefficients for each stimulus frequency). The measured unstimulated brain activity and the SSVEP stimulation responses are strongly dependent on a user psychophysical state, which is constantly changing during the ongoing measurement session and between different days. In such cases, the power of the background EEG components, representing a non-stimulated brain activity is increased and the BCI system is not able to distinguish properly between working and idle state classes. A brief moment of relaxation often improves a recorded signal quality, but it is usually only a short-term effect.A change of the user psychophysical state and its effect on the signal classification is clearly noticeable in Fig. 2, where relevant parts of the signal for the same user in two test sessions, corresponding to his/her good (Fig. 2a) and poor (Fig. 2b) physiological state are compared. In the latter case, all of the canonical correlation coefficients have greater variability over time (resulting in false detections which were marked red).Due to the described problems, the precise measurements of the performance of the original CCA method (with thresholding of maximum canonical correlation coefficients) in an asynchronous BCI system were evaluated only for some selected window lengths and for selected user groups. More details about the experiment are available in Section 3.In the proposed method, three highest valued canonical correlation coefficients for each stimulation response pattern are used as EEG signal features (ρi1, ρi2, ρi3, ρi1≥ρi2≥ρi3, i=1, 2, …, Nf.). Each of the used stimulation frequencies has its own feature space build on the basis of corresponding CCA coefficients. Detection and idle states can be accurately identified with k-means cluster analysis performed separately in each of Nffeature spaces (Fig. 3).The distance between centroids of detection and idle classes in CCA feature spaces for each stimulus frequency varies between the subjects and with stimulation frequency. Its value should be determined during the training phase, therefore BCI system operation is divided into calibration and working mode.At this stage (Fig. 4) the objective of the algorithm is to identify the location of centroids of detection and idle classes for all Nfstimulation frequencies. The user is instructed to move his/her eyes (but not more often than every 5s) between available stimulation light sources (stimulator elements).In the first step, a set of response patterns for each of the used stimulation frequencies is built (Xi, i=1, 2, …, Nf). As a result of canonical correlation of NyEEG source channels in the detector window Y sequentially with patterns Xisets of three factors: ρi1, ρi2andρi3 are obtained. Each of the sets can be represented as a point ρiin the three dimensional feature space constructed on the basis of canonical correlation coefficients of the source EEG data with the ith response pattern.Along with each successive point ρiin particular feature space, k-means cluster analysis is performed and a mutual distance between two classes (idle and detection states, marked Biand Direspectively), is examined. Euclidean metric is used:(2)d(Bi,Di)=∑j=13(ρB,ij−ρD,ij)2where Biand Didenote the points where the idle and detection class centroids lay in the ith feature space. Calibration for each frequency fiends when Biand Dicentroid distance is large enough:(3)d(Bi,Di)≥βand after adding for instance the last 25 points to the ith correlation coefficients feature space, the distance d(Bi, Di) was not changed by more than 10%.Based on the analysis of the recorded EEG data and our practical investigations β=0.25. Its value is a compromise between the accuracy (especially for lower quality signals) and the time of detection. Too high β value results in an increased number of false negative errors, and too small one increases false positives.The training session ends upon a completion of the calibration for all Nffrequencies. If the calibration procedure takes more than 1min (during which calculated distance d(Bi, Di) value stays below a threshold and does not increase in a noticeable manner), the system reports a problem with a particular stimulation frequency.Fig. 5presents the actual operating mode of the BCI device used for communication. All the calibrated data namely, the locations of the detection and idle class centroids in each of Nffeature spaces, are used to improve classification at this stage.Like in the calibration mode, as a result of canonical correlation of the EEG source data (Y) with all Nfresponse patterns Xi, sets of three coefficients: ρi1, ρi2andρi3 (a point ρiin a three dimensional feature space) are obtained. Classification is performed in two steps: at first, each point is classified (nearest neighbors method) either to detection (Di) or idle (Bi) class in each of Nffeature spaces (for each of the stimulation frequencies used). In the second step, the classifier outputs produced in the first step are analyzed. If, during the classification in Nffeature spaces:•none of the classifiers detected stimulation response: the system detects idle state (user is resting or not willing to communicate at the moment),exactly one point ρiis classified as belonging to Diclass: the system detects user intention of selecting the corresponding command Qi(i=1, 2, …, Nfis a number of particular feature space),more than one point, represented by the CCA coefficients of source data and response pattern Xi, is qualified to the detection class: ambiguity situation occurs.The ambiguities are resolved by using the distance of each of the conflicted points ρifrom the point laying on a straight line passing through centroids of both Biand Diclasses, half-way between them. The classifier output is determined as the number of the ith feature space in which the distance was the greatest.After a successful detection of responses at any of the stimulus frequencies, all data in the EEG signal window Y are replaced with zeros. This mechanism prevents multiple detection of the same BCI symbol. In addition, after each classification, 700ms of the EEG data is not utilized, which gives the user of the BCI system time for gaze shifting.Twenty one healthy subjects (ten women and eleven men, age range 16–33 years, with the average of 22.2 years and a standard deviation of 3.4 years) participated in the experiments conducted at the Institute of Electronics, Lodz University of Technology. Subjects sat in the front of a visual stimulator on a comfortable, ergonomic chair. Special attention was paid to the layout of the measurement stand, stimulation symbol intensities, light conditions, etc.During the experiment, the subjects were instructed to focus their gaze on one of five stimulation elements to produce SSVEPs (Fig. 6a). Each of five stimulation elements (in five different colors: white, blue, green, yellow and red) consisted of three LEDs (Fig. 6b): two stimulation lights (SL and SR) with a diameter of 5mm positioned on the lower right and lower left quarter of the visual field of each eye retina and one fixation light (F) with a diameter of 3mm placed in the center of visual field. Stimulation lights flashed with the same frequency alternatively in phase (alternate half-field stimulation technique [16]). Fixation light was used for two purposes: the subject was expected to concentrate his/her sight on it; additionally it provided a feedback information about amplitudes of corresponding SSVEPs detected in the subject EEG signal. To provide the feedback, the intensity of the fixation light decreased with increasing signal-to-background ratio for the corresponding SSVEP component of the stimulus element frequency. All three LEDs (SL, SR and F) were of the same color and intensity.Each measurement lasted for several minutes and consisted of five stimulus sequences: one sequence for each color, only one stimulation symbol switched on at a time. Each sequence contained 27 different stimulation frequencies in the range of about 7–47Hz. They were chosen to match the discrete Fourier transform frequencies used in the competitive, spectrum analysis BBC method.Each stimulation lasted 8s, followed by a 2-s pause (Fig. 7). Additionally, a brief pause followed each sequence (several up to tens of seconds). It was intended for position adjustments on the chair to reduce the EMG signals and subject relax with eyes closed (EEG signal was still being recorded). Details on EEG recording and detailed description of measured data can be found in Ref. [14].Sixteen EEG channels were recorded: seven electrodes were placed over the primary visual cortex (positions PO7, PO3, O1, OZ, O2, PO4 and PO8) and nine electrodes were evenly distributed over the remaining cerebral cortex (positions P3, PZ, P4, C3, CZ, C4, F3, FZ and F4). Offline, SSVEP based BCI systems were implemented in Matlab environment with each of the evaluated spatial filtering and detection methods: BBC, MEC, MCC and CACC. Binary markers (stimulation “on” and “off” events) stored in parallel with the EEG data and a known stimulation sequence were used to verify performance of each algorithm (Fig. 8).The original EEG data for subjects were divided into shorter fragments, containing several stimulation patterns. For each user, a total number of 10 trials were performed (two measurement sessions carried out on different days, each with five stimulus sequences). One or two trials out of those, depending on the results, were used for the CACC method based system calibration. The remaining trials were used in the tests. The algorithms were evaluated with window lengths of 1.28s, 2.56s and 5.12s. Data window step was set to 0.16s.Users were qualified to one of three groups:Group A (best results, 5 subjects). Subjects who used the device (in our previous studies and tests).Group B (average results, 10 subjects). Subjects who were not familiar with a BCI device, but actively participated in the experiments.Group C (poor results, 6 subjects). Subjects with concentration problems or very high unstimulated, spontaneous brain activity.This classification helped to investigate system parameters in relation to a specific group of users. Classification accuracy was defined as the number of correctly classified commands relative to the total number of commands classified by the system. Detection time was measured from the moment when the user started to express his/her intention to the moment when BCI system detected a command. Information transfer rate (amount of information which can be transferred between the human brain and the BCI system per minute) was defined as:(4)Bt=60TDlog2(N)+plog2(P)+(1−P)log21−PN−1,where N denotes the number of commands (5 in case of this particular system), P denotes classification accuracy and TDdenotes average detection time. All system parameters obtained for each user, were averaged in each of the subject groups.BBC and CACC methods proved their high detection accuracy independently of window lengths (Table 1). Detection accuracy of the MEC method increased distinctively as the window length was increased. This phenomenon was negligible in the case of MCC algorithm. Its detection accuracy was very low when compared to the other methods.In general, the measured average detection time increased as the window length was extended, most evidently in case of BBC and MEC methods. This is a known problem in case of the BBC method and it can be easily solved in practical systems by the use of multiple different length parallel detectors.The measured information transfer rates were similar for both BBC and CACC algorithms in this group. The results of respectively MEC and MCC methods were significantly lower because of the low accuracy and a long average detection time in both cases.Performance of the original CCA method (with thresholding of maximum canonical correlation coefficients) was measured in this group (for 2.56s window length): 78.11% accuracy, average detection time of 1.84s and information transfer rate equal to 36.72bpm. The threshold value was set to β=0.35 which reflected the observed noise of maximum canonical correlation coefficients in the idle state (signal segments in which stimulation was switched off).The results confirmed our initial observations (Section 2.2): the average detection time for CCA was the shortest when compared to other algorithms, but frequently the system was not able to distinguish between working and idle states properly. With ongoing time (when the canonical correlation coefficients noise increased), the system in many cases was incorrectly classifying user intentions. This defect could be corrected either by the user (brief period of relaxation often improved signal quality), or by the operator (a manual adjustment of the threshold value often improved classification accuracy). In both cases a human action would be required, so the CCA-based asynchronous BCI could not operate automatically.In this group, the detection accuracy measured for the proposed CACC method increased in comparison to other algorithms (Table 2). Depending on window length, the increase was from 7% up to 11%. As in Group A, there was also a noticeable rise in algorithm accuracy with the increase in the window length (especially when changed from 1.28s to 2.56s).For short windows, the average detection time was similar across all of the tested algorithms. For wider windows, however, the measured average detection time was usually about 0.8–1.0s shorter for the proposed method.As for the information transfer rate the proposed CACC method seems to be better than all the other competitive algorithms because of both: shorter average detection time and higher detection accuracy. The worst results were measured in case of MEC and MCC methods.The increase in the detection accuracy of the CACC method, when compared to the BBC algorithm (the best of the competitive algorithms in this group) varied from 5% to 8% (Table 3). An increase in the detection accuracy accompanying an increase in the window length was observed for BBC and CACC methods. In case of MEC and MCC algorithm it was negligible.Taking into consideration average detection time, BBC was the fastest algorithm with reasonably high accuracy. CACC was the second fastest detection method with the loss of about 1s for the shortest window and about 0.4s in the remaining cases.The measured information transfer rates were very low, only BBC and CACC methods marked out in this group.

@&#CONCLUSIONS@&#
The proposed detection algorithm improves classification accuracy in the groups of subjects with the average (Group B) and poor (Group C) results. In the group of users with the best results (Group A), there was no clear improvement of the SSVEP detection accuracy. In most cases average detection time was similar for BBC and CACC algorithms (differences of up to 1s were measured in single cases). The measured information transfer rates were in many cases (especially for Groups B and C) higher for the CACC method, which is due to higher classification accuracy of this method. It should be noticed that only a short off-line calibration session was necessary to achieve such results.Due to a high user SSVEP variation, BCI illiteracy phenomenon, and a low communication speed many BCI systems are still at the stage of laboratory demonstrations. In our opinion, these limitations may be eliminated by new spatial filtering and detection methods. It has been shown that the use of the proposed CACC method can improve key system parameters for a large group of users with respect to the competitive spatial filtering and detection methods tested in our research. Each of 21 subjects was able to communicate in the off-line experiments. Moreover, 16 subjects (Groups A and B) reached substantial information transfer rates. Therefore, the results encourage further development of the proposed detection method and its implementation in an on-line BCI system.