@&#MAIN-TITLE@&#
A hybrid artificial intelligence model for river flow forecasting

@&#HIGHLIGHTS@&#
Review of classical and advanced hydrological models for river flow forecasting.Application of Elman and Modular ANNs for time series prediction.Use of hierarchical clustering and Fourier frequency analysis for identifying similar past situations.Case-based reasoning as methodology for constructing hybrid forecasting systems.Results indicate that the hybrid system outperforms previous approaches.

@&#KEYPHRASES@&#
River flow forecasting,Hydrologic models,Black-box approaches,Case-based reasoning,Hybrid forecasting system,

@&#ABSTRACT@&#
A hybrid hydrologic estimation model is presented with the aim of performing accurate river flow forecasts without the need of using prior knowledge from the experts in the field. The problem of predicting stream flows is a non-trivial task because the various physical mechanisms governing the river flow dynamics act on a wide range of temporal and spatial scales and almost all the mechanisms involved in the river flow process present some degree of nonlinearity. The proposed system incorporates both statistical and artificial intelligence techniques used at different stages of the reasoning cycle in order to calculate the mean daily water volume forecast of the Salvajina reservoir inflow located at the Department of Cauca, Colombia. The accuracy of the proposed model is compared against other well-known artificial intelligence techniques and several statistical tools previously applied in time series forecasting. The results obtained from the experiments carried out using real data from years 1950 to 2006 demonstrate the superiority of the hybrid system.

@&#INTRODUCTION@&#
River flow modelling and prediction is one of the earliest forecasting problems to have attracted the interest of a good number of scientists. Given the importance of estimating flows for the livelihoods of inhabitants located near rivers, it has been necessary to record and study the flow data from early historical times. In fact, the ancient Egyptians established several mechanisms to measure river flows, even using this knowledge to predict floods [1].Nowadays, the availability of an accurate river flow forecasting method can help in the resolution of relevant tasks such as (i) the optimal design of water storage and drainage networks, (ii) the management of extreme events such as floods and droughts, (iii) the planning of future expansion or reduction of reservoir capacities, (iv) improving the efficiency of power generation and (v) aiding in the prevention and comprehension of hydrologic hazards like the change of hydro-climatic regime, erosion and sediment movement, mud flows or environmental pollutants [2,3].In the context of time series studies, prediction methods are usually based on the analysis, representation and projection of existing time series data [4]. In this situation, obtaining an accurate forecast is particularly difficult when the target system is governed by dynamic processes under chaotic and stochastic conditions. To deal with this scenario in our problem domain, traditional approaches like statistical tools and specific hydrological models have been previously applied with different levels of success [5,6]. Nevertheless, relatively recent works apply artificial intelligence (AI) methods like artificial neural networks (ANNs) and hybrid systems to the problem of river flow forecasting in order to generate more accurate models [7–9].Based on our previous experience developing hybrid forecasting systems [10,11], here we present the definition of a novel hybrid AI model able to predict the behaviour of a reservoir flow influx located in the Department of Cauca (Colombia). The aims for developing the proposed system are twofold: it should allow a precise estimation of the electricity production as well as provide adequate flood control in the zone.The implemented system uses a case-based reasoning (CBR) model that incorporates a hierarchical clustering technique and a Fourier frequency analysis method to perform the initial selection and filter of similar data values, an Elman and a Modular ANN to generate a primitive forecast, and a final auto configurable weighting schema able to adjust the definitive prediction.The structure of the paper is as follows: first, we present a brief overview of past efforts and recent approaches related with river flow forecasting; then the hybrid forecasting system is explained and the results obtained with the proposed model are discussed and analyzed; finally, the main conclusions are summarized and future work is outlined.In hydrology, river flow forecasting is one of the most frequently analyzed problems. For this reason, different predictive models coming from several areas of knowledge under different approaches and with specific goals have been developed resulting in various levels of success. Although many of them are variations of ANN architectures and neuro-fuzzy approaches, numerous hydrological models and black-box alternatives are also available. This section presents a general overview of existing approaches previously used in hydrology that are related to the problem of river flow forecasting.During the last decades, a large number of papers focused on modelling and forecasting of river flow dynamics have been published [12–18]. This is because, previous to the development and general application of AI tools in the field, hydrologists and researchers had to appeal to some expert-based forecasting methods or to develop new models according to the intrinsic characteristics of the problem domain. Many techniques currently used in both approaches assume linear relationships amongst the variables. These techniques can be classified into two main groups: (i) hydrological models and (ii) black-box approaches.Hydrological models can be understood from three different perspectives: (i) based on spatial representation [19], (ii) based on a representation of the hydrological processes [20] and (iii) based on the temporal extension in which the model can be applied [12].The classification based on spatial representation considers three types of models: (i) aggregated (ii) semi-distributed and (iii) distributed models. In the first type, a uniform spatial rain distribution is assumed and all the hydrological variables are considered global and constant in time for the whole basin. The second type allows some variability in both the spatial distribution of rain and the hydrological variables. The last type permits variability in the parameters and the spatial distribution of rain, dividing the basin into cells and simulating hydrological processes for each one.Taking into account the classification based on the representation of hydrological processes, there are three main categories: (i) physically based models [13,14], (ii) conceptual models [15] and (iii) metric models [16,17]. The first one is specifically designed to mathematically simulate or approximate the general internal sub-processes and physical mechanisms that govern the river flow process. The input is represented by the precipitation values that are partitioned into components and routed through the sub-processes to the watershed outlet as stream flow, to the surface and deep storages or to the atmosphere as evaporation [13]. Fig. 1shows a simplified hydrological model that incorporates five physical variables (incoming shortwave and outgoing longwave; ozone absorption and emission; H2O and CO2 absorption and emission; latent and sensible heat fluxes; precipitation) together with their interactions.In the case of conceptual models, parameters must be estimated from fitting the model to historical rainfall-runoff data. Fig. 2shows a typical structure of a conceptual watershed hydrological model adapted from [21]. Therefore, a conceptual model can not be used in engaged watersheds where historical rainfall-runoff data are not available.Finally, metric models are those that, after performing a search on the observed data are able to characterize the system response. The characterization is performed by an information extraction method applied over the existing data. These models are built with minimal or no consideration of the physical processes that occur in the hydrological system, and they use the simplest watershed representation. Their main advantage is that they require minimum data, but their utilization is limited because of both the variability of the observed data and their inability to consider watershed changes.The classification based on temporal extension distinguishes two main categories: (i) event-driven models, developed for short time simulations with a unique rain episode, and (ii) continuous models, which allows daily, monthly and seasonal runoff simulations.While physically based models are very useful to understand the physical mechanisms involved in river flow dynamics or any other hydrological process, they are difficult to apply. The main drawbacks originate from the fact that they require a large number of parameters to model the complexity of river flow dynamics and the difficulties associated with the extension of a particular model to even slightly different situations.In contrast to hydrological models, black-box approaches are designed to identify the connection between inputs and outputs without analyzing the internal structure of the physical process [18]. In this approach, stochastic models are fitted to historical records in order to forecast the short and long term behaviour of hydrological variables that represent the states of the hydrological phenomena. In this sense, black-box models may not necessarily lead to a better understanding of the river flow process, but they do have the advantage of being easy to apply even under different conditions since the modelling and forecasting procedures are usually similar. Moreover, the analysis of characteristic parameters of black-box models can furnish useful information about the dynamics of the phenomenon under study.In the black-box approach, AR (Autoregressive) models are the most widely used, especially ARMA (Autoregressive Moving Average) and ARIMA (Autoregressive Integrated Moving Average) techniques [22,23]. Some other simple methods such as moving average, exponential smoothing or regression models (simple and multiple) could be also used depending on the number of available variables and their correlation. Moreover, previous hydrological studies suggest the utilization of some techniques according to the characteristics of the series. For single and multiple stationary time series, it is recommended to use AR, ARMA and ARIMA models as well as the GAR (Gamma Autoregressive) approach [18]. In the case of single and multiple periodic time series, the usage of PAR (Periodic Autoregressive), PARMA (Periodic Autoregressive Moving Average) and periodic GAR models are appropriate [18]. However, these models represent the nonlinear characteristics of hydrological processes assuming ‘causes’ no change, which is something that does not usually happen within the hydrological domain.As already mentioned, almost all the hydrological variables and processes exhibit highly non-linear behaviour and, in many cases, researchers represent those variables and processes using classical physically based models. The use of conventional or statistical techniques is not appropriate because of the poor understanding of the relations and the complex interactions between the processes. Hence, there is a need for improvement in forecasting techniques. In this sense, AI offers flexible structures and non-parametric algorithms capable of identifying and capturing the complex non-linear relationships between input and output data sets [2].During the last 20 years there has been a growing interest in applying various AI techniques to both time series prediction in general and hydrological forecasting in particular. These techniques include neural networks [23] (comprising multi-layer perceptrons (MLP), radial basis function (RBF) networks, modular networks and recurrent neural networks) [24–31], fractal analysis [32,33], genetic algorithms [34,35] and fuzzy logic [36–38]. These techniques have been mainly used for simulating, forecasting and predicting the possible behaviour of different hydrological variables [22,39].From all the previous successful soft computing methods and techniques, ANNs are particularly suitable for dealing with the intrinsic characteristics commonly present in hydrological processes [40]. In this sense, neural networks have the ability to correctly handle extremely noisy and prone to error time series. Moreover, hydrological processes are highly non-linear in nature, a situation that can be alleviate by the flexible mathematical structure of ANNs, able to identify complex relationships between input and output data. A final advantage of ANNs with application in time series forecasting is that the statistical distribution of the raw data need not be known in advance, because the non-stationarities present in the time series (e.g., trends and seasonal variations) are implicitly accounted for by the internal structure of the neural networks.In contrast with previous hydrological forecasting studies that use simple models or ensemble alternatives based on ANNs [23–31,40], the proposed system hybridizes two different neural networks (i.e., Elman and Modular) working in parallel as coprocessors in order to generate an initial but precise forecast. This approach is enclosed by a previous historical filtering phase able to select similar data and a later process of weight modification which ensures continuous learning. Such integration is a distinctive characteristic of the proposed system that will be responsible for its accurate results.As already mentioned, a novel CBR system is proposed for calculating the mean daily water volume forecast of a reservoir inflow. The main reason for using a CBR approach is that this methodology easily allows the combination and fusion of different AI algorithms and statistical techniques, resulting in more scalable and accurate hybrid models.In this context, CBR systems define four sequential stages that are invoked every time a new problem (prediction) needs to be solved: (i) retrieval of previous cases that are more similar to the present one, (ii) reuse (adaptation) of those situations in order to generate a feasible solution to the present problem, (iii) review of the initial solution proposed by the system and (iv) retain (learning) the final solution as a new case for future reuse [41,42].In order to forecast the inflow of the target reservoir one day in advance, a problem descriptor (case) has been defined on a quarterly basis, so each case represents the daily reservoir inflow corresponding to the previous three months. The proposed quarter representation is conceptually justified by a hydrological concept called ‘seasonal regime’, which explains the phenomena that affect the fluvial network, being tightly related with seasons in northern and southern zones defined by the temperature changes [43].In the proposed hybrid model, the forecasted values are obtained using different techniques at different stages of the CBR life cycle. In this context, Fig. 3presents the general architecture and data workflow of the developed model. Both, the proposed architecture and life cycle are based on the previous successful work of Fdez-Riverola and Corchado [10,11].The forecasting model represented in Fig. 3 incorporates (i) a hierarchical clustering algorithm and a Fourier frequency analysis method to perform the initial selection and filter of similar past cases, (ii) an Elman and a Modular ANN for in line generation of a primitive forecast, (iii) an auto configurable weighting schema able to adjust the final prediction of the model and (iv) a learning procedure for automatically updating the knowledge base. In the middle of Fig. 3 there is the hydrology series case base that implements the memory of the CBR system by storing all the time series data.Every time a new prediction needs to be made, the proposed system evolves from phase 1 (retrieval) to phase 4 (retain). Table 1details the techniques used to implement each phase comprising the whole CBR life cycle.The retrieval stage is carried out using three sequential steps: (i) quarter extraction, (ii) hierarchical clustering and (iii) spectral density analysis. In the first step, all the quarters from previous years that correspond with the same weeks of the problem descriptor are initially selected. Then, a hierarchical clustering algorithm based on the Ward distance is used to identify those historical quarters most similar to the present situation. Finally, a spectral density analysis based on the Fourier frequency is applied to the selected quarters in order to choose those cases with similar frequency (retrieval phase in Table 1).Once the most similar quarters with uniform frequency have been selected, the reuse stage is carried out by training with these data two different neural networks: an Elman ANN [44,45], which implements a semi-recurrent neural network based on a Jordan ANN [46], and a Modular neural network [9]. The Elman network is composed of seven neurons in the input layer (representing the previous week), one hidden layer with 20 neurons and one neuron in the output layer. The Modular neural network comprises two MLPs working in parallel with seven neurons in the input layer, two hidden layers with sixteen and eight neurons respectively, and an output layer with one neuron. Both networks are responsible for generating an initial solution that will be combined to obtain a final forecast through a weighting process mechanism (Reuse phase in Table 1).The revision stage performs the weighting of the initial forecast generated by the two neural networks and establishes the final confidence interval. Threshold weights are initially defined by the percentage of times each neural network has obtained the best forecast based on the Mean Square Error (MSE) and Mean Absolute Error (MAE) efficiency indexes (revise phase in Table 1).Finally, in the learning stage a new case is stored in the hydrology series case base and the threshold weights are subsequently updated taking into consideration the efficiency indexes (retain phase in Table 1).The raw data used for the present study was taken from the monitoring network of the Cauca Valley Regional Autonomous Corporation (CVC) that maintains more than 150 hydrometric and rainfall stations which perform the measurement and control of water resources in the valley and north of river Cauca. Under an agreement with the Pacific Power Company (EPSA), the CVC supervises the Salvajina reservoir for energy production. In this context, one of the CVC goals is to determine the amount of water that may be used for power generation, while restricting the reservoir drops to critical levels.Available data is received and processed daily in the Salvajina hydrometric station located at the Department of Cauca, in Colombia (see Fig. 4). This information represents the daily record of river flow volume (m3/s), level of rainfall (ml/m2) and temperature (°C) from ground measurements provided by CVC from the years 1950 to 2006.In order to generate a ready-to-use dataset for training, validation and testing purposes, it was necessary to previously pre-process and analyze available raw data. The first step carried out was the treatment of wrong and missing values. In the case of missing values corresponding to river flow and rainfall level variables, time series were completed using a weighting procedure in which the new values were calculated taking into consideration their relative importance for the current month when compared with the whole year. For the temperature, the new value was estimated as the mean between the day before and after the target date. Wrong values were processed in the same way as missing variables.The second processing step was the execution of a correlation analysis between filtered and adjusted variables. At first, it was carried out with data in the original order, but later the rainfall level records were advanced by one day to evaluate the assumption that one day average rainfall influence next day average flows. Based on the experimental results obtained, temperature was discarded as input variable due to its low correlation with regard to river flow volume.The final step involved the execution of several simulations with standard neural networks using both the level of rainfall and the river flow volume as input variables. The results obtained showed that in all the situations, the neural networks performed well only with the river flow variable as input, so the level of rainfall was also finally discarded.As a result of all the previous data pre-processing operations, a final debugged case base was generated containing only the daily record of river flow volume (in m3/s) belonging to the Salvajina hydrometric station from year 1950 up to 2006. The final hydrology series case base incorporates a total amount of 224 quarters (56 years) with more than 20,000 individual points.In order to validate the proposed approach, we have tested our hybrid system using the previous generated case base. In all the experiments we have utilized 60% of the available data to train the models (134 quarters), 15% to estimate the best configuration parameters (34 previously unseen quarters) and the remaining 25% of unseen data for testing purposes (56 quarters). This validation schema and distribution is commonly accepted for testing the performance of different approaches in time series forecasting problems [47]. Fig. 5summarizes the dataset pre-processing carried out and how the experimental configuration was setup.Table 2displays the values for those commonly used efficiency indices obtained by the hybrid system during the test period. After the whole training of the CBR model and the configuration of the best parameters for the ANNs implementing the reuse phase, the final weight assigned to the Elman and Modular ANNs was 0.59 and 0.41, respectively. All the experiments including the whole training, validation and test processes carried out by the hybrid system were executed on a personal computer with Intel Core 2 Quad 3GHz processor and 4GB RAM. The computation time for all the tasks was about 47min.Further experiments were carried out to compare the performance of the CBR hybrid system with several other forecasting approaches. These include standard statistical forecasting algorithms (from Statgraphics Centurion software) and the application of several neural networks methods (available in NeuroSolutions Suite 5.0). Tables 3 and 4show the results obtained by the statistical approaches during the estimation and validation periods, respectively.The error series produced by the previous statistical techniques and the proposed CBR system did not present a normal behaviour when the Kolmogorov–Smirnov and Shapiro–Wilk tests were applied, so this fact tends to invalidate the results obtained by any parametric test. In order to deal with this situation, a non-parametric Kruskall–Wallis test was executed. Since the P-value is less than 0.01 there is a statistically significant difference among the models at the 99.0% confidence level. Fig. 6shows a standard Box-and-Whisker plot for the different alternatives.From Fig. 6 it can be seen that the proposed CBR system shows a higher concentration of data (i.e., error values calculated from the predicted outcomes), which means that although the efficiency indices are similar between the analyzed models, data dispersion is lower (dot lines from left and right of the middle box) and thereby the forecast value and its confidence interval is more reliable.In order to complement the comparison and gain a deeper insight, Table 5shows some alternative indexes which reflect the behaviour of the analyzed model. This table includes the standard deviation of the error (SD), the maximum and minimum values for the predictions carried out and the range between these values. From Table 5 it can be seen that the smallest standard deviation and range are obtained using the proposed CBR system.Finally, Table 6shows a multiple comparison procedure (Mann–Whitney test) used to determine which models are significantly different from the others. It can be seen in Table 6 that the proposed CBR system presents statistically significant differences to the rest of the models.In order to complete the experimental evaluation of the proposed CBR system, its accuracy was compared with the results obtained from using five different ANN alternatives: (i) a Feedforward neural network, (ii) a Radial Basis Function (RBF), (iii) a Multi-Layer Perceptron (MLP), a (iv) Modular neural network and (v) an Elman model.All the networks, except Modular and Elman that maintain the same configuration as in the hybrid system, have seven neurons in the input layer and one neuron in the output layer. The MLP has two hidden layers with sixteen and eight neurons, respectively. The RBF has one hidden layer with 100 centres, and the Feedforward a hidden layer with 16 neurons. The same validation framework was applied as in the previous experimentation: 60% of the data was used for training, 15% for parameter estimation and the remaining 25% for testing. All the networks were trained with a maximum of 5000 iterations. Table 7summarizes the results obtained.As can be observed from Table 7, the proposed CBR system generates better results than the other selected models. However, Elman and Modular neural networks were close to the CBR system but with a greater standard deviation and range. In order to statistically validate the results obtained, a non-parametric Kruskall–Wallis test was also executed. The results showed that, also in this occasion, there is a statistically significant difference among the models at the 99.0% confidence level (P-value<0.001).

@&#CONCLUSIONS@&#
This paper has presented a hybrid AI system together with its application to a river flow forecasting problem as a prototype example of a chaotic and non-linear environment. In the current work, we have used different data mining techniques together with AI algorithms to build the final hybrid CBR system. In the retrieval stage, a hierarchical clustering algorithm is used to build a ranking of quarters based on the dissimilarities between them. Then, a spectral density technique based on Fourier frequency analysis is applied to compare time series in the frequency domain. In order to implement the reuse stage of the hybrid system two neural networks architectures have been used: an Elman ANN and a Modular ANN composed by two MLPs. Their outputs are finally combined by a weighting schema based on MSE and MAE values.As in other real data forecasting studies, the appropriate application of correct pre-processing steps are of crucial importance for obtaining accurate results. In this context, (i) the treatment of wrong and missing values, (ii) the execution of previous correlation analysis between filtered and adjusted variables and (iii) the initial execution of several simulations with standard techniques play an important role in identifying those features with a major discriminant power.Regarding the benefits of our hybrid model, the proposed CBR system is able to generate a forecast with an acceptable degree of accuracy outperforming previous approaches. The prediction is made for the short term (one day in advance), but the results could be extrapolated to produce forecasts further ahead using the same technique. The hybrid system can be used to make predictions on situations in which univariate time series exist but taking into account that a daily update of the case base is required and sufficient records are necessary to guarantee the accuracy of the neural networks.Moreover, the adoption of the CBR paradigm as design methodology to develop the hybrid model eases its reutilization for other river modelling problems. Both the proposed general architecture as well as the different techniques used for implementing each phase of the whole life cycle can be reused ‘as is’, or minimally adapted in order to fit new specific requirements. In addition, a given technique can also be fully replaced by an alternative approach in order to obtain a better performance of the model for solving a particular problem.With regard to future work, development of new mechanisms able to automatically tune the parameters that govern the operation of the neural networks will be a focus. In this sense, related topics of importance are the effective differentiation between estimation and prediction [48] and the consideration of different predictivity measures [49]. Moreover, the integration of fuzzy logic may dramatically improve the capabilities of the proposed system. In this direction, there are previous interesting works by Castillo and Melin [50] and Pulido et al. [51] that can contribute to this goal.