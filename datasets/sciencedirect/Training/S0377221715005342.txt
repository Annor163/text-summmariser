@&#MAIN-TITLE@&#
Prioritizing regular demand while reserving capacity for emergency demand

@&#HIGHLIGHTS@&#
Develop metrics that evaluate the costs of delay from various aspects.The type of a regular demand class can change over time.Identify conditions under which one class of regular demand is dominant.The dominant demand is favored over the competing class of demand but may not exist.Fully characterize the optimal policy.

@&#KEYPHRASES@&#
Capacity allocation,Capacity reservation,Make-to-order,Demand prioritization,

@&#ABSTRACT@&#
This research is motivated by the capacity allocation problem at a major provider of customized products to the oil and gas drilling industry. We formulate a finite-horizon, discrete-time, dynamic programming model in which a firm decides how to reserve capacity for emergency demand and how to prioritize two classes of regular demand. While regular demand can be backlogged, emergency demand will be lost if not fulfilled within the period of its arrival. Since backlogging cost accumulates over time, we find it optimal for the firm to adopt a dynamic prioritization policy that evaluates the priorities of different classes of regular demand every period. The optimal prioritization involves metrics that measure backlogging losses from various perspectives. We fully characterize the firm’s optimal prioritization and reservation policy. Those characterizations shed light on managerial insights.

@&#INTRODUCTION@&#
Capacity management is often a challenging task faced by many production managers. This research is motivated by the experience of a major provider of customized products to the oil and gas drilling industry. In recent years, demand for the company’s products is fueled by the booming oil market. The rapid growth, however, brings challenges to capacity management. One of the most salient problems is backlogging. The company’s records show that customers could wait as long as a year for their orders to be satisfied. As much as the company wants to take full advantage of the current demand increase, the executives of the company are hesitant to invest in capacity expansion for fear of market fluctuations. They are more interested in how to best utilize their existing capacity.The majority of the company’s demand is processed in a first-come-first-serve fashion. Some executives of the company question the validity of this approach because different classes of demand do not have the same gross margins. On the other hand, waiting costs are also a concern because the company hopes to maintain long-term relationships with its clients. Classifying demand based on both revenue and waiting cost is, therefore, necessary. Further complicating the demand prioritization problem is the existence of emergency demand. Unexpected events occurring in the oil and gas field result in emergency orders of specialized equipments. In light of the long-term relationship with critical clients, the company wants to satisfy emergency demand as much as possible, even at the expense of delaying regular demand. Given the frequency of emergency demand, production managers find it necessary to reserve capacity for the uncertain emergency demand. Hence, there are two tasks in the company’s capacity management problem. One is reserving capacity for unknown emergency demand. The other is splitting the leftover capacity between different classes of regular demand.We formulate a discrete-time dynamic-programming model that reflects the two tasks faced by the company and fully characterize the optimal solution. In order to characterize the optimal policy, we develop various metrics that measure the potential losses resulting from backlogging regular demand. Comparisons among these metrics allow us to prioritize regular demand and determine the level of capacity reservation for emergency demand. We believe the optimal solution to our model provides guidance to the company’s capacity management.Although our research was motivated by challenges rising from the oil and gas drilling field, our model and solution approach can be applied to general industrial settings with customized products and capacity constraints. As pointed out by Rahman and Seliger (2013) and Mourtzis, Doukas, Psarommatis, Giannoulis, and Michalos (2014), demand for customized products has been increasing over the years and customization has become a widespread paradigm in manufacturing technology. Alexopoulos, Papakostas, Mourtzis, and Chryssolouris (2011) studies the performance of manufacturing systems with a focus on lifecycle, recognizing the existence of capacity constraints. deKoster, Le-Duc, and Roodbergen (2007) examines order picking systems, which feature both customized orders and capacity constraints.The rest of the paper unfolds as follows. Section 2 reviews relevant literature. Section 3 explains the problem setting and formulates the model. We present preliminary analysis on demand types and capacity reservation, introduce the concept of dynamic loss, and discuss our solution approach in Section 4. Section 5 describes the optimal policy. Section 6 summarizes our numerical studies, which develop and compare a few heuristics to the optimal policy. Section 7 concludes the main text of the paper. Appendix A presents technical statements that are skipped in the main text for readability. Proofs of technical statements are included in a supplementary document.Our research is, essentially, about capacity allocation among multiple demand classes. This topic has been studied in a variety of contexts. We review, here, the relevant literature and explain how our work differs.One stream of research considers demand that is always backlogged if unsatisfied. The same product is made and sold to multiple classes of customers. At any given time, one needs to decide whether the facility should produce or not. Once a product is made, one needs to decide whether it should be allocated to on-hand inventory, or any class of customers. An optimal solution should strike a balance between holding cost and various levels of backlogging costs. Ha (1997) started this line of research in a setting with two demand classes. de Vericourt, Karaesmen, and Dallery (2002), Huang and Iravani (2008), and Gayon, de Vericourt, and Karaesmen (2009) look at extensions or variations of Ha’s (1997) work. Iravani, Liu, and Simchi-Levi (2012) look at a manufacturer who accepts all demand for a generic product with make-to-stock system and can accept or reject demand for customized products with make-to-order system. Both types of demand can be backlogged after being accepted in the setting of Iravani et al. (2012). One of the key differences between this line of research and ours is our consideration of emergency demand, which cannot be backlogged. The uncertain arrival of emergency demand during a period in our setting makes capacity reservation necessary in addition to allocating demand between two regular demand classes.Another stream of research analyzes production and allocation decisions when a firm faces two classes of demand: contractual and transactional. The contractual demand must be met immediately while the firm chooses to accept or reject transactional demand. Carr and Duenyas (2000) formulate a continuous-time, make-to-stock model in which transactional orders are either accepted or rejected upon arrival. They show that the firm’s optimal acceptance and production decisions are determined by an acceptance threshold curve and a production threshold curve. Frank, Zhang, and Duenyas (2003) adopt a discrete-time approach. Their contractual orders are deterministic and their transactional orders are stochastic. Unsatisfied transactional orders are lost. Frank et al. (2003) find that their optimal policy can be characterized by a modified and much more complicated (s, S) policy. Gupta and Wang (2007) formulate a discrete-time model and allow transactional demand to be satisfied within a fixed number of periods without penalty. When both contractual and transactional demand are make-to-order, Gupta and Wang (2007) show that the optimal acceptance decision is a threshold policy with the threshold being determined by the firm’s capacity and the current period’s contractual demand. The contractual demand in this research stream differs from the regular demand in our research because contractual demand is fulfilled immediately or within a fixed number of periods without penalty. Our regular demand, in contrast, can be backlogged throughout the whole planning horizon and with accumulating penalties.Wang, Liang, Sethi, and Yan (2014) consider two groups of customers: short lead-time ones who demand the product immediately and long lead-time ones whose orders can be fulfilled either immediately or in the next cycle. Backlogging costs accumulate for unsatisfied demand. The supplier needs to determine how to allocate on-hand inventory between the two groups of customers and how to allocate replenishment inventory among backlogged orders. The paper focuses on three priority rules and derive inventory commitment policies based on those rules.Gao, Xu, and Ball (2012) consider pseudo orders that become actual orders after being confirmed and use a Markov chain model as a short-term forecast for pseudo orders. The manufacturer decides whether to accept or reject a confirmed order. Accepted orders must be fulfilled during a fixed time window and productions are constrained by both capacity and component inventory availability. Orders from different classes bring in different revenues.Capacity allocation research in medical settings often deals with demand uncertainty (Gerchak, Gupta, & Henig, 1996; Patrick, Puterman, & Queyranne, 2008; Green, Savin, & Wang, 2006; Patrick & Puterman, 2007; Gupta & Wang, 2008; Min & Yih, 2010; Dobson, Hasija, & Pinker, 2011; Geng & Xie, 2012 etc.). Green (2012) discusses how operations research can improve healthcare delivery. Chen and Robinson (2010) and May, Spangler, Strum, and Vargas (2011) examine capacity allocations when scheduling appointments or surgeries, respectively. Ramirez-Nafarrate, Hafizoglu, Gel, and Fowler (2014) study ambulance diversion policies in order to minimize patients’ average waiting times. Gerchak et al. (1996) is the closest to our research. They study how to share operating room capacity between elective surgeries and emergency surgeries. Before learning the amount of emergency demand arriving on any given day, the scheduler must decide how many elective surgeries are admitted for operation on the current day. Delayed elective surgeries result in postponed revenue collection and waiting costs. The elective surgeries are analogous to our regular demand but have just a single class. With a single class, the prioritization problem goes away.Revenue management is an area that naturally deals with capacity allocation among multiple demand classes. It is often studied in contexts including airlines, hotels, and car rentals. McGill and van Ryzin (1999) and Talluri and van Ryzin (2004) provide detailed reviews. A key difference between our work and revenue management literature is the lost sales of unsatisfied demand in revenue management settings. Backlogged regular demand is more appropriate in our model because the company that motivates this research rarely turns away any demand.A key element of our model is the existence of customized products. Given its popularity, customization has been the focus of a series of research in manufacturing settings. Mourtzis, Doukas, and Psarommatis (2013) proposes a genetic algorithm for mass customization. Mourtzis et al. (2014) examines a web-based platform that facilitates customization. Adaptability or flexibility is crucial to the manufacturers of customized products. Papakostas and Mourtzis (2007), Alexopoulos, Mourtzis, Papakostas, and Chryssolouris (2007), and Alexopoulos et al. (2011) examine the evaluations of system flexibility or adaptability. Makris and Chryssolouris (2010) incorporates demand uncertainty in manufacturing planning and applies their Bayesian model to the automotive industry. This series of research studies the design and evaluation of manufacturing systems, which often consist of multiple stages. Our model analyzes the tension between demand and supply, assuming away the details regarding manufacturing stages and layouts.We will explain the technical differences between our model and those in the literature after formally introducing our model in the next section.We formulate a make-to-order firm’s capacity allocation problem as a discrete-time dynamic programming model. The firm would like to maximize its discounted expected profits over T periods. We consider T a finite integer.We consider two categories of demand in this paper. The key difference between the two categories of demand is whether demand can be backlogged. We define the category of demand that can be backlogged as regular demand. The regular demand in our model does not have to come from regular customers of a firm, and hence may not be contractual. We define the category of demand that will be lost if not satisfied within the period of arrival as emergency demand. Emergency demand can also come from long-term customers or one-time customers. Both regular and emergency demand are satisfied by the same production process. Hence, capacity allocation decisions have to be made.Since regular demand is not necessarily driven by long-term contracts, the amount of regular demand arriving in each period need not be deterministic. Regular demand is not processed immediately upon arrival. At the end of each period, the accumulated regular demand throughout the period is added to the existing unsatisfied demand. We also recognize that demand from different customers or of different nature may have different cost structures. For this reason, we study two classes of regular demand, each with a potentially different set of cost parameters. Details regarding the definitions of the two classes of regular demand are provided in Sections 3.2 and 4.1.Emergency demand was induced by urgent events and its arrival is, clearly, stochastic. The amount of emergency demand that arrives during a period can come from a single customer or multiple customers. While the amount of regular demand waiting to be processed is known at the beginning of a period, the amount of emergency demand that will arrive during a period is unknown when capacity allocation decisions are made for the period. The firm’s capacity allocation policy needs to specify how much emergency demand can be accepted throughout the period.We do not assume, automatically, that emergency demand has a higher priority than regular demand. Instead, our research is about finding the optimal priority rules.Regardless of the category a unit of demand falls into, the demand faced by the firm is met by customized products. The same production process and capacity can be used to satisfy both demand categories. We assume that no changeovers are needed in the production process. As a result, demand from different sources or arriving at different times can be accumulated without affecting capacity utilization.The firm processes two classes of regular demand. Their arrival is random but stationary over the planning horizon. Fori=1,2,we denote by Dithe (random) amount of class i regular demand arriving each period, fithe corresponding probability density function, and Fithe corresponding cumulative probability function.D=(D1,D2)represents regular demand. Unsatisfied regular demand is backlogged. The firm also handles emergency demand, which will be lost if not satisfied upon its arrival. We denote by Dethe (random) amount of emergency demand arriving each period, fethe corresponding probability density function, Fethe corresponding cumulative probability function, andFe¯=1−Fe.The total amount of demand that can be fulfilled by the firm is C units per period. Fort=1,⋯Tandi=1,2,we denote by xitthe amount of unsatisfied class i demand at the beginning of period t.xt=(x1t,x2t)describes the state of the system and the state space is represented byΩt={(x1t,x2t)∣xit≥0andx1t+x2t>0}. We exclude the state (0, 0) because it results in a trivial optimal policy.At the beginning of period t, the firm observes xtand then determinesyt=(y1t,y2t)(how much of each class of regular demand to fulfill within period t). Obviously, yitcannot exceed xitfori=1,2. Furthermore, the inequalityC≥y1t+y2tmust hold. We normalize the cost of fulfilling a unit of demand using the firm’s own capacity to zero. Fori=1,2,each unit of fulfilled class i demand earns the firm a revenue of riand each unit of unfulfilled class i demand results in a backlogging cost of bifor the period. With the decision of yt, one can infer that the firm has made a capacity reservation for emergency demand ofC−y1t−y2tunits in period t.After determining its capacity allocation for period t, the firm learns the realized value of De, namely the amount of emergency demand arriving in period t. The emergency demand that is fulfilled by the firm within period t isDe∧(C−y1t−y2t). For each unit of emergency demand beyondC−y1t−y2t,the firm loses ce, which is the revenue the firm earns by satisfying a unit of emergency demand.The firm learns the realized values of D1 and D2 at the end of period t. The state of the system at the beginning of the next period becomesxt−1=(x1t−y1t+D1,x2t−y2t+D2). Note that we label the starting period as period T and the ending period as period 1.Upon observing its system state xt, the firm makes a capacity reservation ofC−y1t−y2tunits for emergency demand and fulfills yitunits of regular demand from class i in period t, fori=1,2. These decisions can be captured byzit=xit−yit,i=1,2. We refer to zitas the amount of class i demand to be backlogged in period t. In the MDP formulation below, we let the vectorzt=(z1t,z2t)be the firm’s decision variables in period t for the convenience of analysis. The action space becomesZt(xt)={(z1t,z2t)∣xit≥zit≥0,z1t+z2t≥x1t+x2t−C}. Note thatC−∑i=12(xit−zit)is the level of capacity reservation for emergency demand becausexit−zitis the amount of class i regular demand to be fulfilled in period t.The firm’s expected revenue from the emergency demand can be expressed as the difference between ceE[De] and the expected lost revenueceE[De−(C−∑i=12(xit−zit))]+. Note that ceE[De] is a constant that is not affected by either the firm’s decision ztor the firm’s state xt. For this reason, we omit the term ceE[De] from the firm’s profit function throughout the paper.We denote by Gt(xt) the firm’s maximal, expected profit function from period t to period 1 (the end of the planning horizon). Using α as the discount factor, the firm’s maximal expected profit can be expressed as follows:Gt(xt)=maxzt∈Zt{∑i=12(ri(xit−zit)−bizit)−ceE[De−(C−∑i=12(xit−zit))]++αEGt−1(zt+D)}with the boundary condition: G0(x0) ≡ 0.In order to facilitate our analysis, we introduce the following notations that are related to state variables and profit functions:•Xt=x1t+x2t: the aggregate amount of unsatisfied regular demand at the beginning of period t;Zt=z1t+z2t: the total amount of regular demand to be backlogged in period t;Vt(zt,Xt)=∑i=12−(ri+bi)zit−ceE[De−(C−Xt+Zt)]++αEGt−1(zt+D);V¯t(zt,xt)=∑i=12rixit+Vt(zt,Xt).With the above newly defined notations, the maximal expected profit function Gt(xt) can be rewritten as:Gt(xt)=maxzt∈ZtV¯t(zt,xt)=maxzt∈Zt{∑i=12rixit+Vt(zt,Xt)}.The new expression reveals our motivation to introduce Vt(zt, Xt), which depends on Xt, the aggregate amount of unsatisfied regular demand. Since∑i=12rixitis not affected by the decision vector zt, maximizingV¯t(zt,xt)is equivalent to maximizing Vt(zt, Xt). Such recognition implies that Xtwill play an important role as we search for the optimal solution. As a matter of fact, we will establish a number of thresholds on Xtand apply them when developing the optimal policy in Section 5.Before presenting our analysis and solution, we would like to briefly explain, here, how our research differs from those in the literature from a modeling perspective:(i)Capacity reservations are made for emergency demand before its arrival. We study this setting because a major challenge faced by the managers in the real world is the uncertainty associated with emergency demand. How to reserve capacity for emergency demand is a key question we would like to address in this research.The capacity allocation problem we analyze involves sharing capacity between two classes of regular demand in addition to making reservations for emergency demand. In existing literature, when there are multiple classes of regular demand, the class of regular demand with the highest backlogging or lost-sales cost is naturally assigned the highest priority. We consider both revenue and backlogging costs, which can have the same or different ordinal ranks among various classes of regular demand. While revenue is collected only at the time of order fulfillment, backlogging costs accumulate over multiple periods until the demand is satisfied. The class of regular demand with a lower revenue may have a higher accumulated backlogging cost if unfulfilled for multiple periods. Consequently, the priority level of any given class of regular demand need not remain the same over the entire planning horizon. We develop a number of definitions that measure backlogging losses, and subsequently, the optimal capacity allocation is based on those measurements.Regular demand is never turned away and unsatisfied regular demand is backlogged. From the analytical perspective, a backlog setting is more difficult to analyze than a lost-sales setting because of the need to keep track of unsatisfied demand. Emergency demand cannot be backlogged in our model. It will be lost if not satisfied within the period of its arrival.The existence of multiple demand classes invites prioritization rules. Appropriate classification of demand is key to the development of prioritization rules. Our preliminary analysis starts with a close look at demand types (Section 4.1). Building upon notations introduced in Section 4.1, we develop more metrics on backlogging losses and capacity reservation in Sections 4.2 and 4.3. We present in Section 4.4 the solution approach, which utilizes notations built upon demand types.The firm’s decision should be driven by how revenues are earned and how costs are incurred. Satisfying a unit of class i demand earns the firm a revenue of riwhile backlogging a unit of class i demand costs biper period. When prioritizing the two classes of regular demand, ri’s and bi’s should play an important role.It would not be surprising if a firm values demand with higher-margins more than demand with lower-margins. In this case, the class of regular demand with a higher riis also the class of regular demand with a higher bi. There is, however, another possibility. A firm may have long-term customers whose business is essential to the firm’s reputation. In order to maintain the relationship with those long-term customers, the backlogging cost associated with their demand could be higher even if the demand generates a lower unit revenue. Taking into consideration both possibilities, we do not assume that the class of regular demand with a higher riis automatically the class with a higher bi. Note that bireflects, essentially, the firm’s relationship with a customer. A higher biimplies a closer and more valuable relationship, which can be driven by profit margins, or other concerns like long-term business opportunities, market penetrations, reputations, etc.Because of the possibilities discussed above, neither rinor bialone is likely to be a good indicator of the priority that should be assigned to class i of regular demand. Another complicating factor is that the backlogging cost accumulates if the corresponding regular demand remains unfulfilled through multiple periods. We need to, therefore, look for better ways to classify regular demand.At period t, if the firm chooses not to fulfill a unit of class i regular demand throughout the rest of the planning horizon, the total loss the firm incurs is the sum of a loss of revenue (ri) and an accumulation of discounted backlogging costs (bi∑k=0t−1αk) from period t to the end of the planning horizon. This sum also represents the maximal loss that the firm can possibly suffer over the rest of the planning horizon from its decision of not fulfilling a unit of class i demand in period t. We believe this sum is a meaningful criterion for the prioritization of regular demand and define the following notations to represent it:•nit=bi∑k=0t−1αkandmit=ri+nit.Note that mitis the aforementioned sum. Since it sets an upper bound on the amount of loss the firm can possibly incur thereafter due to the decision of backlogging a unit of class i demand in period t, we refer to mitas class i’s Maximal Loss (ML) in period t. The metric mitis period-dependent because it includes a period-dependent part: nit, which is the accumulated backlogging costs throughout the rest of the planning horizon. The closer period t is to the end of the planning horizon, the smaller nitand mitare.Considering that r1 > r2 can co-exist with b1 < b2, the firm may have m1t≥ m2tin one period butm1(t−1)<m2(t−1)in the next period. For this reason, the priorities indicated by mit’s are only applicable to period t. The dynamic nature of mitprompts us to consider a stationary indicator: mi, which is the limit of mitas t goes to infinity as follows:•ni=limt→∞nitandmi=limt→∞mit=ri+ni.With these notations, we formally introduce two ways of classifying regular demand: period type and limit type, in Definition 4.1.Definition 4.1Fori=1,2andj=3−i,class i of regular demand has a period type of High in period t if mit≥ mjt, and a period type of Low otherwise. The class of demand with a period type of High (or Low) is referred to as the PH (or PL) demand. Class i of regular demand has a limit type of High if mi≥ mj, and a limit type of Low otherwise. The class of demand with a limit type of High (or Low) is referred to as the LH (or LL) demand.The difference between period type and limit type is essentially whether the impact of t, the current period, is considered. Naturally, the definition that takes into consideration the impact of t is about period types, and the definition that brings limit into consideration is about limit types.Note that, whether it is period type or limit type, the class of regular demand with a higher criterion value is referred to as the high type.Next we investigate the properties of mitand mi, which are at the core of our demand classifications.An increase in either unit revenue (ri) or unit backlogging cost (bi) results in both a higher mitand a higher mi. While rihas the same impact on both mitand mi, mitand miincrease at different rates as bigoes up. This is due to the fact that backlogging costs accumulate over periods in which the corresponding demand remains unsatisfied. Therefore, whether t is a part of the criterion value matters. It might be natural for one to expect the class of regular demand with a higher limit type to have a higher period type as well. However, given how biimpacts mitand mi, it is also possible for the class of regular demand with a higher limit type to have a lower period type. Lemma 4.2 below quantifies when period type and limit type are consistent and when they are not.Lemma 4.2Fori=1,2andj=3−i,there exists TO≥ 0 such that given mi≥ mj, (i) if T ≤ TO, then mit< mjt fort=1,2,⋯,T; (ii) if T > TO, then t ≤ TO⇒ mit< mjt and TO< t ≤ T ⇒ mit≥ mjt.Lemma 4.2 establishes a period threshold TO. Basically, if there are enough number of periods left before the end of the planning horizon (i.e. t > TO), then the regular demands’ period and limit types are consistent; otherwise they are inconsistent.As noted earlier, birepresents the firm’s relationship with a customer. Consider a customer whose demand carries a relatively smaller unit revenue ri. If this customer is not as valued to the firm as the source of the other demand, then this customer’s demand has a relatively smaller biand is always of the low type both period-wise and limit-wise. If this customer has a relatively bigger bi, then it is possible for the corresponding demand to be of the high type both period-wise and limit-wise. First of all, bihas to be big enough for mi(the limit of mit) to exceed mj. This way, the customer’s demand is of the limit high (LH) type. Lemma 4.2 shows that an LH demand (mi≥ mj), however, is not guaranteed to also be a period high (PH) demand. In a period that is faraway enough from the end of the planning horizon, bican accumulate over enough number of periods to compensate for the relatively lower riand result in a relatively bigger mit. Depending on the relative sizes of ri, bi, rjand bj, the threshold period TOcan be any integer between 0 and infinity. The bigger TOis, the more periods it takes for bito accumulate to a point that the class of demand with a bigger biis period high (PH). In other words, given a planning horizon that is long enough, if a customer is important/valuable enough to the firm (i.e. has LH demand), there are definitely periods in which this customer’s demand is of the period high (PH) type.Based on the definitions of period and limit types, we are able to identify, in later sections, conditions under which the PH demand dominates the PL demand. Intuitively, the dominant demand type should be assigned a higher priority. The conditions for the existence of a dominant demand, thus, help us describe the optimal policies.What mitrepresents is the maximal loss from backlogging a unit of class i demand in period t. The actual backlogging loss of a unit of class i demand depends on the amount of unsatisfied demand from each regular demand class, and the firm’s capacity allocation decisions in future periods. Specifically, when zitunits of class i demand and zjtunits of class j demand are currently being backlogged, postponing the fulfillment of an additional unit of class i demand results in a loss of revenue riand a backlog penalty of biin period t. Note thatri+bi=mi1. The marginal impact of the action on profits from future periods can be expressed byαE(Gt−1)i′(zt+D),where α is the discount factor andE(Gt−1)i′(zt+D)=∂EGt−1(zt+D)∂zit. With this understanding, we definem¯it(zit,zjt):=mi1−αE(Gt−1)i′(zt+D)and refer tom¯it(zit,zjt)as the Dynamic Loss (DL) for class i in period t.We further define the Starting Dynamic Loss (SDL)m¯itSand the Limiting Dynamic Loss (LDL)m¯itL. By setting (zit, zjt) to specific values, we have:m¯itS=m¯it(0,0),m¯itL=limzjt→∞m¯it(0,zjt).Since the best the firm can do with regard to regular demand alone is not to backlog at all, we know thatm¯itSdoes not exceedm¯itL. A more thorough study of dynamic losses is in Lemma 4.3, which examines howm¯itchanges as decision variables change and how one class’s dynamic losses compare to the other class’s.Lemma 4.3Fori=1,2andj=3−i,m¯it(zit,zjt)has the following properties: 1.∂m¯it∂zit≥∂m¯it∂zjt≥0and∂m¯it∂zit≥∂m¯jt∂zit; 2. for any z ≥ 0,m¯it(zit,zjt+z)≤m¯it(zit+z,zjt); 3.m¯itS≤m¯itL≤mit; 4. Given mit≥ mjt, if mi≥ mj thenm¯itS≥m¯jtS; otherwise,m¯itL≥mjt⇒m¯itS≥m¯jtS.The metrics mit’s also lead to bounds on capacity reservation, which depends crucially on how the unit lost revenue cecompares to the loss from backlogging a unit of regular demand. Although the backlogging loss is affected by when the backlogged demand is eventually fulfilled, it is bounded from above by mit, which is the maximal loss from period t and onward. If the firm had only one class of regular demand and needed to allocate its capacity between emergency demand and the regular demand, the Newsvendor logic could be applied in capacity reservation. Adopting mitas the overage cost and(ce−mit)+the underage cost, we defineC¯itas follows. Fori=1,2,C¯it={Fe−1(1−mitce),ifce≥mit;0,ifce<mit.Since mitis a unit of class i demand’s ML (maximal loss) thereafter if backlogged in period t,C¯itis the minimal capacity reservation for emergency demand from class i’s perspective. Note that when ce< mit,C¯itis forced to zero. In that case, there should be no reservation for emergency demand at all if class i constitutes the only class of regular demand.Since the value of mitdepends on the period t in question, the length of the planning horizon also affects how cecompares to mit. We show in Lemma 4.4 the existence of horizon length thresholds that allow mitto overtake ce.Lemma 4.4Fori=1,2,there exist aTiothat satisfies the following conditions.1.IfT≤Tio,then ce≥ mit for allt=1,⋯,T;IfT>Tio,thent≤Tio⇒ce≥mitandTio<t≤T⇒ce<mit.With notations and preliminary analysis introduced in earlier sections, we are ready to present our solution approach.The goal of the firm is to maximize the function Vt(zt, Xt) with respect to a two-dimension vector zt, subject to the constraintzt∈Zt(xt). Recall thatVt(zt,Xt)=∑i=12−(ri+bi)zit−ceE[De−(C−Xt+Zt)]++αEGt−1(zt+D)andZt(xt)={(z1t,z2t∣0≤zit≤xit,Xt−C≤Zt}.Our analysis starts with a relaxation of the constraints on the decision variables. Specifically, we relaxZt(xt)toZtr(Xt)={(z1t,z2t)∣0≤zit≤Xt,Xt−C≤Zt≤Xt},With the relaxation, the decision variables z1tand z2tare both constrained by the aggregate amount of unsatisfied demand Xt, rather than by x1tand x2trespectively. The relaxation reduces the dimensions of the constraints and therefore simplifies the analysis.Under the relaxation, we would like to establish for each regular demand class a best response functionz¯it(zjt,Xt),corresponding to a given Xt. Naturally, we need to make use of the first order derivatives of Vt(zt, Xt). Fori=1,2andj=3−i,we havevit(zit,zjt,Xt)=∂Vt∂zit(zt,Xt)=−mi1+ceFe¯(Zt−Xt+C)+αE(Gt−1)i′(zt+D),wheremi1=ri+biandE(Gt−1)i′(zt+D):=∂EGt−1(zt+D)∂zit.Now we formally definez¯it(zjt,Xt)as follows:(1)z¯it(zjt,Xt)=argmin[Xt−(C−C¯it)−zjt]+≤zit≤Xt−zjt|vit(zit,zjt,Xt)|.Note that zit: the amount of class i demand to be backlogged in period t, cannot exceedXt−zjtbecause Xtis the aggregate amount of unsatisfied regular demand in period t. On the other hand, if the capacity reservation isC¯it: the minimal level from class i’s perspective,C−C¯itunits of capacity will be used on fulfilling regular demand. That is, at least[Xt−(C−C¯it)]+units of regular demand should be backlogged in period t. Given that zjtunits of class j demand are to be backlogged in period t, zitmust be bounded from below by eitherXt−(C−C¯it)−zjtor 0, whichever is bigger.The intersection ofz¯it(zjt,Xt)andz¯jt(zit,Xt)gives us an equilibrium optimal:(2)zte(Xt)=argminzt∈Zte(Xt)|v¯it(zit,zjt)|,whereZte(Xt)={(zit,zjt)|z¯it(zjt,Xt)−zit=0z¯jt(zit,Xt)−zjt=0}andv¯it(zit,zjt)=vit(zit,zjt,Xt)−vjt(zjt,zit,Xt)=−{mi1−αE(Gt−1)i′(zt+D)}+{mj1−αE(Gt−1)j′(zt+D)}.Recall that we obtain the equilibrium optimalzteby relaxing the action space fromZt(xt)toZr(Xt). By imposing the constraint zt≤ xtonzte,we can return to the original action space and the original optimization problem.Denote byzt*the optimal solution. Ifzte(Xt)≤xt,thenzt*(xt)=zte(Xt). Otherwise, at least one of the dimensions inzteneeds to be truncated to its counterpart in xt. For example, ifzite(Xt)>xit,then the optimal solution must havezit*=xit. In this case, not processing any unit of class i demand in period t is the optimal decision. Ultimately, we have(3)zit*(xt)=1(xt≥zte)zite(Xt)+1(xit<zite)xit+1(xjt<zjte)z¯it(xjt,Xt),zjt*(xt)=1(xt≥zte)zjte(Xt)+1(xit<zite)z¯jt(xit,Xt)+1(xjt<zjte)xjt.The technical statements that lead to the validation ofz¯it(zjt,Xt),zte(Xt),andzt*(xt)are included in Appendix A.3. The proofs of those statements involve inductions properties (listed in Appendix A.2), which should hold for any period t.Now we have presented our solution approach. It is still unclear, though, what the optimal policy looks like. We characterize the optimal policy in Section 5 through structural results that identify switching curves. Those switching curves segment the state space and speed up the search for the optimal solution.The optimal policy should tell the firm what to do at any possible point within the state spaceΩt={(x1t,x2t)∣xit≥0andx1t+x2t>0}. Our first step toward describing the optimal policy is defining four non-overlapping regions within the state space Ωt, which is the first quadrant excluding the origin. It is not surprising that for states that are next to each other, optimal actions are of the same or similar characteristics, suggesting that the optimal actions taken by states belonging to the same region share a common structure. By describing the characteristics of the optimal actions, we can distinguish one region from another.Below is our definition of the four regions.Definition 5.1We can define four regions in Ωt, each featuring a unique pattern forzt*(xt):1.Full-Reservation regionΩtF: whenxt∈ΩtF,all C units of capacity are reserved for emergency demand. That is,zt*(xt)=xt.Only-High regionΩtH: whenxt∈ΩtH,no capacity is allocated to the PL demand, and the PH demand always gets some capacity. Mathematically, if mit≥ mjt, we havezit*=z¯it(xjt,Xt)<xitif xit> 0 andzjt*=xjt.Only-Low regionΩtL: whenxt∈ΩtL,no capacity is allocated to the PH demand, and the PL demand always gets some capacity. Mathematically, if mit≥ mjt, we havezjt*=z¯jt(xit,Xt)<xjtif xjt> 0 andzit*=xit.Diagonal-Stable regionΩtS: whenxt∈ΩtS,both classes of regular demand are assigned some capacity, and for any given Xt, the total amount of regular demand to be backlogged in period t is a constant. Mathematically,zt*(xt)=zte(Xt).Next we explain how to determine which region any given state (x1t, x2t) should be in. Section 5.1 offers a general outlook of the landscape. Sections 5.2 and 5.3 provide refined descriptions of the regions under different scenarios. Section 5.4 summarizes the optimal policy.Recall thatC¯1tandC¯2trepresent the minimal capacity that must be reserved for emergency demand from the perspective of class 1 and class 2 demand, respectively. We compare the firm’s capacity C toC¯1tandC¯2tin this section. Different ordinal ranks lead to different optimal solutions. We present the general results in Theorems 5.2, 5.3, and 5.5.If the firm’s capacity is so tight that it covers neitherC¯1tnorC¯2t,the firm has to reserve all its capacity for emergency demand. Theorem 5.2 below formalizes what it means for the firm to be tight on capacity.Theorem 5.2IfC≤(C¯1t∧C¯2t),thenΩt=ΩtF; otherwiseΩtF=∅.The Full-Reservation region calls for the devotion of the firm’s full capacity to emergency demand. Theorem 5.2 shows that when the conditionC≤(C¯1t∧C¯2t)is met, the Full-Reservation region is the same as the state space, and therefore the firm’s optimal decision is no longer affected by the state vectorxt=(x1t,x2t). Theorem 5.2 also indicates that the Full-Reservation region disappears completely once the firm’s capacity exceeds the minimum ofC¯1tandC¯2t. That is, as the firm’s capacity gets larger, some regular demand will be fulfilled.Next we examine in Theorem 5.3 what happens when the firm’s capacity is betweenC¯1t∧C¯2tandC¯1t∨C¯2t. We find that no PL demand will be satisfied in this case. Recall that the PL demand has a smaller ML (Maximal Loss). The definition of minimal capacity reservation implies that the class of regular demand with a smaller ML has a larger minimal reservation. That is, the minimal capacity reservation from the PL demand’s perspective isC¯1t∨C¯2t. When the firm’s capacity C is smaller thanC¯1t∨C¯2t,letting the PL demand wait costs the firm less than losing emergency demand.We show in Theorem 5.3 that when the firm’s capacity is betweenC¯1t∧C¯2tandC¯1t∨C¯2t,the firm will first reserveC¯1t∧C¯2tunits of capacity for emergency demand, then allocate the remaining capacity between the PH demand and emergency demand. If class i is the PH demand, the allocation depends on two thresholds:Xitp(as the low threshold) andXitc(as the high threshold). Their mathematical definitions are in Appendix A.3. If the amount of unsatisfied PH demand is smaller thanXitp,the remaining capacity is enough to satisfy all the PH demand and provide additional reservation for emergency demand. If the amount of unsatisfied PH demand is larger thanXitc,all the remaining capacity will be used on the PH demand and there will still be PH demand remaining unfulfilled. If the amount of unsatisfied PH demand is betweenXitpandXitc,out ofC−C¯1t∧C¯2tunits of capacity, some will be reserved for emergency demand and the rest will be used on the PH demand, which will again not be fulfilled completely.Theorem 5.3Suppose(C¯1t∧C¯2t)<C≤(C¯1t∨C¯2t). We haveΩt=ΩtH. Furthermore, if class i of regular demand is the PH demand and class j is the PL demand in period t, that is, mit≥ mjt, the following statements will hold. (1) If0≤xit≤Xitp,C¯itor more units of capacity are reserved for emergency demand, and all the PH demand are satisfied; (2) ifXitp≤xit≤Xitc,C¯itor more units of capacity are reserved for emergency demand, and onlyxit−z¯it(xjt,Xt)units of the PH demand are satisfied, withz¯it(xjt,Xt)≥xit−(C−C¯it),∂z¯it∂xit∈[0,1],and∂z¯it∂xjt=0; (3) ifXitc≤xit,exactlyC¯itunits of capacity are reserved for emergency demand while the rest of the capacity is used on the PH demand but can only satisfy a fraction of it.When the firm’s capacity exceedsC¯1t∨C¯2t,the minimal capacity reservation is met from the perspectives of both classes of regular demand. It is not surprising that we can always find states at which both the PH and PL demand are at least partially fulfilled. That is, the Diagonal-Stable region will not be an empty set when the firm’s capacity exceedsC¯1t∨C¯2t. Recall that the optimal solution in the Diagonal-Stable region iszt*(xt)=zte(Xt)(as stated in the definition of the Diagonal-Stable region), which depends on Xt. For this reason, we establish four thresholds on Xt.•XtFSis the aggregate amount of unsatisfied regular demand below which both classes of regular demand are Fully Satisfied. That is,Xt≤XtFS⇔zte(Xt)=(0,0).XtPSis the aggregate amount of unsatisfied regular demand beyond which both classes of regular demand are Partially Satisfied. That is,Xt>XtPS⇔zte(Xt)>(0,0).XtMRis the aggregate amount of unsatisfied regular demand beyond which the firm makes a Minimal Reservation(C¯1t∨C¯2t)for emergency demand. That is,Xt>XtMR⇔Xt−(z1te+z2te)=[C−(C¯1t∨C¯2t)]+.XtLIis the aggregate amount of unsatisfied regular demand beyond which the desired amount of PL demand to be backlogged is Linearly Increasing in Xtat the rate of 1. That is, when mit≥ mjt, we haveXt≥XtLI⇔∂zjte∂Xt=1and∂zite∂Xt=0.In Lemma 5.4 below, we verify the existence of the above four thresholds, and establish the relationships among them.Lemma 5.4GivenC>(C¯1t∨C¯2t),we have∂z1te∂Xt∈[0,1],∂z2te∂Xt∈[0,1]and∂z1te∂Xt+∂z2te∂Xt<1. The four thresholds{XtFS,XtPS,XtMR,XtLI}can be identified, and have the following properties whenm¯itS≥m¯jtS:1.IfmitL≥mjt,then0<XtFS≤XtMR=XtLI<XtPS=∞,zite(Xt)=0,andv¯it(zite,zjte)≤0.Ifm¯itL<mjtandce>(m¯it∧m¯jt),then0<XtFS≤XtPS≤XtMR=XtLI<∞.Ifm¯itL<mjtandce≤(m¯it∧m¯jt),then there existsm¯itE∈[m¯itS,m¯itL]such that ifce≤m¯itEthen0<XtFS≤XtMR≤XtPS≤XtLI<∞; otherwise,0<XtFS<XtPS≤XtMR≤XtLI<∞.Givenm¯itL<mjt,ifXt<XtPS,thenzite(Xt)=0andv¯it(zite,zjte)≤0; otherwisev¯it(zite,zjte)=0.As suggested by intuition,XtFSis the smallest threshold among the four. The ordinal ranks ofXtPS,XtMR,andXtLIare affected by various DL’s althoughXtMRnever exceedsXtLI. Lemma 5.4 specifies the possibilities.The conditionm¯itS≥m¯jtSin Lemma 5.4 implies that the very first unit to backlog should be from class j demand, since the expected backlogging loss caused by class j demand is smaller. Ifmjt≤m¯itL,the firm should keep backlogging class j demand; otherwise, start backlogging class i demand.We introducem¯itEin Lemma 5.4 and refer to it as class i demand’s Equal Dynamic Loss (EDL), since whenever ceequalsm¯itE,XtMRequalsXtPS,namely, partial fulfillment of both classes of regular demand occurs at the same time when capacity reservation for emergency demand is lowered to exactlyC¯1t∨C¯2tunits.Note that whenXtPS=∞,partial fulfillment of both classes of regular demand is not allowed. There are two cases that exclude partial fulfillment of both regular demand classes: (1) One of the regular demand classes is fully satisfied and the other partially satisfied (or not satisfied at all). (2) One of the regular demand classes is partially satisfied and the other not satisfied at all. In either cases, one class of regular demand seems to dominant the other class.As indicated by their definitions, each of the four thresholds on Xtrepresents a beginning or an end to a pattern of the optimal solution. The thresholds, therefore, are key to the description of the optimal policy.As explained earlier, when the firm’s capacity C exceedsC¯1t∨C¯2t,the Diagonal-Stable region is not an empty set. Both regular classes of demand are processed in period t within the Diagonal-Stable region and we have z*(xt) < xtfor the region. That is,ΩtS={(xit,xjt)≥0|xit+xjt=Xt,xit>zite(Xt),xjt>zjte(Xt)}.Intuitively, when the Diagonal-Stable region exists, the Only-High and Only-Low regions, if both are valid, must be on different sides of the Diagonal-Stable region. Given a fixed amount of the PL demand, the optimal policy looks like this: satisfying only the PL demand if the amount of unsatisfied PH demand is small enough (may be zero); satisfying both the PH and the PL demand if the amount of unsatisfied PH demand grows, and satisfying only the PH demand if the amount of unsatisfied PH demand exceeds a higher threshold. The thresholds form the boundaries between the regions. Characterizing the optimal policy involves characterizing the boundaries.For ease of presentation and without loss of generality, we will assume, for the rest of the paper, that class i of the regular demand is the PH demand and class j is the PL demand in period t, that is, mit≥ mjt.Denote byHtandLtthe borders connecting the Diagonal-Stable region to the Only-High and Only-Low regions, respectively. We haveHt={(xit,xjt)≥0|xit+xjt=Xt,xit>zite(Xt),xjt=zjte(Xt)},Lt={(xit,xjt)≥0|xit+xjt=Xt,xjt>zjte(Xt),xit=zite(Xt)}.Note that the Only-High and Only-Low regions can be expressed mathematically as follows:ΩtH={(xit,xjt)≥0|xit+xjt=Xt,xit>zite(Xt),xjt≤zjte(Xt)},ΩtL={(xit,xjt)≥0|xit+xjt=Xt,xjt>zjte(Xt),xit≤zite(Xt)}.Theorem 5.5 finds that if the Only-Low region is reduced toLt,Ltmust be the axis representing the amount of unsatisfied PL demand. At any state within such a line-shaped Only-Low region, there is no unsatisfied PH demand. There are two conditions under either of which the Only-Low region is reduced toLt: (i) the period types and limit types of the regular demand are consistent; or (ii) the period types and limit types of the regular demand are inconsistent, and the LDL of the PH demand is higher than the ML of the PL demand. Condition (i) is easy to grasp because when the PH demand is also the LH demand, it is apparently more costly than the PL (also LL) demand if not satisfied. In this case, if the Only-Low region does exist, it must be that there is no unsatisfied PH demand at all. Condition(ii) is a little more complicated. When the PH demand is no longer the LH demand, the priority of the PH demand is weakened. By requiring the LDL of the PH demand to be higher than the ML of the PL demand, condition (ii) strengthens the priority of the PH demand, making the reduction of the Only-Low region toLtreasonable. We state Theorem 5.5 formally below.Theorem 5.5GivenC>(C¯1t∨C¯2t),we haveΩt=ΩtL+ΩtS+ΩtHandΩtS≠∅. Specifically, given mit≥ mjt, we have (1)ΩtL=Lt⇔Lt={(xit,xjt)∣xit=0,xjt>0}; (2.1) if mi≥ mj, thenΩtL=Lt; (2.2) if mi< mj, thenm¯itL≥mjt⇔ΩtL=Lt.WhenC<(C¯1t∧C¯2t),the types of the regular demand do not matter because no regular demand will be processed. When(C¯1t∧C¯2t)<C≤(C¯1t∨C¯2t),the period type, not limit type, matters as the firm prioritizes its demand. Specifically, the PH demand’s priority over the PL demand is definitive when(C¯1t∧C¯2t)<C≤(C¯1t∨C¯2t). When(C¯1t∨C¯2t)<C,both period type and limit type matter. We define the dominant PH demand scenario as the case in which one of the conditions for the reduction of the Only-Low region toLtholds, because under such scenario the PL demand is never fulfilled before all the PH demand is processed. We define the non-dominant PH demand scenario as the case in which neither of the aforementioned conditions is met. In order to further characterize the optimal policy, we discuss the dominant and non-dominant PH demand scenarios in Sections 5.2 and 5.3, respectively.Theorem 5.5 has shown that when the PH demand is dominant, the Only-Low region is reduced toLt,which sits on the axis representing the PL demand. Our focus, in this section, is therefore on the internal structures of the Diagonal-Stable and the Only-High regions.Within the Diagonal-Stable region, both the PH and PL demand are processed, at least partially. Because of the priority the PH demand has over the LH demand here in Section 5.2, the fulfillment of the PL demand implies that no PH demand will be backlogged. In other words, if a statext=(xit,xjt)belongs to the Diagonal-Stable region, the optimal policy requires that all xitunits of the PH demand be fulfilled in period t. Whether all xjtunit of the PL demand will be fulfilled depends on howXt=xit+xjtcompares to thresholdsXtFSandXtMR.Recall thatXtFSis defined as the aggregate amount of unsatisfied regular demand below which both classes of regular demand are fully satisfied andXtMRis the aggregate amount of unsatisfied regular demand beyond which the firm makes a minimal reservation(C¯it∨C¯jt)for emergency demand. With mit≥ mjt, we haveC¯jt=(C¯it∨C¯jt).Lemma 4.3 in Section 4.2 has shown that if the PH demand is dominant, namely, either (i) mi≥ mjor (ii) mi< mjandm¯itL>mjt,thenm¯itS≥m¯jtS. Satisfaction of the last condition allows us to apply Lemma 5.4 in Section 5.1.2, and doing so tells us that0<XtFS≤XtMR=XtLI<XtPS=∞. Note thatXtLIis the aggregate amount of unsatisfied regular demand beyond which the desired amount of PL demand to be backlogged is linearly increasing in Xtat the rate of 1. So,XtMR=XtLIsuggests that as soon as the reservation for emergency demand is lowered to exactlyC¯jtunits, every additional unit of the regular demand should translate into an additional unit of the PL demand being backlogged. Also note thatXtPSis the aggregate amount of unsatisfied regular demand beyond which both classes of regular demand are partially satisfied. The result thatXtPS=∞is consistent with the fact that no PL demand can be processed before all the PH demand is fulfilled, which is due to the dominance of the PH demand in this section.Corollary 5.6 formalizes the characterization of the Diagonal-Stable region.Corollary 5.6SupposeC>(C¯1t∨C¯2t)and mit≥ mjt. Either (i) mi≥ mj or (ii) mi< mj andm¯itL>mjt. For anyxt∈ΩtS,zit*=0,zjt*<xjtif xjt> 0 andzjt*=0ifxjt=0,and∂zjt*∂xit=∂zjt*∂xjt. Furthermore, 1.Xt≤XtFS⇒zjt*=0,2.XtFS<Xt<XtMR⇒∂zjt*∂xit∈(0,1),and 3.XtMR≤Xt⇒zjt*=Xt−C+C¯jt.Basically, if Xtis small enough (≤XtFS), all xjtunits of the PL demand will be satisfied andC−(xit+xjt)=C−Xtunits of capacity are reserved for emergency demand. SinceXtFS≤XtMRwe know thatC−Xtshould be at least the minimal reservation capacityC¯jt=C¯it∨C¯jtwhen Xt≤ XFS. If Xtis big enough (≥XMR), the firm’s C units of capacity should be divided into three groups:C¯jtunits will be reserved for emergency demand, xitunits will be used to fulfill all the PH demand, and the rest (xjt−zjt*) units of capacity will be used to fulfill the PL demand wherezjt*isC¯jt+xit+xjt−C=Xt−(C−C¯jt),the difference between the aggregate amount of unsatisfied regular demand Xtand the firm’s capacity after the minimal reservationC¯jt. So, whenXt≥XtMR,every additional unit of the regular demand translates into an additional unit of the PL demand being backlogged. Interestingly, sincezjt*,the optimal amount of the PL demand to be backlogged in period t, is determined by Xt, as opposed to xjt,zjt*is affected by the amount of unsatisfied PH and PL demand equally, instead of by the amount of unsatisfied PL demand alone. If Xtis betweenXtFSandXtMR,zjt*is between zero andXt−(C−C¯jt). Furthermore, an additional unit of regular demand does not necessarily result in an increase inzjt*because the capacity reservation for emergency demand can be lowered fromC−XtFStowardC¯jtwhenXtFS<Xt<XtMR.It is interesting to note that for any state in the Diagonal-Stable region that corresponds to a given Xt, the optimal amount of the PH demand to be backlogged is zero and the optimal amount of the PL demand to be backlogged is a constant. Recall thatHtis the Diagonal-Stable region’s border with the Only-High region. LetHt(Xt)represent the intersection ofHtand the diagonal line that contains all the states with the same aggregate amount of unsatisfied regular demand: Xt. The optimal amount of the PL demand to be backlogged given Xtis just the coordinate ofHt(Xt)that represents the PL demand.For the Only-High region, our focus is on the optimal amount of the PH demand to be backloggedzit*(xt).When the horizontal axis represents the unsatisfied PH demand, the Only-High region is to the right of the Diagonal-Stable region. Recall thatHtis the border between the Only-High region and the Diagonal-Stable region. That is, all points inside the Only-High region are to the right ofHt. In order to describe howzit*changes within the Only-High region, we further define two switching curves:HtFandHtM.HtFis closer toHtthanHtMis. If xtis betweenHtandHtF,thenzit*=0(i.e. all the unsatisfied PH demand will be fulfilled in period t) and at leastC¯itunits of the firm’s capacity are reserved for emergency demand. If xtis betweenHtFandHtM,then some PH demand will be backlogged and at leastC¯itunits of the firm’s capacity are reserved for emergency demand. If xtis to the right ofHtM,thenzit*=xit−(C−C¯it)(i.e.C−C¯itunits of the PH demand will be fulfilled) and exactlyC¯itunits of capacity are reserved for emergency demand.Recall that we use the thresholdsXitpandXitcto separate the Only-High region into three parts when(C¯1t∧C¯2t)≤C≤(C¯1t∨C¯2t)(in Section 5.1). If we were to drawHtFandHtMin that case,HtFwould be a straight line that parallels the vertical axis (representing the PL demand) and intersects with the horizontal axis (representing the PH demand) atxit=Xitp,andHtMwould also parallel the vertical axis and intersect the horizontal axis atxit=Xitc. When(C¯1t∨C¯2t)<C,HtFstill intersects with the horizontal axis atxit=XitpandHtMstill intersects with the horizontal axis atxit=Xitc. But, neitherHtFnorHtMis a straight line when(C¯1t∨C¯2t)<C. That is, the level of the unsatisfied PL demand (i.e. xjt) affects the thresholds on xithere.We characterize the shapes and positions ofHtF,HtMandHtin Lemma A.8 in Appendix A.4.We create Fig. 1in order to show how the state space Ωtis mapped into the Only-High and Diagonal-Stable regions whenC>(C¯1t∨C¯2t),mit≥ mjt, and mi≥ mj. Note that the Full-Reservation region does not exist and the Only-Low region is reduced to the vertical border of the first quadrant under these conditions. While the shapes and sizes of the three subregions ofΩtSremain the same as cechanges, the shapes and sizes of the three subregions ofΩtHdepend on which range cefalls into.We make two observations from Fig. 1. Note that the horizontal axis represents the PH demand.•The intersection ofHtand the horizontal axis is the state at which there areXtFSunits of unsatisfied PH demand and zero unsatisfied PL demand. Given the rightward leaningHt,any state with fewer units of unsatisfied PH demand thanXtFSmust be in the Diagonal-Stable region, as opposed to the Only-High region.Although bothHtandHtFare initially rightward leaning andHtMis initially leftward leaning as they start from the horizontal axis, all three curves become straight lines when the amount of unsatisfied PL demand xjtis big enough. That is, changes in xjtno longer affect the positions of the curves when xjtis big enough.In the above two sections, we explain the structure of the optimal policy by describing the borders outlining the Diagonal-Stable and Only-High regions and the thresholds within the two regions. Based on the propositions and lemmas we provide in those sections, we are also able to plot graphs depicting the optimal policy directly. In Figs. 2–4, we present graphical illustrations of the optimal policy from various perspectives given thatC>(C¯1t∨C¯2t),mit≥ mjtand mi≥ mj. In these figures, whenever the dominant PH demand (Class i) is plotted, it is represented by the horizontal axis, and whenever the PL demand (Class j) is plotted, it is represented by the vertical axis.Our state-space is two-dimensional and so is the space for the optimal policy. Instead of attempting to plot four-dimensional figures, we show what the optimal policy looks like from the perspectives of five lines in two-dimensional figures. Fig. 2 depicts the positions of the five representative lines in the state space Ωt. Line (1) is representative of any 135 degree line within the Diagonal-Stable region. By moving Line (1) parallelly within the Diagonal-Stable region, we can cover the whole region. Line (2) is parallel to the horizontal axis. As Line (2) moves upward and downward, it can cover the whole state space. The purpose of Line (2) is to illustrate howzit*andzjt*change with respect to xitwhen xjtis fixed. Lines (3), (4) and (5) are parallel to the vertical axis. They intersect withHt,HtFandHtM,respectively. We outline the look of the optimal policy as xjtchanges when xitis fixed via Lines (3), (4) and (5).Fig. 2 also describes how to find the optimal policy for any state on Line (1). Line (1) is a 135 degree line between the vertical axis andHt,i.e. the border between the Diagonal-Stable region and the Only-High region. For each state on the 135 degree line, the corresponding optimal policy(zit*,zjt*)equals(0,zjte). Recall that we can find(zite,zjte)for each Xt, and all states on the same 135 degree line have the same Xt. For each 135 degree line, the correspondingzjteis just the vertical coordinate of the intersection of the line andHt. Note that the length of the horizontal arrow originated from a state on Line (1) represents the amount of PH demand that will be satisfied within period t and the length of the vertical arrow originated from a state on Line (1) represents the amount of PL demand that will be satisfied within period t. Clearly, all unsatisfied PH demand (xit) will be processed within period t.As shown in Fig. 2, Line (2) intersects withHt,HtF,andHtMat Points B, C, and D, respectively. We plotzit*andzjt*as functions of xitseparately in Fig. 3. In both plots, xjtis fixed atxjto,which is the vertical coordinate of Points B, C, and D.zit*starts from zero when xitis zero. As xitincreases,zit*remains at zero until xitreachesxitC,which is the horizontal coordinate of Point C.zit*increases strictly, thereafter.zit*’s rate of increase is smaller than one before xitreachesxitD,which is the horizontal coordinate of Point D, becomes one when xitreachesxitD,and stays at one as xitcontinues to increase. Note thatzit*=xit−(C−C¯it)when xitexceedsxitD.zjt*also starts from zero when xitis zero. As xitincreases,zjt*stays at zero initially and then increases strictly until xitreachesxitB,which is the horizontal coordinate of Point B. At that state, which is(xitB,xjto),zjt*equalsxjto. As xitcontinues to increase,zjt*stays atxjto. Note that Line (2) enters the Only-High region once it crosses Point B from the Diagonal-Stable region.Line (3) is parallel to the vertical axis and intersectsHt(the border between the Diagonal-Stable and the Only-High regions) at Point B. The higher part of Line (3) is inside the Diagonal-Stable region and the lower part is inside the Only-High region. For any state on Line (3),zit*=0. In the first plot of Fig. 4, we fix xitatxitB,i.e. the horizontal coordinate of Point B, and plot howzjt*changes as xjtincreases. We write (3) on the vertical axis of this plot to distinguish it from others.zjt*increase strictly as xjtincreases. Initially,zjt*=xjt. That is,zjt*’s rate of increase is one. The rate drops below one after xjtreachesxjto. The smaller-than-one rate lasts for a while as xjtincreases. Eventually, the rate of increase goes up to one. Once there,zjt*=xjt+xitB−(C−C¯jt)andzjt*’s rate of increase stays at one as xjtcontinues to increase. That is, for states lower than Point B on Line (3),zjt*increases at the same rate as xjt; for states higher than Point B on Line (3),zjt*increases slower than xjtinitially as a result of going from the Only-High region to the Diagonal-Stable region, butzjt*’s rate of increase eventually goes up to one.Lines (4) and (5) are parallel to the vertical axis and intersectHtFandHtMat Points C and D, respectively. Lines (4) and (5) are inside the Only-High region because the thresholdsHtFandHtMare within the Only-High region. The definition of the Only-High region implies that for any state on Lines (4) and (5),zjt*equals xjt. For Lines (4) and (5), we fix xitatxitCandxitD,respectively, and plotzit*as xjtchanges in Fig. 4. We write (4) on the vertical axis in the plot for Line (4) and do the same for Line (5). For Line (4), as xjtincreases,zit*decreases strictly until xjtreachesxjto,which is the vertical coordinate of Points B, C and D.zit*drops to 0 whenxjt=xjtoand stays at 0 as xjtfurther increases. The optimal policy for Line (5) is similar but slightly different. For Line (5), as xjtincreases,zit*also decreases strictly until xjtreachesxjto. However,zit*is strictly positive whenxjt=xjto. At the state(xitD,xjto),zit*=xitD−(C−C¯it). As xjtfurther increases,zit*remains the same.When t ≤ TO, the regular demand’s period and limit types are inconsistent. Given our assumption of mit≥ mjt, we have mi< mjin period t ≤ TO. In addition to the inconsistency of period and limit types, we also requiremjt≤m¯itLto hold for the PH demand to be non-dominant. We examine what happens under these conditions in this section. As in the previous section, we use the horizontal axis to represent the PH demand in our graphical descriptions.The analysis on the Only-High region when the PH demand is non-dominant is similar to that in Section 5.2. Again, the characterizations of the switching curvesHtFandHtMare at the core of the analysis. The shapes ofHtFandHtM,however, are more varied as shown in Fig. 5. The non-dominance of the PH demand implies that more parameter comparisons are needed when determining the optimal policy.When the PH demand is dominant, we need to know where celands with respect to the interval[mjt,m¯itL]. When the PH demand is non-dominant, we need to know where celands with respect to either the interval[m¯itE,mjt]or the interval[m¯jtE,mjt],in addition to the ordinal ranks ofm¯itSandm¯jtS. Lemmas A.9 and Appendix A.10 in Appendix A.4 provide the details.In the Only-Low region, the PH demand is not satisfied at all (zit*=xit) and the amount of the PL demand to be backlogged iszjt*=z¯jt(xit,Xt)in period t.As in the Only-High region, we can also identify two switching curvesLtFandLtMhere, splitting the Only-Low region into three areas with unique patterns ofzjt*. Since the horizontal axis represents the PH demand, the Only-Low region is to the left of the Diagonal-Stable region with the borderLtbetween them.LtFis closer toLtthanLtMis. If the state xtis betweenLtandLtF,thenzjt*=0(i.e. all the PL demand will be fulfilled). If xtis betweenLtFandLtM,then some PL demand will remain unfulfilled and at leastC¯jtunits of capacity are reserved for emergency demand. If xtis to the left ofLtM,thenzjt*=xjt−(C−C¯jt)and exactlyC¯jtunits of capacity are reserved for emergency demand. Lemmas A.11 and Appendix A.12 in Appendix A.4 describe the shapes and positions ofLtFandLtMunder various parameter combinations.Although the two regions share structural similarities, the Only-High and Only-Low regions are not symmetrical. The Only-high region has a lower bound on the PH demand and no upper bound on the PL demand while the Only-Low region has a lower bound on the PL demand and also an upper bound on the PH demand. That is, for the PH (or the PL demand) to be the sole type of regular demand that gets any capacity allocation, the amount of unsatisfied PH (or PL) demand must exceed certain threshold. Meanwhile, if there is too much unsatisfied PH demand, the firm will have to allocate some capacity to it. However, it is possible for the firm to fulfill only the PH demand even if the amount of unsatisfied PL demand goes to infinity.Inside the Diagonal-Stable region, both classes of the regular demand are processed. That is,zt*<xt. Applying the definition ofzte(from Section 4.4), we know thatzt*=zte(Xt)<xtfor each state inside the Diagonal-Stable region. The optimal amount of demand to be backlogged (zt*) is therefore affected by the state xtthrough the aggregate amount of unsatisfied regular demand (Xt). The internal structure of the region and the borders of the region, namely,LtandHt,are all driven by the value of Xt.Recall that we need the thresholdsXtFSandXtMR=XtLIon Xtwhen discussing the Diagonal-Stable region in the dominant PH demand scenario. When the PH demand is non-dominant,XtLIis no longer guaranteed to equalXtMRandXtPSis no longer infinity. Recall thatXtPSis the aggregate amount of unsatisfied regular demand beyond which both classes of regular demand are partially satisfied. These four thresholds:XtFS,XtPS,XtMR,andXtLI,shape the turning points of the optimal policy and segment different patterns of the optimal policy in the Diagonal-Stable region in the non-dominant PH demand scenario. The ordinal ranks of the four thresholds are discussed in Lemma 5.4 in Section 5.1.2. The possibilities listed there shed light on the characterization of the optimal policy here.Xtmust be in one of these three intervals:[0,XtFS],(XtFS,XtLI),and[XtLI,+∞). LetB=H,L. We useBt(Xt)to denote a point onBtsuch that the aggregate amount of unsatisfied regular demand is Xtat the state. The coordinates ofBt(Xt)areBit(Xt)andBjt(Xt).•WhenXt≤XtFS,it is clear thatLt(Xt)=(0,Xt)andHt(Xt)=(Xt,0).WhenXt≥XtLI,by the definition ofXtMRandXtLI,we know∂Hit∂Xt=∂Lit∂Xt=0,∂Hjt∂Xt=∂Ljt∂Xt=1,andHit−Lit=C−C¯jt.WhenXtFS<Xt<XtLI,Bit(Xt)=Xt−Bjt(Xt)forB=H,L. Under this condition, Lemma 5.7 characterizes the shapes and positions ofLtandHt,making use of the thresholdsXtPSandXtMR.Lemma 5.7Letp=iifm¯jtS≤m¯itSandp=jotherwise. ConsiderC>(C¯it∨C¯jt). Given mit≥ mjt, mi< mj,m¯itL<mjt,andXtFS<Xt<XtLI,we have1.If ce≥ mjt, (i)Xt≤XtPS⇒∂Ipt∂Xt∈(0,1)andJpt=0; (ii)XtPS≤Xt<XtLI⇒∂Ipt∂Xt,∂Jpt∂Xt∈(0,1).Ifmjt>ce≥m¯ptE,(i)Xt≤XtPS⇒∂Ipt∂Xt∈(0,1)andJpt=0; (ii)XtPS≤Xt<XtMR⇒∂Ipt∂Xt,∂Jpt∂Xt∈(0,1); (iii)XtMR≤Xt<XtLI⇒Ipt−Jpt=C−C¯jtand∂Ipt∂Xt∈(0,1).Ifce<m¯ptE,(i)Xt≤XtMR⇒∂Ipt∂Xt∈(0,1)andJpt=0; (ii)XtMR≤Xt<XtPS⇒Ipt=CandJpt=0; (iii)XtPS≤Xt<XtLI⇒Ipt−Jpt=Cand∂Ipt∂Xt∈(0,1).The borders and internal structures of the Diagonal-Stable, Only-Low and Only-High regions are complicated when the PH demand is not dominant. We create Fig. 5 in order to illustrate the segmentation of the state space ΩtwhenC>(C¯1t∨C¯2t),mit≥ mjt, mi< mj, andm¯itL<mjt. Depending on which range cefalls into and howm¯itScompares tom¯jtS,the borders and internal structures of the three regions have six different looks.In Fig. 5, cases (a1), (b1), and (c1) correspond to the conditionm¯itS≥m¯jtS,and cases (a2), (b2), and (c2) are under the conditionm¯itS<m¯jtS. Since the first unit of backlogged demand should be from the class of regular demand with a smaller SDL, the Only-Low region becomes larger when the PL demand’s (class j’s) SDL exceeds the PH demand’s.The optimal policy is characterized by various thresholds and switching curves. Table 1provides a summary of the thresholds and switching curves, which segment the regions. Each segmentation features a unique pattern of optimal actions.The optimal policy involves allocating the firm’s capacity to emergency demand and two classes of regular demand. We summarize, below, the behaviors of the optimal policy from the perspectives of reservation, priority assignment and competition for capacity.Reservation property. When the PL demand is not allowed to access capacity, eitherC¯it=C¯it∧C¯jt(i.e. the minimal reservation driven by the PH demand) or more units of capacity are reserved for emergency demand. When the PL demand has a claim on capacity, eitherC¯jt=C¯it∨C¯jt(i.e. the minimal reservation driven by the PL demand) or more units of capacity are reserved for emergency demand.As long asC>(C¯it∧C¯jt),there is a threshold or switching curve beyond which the optimal reservation for emergency demand is exactlyC¯itorC¯jtunits. There is also a threshold or switching curve below which the firm reserves at leastC¯itorC¯jtunits of capacity for emergency demand in addition to satisfying all regular demand.Priority property. We identify conditions under which the PH demand is dominant. When the PH demand is dominant, the PL demand is in contention for capacity allocation only after all the PH demand is fulfilled. When the PH demand is non-dominant (i.e. mit≥ mjt, mi< mj, andm¯itL<mjt), anything can happen: both the PH demand and the PL demand could be the only class of regular demand that is fulfilled; both the PH demand and the PL demand can be partially fulfilled; either class of regular demand can be completely fulfilled while the other class is partially fulfilled.Competition property. Naturally, the more unsatisfied demand there is for one class of regular demand, the more capacity will be allocated to this class (in the weak sense). This is true whether the PH demand is dominant or not.When the PH demand is dominant, the capacity allocated to the PH demand never decreases, and may increase even as the amount of unsatisfied PL demand grows, while the capacity allocated to the PL demand never increases as the amount of unsatisfied PH demand grows. Corollary 5.8 formalizes this result.Corollary 5.8LetC>(C¯it∨C¯jt)and mit≥ mjt. Suppose either (i) mi≥ mj or (ii) mi< mj andm¯itL≥mjtholds. We haveyit*(xt)=xit−zit*(xt)with∂yit*∂xit∈[0,1],∂yit*∂xjt∈[0,1],∂yjt*∂xjt∈[0,1]and∂yjt*∂xit∈[−1,0].When the PH demand is non-dominant, the amount of capacity allocated to one class of regular demand does not always respond to changes in the competing class’s unsatisfied demand in a monotonic way. As the amount of unsatisfied demand in one class grows, the capacity allocated to the competiting class may decrease, increase, or first increase and then decrease. Several factors influence the trend, for example, ce, EDL’s, SDL’s and the state xt. Corollary 5.9 provides the details.Corollary 5.9LetC>(C¯it∨C¯jt)and mit≥ mjt. Given mi< mj andm¯itL<mjt,we haveyit*(xt)=xit−zit*(xt)with∂yit*∂xit∈[0,1]and|∂yit*∂xjt|∈[0,1]. More specifically,1.Givenm¯itS≥m¯jtS,ifce<m¯itE,thenyjt*decreases in xit; otherwise, there existx̲jt<x¯jtso that (i) ifx̲jt<xjt<x¯jt,yjt*first increases then decreases in xit; (ii) otherwise,yjt*decreases in xit.Givenm¯itS<m¯jtS,ifce<m¯jtE,thenyit*decreases in xjt; otherwise, there existx̲it<x¯itso that (i)xit≤x̲it⇒yit*decreases in xjt; (ii)x̲it<xit≤x¯it⇒yit*first increases then decreases in xjt; (iii) ifx¯it<xit,thenyit*is monotonic in xjt, andce≥mjt⇔yit*increases in xjt.The optimal policy we have characterized is complex. Its implementation requires carefully written computer programs. We design our numerical studies with two purposes in mind. First, we would like to use a numerical example to further illustrate how an optimal policy looks. Second, practitioners would be interested to know if there are simple heuristics that work well. We evaluate, here, the performance of a few heuristics in this section. Some of them reflect current industrial practices and others are designed based on our derivation of the optimal policy.The heuristics we examine here take the following steps to solve the firm’s reservation and prioritization problem: First, reserve capacity for emergency orders. Second, assign all the remaining capacity or the amount needed, whichever is smaller, to the class of regular orders with a higher priority. Third, if there is still capacity left, satisfy the class of regular orders with a lower priority as many as possible. The three steps are implemented at the beginning of each period. The heuristics differ from each other in how the reservation quantity is determined, and/or which class of regular orders is assigned a higher priority.The prioritization policies. For the prioritization problem, we examine two heuristics: OptR-LH1st and OptR-PH1st. OptR refers to the practice of choosing the optimal reservation quantity based on an exhaustive search. While LH1st always assigns a higher priority to the class of orders determined to be LH, PH1st assigns a higher priority to the class of orders determined to be PH in the current period. If the planning horizon is long enough (>TO), PH orders become LH orders in any period t > TO. In order to showcase the impact of the prioritization policies LH1st and PH1st, we design a numerical study in which the length of a planning horizon does not exceed TO. Specifically, the following parameters are considered in Numerical Study 1.α=0.98;x1T=x2T=5;r1=15;b1=2;r2=2;b2=3;C=5,10,15,20,25;ce=20,30,40,50;T=6,8,10,12.Each class of regular orders and the emergency orders have the same demand distribution, which can be one of the following: (1) uniform distribution with support [1, 10]; (2) triangle distribution with mean=5.5and coefficient of variation=0.1,0.2,0.3,0.4.We do not observe any structural change induced by probabilistic distribution parameters. The values of the thresholds are, naturally, different with different distribution parameters. We make the following observations from Numerical Study 1.□ PH1st is a much better prioritization policy than LH1st. Under each of the parameter combinations we have tested, PH1st dominates LH1st. On average, OptR-PH1st generates 53.61 percent more expected profit than OptR-LH1st does.Static prioritization policies that are similar to ABC classification are common in industry practices. LH1st is the most reasonable static prioritization policy we can think of. Nevertheless, Numerical Study 1 shows that LH1st significantly underperforms PH1st, a dynamic prioritization policy that reevaluates the regular orders’ priorities each period.□ When combined with the reservation policy OptR, PH1st’s performance is very close to that of the optimal policy. On average, the heuristic OptR-PH1st generates 0.66 percent less expected profit than the optimal policy does.PH1st adjusts in each period the regular orders’ priorities based on accumulated backlogging costs from the current period onward. This is also how the optimal policy determines the regular orders’ priority. While the optimal policy may process PL orders before all PH orders are satisfied, PH1st does not fulfill any PL orders until all PH orders are satisfied. Since PL orders are not as profitable, not processing enough PL orders does not hurt the performance of PH1st much.□ At extreme capacity levels, the benefit of applying the optimal policy is not evident. Fig. 6(a) illustrates this point.When there is ample capacity, heuristics do not hurt the firm much because most of the orders can be processed without penalty regardless of the reservation and prioritization policies. When capacity is scarce, the optimal policy does not improve the firm’s profit much because the firm has to let most regular orders wait and/or lose emergency orders anyway. When the firm’s capacity is at intermediate levels, some orders are satisfied while others have to wait or be lost. In this case, choosing the class and amount of orders to fulfill make a difference because orders belonging to different classes have different financial consequences.The reservation policies. We consider three simple reservation policies: NoR, AvgR and MinR. NoR refers to the practice of not making any reservation for emergency orders. From our conversations with practitioners, we have learned that although the necessity of reserving capacity for emergency orders is recognized, capacity reservations are rare in practice for lack of guidance. AvgR refers to the practice of reservingC¯1t+C¯2t2units of capacity for emergency orders. In MinR, the amount of capacity reserved for emergency orders depends on how xhtcompares toC−C¯lt. Ifxht≤C−C¯ltthenC¯ltunits of capacity are reserved for emergency orders. Ifxht>C−C¯ltthenC¯htunits of capacity is reserved for emergency orders. Note that the subscript h refers to either Class 1 or 2, whichever is determined to be the PH type. Similarly, the subscript l refers to either Class 1 or 2, whichever is determined to be the PL type.Matched with the prioritization policy PH1st, we evaluate three heuristics in Numerical Study 2. All the parameters except b2 take the same values here as those in Numerical Study 1. We set b2 to 1 here. As a result, the regular orders have consistent types and PH1st becomes the optimal prioritization policy. The performances of the heuristics now rest on the reservation policies of interest.We make the following observations from Numerical Study 2.□ A firm’s reservation policy has a significant impact on its expected profit. As shown in Fig. 6(b), the consequence of not making any reservation can be devastating. Simple reservation policies like AvgR and MinR definitely improve the situation but neither is guaranteed to generate expected profits close to the optimal level even when combined with the optimal prioritization policy.□ The benefit of applying the optimal reservation policy is the most evident when a firm’s capacity is at intermediate levels, as shown in Fig. 6(b). With scarce capacity, outsourcing of emergency orders and backlogging of both classes of regular orders are almost surely to happen regardless of how reservation is made. With ample capacity, most of emergency orders and regular orders will be processed with or without reservations. In these two scenarios, the expected profit resulting from PH1st-AvgR and PH1st-MinR are both close to the optimal level. When capacity is at intermediate levels, the reservation quantity affects how many orders from each class are fulfilled and hence an optimal reservation decision becomes critical.□ The performance of MinR does not dominate that of AvgR. AvgR has a static reservation level while MinR adjusts the reservation level based on how the queue length of the PH orders compares to capacity each period. Numerical Study 2 indicates that setting a fixed reservation level is not necessarily a worse policy than adjusting the reservation level periodically in a simple way. Under the optimal policy, the reservation level can be the minimal reservation quantities:C¯ltandC¯ht,or larger quantities, and choosing which quantity to use involves examinations of several factors. MinR sticks to the two minimal reservation quantities and chooses between them through a simple comparison. While MinR is much easier to implement, it adopts a reservation quantity smaller than the optimal one from time to time. Taking the average ofC¯ltandC¯htas the reservation quantity, AvgR never makes the optimal reservation, but it has a reservation quantity closer to the optimal level than MinR does when MinR choosesC¯ht<C¯ltand the optimal policy does not.Overall, we find a great prioritization policy that is simple to use: PH1st. But, a firm will not benefit much from PH1st if it is not accompanied with a good reservation policy. When a firm has extreme capacity levels, AvgR or MinR can be considered as substitutes of the optimal reservation policy. When a firm has intermediate capacity levels, applying the complicated optimal policy is worthwhile.

@&#CONCLUSIONS@&#
