@&#MAIN-TITLE@&#
Fuzzy logic steering control of autonomous vehicles inside roundabouts

@&#HIGHLIGHTS@&#
This paper shows a real experiment with autonomous vehicles in urban roundabouts.A parametric curve generation in used in the path planning, which in divided in three stages: entrance, inside and exit of the roundabout.Lane changes experiments show that the controller proposed (based on fuzzy logic) is stable.The range of speed used in the experiment is between 8km/h and 24km/h. The system was designed for 20km/h max.The real situation experiments show that our proposal is valid for urban scenarios.

@&#KEYPHRASES@&#
Soft computing,Fuzzy logic,Intelligent control,Steer control,Roundabouts,Autonomous vehicles,

@&#ABSTRACT@&#
The expansion of roads and the development of new road infrastructures have increased in recent years, linked to the population growing in large cities. In the last two decades, roundabouts have largely replaced traditional intersections in many countries. They have the advantage of allowing drivers continuous flow when traffic is clear, without the usual delay caused by traffic lights. Although roundabouts with and without traffic-signal control have been widely used and considered in the literature, driverless control on roundabouts has not been studied in depth yet. The behavior of autonomous vehicles in roundabouts can be divided into three stages: entrance, inside, and exit. The first and last may be handled as an extension of intersections. However, autonomous driving on the roundabout requires special attention. In this paper, the design and implementation of a fuzzy logic system for the steering control of autonomous vehicles inside the roundabout is proposed. Cascade architecture for lateral control and parametric trajectory generation are used. Fuzzy control has proved to be easy to define using expert knowledge. Experiments with a real prototype have been carried out, taking into account different speed profiles and lane change maneuvers inside the roundabout, with very satisfactory results.

@&#INTRODUCTION@&#
Recent automatic facilities in the field of Intelligent Transportation Systems (ITS) have improved safety and driving comfort. Different functionalities are already available in commercial vehicles, such as: cruise and adaptive cruise control [1], emergency breaking systems with assistance of active suspension [2], automatic parking systems [3], detection of vehicles to the rear based on vision systems [4], and many others Advanced Driver Assistance Systems (ADAS) [5,6]. The ultimate goal of automotive technology is the realization of self-driving vehicles.Driving a vehicle is a complex process that requires the expertise of a driver. In that sense, soft computing techniques provide the advantage of representing expert knowledge for controlling complex and nonlinear processes, such as autonomous driving. Specifically, fuzzy logic has been widely used in the field of ITS. The fuzzy controllers, while achieving good results in controlling an autonomous vehicle, provide a smooth and safe driving [7].The automatic functionalities for driving are mostly dedicated to the longitudinal control (brake and throttle). For instance, [8], or the recent paper by [9], apply fuzzy logic to control the speed and throttle of an autonomous vehicle. However, the lateral control in autonomous vehicles requires special consideration because it can be critical. The small angle of the wheels in urban curves or at high speeds can leave the driver without enough reaction time and, therefore, unable to recover control of the steering wheel.A small range of automatic maneuvers, and only at low speeds, is available for the steering wheel: semi-autonomous parking [10], and lateral stability assistance [11]. Some new applications considered haptic feedback in the steering wheel and warning signals on dangerous situations [12]. A notable exception is the work presented by Sunwoo et al. [13]. In the distributed architecture they have developed for real autonomous vehicles, longitudinal proportional-integral-derivative (PID) control is applied; lateral control is based on steering angle error tracking. The platform they have implemented has been tested in scenarios with traffic lights, therefore including light detection, obstacles, and overtaking.On the other hand, roundabouts are a scenario where the steering control is crucial. It has not been studied in depth yet. Some papers address traffic management at signalized roundabouts [14]. In this case, the problem has been considered from the signal's point of view, i.e., using the speed control limits, the geometrical characteristics of the infrastructure, and even monitoring the traffic flow [15–17]. In addition, control of autonomous vehicles is not included in these scenarios, except using predefined trajectories [18]. Cai et al. [19] proposed an intelligent fuzzy controller for intersections but, despite the fact that they mention four types of traffic intersections, including roundabouts, they only develop and apply fuzzy control on the traffic lights at the intersection and do not control the vehicle. Onieva et al. [20] apply genetic algorithms to optimize a fuzzy decision system for driving at intersections. In this paper, the fuzzy rule cooperates with a manually driven vehicle. In [21], a double gain controller (equivalent to a proportional-integral regulator) for autonomous driving at roundabouts was proposed. But this conventional controller was tested only using a 3D simulator. Other approaches have applied soft computing techniques for autonomous motion planning in unorganized traffic at intersections, but without considering roundabouts [22].Driving on a roundabout can be divided into three phases: entry, exit, and circulating lane. The first two phases can be modeled as standard intersections, using parametric equations, and thus are relatively easy to handle. However, the circulation inside a roundabout is one of the most common and difficult scenarios at present. Contributions on this issue are required.In this paper, the application of fuzzy logic to the steering wheel control of an autonomous vehicle inside roundabouts, where lane change maneuvers at different speeds are performed, is proposed. Besides, a new trajectory generation procedure is proposed.The new fuzzy controller was applied to an electric van of the Autopia project11http://www.car.upm-csic.es/autopia/videos.php. Experiments have been carried out on a real roundabout, at different speeds, performing lane changes and using different entries and exits. Results prove the effectiveness of our proposal. To our knowledge, this is a novel contribution in the field of ITS.The paper is organized as follows. Section 2 describes the roundabout scenario and the trajectory generation. In Section 3, the design of the lateral fuzzy control of the autonomous vehicle while it is circulating inside the roundabout is presented. Section 4 shows and discusses the results of the application of the intelligent steering control to the real prototype. Conclusions and future works end the paper.In the last two decades, roundabouts have gradually become a very popular alternative to tackling the problem of intersections [23]. But, at the same time, they have become a controversial point for drivers [24]. Some results presented in previous studies (in the United States and China) showed that drivers do not have enough skills circulating in roundabouts, generating traffic jams in the vicinity [24,15].A roundabout is a type of circular intersection or junction in which road traffic flows almost continuously in one direction around a central island. There are many types of roundabouts. Even more, it needs to be pointed out that roundabouts in different countries differ in their layouts. Circular intersections at highways can have from 2 to 6 lanes around the center. In urban environments, roundabouts are usually small (radius of less than 2m, called mini roundabouts). They can be unsignalized or may have traffic lights and other traffic signals regulating the flow [25]. Therefore, it is important to describe the scenario in which the control scheme is going to be applied.Fig. 1shows the actual roundabout used for validation of the proposal. The roundabout is located at the Center of Automatic and Robotic (CAR), in Arganda del Rey (Madrid), Spain, which belongs to the Technical University of Madrid (UPM) and the Spanish National Research Council (CSIC). The characteristics of this roundabout are the following:•The smallest radius of a roundabout is conditioned for the turning radius of the autonomous vehicle (6m) and the lane width (3m). Accordingly, the minimum radius is 7.5m. In our case, the radius of the roundabout is 13m.Two lanes on the circulating roadway are considered, 3m wide each. Therefore, lane change inside the roundabout has been considered.The number of entry and exit points is limited to 4. One will be used as an entry and the other three as exits.The approaching lanes are also 3m wide.The flow direction is counterclockwise.The control of autonomous vehicles on the roundabout can be divided into three stages: entrance, circulating lane, and exit. Different controllers are used at each stage once the roundabout is detected. The control on the circulating lane is performed by small control segments. Therefore, it is necessary to define the trajectory along these segments.The solution to the problem of trajectory generation on the circulating roadway can be solved by setting predefined points [18]. Nevertheless, this approach has the disadvantage of being non-generic, since each roundabout may have different radius, number of lanes, number of entry and exit points, etc. Thus, in this work a more general approach to design the path is proposed.The geometrical characteristics (origin determined by 2-dimensional Cartesian coordinates, and radius) are used to generate the trajectory. On the one hand, perpendicular roads to the tangent line in the roundabout are determined. Different approach angles at the entrances and exits can be considered. The trajectory to approach the entry and exit points is then estimated based on Bezier curves at the intersections [26]. This polynomial is expressed as:(1)B(t)=P0*(1−t)3+3*P1*t*(1−t)2+3*P2*t2*(1−t)+P3*t3where t is a parameter ∈ [0,1] and B(t) are the trajectory points generated. Since it is a 3rd degree polynomial, P0, P1, P2, and P3 are the Bezier control points of the curve. In this case, 25 points have been generated increasing parameter t by 1/25 from 0 to 1. Fig. 2shows the Bezier curves generated at the entry and exit of the roundabout.But once the vehicle is already inside the roundabout (second stage), the intelligent controller proposed in this work is activated. The parametric generation of the trajectory on the circulating roadway is estimated using the following parametric equations of the circle:(2)Trajectoryx=Radius*cos(α+Δ)+CenterRoundaboutX(3)Trajectoryy=Radius*sin(α+Δ)+CenterRoundaboutYwhere α is the initial value of the approach angle (an estimation of this first angle is done base on the projection of the position of the vehicle at two consecutives point on the circle). The parameter Δ is the increase (or decrease for hand left drive countries) in this angle (set at 0.05 radians).The intersection of the circle and the perpendicular line at the entry is used as first point of the circulating trajectory (point A, Fig. 2). Then, increasing the value of the angle by Δ, and using the parametric equations of the circle (2 and 3), the next point of the trajectory is estimated (point B), and so on. When the vehicle is already on the roundabout, the control point, (point C), is on the circle.In this paper we address the lateral control of an autonomous vehicle. It is assumed that the longitudinal control is already implemented. The longitudinal speed can be modified through a Human Machine Interface (HMI) to test the behavior of the lateral controller on the circulating roadway. Real experiments are done with only one vehicle. Cooperative maneuvers will be considered in future works.Using the human driving experience, fuzzy logic allows us to define linguistic variables and a set of expert rules to control complex systems such as real vehicles. Fuzzy logic controllers can emulate human driver's behavior. This methodology exploits tolerance for imprecision and uncertainty by itself. Indeed, driver's experience is represented as fuzzy rules where the variables represent linguistic terms (actual speed, lateral error, etc.) and, instead of taking crisp values, they take values such as middle, high, etc.The controller input values are transformed and interpreted as fuzzy data after the fuzzification process. Each variable is defined by several fuzzy sets which are described by membership functions associated to the corresponding linguistic labels. A fuzzy output results of the inference process applying some fuzzy rules. This fuzzy output is defuzzified to obtain a crisp value that can be applied to the real system.The challenge is to find the correct control rules and membership functions using the driver's experience. In our case, the expertise to design the autonomous vehicle control inside the roundabout has been obtained from experiments with real vehicles, gathering information from drivers, and applying common reasoning. The simulation of the driving on circulating lanes has also been very helpful to define the new rules [21]. The fuzzy control proposed here is derived from the one in [27], but it has been modified to take into account the information from the sources just cited in order to adapt it to the new scenario.Based on this knowledge, two fuzzy controllers are designed, one for the steering wheel position and another for the angular speed. The steering position controller has two inputs, the lateral error (meters) and the angular error (degrees). The lateral and angular errors are calculated using two consecutive Differential Global Positioning System (DGPS) measurements. The inputs of the angular speed controller are the Distance to the bend (meters) and Longitudinal speed (kilometers per hour (km/h)). The distance to the curve is measured using the position of the vehicle and its point over the curve (circle).Triangular and trapezoidal membership functions are defined for the linguistic variables. Two or three labels are assigned to the input variables: left, middle, and right (Fig. 3, left). The angular error is positive when the nose of the vehicle is to the left side of the reference line, and vice versa. The fuzzy sets associated to Distance to the bend are: close and far; the Longitudinal speed can be low, medium or high (Fig. 3, right).The values of the membership functions are calculated by running several tests with the vehicle driven by a human. Values of the two input variables, position and angular speed, were recorded when the human driver was driving the car at the roundabout. Parameters of the membership functions (for example, a and b in Fig. 3, top left) have been modified by successive iterations based on the values of the steering position and the angular speed. Comparing the results given by the intelligent controller and the human driver, these tuning parameters are set so that the absolute error of these variables is minimized.The singleton membership functions of the output variable steering wheel position are: Left (−1), HalfLeft (−0.5), HalfRight (+0.5) and Right (+1). The singleton fuzzy sets of the output variable angular speed are Low (0.45), Medium (0.65), Med_high (0.8), and High (1).The main differences of the new fuzzy controller with respect to the membership functions that were proposed in [27] are:•Angular error: Two fuzzy sets have been defined instead of three in order to reduce system instabilities.Lateral error: The range of the fuzzy variable lateral error has been reduced and shifted to the right. This modification helps to keep the steering wheel turned to the left when the vehicle is inside the roundabout. Positive values have higher weights due to the fact that most of the time the steering wheel must be turned to the left because of the counterclockwise circulation.Distance to the bend: The universe of discourse of this variable has been reduced and now, only two membership functions are used instead of three in order to improve the stability when the speed is increased.Actual speed: The range of this input has been reduced because the speed inside the roundabout is less than the normal speed in the rest of the urban environment. The membership functions were saturated above 18km/h. The range of the experiments was extended up to 24km/h to validate the controller stability and test its robustness.For this scenario, and due to fact that new membership functions have been defined, it is necessary to generate a new set of fuzzy rules. Besides, driving on the circulating roadway requires particular considerations. For example, it is necessary to give greater weight to the rules that keep the steering wheel turned to the left.The rules of the steering position controller are:IFAngular error Left THENSteering Position RightIFAngular error Right THENSteering Position LeftIFLateral error Left THENSteering Position RightIFLateral error Right THENSteering Position LeftIFLateral error Middle ANDAngular error Left THENSteering Position HalfRightIFLateral error Middle ANDAngular error Right THENSteering Position HalfLeftIFDistance to bend Close ANDActual Speed Low THENAngular speed Med_highIFDistance to bend Close ANDActual Speed Medium THENAngular speed MediumIFDistance to bend Close ANDActual Speed High THENAngular speed LowIFDistance to bend Far ANDActual Speed Low THENAngular speed HighIFDistance to bend Far ANDActual Speed Medium THENAngular speed Med_highIFDistance to bend Far ANDActual Speed High THENAngular speed MediumMamdani implication was used to infer the consequents. To obtain the crisp output, the center-of-area defuzzification method is used. The value is given by (4).(4)xj=∑wioiwiwherewiis the degree of membership to every i fuzzy set, and oiis the singleton output of the corresponding fuzzy set, for every jth rule.The autonomous vehicle used in this work is an electric van Citroen Berlingo. It is fully sensorized. The information for the localization of the vehicle comes from different sensors: DGPS, Inertial Measurement Unit (IMU), and encoders. The DGPS is located over the rear axle of the vehicle. It sends the Universal Transverse Mercator coordinates to the control program at a frequency of 10Hz. The IMU is near the center of gravity of the vehicle in order to provide a backup of the position in case of DGPS receiver failure. With this system, an accuracy of 2cm on the test tracks is achieved.The longitudinal and lateral controls are physically separated. Initially predefined speed and lane are used in our algorithm. Once the vehicle is on the circulating road, the driver can change the default exit and the speed from the HMI. In the experiments presented in this paper, the initial speed was set at 8km/h, but it was changed from the HMI to test the stability of the system.The proposed fuzzy controller for the steering wheel has been tested in the scenario shown in Fig. 1. The driverless vehicle approaches the roundabout at entry 1, and exits at points 2 or 3. When the autonomous vehicle is approaching or leaving the roundabout, the controllers are exchanged for those presented in [27] for urban intersections. Lane changes, different longitudinal speeds, and different entries and exits have been tested.The first experiment (Fig. 5a) shows how the autonomous vehicle enters the roundabout and exits at point 3. The reference generated by the parametric equations is shown in red, and the trajectory followed by the vehicle is represented by the black line. As it is possible to see, the vehicle follows the trajectory without overshoot. This experiment was carried out at a constant speed of 10km/h.Fig. 5b and c shows the behavior of the fuzzy controller. The distance of the vehicle to the center of the roundabout is shown in Fig. 5b. The first curve corresponds to the entering, and the last curve to the exit. Once on the circulating road the distance is 13m, as expected, i.e., the value of the radius set by the trajectory. Fig. 5c shows how the lateral error gradually approaches to zero. The peaks correspond to the maneuvers.The fuzzy controller shows good behavior inside the roundabout, as the following experiments will confirm.As already mentioned, the autonomous vehicle travels on a two-lane roundabout. Fig. 6shows lane change experiments inside the roundabout. An user from the HMI changes the reference lane, performing a lane change manoeuver. This first experiment shows how the vehicle (black line) follows the reference generated by the control system (red dots), for two different cases: three continuous turnings in the roundabout (Fig. 6a), and one completed turn (Fig. 6b). In both of them, lane change maneuvers have been implemented inside the roundabout.The action of the fuzzy controllers during these maneuvers can be analyzed in Fig. 7. The first one, Fig. 7a, shows the distance (m) of the vehicle to the center of the roundabout. As it is possible to see, the controlled system follows the trajectory without overshoot. At time around 50s, the autonomous vehicle changes lane, and at about 100s it goes back to the outer lane. Another lane change can be seen during the last part of the experiment, between 200 and 250s (approximately). The corresponding error is shown in Fig. 7b. The peaks represent the entry of the vehicle in the roundabout (the first one), and the successive lane changes. At the beginning of this experiment, the longitudinal vehicle speed was set to 8km/h, and it was increased up to 15km/h. The system always remains stable.The second experiment illustrates the vehicle entering the roundabout and initially trying to take exit 3 (Fig. 6b). But as this exit point is blocked, the vehicle gives a completed turn on the inner lane. Once the vehicle is approaching the desired exit again, it returns to the outside lane and exits the roundabout. This experiment was performed at a constant speed of 8km/h. Fig. 7c and d shows the distance to the center of the roundabout and the lateral error during this maneuver, respectively. The first and last peaks correspond to the entering and exit of the vehicle in the roundabout. There are two lane changes (to the inner lane and then to the outer).These tests prove that the trajectories tracking when a lane change in the roundabout is carried out is fairly good.In the following experiments, different longitudinal speeds were used to determine the range of stability provided by the intelligent controllers, when the autonomous vehicle is traveling on the circulating roadway of the roundabout.Fig. 8shows the Universal Transverse Mercator (UTM) coordinates of the vehicle at the roundabout. There are not any lane changes, so the radius of the trajectory is always 13m. The vehicle turns three times on the roundabout until it exits.The speed goes from 5km/h to 24km/h. In Fig. 9a, the longitudinal vehicle speed (black line) and the reference (grey line) are shown.Fig. 9b shows the distance of the vehicle to the center of the roundabout. Although it should be constant (13m), there are some oscillations when the autonomous vehicle reaches 20km/h speed. The same result is shown in Fig. 9c. But even in the worst case, the error is less than 2m at high speeds. It is worthy to remark that increasing the speed up to 20km/h, i.e., even beyond the speed limits defined in the membership functions of the fuzzy controllers, the system is stable and the response does not present overshoot. The fuzzy controller is able to control the autonomous driving after this disturbance, as it is shown in the last part of these figures. When the speed is again reduced to 8km/h, the system is stabilized. Finally, it exits the roundabout.Fuzzy logic control has been applied to a real problem, the autonomous driving on the circulating road of a roundabout. Fuzzy controllers had been previously designed for signalized urban intersections, and can be applied to the approaching and exit maneuvers. But inside the roundabout, it was necessary to define a new intelligent system. This is one of least covered topics in the literature on ITS field and, therefore, one of the main contributions of this paper.The proposed fuzzy systems have been developed and implemented to control the steering wheel position and the angular speed of the autonomous vehicle. Lateral control requires special consideration because the steering wheel is a very sensitive element.The trajectories are automatically generated according to the radius of the roundabout, the center of coordinates, and some parametric equations.Real experiments showed the good behavior of the intelligent controllers. Different speeds, lane changes, and different trajectories were applied to prove the feasibility of this approach in real scenarios. Regarding the robustness of the fuzzy control strategy, some experiments were carried out at different speeds even beyond the speed limits considered in the definition of the membership functions. The response of the system in this case was stable and did not have overshoot.Overtaking maneuvers inside the roundabout, obstacles avoiding, and cooperative maneuvers will be considered as future works.

@&#CONCLUSIONS@&#
