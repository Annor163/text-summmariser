@&#MAIN-TITLE@&#
A new level set method for inhomogeneous image segmentation

@&#HIGHLIGHTS@&#
We constructed a new region-based pressure force (RBPF) function.We proposed a novel level set based model for inhomogeneous image segmentation.We combine the local and global intensity information adaptively.The local image information can significantly increase image contrast.We apply a fast and simple level set method to implement the curve evolution.

@&#KEYPHRASES@&#
Level set method,Inhomogeneous image segmentation,Local image information,Global image information,

@&#ABSTRACT@&#
Intensity inhomogeneity often appears in medical images, such as X-ray tomography and magnetic resonance (MR) images, due to technical limitations or artifacts introduced by the object being imaged. It is difficult to segment such images by traditional level set based segmentation models. In this paper, we propose a new level set method integrating local and global intensity information adaptively to segment inhomogeneous images. The local image information is associated with the intensity difference between the average of local intensity distribution and the original image, which can significantly increase the contrast between foreground and background. Thus, the images with intensity inhomogeneity can be efficiently segmented. What is more, to avoid the re-initialization of the level set function and shorten the computational time, a simple and fast level set evolution formulation is used in the numerical implementation. Experimental results on synthetic images as well as real medical images are shown in the paper to demonstrate the efficiency and robustness of the proposed method.

@&#INTRODUCTION@&#
Image segmentation is a fundamental problem in both image processing and computer vision. The objective is to partition an image into several subregions with homogeneous properties (color, texture, etc.) which will hopefully correspond to objects to be segmented. The challenging aspect of this problem is how to design effective methods for identifying such properties.Up to now, a wide variety of algorithms have been proposed to solve image segmentation problems. The best known and most influential approaches are active contour models. They basically fall into three categories: edge-based, region-based and hybrid active contour models. The edge-based active contour models mainly use the edge information such as image gradient to stop the contour evolution. For example, geodesic active contour (GAC) [1], developed from snakes model [2], identifies objects by a gradient based edge detector function. However, the defects of the gradient based active contours are that they are not only very sensitive to noise but also difficult to detect weak edges. Moreover, the segmentation results are heavily dependent on the location of the initial curve. Instead of the gradient information, the region-based models utilize the image statistical information to detect objects. They basically overcome the disadvantages of edge-based active contour models. They are insensitive to noise and can satisfactorily segment the objects with weak boundaries. One of the most popular region based active contour models is active contours without edges (ACWE) model/C-V model proposed by Chan and Vese [3], which is the piecewise constant case of the famous Mumford–Shah (MS) segmentation model [4]. It is based on the assumption that the intensity within each subregion is homogenous or roughly constant. So it is only effective for piecewise constant images. MS model has wider applications because it assumes that images are piecewise smooth separately in the areas of objects and backgrounds. However, it is difficult to apply the gradient descent method to solve this model because of the non-differentiability with respect to the image boundary. Later, Ambrosi and Tortorelli (AT) [5] proposed an elliptic approximation method to easily solve this problem. It is worth mentioning the AT-L1 model [6], a modified version of the elliptic approximated MS model. It utilizes L1 norm as the data fidelity and TV norm as the regularization, hence, preserves the sharp discontinuities of images. Unfortunately, all of them have limited ability to segment complex images such as images with intensity inhomogeneity, which is just the objective of our study in this paper. As a matter of fact, intensity inhomogeneity is a common phenomenon in medical images. Recently, hybrid methods have been widely used in segmenting complex images, and one can refer to the literature [7–12]. They may combine the edge and region information or the local and global information according to specific segmentation tasks. In this paper, we shall make use of the hybrid idea combining the local and global information to segment inhomogeneous images.According to our knowledge, there are two main approaches to segment images with intensity inhomogeneity. The first one is the bias correction based methods. The basic assumption of such methods is that the intensity inhomogeneity is resulted from a slowly varying field known as the bias field. Actually, the existence of bias field can cause serious misclassifications when intensity-based segmentation algorithms are used. So bias correction or removing the bias field is the main train of thought for this method. Bias correction has been extensively studied in the past two decades [13–20]. Among these methods, segmentation based methods [13,14,16–20] are more attractive, as they unify segmentation and bias correction within a single framework, and the segmentation and bias correction can benefit from each other to improve themselves. For instance, in [18–20], based on the observations that intensities in a relatively small local region are separable and the bias field is smooth across the whole image domain, the authors proposed a variational framework for joint intensity-based segmentation and bias correction. By their method, the segmentation accuracy is improved by the estimated bias field and the bias field is better estimated by forcing the intensity to be constant in the segmented subregion. What is more, the bias field is intrinsically ensured to be smooth by the convolution with a truncated Gaussian kernel without any other additional operations. The second approach we want to mention is directly related with the use of local intensity information [8–12,21]. In [21], Li et al. proposed an efficient region-based level set method to segment inhomogeneous images by introducing a local binary fitting (LBF) energy with a kernel function. It uses the intensity of the current pixel to approximate those of its neighboring pixels. The LBF model has attracted extensive attentions for its good segmentation performance. However, it usually needs to do four convolution operations at each iteration, which greatly increases the computational complexity. In addition, it is also sensitive to the selection of governing parameters and the initialization. Recently, some hybrid models combining the local and global intensity fitting energies were proposed [8–12] to improve the performance of the LBF model. In [8,9], the authors defined an energy functional (LGIF model) with a local intensity fitting term used in LBF model and an auxiliary global intensity fitting term used in C-V model. By combining the local and global intensity information, the LGIF model can avoid trapping into a local minimum. But the segmentation result is still slightly dependent on the location of the initial contour, because the weight between the local term and the global term is a fixed positive constant. Later, Yu et al. [10] gave a method to dynamically adjust the weight of the auxiliary global fitting term by using local contrast of the image, which reduced the dependence on the initial contour.Next we will introduce two main works which motivate our method. The first one is a hybrid level set method, proposed by Wang et al. [11,12], involving the global and local intensity information. Their energy functional in the variational level set framework is described as follows(1)Ec1c2m1m2ϕ=αEGc1c2ϕ+βELm1m2ϕ+ERϕ,where ϕ is a level set function, and α and β are two fixed positive constants. The global energy EG, the local energy ELand the regularization term ERin Eq. (1) are respectively defined by(2)EGc1c2ϕ=∫ΩIx−c12Hϕxdx+∫ΩIx−c22(1−Hϕxdx,(3)ELm1m2ϕ=∫ΩGk∗Ix−Ix−m12Hϕxdx+∫ΩGk∗Ix−Ix−m221−H(ϕxdx,and(4)ERϕ=γ∫Ω∇Hϕdx+δ2∫Ω∇ϕ−12dx.Here I denotes the image to be segmented, Ω represents the image domain and Gkis an averaging convolution operator. The global term EGis exactly the region term in C-V model. The regularization term ERcan force the contour to be smooth and the level set function to be close to a signed distance function. It is worth noticing that the local term ELis designed by finding the best constant approximation of the difference between the averaging filtered image Gk∗I(x) and the original image I inside and outside of the contour. By subtracting the original image from the local average image, the contrast of the resulted image will be enhanced and the intensity inhomogeneity will be lightened (see the Experimental results section), which are indeed favorable to segment inhomogeneous images. In our paper, we shall use the intensity difference between averaging filtered image and original image to construct our local region term. Actually, in [22], the authors also employed a normalized convolution but different from the averaging convolution in [11,12] to quickly compute localized statistics. The distance between the image intensity and the local Gaussian averaging inside each subregion was minimized, which yielded results similar to piecewise smooth segmentation.The other related work is proposed by Zhang et al. [7]. In their work, they presented a region-based pressure force (RBPF) function, i.e.,(5)Eϕ=−∫ΩHϕIx−μdx,where μ is a predefined parameter indicating the lower bound of the gray-levels of the target object. Thus, minimizing this term can encourage the contour to enclose the regions with gray-levels greater than μ, which just corresponds to the object. Furthermore, from the corresponding curve evolution equation(6)∂C∂t=I−μN→,whereN→is the outward unit normal vector of the curve, we can see that it is able to control the correct direction of curve evolution when the target object has higher gray-levels than the background. Inside the target object, I−μ>0, the region force can make the curve expand for the parts inside the target object; on the other hand, inside the background, I−μ<0, the region force can make the curve contract for parts outside the target object. As a result, the curve finally reaches the boundary of the object. However, this method is only suitable for use in the case that the intensities inside and outside the object are homogeneous and the foreground is brighter than the background. To be able to segment other more images, we shall generalize this idea so that our model is effective not only for the case they considered but also for the case that the background is brighter than the foreground. Most important of all, the proposed method will have ability to deal with inhomogeneous images.The main contributions of this paper are as follows. In this work, we construct a new RBPF function without estimating the lower bound of the gray-levels of targets. We only need to compute the mean values of intensities inside and outside of the contour, which are very easy to obtain. The new RBPF function will force the parts of the curve inside the target object to move outwards and the parts of outside to move inwards regardless of the brightness of object and background. Furthermore, the new constructed function can be also applied to the above mentioned difference image so that it can greatly help segment inhomogeneous images. The whole energy of the proposed active contour model consists of three parts: a global term, a local term and a regularization term. The global term and the local term are designed by the new constructed RBPF function, and the integral domains of the two terms are only associated with the inside region of the curve, which will simplify the computation without loss of good performance. The regularization term aims at smoothing the active contour. Also, we give an adaptive weight to adjust the actions of the global term and the local term automatically. When the curve is located in inhomogeneous regions, the local term dominates the whole energy; and when the curve is located in homogeneous regions, the global term dominates the whole energy. So the adaptive weight will make the segmentation results be less dependent on the location of the initial contour.Besides, in this paper, we adopt a simple level set method, which only requires computing a Gaussian convolution after each iteration as used in [23–26], to implement the proposed hybrid active contour model. Following the literature [25], we call it Binary and Gaussian Filtering Regularized Level Set (BGFRLS) method. In fact, the intrinsic idea of the active contour is to iteratively evolve an initial curve towards the boundaries of target objects driven by the combination of internal forces determined by the geometry of the evolving curve and the external forces induced from the image. Consequently, all of the active contour models will finally need to solve a curve evolution problem. In recent years, the level set methods have become extremely popular in image segmentation especially in solving active contour models, because it is very easy to handle interface evolution, or the deformation of a contour, and we may refer to the literature [3,27–34]. But whether the traditional level set method [29] or the variational level set method [31] requires the level set function to be a signed distance function, which means the level set function must be re-initialized during iterations. To avoid re-initialization, Li et al. [34] proposed a variational level set formulation with a penalty term like the second term in Eq. (4) that automatically forces the level set function to be close to a signed distance function. This method has been successfully applied in many variational active contour models. Unfortunately, it still requires solving a nonlinear partial differential equation (PDE), in which the nonlinearity is mainly caused by the mean curvature of the level set function. Due to the CFL condition that the time step △t should be proportional to the regularization parameter, we have to choose a small time step for obtaining an accurate result. Moreover, the penalization parameter δ of the penalty term must satisfy δ△t<0.25 for stability. Therefore, for preventing the numerical instability, the time step also should not be too large, which leads to many iterative steps to reach the steady state. Thus, the computational speed will be relatively slow. The BGFRLS method approximately solves the mean curvature motion by alternating the Gaussian convolution with the thresholding, and avoids the calculation of the signed distance function or the complicated procedure of the re-initialization, so it saves much computational time. In addition, by using the BGFRLS method, the evolution equation of the level set function becomes linear, which is easier for implementation in practice.The rest of this paper is organized as follows. In Section 2, we propose our new hybrid model and interpret the function of this model. The level set formulation and the specific algorithm corresponding to our model are introduced in Section 3. In Section 4, numerical experiments are given to show the effectiveness of the proposed model and high speed of computation. Finally, a brief conclusion is presented in the last section.Before introducing our model, we first give some conventions about the level set function. LetCdenote an active contour which partitions an image domain Ω into different parts, and the zero level set function ϕ is used to represent the active contour, i.e.,C=x∈Ω|ϕx=0. The inside and outside of the active contour are represented by Ω1={x∈Ω|ϕ(x)>0} and Ω2={x∈Ω|ϕ(x)<0}. The direction of the curve normalN→is defined to point outward the curve. Then using the defined level set function, the outward unit normal can be rewritten asN→=−∇ϕ∇ϕ.Similar to [11,12], our proposed functional to be minimized is also composed of a global term, a local term and a regularization term. But the global and local terms are integrated by an adaptive weight so that they play different roles in different regions.We first introduce the global term of the whole energy, i.e., the new RBPF function, aiming at partitioning piecewise constant images into different regions. The proposed global functional to be minimized is defined as(7)EgC=−∫Ω1Ix−c1+c22c1−c2dx,where I is the image to be segmented that is supposed to be piecewise constant, c1 and c2 are the mean values of the intensities inside and outside of the active contourC.It can be seen that this term encourages the contour to enclose the region with gray-level greater thanc1+c22if the value of c1 is bigger than that of c2, and enclose the region with gray-level smaller thanc1+c22if the value of c1 is smaller than that of c2. That is to say, if c1>c2, minimizing this term forces the intensities inside the curve to approximate to c1 because of the inequalityc2<c1+c22<c1. Otherwise, if c1<c2, then minimizing this term also forces the intensities inside the curve to approximate to c1 sincec1<c1+c22<c2. Consequently, the curve can enclose the region with intensity value of c1. More precisely, if the intensity of the object is c1, then the curve will enclose the object; and if the intensity of the background is c1, then the curve will enclose the background. The function of this term is similar to that of C-V model, i.e., approximating intensities of the region inside the active contour to its average intensity. However, our proposed model only considers the inside of the curve but not the outside, which is easier to implement. Moreover, in this term, the denominator c1−c2 is not only for determining the sign but also for normalization so that the local term (defined later) and the global term do not have great difference in values. It is worth noting that the denominator c1−c2 can not be zero. Once it is zero, we assume the region force is zero and the curve will contract only by the internal forces induced from the regularization term until c1 and c2 are not equal again. Besides, if in the whole image domain c1=c2, then the curve will contract until it vanishes. It is reasonable, because when c1=c2 in that case, the regions inside and outside of the contour are the same one.The level set method is an effective way to handle contour deformation. It can easily deal with topological changes such as merging, splitting and forming sharp corners. In addition, effective and efficient numerical schemes can be implemented on fixed regular grids. Using the variational level set method, we obtain the new energy about the level set function ϕ(8)Egϕ=−∫ΩIx−c1+c22c1−c2Hϕdx,where H(ϕ) is a Heaviside functionHϕ=1ifϕ>0,0otherwise.Minimizing the energy (Eq. (8)) with respect to the level set function ϕ, we get the gradient descent flow(9)∂ϕ∂t=Ix−c1+c22c1−c2δϕ,where δ(ϕ)=H′(ϕ). In fact, δ(ϕ) can be replaced by |∇ϕ| [35], then the steady state of the above evolution is equivalent to the steady state of the following evolution equation(10)∂ϕ∂t=Ix−c1+c22c1−c2∇ϕ,which means that the evolution of the curve follows the equation(11)∂C∂t=Ix−c1+c22c1−c2N→,because the PDE in the form ofCt=FN→describes the same curve evolution as ϕt=F|∇ϕ| [29]. HereN→is the outward unit normal of the curveC. We suppose that the object has the mean value of c1 (>c2). Then, as illustrated in Fig. 1, Eq. (11) describes an expansion movement for the parts of the curve inside the target object and a contraction movement for the parts outside. In other words, it is able to control the direction of curve evolution and is a new pressure force. Thus it can finally find the accurate location of the target object for piecewise constant images. But it is not good for inhomogeneous images.To be able to segment images with inhomogeneous intensity, the local intensity information will be very useful, because the local image regions are more likely to have approximately homogeneous intensity. The smaller the local region is, the more homogeneous the intensities are. Based on this observation and the idea of the works [11,12], we employ the information of the averaging filtered image Gk∗I. Here Gkis an averaging convolution operator with k×k size window. The intensity of the filtered image at each pixel is the local average of the original image in its k×k size window. It makes the original image blurred and approximately estimates the varying intensity field that causes the intensity inhomogeneity. Let I0 denote the difference between the filtered image and the original image, i.e., I0=Gk∗I−I. By subtracting the original image from the averaging filtered image, the contrast between foreground intensities and background intensities can be significantly enhanced, and the intensity inhomogeneity can be lightened in the region far away from the edges (see the Experimental results section), which is favorable to detect the true boundaries of the object because the intensity inhomogeneity mainly influences the non-edge pixels.Following the idea of our global term and using the difference image I0, the proposed local functional to be minimized is given by(12)ElC=−∫Ω1I0x−m1+m22m1−m2dx,where m1 and m2 are the mean values of the intensities of the difference image I0 inside and outside of the active contourC, respectively. Note that in the above functional, we suppose that m1−m2 is not zero. Otherwise, we handle it similarly to the global term, i.e., the local region force is assumed to be zero.With the same derivation as in the Section 2.1, we get the evolution equation of the level set function(13)∂ϕ∂t=I0x−m1+m22m1−m2∇ϕ.Since the contrast between foreground and background has been enhanced and the intensities far away from edges are more homogeneous in the difference image, Eq. (13) has the ability to handle inhomogeneous images.However, it should be noted that the size of the averaging convolution operator k will affect the function of the local term. To alleviate the sensitivity to noise and increase the contrast, the neighborhood size should be selected at a larger scale. But at a larger size, the difference image may contain some detailed information that is redundant for the accurate segmentation. So except for choosing an appropriate scale for the image to be segmented, we need to combine the global term to solve this problem.To strengthen their respective functions of the proposed global and local terms, we integrate them into the following energy(14)EC=wxEgC+1−wxElC+λLengthC=−∫Ω1wxIx−c1+c22c1−c2dx−∫Ω11−wxI0x−m1+m22m1−m2dx+λ∫Cds,where λ>0 is a constant weight, and w(x) is a weighted function that automatically determines which region term will play a crucial role in partitioning an inhomogeneous image.Next we analyze when the global or local term should play a dominant role. In the regions far away from the desired boundary of the object and the intensities vary slowly, due to improper window size of the averaging convolution operator, some small details with very low contrast may be seen in the difference image, then the local term will identify them but they should not be the main parts of the target object, so we need to increase the weight of the global term in such regions. In the regions close to the desired boundary of the object and where the intensities are inhomogeneous, c1 and c2 got from the original image may be far away from the true intensities of the foreground or background, which will affect the accuracy of the segmentation; however, the difference image with enhanced contrast is less influenced by the intensity inhomogeneity in such regions, so we need to increase the weight of the local term. In conclusion, we hope the global term would dominate in the regions with homogeneous intensities and the local term would be more important in the inhomogeneous area. Consequently, the problem becomes how to determine the regions with homogeneous and inhomogeneous intensities.Following the work in [10], we adopt the adaptive weight(15)wx=ρ⋅averageCN⋅1−CN,where ρ is a fixed positive parameter and CNis a local contrast ratio of an image defined asCNx=Mmax−MminMg,where N defines the size of the local window centered at x, Mmaxand Mminare the maximum and minimum of intensities within this local window respectively, and Mgdenotes the maximal intensity level of the entire image. Obviously, CNvaries between 0 and 1, so the weight functions w(x) and 1−w(x) are always positive. It should be noted that the average value of CNover the whole image average(CN) represents the overall contrast information of the image.Now we explain the global and local terms how to selectively work in different regions by the weight function (15). When the intensity is inhomogeneous, i.e., the local intensity varies greatly, there will be a big difference between Mmaxand Mmin, and then the value of CNis large. Thus, the weight function w(x) is small. Therefore, the local term dominates the whole energy in inhomogeneous area. On the contrary, when the intensity is homogeneous, i.e., the local intensity varies slowly, the value of CNis small, and thereby the weight w(x) will be large, so the global term dominates the whole energy in homogenous area.Using the variational level set method, the total energy E(C) can be minimized by solving the following equation of the level set function ϕ(16)∂ϕ∂t=wxIx−c1+c22c1−c2+1−wxI0x−m1+m22m1−m2+λdiv∇ϕ∇ϕδϕ,where(17)c1=∫ΩIHϕdx∫ΩHϕdx,c2=∫ΩI1−Hϕdx∫Ω1−Hϕdx;(18)m1=∫ΩI0Hϕdx∫ΩH(ϕ)dx,m2=∫ΩI01−Hϕdx∫Ω1−Hϕdx.Because the evolution equations ϕt=Fδ(ϕ) and ϕt=F|∇ϕ| have the same steady states, we draw upon the following equation for the level set evolution(19)∂ϕ∂t=wxIx−c1+c22c1−c2+1−wxI0x−m1+m22m1−m2+λdiv∇ϕ∇ϕ∇ϕ.However, the computations of nonlinear PDEs (16) and (19) are all time-consuming due to the divergence term, which is the mean curvature of the curve represented by the level set function. To avoid the denominator in the divergence term to be zero, |∇ϕ| always needs to be regularized, i.e.,|∇ϕ|≈|∇ϕ|2+ε. Experimental experience tells us that the regularization parameter ε must be small enough to get a more accurate solution. But it may take longer computational time because of the CFL condition, which requires the time-step to be proportional to the regularization parameter ε. In practice, ε is often set to be 1 although it affects the accuracy a little. Thus, the time step can be large relatively, usually varying from 0.01 to 0.1. Of course, the additive operator splitting (AOS) scheme is a good choice to compute the Eq. (19); nevertheless the implementation is rather complicate.On the other hand, to avoid the level set function to be too steep or flat near its interface, re-initialization is often required during the evolution. However, it is a very time-consuming process. Furthermore, it is still a problem to decide when and how to apply the re-initialization. Based on the observation that the level set function must keep being a signed distance function during the evolution in order to prevent it from being too steep or flat near its interface, that is to say, it must satisfy the condition |∇ϕ|=1, then together with this condition, Eq. (19) can be simplified as(20)∂ϕ∂t=wxIx−c1+c22c1−c2+1−wxI0x−m1+m22m1−m2+λΔϕ,or equivalently,(21)∂ϕ∂t=1λwxIx−c1+c22c1−c2+1−wxI0x−m1+m22m1−m2+Δϕ,which is a linear equation. The AOS scheme is also suitable for use. Here, we split the evolution Eq. (21) into two parts similarly to the methods in [37,7] (“time-splitting” method): the first one is(22)∂ϕ∂t=1λwxIx−c1+c22c1−c2+1−wxI0x−m1+m22m1−m2,in which the right hand is independent of ϕ, so we can choose the relatively large step size to solve it; and the second one is(23)∂ϕ∂t=Δϕ,then, we use a simpler implemental step to solve the Laplacian, which is the Gaussian filtering process as used in [25]. But now the condition |∇ϕ|=1 has to be considered in the implementation. In fact, we can ignore the constraint from the point view of the Merriman, Bence and Osher (MBO) scheme [36].Note that the divergence term is just the mean curvature of the curve represented by its level set function. The basic idea of the MBO scheme is that evolving a curve by its mean curvature can be approximated by solving a heat equation with respect to the level set function, and then taking threshold for the resulted solution. So we can solve (23) and then take threshold to approximate the divergence termdiv∇ϕ∇ϕ.The MBO scheme can be also interpreted by another well known technique for approximating mean curvature motion, namely the “time-splitting” scheme for Allen–Cahn equation or phase field method [37]. Here, we just replace the original potential function ϕ2(1−ϕ)2 with (1+ϕ)2(1−ϕ)2/2, so the thresholding step will be handled by letting ϕ=1 if ϕ≥0; otherwise, ϕ=−1. But the two step operations still approximate the mean curvature motion, which has been reported in [38,39]. Thus, the Heaviside function can be replaced byHϕ=1+ϕ2, hence, the region force still can be written as the form of Eq. (22). Because we adopt the binary level set function and use the Gaussian filter to implement the heat equation, following [25], we call it BGFRLS method.

@&#CONCLUSIONS@&#
