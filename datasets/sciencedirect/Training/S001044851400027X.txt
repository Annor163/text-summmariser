@&#MAIN-TITLE@&#
Function-based morphing methodology for parameterizing patient-specific models of human proximal femurs

@&#HIGHLIGHTS@&#
Function-based morphing (FBM) method for patient-specific proximal femur was proposed.FBM morphs the patient-specific model based on the biomechanical functions.Detailed algorithms for a robust morphing are presented in this paper.FBM provides a systematical way to analyze biomechanical responses of a specific bone.

@&#KEYPHRASES@&#
Parameterization,Function-based morphing,Biomechanical function,Proximal femur geometry,Patient-specific model,

@&#ABSTRACT@&#
Graphical abstract

@&#INTRODUCTION@&#
The morphology of a bone is closely associated with its biomechanical responses  [1], but this morphology can be changed due to aging or orthopedic surgery. Thus, much research efforts have been focused on evaluating the effects of morphometric variations of a bone. In these studies, the finite elemental analysis (FEA) approach has been employed to analyze the relationship between bone structures and their biomechanical responses  [2–4]. Traditionally, there have been two approaches to describe bone structures in FEA: statistical and patient-specific. Statistical models include the standardized geometry and generic properties representative of their population, and it has been proven that these models are suitable for parameterizing objects, such that aspects of the model geometry and mechanical properties are defined in a way that they can be varied by specifying a parameter value  [5,6]. With these statistical approaches, however, the models are limited in their sample population, meaning that a statistic model cannot represent the complex detail of a particular subject that is not included in its population  [2]. Unlike statistical models, patient-specific models incorporate the more detailed information of a patient, so that they have been widely used to more accurately analyze individual responses in biomechanics research  [1,7–11]. As the morphology of a proximal femur affects the biomechanical functions and responses, numerous studies have extensively experimented with how the morphology influences the responses of the specific femoral specimens. Kukla et al.  [12], for example, reported that the femoral neck diameter is the most crucial factor affecting its fracture among the femoral geometry parameters. Lenaerts et al.  [13] showed that femoral neck length mainly affects hip contact forces such as anterior–posterior, vertical, and medio-lateral components during gait. Hence, a reliable parametric morphing methodology for a patient-specific model has significance in its usability for various applications such as systematic morphological sensitivity analyses, pre-operative surgery plans, and other biomechanical simulations. However, the morphology of a patient-specific bone structure cannot easily be parameterized due to its geometric complexity. In other words, the complex geometry of a proximal femur structure comprises several partial regions such as femoral head, neck, and trochanteric regions. Each region, serving specific biomechanical and anatomical functions, is continuously connected to the other regions without explicit boundaries; therefore, it has proven challenging to independently parameterize the geometry of each partial region to obtain specific functional responses.The main objective of this paper is to provide a function-based morphing (FBM) method to parameterize 3D proximal femur models, so that a series of morphed models can be obtained from a single patient-specific femur structure by simply altering functional parameters, in order to systematically analyze the biomechanical sensitivity of the target femoral structure. To achieve this purpose, three major requirements have to be satisfied:•femoral morphology satisfying the required functional parameters has to be obtained in an intuitive way of simple parametric adjustments;each functional region has to be morphed independently without unexpected parametric changes and geometric distortions; andgeometric quality as an FE model should be preserved during morphing.The proximal femur structure comprises anatomically significant regions such as the femoral head, neck, lesser and greater trochanters, and so on. These regions have been described in related studies by specific parameters, as depicted in Fig. 1. The parameters are not only closely associated with the proximal femur geometry, but also related to the biomechanical functions of the bone itself so that they have been considered as FUNCTIONAL parameters in previous studies in the biomechanical field  [10,13,14]. The femoral head diameter (FHD) and femoral head center (FHC), which determine the rotational center of hip joint, are related to the stability of the joint  [7]. The femoral neck diameter (FND) is associated with the stiffness of the femur itself, so this parameter has been extensively experimented in femoral fracture studies   [14,15]. The length of the neck (FNL) determines the length of the moment arm and the range of the hip joint motion during gait  [13]. The inclination angle of the femoral neck (FNA) plays a significant role as an evaluative indicator for hip dislocations. Also, an increase or decrease in this angle beyond normal limits causes improper movement of the muscles and interferes with walking  [10]. Thus, these functional parameters have to be interrelated with the morphology of the femoral structure in order to obtain morphed models satisfying the required parametric changes. In this section, we present how to translate such parametric changes into the terms of geometry using fitted 3D primitives and FBM fields.The FBM method for a human proximal femur model is accomplished in the four steps shown in Fig. 2. As the preprocessing of the work, we first convert the patient-specific 3D voxel models reconstructed from femoral CT images of the subject into 3D surface models. The models are then segmented into functional regions based on fitted primitives. The primitives are also used to measure the parameters and to define morphing criteria. The final step of FBM is morphing the surface of each segmented region using FBM fields. These morphing fields are designed to indicate where the points on each region have to be repositioned to meet the required parametric changes.LetU≔{uHR,uNA,uNL,uNR}be the set of the functional parameters, whereuHRrefers to the femoral head radius,uNAis the neck angle between the femoral neck and the body shaft,uNLis the length of the femoral neck, anduNRis the neck radius. As shown in Fig. 1, the parameters can be estimated from primitives fitted to the original surfaces of the segmented regions  [5–7]. Thus, to accurately estimate the parameters, each region has to be first segmented and be fitted into the proper primitives, e.g., a sphere for the femoral head region. The least square optimization  [16] method is used here to find the fitted primitives for each region.To segment the femoral head region, a pseudo head center was first measured according to anatomical property of the proximal femur. We selected the points within a specific range from the pseudo center position, and the true femoral head radiusuHRand the true head centerphare then calculated from the fitted sphere to selected points (see Appendix A). There are three functional parameters in the femoral neck region: neck length(uNL), radius(uNR), and its angle(uNA). The length of the femoral neck is estimated from the distance between the femoral head center and the intersecting point of the neck shaft axisLNand the femoral body shaft axisLA, which are unit vectors. The neck angle also can be measured as the angle between these two axes. Severalncircles with the radiusesriare fitted to the points located within specific ranges apart fromph, so that the neck axis was found from the centers of the fitted circles. The femoral shaft axis can be obtained in a similar way as the neck axis (Appendix B). The intersecting pointpcofLAandLNis the point positioned at the closest distance between the two axes, since the axes rarely meet exactly in most cases. Finally, all the neck parameters are estimated from the equations:uNL=‖ph−pc‖,uNA=cos−1(‖LA⋅LN‖),uNR=min[ri]wherei=0,1,…,n.Each segmented region is independently morphed based on the FBM Fields, which are designed to convert the required parametric changes into morphing terms. For this purpose, we use the information of fitted primitives as morphing criteria. For instance, while the previous study changes the head diameter by simply offsetting the head surface, we change the head diameter by moving associated points along the radial vectors around the spherical center fitted to the head region. This approach has a significant advantage, which is that the other functional features are preserved even though the required parameter is changed (e.g. head center position, and neck length and angle are preserved while the head diameter is changed).As described in Fig. 3, each single morphing field contains three elements: a unit vector groupV¯to determine the moving direction of the points, a points groupR¯to define the range of the candidate points of the current field among the entire points of the model, and lastly the smooth functionf(p)to avoid the resulting discontinuities around the boundaries of the morphed regions. For the FHD, since the original FNL has to be preserved in order to maintain the original length of the moment arm, every pointpiwhich belong to the head region has to be moved along the vectors starting from the true femoral centerph. Hence the vector groupV¯HRand the candidate points groupR¯HRfor the head radius parameter are given byV¯HR={vi|(pi−ph)/‖pi−ph‖,i=0,…,N}whereNis the point number inR¯HR, andR¯HR={pi|‖pi−ph‖≤uHR+lS}.Since the boundary of head and neck regions can be distorted due to the morphing, the smooth functionfHR(pi)is applied to the points withinR¯HRwith a specific range, called smooth rangels. The smooth function has the value 1 if the pointpiis definitely in the current region, but the value is smoothly reduced to the zero if the point is positioned in the smooth range (Fig. 3(a)). The mathematical definition of thefHR(pi)is given byfHR(pi)={0.5+0.5cos{πls×(‖pi−ph‖−uHR)}‖pi−ph‖>uHR1‖pi−ph‖≤uHRwherelsis the smooth range.In the same manner, the other FBM fields of the femoral neck region are defined using the criteria of neck axisLN, femoral head centerph, and intersecting point between the neck and shaftpc. The mathematical definitions of these FBM fields are described as follows:•Neck radius morphing field(uNR)i.V¯NR={vi|(pi−pˆi)/‖pi−pˆi‖,i=0,…,N}, whereNis the point number inR¯NRandpˆi=ph−(pc−ph)(ph−pi)⋅(pc−ph)‖pc−ph‖2R¯NR={pi|‖pi−ph‖≤uNL+ls}fNR(pi)=1, except{0.5+0.5cos{πls×(‖pi−ph‖−uNL−ls)}‖pi−ph‖>uNL−ls0.5+0.5cos{πuHR×(uHR−di)}di<uHRwherediis the distance betweenpiand the planePHC(Fig. 3(b)).Neck length morphing field(uNL)iv.V¯NL={v|(ph−pc)/‖ph−pc‖}R¯NL={pi|‖pi−ph‖≤uNL}fNL(pi)={0.5+0.5cos{πuNL×(‖pi−ph‖−uHR)}‖pi−ph‖>uHR1‖pi−ph‖≤uHR.Neck angle morphing field(uNA)vii.V¯NA={v|θeˆ}where theθeˆrotational vector from Euler’s rotation theorem and its rotational axis is given byeˆ=LN×LA‖LN×LA‖R¯NA={pi|‖pi−ph‖≤uNL}fNA(pi)={0.5+0.5cos{πls×(‖pi−ph‖−uNL−ls)}‖pi−ph‖>uNL−ls1‖pi−ph‖≤uNL−ls.Consequently, the morphing vectorvi∗of a pointpi, which will be used for calculating the target point, can be obtained by multiplying the parametric change to the related FBM field, given byvi∗=Δuf(pi)vi, whereΔuis the variation of a functional parameter andviis the corresponding vector ofpi. The final step of FBM method is to obtain the target points, determining the shape of the morphed model. These points are obtained by simply adding the morphing vectors to the original points aspi∗=pi+vi∗.

@&#CONCLUSIONS@&#
