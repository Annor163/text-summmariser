@&#MAIN-TITLE@&#
Scheduling pumpoff operations in onshore oilfields under electric-power constraints

@&#HIGHLIGHTS@&#
Models for scheduling pumpoff control operations in onshore oil fields.Cyclic behavior and system-wide power consumption are accounted for by the models.The models are based on scheduling conditions and column-based strategies.Computational analysis show that column-based models are more efficient and flexible.Models for reconfiguring operations are also proposed and analyzed.

@&#KEYPHRASES@&#
OR in energy,Integer programming,Onshore oilfields,Sucker-rod pumping,Pumpoff scheduling,

@&#ABSTRACT@&#
In onshore oilfields, several sucker-rod pumps are deployed over a large geographic area to lift oil from the bottom of production wells. Powered by electric rotary machines, the rod pumps operate according to cyclic control policies that alternate between on and off pumping periods which are designed to drive maximum production. This cyclic behavior gives rise to the problem of scheduling pumpoff operations in order to minimize the system power peak and thereby smoothen the power-consumption profile. To this end, this paper develops MILP formulations for the coordination of control policies and their reconfiguration during operations. Following a column-based approach or using integer variables to model the power-consumption profile, the resulting MILP formulations are put to the test in a host of synthetic, but representative oilfields.

@&#INTRODUCTION@&#
The development of an oilfield is a complex undertaking that extends for several years, evolving from the discovery of the reservoir to the planning of production facilities, well drilling, and production. Typical oilfields can cover large geographic areas with dozens of production and water-injection wells—the injection of water is applied to maintain the internal pressure of the reservoir. As the oilfield matures, artificial lifting techniques are required to bring the oil from the bottom of the wells to the surface where the multiphase flow of water, oil, and gas is separated and processed (Camponogara & Nakashima, 2006; Codas & Camponogara, 2012). The artificial-lifting technique adopted in an oilfield depends on a number of factors, such as the depth of the reservoir, the viscosity of the oil, and its location, whether being onshore or offshore.In onshore fields, sucker-rod pumping is a widely applied technique for its relative low investment and maintenance cost, inherit flexibility, and variable production rate (Lake, 2007; Ordoñez, 2008; Ordoñez, Codas, & Moreno, 2009). A rod-pump system consists of a rotary machine connected to a plunger that runs inside the production tubing. In combination with the coordination of the opening and closing of valves, the alternating up-and-down movement of the plunger lifts a certain amount of oil to the surface (Thomas, 2001). When the oilfield matures, rod pumps operate according to pumpoff control policies that split the control cycle in on and off pumping periods. Such policies are implemented to allow the reservoir to replenish the fluids around the perforation zone of the well, preventing the plunger from hitting the well bottom with an empty chamber and thereby avoiding equipment damage.Onshore oilfields are typically operated with several rod pumping units that draw electric energy from a power line and possibly share flowlines that connect wells to a processing station. In particular, the operation of oilfields located in remote areas to the north and northeast of Brazil are severely constrained by the limited electric-power supplied by the utility company (Ribeiro, 2012). These limitations give rise to the problem of scheduling pumpoff operations in order to minimize the system power peak. Besides stressing the power grid, an uneven system power-consumption profile induces oscillations in the flowlines which are transferred to the separation station. Related problems are found in the operation of offshore oilfields which instead consider the scheduling of electric submersible pumps (ESPs), such as in the Peregrino oilfield located off the coast of Brazil (Solbraekke, 2014).Aiming at improving production operations of onshore oilfields, this work formalizes the problem of scheduling pumpoff operations so as to minimize the system power peak and to induce a smooth power-consumption profile. MILP formulations are developed for the scheduling problem following two principles, one based on integer variables and the other on column variables that define a feasible pumping profile over time. Akin to the scheduling of pumpoff operations, related problems in which binary variables play a major role are found in practice and the technical literature. A relevant problem is the scheduling of electric-power generating units to meet the forecast load and spinning reserve, while adhering to generator and transmission constraints, a class of problems collectively known as unit commitment (Bertsimas, Litvinov, Sun, Zhao, & Zheng, 2013; Hobbs, Rothkopf, O’Neill, & Hung-po Chao, 2001).The paper is organized as follows. Section 2 presents the basic operation of rod pumps and introduces the problem of scheduling pumpoff operations. Section 3 introduces the concept of hyperperiod and formally defines the problem. Section 4 develops three Mixed-Integer Linear Programming (MILP) formulations for the scheduling problem. Section 5 presents the problem of adjusting pumpoff control policies in response to equipment failure and deviation from the nominal operation. Section 6 reports on results from computational analyses aimed at assessing the performance of the scheduling and rescheduling models. Finally, Section 7 offers a summary and suggests directions for future research.Sucker-rod pumping is one the first artificial-lifting strategies to have been deployed in oilfields. Having a relative low investment and maintenance cost, rod pumping has found widespread application in mature onshore oilfields for its inherit flexibility and variable production rate (Bhatkar & Anwar, 2013; Ordoñez, 2008; Torres, Schnitman, & de Souza, 2013). The technique converts the energy of an electric- or combustion-powered rotary machine into the movement of a plunger that runs inside the well tubing. In combination with the coordinated opening and closing of the standing and traveling valves, the alternating up-and-down movement of the plunger lifts an amount of oil from the bottom of the production tubing up to the surface (Thomas, 2001). The main elements of a rod pumping production system are illustrated in Fig. 1.The artificial lift with rod pumping consists of a cycle with two distinct phases: the upstroke and downstroke as illustrated in Fig. 2. During the upstroke phase, the piston is elevated to the top part of the working barrel. At this moment, the traveling valve is closed due to the weight exerted by the oil in the production tubing, thereby reducing the pressure within the working barrel. The difference between this pressure and the pressure of the annulus at the perforations forces the standing valve to open, allowing oil from the reservoir to flow inside the working barrel. During the downstroke phase, the piston plunges down to the bottom of the well, exerting pressure on the standing valve which is forced to close. As a result, the piston compresses the oil inside the working barrel, forcing the traveling valve to open which in turn allows the oil to flow into the production tubing.In reservoirs that have reached an advanced stage of maturity, the internal pressure at the well perforations is not sufficiently high to sustain the oil inflow into the working barrel for the continuous operation of the rod pump. The low pressure of the reservoir reduces production significantly and can damage the pumping unit if the piston hits an empty well bottom, an incident known as fluid-pound (Ordoñez, 2008).A widely adopted solution to allow production under such levels of depletion consists in operating the rod pumps intermittently. The rotary machine is turned off for a predefined time interval until the fluids in the annulus reach an adequate level for production. At this point, the engine is turned on and production is sustained until the oil level in the annulus drops below the minimum for operation. This control strategy is known as pumpoff.The pumpoff control strategy is defined by two parameters, ton and toff, which define the time the rotary machine is running and the time it is turned off, respectively. The pumpoff operation induces a repeating cycle of lengthtc=ton+toff,which alternates between pumping and not pumping intervals. Techniques are found in the literature to define the pumpoff control strategy (Westerman, 1977), but this is not the focus of this work. Here, the parameters defining pumpoff control are assumed known for each well. The focus is on the coordination of the control signals so as to induce a smooth profile of electric-power consumption for the entire oilfield.LetW={1,…,W}be indices of the rod pumps operating in a given oilfield. Table 1gives the parameters for each rod pump w of an illustrative oilfield, namely the pumping timetwon,the off pumping timetwoff,the cycle timetwc,and the power Pwdrawn during pumping.Time is divided in a setT={0,1,…,T−1}of intervals. The control signal of each pump is held constant during the interval[t,t+1)Δtfor allt∈Twhere Δt is the interval length. Let ϕw(t) ∈ {0, 1} denote the pumpoff control signal for a pump w according to a given policy, meaning thatϕw(t)=1if the pump is working during the time window[t,t+1)Δtandϕw(t)=0otherwise. Fig. 3 depicts the electric-powerPw(t)=Pwϕw(t)drawn by each pump w. In the illustrative oilfield, unitw=3will be pumping during the time window [0, 2), not producing during the window [2,5), and so forth in a cyclic manner.Let P(t) denote the total power drawn by the pumping units during time interval t, namelyP(t)=∑w∈WPw(t)=∑w∈WPwϕw(t). Fig. 4depicts the total power drawn by the pumping units of the illustrative oilfield over a period of 30 minutes. This simple experiment brings about a complex behavior of the aggregated power-consumption profile, a behavior which is not easily related to the unit signals depicted in Fig. 3. Last but not least, the experiments show that the total power drawn is quite irregular without coordination of the control signals, with points of low consumption and peaks when several pumps are running simultaneously. Besides stressing the power grid, this uneven power profile incurs fluctuations in the flow lines which are transferred to the separation station. This undesirable behavior gives rise to the problem of scheduling the pumpoff operations by delaying the start time of each rod pump.This work develops optimization-based strategies to optimally schedule the pumpoff operations with the goal of minimizing the power peaks. Besides preventing power-grid overload, such an objective reduces fluid oscillations in the separation station and the stress on the flow gathering system.The coordination of pumpoff operations can be achieved by delaying the operation start time of each rod pump which, after this delay, will behave according to the cyclic regime given by the off and on pumping intervals. This coordination strategy does not affect the steady-state regime of the pumps which is established by the production engineers. In what follows, fundamental concepts are introduced and the problem of scheduling pumpoff operations is formalized.The hyperperiod of a set of periodic tasks is the smallest time window necessary to capture the complete behavior of the system. This means that the system behavior becomes cyclic, repeating itself in each hyperperiod until the occurrence of an event that affects the tasks. Fig. 5illustrates the hyperperiod of the rod pumps of the illustrative oilfield whose control policies are defined in Table 1: the vertical line at 30 minutes defines the transition from the first to the second hyperperiod. The hyperperiod corresponds to the Least Common Multiple (LCM) of the cycle times. Thus, the hyperperiod is 30 minutes for the rod pumps with cycles of length 2, 3, 5 and 10 minutes.The scheduling of pumpoff operations is achieved by imposing an initial delay on the operation start time of each production unit. The delay of pump w is denoted by δw, which is the time the pump will wait to start pumping according to its control cycle. The delay is implemented only at time 0, then cyclic behavior is reproduced onward.However, the delay δwshould not exceed a given threshold for consistency and technical reasons. First, the cyclic behavior of a pump w in steady state will not be induced in the first cycles if the delay exceeds the limit, causing the system power-consumption profile during the first hyperperiod to differ from the succeeding hyperperiods (see Fig. 5). Second, any undue delay in production will translate into oilfield underproduction and incur a loss in revenues. Third, the decision space of the scheduling problem increases with the size of the domain for δw, which invariably renders the resulting optimization problem harder to solve.To illustrate the influence of the maximum delay, consider pump 3 of the illustrative oilfield given in Table 1. Fig. 6 presents the control signal ϕ3(t) induced by an initial delayδ3=3. Notice that pump 3 has a cyclic behavior that repeats itself during the entire prediction horizon. On the other hand, Fig. 7 shows the behavior of the same pump when the delay isδ3=4. With a delay in excess of 3 units, the behavior during the first cycle does not match the cyclic behavior in steady-state conditions, unlike what was observed for a delayδ3=3.The cyclic behavior of a pump w is ensured by the following condition:(1)ϕw(t)=ϕw(t−twc),∀t∈T,t≥twc.This condition states that the control signals in the first cycle univocally define the control signals of the following cycles. Further, the initial delay must not exceed a suitable threshold for the hyperperiod to remain representative of cyclic behavior, as illustratedin Figs. 6 and 7. The bound on delay for a rod pump w must be:(2)δw≤twc−twon=twoff=δwmax.The mathematical model for scheduling pumpoff operations will have the control signal ϕw(t) and delay δwas the decision variables. Certain conditions on these variables are necessary to ensure a valid schedule:1.the control signal must add up to the activation timetwonduring each cycle;the control signal that activates pumping must be continuous.Notice that if these conditions are met during the first cycle, then their validity for future cycles is implied by Eq. (1). In mathematical notation, the conditions 1 and 2 become(3a)∑k=0twc−1ϕw(k)=twon(3b)∑k=δwδw+twon−1ϕw(k)=twonA mathematical formulation must fulfill the conditions established by Eqs. (2), (3a) and (3b) in order to define a valid schedule. In what follows the scheduling problem will be stated in a general form and later formalized in three distinct, but equivalent mathematical programming models. Before that, let us formalize the concept of hyperperiod.Letϕ(t)=(ϕw(t):w∈W)be a vector with the control signals of all rod pumps operating in the oilfield. Further, let THP be the least common multiple of the pump cyclest1c,…,tWc. The following theorem establishes the cyclic behavior of the system control signalϕ(t) with a cycle of length equal to the hyperperiod.Theorem 1ϕ(t+THP)=ϕ(t)for all t ≥ 0.Notice that it suffices to show that each elementary function ϕw(t) will be cyclic with respect to the hyperperiod. For each pump w, it follows from the definition of ϕw(t) and Eq. (1) that:(4)ϕw(t)=ϕw(t+THPtwctwc),t=0,1,2,…because THP is a multiple of the pump cycletwc. Lumping together for allw∈Win a vectorϕ(t)=(ϕ1,ϕ2,…,ϕW)(t),yields:(5){ϕ1(t)=ϕ1(t+THPt1ct1c)ϕ2(t)=ϕ2(t+THPt2ct2c)⋮=⋮ϕW(t)=ϕW(t+THPtWctWc)⇒{ϕ1(t)=ϕ1(t+THP)ϕ2(t)=ϕ2(t+THP)⋮=⋮ϕW(t)=ϕW(t+THP)⇒ϕ(t)=ϕ(t+THP),t=0,1,2,….□The scheduling problem consists in delaying the pumping operations in order to minimize the maximum electric-power peak, while ensuring the schedulability conditions (3). Formally, the problem is stated in mathematical programming as:(6a)P:minϕw(t),δwPmax(6b)s.t.:∑w∈WPwϕw(t)≤Pmax,t∈T(6c)Forallw∈W:ϕw(t)=ϕw(t−twc),t∈T,t≥twc(6d)∑t=0twc−1ϕw(t)=twon(6e)∑t=δwδw+twon−1ϕw(t)=twon(6f)δw≤δwmax(6g)δw∈Z+(6h)ϕw(t)∈{0,1},t∈Twhich has a decision space with(W+WT)variables, W integer and WT binary, and approximately(T+WT+3W)constraints.This formulation serves the purpose of putting together the conditions and variables that define the scheduling problem. Because constraint (6e) is only defined for a discrete value of δw, the relaxation of the integer variables does not render a well-defined relaxation (Wolsey, 1998). ThusPis a conceptual formulation that does not allow the direct application of mathematical optimization algorithms. For instance, a spatial branch-and-bound relies on the iterative solution of relaxations that fix a subset of the discrete variables.Constraint (6e) must be reformulated in a suitable form to allow the application of mathematical optimization algorithms. Two possibilities are the reformulation of (6e) as:•a system of nonlinear differentiable functions; ora system of linear inequalities, invariably using additional integer variables.The first strategy is typically more compact and scales well with respect to problem size, however global optimization may be challenging and only a local optimum might be reached. Although the second strategy can introduce a large number of integer variables, mathematical optimization algorithms for MILP are more robust and can reach the global optimum. For this reason, this work will develop two models for linearizing constraint (6e).This section develops MILP formulations for scheduling pumpoff operations.This formulation introduces auxiliary variables and constraints to express the condition established by Eq. (3b) in a linear form. This condition ensures that the pumping operation is continuous within each cycle.Specifically, the variableyw(t)∈{0,1},t∈{0,…,δwmax−1},is defined for the periods of the first cycle during which the pumping operation can be delayed. Whenyw(t)=1the control signal ϕw(t) univocally takes on value 0, thus the rod pump may be working only ifyw(t)=0. Besides, ifyw(t)=0thenyw(t+1)=0whenever defined. Finally, the sum of the variables yw(t) must correspond to the delay δwfor consistency reasons. This means that the signal yw(t) will take on value 1 only for the initial periods during which the pump is inactive.On the other hand, the variablezw(t)∈{0,1},t=twon,…,twc−1,is defined for the end periods of the first cycle, starting attwonuntiltwc−1. Whenzw(t)=1the control signal ϕw(t) will be forced to take on value 0, however ϕw(t) may assume any value otherwise. Also, oncezw(t)=1all of the succeedingzw(t′)=1for t′ > t, which ensures that zw(t) will assume value 1 for the final periods of the cycle during which pump w is not running.The resulting formulation consists of an MILP program:(7a)Pvb:minθvbPmax(7b)s.t.:∑w∈Wϕw(t)Pw≤Pmax,t∈T(7c)Forallw∈W:ϕw(t)=ϕw(t−twc),t∈T,t≥twc(7d)∑t=0twc−1ϕw(t)=twon(7e){yw(t)≥yw(t+1),t=0,…,δwmax−2ϕw(t)≤1−yw(t),t=0,…,δwmax−1∑t=0δwmax−1yw(t)=δw(7f){zw(t)≤zw(t+1),t=twon,…,twc−2ϕw(t)≤1−zw(t),t=twon,…,twc−1∑t=twontwc−1zw(t)=δwmax−δw(7g)yw(t)∈{0,1},t=0,…,δwmax−1(7h)zw(t)∈{0,1},t=twon,…,twc−1(7i)δw≥0(7j)ϕw(t)∈{0,1},t=0,…,T−1whereθvb=(Pmax,y,z,δ,ϕ)is a vector with the decision variables, withy=(yw(t):w∈W,t=0,…,δwmax−1),z=(zw(t):w∈W,t=twon,…,twc−1),δ=(δw:w∈W),andϕ=(ϕw(t):w∈W,t∈T).The number of variables is bounded byW(δmax+toffmax+1+T)+1,out of which at mostW(δmax+toffmax+T)are binary and the remaining continuous, whereδmax=max{δwmax:w∈W}andtoffmax=max{twoff:w∈W}. The number of constraints is bounded byT+W(T+3+2δmax+2toffmax).The objective (7a) seeks to minimize the maximum power peak Pmax  defined in Eq. (7b).Constraint (7c) imposes the cyclic behavior of each pump w, which should repeat the pattern of the first cycle. Constraint (7d) ensures that pump w will be running fortwonunits of time, which implies in not operating fortwoff=twc−twonunits of time.Constraint set (7e) ensures that the control signal ϕw(t) assumes value 0 during δwunits of time at the beginning of the first cycle. Likewise, constraint set (7f) makes sure that ϕw(t) assume value 0 duringδwmax−δwunits at the end of the first cycle. Together with constraint (7d), these constraints ensure that pump w will be running fortwonunits of time consecutively during the first cycle, since the pump will not run for(δwmax−δw)+δw=δwmax=twoffunits of time at the beginning and at the end of the first cycle.Notice that the boundδw≤δwmaxis induced by the last constraint of (7e). Further, this constraint and the integer nature of yw(t) ensure the integrality of δw.The arguments above lead to the following proposition.Proposition 1The variable-based formulationPvbis an MILP program which is equivalent to problemP.The column-based approach represents all of the feasible profiles of a given pump, referred to as “columns,” which are then associated to binary variables. This alternative formulation can be viewed as a variation of the set covering problem. Since the full behavior of a pump w is defined by its control signal during the first cycle, it suffices to introduce a column for each possible value of the delay δw. Also, the space of decision variables can be reduced to a logarithmic factor of the number of columns by using a logarithmic encoding.For the scheduling problem, the columns are easily generated off-line by simple enumeration: it consists in defining the profile of pump w for each valueδw∈{0,…,δwmax}. In more complex problems, column generation is carried out on demand, possibly involving the solution of a constraint satisfaction problem or an MILP problem to generate an improving column. For instance, a column is generated by solving a knapsack problem in the cutting stock problem (Gilmore & Gomory, 1961). For a pumpw∈W,the profile induced by delay δwis represented by a vectorxw,δw∈{0,1}twcsuch that its entries are defined as follows:•xtw,δw=0fort=0,1,…,δw−1,xtw,δw=1fort=δw,δw+1,…,δw+twon−1,andxtw,δw=0fort=δw+twon,…,twc−1,which defines the state of pump w over the first cycle, and consequently the future behavior. For pumpw=3of the illustrative example, in whichtwon=2andtwoff=3,the profile induced byδw=2isx3,2=[00110]′where 0 indicates off pumping and 1 on pumping. Having introduced the above notation, the column-based formulation of the scheduling problem is given by:(8a)Pcb:minθcbPmax(8b)s.t.:∑w∈WPwϕw(t)≤Pmax,t∈T(8c)Forallw∈W:xw=∑δ∈Dwxw,δbw,δ(8d)∑δ∈Dwbw,δ=1(8e)ϕw(t)=xtw,t=0,…,twc−1(8f)ϕw(t)=ϕw(t−twc),t∈T,t≥twc(8g)δw=∑δ∈Dwbw,δδ(8h)bw,δ∈{0,1},δ∈DwwhereDw={0,…,δwmax}andθcb=(Pmax,x,ϕ,δ,b)is the vector of decision variables, withx=(xw:w∈W),b=(bw,δ:w∈W,δ∈Dw),andϕandδdefined as before. The binary variable bw, δtakes on value 1 if the profile given by xw, δis chosen for the operation of pump w, otherwise it assumes value 0.The number of variables is bounded byW(tcmax+T+1+δmax)+1,out of which at most Wδmax  are integer, wheretcmax=max{twc:w∈W}. The number of constraints is bounded byT+W(tcmax+T+2).By construction, the profiles xw, δdefine the cyclic behavior of pump w for each feasible delay δ. This leads to the following proposition.Proposition 2The column-based formulationPcbis an MILP program that is equivalent to problemP.A reduction on the number of binary variables is achievable by representing bw, δwith a logarithmic code, akin to the logarithmic models for piecewise-linear function approximation (Silva & Camponogara, 2014; Vielma, Ahmed, & Nemhauser, 2010). For a pump w, the codification is induced by the binary variables λw, l∈ {0, 1},l∈Lw={0,…,Lw−1}whereLw=⌈log2(δwmax+1)⌉. The binary variable λw, lcan be viewed as the branch decision in a decision tree with l being the depth:λw,l=0indicates branching to the left, whereasλw,l=1indicates branching to the right.For the sake of illustration, consider a pump w withδwmax=3which impliesLw=2andLw={0,1}. A coding for the profiles of this pump is given below:(λw,1,λw,0)Profile(0,0)xw,0(1,0)xw,1(0,1)xw,2(1,1)xw,3Given a pump w, letDw1,l⊆Dwbe indices of the profiles for which the codingλw=(λw,Lw−1,…,λw,0)has value 1 at position l, whereasDw0,lis the subset of those with 0 at position l. Notice thatDw0,l∪Dw1,l=Dw. In the example given above,Dw0,1={0,2}andDw1,1={1,3}.Based on the above notation, the column-based formulation can be reformulated in the following equivalent form:(9a)Pcblog:minθcblogPmax(9b)s.t.:∑w∈WPwϕw(t)≤Pmax,t∈T(9c)Forallw∈W:xw=∑δ∈Dwxw,δbw,δ(9d)∑δ∈Dw1,lbw,δ≤λw,l,l∈Lw(9e)∑δ∈Dw0,lbw,δ≤(1−λw,l),l∈Lw(9f)∑δ∈Dwbw,δ=1(9g)ϕw(t)=xtw,t=0,…,twc−1(9h)ϕw(t)=ϕw(t−twc),t∈T,t≥twc(9i)δw=∑δ∈Dwbw,δδ(9j)0≤bw,δ≤1,δ∈Dw(9k)λw,l∈{0,1},l∈Lwwhereθcblog=(Pmax,x,ϕ,δ,b,λ)is the vector of decision variables, withλ=(λw,l:w∈W,l∈Lw)and the other vectors defined as before.The number of variables is bounded byW(tcmax+T+2+δmax+⌈log2(δmax+1)⌉)+1,out of which at mostW⌈log2(δmax+1)⌉are binary. The number of constraints is bounded byT+W(tcmax+2⌈log2(δmax+1)⌉+3+T).Notice thatPcblogis equivalent toPcb,but instead requires a logarithmic number of binary variables.The baseline scheduling problemPconsiders the initial operation of the oilfield, in which all rod pumps are ready to start operating. Depending on the oilfield configuration, particularly the distribution of the cycle time of the pumps, the resulting hyperperiod may be excessively long for optimization and reliable predictions. For instance, a rod pump may deviate from its predefined cyclic behavior or fail, invariably invalidating the predictions. These operational situations give rise to a variation of the baseline problem which concerns the rescheduling of the pumpoff operations. The objective should minimize control-policy readjustment of the operating pumps, while keeping the power peak within bounds.Let τ be the time of reconfiguration for the oilfield. Depending on the system state, a pump may or may not be operating at reconfiguration time. The pumps are divided in two subsets:Won={w∈W:wis pumping at the time of reconfiguration} andWoff={w∈W:wis not pumping at reconfiguration}. Fig. 8illustrates these conditions for pumpw=3of the illustrative example, for whicht3on=2,t3off=3,andt3c=5. At the reconfiguration timeτ=10,pump 3 is off pumping for the control profile at the top, but pumping at the lower profile.The rescheduling problem is derived from the baseline problemPgiven in Eq. (6) and defined over a prediction horizonT^={τ,τ+1,…,τ+T−1}.For a pumpw∈Woff,letδwlastbe the number of time units that the pump has not being running during the latest working cycle. Notice thatδ3last=1for the control profile given in the upper plot of Fig. 8. To ensure a proper off pumping interval, the constraintδw≥twoff−δwlastmust be introduced in the formulation.On the other hand, for a pumpw∈Won,lett3lastbe the latest number of time units during which this pump has been running consecutively, before the reconfiguration time τ. For the lower profile in Fig. 8,t3last=1. The decision now is about the extension of the pumping operation from time τ onward, so that the operating time remains belowt3on. Letδ^wdenote the length of the extension, such that0≤δ^w≤twon−twlast. In the illustrative exampleδ^3≤t3on−t3last=1.The general formulation for rescheduling takes as input the maximum power peakPwmaxand minimizes the number of control adjustments. Formally, the rescheduling problem is stated as:(10a)P^(Pmax):minθ^∑w∈Wxw(10b)s.t.:∑w∈WPwϕw(t)≤Pmax,t∈T^(10c){ϕw(t)=ϕw(t−twc),t∈T^,t≥τ+twc,∑t=ττ+twc−1ϕw(t)=twon,ϕw(t)∈{0,1},t∈T^,w∈W(10d){∑t=τ+δwτ+δw+twon−1ϕw(t)=twon,δw≥δwmax−δwlast,δw≤δwmax−δwlast(1−xw),δw∈Z+,xw∈{0,1},w∈Woff(10e){∑t=τ+δ^wτ+δ^w+twoff−1ϕw(t)=0,δ^w≤twon−twlast,δ^w≥(twon−twlast)(1−xw),δ^w∈Z+,xw∈{0,1},w∈Wonwhere xwtakes on value 1 if the control policy of rod pump w will be readjusted at time τ, otherwise it assumes value 0, andθ^=(ϕ,δ,δ^,x)is the vector of decision variables, withδ=(δw:w∈Woff),δ^=(δ^w:w∈Won),andx=(xw:w∈W). Notice that the objective accounts for the number of readjustments of pumpoff control policies.FormulationP^hasW(T+2)integer variables and the number of constraints is bounded byT+W(T+4).This MILP formulation uses the same structure and auxiliary variables ofPvbfor a wellw∈Won. Because these wells cannot start or continue pumping at time τ, the new formulation essentially introduces a bound for minimum delay to ensure the proper off pumping interval.On the other hand, for a wellw∈Wonwhich has finished pumping or is still pumping at the moment of reconfiguration, new auxiliary variables with other semantics are needed. The variabley^w(t)∈{0,1},t=τ,…,τ+twon−twlast−1,is defined for the initial periods during which pump w can continue pumping, completing or not an intervaltwon. The constraints will ensure that oncey^w(t)=0,then all the following variables are also 0. Further,ϕw(t)=1wheny^w(t)=1,otherwise ϕw(t) becomes unconstrained.Similarly, the variablesz^w(t)∈{0,1},t=τ+twon−1,…,τ+twc−1define the periods at the end of the cycle during which the pump is running. The constraints are such that ifz^w(t)=1,thenz^w(t+1)=1and thereby all of the following variables.The resulting MILP formulation is given by:(11a)P^vb(Pmax):minθ^vb∑w∈Wxwwhile being subject to:(11b)∑w∈Wϕw(t)Pw≤Pmax,t∈T^(11c)Forallw∈W:{ϕw(t)=ϕw(t−twc),t∈T^,t≥τ+twc∑t=ττ+twc−1ϕw(t)=twonϕw(t)∈{0,1},t∈T^(11d)Forallw∈Woff:{yw(t)≥yw(t+1),t=τ,…,(τ+δwmax−2)ϕw(t)≤1−yw(t),t=τ,…,(τ+δwmax−1)∑t=ττ+δwmax−1yw(t)=δwδw≥δwmax−δwlastδw≤δwmax−δwlast(1−xw)(11e){zw(t)≤zw(t+1),t=(τ+twon),…,(τ+twc−2)ϕw(t)≤1−zw(t),t=(τ+twon),…,(τ+twc−1)∑t=τ+twonτ+twc−1zw(t)=δwmax−δw(11f){yw(t)∈{0,1},t=τ,…,(τ+δwmax−1)zw(t)∈{0,1},t=(τ+twon),…,(τ+twc−1)xw∈{0,1}(11g)Forallw∈Won:{y^w(t)≥y^w(t+1),t=τ,…,(τ+twon−twlast−2)ϕw(t)≥y^w(t),t=τ,…,(τ+twon−twlast−1)∑t=ττ+twon−twlast−1y^w(t)=δ^wδ^w≤twon−twlastδ^w≥(twon−twlast)(1−xw)(11h){z^w(t)≤z^w(t+1),t=(τ+twoff),…,(τ+twc−2)ϕw(t)≥z^w(t),t=(τ+twoff),…,(τ+twc−1)∑t=(τ+twoff)τ+twc−1zw(t)=twon−δ^w(11i){y^w(t)∈{0,1},t=τ,…,(τ+twon−twlast−1)z^w(t)∈{0,1},t=(τ+twoff),…,(τ+twc−1)xw∈{0,1}whereθ^vb=(ϕ,y,z,δ,y^,z^,δ^,x)is the vector of decision variables with•y=(yw(t):w∈Woff,t=τ,…,(τ+δwmax−1)),z=(zw:w∈Woff,t=(τ+twoff),…,(τ+twc−1)),y^=(y^w(t):w∈Won,t=τ,…,(τ+twon−twlast−1)),z^=(z^w(t):w∈Won,t=(τ+twoff),…,(τ+twc−1)),δ,δ^,and x defined as before.The number of variables is bounded by(WT+|Woff|(δmax+tonmax)+2W+2|Won|tonmax),with only W being continuous while the others are integer variables. The number of constraints is bounded byT+W(T+1)+|Woff|(2δmax+4+2toffmax)+|Won|(4tonmax+4).The variable-based formulationP^vb(Pmax)is an MILP program.The rescheduling problem is derived directly from the column-based formulationPcb. For a pumpw∈Woff,the model is essentially identical toPcbexcept that the profiles withδw<δwmax−δwlastare disconsidered. The feasible profiles of pumpw=3in Fig. 8 are [0 0 1 1 0]′ withδw=2and [0 0 0 1 1]′ withδw=3.For a pumpw∈Won,the pumping profiles should be constructed so as to allow a pumping extensionδ^w∈{0,…,twon−twlast}. The feasible profiles for pumpw=3in Fig. 8 are [1 0 0 0 1]′ withδ^w=1and [0 0 0 1 1] withδ^w=0.The column-based MILP formulation of the rescheduling problem is given by:(12a)P^cb(Pmax):minθ^cb∑w∈Woff∑δ∈Dwcw,δbw,δ+∑w∈Won∑δ^∈D^wcw,δ^bw,δ^while being subject to:(12b)∑w∈WPwϕw(t)≤Pmax,t∈T^(12c)ϕw(t)=ϕw(t−twc),t∈T^,t≥(τ+twc),w∈W(12d)ϕw(t)=xtw,t=τ,…,(τ+twc−1),w∈W(12e)Forallw∈Woff:{xw=∑δ∈Dwxw,δbw,δ∑δ∈Dwbw,δ=1δw=∑δ∈Dwbw,δδbw,δ∈{0,1},δ∈Dw(12f)Forallw∈Won:{xw=∑δ^∈D^wxw,δ^bw,δ^∑δ^∈D^wbw,δ^=1δ^w=∑δ^∈D^wbw,δ^δ^bw,δ^∈{0,1},δ^∈D^wwhere:•Dw={δwmax−δwlast,…,δwmax};cw,δ=0ifδ=δwmax−δwlastbut otherwisecw,δ=1forw∈Woff;D^w={0,…,twon−twlast};cw,δ^=0ifδ^=twon−twlastor elsecw,δ^=1forw∈Won;θ^cb=(ϕ,x,δ,b,δ^,b^)is the vector of decision variables;ϕ, δ, andδ^are defined as above;x=(xtw:w∈W,t=0,…,twc);b=(bw,δ:w∈Woff,δ∈Dw); andb^=(bw,δ^:w∈W^on,δ^∈D^w).Clearly, the column-based formulationP^cb(Pmax)for scheduling reconfiguration is an MILP problem. The number of variables in this formulation is bounded byW(T+1)+Wtcmax+|Woff|δmax+|Won|tonmax,with|Woff|δmax+|Won|tonmaxvariables being integer. The number of constraints is bounded byT+WT+4W+Wtcmax.A logarithmic version of the column-based formulation can be derived by implementing the variable encoding described previously. The resulting logarithmic formulation would be equivalent toP^cb(Pmax),but instead would need a logarithmic number of binary variables.The computational analysis aims to evaluate and compare the formulations for scheduling and reconfiguring pumpoff operations. A host of instances was generated in a pseudo-random manner by sampling uniformly from parameter ranges that are typical of onshore oilfields (Lake, 2007; Ribeiro, 2012; Tyler, 1994). More specifically, the oil fields consist of 20, 30, 40 and 50 rod pumps with a maximum cycle time of 10, 15 and 20 minutes. Time is measured in minutes with cycle times divided between ton and toff at random. The length of the prediction horizon was set to be a week, which corresponds toT=10080minutes.The formulations for scheduling and reconfiguration were expressed in AMPL (Fourer, Gay, & Kernighan, 2002) and then solved with IBM ILOG CPLEX version 12.4.01, CPLEX for short. The computational experiments were performed in a workstation with a 8-core Intel Xeon CPU E5-2665 @ 2.40GHz, the Linux operating system, and 40 gigabytes of RAM. Solving time was limited to 12 hours of CPU.Table 2 presents the computational results obtained by solving the problem instances using the variable-based, column-based, and the logarithmic column-based formulation. The table gives the minimum power peak for each instance and the CPU time (in seconds) required to solve a given instance with each formulation. The value given in column Pmax  is the minimum peak (the optimum objective) for all instances, except for the oilfield with 50 pumps and cycle times of at most 20 minutes. The entries of the table labeled with a “⋆” are those that the solver ran out of memory, whereas for the ones labeled with a “†” the solver reached the time limit. With the variable-based formulation, the relative difference between the obtained solution and the dual bound (GAP)11GAP is defined as|BestInteger−DualBound|/|BestInteger|.was 0.73 percent in the instance with 40 pumps and cycle length of 20 minutes. For the instance with 50 pumps and cycle of 20 minutes, the variable-based, column-based, and logarithmic column-based formulations achieved a GAP of 2.32, 1.54, and 1.48 percent, respectively. Table 2 also provides the number of variables and constraints for each problem instance and formulation.The similar performance of the column-based formulations can be attributed to the similar structure and close number of variables and constraints. The number of binary variables of the baseline column-based formulation is∑w∈Wδwmaxwhereas the logarithmic version has∑w∈W⌈log2(δwmax+1)⌉,which may explain the observed computational results. A performance gain of the logarithmic column-based formulation could possibly be induced with an increase in the maximum delayδwmax,which tends to increase with the length of cycle time.On the other hand, the optimum was often obtained faster with the column-based formulations than the variable-based formulation. For the instances in which the optimum was not found, the column-based formulations did not run out of memory and reached a solution with GAP smaller than the variable-based formulation. This behavior may be attributed to a simpler structure of the column-based formulation according to which the pumping profile is fully defined by a single variable, bw, δ, whereas the variable-based formulation has more degrees of freedom induced by the variables yw(t) and zw(t), which must satisfy more complex constraints to generate a feasible pumping profile.For the instances considered, the results show that the column-based formulations achieved comparable performance in terms of CPU time. The variable-based formulation was somewhat less efficient than the column-based formulations, yielding solutions of inferior quality for the large instances. Notice that the variable-based formulation took less time on average, but this is because the solver was halted in two instances well before the time limit due to memory exhaustion. This performance indicates that the column-based formulations are more efficient with respect to memory use.The formulationsP^(Pmax)for rescheduling pumpoff operations were also put to the test. The rescheduling instances were obtained from the instances considered above by requesting a reconfiguration at the end of a seven-day period. The minimum peak power Pmax  that induces a feasible reschedule was calculated by a simple binary search. Because the baseline and logarithmic column-based formulations attained comparable performance in the scheduling problem, the reconfiguration analysis considered only the variable-based and the baseline column-based formulations. Table 3 presents the computational performance that the solver achieved in these formulations. For each instance, the table reports the maximum power peak Pmax , the minimum number of rod pumps that will have their control policies adjusted, and the CPU time required to solve the respective instance. The number of variables and constraints for each formulation and instance are reported in the table. These results show that the problem of rescheduling pumpoff operations can be solved far more efficiently than the problem that sets the initial control policies.As a reservoir matures and its internal pressure declines, artificial-lifting techniques are required to elevate the fluids from the bottom of the wells up to the surface for separation and processing. Among the artificial-lifting techniques, sucker-rod pumping is a widely applied technique in onshore oilfields for its relative low cost of installation and operation. The rod pumps operate according to a cyclic control policy that splits the control cycle in on and off pumping intervals.The coordination of rod pumps gives rise to the problem of scheduling their control operations to minimize the system electric-power peak. A limit on the power peak is imposed by the power-utility company mainly because the power supply is restricted in remote areas, but also to reduce oscillations. To this end, this paper formalized the problem of scheduling pumpoff operations and proposed MILP formulations. The first formulation uses binary variables to induce rod-pump cyclic behavior, whereas the second follows a column-based strategy. A logarithmic version of the column-based formulation was obtained by using a logarithmic encoding of the binary variables. The computational experiments revealed that the column-based formulations are more efficient.The paper also developed MILP formulations for the reconfiguration of pumpoff operations in order to keep the power peak within bounds, while minimizing control-policy readjustments. The computational analysis showed that the reconfiguration problem can be solved far more efficiently than the scheduling problem. Further, variable-based and column-based formulations achieved comparable performance in the considered instances.A chief advantage of column-based formulations is that complex and time-varying power-consumption profiles can be modeled in a straightforward manner. Further, a column-generation approach may be devised to bring profiles on demand (Barnhart, Johnson, Nemhauser, Savelsbergh, & Vance, 1998; Dantzig & Wolfe, 1960), rather than introducing all of the columns at once. Finally, the models presented heretofore could be extended to address the scheduling of electric submersible pumps, which is a favorite technique for artificial lifting in heavy oil reservoirs located off the coast (Solbraekke, 2014). These are topics for future research and development.

@&#CONCLUSIONS@&#
