@&#MAIN-TITLE@&#
Extending CAN bus with ISA100.11a wireless network

@&#HIGHLIGHTS@&#
We present a framework for building a hybrid network with CAN and ISA100.11a.We propose schemes to ensure prioritization and reduce end-to-end delay in hybrid network.The delay of the proposed schemes is evaluated by simulation under interference of IEEE 802.11.The delay bottleneck of the hybrid network lies on ISA100.11a network.Proposed schemes enable CAN-ISA100.11a hybrid network as an industrial network.

@&#KEYPHRASES@&#
Hybrid network,CAN bus,ISA100.11a delay characteristic,End-to-end delay,

@&#ABSTRACT@&#
In this paper, we present a framework for building a hybrid network composed of Controller Area Network (CAN) bus and ISA100.11a industrial wireless network. The end-to-end delay of CAN-ISA100.11a hybrid network is evaluated. One scheme is proposed based on time slot configuration in ISA100.11a to ensure the prioritization hierarchy which is suitable for large packet size, namely priority assurance (PA). Moreover, a comparison between shared time slot and short time slot is evaluated to give insight on which one gives the best performance in CAN-ISA100.11a hybrid network. The delay of the proposed framework is further simulated under interference environment.

@&#INTRODUCTION@&#
The traditional wired control networks have been successfully implemented for industrial applications in decades. The ability of traditional wired control networks to provide high speed, high reliability, and bounded delay makes them a popular option to be implemented in industrial plants [1]. However, the wired control networks require infrastructure and space for installation. Adding the new machine to the existing plant using wired control networks often creates new problem of cable routing difficulties and sometimes requires system engineer to re-design the whole cable routing plan. Moreover, the installation and maintenance of cables and connectors are usually much more expensive than the cost of the sensors themselves [2]. Having a wireless network as an alternative in such environments would be exceptionally valuable.Hybrid network of wired and wireless technology has become the hot topic research as a result of increasing demands in applying wireless network for industrial application. Hybrid network introduces different delay characteristics, depending on what technology composes the hybrid network. Bayilmis et al. proposed an interworking design to enable CAN nodes to communicate over IEEE 802.11b Wireless Local-Area Network (WLAN) using encapsulation method [3]. Similarly, in [4] Ren et al. proposed a design to integrate the CAN bus with Bluetooth. Those related works pointed out the necessity to extend wired control networks with the wireless one to satisfy industrial needs.The work presented in this paper focuses on the integration of wired and wireless networks which can interconnect stationary and mobile devices. More specifically, this work deals with extending CAN bus using ISA100.11a to meet real-time control application requirements in both automotive and industrial control. CAN bus is a serial data communication protocol that provides high reliability and good real-time performance with very low cost. The CAN bus has gained popularity in the industry due to its wide usage in a wide range of applications [5]. For example, in industrial automation processes, robotic arms are connected to the controller (computer) using CAN bus [6].On the other hand, ISA100.11a is an emerging open standard for process control dedicated for industrial automation and related applications [7]. This paper, to the best of our knowledge, is one of the first efforts in considering hybrid network of two popular communication protocols in the industry, CAN bus, and ISA100.11a. Given the critical nature and performance requirements of automation and control networks, both protocols' ability to support message priority and provide deterministic delay makes them suitable for most industrial environments.The main contribution of this paper is to develop a hybrid network using both wired and wireless networks for industrial environment, where distributed control unit (DCU) is considered. CAN is used to connect among DCUs while ISA100.11a is used to connect sensor and/or actuator to DCUs.The remainder of this paper is organized as follows. The following section presents a brief overview of CAN bus and ISA100.11a network. Section 3 highlights the network architecture that is used to describe the hybrid network, the proposed framework for interconnecting CAN bus and ISA100.11a, and our proposed schemes to ensure prioritization and reduce end-to-end delay in the hybrid network. Simulation model and presentation of results obtained from simulations are discussed in Sections 4 and 5, respectively. Finally, the conclusions are presented in Section 6.CAN is a serial bus communication protocol developed by Bosch in the early 1980s [8]. In particular, the CAN standard only defines three layers namely the object layer, the transfer layer, and the physical layer while in the application layer could be CANopen, DeviceNet, CAL (CAN Application Layer), etc. CAN is essentially a broadcast network, where a message transmitted will be received by all nodes that are attached to the bus. In general, a CAN-compliant node consists of three parts: the host processor, the CAN controller, and the transceiver. The host processor decides which messages it wants to transmit, sees all the messages on the bus, and interprets received messages. The CAN controller is basically a buffer for both incoming and outgoing messages. Finally, CAN transceiver is the PHY (physical) layer of CAN, which converts the transmit bit received from the CAN controller into a signal that is sent onto the bus, and vice versa.CAN bus uses CSMA/AMP (Carrier Sense Multiple Access with Collision Detection and Arbitration on Message Priority) mechanisms. In case of simultaneous transmission, arbitration is performed based on the priority level of the message identifier (ID), in which a logic zero is dominant over logic one, and enables the message whose ID has the highest priority to be delivered immediately. If two nodes start transmitting at the same time and one of them receives a dominant bit (0) when a recessive bit (1) has been transmitted, the node loses arbitration and stops transmitting as illustrated in Fig. 1.The CAN bus specification has 2 versions, 2.0A (original version) and 2.0B (extended version). The difference between CAN 2.0A and CAN 2.0B standard is located in the format of the message header. CAN 2.0A allocates an 11-bit identifier while CAN2.0B contains a 29-bit identifier. CAN bus is optimized for short messages, with size of data field is between 0 and 8 bytes. The achievable data rate of CAN bus depends on the length of the bus. The maximum data rate supported by CAN bus is 1Mbps, with bus length no more than 40m. A data rate of 125kbps would allow a network length up to 500m. However, it is allowed to use bridge devices or repeaters to increase the allowed distance to more than 1km.The ISA100.11a standard is intended to provide reliable and secure wireless operation for non-critical monitoring, alerting, supervisory control, open loop control, and closed loop control applications [7,9,10]. The components of an ISA100.11a network consist of the security manager, system manager, gateway, backbone routers, and field devices as depicted in Fig. 2. The system manager performs policy-based control of the network runtime configuration, monitors, and reports on communication configuration, performance, and operational status. The security manager provides security services while gateway provides an interface between ISA100.11a field network and plant network. Backbone router enables external networks to carry ISA100.11a-compliant packet by encapsulating the PDUs (Protocol Data Units) for transport, allowing ISA100.11a network to use other networks. However, ISA100.11a standard is not specified particularly the data network for backbone. In that case, the backbone could be an IEEE 802.11, an industrial Ethernet, or any other network which has an interfacing feature to the plan network [7]. Furthermore, the backbone routers are employed to extend the routing capability via the backbone. By using a backbone router device, it allows the ISA100.11a network to communicate with other networks.ISA100.11a protocol supports star, mesh, and the combination of both topologies. The physical layer of ISA100.11a devices is constructed based on IEEE 802.15.4 PHY standard that uses Direct-Sequence Spectrum Spreading and O-QPSK (Offset-Quadrature Phase-Shift Keying) modulation [11]. ISA100.11a only operates in a 2.4-GHz band, using IEEE 802.15.4 channels 11–25. Channel 26 is defined as optional in ISA100.11a. Each channel is spaced 5-MHz apart and has a bandwidth of 2MHz.The MAC (Media Access Control) of ISA100.11a implements both TDMA (Time Division Multiple Access) and CSMA/CA (Carrier Sense Multiple Access with Collision Detection and Collision Avoidance) mechanisms. The usage of TDMA allows ISA100.11a to provide a contention free period which is known as dedicated time slot. The main advantage of dedicated time slot guarantees one node to transfer data in a particular slot without colliding with other data from another node. However, dedicated time slot requires time slot reservation in other to attempt the slot. Also, time slot can be wasted if node failed to transfer the data in those reservation slots. Due to that reason, the dedicated time slot is designed for predictable and regular traffic to achieve QoS (Quality of Service), which is desired for industrial applications. In comparison, the shared time slot is adopted using CSMA/CA algorithm. The advantage of the shared time slot provided a chance for every node to occupy the slot. Nevertheless, in shared time slot, each node competed in getting the slot in transmitting the data. It is recommended that shared time slot is used for high priority and fewer predictable data such as alarm and retry. The timing axis of each device is divided into configurable fixed time slot duration, with the typical value of 10–12ms. A collection of time slots repeating in one cyclic schedule forms is called superframe. The length of the superframe is configurable and can vary from one device to another. In general, longer-period superframes result in higher data latency and lower bandwidth, but with reduced energy consumption and less concentrated allocation of digital bandwidth [7]. Unlike the IEEE 802.15.4, in ISA100.11a the number of retries depends on the packet living time determined by MaxLifeTime.ISA100.11a transport layer supports data exchange with other networks using tunneling mechanism. The protocol defines the tunneling via un-buffered client and via gateway. In un-buffered client, the ISA100.11a node has direct communication with other nodes from different protocols. In most legacy protocols, this method is not energy efficient due to lengthy response time related to sleeping devices [7]. In tunneling via gateway, the data exchange between ISA100.11a and other protocols is stored or buffered and gateway forwards the data to the destination node.A network topology model shown in Fig. 3is used in this paper to describe the CAN-ISA100.11a hybrid network. The network model is intended to represent common network architecture in the industry where the main focuses are monitoring and process control. Process control is performed in Distributed Control System (DCS), in which DCUs are the controller element. The DCUs are distributed throughout the system and connected by CAN bus network for communication. DCUs transmit a control message, which usually has small size [12], to field devices such as sensors and actuators. The field devices are connected to a gateway and communicate with the gateway through ISA100.11a wireless network. The field devices report monitoring message to DCUs with varying sizes, depending on application requirement.Three types of node are defined, which are CAN node, gateway node, and ISA100.11a node. The CAN node only has CAN bus (CAN2.0B) technology and represents DCUs. The gateway node acts as an interface for both CAN bus and ISA100.11a and understands the MAC layer of both network technologies. Gateway also represents the system manager and the security manager in the ISA100.11a system. Finally, ISA100.11a node is ISA100.11a-compliant device that represents sensor, actuator, or end devices.A framework is proposed to interconnect CAN2.0B network that communicates through ISA100.11a wireless network. For routing purpose, a designated CAN transmitted the data to a dedicated ISA100.11a through the gateway. Both CAN and ISA100.11a nodes have knowledge about the source and destination address for every data packets. Moreover, an important function of the gateway is to translate any incoming traffic from CAN node into ISA100.11a-compliant message format and forwards the traffic to a designated sensor node, and vice versa. The maximum message size that can be accommodated by CAN2.0B messages is 8bytes while ISA100.11a supports maximum message size of 96bytes. This specification enables message arriving from CAN nodes to be encapsulated directly into ISA100.11a DSDU (Data link Layer Service Data Unit) frame after CAN header is stripped. After the message from the gateway is received at a designated ISA100.11a node, header parts of ISA100.11a are decapsulated and CAN2.0B messages are extracted from ISA100.11a DPDU (Data link Layer Protocol Data Unit) to be processed by ISA100.11a nodes.However, the amount of data transmitted from ISA100.11a node may be more than 8bytes, hence fragmentation is necessary for carrying an ISA100.11a message in CAN2.0B message format. Incoming message from ISA100.11a nodes to the gateway with size of more than 8bytes must be fragmented into a small fragment of 8bytes before being encapsulated into CAN message format and forwarded to CAN node. Upon receiving the message from a gateway, MAC layer of CAN node buffers incoming messages to construct the original data from ISA100.11a node before sending it to higher layer. Fig. 4shows message frame ISA100.11a and CAN bus, respectively.The CAN standard does not dictate the specific requirement of the arbitration field, although many higher level protocols define the meaning of each identifier bits. One can use the first few bits for priority and the remaining bits to identify the message type. On the other hand, it is evident that the fragmentation requires the sequence number attached to each fragment so that the transmitted information can be reconstructed by the receiver. The maximum message size of 96bytes from ISA nodes, therefore maximum number of fragment created by the gateway is 12 fragments, implying that 4bits are necessary for fragment sequence number. Hence, it is proposed that 4 out of 29bits in CAN identifier are reserved as fragment sequence number.Both CAN bus and ISA100.11a support message prioritization, where the message with higher priority has a better probability to gain access to the channel. In ISA100.11a, message prioritization is supported during the contention period with CSMA/CA. Up to 16 message classes are available, 4bits are reserved for this number AlertPriority, with only 5 class usage suggested by standard as shown in Table 1. Priorities within a shared time slot are managed by configuring delay time before performing CCA (Clear Channel Assessment) (τ[i]). A device with fewer critical requirements may be configured to delay its transmission slightly later in the time slot.In CAN2.0B protocol, with 29-bit identifier, more than 16 message classes are supported. A standard point of view for message prioritization is proposed in the gateway model so that a message priority can be translated properly, both from ISA100.11a nodes to CAN nodes, and conversely. Hence, the number of bits allocated for priority in CAN bus is set to 4, consistent with ISA100.11a. A one-to-one priority mapping can be carried out using this configuration. Fig. 5depicts the priority and sequence number bits inside CAN identifier field. The left-over bits in CAN identifier can be used for another purpose such as a destination address, and a source address.Finally, it is important to note that while CAN bus supports data rate up to 1Mbps, ISA100.11a only accommodates maximum data rate of 250kbps. Thus, the maximum data rate supported by CAN-ISA100.11a hybrid network is 250kbps. Increasing data rate of CAN bus will only further cause an imbalance network, since the packet from CAN nodes may accumulate in the gateway and wait a long time before it can be forwarded to the gateway.To support multiple applications within a network ISA100.11a supports multiple levels of QoS. In ISA100.11a, delay time before performing CCA determines the priority of a packet. A device with high-priority message may be configured to transmit as early as possible within a shared time slot. Thus, if another device has claimed the time slot, the CCA of the delayed device might or might not detect that the channel is in use, depending on the message transmission time (Ttx) and the duration of τ[i]. In Fig. 6, node 2 detects that the medium is busy because of transmission from node 1. However, node 3 identifies that the medium is idle since node 1 has finished its transmission by the time node 3 performs CCA. Thus, node 3 will be able to claim the time slot while node 2 has to defer its transmission even though it has higher priority. As a consequence, prioritization will be meaningless since node with lower priority may have better access to the channel and consequently, lower delay. Moreover, this may result in higher priority packet fails to meet its stringent deadline while less stringent deadline of lower priority packet is met.Therefore, the duration of τ[i] must be regulated so that the node with higher priority message would always have a better probability to access the channel than the lower priority one. This guarantee of priority is called priority assurance (PA) scheme and done by ensuring that the delay time τ[i] of a node with the lowest priority message does not exceed the transmission time of the highest priority message. Let P be a total number of priorities in one subnet, then the aforementioned condition is true if:(1)maxTdriftTCCA<Δτ<TtransP−1where Tdriftis the maximum clock drift of a node with respect to gateway clock, Ttransis the transmission time, TCCA=tCCA1+tCCA2 is the total time to perform CCA, tCCA1 is CCA duration, tCCA2 is time interval between end of CCA and start of transmission, and Δτ is the difference between two successive CCA delay time. Parameter of the collision time model is presented Table 2.The transmission time is determined by data size and header length. The default value of ISA100.11a header is 31bytes as illustrated in Fig. 7and Table 3. Only one node can claim one shared time slot in this PA scheme and nodes with lower priority message will always defer its transmission when a higher priority node already claimed the time slot. This PA ensures the prioritization hierarchy and is easily implemented when the packet size is large.The second scheme proposed in this paper is to reduce the bottleneck effect of ISA100.11a in a hybrid network in terms of delay [13]. The idea is to limit the time slot resource allocation on a node based on the length of packet transmittal. This can be done in two ways, short time slot and shared time slot (Fig. 8). Industrial process control and monitoring systems have characteristics of small data sizes and periodic messages. Consequently, even though ISA100.11a can accommodate data size up to 96bytes, in most cases only a small fraction of time slot is used by a device, leading to wasted time slot resource. By limiting the time slot duration based on the size of the packet to send the bottleneck effect of ISA100.11a in a hybrid network, it can be reduced to further an extent as illustrated in Fig. 7.Assuming that preparation time is zero, which can be translated that the start-up transmitter radio is performed before the beginning of observed time slot, then from the ISA100.11a time slot template, the total time needed by a node to send a message is(2)Ttot=TCCA+Ttrans+tTA+tACK,where tTAis turn-around time, and tACKis ISA100.11a ACK duration. Then, the time slot duration Tdof ISA100.11a can be expressed as(3)Td≥Ttot+2Tdrift.In shared time slot, where one time slot can be accessed by multiple nodes as illustrated in Fig. 8(c). This is basically the same as the standard case in Fig. 6, with both cases allowing more than 1 node to be transmitted in 1 time slot. However, the CCA delay time in shared time slot is carefully managed so that the higher priority transmission will always get better channel access than the low priority one. One way to do it is by simply dividing the time slot into the number of nodes available in a subnet. However, this is usually not feasible since there is a high possibility of a high number of nodes in an industrial subnet. Another way is by dividing the time slot into M fractions, whereM=TdTtot+2Tdrift. The first M-1 fractions are allocated for M-1 nodes/highest priorities, while the last fraction is allocated for the remaining nodes/priorities, with the same Δτ configuration as in PA scheme for nodes/priorities in the last fraction.Simulation is performed using OPNET modeler in a network scenario shown in Fig. 3. The simulation scenario consists of 5 CAN nodes and 10 ISA100.11a nodes, where each ISA100.11a node is connected to a gateway in the star topology. The maximum data rate of both CAN nodes and ISA100.11a nodes is set to 250kbps. The superframe length of ISA100.11a node is always kept constant at 25 slots, with time slot duration of 10ms. The lifetime of ISA100.11a packets is set to be 30s, as suggested by the standard. All CAN nodes and ISA100.11a nodes generate packet with the same inter-arrival time (λ). The simulation duration is 100s and packets are generated with different start times which follows a uniform distribution from 0 to 5. The timing synchronization between gateway and ISA100.11a nodes is assumed to be perfect. The default wireless models of OPNET library are used for emulating the background noise, propagation delay, radio interference, received power, bit error rate, etc.To model priority on ISA100.11a, each ISA100.11a node produces only one kind of priority packets. 10 of the ISA100.11a nodes are divided into five categories to represent five priority classes used in ISA100.11a. Therefore, simple FIFO (First In First Out) queuing is used instead of priority queuing. However, priority queuing needs to be implemented in the gateway, otherwise packet with lower priority may block the higher priority packet in case of FIFO queuing. ISA100.11a nodes are always set to send data with packet size of 100bits. In CAN node, data is generated with CAN ID that is uniformly distributed from 0 to 2047, with constant size of 64bits. In all simulation cases, the gateway node is set not to generate any packet except beacon for ISA100.11a nodes and only does packet fragmentation/encapsulation and packet forwarding.

@&#CONCLUSIONS@&#
