@&#MAIN-TITLE@&#
A robust-CVaR optimization approach with application to breast cancer therapy

@&#HIGHLIGHTS@&#
We develop two formulations for the tails of a loss distribution under uncertainty.Our robust-CVaR framework generalizes existing CVaR methods in the literature.Our models are less conservative than the worst-case methods in the literature.We apply our model to radiation therapy treatment planning of breast cancer.Our method achieves improved performance over the standard treatment planning methods.

@&#KEYPHRASES@&#
OR in health services,Robust optimization,Conditional value-at-risk,Radiation therapy,Breast cancer,

@&#ABSTRACT@&#
We present a framework to optimize the conditional value-at-risk (CVaR) of a loss distribution under uncertainty. Our model assumes that the loss distribution is dependent on the state of some system and the fraction of time spent in each state is uncertain. We develop and compare two robust-CVaR formulations that take into account this type of uncertainty. We motivate and demonstrate our approach using radiation therapy treatment planning of breast cancer, where the uncertainty is in the patient’s breathing motion and the states of the system are the phases of the patient’s breathing cycle. We use a CVaR representation of the tails of the dose distribution to the points in the body and account for uncertainty in the patient’s breathing pattern that affects the overall dose distribution.

@&#INTRODUCTION@&#
The value-at-risk (VaR) of a loss distribution at the confidence levelβis the smallest loss such that the probability of exceeding such a loss is at mostβ. The VaR concept is useful to measure quantities associated with the tail of a loss distribution. It has found application in areas such as finance (Duffie & Pan, 1997; Linsmeier & Pearson, 2000; El Ghaoui, Oks, & Oustry, 2003) and healthcare (Bortfeld, 1999; Wu & Mohan, 2000; Erkut, Ingolfsson, & Erdoğan, 2008), but solving optimization problems with VaR metrics are challenging since these problems are non-convex (Artzner, Delbaen, Eber, & Heath, 1999). Conditional value-at-risk (CVaR) is an alternative metric that measures the average of the tail loss values (Rockafellar & Uryasev, 2000). One of the attractive features of CVaR is that it is convex (Rockafellar & Uryasev, 2002). However, uncertainty in the underlying loss distribution results in uncertainty in the CVaR measurements.Many researchers have considered robust optimization in a CVaR framework, particularly in financial engineering. Robust optimization is a technique that can be used to manage uncertainties in the data of an optimization problem. In traditional robust optimization, an uncertain hard constraint is replaced by its robust counterpart, to which the solution remains feasible under any realization of the uncertain data within some specified set (Ben-Tal & Nemirovski, 1999, 2000; Bertsimas & Sim, 2004). In the literature of robust CVaR methods, one general approach aims to optimize the worst-case with respect to the choice of the underlying distribution of the stochastic parameter that characterizes the loss distribution (Jabbour, Peña, Vera, & Zuluaga, 2008; Huang, Zhu, Fabozzi, & Fukushima, 2008, 2010; Zhu & Fukushima, 2009). Quaranta and Zaffaroni (2008) considered optimizing a CVaR objective, subject to standard linear constraints with uncertain coefficients, whereas Natarajan, Pachamanova, and Sim (2009) considered CVaR with uncertain parameters in the objective function and formulated worst-case CVaR models for different types of uncertainty sets. Our model is similar in mathematical structure to the mixture and discrete distribution models of Zhu and Fukushima (2009), who consider a likelihood distribution on the sample points and derive a min–max approach to minimize the worst-case scenario. However, we consider a different interpretation of the uncertainty and optimize the expected tail loss as opposed to minimizing the worst-case.In this paper, we consider a system that can be in one of many states at any point in time. The number of states and the loss distribution corresponding to each state are known, but the fraction of time that the system spends in each state is unknown. For example, system states could correspond to states of the economy (e.g., recession, growth) and a different distribution of stock market returns would exist in each state. Our approach models the uncertain fraction of time the system spends in each state and aims to optimize or constrain the accumulated mean tail loss (CVaR) over some period of time. Our robust-CVaR model generalizes some of the existing CVaR models in the literature and is less conservative than worst-case approaches.The development of our robust-CVaR model is motivated by an application in cancer therapy. Intensity-modulated radiation therapy (IMRT) is a cancer treatment method that aims to deliver sufficient radiation dose to a tumor while sparing healthy organs. An IMRT treatment generates a dose distribution – a distribution of dose to points inside the body. In the literature of IMRT treatment planning, the CVaR concept has been used to formulate constraints on the tails of a dose distribution (Romeijn, Ahuja, Dempsey, Kumar, & Li, 2003; Romeijn, Ahuja, Dempsey, & Kumar, 2006). For example, treatments generally aim to minimize underdose (i.e., lower tail of the dose distribution) to the tumor or overdose to healthy organs. Separately, robust optimization has been used to deal with setup uncertainty and day-to-day positioning errors (Chu, Zinchenko, Henderson, & Sharpe, 2005), dose calculation errors (Ólafsson & Wright, 2006), and motion during the treatment session (Chan, Bortfeld, & Tsitsiklis, 2006; Bortfeld, Chan, Trofimov, & Tsitsiklis, 2008). However, there is no literature that combines robust optimization and CVaR in IMRT. We will apply the robust-CVaR method developed in this paper to breast cancer IMRT, where CVaR constraints are used to limit tail dose to the organs and robust optimization is used to mitigate the effects of breathing motion uncertainty, which causes the chest to move unpredictably during treatment.Our specific contributions in this paper are as follows:1.We develop a robust-CVaR framework that models the tail of a distribution, which changes over time depending on the state of some system. Our framework is tractable through a duality-based reformulation, and generalizes the stochastic and worst-case CVaR models in the optimization literature.We develop the first optimization model in IMRT treatment planning that embeds robust optimization within a CVaR framework. This model generalizes the existing clinical treatment planning methods for breast cancer.Breast cancer is the most frequently diagnosed type of cancer and the leading cause of cancer death in females worldwide (Jemal et al., 2011). Patients receiving radiation therapy for left-sided breast cancer demonstrate increased cardiac morbidity (Giordano et al., 2005; Harris et al., 2006; Hooning et al., 2007), which is highly dependent on the volume of heart exposed to radiation during treatment (Marks et al., 2005; Lind et al., 2003). This fact motivates the development of specialized radiation therapy treatment methods for left-sided breast cancer to minimize damage to the heart. Furthermore, breathing motion during treatment causes the heart to move in and out of the radiation field (Jagsi et al., 2007), which adds to the challenge of effectively and consistently sparing the heart.The clinical acceptability of a radiation treatment is usually assessed using dose-volume criteria (the dose to a certain percentage of a structure), which is an equivalent concept to the VaR of a distribution. For example, at Princess Margaret Cancer Centre in Toronto, Canada, one of the dose-volume criteria is that at most 10 cubic centimeters (cc) of the volume of the heart may receive a dose higher than 21.1Gy (Gray (Gy) is the standard unit of measurement for radiation dose). CVaR can be used to constrain the mean dose received by the subset of “voxels” (small volume elements) receiving the highest or lowest dose in a structure. A clinical target volume (CTV) is the primary target that we aim to treat in breast cancer. Fig. 1shows an example distribution of the dose delivered to the CTV, and the CVaR metric describes the average dose to the sub-volume of the CTV receiving the most (or least) dose.A distinguishing feature of treating breast cancer using radiation therapy is the presence of breathing motion. First, breathing motion makes the breast a moving target. The motion pattern may be difficult to predict and can change without warning. Second, the motion induces anatomical changes that fluctuate back and forth between geometries that are more favorable and less favorable for treatment. Specifically, at full inhale, the expanded lung pushes the heart away from the breast and, therefore, the treatment field. At exhale, the heart is closer to the breast and is generally exposed to more radiation. Thus, the quality of the treatment is influenced by the amount of time the patient spends in different phases of the breathing cycle. The breathing phases represent the state of the system in our general framework. Uncertainty in a patient’s breathing pattern leads to potential uncertainty in the delivered dose distribution and hence treatment quality. Our robust-CVaR approach aims to ensure that the clinical dose-volume criteria are met in the presence of uncertainty due to breathing.First, we briefly review the standard (stochastic) CVaR model, closely following the conceptual framework of Rockafellar and Uryasev (2000). Then, we extend this model to formulate CVaR in systems with multiple loss distributions corresponding to different states.Letf(x;Y)be the loss function associated with a decision vectorxand a vector of stochastic parametersY. LetΨ(x,α)be the probability that the amount of loss does not exceed a thresholdα:Ψ(x,α)=PY(f(x;Y)⩽α).The upper value-at-risk at the levelβ(upperβ-VaR) is defined asζ¯β(x;Y)=min{α∈R|Ψ(x,α)⩾β}.The upper conditional value-at-risk at the levelβ(upperβ-CVaR), denotedϕ¯β(x;Y), is defined asϕ¯β(x;Y)=minζ¯β∈Rζ¯β+11-βEY[(f(x;Y)-ζ¯β)+],where(·)+is equivalent tomax{·,0}. We can sample a collection of vectorsy1,…,ynfrom the distribution ofYand approximate the upperβ-CVaR as:(1)ϕ¯β(x;y1,…,yn)=minζ¯β∈Rζ¯β+1(1-β)1n∑k=1n(f(x;yk)-ζ¯β)+.Consider a system that at any time can be in one of a finite number of statesi∈I. For each state, there is a different loss distribution associated with it. In our model, the decision maker is optimizing over a certain time horizon in which the state of the system will fluctuate unpredictably and the cumulative loss will be uncertain, depending on the amount of time the system spends in each state. The proportion of time that the system spends in state i,p̃(i), is unknown and belongs to an uncertainty setP.Letp(i)be the nominal probability that the system is in state i. We denote bypthe nominal probability mass function (PMF), and we usep̃to denote an uncertain PMF. Letf(x;Yi)be the loss in state i, and assume that the system can be in statei∈Iat any time with probabilityp̃(i). Similar to before, we can calculate the probabilityΨi(x,α)that the amount of loss does not exceed a thresholdαwhen the system is in state i. Denote the upperβ-CVaR for state i asϕ¯β(x;Yi). This state-specific CVaR can be formulated asϕ¯β(x;Yi)=minζ¯β,i∈Rζ¯β,i+11-βEYi[(f(x;Yi)-ζ¯β,i)+].The index i can be viewed as the realization of a random variable I with (discrete) state spaceIand probability mass functionp̃. Next, we propose two definitions of the overall (accounting for all states) upperβ-CVaR metric.Our first definition corresponds to computing the state-specific CVaR values, weighted by the time spent in each state. Thus, the overall CVaR, denotedϕ¯βw(x;p̃,Y), can be defined asEI[ϕ‾β(x;YI)]=∑i∈Ip̃(i)ϕ¯β(x;Yi)=∑i∈Ip̃(i)minζ¯β∈Rζ¯β+11-βEYi[(f(x;Yi)-ζ¯β)+]=minζ¯β∈Rζ¯β+11-β∑i∈Ip̃(i)EYi[(f(x;Yi)-ζ¯β)+].We can sample a collection ofnivectorsyi1,…,yinifor each state i:(w-CVaR)ϕ¯βwx;p̃,yi1,…,yini∀i∈I=minζ¯β∈Rζ¯β+1(1-β)∑i∈I1ni∑k=1nifx;yik-ζ¯β+p̃(i).We denote this CVaR variant as (w-CVaR), referring to the weighted CVaR of state-specific distributions.For the second definition of the overall upperβ-CVaR, consider calculating the accumulated tail loss over all states for a particular PMFp̃. Instead of weighting the state-specific CVaR values, we generate a single loss distribution usingp̃and then calculate the CVaR value corresponding to this distribution. Given a particular PMFp̃, we defineY=∑i∈Ip̃(i)Yi.Thus, the overall upperβ-CVaR can now be defined asϕ¯βa(x;p̃,Y)=ϕ‾βx;∑i∈Ip̃(i)Yi=minζ¯β∈Rζ¯β+11-βEYfx;∑i∈Ip̃(i)Yi-ζ¯β+.This definition corresponds to computing the CVaR value associated with the single, accumulated loss distribution corresponding top̃, as opposed to weighting multiple CVaR values associated with multiple distributions (one per state). Again, we can sampleyi1,…,yinfor each state i and write(CVaR-a)ϕ¯βa(x;p̃,yi1,…yin∀i∈I)=minζ¯β∈Rζ¯β+1(1-β)n∑k=1nfx;∑i∈Ip̃(i)yik-ζ¯β+.We denote this CVaR variant as (CVaR-a), referring to the CVaR of the accumulated distribution. Note that when sampling is used to approximate the loss distributions, (CVaR-a) definition can only be used if the same set of samples is used for all states. In other words, if we letyk=∑i∈Ip̃(i)yik,thenykcan be viewed as a sample from the overall accumulated distribution ofY, and (CVaR-a) can be summarized asϕ‾βa(x;p̃,y1,…yn)=minζ¯β∈Rζ¯β+1(1-β)n∑k=1n(f(x;yk)-ζ¯β(x))+.The samples per state represent random draws from the state-specific loss distributions, and the time-weighted cumulative loss distribution can be found by accumulating the loss for each sample.Both (w-CVaR) and (CVaR-a) formulation can be applied if the same set of random samples is used for all states. However, if a different set of samples is used per state, we can only calculate the state-specific loss distributions and (CVaR-a) formulation does not apply. In Section 4, we will show that the issue of sampling has an important interpretation from a medical physics perspective in the IMRT application.These robust-CVaR definitions can be used in the objective or constraints of a mathematical program. In this paper, we focus on robust constraints that involve bounds on CVaR. An upper robust-CVaR constraint at the levelβ, for example, can be written using some parameterUβas follows:(2)ϕ¯β(x;p̃,Y)⩽Uβ,∀p̃∈P.Formulating a robust-CVaR constraint using (w-CVaR) and (CVaR-a) definitions will result in different optimization problems. Note that if the same set of samples is used in each state (thus,ni=n,∀i∈I) and iff(x,Y)is convex inY, the upperβ-CVaR derived from Eq. (CVaR-a) is always less than or equal to that of Eq. (w-CVaR):∑k=1nfx;∑i∈Ip̃(i)yik-ζ¯β+⩽∑k=1n∑i∈If(x;yik)p̃(i)-ζ¯β+⩽∑i∈I∑k=1nfx;yik-ζ¯β+p̃(i).Similarly, the lower-CVaR calculated from Eq. (CVaR-a) is always greater than or equal to that from Eq. (w-CVaR). Thus, in general, when the same set of samples is used for each state, using (CVaR-a) definition results in a less conservative constraint (2) than using (w-CVaR) definition.The choice of CVaR variant also affects the size of the optimization problem. An upper robust-CVaR constraint at the levelβusing (w-CVaR) definition is(3)ζ¯β+1(1-β)∑i∈I1ni∑k=1nid¯β,ikp̃(i)⩽Uβ,∀p̃∈Pd¯β,ik⩾fx;yik-ζ¯β,∀k∈{1,…,ni},∀i∈I,d¯β,ik⩾0,∀k∈{1,…,ni},∀i∈I,whered¯β,ik=fx;yik-ζ¯β+. Similarly, An upper robust-CVaR constraint at the levelβusing (CVaR-a) definition is(4)ζ¯β+1(1-β)n∑k=1nd¯βk⩽Uβ,d¯βk⩾fx;∑i∈Iyikp̃(i)-ζ¯β,∀k∈{1,…,n},∀p̃∈Pd¯βk⩾0,∀k∈{1,…,n},whered¯βk=fx;∑i∈Iyikp̃(i)-ζ¯β+.Note that when the same set of samples is used for each state, formulation (3) has1+n|I|variables,2n|I|normal constraints, and one set of robust constraints∀p̃∈P. Formulation (4), on the other hand, has1+nvariables, and1+nnormal constraints, and n sets of robust constraints∀p̃∈P.In the remainder of this paper, we will use terms such as “(w-CVaR) model” and “(CVaR-a) model” to refer to optimization models that involve constraints like (3) and (4), respectively. In Section 5, we will also show that a (CVaR-a) model generates less conservative solutions than a (w-CVaR) model.The tractability of (w-CVaR) and (CVaR-a) formulations is dependent on the structure ofP. IfPis ellipsoidal, then the robust-CVaR formulations can be re-written as second-order conic programs, and ifPis polyhedral, they can be re-formulated as linear programs (Ben-Tal, El Ghaoui, & Nemirovski, 2009). These methods are standard, duality-based reformulations. In the IMRT application, we focus on the polyhedral uncertainty setP={p∈P|p̲⩽p⩽p¯}, where P denotes the probability simplex andp̲,p¯are given parameters. Table 1shows the size of the robust counterpart of two variations of the problem with a polyhedral uncertainty set, where m is the number of CVaR constraints (e.g., for differentβvalues), and s is the size of the decision vectorx. In Section 4, we will compare the size and solution time of these two formulations for the IMRT application.Worst-case CVaR is normally defined as the CVaR value corresponding to a probability distribution that generates the highest upper CVaR (in the case of minimizing the tail loss). LetIindex the set of distributions. Then, the worst-case CVaR equalssupi∈I{ϕ¯β(x;Yi)}. Suppose that the uncertainty setPis confined to only one element,{pi}, wherepiis a unit vector with a 1 for distribution i (assume for convenience that the set of distributions is finite). If distribution i generates the worst-case CVaR value, then the robust-CVaR formulation generates the worst-case solution over the set of distributions. If the uncertainty set is confined to one elementpˆ, which represents the nominal PMF of the system, the robust formulation in this case will represent the traditional stochastic formulation. In other words, our robust-CVaR framework generalizes the worst-case and nominal (stochastic) CVaR models from the literature. Also, it easy to see that our robust-CVaR method is less conservative than the worst-case models because it takes into account the fraction of time that the system spends in the worst-case state along with the other states of the system, rather than considering the worst-case only.Treatment planning for breast cancer is most commonly implemented using a simple radiation beam geometry in which two opposed tangential beams (Fig. 2) are used to irradiate the whole breast volume (Kestin et al., 2000; Landau, Adams, Webb, & Ross, 2001; Vicini et al., 2002). The concave shape of the chest wall results in unavoidable dose to parts of the heart. The tangential opposed beam setup with IMRT is currently used in clinical practice (Purdie, Dinniwell, Letourneau, Hill, & Sharpe, 2011).To create a treatment plan, the current clinical standard is to acquire a single CT scan while the patient is breathing freely. Breathing motion results in image artifacts. The artifacts can be image blurring, which makes structures appear enlarged or image under-sampling, which results in images with truncated structures. The radiation treatment is designed using this “average scan” as input, and the treatment is delivered while the patient is breathing freely. We denote this method the “average method”.When there is a large volume of the heart in the radiation field, according to the average scan, the patient is re-scanned at a fixed inhale breathing phase (Wang et al., 2012). Breath-hold at inhale expands the lung and pushes the heart away from the breast. Because the patient needs to maintain a stable lung volume for the duration of the scan, an active breathing control (ABC) device, which holds the patient’s lung at a specified and reproducible volume, is used. The radiation treatment is designed using the “ABC scan” as input. During each treatment session, the ABC device is again used to ensure the patient reproduces the same lung volume. We denote this method the “ABC method”.The ABC method better spares the heart, while maintaining target coverage, compared to the average method. However, there are downsides. The ABC method is more time-consuming at imaging and treatment delivery, it is expensive because of the device, and not all patients are able to tolerate long breath holds. The average method requires less time for delivery and can be applied to all patients. However, it does not explicitly consider breathing motion, does not explicitly aim to limit heart dose, and the actual radiation dose accumulated in the various parts of the chest during free breathing may be different from what is planned due to the image artifacts described earlier.Our robust-CVaR approach attempts to capture the benefits of both the average and ABC methods. The ability to deliver the treatment while the patient is breathing freely and improved heart sparing even in the face of uncertainty in the patient’s breathing motion. Our approach leverages “4D-CT” imaging data, which provides multiple snapshots of the anatomy over the entire breathing cycle, as opposed to a single average scan.Our approach to modeling the breast cancer IMRT problem is an example of the general framework described earlier in this paper. The states represent phases of the patient’s breathing cycle (e.g., full inhale, full exhale, and all phases in between). The quantityp̃(i)represents the fraction of the time the patient is in breathing phasei∈I. As the patient breathes, a varying amount of heart and lung will enter the treatment field, which affects the dose delivered to those organs. Our robust-CVaR model controls the tails of the dose distributions to the organs of interest, while accounting for breathing motion uncertainty. First, we formulate the basic CVaR model without uncertainty with the IMRT context. Then, we introduce breathing motion uncertainty.LetBbe the set of beamlets andwbbe the decision variable that represents the intensity of beamletb∈B. Let S be the set of all structures. Each structures∈Sis divided into a set of voxels,Vs. The set of all voxels isV=∪s∈SVs. The parameterDv,b, called the “dose-influence matrix”, quantifies the dose voxel v receives per unit intensity of beamlet b. ThisDmatrix depends on the anatomical setup depicted by a particular CT scan. Given a beamlet intensity vectorw, the total dose delivered to voxel v is∑b∈BDv,bwb. For structure s, letVsα(w)be the set of all voxels inVsthat receive more thanαdose under beamlet intensity vectorw:Vsα(w)=v∈Vs∑b∈BDv,bwb⩾α.Letfsα(w)=|Vsα(w)|/|Vs|be the fraction ofVsthat receives more thanαdose. For structure s, the upperβ-value-at-risk (upperβ-VaR) is the minimum dose levelαsuch that no more than(1-β)%ofVsreceives more thanαdose:ζ¯β,s(w)=infα|fsα(w)⩽1-β.For structure s, the upperβ-conditional value-at-risk (upperβ-CVaR),ϕ¯β,s(w), is the average dose in the parts ofVsthat receive more than the upperβ-VaR dose:(5)ϕ¯β,s(w)=minζ¯β,s∈Rζ¯β,s+1(1-β)|Vs|∑v∈Vs∑b∈BDv,bwb-ζ¯β,s+.Lower CVaR constraints can be defined analogously to upper CVaR constraints. Normally, upper CVaR constraints are included for both the healthy organs and the target. Lower CVaR constraints, however, are typically required only for the target. The full treatment planning model without motion uncertainty is shown in Appendix A.Next, we incorporate breathing motion into the model and develop a robust version to account for breathing motion uncertainty. Each breathing pattern is represented by an uncertain PMF. Background information on how actual breathing pattern traces (e.g., sinusoidal waves) can be converted into PMFs can be found in Lujan, Larsen, Balter, and Haken (1999) and Chan et al. (2006). LetPbe an uncertainty set representing the set of possible PMFs that a treatment should be robust against. Since each phase corresponds to a different anatomical geometry, we now require more than a singleDmatrix. LetΔv,i,bbe the dose voxel v receives per unit intensity of beamlet b when the patient is in phase i.A 4D-CT scan is used as the input data for this model. It is composed of multiple images, one per phase. Assuming the voxel size remains constant throughout the images, each structure may be represented by a different number of voxels in each phase. The number of voxels in each phase corresponds to the number of samples to approximate the distribution in formulation (w-CVaR). LetVsibe the set of voxels in organ s in phase i. We can define the upperβ-CVaR as(6)ϕ¯β,sw(w;p̃)=minζ¯β,s∈Rζ¯β,s+1(1-β)∑i∈I∑v∈Vsi∑b∈BΔv,i,bwb-ζ¯β,s+|Vsi|p̃(i).Eq. (6) corresponds to computing the phase-specific CVaR values, weighted by the time spent in each phase, and is equivalent to (w-CVaR) equation.To be able to use (CVaR-a) equation, we need to use the same set of voxels in each structure throughout the breathing phases. One way to do that is to create a one-to-one mapping of the voxels across phases. This task can be accomplished using deformable registration (Brock et al., 2003, Brock, Sharpe, Dawson, Kim, & Jaffray, 2005). Typically, each structure is represented as a mesh, which is deformed from phase to phase so that the vertices on the surface of the mesh are in one-to-one correspondence throughout the phases. With such a mapping between the images, the number of voxels remains constant in each phase, but their sizes are changing.As a result of the deformation mapping, theΔv,i,bmatrix for each phase will correspond to the same set of voxels, andVsi=Vsfor all i. In this case, for a particular PMFp̃, the accumulated dose over all phases to a particular voxel v can be written as∑i∈I∑b∈BΔv,i,bp̃(i)wb. Then, the upperβ-CVaR is(7)ϕ¯β,sa(w;p̃)=minζ¯β,s∈Rζ¯β,s+1(1-β)|Vs|∑v∈Vs∑i∈I∑b∈BΔv,i,bp̃(i)wb-ζ¯β,s+,which corresponds to Eq. (CVaR-a).If we can track the voxels across phases, both formulations can be used. Otherwise, only (w-CVaR) formulation can be used. The full clinical formulation based on (CVaR-a), which includes both lower and upper CVaR constraints, is given in Appendix B along with its duality-based reformulation. Specific parameter settings and a description of the clinical data are provided in Appendix C. The same parameter settings were used in both formulations.Before demonstrating computational results, we explain how our robust-CVaR formulation generalizes the two existing clinical methods previously described: the average and ABC methods. In the average method, the treatment plan is based on a single “averaged” scan of the patient’s anatomy captured during free breathing. Only the information from this scan is used to generate the treatment plan. In our CVaR-based treatment planning paradigm, the average method can be modeled using our initial CVaR model (5) with a dose-influence matrixDv,bArepresenting the dose voxel v receives per unit intensity of beamlet b in the anatomical setup depicted by the average scan. In the ABC method, the treatment plan is based on an image of the patient anatomy at inhale. Again, the ABC method can be modeled using our initial CVaR model (5) and a dose-influence matrixDv,bIrepresenting the dose voxel v receives per unit intensity of beamlet b in the geometry induced by the patient at full inhale.Given the above discussion, it follows immediately that the robust-CVaR models are a generalization of the two clinical methods. Take formulation (6) as an example and setP={pA}(a singleton). If the average scan can be represented as a convex combination of the scans corresponding to the different breathing phases, then settingpAaccordingly andDv,bA=∑i∈IΔv,i,bpA(i)recovers the average method. If the average scan cannot be represented as a weighted average of the 4D-CT images, then simply add the average scan to the set of 4D-CT images (if there are k phases, make the average scan the “(k+1)-th” phase), and setpAto be a unit vector with a 1 in the(k+1)-th position. In the case of the ABC method, letP={pI}(a singleton) wherepIis a unit vector with a 1 at the inhale phase andDv,bI=∑i∈IΔv,i,bpI(i). The case of formulation (7) is similar.

@&#CONCLUSIONS@&#
In this paper, we develop two robust-CVaR definitions for formulating the tail of a loss distribution under uncertainty. We use a novel interpretation of a system with a loss distribution that is state dependent and the time spent in each state is uncertain. The cumulative loss depends on the uncertain fraction of time the system spends in each state. Our robust-CVaR framework generalizes existing models in the literature and is less conservative than worst-case methods.We demonstrate an application of our framework to the IMRT treatment planning problem of breast cancer where we optimize the tails of the distribution of dose under uncertainty in the patient’s breathing pattern. Our model generalizes two existing clinical methods and has advantages of both – deliverability while the patient is breathing freely and improved cardiac sparing. Our computational results demonstrate improved dosimetric performance over the standard treatment planning method under free breathing.