@&#MAIN-TITLE@&#
Segmentation of uterine fibroid ultrasound images using a dynamic statistical shape model in HIFU therapy

@&#HIGHLIGHTS@&#
The dynamic-based SSM is proposed to improve the performance of conventional SSM.Dynamic-based prior shape can describe the more detailed shape information of ROI.Radial profile feature model makes active contour robust to false edges.Obtained 95.90%, 1.73%, 1.59mm and 2.82mm for TP, FP, AMED and HD, respectively in the test set.Our method is potential for clinical application in HIFU therapy.

@&#KEYPHRASES@&#
Dynamic model,Shape statistical model,Active contour,HIFU ultrasound image segmentation,Uterine fibroid,

@&#ABSTRACT@&#
Segmenting the lesion areas from ultrasound (US) images is an important step in the intra-operative planning of high-intensity focused ultrasound (HIFU). However, accurate segmentation remains a challenge due to intensity inhomogeneity, blurry boundaries in HIFU US images and the deformation of uterine fibroids caused by patient's breathing or external force. This paper presents a novel dynamic statistical shape model (SSM)-based segmentation method to accurately and efficiently segment the target region in HIFU US images of uterine fibroids. For accurately learning the prior shape information of lesion boundary fluctuations in the training set, the dynamic properties of stochastic differential equation and Fokker–Planck equation are incorporated into SSM (referred to as SF-SSM). Then, a new observation model of lesion areas (named to RPFM) in HIFU US images is developed to describe the features of the lesion areas and provide a likelihood probability to the prior shape given by SF-SSM. SF-SSM and RPFM are integrated into active contour model to improve the accuracy and robustness of segmentation in HIFU US images. We compare the proposed method with four well-known US segmentation methods to demonstrate its superiority. The experimental results in clinical HIFU US images validate the high accuracy and robustness of our approach, even when the quality of the images is unsatisfactory, indicating its potential for practical application in HIFU therapy.

@&#INTRODUCTION@&#
Uterine fibroids are commonly occurring benign tumors that can trouble females. The incidence of uterine fibroids in women over the age of 30 years is 20–25% [1]. Ultrasound (US) imaging has becoming the main imaging modality for uterine fibroids diagnosis and treatment, due to its inexpensive diagnostic value compared with computed tomography (CT) or magnetic resonance imaging (MRI) and able to follow anatomical deformations in real-time.In recent years, HIFU therapy is a new computer aided-therapy that has been successfully applied to the treatment of uterine fibroids [2,3]. The major advantage of HIFU is its non-invasive. As shown in Fig. 1, surgeons need only operate the HIFU probe to transmit HIFU focusing on the lesion areas and provided a slice by slice view of the uterine fibroids according to the US imaging. The accuracy of the lesion areas segmentation from the US images directly affects the HIFU therapy's final result. However, the US images uterine fibroids segmentation is not always efficient and accurate due to the images’ low SNR (signal to noise ratio), fuzzy boundaries and inhomogeneity gray distribution. More serious noise and blurry boundaries have been observed in images used in HIFU therapy because of water interference in the treatment process (see Fig. 2). Beyond that, the other potential challenge is that the patient's breathing or unexpected body movement easily causes the deformation of uterine fibroids during the US imaging process, which gives rise to the deformable shapes of lesion areas in HIFU US images. These factors have prevented the conventional segmentation methods from yielding desired results for uterine fibroids in HIFU US images. Until now, manual segmentation by radiologists is still frequently used in HIFU therapy, even though it is a tedious and time-consuming. For these reasons, development of a highly effective and precise US images segmentation method for HIFU therapy is urgently needed.During these decades, a series of segmentation method for ROI from US images have been proposed [4,5]. Among the reported methods, active contour model-based methods have demonstrated the most promising segmentation results. Active contour models can be classified into two categories: parametric active contour models (e.g., [6–9]) and geometric active contour models (e.g., [10–13]). Parametric active contour models adopt the image's gradient information as “external force” and the curvature of contour as “internal force” to push the initial contour toward the region of interest (ROI), and achieve a good segmentation. However, this kind of model has two major limitations. First, the results are sensitive to the noise in the images and the location of initial contours. Second, the ROI can be hardly segmented when its shape in images is complex and deformable. Due to more serious noise and blurry boundaries in HIFU US images, the problem of edge leakage is easily produced when this model is applied to HIFU US images. Geometric active contour model, which was firstly proposed by [10], uses a 3-D continuous surface function to represent a 2-D contour's curve. The evolution of the curve can be determined by a zero level set of the high dimensional function and driven by the forces formed using statistical information about the foreground and background regions. The most advantage of this model is that the curve is evolved by numerical calculation and need not parameterize the curve to track complex topology. In [14], the proposed C–V model can effectively segment US with noise and weak edges as a consequence of not using the image's gradient information. However, incorrect results are produced on HIFU images with inhomogeneity intensity, because the C–V model assumes that regions of intensity in the image are homogeneously distributed and utilized global statistical information [14,15].To overcome the shortcoming of US image, the texture priors of the ROI have been researched to guide the evolution of active contour to the object's boundary by clustering, sparse coding [16–20]. Other researchers utilize the prior shape of ROI to avoid the active contour evolves to the false areas [21–25]. Among these models, ASM (active shape model), which was systematically presented by [23], has been widely applied in medical image segmentation. This model has three parts: (1) building a SSM (statistical shape model) to generate a prior shape of object from training set; (2) constructing an observation model of the ROI from the image to provide the confidence to the prior shape and (3) balancing the energies of the prior shape and observation model to drive the active contour to the ROI. In its SSM part, [26] popularizes the PDM (point distribution model), which represents an object boundary by interactively defining an ordered list of N position vectors P={xi, yi}, i=0, …, N−1 that correspond to the same position among all training shapes. Then, PCA (principal component analysis) [27] is used to reduce the dimensionality and shape modeling. This model represents the average location of points and the main deformation of the shapes in the training set. However, there are still drawbacks in ASM: (1) aligning mark points among training shapes is a time-consuming and inaccurate; (2) PCA is only useful in the case where all the shapes change lie in or at least approximately near the linear subspace; If this assumption does not exist, some importance deformable information of contour could be lost, which may influence the accuracy of the prior shape estimation considerable; (3) the prior shape needs be manually located nearby the object region, which may cause the incorrect instable segmentation results. Therefore, new prior statistical shape was proposed in the segmentation algorithm without requiring explicit correspondence points [28]. However, this model uses an implicit shape representation rather than parametric shape boundaries to remove the need for explicit correspondence point. Training shapes are still implicitly aligned, and the model maintains the assumption of correspondence. To overcome the limitation of PCA, manifold learning based methods [29,30] attempt to train the prior shape of the ROI in the nonlinear subspace. The similarity of the ROI in the image sequence is modeled as prior knowledge to constrain the evolution of the contour [31–34]. The sparse representation and dictionary learning are applied in the ASM framework to detect ROI in echocardiographic sequences [35,36]. Recently, the dynamics-based models (e.g., Newton's second law, Gaussian process, fluid dynamics) are introduced to segment and track the boundaries of the ROI [37–40].As mentioned above, we find that a good prior knowledge of the ROI is a powerful tool for improving the segmentation results in US images. In this paper, we propose a novel dynamics-based SSM to estimate the prior shape to achieve more accurate segmenting uterine fibroids in HIFU US images. In order to avoid the aligning operation in the training set, a new parametric shape representation model (radius time series) is designed. Then, the dynamic properties of stochastic difference equation (SDE) and Fokker–Planck equation (FPE) are firstly employed to construct the SSM (referred as to SF-SSM) which produces the prior shape and prior probability of ROI. Furthermore, an observation model, named radial profile feature model (RPFM), is developed to provide the confidence areas of the ROI to the prior shape in the procedure of refining segmentation results.The remainder of this paper is organized as follows. In Section 2, the proposed radius time series and the derivation of SF-SSM are described in detail. A detailed description about RPFM is given in Section 3. The SF-SSM based segmentation method is explained in Section 4. In Section 5, numerous experiments and comparisons are shown, and several performances of the compared methods are also analyzed and discussed. Finally, in Section 6, we summarize our work and give some directions for future research.In [41], a closed shape is represented by a series of successive radii. For building the statistical shape model (SSM) of uterine fibroids, a radius time series is proposed to be a parametric model to represent the shape of lesion areas in the US image. The parametric model is formalized as Eq. (1). Fig. 3a shows an example of uterine fibroids US images, where the red solid line is drawn by the interactive tool to represent the contour of the lesion areas. A radius time series is constructed on the basis of the contour (see Fig. 3b), where the yellow point denotes the pixel coordinate of central point xcinside the ROI, the blue solid lines are a series of successive radii R by measuring the Euclidean distance from the xcto the boundary of contour, the angle t between the radii is specified as a constant, and the “Markers” represent the points M which are on the boundary by intersected the radii. This model represents any two-dimensional closed shape with a discrete time series. This discrete time series models the discrete time evolution of a state variation, but the state variable is radius r, and the time variable is replaced by t (see Fig. 3c). The most advantage is that this model allows us to express multiple closed shapes in polar coordinate space without the need to align these shapes in the sample set.(1)Q={R,M,t,xc}={{r0,…,rN−1},{m0,…,mN−1},t,{xc,yc}}.To train the shape information of lesion boundary fluctuations, SF-SSM is constructed through incorporating the dynamics properties of SDE and FPE into statistical learning from the field of nonlinear time series analysis, which is used to produce the shape priors and prior probability of the ROI. As described in Section 2.1, a radius time series can be seen as a nonlinear discrete stochastic series which is used as the generative model of the prior shapes. In [42], one-dimensional stochastic variable nonlinear discrete stochastic series is usually represented by a stochastic different equation (SDE). A radius time series can be generated by Eq. (2),(2)r(t+Δt)=r(t)+A(r(t),a)·dt+B(r(t),b)·dWt·dt,where r(t) is a state variable at time t, A(r(t), a) and B(r(t), b) are the deterministic and stochastic terms respectively, a and b represent those coefficients, and Wtis an uncorrelated, time dependent noise with an expected value of zero. The state of r(t) is dependent on the state of r(t−Δt) and the forms of A(r(t), a) and B(r(t), b). According to the character of nonlinear dynamics, the state variation of r(t) meets Markov property, i.e.,(3)Pr(r(t))=f(Pr(r(t−Δt))),where Pr(·) is the probability of state variable r(t), f denotes a probability transition equation of state variable.FPE, was firstly proposed by two researchers (Fokker and Planck), is a famous equation in statistical mechanics, the function of which is to describe the time evolution of the probability density function of the velocity of a particle under the influence of drag forces and random forces. In this paper, FPE is utilized to deduce the form of f, since its function meets our assumption about the variation of ROI. The formula of FPE is shown as follows,(4)∂∂tf(x,t)=−∂∂x[D1(x,t)f(x,t)]+∂2∂x2[D2(x,t)f(x,t)],where f(x, t) is a probability density function, D(1) and D(2) are called the drift and the diffusion coefficients respectively. We substitute Eq. (3) into Eq. (4), the probability of state variable r(t) is given by Eq. (5).(5)∂∂tPr(r(t)|r(t−Δt))=−∂∂rD(1)(r(t))+∂2∂r2D(2)(r(t))Pr(r(t)|r(t−Δt)).The forms of D1(r(t)) and D2(r(t)) are decided by the value of state variable r(t) in the state space while time variable t is under the stable condition. With the discrete data in the sample space, we use Eq. (6) to approximately estimate the forms of D1(r(t)) and D2(r(t)).(6)D(n)(r(t))=limΔt→01Δt([r(t+Δt)−r(t)]n|r(t)=t).The A(x, t) and B(x, t) can be deduced by Eq. (7), the details of derivation are described in Refs. [43,44].(7)A(r(t))=D(1)(r)Δt,B(r(t))=D(2)(r)Δt.According to Eq. (6), the forms of Dn(r(t)) can be approximately fitted, and then the deterministic and stochastic terms of Eq. (2) are given by Eq. (7).In [45], the discrete observation data from training data are utilized to estimate the forms and parameters of candidate functions. Inspired by this method, we design a radius transition histogram to train the observation data (see Fig. 4a). This radius transition histogram is not only employed to approximately estimate the drift and diffusion functions and the radius transition probability, but also provide the radius transition probability at each time t. The details of training steps are described in Algorithm 1.Algorithm 1Training radius transition histogramInput:Training setℝ={R1,…,Rj,…,RM}, rj(t)∈Rj, rj(t)>0, 0≤t≤2πOutputRadius transition histogram1:Transform the training setℝinto the state spaceR={rmin, …, rmax}.2:Set the radius increment Δr and divide the state space R into Nbins byN=⌈rmax−rminΔr−1⌉.3:Compute the center values ri∈{r1, …, rN} for every bins.4:Set up N sets xi, i∈{1, …, N}, which correspond to N bins.5:forRj, j=1:Mdo6:forbins, i=1:Ndo7:find rj(t)∈[ri−Δr/2, ri+Δr/2], t∈[0:Δt:2π]8:ift+Δt<2πthen9:put rj(t+Δt)into setxi10:else11:put rj(t+Δt)into setx112:end if13:end for14:end forAs shown in Fig. 4b, we find that the observed data in each bins follow a normal distribution, which denotes the transition probability of state variable r(t) (see Eq. (8)). The mean μiand variance σiare given by kernel density estimation.(8)Prr(t+Δt)|r(t)∈ri±Δr2=N(μi,σi).Eq. (8) can be used to approximately represent the prior probability of each radius r(t+Δt) as follows:(9)Pr(r(t+Δt)|r(t)=ri)=N(μi,σi).To estimate the forms of the drift and diffusion functions, Eq. (6) is represented as the discrete form (see Eq. (10)),(10)D(1)(ri(t))=(μi−ri)ΔtD(2)(ri(t))=σiΔt,ri∈{rmin,…,rmax}.Then, the candidate functions A(r(θ), a) and B(r(θ), b) are computed by Eq. (7), the parameters of which can be estimated by using Levenberg Marquardt routine with the lowest χ2. The prior shape is generated, when the deterministic and stochastic terms of Eq. (2) are determined. The probability of the prior shape is also provided by computing a joint probability distribution as follows,(11)ESF-SSM=∏i=1N−1Pr(r(t+Δt)|r(t)=ri),which is used to derive a probability for a test image from the log of Eq. (11),(12)ESF-SSM=1N×∑i=0N−1logPr(r(t+Δt)|r(t)=ri).In active contour based methods, the observation model of the target region is critical for the segmentation performances. In order to overcome the complex image texture around the contour parts in HIFU US images, the most noticeable feature of the lesion areas which is the dark-to-bright transition from the inside to the outside of lesion areas in US images is utilized to develop a new distinctive observation model of the lesion areas for HIFU US segmentation. To describe the local image appearance of the radius r in the radius time series, we select the proper number and locations of sample points along the radial direction for each mark point and use a one-dimension normalized radial second order derivative profile to form a radial profile feature vector of each mark point. In addition, the characteristic that the gray distribution around lesion areas in US images follows Rayleigh distribution, which was proven in [46,47], is incorporated into the radial profile feature vectors to train the radial profile feature model (RPFM) which provides a likelihood probability that the radii and the true boundary intersect. Fig. 5shows the schematic of how to construct RPFM, its detailed implementations are described as follows:Step 1For each image in the training set, construct the radius time series of the ROI by a pixel-selected tool.For each mark point mion the radius r(ti), sample η points using a fixed spacing δ evenly from both sides along the radial direction (see Fig. 5b). The location of jth point is(13)mij=mi+j·δcos(t).The values of η and δ will be discussed in Section 5.1.Letgi=(|gi1|,…,|gij|,…,|giη|)denote the radial profile feature vector of r(ti), where|gij|is the gradient magnitude of sample pointmij.The normalized value of|gij|is given by(14)|gij|=|2·V(mij)−V(mij+1)−V(mij−1)||V(mij)|,where V(·) denotes the pixel value ofmij.With the values of {g1, …, gi, …, gn}, RPFM can be trained through estimating the coefficients of the Rayleigh distribution, which provides a likelihood probability that the radius r(ti) and the true boundary intersect (see Eq. (15)).(15)Pr(gi|r(ti))=r(ti)σ2exp−(r(ti)−a)22σ.(16)ERPFM=∏i=0N−1Pr(gi|r(ti)).As shown in Fig. 6, the workflow of our method is summarized as three parts: (1) train SF-SSM to generate the prior shape and probability of uterine fibroids; (2) build RPFM to provide a likelihood probability of the target areas; (3) after RPFM is trained, it is incorporated into the prior shape by computing the maximum a posteriori probability to segment the uterine fibroids in HIFU US image. The pseudo codes of our method are represented in Algorithm 2, the details of implementation are described as follows:1.For each US image, the radius time series is constructed from the sample set I=[I1, …, Ij, …, Is]). In the procedure of constructing radius time series, the central point xcis defined which has maximum distance to any contour pixel inside the ROI, and then successively computed the Euclidean distance betweenxcjandmijas radiusrij. To normalize the variablesrij, each radiusrijis represented as difference from a mean radialri¯, whereri¯=(1/s)∑j=1srij. In order to eliminate the estimation error of xcas far as possible, we defineΔxc=(1/s)∑j=1s(mxj¯−xcxj)andΔyc=(1/s)∑j=1s(myj¯−xcyj)as the offset of the central point (see Eq. (17)),(17)xc′=xc+Δxcyc′=yc+Δyc.On the base of the radius time series, SF-SSM is constructed by Algorithm 1, which generate the prior shape and probability on the test image by Eqs. (2) and (12) respectively.As described in Section 3, RPFM is built from the sample set, which provide a likelihood probability of ROI by Eq. (16).According to Bayesian theory, the maximum a posteriori probability of each radius riis computed by Eq. (18),(18)E(ri)=Pr(ri|r=ri−1)×Pr(gi|ri).The segmentation result is produced in case that the active contour is refined by Eq. (19) until the posteriori probability less than a threshold,(19)E(Q)∝ESF-SSM×ERPFM.Algorithm 2SF-SSM based segmentation methodInput:A uterine fibroids HIFU US image and set a maximum iteration thresholdT.Output:Uterine fibroids segment.1:Define the central point xcin the lesion area and eliminate the errors of the xcby Eq. (17);2:Initialize the prior shape QSF-SSMand prior probability ESF-SSMof the ROI by SF-SSM;Optimization:3:whileE(Q)≤Tdo4:fort=0:2πdo5:fork=1:2η+1do6:ComputerE(rtk)=Pr(rtk)×Pr(gtk|rtk)by Eq. (18);7:end for8:Findk=argmaxkE(rtk);9:rt←rt+k·δ;10:mt←mtk;11:end for12:Computer E(Q) by Eq. (19);13:end while14:Interpolate {mt|0≤t≤2π} and generate a closed segmentation region.

@&#CONCLUSIONS@&#
