@&#MAIN-TITLE@&#
Speckle reduction in medical ultrasound images using an unbiased non-local means method

@&#HIGHLIGHTS@&#
In this paper, an unbiased NLM speckle filter based on Gamma statistics has been proposed.The three parameter Gamma distribution function is used to fit the real US image in the proposed method.The scale and shape parameters of the Gamma distribution are estimated using the maximum likelihood (ML) method.The bias due to noise is expressed in terms of the Gamma parameters and is removed from the NLM filtered output.The excellent functioning of the proposed filter is well validated by experiments using both synthetic and real US images.

@&#KEYPHRASES@&#
Denoising,Maximum likelihood estimation,Non-local means,Speckle noise reduction,Ultrasound image,

@&#ABSTRACT@&#
Enhancement of ultrasound (US) images is required for proper visual inspection and further pre-processing since US images are generally corrupted with speckle. In this paper, a new approach based on non-local means (NLM) method is proposed to remove the speckle noise in the US images. Since the interpolated final Cartesian image produced from uncompressed ultrasound data contaminated with fully developed speckle can be represented by a Gamma distribution, a Gamma model is incorporated in the proposed denoising procedure. In addition, the scale and shape parameters of the Gamma distribution are estimated using the maximum likelihood (ML) method. Bias due to speckle noise is expressed using these parameters and is removed from the NLM filtered output. The experiments on phantom images and real 2D ultrasound datasets show that the proposed method outperforms other related well-accepted methods, both in terms of objective and subjective evaluations. The results demonstrate that the proposed method has a better performance in both speckle reduction and preservation of structural features.

@&#INTRODUCTION@&#
Ultrasound (US) imaging is a prominent diagnostic imaging technique since it offers several benefits such as more economic, safe, real-time and ergonomically adaptable in practice. The clinical utility of ultrasound is useful in the visual inspection of internal organs, muscles and tissues or in quantitative analysis in order to obtain measures that can be used as biomarkers for diagnosis [1–3]. The impact of ultrasound is felt in several fields of medicine [4,5], both in invasive and non-invasive applications. Non-invasive applications include the usage of US in outpatient clinics, while invasive applications include the assessment of many coronary arterial diseases [6–8]. B-mode US images suffer from quality degradation due to speckle noise [9]. Many post-processing algorithms such as image segmentation, registration or classification of tissue parenchyma are based on raw US images and hence can get affected by the presence of the speckle noise [10] if not removed. Hence, effective speckle reduction is vital for proper clinical interpretation and quantitative measurements.A plethora of despeckling methods have been developed for improving the quality of US images that can be performed either in the transform domain or in the spatial domain [11]. Loizou et al. in [3] conducted a comparative study of different US despeckling methods for carotid artery, and provided a Matlab toolbox for US image despeckling. The details are available in [12]. The Lee's filter [13], Frost's filter [14], and Kuan's filter [15] are the most widely discussed spatial adaptive filters to attenuate the speckle noise. These classical filters consider the speckle as multiplicative noise and described them mathematically using a Gaussian distributed noise model. Lopes et al. [16] proposed improved versions of the Lee's and Frost's filters by organizing the pixels in different classes in which precise processing is defined. Squeeze box filter (SBF) designed in [17,18] removes outliers at each iteration and smooths the random distributed pixel values to some confining value through adaptively computed mean. Recently, the Rayleigh-Maximum-Likelihood (R-ML) filter in [19] was employed with the Rayleigh density model and the ML method was adapted for solving the estimation problem.Diffusion filters such as speckle reducing anisotropic diffusion filter (SRAD) [20] and its sophisticated variants such as the detail preserving anisotropic diffusion filter (DPAD) [21] and the oriented speckle reducing anisotropic diffusion filter (OSRAD) [22] eliminate the unwanted components from an image by finding solutions to a partial differential equation (PDE)[23]. However, these filters suffer from a significant loss of sharp-transition detail. The probability-driven OSRAD (POSRAD) [24] computes the statistical models of tissues and provides superior results compared to above mentioned diffusion filters.The multi-scale techniques based on Wavelets are another class of filters introduced for speckle reduction in US imaging. These filters can be mainly classified into three categories-namely thresholding methods [25,26], coefficients correlation methods [27] and Bayesian estimation methods. In [28–30], the Bayesian framework was investigated to perform wavelet thresholding adapted to the non-Gaussian statistics of the signal. Pizurica et al. [31] proposed a non-decimated wavelet-based denoising method, called GenLik, which uses a generalized likelihood ratio formulation and imposes no prior statistics for noise and data. Similar to wavelet based approaches, principle component analysis (PCA)-based method in [32] is an example of a transform domain despeckling filter used for denoising medical US images.In the past, different hybrid filters have been proposed to integrate the benefits of the above mentioned paradigms. In [33], the image is decomposed into two components by an adaptive filter and each component, after performing Donoho's soft thresholding, is merged to suppress speckle. The hybrid filter in [34] combines PDE-based approaches and a wavelet transform. More recently, a patch-based non-local recovery paradigm such as optimized Bayesian NL-means with block selection (OBNLM) [35] has been applied to reduce speckle noise.Since the speckle intensity has a signal dependent nature, filters based on the standard additive Gaussian noise model are inadequate. Therefore, specific filters are required to suppress speckle without compromising important image features. Many statistical models have been attempted in the literature; specifically, Rayleigh, K, homodyned K, Nakagami, generalized Nakagami and Rician inverse Gaussian (RiIG) distributions have been shown to achieve a perfect statistical characterisation of ultrasound signals and to address the restoration of speckled images [19]. When compressionless data with fully developed speckle is considered, it is well known that the interpolated output B-mode US images follow a Gamma distribution, which is a good approximation for the weighted sum of Rayleigh variables [36,37].In this article, an unbiased NLM speckle filter based on Gamma statistics has been presented. We used a three parameter Gamma distribution function to fit the real US image and the ML estimation was adapted to find the two key parameters that control the filter performance. The proposed filter was scientifically validated by taking into consideration both real US and synthetic standardized images.The remainder of this paper is organized as follows: Section 2 gives an overview of noise characteristics in B-mode US images. Section 3 elaborates the ML approach to estimate the bias in terms of the parameters of the Gamma distribution. The proposed NLM filtering procedure is discussed in Section 4. Section 5 reports the quantitative and qualitative results, followed by the conclusions in Section 6.In [38], Goodman described the fundamentals and statistical properties of speckle noise and mathematically modelled it as a complex random walk, represented as a sum of a huge number of complex phasors. Even though these phasors can have either constructive or destructive relationship with each other, the destructive interferences cause the speckle formation. The severity of destructive interference depends on the relative phase between two overlapping reflected echoes produced by the interaction of transmitted US waves with a number of obstacles of the tissue, scatters, present in a given volume of medium, known as resolution cell. The complex observation in a given resolution cell is determined by the in-phase and quadrature components acquired by two demodulators of the coherent system [39].On the basis of the scatter number density per cell (SND), four types of speckle can be defined: (i) fully-developed, (ii) fully-resolved, (iii) partially-developed and (iv) partially-resolved [40]. However, most commonly adapted in practice are fully-developed and fully-removed speckled. When number of scatters is high, the model is known as fully-developed and the envelope has Rayleigh distribution. This model usually holds in blood regions. For the positive envelope amplitude M and the variance of the Gaussian distributed in-phase and quadrature components of the complex echo envelopeσn2, the Rayleigh probability density function (PDF) is given as [41]:(1)pMM,σn2=Mσn2e−M22σn2In the random walk, fully-resolved speckle arises as a result of a deterministic component. Also, the Rayleigh distribution is replaced by a Rician distribution and holds in regions with high echolucent response such as myocardium. The Rician PDF is given as [42]:(2)pM(M|A,σn)=Mσn2e−(M2+A2)2σn2I0AMσn2where I0 is the zeroth order modified Bessel function of the first kind. Here, M denotes the Rician random variable and A is the noise-free envelope amplitude value.Although in practice fully-developed and fully-resolved speckle are the most common, the empirical distributions obtained from the US images deviate due to signal post-processing steps [24]. Consequently, some attempts have been made in literature to model the empirical distributions with useful probabilistic models, e.g., Nakagami, Gamma or Weibull [37].As previously stated, the acquired signal with fully-developed speckle regions follow a Rayleigh distribution. Although the interpolation to form the final Cartesian image alters the data distribution, therefore the resulting image will no longer follow a Rayleigh distribution. On the other hand, a Gamma distribution accurately fits such an image [36]. Fig. 1(c) and (d) display the distribution of two local regions of a real B-mode carotid US image (shown in Fig. 1(a) and (b) respectively). Comparison with the true Gamma distribution with parameters estimated from the selected local region shows that the data distribution can be modelled with a Gamma PDF.In this section, we first introduce our speckle model. Based on the assumption that the interpolated Cartesian image of the corrupted back-scattered signal fits Gamma distribution, a Gamma distributed synthetic image G can be produced as:(3)G=F+Ngwhere F and Ngdenote the noiseless image and fading variable, respectively.For the statistically independent random observations x=x1, x2, …, xnfrom a Gamma distribution, the PDF of the observations can be described by a three-parameter Gamma distribution as follows [43]:(4)P(x|γ,ρ,β)=x−γρ−1Γ(ρ)βρexp−x−γβ∀γ<x<∞,ρ>0,β>00otherwisewhere Γ(·) is the Gamma function, γ is the location parameter and ρ and β are the shape and scale parameters, respectively.The mean μxand variance σxof the above mentioned distribution are:(5)μx=γ+ρβand(6)σx2=ρβ2.Accordingly, Eq.(5) can be rewritten as:(7)γ=μx−ρβReplacing γ in Eq.(4) by Eq.(7) results in a two (ρ and β) parameter estimation problem and can be solved with maximum likelihood estimation method by maximizing the likelihood functionLor equivalentlylogL, with respect to ρ and β[44]. When γ<x<∞, ρ>0, β>0(8){ρML,βML}=argmaxρ,β(logL)where(9)logL=∑i=1nlogP(xi|ρ,β)=(ρ−1)∑i=1nlog(xi−μx+ρβ)−1β∑i=1n(xi−μx+ρβ)−n[logΓ(ρ)+ρlogβ]and ρMLand βMLare the estimated shape and scale parameters, respectively.These parameters have fixed values throughout all regions in the input image and hence, we can compute them from any homogeneous region (where the underlying intensity is constant) using Eq. (8). Since manual selection of such a region is time consuming and tedious task and is almost always error prone, we used an automated approach (motivated by the noise estimator in [45]) to compute these parameters. This approach assumes many piecewise homogeneous regions (local regions with constant underlying intensity) exist and the ρ and β parameters are estimated as [44]:(10)ρˆML=mode{ρML(i,j)}(11)βˆML=mode{βML(i,j)}where ρML(i,j) and βML(i,j) represent the estimated values of ρ and β for every pixels at location (i, j) using a neighbourhood of size n×n andρˆMLandβˆMLare the estimated values of ρ and β for the given image. Fig. 2shows the distribution of local estimates of ρ and β from a real B-mode carotid US image (shown in Fig. 1).The NLM algorithm compares neighbourhood around each pixel called blocks and performs a weighted average of pixels based on the similarity of neighbourhoods computed using Euclidean distance. Consider the discrete noisy imageU=u(y)|y∈ℝN, where u(y) corresponds to the noisy image value at pixel location y. Let us assume that the search window size and similarity window size be ((2t1+1)×(2t1+1)) and ((2t2+1)×(2t2+1)), respectively. The NLM estimator for the filtered value at a location r is defined as follows [46]:(12)uˆNLM(u(r))=∑∀s∈Ωw(r,s)u(s)where0≤w(r,s)≤1,∑∀s∈Ωw(r,s)=1and s represents each one of the pixel in the search window Ω. The weightw(r,s)can be expressed as:(13)w(r,s)=1Z(r)e−d(r,s)h2where the decay parameter h controls the degree of smoothing and usually computed as the standard deviation of the noise. Z(r) is the normalizing constant and can be determined as:(14)Z(r)=∑∀s∈Ωe−d(r,s)h2Also, d denotes a Gaussian weighted Euclidean distance of all the pixels in the search window. It is defined as:(15)d(r,s)=GσBr−Bst22where Gσis a normalized Gaussian weighting function with zero mean and σ standard deviation. Using Gaussian weighting function in the block comparisons permits us to give more importance to values in the center pixel of the block than the pixels located at the periphery. The blocks Brand Bsdenote a matrix of grey level values of U at pixels in the similarity windows centered on the rth pixel and sth pixel respectively.When r=s, the self similarity is very high and leads to an over-weighting effect. To overcome this situation, we calculatew(r,r)as:(16)w(r,r)=max(w(r,s)∀s≠r)The above mentioned NLM filter is particularly designed for removing noise that follows a Gaussian distribution.In this paper, we propose a new variant of NLM filter called unbiased NLM (UNLM) filter for Gamma distributed US images in which we make the bias signal independent, thereby subtracting from the NLM filtered signal. This work was motivated by the UNLM developed for Rician distributed data in [47]. We model the B-mode US image with three parameter Gamma distribution, as defined in Eq. (4). Then, we replace the third parameter γ as in Eq. (7) in order to convert the three parameter estimation problem to two parameter estimation problem. As a result, this improves the accuracy of estimation of ρ and β. As shown in Eq. (7), we can observe that the noise bias produced by the Gamma distribution is signal independent and the product ρ×β is nothing but the bias term. It directly represents the signal independent noise term. So, we modified the NLM filtered output to get the unbiased NLM output. For each pixel, the proposed NLM estimation can be defined as follows:(17)NLMspeckle(U)=maxNLM(U)−ρˆMLβˆML,0The proposed methodology can be summarized as below:1.Estimate the shapeρˆMLand scaleβˆMLparameters using Eq. (8).For every pixel in the image, apply Eq. (12) to compute the despeckled value.For every pixel in the image, calculate the unbiased value using Eq. (17).The proposed filter has mainly four input parameters in which the shape and scale parameters, ρ and β, of the Gamma distribution are computed in an automated way and the other parameters are search window size and similarity window size. Most importantly, the parameters ρ and β contribute the bias term and their estimation must be feasible. Otherwise, the estimation errors in these parameters will considerably reduce the quality of the filtered result. In practice, all the three parameter including γ can be estimated locally using the following expression:(18){ρML,βML,γML}=argmaxρ,β,γ(logL)However, even if the window size is small, there can be pixels with different underlying intensity in many local regions which violates the underlying assumption of Gamma distribution and can produce undesired result. This drawback of local ML method can be addressed to some extent using nonlocal implementation. Number of samples for ML estimation is selected in a heuristic way in non-local ML (NLML) method. With too less samples, the ML method may not converge (especially with 3 parameters) and when more samples are selected there is always a chance of including samples which are not similar. These drawbacks of local and non-local ML methods forced us to compute ρ and β using ML method explained in Section 3 and γ using unbiased non local means approach discussed here.Another two parameters which can influence the performance of the proposed method is the similarity and search window size. A large similarity window size decreases the probability of finding more similar patches and a large search window size increases the probability of finding more similar pixels. However, computation time increases with a larger search window.

@&#CONCLUSIONS@&#
