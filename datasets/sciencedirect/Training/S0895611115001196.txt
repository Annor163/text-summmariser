@&#MAIN-TITLE@&#
Non-rigid image registration with anatomical structure constraint for assessing locoregional therapy of hepatocellular carcinoma

@&#HIGHLIGHTS@&#
Propose nonrigid registration for quantitatively assessing the treated region with LT.Edit the anatomical landmarks as constrained for maintaining the internal structure.From the viewpoint of physics, the landmarks carry the energy in displacement field.The proposed method achieved the promising performance.

@&#KEYPHRASES@&#
Non-rigid registration,Cost function,Anatomical structure,Locoregional therapy,Hepatocellular carcinoma,

@&#ABSTRACT@&#
PurposeAssessing the treated region with locoregional therapy (LT) provides valuable information for predicting hepatocellular carcinoma (HCC) recurrence. The commonly used of assessment method is inefficient because it only compares two-dimensional CT images manually. In our previous work, we automatically aligned the two CT volumes to evaluate the therapeutic efficiency using registration algorithms. The non-rigid registration is applied to capture local deformation, however, it usually destroys internal structure. Taking these into consideration, this paper proposes a novel non-rigid registration approach for evaluating LT of HCC to maintain the image integrity.MethodIn our registration algorithm, a global affine transformation combined with localized cubic B-spline is used to estimate the significant non-rigid motions of two livers. The proposed method extends a classical non-rigid registration based on mutual information (MI) that uses an anatomical structure term to constrain the local deformation. The energy function can be defined based on the total one associated with the anatomical structure and deformation information. Optimal transformation is obtained by finding the equilibrium state in which the total energy is minimized, indicating that the anatomical landmarks have found their correspondences. Thus, we can use the same transformation to automatically transform the ablative region to the optimal position.ResultsRegistration accuracy is evaluated using the clinical data. Improved results are obtained with respect to all criteria in our proposed method (MI-LC) than those in the MI-based non-rigid registration. The landmark distance error (LDE) of MI-LC is decreased by an average of 3.93mm compared to the case of MI-based registration. Moreover, it could be found regardless of how many landmarks applied in our proposed method, a significant reduction in LDE values using registrations based on MI-LC compared with those based on MI is confirmed.ConclusionOur proposed approach can guarantee the continuity, the accuracy and the smoothness of structures by constraining the anatomical features. The results clearly indicate that our method can retain the local deformation of the image. In addition, it assures the anatomical structure stability.

@&#INTRODUCTION@&#
Locoregional therapy (LT) is a choice for the treatment of hepatocellular carcinoma (HCC). It targets the specific inflicted region of the liver by injecting a higher dose of drugs into the tumor without exposing the rest of the patient's body. This therapy reduces the chances of infection and shortens recovery time. However, in certain situations, tumors cannot be removed clearly with LT. Thus, it is desirable to assess the therapeutic efficiency after treatment of HCC. Currently, the assessment method widely used compares the two-dimensional (2D) CT images (axial, coronal, and sagittal) manually; however, selecting the corresponding slices is a time-consuming process. Hence, in [1], we proposed a three-dimensional (3D) imaging fusion technique that considered a few nearby slices to assess HCC of the treated region before and after LT. This method only performed two factors of transformation: rotation and translation, while other factors should also be taken into account. However, the accuracy in determining the location of the ablative region is significantly limited due to manual adjustment.To resolve these problems, in our previous research [2], we applied an automatic registration method for this application. However, as Archip described in [3] and Lee described in [4], registering soft tissues with rigid registration may result in errors as high as 19–20mm, due to deformations that may be caused by liver movements such as respiration, variations of position and corporal mass changes over time. To improve detection and characterization in terms of volume and relation with HCC, an accurate non-rigid image registration algorithm is required. Currently, rich literatures on non-rigid registration method have been published [5–14]. It can be summarized as: intensity-based [14–16] (such as B-spline, demons), landmark-based [17,18] (such as thin-plate, ICP) registration method. Meyer et al. [19] proposed a notable registration algorithm based on a thin-plate spline deformation. Due to prohibitive computational complexity of the thin-plate spline warps, the registration was restricted to a very limited number of degrees of freedom. Hence, landmark-based nonrigid registration is not sufficient for most applications, especially the liver registration. Because the number of landmarks for liver which located in the discernible anatomical points is very few that affect the accuracy of registration. In addition, it is a complex task to find the corresponding landmarks. Some studies have presented that intensity-based non-rigid registration methods would be more robust and easier to implement than landmark-based. Intensity-based non-rigid registration, however, poses a number of challenges. It will breaks the internal structure of the organ volume during the intensity-based registration process, and hence results in the loss of anatomical information.As already explained above, the intensity-based rigid registration is performed to capture the global alignment between images without considering local deformation. The intensity-based non-rigid registration techniques can capture local deformation, which results in a change in the anatomical structure of the volume. However, it is essential that medical images maintain their anatomical structure stability and integrality. Hence, the objective of our work is to provide a new option for non-rigid registration to guarantee the anatomical structure of shape. In this study, we add a landmark penalty term into mutual information (MI) as a new energy function (MI-LC) to constrain the local deformation. If we treated the landmark as an elastic material, from the viewpoint of physics, when the landmarks are not in the optimal positions, the resulting distortion will produce a displacement field. The landmarks in the displacement field carry potential energy. When they move and interact, the total energy associated with them is change. According to the principle of minimum total potential energy, optimal transformation is obtained by reaching the equilibrium state in which the total energy is minimized. Experimental demonstrate our proposed method successfully overcame the disadvantage of intensity-based non-rigid registration.The rest of this paper is organized as follows: An overview of our registration implementation integrated with the illustration of landmark positions is presented in Section 2. Extensive evaluation of our method is illuminated in Section 3. Section 4 is devoted to the discussion of performance and Section 5 concludes the paper.To evaluate LT of HCC, we need to register the ablative region onto the tumor using registration method. The objective of image registration is to find the optimal transformation parameters μ, which maps every point in the postoperative liver (after LT) which is called the moving image M onto its corresponding point in the preoperative liver (before LT) which is called the fixed image R, so that the similarity function, which measures the difference between M and R can be minimized. Then, it can automatically transform the ablative region to the optimal position using the same transformation parameters.The input images are given as two 3D discrete signals: the moving image M and the fixed image R with intensities fm(x) and fr(x), respectively, where x∈I⊂ZN, and I is a 3D discrete interval representing the set of all voxel coordinates in the image. The transformed moving image W can be obtained by using the optimal transformation parameters μ, that can be defined asfw(x)=fm(x;μ).Nevertheless the majority of the image registration methods can be viewed as a combination of the four distinctive components: transformation, interpolation, the similarity metric based on cost function, optimization. As shown in Fig. 1, among the four components, the similarity metric based on cost function is the most important significant critical for the registration algorithm, as it defines the goal of optimization and measures how well the transformed moving image W matches the fixed image R. In the following, the non-rigid registration algorithm is described in detail.As explained above, we estimate the parameter of transformation by optimizing a cost function (similarity metric) in the processing of registration. In general, the solution to the registration problem can be computed by optimizing the following cost function [14,20,21]:(1)E(μ)=Esim(R,W)=Esim(fr,fm·T(μ))=Esim(fr(x),fm(x;μ))According to the intensity-based registration process, the aim is to minimize/maximize the similarity Esimbetween the two images. There are several image metrics that are used in voxel similarity-based image registration [5–9]: correlation coefficient, sum of squared differences (SSD), or mutual information (MI). SSD is one of the simplest voxel similarity based cost functions which should be minimized during registration. SSD is based on the strict assumption that the two images only differ from the Gaussian noise, but this is not true for medical images, especially for multi-modal images. Therefore, this method can be only used for mono-modal registration. However, MI [10,11] is the most widely used for medical image similarity measures that no limit to the image content about the modalities (mono-modal and multi-modal). MI can measure the statistical dependence or information redundancy between the image intensities of corresponding voxels in both images, which is assumed to be maximal if the images are registered.However, the biggest serious drawback of MI is the absence of spatial information [12,14,22,23], due to it's definition being based on Shannon's Entropy, which assumes each pixels is independent of its neighbors. Hence, intensity relationships in one region can occasionally cause errors to occur in another region where the intensity relationships are vary considerable. In [13], Loeckx et al. described that MI-based non-rigid registration might reduce smaller image details or have problems with spatially-varying intensity inhomogeneity due to a bias field.The classical non-rigid registration based on intensity exhibits an inherent weakness in that it destroys internal structures of the volume. Hence, in this study, we proposed a novel non-rigid registration algorithm using an anatomical structure term to constrain the deformation, which promised to outperform the classical intensity-based non-rigid registration method in terms of maintaining the anatomical structural stability.Based on intensity similarity metric, a different approach is used to constrain the anatomical structure to be stable by adding a landmark penalty term. On the basis of minimizing the cost function, the proposed similarity metric MI-LC is defined as:(2)E(μ)=Esim(R,W)+λLC(Lr,Lw)=Esim(fr,fm·T(μ))+λLC(Lr,Lm·T(μ))=Esim(fr(x),fm(x;μ))+λLC(Lr,Lm;μ)where Lrand Lmare the fixed landmarks and moving landmarks, respectively.Lw=Lm;μis the corresponding transformed moving landmarks. The first term is the driving force behind the intensity-based registration process, we can evaluate the similarity by computing SSD or MI metric. Due to SSD having limitations, it can be only used for the mono-modal registration. Hence, for future applications, we apply MI into our method for the multi-modal images. For the second term, LC is a landmark penalty term with the weight λ used to constrain the anatomical structure. The definition of mutual information would be explained in Appendix A.Considering that a landmark penalty term is introduced in the cost function for guaranteeing the anatomical structure stability. To be reliable, the landmarks are taken as being clearly discernible geometrical features of the medical image. In this study, we have had the following four sets of landmarks between before LT and after LT manually defined by the medical experts. These landmarks are shown in Fig. 2.Combining the anatomical structure constraint term into the mutual information (MI), the cost function is as follows:(3)E(μ)=−IMI(R,W)+λLC(Lr,Lw)=−IMI(fr(x),fm(x;μ))+λLC(Lr,Lm;μ)where IMI is the mutual information value between two livers before LT and after LT given in Eq. A.1.We introduce an additional information based on the anatomical structure constraint term that can be written into:(4)LC(Lr,Lw)=1nL∑i=1nL(Lr)i−(Lw)i2=1nL∑i=1nL(Lr)i−(Lm;μ)i2Our proposed similarity metric (MI-LC) is defined using the above concepts as:(5)E(μ)=−IMI(fr(x),fm(x;μ))+1nL∑i=1nL(Lr)i−(Lm;μ)i2Notice that with our proposed method we are not neglecting the spatial information of the image, as a landmark penalty term is introduced into the 3D intensity distributions and optimized together. The similarity calculation is based on which kind of interpolation method is used, so the B-spline interpolation is adopt in this paper.In general, depending on the global deformation alone is not sufficient for image registration. Therefore, a method that can capture the local deformation was needed. To achieve better accuracy, the transformation in our algorithm comprised of a global and a local transformation. Our work aimed to attain a local warp that is not affected the stability of the structure. The global transformation describe the global or large motions on the two volumes, such as rotation, translation and scaling; while the local transformation describe the local or detailed motions, such as deformation of the tissues. The parameters of global transformation are first determined by registration and the results are the initial values to estimate the parameters of local transformation. By such a combination, the deformation is estimated after the large differences on the volumes are eliminated. This not only ensures the estimated deformation is more reasonable, but also makes the registration to end earlier:(6)T(x)=TGlobal(x)+TLocal(x)where x=[x, y, z]Tis the coordinate of a 3D point.The simplest transformation of the global deformation method is the affine transformation [24]. For the 3D case, it can be definite by:(7)TGlobal(x)=Ax+t=a1a2a3a4a5a6a7a8a9xyz+txtytzwhere A is the linear transformation matrix. t is the translation vector [tx, ty, tz]Talong each axis. Hence, the global transformation is parameterized by 12 degrees of freedom.B-spline functions [24,25] have been widely used to represent deformations, because of their compact support, computational simplicity, good approximation properties, and implicit smoothness. Hence, in our registration process, the cubic B-spline function based free form deformation (FFD) model is chose to describe the localized characteristics or detailed motions.The FFD model [22] is parameterized by the coefficients of a set of sparse, uniformly-spaced control points. We denote Φ as the lattice which is an integer grid of control points with uniform spacing ρ=(ρx, ρy, ρz). Given the coefficients of the control point are denoted as κi,j,k, the deformation of each point can be calculated from these coefficients by cubic B-spline interpolation, according to Eq. 8.Let TLocal(x;κ) be a B-spline transformation function. It is represented as:(8)TLocal(x;κ)=x+∑l=03∑m=03∑n=03Bn(u)Bm(v)Bl(w)κi+n,j+m,k+lwhere i=⌊x/ρx⌋−1, j=⌊y/ρy⌋−1, k=⌊z/ρz⌋−1, and u=x/ρx−⌊x/ρx⌋,v=y/ρy−⌊y/ρy⌋,w=z/ρz−⌊z/ρz⌋.Bl, Bm, Bnare the basis function of the cubic B-spline kernel and the definition are given by:(9)B0(u)=(−u3+3u2−3u+1)6B1(u)=(3u3−6u2+4)6B2(u)=(−3u3+3u2+3u+1)6B3(u)=u36κ can be regarded as the parameters of the local transformation and the degrees of non-rigid deformation which can be modeled depends essentially on the resolution of the mesh of control points. A small spacing of control points allowed modeling of highly local non-rigid deformations. In our application, the spacing on each axis is equal to 16-voxel-width, so the number of the control points approximate 4096 and the number of the parameters is about 12288. According to Eqs. 8 and 9, the set of parameters for the transformation is μ={A, t, κ}. Using this parameters of transformation, the transformed moving imagefw(x)=fm(T(x;μ))can be computed.In our application, in order to minimize the cost function E(μ), the L-BFGS-B optimization method [26] are applied to find the optimal transformation parameters. The parameters of global and local transformation are optimized separately. Initially, rigid registration is used, the parameters of affine transformation are adjusted by L-BFGS-B optimization method. When this process is finished, the parameters of global transformation are set to be fixed. Then, the L-BFGS-B optimization method is applied to find the optimal parameters of local transformation in nonrigid registration process.

@&#CONCLUSIONS@&#
