@&#MAIN-TITLE@&#
Assessment of a Markov logic model of crop rotations for early crop mapping

@&#HIGHLIGHTS@&#
A prediction model for crop rotations is proposed.The model uses machine learning techniques applied to historic data.It allows the introduction of expert knowledge without re-learning from data.The model is assessed on real data over several years and a large area.

@&#KEYPHRASES@&#
Early crop type mapping,Crop rotations,Markov Logic Networks,

@&#ABSTRACT@&#
Detailed and timely information on crop area, production and yield is important for the assessment of environmental impacts of agriculture, for the monitoring of the land use and management practices, and for food security early warning systems. A machine learning approach is proposed to model crop rotations which can predict with good accuracy, at the beginning of the agricultural season, the crops most likely to be present in a given field using the crop sequence of the previous 3–5years. The approach is able to learn from data and to integrate expert knowledge represented as first-order logic rules. Its accuracy is assessed using the French Land Parcel Information System implemented in the frame of the EU’s Common Agricultural Policy. This assessment is done using different settings in terms of temporal depth and spatial generalization coverage. The obtained results show that the proposed approach is able to predict the crop type of each field, before the beginning of the crop season, with an accuracy as high as 60%, which is better than the results obtained with current approaches based on remote sensing imagery.

@&#INTRODUCTION@&#
Detailed and timely information on crop area, production and yield is important for the assessment of environmental impacts of agriculture (Tilman, 1999), for the monitoring of the land use and management practices, and for food security early warning systems (Gebbers and Adamchuk, 2010). Yield production can be forecasted using models which need information about the surface covered by each type of crop (Resop et al., 2012).There are different ways of gathering this information, such as statistical surveys or automatic mapping using Earth observation remote sensing imagery. Statistical surveys are expensive to implement, since they need field work, which is time consuming when large areas need to be covered. The use of remote sensing imagery has been found to produce good quality maps when using high resolution satellite image time series (Inglada and Garrigues, 2010). These approaches use supervised classification techniques which efficiently exploit satellite image time series acquired during the agricultural season. Describing the approach used for the supervised classification of satellite images is beyond the scope of this paper and the details can be found in (Inglada and Garrigues, 2010; Petitjean et al., 2012) or (Petitjean et al., 2014).As an example of these approaches, Fig. 1presents a 5-class crop map obtained using a time series of 13 images acquired by the Formosat-2 satellite during 2009 over a study site near Toulouse in Southern France. The data set is described in Osman et al. (2012). The supervised classification is performed using a Support Vector Machine as described in Inglada and Garrigues (2010). The resulting classification has an accuracy close to 90%. However, this accuracy can only be achieved at the end of the agricultural season when all images are available. This delay in crop map production has led the remote sensing community to develop near-real-time approaches, where the maps are updated during the season every time a new image is available. Fig. 2shows the evolution of the accuracy of each map produced during the season. A point in the curve represents the accuracy obtained using all the images available up to a given date. In this particular example, one can observe that a quality close to the maximum can be obtained before 200days into the year. However, no information is available before the first image is acquired at the end of January. For many crop systems, the beginning of the season coincides with the end of Autumn or the beginning of Winter. In this period, satellite images are very likely to be cloudy and therefore of little use for crop mapping. Furthermore, the accuracy of the land cover classification obtained with only one image is below 40%, which is not enough for most applications.The goal of this paper is to introduce an approach which is able to produce land cover maps for agricultural areas at the beginning of the crop season without relying on remote sensing imagery. We propose to use the knowledge about the crop type which was present in every field the previous seasons to predict the crop grown the current year. The proposed approach uses a statistical model for crop rotations.Crop rotations – specific sequences of crops in successive years – improve or maintain crop yield while reducing input demands for fertilizers and pesticides, and therefore they are widely used by farmers. This regularity on the agricultural practices allows predicting with some accuracy the type of crop present in a given field at one point in time if the previous crop sequence is known.Many crop rotation models exist, ranging from purely agronomic (crop-soil simulation models (Wechsung et al., 2000)), to approaches integrating expert knowledge and field data (Dogliotti et al., 2003). The complexity of these models makes them difficult to adapt to variable situations and evolving conditions. Crop rotations may evolve in time, either slowly due to for instance climate change impact in rain-fed crops, or very quickly due to environmental regulations dealing with the use of pesticides or water management. Economic factors, as for instance seed prices, can also introduce drastic changes. Hence, crop rotation models which can be easily updated and which can exploit the history of the different territories are needed.Yearly cropland mapping can be obtained either using farmers administrative declarations or maps produced using remote sensing data at the end of the season (like the one of Fig. 1). Therefore, the history of the fields can be known.We propose a machine learning approach to model crop rotations which can predict, at the beginning of a season, with good accuracy, the crops the most likely to be present in a given field, using the crop sequence of the previous 3–5years.We assess its accuracy using the French Land Parcel Information System RPG in different settings in terms of temporal depth and spatial generalization coverage.The paper is organized as follows. In Section 2, we review several approaches for crop rotation modeling in the literature. Section 3 presents the proposed approach. In Section 4, we present the type of data on which our approach relies and we define the experimental setup used for this work; then, we present the details of the assessment and analyze the results. The paper ends with a conclusion and some perspectives.The predictive model presented in this work (Section 3) aims at providing a first guess of crop type maps before the beginning of the crop season. Our model uses knowledge about crop rotations.Crop rotations have been intensively studied by both agronomists and economists leading to farm management models in the economics and life sciences models in agronomy. Some of them are presented in Section 2.1.1. They often require inputs of sequences of crops grown on a specific field over several years. In recent years, there has been an increased focus on sustainable farming systems. This has led to an increase in the use of farm models used to assess the environmental impact of farming. In models of complete exploitations including crop production, it is important to consider the rotation of crops, since this has a major impact on the consequences of the crop production.However, for the forecasting of crop type mapping, there are specific needs which are not covered by existing modeling approaches. These specific needs are:1.Field level information: the crop type has to be predicted for every individual field; aggregate data or regional trends are not enough.Different landscapes and different climatic conditions lead to different management practices. Therefore, regional information has to be combined with field-level history.The approach should be portable to different countries and regions of the globe with minimum adaptations. Therefore, it should be able to both, learn from data and to exploit expert knowledge. The approach should also be able to use only one of these 2 types of information in case the other one is not available.To cover very large areas, the approach must not rely exclusively on field surveys which are expensive in terms of time and manpower.The model should be able to evolve in time to take into account changing conditions which influence managing practices (climate change, regulatory constraints).To the best of our knowledge, no existing approach in the literature allows fulfilling all these requirements.Crop rotation modeling has been addressed in different ways. We may classify these approaches in 2 groups:1.The approaches using mainly theoretical knowledge, that is models from life sciences, economics or using expert knowledge by agronomists.The approaches which learn from data.One simple example of theoretical knowledge is the ROTAT software tool (Dogliotti et al., 2003) which generates all possible rotations of the crops present in a particular area, and then applies a selection based on agronomic criteria provided by experts. This approach allows producing accurate results at the exploitation level, but not at the field level.The creation of transition matrices adapted to the agricultural landscape under study requires expert knowledge on the type of crop rotation to model and an understanding of the internal dynamics of crop successions. Such knowledge may be derived from research on decision-making by farmers about crop succession (Castellazzi et al., 2008). Castellazzi et al. use Markov chains with transition probabilities set by experts, but their values are limited to 0 and 1.The specialization of the models to particular sites needs adequate tools. For example Detlefsen and Jensen (2007) propose the use of network modeling to find an optimal crop rotation for a given selection of crops on a given piece of land. This model can give advice about the appropriate crop to be grown on a field, but it needs information about the farm (surface, number of fields) and about the costs of farming operations (ploughing, etc.). This kind of information may not be available when mapping very large areas.Farm management models often produce average crop shares over a number of years, whereas models from the natural sciences often require inputs of sequences of crops grown on a specific field over several years.For instance, the SWIM model used by Wechsung et al. (2000) cannot be applied efficiently over large areas at the individual field level, since it needs very detailed information about specific parameters of the crops. The works of Klöcking et al. (2003) or Salmon-Monviola et al. (2012) fall in the category of models which perform stochastic simulations for scenarios, but not for accurate mapping at the field level.In interdisciplinary modeling, this difference can be an obstacle. To bridge this gap, an approach is presented in (Aurbacher and Dabbert, 2011) that allows disaggregating results from farm management models to the level required by many natural science models. This spatial disaggregation consists in deriving a spatial distribution of some information which is only available as a summary for a large area. Aurbacher and Dabbert (2011) use Markov chains for the disaggregation at the field level. This approach needs detailed knowledge about the activity at the field and farm levels, as well as other economical information as for instance gross margin. This level of detail is difficult to obtain for large areas and therefore the approach is not suited to mapping.The integration of many types of knowledge is challenging, and one of the approaches for overcoming this difficulty is to use multi-agent systems, as for instance in the Maelia platform (Taillandier et al., 2011). This approach suffers from the same drawbacks as the previous ones: the need to access detailed knowledge at the farm level.The main drawback of models based on theoretical knowledge is their inability to easily adapt to changing conditions, since these new conditions have to be accounted for in the models, or adaptive decision rules have to be implemented. However, some attempts have been made to take into account changes. For instance, Supit et al. (2012) model climate change impacts on potential and rain-fed crop yields on the European continent using the outputs of three General Circulation Models in combination with a weather generator. However, this model is only able to evolve with respect to climate and not with respect to other types of changes.One way to overcome the problem of adaptation to changing environments or to specific areas, is to integrate field surveys or similar data in the models.There are models which are used to describe existing data, as for instance CarrotAge (Le Ber et al., 2006), which allows analyzing spatio-temporal data to study the cropping patterns of a territory. The results of CarrotAge are interpreted by agronomists and used in research works linking agricultural land use and water management. The underlying algorithms use Markov models. The main limitation of CarrotAge for our needs is that it does not perform crop prediction at the field level.Another example is the crop rotation model CropRota (Schönhart et al., 2011), which integrates agronomic criteria and observed land use data to generate typical crop rotations for farms and regions. CropRota does not work at the field level.Similar to the previous one, ROTOR (Bachinger and Zander, 2007) is a tool for generating and evaluating crop rotations for organic farming systems. It was developed using data from field experiments, farm trials and surveys and expert knowledge. Its originality is the integration of a soil-crop simulation model. As the two previous approaches, ROTOR does not perform predictions at the field level.As our goal is to map the croplands, we need not only to model the transitions of crops, but also to take into account the geospatial information available.Usually, the data available for integration in models comes from census and has no continuous spatial distribution. Many approaches for the spatialization of this kind of information exist, as for instance krigging (Flatman and Yfantis, 1984). In the case of crop distribution, You et al. (2006) proposed an approach to go from census data to raster information, but their work is not applied to the field level, which is needed in our case for crop mapping.Although limited to 3 crops, Xiao et al. (2014) used field level information to perform a regional scale analysis, but they did not perform forecasting of the selected crops in the individual fields.Among the cited approaches, none of them fulfill the 5 constrains listed at the beginning of this section. However, some of these works have shown that statistical modeling of crop rotations in general, and Markovian models in particular are appropriate tools for crop type prediction. The drawback of the Markovian approaches used in the literature is that they are not easily updated when expert knowledge complementary to existing data is available.We start (Section 3.1) by justifying the use of Markovian approaches for crop rotation modeling and we point out their main limitation for our needs: the impossibility of easily integrating expert knowledge. We then present in Section 3.2 the Markov Logic approach which solves this issue. Finally, in Section 3.3 we describe how to use Markov Logic Networks to model crop rotations and to forecast future crops.At the beginning of Section 2, the specific needs for the forecasting of crops at the field level were listed. After the literature review on crop rotation models, the properties that a model for our application should possess can now be precised.1.Learning from past sequences, both at the field and at the regional scale. This allows taking into account regional trends together with specific field information.Exploiting the past information for every particular field (either using Land Parcel Information Systems or existing land-cover maps).Incorporating changes in practices without needing the compilation of new data bases containing examples of these evolutions. This allows the model to quickly evolve without the need of a time lag before being able to exploit information about changing conditions.As we saw in Section 2, existing approaches to assess agricultural practices focus on the assessment of single crops or statistical data because spatially explicit information on practically applied crop rotations was lacking (Lorenz et al., 2013), but this is not the case anymore in the EU. For instance Leteinturier et al. (2006) used the land parcel management system implemented in the frame of EU’s Common Agricultural Policy to assess many common rotation types from an agro-environmental perspective. Also, in the USA, the USDA’s Cropland Data Layer provides annual crop cover data at 30m. resolution (Boryan et al., 2011).When learning from data representing sequential states of variables, the Markovian properties are often used. In a Markovian process, the next state depends only on the current state and not on the sequence of events that preceded it. This allows to efficiently learn the probability of any particular sequence of states by computing only the probability of transition between individual states. As a matter of fact, most of the approaches similar to those presented in Section 2.1.2 use these approaches.One of the most frequently used Markovian models are Bayesian Networks (BN) (Friedman and Koller, 2003; Heckerman et al., 1995) which are today one of the most promising approaches to Data Mining and Knowledge Discovery in databases. A BN is a graph (structure of the network) where each node is a random variable (for instance the crop grown on a particular field on a given year) and each edge represents the degree of dependence between the random variables (the probability of transition between states). Fig. 3illustrates some examples of BN.A Markov Random Field, MRF, (or Markovian Network, MN) is similar to a BN in its representation of dependencies (Kindermann et al., 1980); the differences being that BN are directed and acyclic, whereas MN are undirected and may be cyclic. Thus, a MN can represent certain dependencies that a BN cannot (such as cyclic dependencies); on the other hand, it cannot represent certain dependencies that a BN can (such as induced dependencies).BN and MRF need probability estimates which can be learnt from data. However, they cannot easily incorporate other types of knowledge as for instance logic rules. For instance, in the case of crop rotations, a new regulation about nitrates can change the patterns of the sequences. Changes in prices or a reorientation towards bio-fuel production can lead to yet bigger changes. These expected changes can be expressed with rules, but no data is available for learning until several agricultural seasons have passed. Furthermore, in some cases, the knowledge is easier to express in terms of a set of sentences or formulas in first-order logic (if-then rules), rather than in terms of transition probabilities between states. Therefore, an alternative or an extension to BN and MRF is needed.To combine knowledge from databases and knowledge from experts, inference approaches which are able to combine probabilistic learning and rule-based logic reasoning are needed. Combining probability and first-order logic in a single representation has long been a goal of Artificial Intelligence. Probabilistic graphical models like BN make it possible to efficiently handle uncertainty. First-order logic allows to compactly represent a wide variety of knowledge. The combination of probabilistic and propositional models has been one research area of important activity since the mid 1990s (Cussens, 2001; Puech and Muggleton, 2003).Recently, Markov Logic (ML) (Richardson and Domingos, 2006) was introduced as a simple approach to combining first-order logic and probabilistic graphical models in a single representation. A Markov Logic Network (MLN) is a first-order knowledge base (KB) with a weight attached to each formula.1Logic formulas are also called rules or clauses.1Together with a set of constants representing objects in the domain, it specifies a ground MN2A ground MN is a MN without free variables in the logic formulas. It is also usually referred as a possible world.2containing one feature for each possible grounding of a first-order formula in the KB, with the corresponding weight. Inference in MLNs is performed by Monte Carlo Markov Chains (MCMC) over the minimal subset of the ground network required for answering the query. Weights are efficiently learned from relational databases by iteratively optimizing a pseudo-likelihood measure. Optionally, additional clauses are learned using inductive logic programming techniques. Also, clauses can be added if some prior or expert knowledge is available.A first-order logic KB can be seen as a set of hard constraints on the set of possible worlds: if a world does not respect one single formula, it has zero probability. In MLN, these constraints are softened: if a world does not verify one formula in the KB it has a lower probability, but not zero. The more formulas a world respects, the more probable it is. Each formula has an associated weight that reflects how strong a constraint is: the higher the weight, the greater the difference in probability between a world that satisfies the formula and one that does not. The weights are not limited in range as probability values are.Models like MRF and BN can still be represented compactly by MLNs, by defining formulas for the corresponding factors.Efficient algorithms for learning the structure of the networks and the weights associated to the rules exist (Singla and Domingos, 2005) and they are made available by the authors as a free and open source software implementation (Kok et al., 2006) which makes possible the assessment of the approach for our needs.We propose to model each rotation of interest as one rule and use a MLN for the inference. Therefore, the rules do not need to be learned, but only their weights. Using data for a set of years, the weights of each rule are learned. The approach is validated by applying the inference.The crops of interest for our experiments are wheat, barley, corn, rapeseed and sunflower, which represent 78% of the surface in the study area. The rules are expressed as follows in the case of a 4year rotation cycle:{Cn-3a,Cn-2b,Cn-1c}→Cnd,ωwhich means that the rule which says that a sequence of crop a, followed by crop b, followed by crop c leads to crop d the following year has a weightω. The notation can be simplified as{a,b,c,d,ω}The weightsωhave to be learned for each possible sequence of crops that has to be modeled. This type of rules corresponds to the same kind of dependency which can be modeled by a common effect BN (Fig. 3d).

@&#CONCLUSIONS@&#
In this paper we presented a model which allows predicting the crop grown on a field when the crops grown the previous 3–5years are known. This kind of prediction is useful for the production of crop maps at the field level at the beginning of the agricultural season.Our model applies machine learning techniques using a Land Parcel Information System, or any other kind of land cover maps from previous years, to model crop rotation patterns. With respect to other models existing in the literature, our approach allows combining automatic learning from data with expert knowledge and make predictions at the field level. We have demonstrated with an illustrative example that this property allows introducing constraints that cannot appear in historical data, like for instance new regulations which may change agricultural practices.We assessed the behavior of the model in terms of scale (area covered) and crop rotation length. We concluded that, in terms of statistical accuracy, the results are good and can be used as a first guess for early crop mapping. The obtained results showed that the proposed approach is able to predict the crop type of each field, before the beginning of the crop season, with an accuracy which can go up to 60%, which is better than the results obtained with current approaches based on remote sensing imagery.One application of this model would be to use it to complement other techniques for crop mapping as for instance remote sensing image classification. Remote sensing image time series can achieve good results if enough images are available, usually towards the end of the season. The prediction of the most probable crop could allow achieving good results earlier in the season.The results presented here open perspectives in terms of exploitation of the approach, as for instance including other information as digital elevation models, climatic data or soil type maps.