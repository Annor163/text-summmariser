@&#MAIN-TITLE@&#
Clustering financial time series: New insights from an extended hidden Markov model

@&#HIGHLIGHTS@&#
A model-based clustering technique is used in mining financial time series data.The model allows unobserved heterogeneity between and within time series.In the analysis of stock markets, the best model has two groups and three regimes.The model performs well in capturing different regime dynamics of stock markets.

@&#KEYPHRASES@&#
Data mining,Hidden Markov model,Stock indexes,Latent class model,Regime-switching model,

@&#ABSTRACT@&#
In recent years, large amounts of financial data have become available for analysis. We propose exploring returns from 21 European stock markets by model-based clustering of regime switching models. These econometric models identify clusters of time series with similar dynamic patterns and moreover allow relaxing assumptions of existing approaches, such as the assumption of conditional Gaussian returns. The proposed model handles simultaneously the heterogeneity across stock markets and over time, i.e., time-constant and time-varying discrete latent variables capture unobserved heterogeneity between and within stock markets, respectively. The results show a clear distinction between two groups of stock markets, each one characterized by different regime switching dynamics that correspond to different expected return-risk patterns. We identify three regimes: the so-called bull and bear regimes, as well as a stable regime with returns close to 0, which turns out to be the most frequently occurring regime. This is consistent with stylized facts in financial econometrics.

@&#INTRODUCTION@&#
In recent years dealing with unobserved heterogeneity has become a predominant topic in many research areas. As Heckman emphasized in his Nobel lecture, one of the most important discoveries in microeconometrics is the pervasiveness of heterogeneity and diversity in economic life: “When a full analysis of heterogeneity in response was made, a variety of candidate averages emerged to describe the average person, and the long-standing edifice of the representative consumer was shown to lack empirical support. (Heckman, 2001, p. 674)”. In finance research, heterogeneity has been mostly assumed observed (e.g., based on countries), where groups and their boundaries are delineated without regarding the intrinsic information on the observed data. However, there are plenty of examples in the academic and professional finance literature that show that heterogeneity exists among capital market participants, business managers, fund managers, among others.The correct modeling of the dynamics of stock market returns has been an important challenge in modern financial research. Though the dominant approach followed by both academics and practitioners has been to assume that returns follow a normal distribution (see, e.g., Lundblad, 2007 and Fu, 2009), it has also been recognized that stock market returns and returns of financial assets contain skewness and excessive kurtosis. A common conclusion is that the normal distribution is inadequate for short period returns of financial assets (Fama, 1965; Mandelbrot, 1963; Praetz, 1972). Several alternative distributions have therefore been suggested for modeling returns, one of which is the Laplace distribution. These alternatives have in common that they try to accommodate for the excessive kurtosis in the empirical distribution of the returns. Whereas excess kurtosis of financial return distributions has been well addressed in the financial literature, the asymmetry of the distribution has not received much attention, and the few studies available tend to be inconclusive (Peiró, 1999; Simkowitz and Beedles, 1980; Singleton and Wingender, 1986).Latent class or finite mixture modeling has proven to be a powerful tool for analyzing a wide range of social and behavioral science data (see, for example, Clogg, 1995 and Vermunt, 2003). The identification of distinct dynamics in time series data has been an important topic of research from a substantive point of view. We propose a latent class model for financial data analysis that takes into account unobserved heterogeneity by means of time-constant and time-varying discrete latent variables. A feature of latent class modeling is that it yields a model-based clustering of observational units that is especially attractive to the typical analysis in finance research, where it is of interest to identify subpopulations of firms, investors, markets or countries that differ in their propensities to specific characteristics (regulation, company governance characteristics, etc.). The challenging task of clustering this type of observations is that one has to incorporate data dependency in the clustering process (Kakizawa, Shumway, and Taniguchi, 1998). Therefore, clustering of time series has attracted large attention in statistics and data mining literature. However, most of the proposals developed have been based on classic clustering algorithms in such a way that time series data can be handled. Interested readers may refer to Liao (2005) and Esling and Agon (2012) who provide a detailed discussion of time series clustering in the data mining literature. Contrary to alternative heuristic clustering techniques for financial time series analysis which operate directly on the correlations (e.g., Mantegna, 1999; Basalto et al., 2007) or other measures of similarity between time series being clustered (e.g., Bastos and Caiado, 2013), the approach proposed here is a model-based clustering technique that accommodates for serial dependencies and unobserved heterogeneity by assuming a regime-switching model (RSM), also known as hidden Markov model, underlying each cluster. There is a vast body of literature on RSMs in economics and empirical finance, including Hamilton (1989), Hamilton and Susmel (1994), and Gray (1996) to name just a few. Hidden Markov models and regime-switching models as discrete state models can also be connected to stochastic volatility models (see, e.g., Langrock, MacDonald, and Zucchini, 2012; Rossi and Gallo, 2006). The autoregressive conditional root (ACR) model (Bec, Rahbek, and Shephard, 2008) is another econometric model that connects to regime-switching models. Many extensions of the regime-switching models have been suggested, adding new possibilities and modeling additional stylized facts of financial time series. For instance, Lux and Morales-Arias (2010) proposes a model that takes long memory and heavy tails of return time series into account, whereas Guidolin and Timmermann (2007), Fu, Wei, and Yang (2014), and Bae, Kim, and Mulvey (2014) apply RSMs to asset allocation and portfolio optimization. RSMs have been applied to pension funds optimization (Hainaut, 2014) and weather derivatives (Elias, Wahab, and Fang, 2014). For recent surveys on the application of RSMs in empirical finance, we refer to Lange and Rahbek (2009) and Guidolin (2011). These models have broader fields of application, covering manpower systems, where both observable and latent sources of dynamic heterogeneity should be accounted for (Guerry, 2011), and reliability analysis (Zhou, Hu, Xu, Chen, and Zhou, 2010).Here, RSMs are extended to take the clustering structure of the returns of 21 European stock market indexes into account. Stock markets are well-known for presenting cycles, however country idiosyncrasies are also likely to make them differ in their transition between boom and bust. As is illustrated below, the proposed approach is flexible in the sense that it can deal with the specific features of financial time series data, such as asymmetry, kurtosis, and unobserved heterogeneity, an aspect that tends to be neglected. Because we selected a rather large and heterogeneous sample of countries including both developed and emerging countries and both EMU (European Monetary Union) and non-EMU countries, we expect that heterogeneity in market returns due to country idiosyncrasies will show up in the results. For instance, emerging market return distributions tend to show larger deviations from normality, i.e., they are more skewed and have fatter tails (Harvey, 1995). In addition, stock markets are also known to contain asymmetry of volatility, i.e., volatility is higher in negative shocks than positive ones (see, e.g., Ang and Bekaert, 2002) and structural breaks in time, or in other words, regime switching.The results show that stock markets are better described by three regimes: A high returns, a negative returns, and close to zero regimes that we interpret as a bull, a bear, and a stable regime. This, however, challenges the simplistic view that stock markets should be characterized by two regimes. The characterization of regimes is consistent with several stylized facts such as asymmetry in volatility, i.e., bear regimes are associated with larger volatility than bull regimes. Stock markets are clustered into two groups that are mainly distinguished by the propensity to switch to the bear regime, which includes countries that were more affected by crisis during the period of analysis as well as Eastern European emerging countries that were less integrated with the other European countries.The paper is structured as follows. Section 2 describes the 21 country financial time series data set that is used throughout this paper. Section 3 presents the statistical framework for the analysis of heterogeneous financial time series. It also discusses parameter estimation by maximum likelihood and model selection issues. Section 4 reports the results obtained for the data set at hand. The paper concludes with a summary of the main findings and a description of possible implications.The data used in this article are daily closing prices from 27 January 1998 to 31 July 2013 for 21 European stock market indexes drawn from Datastream database.11Observations from different time zones can create problems of non-synchronization on the analysis, to eliminate such problems we focus on European markets.The series are denominated in US dollars. In total, we have 4010 end-of-the-day observations per country. Let Pitbe the observed daily closing price of market i on day t, i = 1, …, n and t = 0, …, T. The daily rates of return are defined as the percentage log-return by yit= 100 × log (Pit/Pi, t − 1), t = 1, …, T. This definition which is commonly used in the literature is justified by the fact that for expected small increases (decreases) of value, say r, log (1 + r) ≃ r.The 21 stock markets are listed in Table 1. Figs. 1and 2depict for six distinct countries the index and returns time series, respectively. As is well known, stock markets follow cycles. In the sample period there were two main periods of global stock market crises. The dot-com bubble bursting that started at the end of 1999 and went on until 2003, and the subprime crisis that had its first signs in the summer of 2007, and made stock markets plummet in September 2008 after the Lehman Brothers bankruptcy. From 2004 to 2007, stock markets registered a strong growth.Fig. 2 depicts stock market returns. Russia and Turkey have the highest level of volatility, which is typical of emerging markets. It is worth to note that in August 1998 Russia defaulted a sovereign bond payment triggering the “ruble crisis” in financial markets. Market features like these seem well-suitable to test our econometric model.Table 1 provides the relevant descriptive statistics for the 21 stock-return series. All markets show non-negative median returns. However, only 18 out of 21 had positive mean returns; that is, Greece, Italy, and Portugal showed negative mean returns. Emerging markets such as Czech Republic and Russia show larger positive mean return. These figures confirm that stock market distributions tend to be negatively skewed.The 21 analyzed markets show very diverse patterns of dispersion, where the largest standard deviations are found for Russia (3.134) and Turkey (2.983) – both emerging markets – which are almost three times larger than for Switzerland, the stock market with the smallest dispersion with a standard deviation of 1.210. Moreover, the excess kurtosis shows values above 0, indicating heavier tails and more peakness than the normal distribution (which has a kurtosis of 0). The Jarque–Bera test rejects the null hypothesis of normality for each of the 21 stock markets’ returns.Figs. 3and 4depict rolling means and standard deviations (30-day window) for these markets. Although moving averages tend to smooth trends, the main booms and peaks in the stock markets’ returns are still visible. The ruble crisis is visible in Russia and it propagates to neighbor markets such as Poland and Hungary (not shown). All stock markets show a volatility peak during the subprime crisis.The proposed model for statistical analysis of financial time series – the mixture Gaussian hidden Markov model (MGHMM) – contains three types of variables: a time-varying response variable, a time-constant discrete latent variable, and a time-varying discrete latent variable. Let yitrepresent the metric response of observation i at time point t, where i ∈ {1, …, n} and t ∈ {1, …, T}. The time-constant and time-varying discrete latent variables are denoted by wiand zit, respectively, where wi∈ {1, …, S} and zit∈ {1, …, K}. The latter implies that the number of categories of the two types of latent variables equals S and K, respectively. To make as clear as possible the distinction between the two types of latent variables, we will refer to wias a latent class and to zitas a latent state or regime. The time-constant latent classes (wi) can be seen as clusters for which the process under study differs. The time-varying latent variable which has a Markovian transition structure (zit) is used to flexibly model the distribution of the time-specific responses as well as to capture changes that occur across adjacent time points.Fig. 5provides the graph of the econometric model. The model is defined as:(1)f(yi;φ)=∑wi=1S∑zi1=1K∑zi2=1K⋯∑ziT=1Kf(wi,zi1,…,ziT,yi1,…,yiT)where f(wi, zi1, …, ziT, yi1, …, yiT) is the joint density of latent and observed variables and can be factorized into(2)f(wi)f(zi1|wi)∏t=2Tf(zit|zi,t−1,wi,yi,t−1)by(3)∏t=1Tf(yit|zit).Eq. (1) describes f(yi;φ), the (probability) density function associated with the time series of return rates for stock market index i. The right-hand side of this equation shows that we are dealing with a mixture model containing one time-constant latent variable and T time-varying latent variables. The total number of mixture components (or latent classes) equals S·KTwhich is the product of the number of categories of wiand zitfor t = 1, 2, …, T. As in any mixture model, f(yi;φ) results from the marginalization over the latent variables, which yields a weighted summation of class-specific probability densities with the (prior) class membership probabilities or mixture proportions as weights (McLachlan and Peel, 2000). The model described in Eqs. (1)–(3) is strongly related to the mixed latent Markov model proposed in the social sciences literature (van de Pol and Langeheine, 1990; Vermunt, Langeheine, and Bockenholt, 1999). Their model was, however, for categorical instead of continuous variables and for (short) panel data rather than long time series like ours.Fig. 5 and Eqs. (2) and (3) show the conditional independence assumptions implied by the MGHMM, and the resulting factorizations which simplify the model structure. More specifically, conditional on latent classes wiand yi, t − 1, zitis associated only with zi, t − 1 and zi, t + 1 and thus not with the latent states occupied at the other time points – the well-known first-order Markov assumption. Eq. (3) shows that conditionally on zit, the response at occasion t(yit) is independent of responses at other time points – usually referred to as the local independence assumption – and also independent of the latent classes and the latent states at the other time points.Two remarks should be made about the first-order Markov assumption for the latent states. First, after marginalizing over wi, the process for the sequence zitis no longer Markovian.22For example, for a given it the value zitresults from a mixture of S components with conditional multinomial distribution. As a mixture of Gaussian distributions is no longer (generally speaking) a Gaussian distribution, the same happens with mixtures of other distributions.Second, the Markov assumption for zitconditionally on wiallows a nonlinear structure for the responses yit. This shows that the first-order Markov assumption is not as restrictive as one may initially think (see Fig. 5). Additionally, within each latent class the transition probabilities between regimes depend of the previous return, and consequently the Markov process is inhomogeneous.The econometric model described in Eqs. (1)–(3) has three key relevant elements for the analysis of heterogeneous time series and takes into account: (1) time-invariant unobserved heterogeneity in the process under study, (2) serial dependency, and (3) flexible distributions that deviate in terms of skewness and kurtosis from normality (see, e.g., Dias and Wedel, 2004). Unobserved heterogeneity is captured by the time-constant latent variable wi, serial dependencies are captured by the first-order Markov transition process in which the state at time point t depends on the state at time point t − 1 and the inhomogeneous Markov process that depends on the prior observed return, and, finally, flexible distributions of the returns are possible because of the time-specific mixture distribution for the response variable.As can be seen from Eqs. (2) and (3), the model of interest is characterized by four sets of probability functions:•f(wi) is the probability of belonging to a particular latent class w and πw= P(Wi= w);f(zi1|wi) is the initial regime probability; that is, the probability of having a particular latent initial state conditional on belonging to latent class w: λkw= P(Zi1 = k|Wi= w), andλwis the vector containing initial probabilities in latent class w;f(zit|zi, t − 1, wi, yi, t − 1) is a latent transition probability; that is, the probability of being in a particular regime at time point t conditional on the latent state at time point t − 1, class membership, and observed return at time t − 1; assuming an inhomogeneous transition process, we regress the transition probability on the prior stock return using a logit-link functionpjkw=P(Zit=k|Zi,t−1=j,Wi=w,yi,t−1)=eγjkw(0)+γjkw(1)yi,t−1∑k′=1Keγjk′w(0)+γjk′w(1)yi,t−1,whereγjkw(0)andγjkw(1)are the intercept and slope coefficients of yi, t − 1 in the multinomial logit model for the transition from regime j to regime k within latent class w. As usual, identifying constraints on the gamma parameters are needed. The matrix with transition probabilities given w and yi, t − 1 is denoted by Pw(yi, t − 1);f(yit|zit) is the Gaussian density function for the observed response, which is the probability density of having a particular observed stock return in index i at time point t conditional on the regime occupied at time point t. This distribution is characterized by the vectorθk=(μk,σk2)containing the means (μk) and variances (σk2) for regime k, k = 1, …, K (and invariant across latent classes). The vectorμcontains all μk. Since the marginal distribution is a mixture of densities it defines a flexible model that takes skewness and kurtosis into account.The (SK + 1)(2K − 1) free parameters of the MGHMM (φ) include the S − 1 class sizes, the S(K − 1) initial state parameters and 2SK(K − 1) transition probability parameters, and the 2K conditional means and variances of the observed variables.Various special cases of the MGHMM defined in Eqs. (1)–(3) can be obtained by eliminating one or more of its three main elements, the serial dependency structure, the time-varying latent variables, or the time-constant latent variable. For example, if we assume that there is no serial dependency between the time-varying discrete latent variables – that p(zit|zi, t − 1, wi, yi, t − 1) ≡ p(zit|wi) – we obtain a model that is called a multilevel or hierarchical mixture model (Vermunt, 2003; 2007). This shows that the MGHMM can be seen as a hierarchical Gaussian mixture model that is expanded with a serial dependency structure.The hidden Markov or Markov switching model (Baum, Petrie, Soules, and Weiss, 1970; Hamilton, 1989) is the special case of the MGHMM that is obtained by eliminating the time-constant latent variable wifrom the model, that is, by assuming that there is no unobserved heterogeneity at the upper level of analysis. This model can be obtained without modifying the formulae, but by simply assuming that S = 1; that is, that all stock markets belong to the same group.The mixture Gaussian model can be seen as a restricted variant of the MGHMM that is obtained by removing the time-varying latent variables zit, resulting inf(yi;φ)=∑wi=1Sf(wi)∏t=1Tf(yit|wi). Note that this model is equivalent to a latent class model for T response variables which are assumed to be conditionally independent within latent classes w. For T = 1 it yields the mixture of (univariate) Gaussian distributions (Dias and Wedel, 2004).Maximum likelihood (ML) estimation of the parameters of the MGHMM involves maximizing the log-likelihood function:ℓ(φ;y)=∑i=1nlogf(yi;φ),a problem that can be solved by means of the Expectation-Maximization (EM) algorithm (Dempster, Laird, and Rubin, 1977).In the E step, we compute the expected value of the T + 1 latent variables given the observed data and the current provisional estimates of the model parameters. In the M step, standard complete data ML methods are used to update the unknown model parameters using an expanded data matrix with previous expectation as weights. Since the EM algorithm needs to compute and store the S·KTentries of expectations over the latent space for each subject or for each unique data pattern, computation time and computer storage increases exponentially with the number of time points, which makes this algorithm impractical or even impossible to apply with more than a few time points. This explains why models like the one proposed here have been used in social science applications only with very short time series (van de Pol and Langeheine, 1990; Vermunt et al., 1999) and has hampered its application for longer time series (Schmittmann, Visser, and Raijmakers, 2006).However, for hidden Markov models, a special variant of the EM algorithm has been proposed that is usually referred to as the forward–backward or Baum–Welch algorithm (Baum et al., 1970; Hamilton, 1989). This special algorithm is needed because the model for our data set contains a huge number of entries in the joint posterior latent distribution generated by the T + 1 latent variables. Recall that in our application T is quite large. This means that even for S = 2 and K = 2, the number of entries in the joint posterior distribution is too large to process and store for all n stock markets as has to be done within the standard EM algorithm. The Baum–Welch algorithm circumvents the computation of this joint posterior distribution making use of the conditional independencies implied by the model. Whereas this algorithm was originally proposed for hidden Markov models, here we expand it to deal with mixture (Gaussian) hidden Markov models. This algorithm exploits the conditional independence assumptions implied by the model in order to circumvent the computational issue which affects the traditional EM procedure when the number of time points is high. A detailed description of the extended Baum–Welch algorithm is provided in Appendix A.Contrary to previous work (e.g., Ang and Bekaert, 2002; Wilfling, 2009; Pagan and Sossounov, 2003), we do not set a priori the number of regimes as it happens, for instance, in the bear–bull market framework (K = 2). Consequently, we have to address simultaneously the estimation/selection of S and K, i.e., how to decide about the number of latent classes and regimes needed. The standard model selection approach when using maximum likelihood estimation is by performing likelihood ratio tests across nested models; here the relevant tests are between models with S − 1 and S classes and between models with K − 1 and K regimes. However, in the context of latent class models this approach is problematic because the null hypothesis under test is defined on the boundary of the parameter space, and consequently the regularity condition of Cramer on the asymptotic properties of the MLE is no longer valid. As an alternative, it has been proposed to use information criteria, mostly for cross-sectional modeling. The basic principle under these criteria is parsimony, which results from the trade-off between model fit and model complexity. A number of model selection criteria have been suggested, the most prominent and widely used being the Bayesian Information Criterion (BIC) of Schwarz (1978) and the Akaike Information Criterion (AIC) of Akaike (1974). More recently, simulation studies have explored the performance of information criteria for longitudinal data (Costa and De Angelis, 2010; Dias, 2007; Dias and Vermunt, 2007). These type of simulation studies compare criteria such as Bayesian information criterion (BIC), the Akaike information criterion (AIC), the AIC3, and the consistent AIC (CAIC) in terms of performance. The overall conclusion is that AIC tends to overfit (see, e.g., Dias and Vermunt, 2007) and BIC performs better for large T (see, e.g., Costa and De Angelis, 2010). Thus, our model selection is based on the BIC. The values of S and K to be selected are the ones that minimize the value of BIC, which is defined as(4)BICS,K=−2ℓS,K(φ^;y)+NS,Klogn,where NS, Kis the number of free parameters of the model with S latent classes and K regimes. Note that as indicated by Dias (2007), we use sample size as n in the BIC formula, and thus not nT.

@&#CONCLUSIONS@&#
