@&#MAIN-TITLE@&#
Segmentation of liver and spleen based on computational anatomy models

@&#HIGHLIGHTS@&#
Propose a novel framework for multi-organs segmentation.Incorporate an atlas concept within an organ bounding box construction.Iterative probabilistic atlas overcome a bias toward the specific patient study.Adaptive select reference bone for accurate alignment of the given data.Achieve the promising performance (p<0.00001) compared with conventional method.

@&#KEYPHRASES@&#
Multiple organs segmentation,Template matching,Organ bounding box,Iterative probabilistic atlas,Computational anatomy model,

@&#ABSTRACT@&#
Accurate segmentation of abdominal organs is a key step in developing a computer-aided diagnosis (CAD) system. Probabilistic atlas based on human anatomical structure, used as a priori information in a Bayes framework, has been widely used for organ segmentation. How to register the probabilistic atlas to the patient volume is the main challenge. Additionally, there is the disadvantage that the conventional probabilistic atlas may cause a bias toward the specific patient study because of the single reference. Taking these into consideration, a template matching framework based on an iterative probabilistic atlas for liver and spleen segmentation is presented in this paper. First, a bounding box based on human anatomical localization, which refers to the statistical geometric location of the organ, is detected for the candidate organ. Then, the probabilistic atlas is used as a template to find the organ in this bounding box by using template matching technology. We applied our method to 60 datasets including normal and pathological cases. For the liver, the Dice/Tanimoto volume overlaps were 0.930/0.870, the root-mean-squared error (RMSE) was 2.906mm. For the spleen, quantification led to 0.922 Dice/0.857 Tanimoto overlaps, 1.992mm RMSE. The algorithm is robust in segmenting normal and abnormal spleens and livers, such as the presence of tumors and large morphological changes. Comparing our method with conventional and recently developed atlas-based methods, our results show an improvement in the segmentation accuracy for multi-organs (p<0.00001).

@&#INTRODUCTION@&#
Organ segmentation refers to the process of separating the organ of interest from its surroundings for clinical medical images. Manual segmentation of organ structures by an expert is a laborious and time-consuming task. Therefore, automatic or semiautomatic organ segmentation methods have been developed to provide a reproducible, accurate and robust alternative. In order to segment the organs from their medical images, a variety of sophisticated methods of segmenting organs have been proposed [1–4]. This methodological explosion reflects the difficulty of organ segmentation for clinical applications. These methods can be summarized as classification-based [5–7], region-based [8,9], contour-based [10,11], graph cut-based [12,13] and random walks-based [14,15] segmentations. However, these segmentation methods depend solely on gradient or intensity analysis, and omit the use of anatomical information. Hence, their performance is insufficient when the image contains noise or the contrast between object and background is low.Recently, significant effort has been focused on the development of anatomical model-based methods, such as probabilistic atlas [16–24] and statistical shape model [25,26] for organ segmentation. In anatomical model based methods, the anatomical model can be used as a priori location and shape information of organs. These methods are robust against noise, but they are sensitive to initialization of their parameters, such as pose and initial contour. Our research focused on the probabilistic atlas-based segmentation method. Most of the work has involved the construction of atlases for organ segmentation [27–31]. Probabilistic atlas-based organ segmentation, however, poses a number of challenges. Accurate mapping of the probabilistic atlas onto the input CT volumes is difficult because of the variability in organ shape. To resolve this problem, we investigated utilizing an automatic registration method for this application. Park et al. [16] first proposed using probabilistic atlases to model the multiple organs, by manually extracting landmark points on each organ for registering probabilistic atlases based on thin plate spline (TPS). Using a similar principle, the priori information from probabilistic atlases was used to initialize the segmentation of abdominal organs in [17,18]. Both methods used measures of relationship and hierarchy between organs and manual landmarks. Meanwhile, in [19], Zhou et al. constructed the liver atlas for improved liver segmentation that controlled the points of diaphragm surface according to TPS. Linguraru et al. [20] suggested to segment the liver and the spleen from the CT images using the position of the xiphoid to register the probabilistic atlas based on affine transformation. Yamaguchi et al. [21] applied the region-growing method and the probabilistic atlas to segment the liver from the CT images by registering the usage of the anatomical landmarks of the liver based on TPS. Notably, the construction of these abdominal atlases required manual landmarks through user interaction. On a different note, Okada et al. [22,23] developed a hierarchical statistical atlas of the liver normalized to the abdominal cavity as part of a process of automatically segmenting the liver. Recently, Li et al. [24] also proposed an automated liver segmentation method using the rib cage to map the probabilistic atlas onto the input volume. They only considered one type of rib cage as the reference for registration.However, there are two limitations to these segmentation methods: (1) Errors in landmark extraction may cause incorrect estimation of the transformation. (2) Eventhough the transformation of landmarks can be accurately estimated, it is difficult to achieve the accurate transformation of the organ because of the large variation of anatomical structure.Taking these two points into consideration, we propose a template matching framework based on a probabilistic atlas for organ segmentation. In our proposed method, we first need to construct a bounding box around the organ based on human anatomical structure, which complies to the relatively rigid characteristics of organ position; and then the probabilistic atlas is used as a template to find the organ in this bounding box by the use of template matching.Additionally, as described in [16], the main disadvantage of the conventional probabilistic atlas is that it may cause a bias for the specific patient studies due to the single reference. Numerous investigations showed that an iterative atlas construction can reduce the dependence on the reference patient [24]. Hence, in this paper, we construct an iterative probabilistic atlas for our proposed method to address this bias issue.The rest of this paper is organized as follows: In Section 2, we describe our proposed method, which explains how to construct the organ bounding box, how to realize the Gaussian intensity model, how to build the iterative probabilistic atlas model, and how to segment the organ. Extensive evaluation of our method is presented in Section 3. Section 4 is devoted to the discussion of performance and Section 5 concludes the paper.The proposed method segments an abdominal organ based on a set of priori information. Priori information includes the approximate location of an organ, histogram of the organ׳s intensities, and a probabilistic atlas of the organ. The organ bounding box is employed to estimate the approximate location of an organ for the observed data. The histogram of the organ׳s intensity is used to build the Gaussian intensity model (likelihood map). The likelihood map together with the probabilistic atlas is employed in the template matching technique. Template matching aims to estimate an initial segmentation of the organ. In the estimation of the organ bounding box, construction of the probabilistic atlas and template matching, the affine registration method is employed. Furthermore, the Geodesic Active Contour (GAC) algorithm [10] is used to refine the initial segmentation results so that they can guarantee the smoothness of the final result. The framework of our proposed method is shown in Fig. 1.The basic idea of our proposed method is based on Bayes framework. To estimate the organ labelLwe can follow the principle of the maximum a posteriori probability (MAP) estimation. The posteriori probability can be estimated as:(1)Pi,j,k(L|A)∝Pi,j,k(A|L)Pi,j,k(L){LiverL=1SpleenL=2whereA(i,j,k)andL(i,j,k)are the intensity values and organ labels of voxel(i,j,k)in the CT volume, where(i,j,k)is the coordinate for each voxel.P(A|L)is the likelihood map for an organ,P(L)is the iterative probabilistic atlas which is used as a prior probability map. In the following sections, we describe how to segment the multiple organs in the abdominal region.The development of the bounding box-based method is a new trend for organ segmentation that allows easy extraction from CT volumes. An abundance of literature has been published on the bounding box for the estimation region of organs [32–38]. These methods can automatically detect the localization of organs within 3D CT scans, and they can be summarized as follows: regression-based [32–34], classification-based [35,36], registration-based [37,38]. The first two methods usually need to deal with large amounts of data and consequently need the longest computation times for the training process.However, the registration-based approaches are more efficient and can roughly align the organs in only a few seconds. For registration-based approaches, atlas-based methods have enjoyed much popularity for their conceptual simplicity. Our algorithm incorporates the atlas concept within a bounding box construction. Since the bone of the body is considered as a rigid part, we perform affine registration to transform the bones in our work. A scheme of the organ bounding box construction is shown in Fig. 2, which contains the bone segmentation, the bone registration and the bounding box construction for one organ.Several methods have been proposed for bone extraction [39,40]. The main approach of these methods was to estimate the intensity range of the bone and apply the region-growing technique to find the bone. Following a similar approach to these methods, our method׳s first step is to find the abdominal region using Otsu thresholding [41]. Then, we model the intensity range of bones ([Tlow,Thigh]) and a seed point was automatically selected. Finally, after the estimation of the intensity range of the bones and the seed point, the region-growing algorithm [8] is employed to segment bone and the morphological operators were used to refine the results. The flowchart of our bone extraction method is shown in Fig. 3.In order to reduce the computation demands of our algorithm, we firstly extract the abdominal region as a ROI using Otsu thresholding technique. The high threshold value (Thigh) of the bone׳s intensity is defined as the largest intensity value in the abdominal region, as shown in Fig. 4.We use one slice image to find the low threshold (Tlow) for bone segmentation. Though the selection of the slice is not very critical, we select the third slice for this task because the first several slices usually do not include the kidney, which has an overlapped intensity range with the bone. In the abdominal region, there are several tissues which make estimation of the bone intensity range difficult. However, regions that include less tissues cause estimation of bone intensities more accurate. Thus, the estimation of the bone intensity range will be more accurate. One example of the third slice image is shown in Fig. 6(a). Subsequently, an iterative search approach is applied to find the bone׳s low threshold, as shown in the left-hand side of Fig. 3. First, we assume an intensity distribution of the selected slice as a Gaussian model (Fig. 4). Then we can estimate the parameters of the corresponding Gaussian distribution (G(μ,σ)). In order to segment the bone in CT data, we need to calculate a threshold valueTlowby using the parameters of the assumed Gaussian distribution. With the initial threshold valueTlow=μ(the mean value μ), we iteratively increaseTlowwith a fixed value (0.2⁎σ) until a ratio of the segmented bone volume to whole volume is less than a predefined value (∑). Fig. 5shows the bone segmentation results with different thresholds (percentages). Lowering the threshold value for the bone segmentation results in the loss of bone regions; conversely, with the higher threshold value for the bone, it may include multiple organs. According to our experimental results (the mean Dice measure), we set the predefined value∑=2%as the optimum threshold value to prevent the inclusion of the intestine, colon and blood vessel in the segmentation results in our work. By this dynamic threshold method, the low thresholdTlowfor the bone is obtained.Next, a seed point is automatically selected after the input image is thresholded ([Tlow,Thigh]). The whole procedure of the seed point estimation is shown in Fig. 6. It consists of the following: (1) Definition of the central zone (Fig. 6(c)) in the extracted abdominal region. We define the central zone, whose area is 25% of the abdominal region, as a ROI. (2) Generating the thresholded image (Fig. 6(d)) by thresholding the third slice of CT volume with[Tlow,Thigh]. (3) Obtaining the largest segmented object in the central zone. (4) Defining the central point of this largest object as a seed point (Fig. 6(e)). If the central point (the estimated seed point) is located within empty space, the nearest point to the central point of this largest object is defined as the seed point (Fig. 6(f)).After estimating a seed point and the bone׳s intensity range[Tlow,Thigh], we apply a seed region-growing algorithm [8] to segment the bone.Registration is an important step in the whole process due to its primary influence on the overall accuracy of the bounding box. Since bones are considered as the rigid frameworks in the human body, the affine transform is used for the registration in our work. Empirically, the selected reference data have to approximately resemble the whole set of input images. However, due to variations in the abdominal region, which is scanned during the imaging procedure, the bone shape/size shows variation. Hence, only using one type of bone is not sufficient for registration. Taking this into consideration, we utilize four different reference bones for the registration. We select one training data which includes shoulder to leg region. Then we extract four different regions of the body to serve as four references, as shown in Fig. 7. The first reference data includes shoulder to legs. The second reference data includes from the liver region towards legs. The third reference data includes the liver region and pelvis. The fourth data includes only the liver region.The root mean squares (RMS) metric is used to adaptively select the appropriate bone reference when we want to register a new data. Initially, the extracted bone for the new data is registered to all four reference bones, separately. Then, we calculate the RMS value between the new data and each reference as a measurement of the accuracy of the registration result. The four RMS values are compared and the extracted bone is registered to the reference bone corresponding to the lowest RMS value. Wherein, the RMS measurement is calculated based on the binary image of the segmented bone.Considering the variations in anatomical structure, the positions of organs will differ for all the data. Hence, to build a bounding box for an organ, we use the various organ data as training data. Firstly, we extract the bone from one data. Next, using the adaptive selection of the appropriate reference bone, the extracted bone is registered to the corresponding reference by using an affine transform. Then, the same transformation is used to transform the segmented organ mask of this data. Finally, after registration of all the training data, we find the volume of interest (VOI) of the ensemble of the organs and use it as the organ bounding box. Fig. 8illustrates an example of the spleen bounding box based on six samples.For the test data, according to the adaptive selection of bone reference, once the reference bone is registered to the bone of the observed data, the organ bounding box is automatically transformed onto this observed data using the same transformation. Thus, the candidate organ region is extracted based on this registered organ bounding box.A Gaussian intensity model (or likelihood map) of an organ refers to an image in which the intensity of a voxel corresponds to the probability of belonging to that organ. To reduce the irrelevant neighboring tissues from the input candidate organ region and to improve the segmentation accuracy, the Gaussian model is applied for analyzing the input organ intensity distribution, and can be described as:(2)Pi,j,k(A|L)=12πσL2exp(−(A(i,j,k)−μL)22σL2)The Gaussian parameters meanμLand varianceσL2can be estimated by observing the density histogram of the organ. In our paper,L=1is the liver andL=2is the spleen. We only construct the Gaussian intensity model for the organ of interest. We do not model the background tissues since it includes several tissues which cannot be modeled by a single Gaussian distribution. A Gaussian distributionN(μ,σ)which has the same FWHM (full width half maximum) with the observed density histogram is decided [19]. In dealing with the large range of organ intensities, we follow a non-parametric scheme and use training data to build the histogram of the voxels׳ intensities. For the gray scale distribution of an organ, the 100 bin histogram was made to closely approximate the true distribution.We convert the intensity value (A(i,j,k)) of each voxel into a probability (a likelihoodPi,j,k(A|L)) for the organ (L) using Eq. (2). A typical case of the spleen is shown in Fig. 9, in which the original image is converted into a likelihood map for spleen. Comparing the original CT image (Fig. 9(a)) with the likelihood map (Fig. 9(b)) reveals that the spleen can be more easily distinguished from other tissues in the likelihood map, since the spleen region has a higher probability. Additionally, it can be found that distinguishing the spleen from several tissues with similar intensity is a little difficult if we use only intensity information (likelihood).An organ probabilistic atlas can serve as a prior probability image of the organ. The segmented organ masks in the training data are used to construct a probabilistic atlas for the candidate organ. In conventional construction of a probabilistic atlas, a single training data is arbitrarily chosen as the reference image, and the rest of the data are considered as the moving images and registered to this reference. However, as identified by Park et al. [16], the main disadvantage of the conventional atlas is that a single reference is limited in representing the whole population of potential target cases. Hence, only mapping to a single reference may cause a bias toward that specific patient study. According to surveys on this problem, this issue can be addressed by an iterative atlas construction that reduces the dependence on the reference patient [16,24].The construction process of our iterative atlas is illustrated in Fig. 10. Registration of the organ masks is the most important step in the atlas construction process, which is performed using a rigid scheme in our method. In the initial step we register the organ mask in different CT cases onto the reference volume, and then the resulting atlas from the previous iteration is used as the reference for the following construction phase (as explained in Algorithm 1). The mapping result is the atlas that shows the probability of a given voxel belonging to the organ. Hence, the atlas is a composite and reflects variations in organ shape and size. To accurately build the atlas, although we do not use any bone as the reference image, the corresponding bone still needs to be used to normalize the organ mask in the same physical coordinate since the spacing and origin of training data are not the same.Algorithm 1Iterative probabilistic atlas algorithm.Initialization:Reference_OrganMask(RO), Registered_Reference_OrganMask(Reg_RO),Training_OrganMask(TO), Registered_Training_OrganMask(Reg_TO),Reference_Bone(RB), Training_Bone(TB), Number_TrainingData(K),J=1, S=1;Iteration:whileJ≤KdoJ==1thenStep1: Extracting the bone fromTraining_Data(J)and adaptive selecting RB;Step2: Normalizing the TO(J) by using the TB(J) and RB;Step3: Registering the TO(J) onto the RO, asReg_TO(J);Step4: Obtaining theAtlas_Data=1J+1(RO+Reg_TO(J));elseRepeat Step1–Step2;Step5: Registering the RO onto theAtlas_Data, asReg_RO;whileS≤JdoStep6: Registering the TO(S) onto the RO, asReg_TO(S);S←S+1;end whileStep7: Updating theAtlas_Data=1J+1(Reg_RO+∑i=1JReg_TO(i));endifJ←J+1; S=1;endwhileIn our proposed segmentation method, the probabilistic atlas is used as a template to detect the organ in the organ bounding box by the use of template matching technology. Hence, when the iterative probabilistic atlas is constructed, we select the largest region (VOI) containing all the organ masks as our atlas templateP(L).Template matching is one of the key innovations of our algorithm. Template matching is based on the idea that those voxels which belong to the organ have similar intensities to the organ׳s histogram and their locations are the parts of the image where the organ may be found with a higher probability. The aim of this step is to build a probability image, which assigns to each voxel the probability of belonging to the organ of interest. To build such a probability image, we use two probability images: a Gaussian intensity model (a likelihood map) and a probabilistic atlas. Our algorithm incorporates a template matching concept within a Bayes framework, according to the definition of Eq. (1).P(A|L)is the likelihood map which can be obtained using the organ histogram andP(L)is estimated by using the organ probabilistic atlas. We use the constructed organ bounding box, described in previous step, to restrict the processing region in template matching. The size of likelihood map is the same as the original CT image. However, considering the probabilistic atlas can be regarded as a template in the matching process, the size of probabilistic atlas is usually smaller than the likelihood map.The search range for atlas matching is the bounding box, in which the organ is located. A sub-volume that has the same size and location with the probabilistic atlas is extracted from the likelihood map. Then a probability image is generated by voxel-wise multiplication of the sub-volume with the probabilistic atlas. For this generated probability image, the total probabilities (the summation of the probability image) are used as a similarity measure. We search from the bottom-left voxel (start point) of the bounding box to the top-right voxel (end point) of the bounding box to find the best object location(aopt,bopt,copt)that maximizes the similarity (the summation of the probability image). At this location the sub-volume of the likelihood map will reach the highest matching with the probabilistic atlas. This procedure can be formulated as:(3)(aopt,bopt,copt)=argmax(a,b,c)∈ΩB[∑i,j,kPi+a,j+b,k+c(A|L)×Pi,j,k(L)]whereΩBis the bounding box for the organ and(a,b,c)represents the location of atlas in the bounding box ((a,b,c)∈ΩB). Furthermore, the generated probability image at location(aopt,bopt,copt)is padded into the corresponding location of a empty volume that has the same size with the likelihood map. This volume serves as the output of template matching, which contains trivial non-organ structures. In order to remove trivial objects, we firstly threshold this output volume and then smoothed its surface using an opening morphology operator. The generated results for the candidate organ can be regarded as the initial segmentation results.The final step of organ segmentation is to refine the initial segmentation result by using a Geodesic active contour (GAC) algorithm [10].GAC is an active contour method which tries to solve a differential equation using an iterative method. The differential equation is the result of minimization of an energy function which moves a contour toward the true boundary of the object [10]. For the GAC segmentation algorithm, an initial contour is required. Its segmentation results are sensitive to the initial position. As explained in the previous section, after template matching, we can achieve an atlas-based segmented organ. Hence, in our work, the generated atlas-based segmented organ was used as an initial contour of the GAC algorithm to achieve a more accurate final segmentation result.

@&#CONCLUSIONS@&#
