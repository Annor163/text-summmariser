@&#MAIN-TITLE@&#
Refinement of lung nodule candidates based on local geometric shape analysis and Laplacian of Gaussian kernels

@&#HIGHLIGHTS@&#
A new 3D, CAD for lung nodule candidates was introduced and compared with other works.Multiscale dot enhancement filter and Laplacian of Gaussian kernels were combined.Relatively a large number of FPs was reduced before using feature based classification.The performance of the proposed method was evaluated with 42 independent images from LIDC.The scheme detects nodules with wide variations in size, shape, intensity and location.

@&#KEYPHRASES@&#
Computer-aided detection,Lung segmentation,Nodule detection,Laplacian of Gaussian kernels,Shape index,

@&#ABSTRACT@&#
This work is focused on application of a new technique in the first steps of computer-aided detection (CAD) of lung nodules. The scheme includes segmenting the lung volume and detecting most of the nodules with a low number of false positive (FP) objects. The juxtapleural nodules were properly included and the airways excluded in the lung segmentation. Among the suspicious regions obtained from the multiscale dot enhancement filter, those containing the center of nodule candidates, were determined. These center points were achieved from a 3D blob detector based on Laplacian of Gaussian kernels. Then the volumetric shape index (SI) that encodes the 3D local shape information was calculated for voxels in the determined regions. The performance of the scheme was evaluated by using 42 CT images from the Lung Image Database Consortium (LIDC). The results show that the average number of FPs reaches to 38.8 per scan with the sensitivity of 95.9% in the initial detections. The scheme is adaptable to detect nodules with wide variations in size, shape, intensity and location. Comparison of results with previously reported ones indicates that the proposed scheme can be satisfactory applied for initial detection of lung nodules in the chest CT images.

@&#INTRODUCTION@&#
Advances in CT imaging technology have improved the radiographic presentation of anatomical lung structure and also increased the sensitivity in detecting pulmonary diseases at the early stages. However, the large amounts of generated image data require the radiologists to pay high attention and effort for evaluating and interpreting the CT images. Accordingly, extensive researches have been devoted, during the last two decades, on the development of computer-aided detection (CAD) schemes for the aim of detecting lung diseases, especially lung cancer [1].Recently, a number of various CAD methods have been introduced to assist radiologists in extracting nodule candidates from CT images. The segmentation of lung volume is the main preprocessing step in these methods that restricts the post-processes, prevents false positives (FPs) outside the lung field and reduces the computational time. In literature, most of the existing techniques for lung segmentation are classified into two major categories: low and high level groups [2]. In the first group, little information of the lung CT image is required. Thresholding [3–7] and region growing [8–11] are two typical methods in this group. After using them, 3D approaches are applied to extract the lung volume. Of course, it is necessary to specify the lung boundary after segmentation. In order to do segmentation without the loss of lung nodules and to ensure the smooth lung boundary, several methods such as curvature-based lung smoothing [12], morphological operators [13] and rolling ball algorithm [4,6] have been proposed. The second group incorporates a high level of knowledge such as an earlier information, expert-defined rules and models of a desired object. For instance, the active contour model (ACM), named as “snake model”, is inspired by deformable boundary model in which a snake evolves to fit the shape of a desired object under specific internal and external guiding forces [14,15]. For accurately obtaining lung contours in snake model, an appropriate initialization is required. It should also be mentioned that in many of the model-based approaches, 3D lung segmentation is particularly challenging, because of the large amount of data to be processed and examined [16].Many other researches from different disciplines have turned their attention to segmentation of lung in CTs. Among them are Fuzzy C-mean (FCM) [17], probabilistic FCM [18], atlas based segmentation [19] and graph cuts [20]. Also, a hybrid lung segmentation method has been presented in a recent publication [21].After segmenting the lung volume, initial detection of nodules will be the next step. Although detecting isolated nodules (not connected to other pulmonary structures) is a simple task, this becomes difficult if nodules attach to the pleural and/or vessels. Accordingly, the vessels and airway walls attached to the lung nodule may give rise the amounts of FPs.Various methods have been proposed in the literature for detecting nodule candidates. Multiple gray-level thresholding [7,22], intensity thresholding with morphological processing [6], template-matching [3], morphological approaches with convexity models [23] and recently, mass-spring model [11] and 3D-iris filter [13] are a number of proposed approaches. Moreover, filtering-based methods that enhance the shape of spherical objects [4,24–26], and shape-based methods [5,27–29] which characterize suspicious regions in the lung volume, are other techniques, frequently used by many research groups.Accordingly, although many approaches have been introduced in detecting different kinds of nodules (e.g. non-isolated or irregular shaped nodules with complicate anatomical situations), still a large number of FPs are accompanied with initial detections. Many of the CAD systems incorporate a feature-based classifier to eliminate the FPs from nodule candidates. Reducing relatively large number of FPs before classification can significantly improve the performance of a CAD. This comes from the fact that the enormous variety in types and characteristics of the suspicious nodule objects makes it hard to produce a single suitable classifier, to find the best set of features in order to discrete the true and false nodules effectively and to overcome the possible overfitting.On the other hand, there is always a large imbalance distribution between nodules (positive or minority class) and non-nodules (negative or majority class) in the nodule candidates. The performance of conventional classifiers is highly affected by the imbalanced data distribution. Typically, classifiers attempt to reduce global errors without taking into account the data distribution. As a result, a large number of instances are misclassified since the conventional classifiers show a strong bias towards the majority class. It is notable that the sensitivity of traditional classifiers depends on the degree of imbalance distribution [30]. Over-sampling the minority class and under-sampling the majority class have been common methods to re-balance the class distribution [30]. These two techniques must be carefully used because oversampling a minority class may lead to overtraining to a specific pattern of the samples belonging to the minority class, and under-sampling a majority class may lose some valuable patterns of majority class samples. Many of the errors revealed in the classification stage are originated from lack of proper attention to these issues.The present work is focused on the first steps of CAD systems and aims to develop a new method in order to accurately specify the lung search space and distinguish suspicious regions, leading to significant reduction of FPs. A novel nodule detection algorithm is introduced to find nodule candidates by seeking the suspicious regions, in the enhanced image, that contain center points of possible nodules and calculating 3D local shape feature. The proposed algorithm provides two main benefits before classification stage; first, simplifying the imbalance data classification problem, and second, reducing the high computation cost due to significant reduction of nodule candidates.Details of the proposed method for lung segmentation and nodule candidates detection, based on filtering methods and 3D shape analysis, are given in this study. The used dataset and the parameters adjustment are described. Results of the detection scheme are subsequently discussed and compared with other previously published works.The block diagram of the proposed method for detecting pulmonary nodule candidates is shown inFig. 1. At the first step, an isotropic interpolation is performed for each CT image. Then lung volume is segmented based on minimum error thresholding and 3D connected component analysis. At the next step, suspicions regions, i.e. regions of interest (ROIs) are extracted using multiscale dot enhancement filtering as well as 3D blob detector with Laplacian of Gaussian (LoG) kernels. Then volumetric shape index is obtained for each of the voxels in the ROIs. In this way, many of the normal tissues are removed and nodule candidates are precisely determined. Following are explanations about the steps of the proposed algorithm.Generally, the spatial resolution within each slice in CT examinations is different from the spatial resolution along the axial direction (slice thickness). Thus, to provide equal size voxels in each of the three dimensions, linear interpolation, because of its computational simplicity, is used along the axial direction for each of the CT images [31]. This step of processing is essential, since the detection scheme relies on the 3D analysis of CT images.The lung segmentation is performed to separate the voxels corresponding to lung tissue from other regions, such as muscles, fat, bone, mediastinum, and background (the air around the body). Lung segmentation is a challenging problem due to heterogeneity in the lung region. Nevertheless, accurate segmentation of the lung is an inevitable matter with direct consequences for subsequent processing steps. The mask obtained from lung segmentation is used to ensure that nodule detection is performed within the lung volume only.The lung segmentation procedure, used here, is similar to those previously reported [29,32]; however, was improved here. The main advantages for this part of the work, in comparison with previous attempts, are selecting a suitable threshold value for binarization, incorporating effectively the pleural nodules and excluding bronchi. The general scheme is described in the following sections.In many of the earlier works, a single pre-determined threshold value has been used to separate the lung from the surrounding anatomy [4,6]. There are also some works that have employed optimal thresholding [3,13,24] or Otsu’s method [32] for this task. Otsu’s thresholding method is based on the idea of finding a threshold value that minimizes the within-class variance of resulting foreground and background classes. The method is robust, and it gives reasonable thresholding results in a vast variety of cases. However, this method has been shown to break down for a certain range of object-to-background pixel population ratios [33]. With respect to this point, in the present work, the minimum error thresholding algorithm [33] is used to automatically select a threshold for each image volume based on the unique characteristics of each data set.The gray-level distribution of the voxels of a representative 3D chest CT image is presented inFig. 2. According to this figure, two major regions with different density distribution exist: (i) the low-density region, including the background air, lung parenchymal and airways (trachea and bronchial tree), and (ii) the high-density region containing the thoracic cavity, muscles, fat, bones, vascular tree and lung nodules.Using minimum error thresholding technique, the separation of the two regions is done automatically. The principal idea behind the method is to optimize a function of the average voxel classification error rate. The automated threshold selection(τ) is formulated by minimizing the criterion function,J(T)as:(1)J(τ)=minTJ(T)Assuming modeling of the histogram by two Gaussian distributions (bimodal model), this function is given by [33,34]:(2)J(T)=1+2[P1(T)×logσ1(T)+P2(T)×logσ2(T)]−2[P1(T)×logP1(T)+P2(T)×logP2(T)]where(3)Pi(T)=∑g=abh(g)(4)σi2(T)=1Pi(T)[∑g=ab{g−μi(T)}2×h(g)]in which:(5)μi(T)=1Pi(T)[∑g=abh(g)×g]and:(6)a={0T+1i=1i=2(7)b={Tni=1i=2In the above equations,Texpresses different gray-level threshold values,h(g), the frequency of occurrence of gray-level value (g),gϵ[0,n],Pi(i=1,2) the priori probabilities andμiandσithe corresponding mean values and standard deviations for the two distributions, respectively. It is noteworthy that the criterion function (Eq. (2)) is more appropriate for thresholding images with highly unequal population sizes, whereas the methods of Otsu and optimal thresholding tend to split the larger class into two halves [33].In order to find the best threshold value for separation and reducing the criterion function, the above mentioned iterative algorithm was used here. The algorithm is stated in following steps:First step: choosing an arbitrary initial threshold,T;Second step: computingμi(T),σi(T),Pi(T)fori=1,2;Third step: computing the updated threshold by solving the following equation:(8)g2×[1σ12(T)−1σ22(T)]−2g×[μ1(T)σ12(T)−μ2(T)σ22(T)]+μ12(T)σ12(T)−μ12(T)σ22(T)+2[logσ1(T)−logσ2(T)]−2[logP1(T)−logP2(T)]=0Fourth step: terminating the computing, if the new threshold equals the old one; else, going to the second step.The estimated threshold value, corresponding to the minimum of the criterion function, is actually relevant to the minimum overlap area between the two Gaussian distributions. The threshold value for separating the voxels of a typical CT image is shown in Fig. 2. According to the work done by Glasbey [35], the iterated version of Kittler’s minimum error algorithm is found to be the best in comparison with eleven other histogram-based global thresholding algorithms. The Kittler algorithm is one of the simplest to compute and appears to fail rarely in finding the best threshold.After applying thresholding, in this step, the lung region should be extracted from other low-density regions, air around lung and background voxels. The 3D connected component labeling, by considering 26-connected neighborhoods for each voxel, was used to identify the lung voxels. The lung regions were then specified from these labeled volumes based on their volume size. The two largest components in the volume should be retained, with the additional constraint that the second-largest volume should be larger than half of the first one; otherwise, it will be put aside.The noise formation caused by scanning systems or other sources are inevitable in the experiments. Further, applying thresholding in the first phase may intensify noise [36]. Therefore, the smoothing low-pass filter was used to smooth the images and reduce noise. Then, a morphological hole filling operator was applied slice-by-slice to fill the holes that are normally nodules or vessels. Similar procedures have been proposed in Refs. [29,32].At the previous step, many of the pulmonary vessels and pleural nodules contacting the lung boundary were excluded, since their densities were higher than that of the lung parenchyma. There are several methods to solve this problem as mentioned in introduction section. However, these methods have some limitations. Accordingly, finding a properly sized rolling ball that works well for all juxtapleural nodules is a difficult task [37]. In the method introduced in Ref. [12], as another case, a large processing time is required to specify the whole lung boundary, and it often fails to complete this duty. Moreover, 3D smoothness cannot be proper, because indentations in the lung boundary may appear differently across axial slices [38]. In practice, the shapes of juxtapleural nodules vary greatly from round and oval to cone, triangular and flat; therefore, 3D smoothness may fail for juxtapleural nodules with tubular or cone-like shapes.To include every juxtapleural nodule in the segmented lung volume and to obtain a smooth lung mask, contour correction method, based on chain code analysis [5,7], was used here, which consists of the following steps:I.A chain code was employed for each of the 2D slices of the segmented lung object contour.To remove noise from the initial lung contour, a Gaussian smoothing filter was applied to the chain codes.The gradient of the filtered chain codes was calculated and critical points, as endpoints of concave regions, were detected by thresholding the obtained gradient.The distance between each pair of critical points was calculated. The pairs with distance value within the range of nodules diameter were joined and their concave regions were filled. Others were put aside.Since densities of airways are close to those of the lung tissue, the obtained results from the lung extraction step still contain the airways. The airway tree in the human chest is like a binary tree structure, in which, the trachea is divided into two main bronchi; each enters into the left or right lung. The trachea is the only significant air component in the beginning of a thoracic CT scan. Thus, based on the anatomical knowledge, the trachea and main bronchi were identified in the gray-level image using a 3D region growing method, nearly similar to the method proposed by Yim and Hong [38]. In this regard, to initialize, the seed point for growing was automatically determined by searching for a round and connected region near the center of the first few axial slices in each data set that had an intensity value lower than the threshold value obtained in the first step. The solid red regions inFig. 3 show the results of segmentation in different slices of a CT image that were identified at this step. Finally, the segmented trachea and main bronchi were removed from the regions extracted in the previous step and the ensured lung region was obtained.The initial detection and discrimination of nodule candidates from other surrounding structures with similar densities, is an important and difficult duty in CAD schemes. The recognition process requires considering precise information of intensity, shape, and connections between the pulmonary structures.In the present method, suspicious regions were first detected and segmented using multiscale dot enhancement filter, established on eigenvalue analysis of the Hessian matrix in 3D image space as well as a 3D blob detector with LoG kernels which finds points that can be considered as the possible centers of lung nodules. Applying these two techniques aimed to minimize the nodules search and data analysis space while maintaining high detection sensitivity levels. Then the volumetric shape index was calculated for every voxels within the extracted regions and nodule candidates were specified.In order to give rise the sensitivity for initial nodules detection, the multiscale dot enhancement filter [39], was applied for simultaneous enhancement of spherical structures such as dot-like nodules and disappearance of normal anatomic structures, included in the lung regions such as line-like blood vessels and planar-like airway walls.As was mentioned, dot enhancement filter is based on the eigenvalue analysis of the Hessian matrix in each location. The calculation of the Hessian matrix of the intensity function is highly sensitive to noise, since involves second-order partial derivatives. Moreover, different size spherical objects (nodules), within the range[d0,d1], have to be considered for enhancement. Therefore, Gaussian image smoothing with different scales was performed prior to calculating the second-order partial derivatives. TheNdiscrete smoothing scales (σi,i=1,…,N) in the range of[d0/4,d1/4]can be calculated as:(9)σ1=d0/4,σ2=rσ1,σ3=r2σ1,…,σN=rN−1σ1=d1/4wherer=(d1/d0)1/(N−1), and each scale corresponds to the nodule diameter of4σi. So, the image resolution should be taken into account in the calculation of the Gaussian smoothing with different scales. Since the voxels in each of the CT images are not usually isotropic, as it was mentioned in Section 2.1, the interpolation technique was employed to make the size of each voxel equal in the three dimensions.For each of the smoothing scales,σi, the dot value which determines the local geometrical characteristics in each voxel was calculated based on combining the magnitude and the likelihood components as [39]:(10)zσidot(λ1,λ2,λ3)={|λ3|2|λ1|ifλ1<0,λ2<0andλ3<00otherwisewhereλ1,λ2andλ3(|λ1|≥|λ2|≥|λ3|)are three eigenvalues of the Hessian matrix calculated from second order partial derivatives of the smoothed image.It should also be pointed that the magnitude of the convolution with the second derivative of a Gaussian function is inversely proportional to the square of its scale. In order to make the filter response comparable for different smoothing scales, the output of the enhancement filter for each scaleσiwas multiplied byσi2. For each voxel, the final output of the multiscale enhancement filter was the maximum dot value, which was calculated using Eq. (10) among the N different scales (given by Eq. (9)) as:(11)zmax=max(σi2zσidot),i=1,…,NThe obtained dot-enhanced image was thresholded with a fixed, empirically selected value for the separation of suspicious regions from other structures inside the lung. A 3D connected-component labeling method was then used and many of the small objects that are mainly due to noise were eliminated. The remaining objects were considered to be the regions containing nodule candidates.The multiscale selective dot enhancement filter has been used widely and analyzed with many methods in several publications [4,24–26]. The main problem of using this filter is the high amount of FP detections, especially in the vicinity of vessel branches and junctions [26]. It is since, as was mentioned in Section 2.3.1, the calculation of the Hessian matrix is highly sensitive to noise. Consequently, smoothing of data at multiscales is required. Due to noise and smoothing, junctions are characterized by a high ratio of eigenvalues and so tend to be enhanced by applying nodule enhancement filter [40].In this stage, the 3D blob detector was used for better estimation of the location of nodule centers and to reduce the FPs (non-nodule regions). Lung nodules are usually appeared in CT images as blob-like patterns brighter than the surrounding pulmonary background. Blob structures, can be specified as candidate markers for lung nodules, in a multiscale setting with the aid of LoG kernels. Actually, blob structures correspond to local minimum points of LoG filtered image.In a 3D space, the input image,f(x,y,z), is convolved with series of scale-normalized LoG kernelsσ2∇2Gσ(x,y,z)of different sizes in the form [41]:(12)Lσ(x,y,z)=f(x,y,z)⊗LoGσ(x,y,z)=f(x,y,z)⊗σ2∇2Gσ(x,y,z)whereGσ(x,y,z)is a 3D Gaussian kernel with varianceσ2, which was calculated for different scales. The scale parameter,σ, varies within the range ofσmin,…,σmaxasσ1,σ2…,σK. It should be mentioned that the scale-normalized kernels provide the comparison of LoG responses with differentσvalues.Since the nodule structures are brighter than the surrounding pulmonary background in CT images, for each scale, the local minima ofLσ(x,y,z)with respect to(x,y,z)coordinates were detected. These local minima,mσ(x,y,z), were then traced by morphological dilation and multiplication; i.e.,mσ1(x,y,z)was initially dilated by a spherical structuring element:(13)e(x,y,z)={(x,y,z)|x2+y2+z2≤9}and then multiplied, element-wise, bymσ2(x,y,z):(14)m′1(x,y,z)=(mσ1(x,y,z)⊕e(x,y,z))×mσ2(x,y,z)Similarly, next steps were done as:(15)m′k(x,y,z)=(m′k−1(x,y,z)⊕e(x,y,z))×mσk+1(x,y,z)k=2,…,K−1Finally, the coordinates of the stable local minima,m′K−1(x,y,z), were considered as the locations of the blob structures. These points were then searched in the segmented regions obtained in Section 2.3.1, and the regions which did not contain any of these points were removed.Considering the sphere-like shape of pulmonary nodules and the shapes of other soft tissues such as cylinder-like vessels, the volumetric shape index is capable of distinguishing different shapes, while it does not depend on the position or orientation of the object and is less sensitive to the image intensity. Volumetric shape index is a 3D local geometric feature, which was derived from the principal curvatures. For each voxelp(x,y,z), within the lung volume, the shape index (SI) value was calculated as [3,5]:(16)SI(p)=12−1πarctank1(p)+k2(p)k1(p)−k2(p)In this work, different scales (same as those mentioned in Section 2.3.1) were used, and in each scale the principal curvatures,k1(p)andk2(p), at voxelp, were calculated based on the second order derivatives of the image smoothed with a Gaussian filter. In fact, the largest and smallest eigenvalues of the Hessian matrix provide thek1(p)andk2(p)values, respectively. For each voxel, the maximum obtained value according to Eq. (16), among the N different scales, given by Eq. (9), was the precise value assigned to the shape index.With respect to the fact that the average of shape index values for a nodule is higher than that of the blood vessel; in this stage, the regions having the average shape index bigger than 0.83 and also containing at least one voxel with a shape index bigger than 0.92 were retained. These two limits were experimentally found by working on five datasets and were initially estimated close to the previously reported values [5,29]. Other detected suspicious regions were removed from the list of nodule candidates.

@&#CONCLUSIONS@&#
In this work a new method was developed to analyze chest CT images, in order to detect pulmonary nodule candidates.Since pulmonary nodules have their own spherical structures that are distinct from other pulmonary objects, the 3D analysis of the images gives rise to the nodule detection accurately. In this research, using multiscale dot enhancement filtering, spherical objects were enhanced and simultaneously normal anatomic structures such as blood vessels and airway walls were mostly suppressed. Also, the center of the nodule candidates was obtained by applying LoG kernels. As a result, the combination of these two algorithms led to the significant improvement of the performance of the initial nodule detection. Furthermore, calculating volumetric shape index was suitable to describe nodule candidates, based on the principal curvatures concept. This index has the special advantage that does not depend on the position of the object and it is less sensitive to the image intensity.The proposed algorithm was evaluated using 42 CT images from the LIDC database. Taking into account the presence of very small nodules and also nodules with very low contrast intensity, the results indicate the effectiveness of the method for detection of suspicious regions. The algorithms used in this work can also be adopted as the first detection stage for other CAD schemes. Compared to other reported works, the present method was shown to significantly reduce the number of FPs after initial candidates’ detection, while maintaining a high sensitivity.None declared.