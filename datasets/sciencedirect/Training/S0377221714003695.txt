@&#MAIN-TITLE@&#
Bidding in sequential electricity markets: The Nordic case

@&#HIGHLIGHTS@&#
We consider sequential electricity markets.We develop a stochastic programming model for coordinated bidding.Our case study shows that there is significant gain from coordination.Coordination may become increasingly important with growth in renewables.

@&#KEYPHRASES@&#
OR in energy,Stochastic programming,Scenario generation,Electricity markets,Bidding,

@&#ABSTRACT@&#
For electricity market participants trading in sequential markets with differences in price levels and risk exposure, it is relevant to analyze the potential of coordinated bidding. We consider a Nordic power producer who engages in the day-ahead spot market and the hour-ahead balancing market. In both markets, clearing prices and dispatched volumes are unknown at the time of bidding. However, in the balancing market, the market participant faces an additional risk of not being dispatched. Taking into account the sequential clearing of these markets and the gradual realization of market prices, we formulate the bidding problem as a multi-stage stochastic program. We investigate whether higher risk exposure may cause hesitation to bid into the balancing market. Furthermore, we quantify the gain from coordinated bidding, and by deriving bounds on this gain, assess the performance of alternative bidding strategies used in practice.

@&#INTRODUCTION@&#
With 73% of the total physical power exchange in the Nordic region being traded at Nord Pool in 2011 (Nord Pool, 2011), this is Europe’s largest and most liquid market place for electricity. More specifically, Nord Pool operates the day-ahead spot market Elspot for the physical exchange of production and consumption. This market covers Norway, Sweden, Denmark, Finland and Estonia, and had 350 members and an impressive turnover of 294.4terawatthour in 2011.1In comparison, the intra-day adjustment market Elbas, which is likewise operated by Nord Pool, had 100 members and a turnover of only 2.7terawatthour.1Although the spot market facilitates day-ahead balancing of expected production and consumption, real-time imbalances may still occur. It is the responsibility of the local electricity system operator, e.g. in Norway, Statnett, in Sweden, Svenska Kraftnät, and in Denmark, Energinet.dk, to ensure the physical balancing of supply and demand by activation of so-called balancing or regulating power. There exists a common Nordic market for regulating power, referred to as the balancing market. Regulating power can therefore be activated anywhere in the Nordic region, although each transmission system operator clears the market locally. The balancing market has few members, e.g. in Denmark only 6. Despite a significant total supply of regulating power, total demand is much larger, which may be explained by a hesitation to enter this market.2It should be taken into account that part of the Danish demand for regulating power is usually covered by import from Norway and Sweden.2Furthermore, the need for supply of balancing services is expected to increase with the increasing growth in fluctuating renewable production, as pointed out by e.g. (Holttinen, 2008; Holttinen et al., 2009).The above electricity market design applies not only in the Nordic region, but analogies to day-ahead spot and near real-time balancing markets are found in e.g. the Netherlands and Portugal/Spain, although with different bidding rules and market setups.For electricity market participants able to engage in sequential markets such as the Nordic spot and balancing markets, it is relevant to analyze the potential of coordinated bidding. Nevertheless, a hesitation to enter the balancing market can sometimes be observed in practice. This motivates the following research questions: Can the hesitation be explained by differences in price levels and risk exposure between the two markets? Is it profitable to hold back capacity in the spot market to facilitate subsequent offering of up regulation, or to put forward capacity in the spot market such as to offer down regulation? If so, what is the gain from doing so?To answer these questions, we consider a power producer who trades in a day-ahead spot market and an hour-ahead balancing market. In both markets, clearing prices and dispatched volumes are unknown at the time of bidding. However, in the balancing market, the market participant faces an additional risk of not being dispatched. Taking into account the sequential clearing of these markets and the gradual realization of market prices, we formulate the bidding problem as a multi-stage stochastic program.Our contribution is threefold:•We develop a multi-stage stochastic programming model for coordinated bidding into two sequential markets, taking into account market price uncertainty and existing market rules. This model can be used for market exchange irrespective of the production or consumption technology.When generating market price scenarios, we put efforts into preserving autocorrelations and cross-correlations. Since separate scenario sampling and reduction may alter correlations, we alternate between the two methods in a stage-wise fashion.To assess the performance of alternative bidding strategies used in practice, we derive bounds on the gain from coordinated bidding. These bounds can be computed without actually solving the multi-stage stochastic coordination problem.The paper is organized as follows. Section 2 first provides an overview of electricity market bidding in the literature. We proceed to introduce the Nordic electricity markets, including the spot and balancing markets in Section 3, and formulate a multi-stage stochastic programming model for coordinated bidding into these markets in Section 4. Section 5 is concerned with the generation of market price scenarios that serve as input to the stochastic programming model. We derive bounds on the gain from coordinated bidding in Section 6, and numerically quantify this gain in Section 7. Section 8 concludes our analysis.The problem of optimal electricity market bidding is an optimization problem under uncertainty, given that the outcome of market clearing is unknown at the time of bidding. Naturally, the formulations of and solutions to the bidding problem found in the literature reflect the variety of approaches to optimization under uncertainty.One strand of literature is based on optimal control and dynamic programming, and focus on the characterization and derivation of closed-form solutions to the bidding problem. An example is Anderson and Philpott (2002) who formulate a non-linear control problem and find necessary conditions for optimality. In their formulation, the authors make use of a so-called market distribution function, representing the probability that a generator is not fully dispatched at a given bid price and volume. For a price-taker, this is equivalent to the probability that the bid price exceeds the realized market price at a given volume, which is also what we use. Whereas an efficient approach to solving the non-linear problem remains an open question, Neame, Philpott, and Pritchard (2003) derive optimality conditions for a hydroelectric reservoir with continuous output range, and solve the bidding problem by a discretization of this range and the application of dynamic programming. A similar approach is taken by Pritchard and Zakeri (2003) who likewise find offer curves for hydro reservoirs, and by Pritchard, Philpott, and Neame (2005) who decompose the hydropower optimization into an inter-stage scheduling problem and an intra-stage bidding problem. In general, it is difficult to handle complex constraints and multiple state variables by the optimal control approaches, and the bidding formulations may often account for operational restrictions only through the reward function, take into account only one market, and do not include the costs of non-compliance with the market commitments.In contrast, mathematical programming formulations easily allow for various constraints, and furthermore, through the extension to stochastic programming, for multiple sources of uncertainty. Examples of bidding models for price-taking electricity producers are (Contreras, Candiles, de la Fuente, & Gómez, 2002; Fleten & Kristoffersen, 2007; Fleten & Pettersen, 2005; Ladurantaye, de Gendreau, & Potvin, 2007; Lu, Chow, & Desrochers, 2004; Ni, Luh, & Rourke, 2004). These models include many details such as ramping restrictions, capacity limits, storage balances, start-up costs, and risk constraints. Reviews on optimal electricity scheduling and market exchange have been given by Wallace and Fleten (2003) and Kristoffersen and Fleten (2010).Here, we extend the work in Fleten and Kristoffersen (2007) to sequential markets. This problem has already been addressed by Plazas, Conjeo, and Prieto (2005) who consider bidding into three sequential short-term markets. For the Nordic markets, contributions include Fosso, Gjelsvik, Haugstad, Mo, and Wangensteen (1999) who consider production scheduling with a view towards the spot, balancing and futures markets, and Faria and Fleten (2011) who focus on the day-ahead Elspot market and intra-day Elbas market. To the best of our knowledge, very few have explicitly addressed the problem of coordinated bidding into the spot and balancing markets, the only example we could find being Olsson (2005). Whereas Fosso et al. (1999) model only price insensitive bids, Olsson (2005) assumes smooth bidding curves instead of the piece-wise linear curves prescribed by the market rules, and Plazas et al. (2005) do not distinguish between the process of bidding into the balancing market (before market clearing) and the settling of imbalances in this market (after market clearing). The major difference to previous work, however, is our modeling of market dynamics. Existing market models are static, making the sequential bidding problem two-stage or three-stage. In contrast, we capture the dynamics of the two markets in a multi-stage model such that spot market bidding decisions are day-ahead and balancing market decisions are hour-ahead.With many details and the inclusion of uncertainty, mathematical programming models can be computationally hard and time consuming. Efforts to efficiently solve the bidding problem have been made by Klæboe (2011) who resorts to Bender’s decomposition, and Nascimento and Powell (2009) and Loehndorf, Wozabal, and Minner (2013) who apply approximate dynamic programming to integrate scheduling and bidding decisions for energy storage.As an alternative to approximating the stochastic programming problem by cutting planes or simulation, we suggest to reduce computation time through careful generation of scenarios. Variations of scenario generation methods from the literature include (Høyland & Wallace, 2001, 2003) who propose moment/property matching by optimization or simulation. Another commonly used approach is to model the underlying stochastic processes, simulate a large number of sample paths/scenarios, and subsequently reduce this number by clustering. Central references on this method are (Dupac̆ová, Gröwe-Kuska, & Römisch, 2003; Heitsch & Römisch, 2003, 2007) for two-stage programs, Heitsch and Römisch (2009) for multi-stage programs, and Gröwe-Kuska, Heitsch, and Römisch (2003) for applications to power planning problems. For the particular case of bidding into sequential electricity markets, see Olsson and Söder (2008) who include the balancing market. Our scenario generation likewise relies on scenario sampling and reduction. However, whereas the existing literature often applies the two methods separately, we alternate between scenario sampling and reduction in a stage-wise fashion with the aim to better preserve the statistical properties of the stochastic processes.From a practical point of view, there may be further challenges in implementing and solving the coordination problem (e.g. since this requires modeling software). This is finally our motivation for relating its solutions to alternative bidding strategies used in practice, and assessing the gain from coordination without actually solving it.We consider two sequential markets common in many electricity market designs: A day-ahead market and an hour-ahead market. In the Nordic region, these markets are the spot market Elspot and the balancing market.The day-ahead spot market is for physical trading of production and consumption. As the name suggests, bidding takes place a day ahead of operation, when the market participants submit a set of price–volume bids for every hour of the following operation day (disregarding so-called block bids and flexible bids). For every such hour, the market interprets the set of bids as a points on a bidding curve. At closure around noon, the market is cleared, i.e. the demand and supply curves from all market participants are aggregated and the equilibrium is determined. Usually, bids are dispatched in merit order until aggregated demand and supply matches (however, taking into account transmission constraints). Bids can either be fully or partially (the marginal bid) accepted, and the marginal bid determines the market price (in the absence of bottlenecks). All trades are settled at this market price. Upon market clearing, the market prices for the following operation day are announced and the market participants are notified of their dispatch. The market participants are committed to comply with their dispatched volumes, and hence must produce or consume accordingly.Nevertheless, due to unforeseen events such as the inability to perfectly predict supply or demand or deliberate (strategic) non-compliance with the market commitments, expected and realized production and consumption may not fully match. Usually, an electricity system operator is responsible for ensuring physical balance of the power system. Hence, when imbalances occur, the system operator activates additional supply or demand by buying or selling so-called up and down regulating power. In situations of negative system imbalances, i.e. if real-time consumption exceeds production, up regulation (an increase in supply or a decrease in demand) is activated. Likewise, in situations of positive system imbalances, down regulation (a decrease in supply or an increase in demand) is activated.Up and down regulation is traded in the hour-ahead market, here referred to as the balancing market. This market operates along many of the same principles as the spot market. Thus, for every hour of an operation day, the market participants submit a set of price–volume bids for up and down regulating power. However, bidding takes place during the operation day, with market closure being immediately prior to the delivery hour. This makes the market accessible only to agents that can quickly adjust production or consumption, also known as balance responsible parties. Furthermore, although bidding is on an hourly basis, the market clearing and subsequent dispatch occur continuously throughout the operation day, and are done by the system operator irrespective of the origin of demand for regulation. The total volume dispatched, or equivalently the aggregated net demand for regulation, during the delivery hour determines the sign of the system imbalance, i.e. whether the system has generally been up and down regulated. This is used to establish the hourly balancing market price. In situations where the system has been up regulated, it is the price of the most recently activated up regulation bid (as above, in the absence of bottlenecks). Likewise, in situations where the system has been down regulated, it is the price of the most recently activated down regulation bid. In an up regulated system, the balancing price is automatically higher than the spot price, since less expensive bids have already been dispatched in the spot market, and vice versa in a down regulated system. For this reason, the sign of the system imbalance is revealed from the spot and balancing market prices. If both up and down regulation bids are dispatched within the same delivery hour, special pricing principles apply.For market participants who do not comply with their dispatched volumes in the spot and balancing markets (in case of trading in both markets), imbalances are penalized. In contrast to the process of balancing market bidding, imbalances are settled following the delivery hour, when realized production and consumption have been metered. Depending on the market design, a one-price or two-price balancing mechanism applies in the settlement. Under a one-price system, metered imbalances, whether positive or negative, are charged or paid the balancing market price. If a two-price system has been implemented, negative imbalances are charged the balancing market price if the overall system needs up regulation, and otherwise the lower spot price. Similarly, positive imbalances are paid the balancing market prices if the system is in need of down regulation, and otherwise the higher spot price. Clearly, this mechanism has been designed to rule out incentives to deliberately create imbalances, and instead encourage market participants to help the system. As an example, in Western Denmark, the one-price system has been implemented for consumption, whereas the two-price system applies to production.We consider a market participant who submits bidding curves to the spot and balancing markets over a time horizon of a day. The day is discretized into hourly time intervals according to the bidding practice in both markets. Although regulation is activated continuously throughout the delivery hour, we assume that only either up or down regulation is activated within the same hour, which makes it possible to settle all accounts on an hourly basis. The following assumptions hold for both markets. When the market participant can decide on both bid prices and volumes, the problem is non-linear, and we therefore discretize the price range, and fix a number of bid prices. Moreover, although we will later relax this assumption, we initially assume that the market participant take market prices as given. This makes it possible to determine a priori whether a bid is accepted or rejected. We assume that all bids are either fully accepted or rejected (i.e. the market participant never submits the marginal bid). Finally, we use system-wide market prices, and ignore any transmission constraints and potential bottlenecks.As indicated above, both spot and balancing market prices are unknown at the time (day-ahead) of bidding into the spot market for the following operation day. However, once the spot market has cleared, spot market prices are revealed. Likewise, the balancing market price is unknown at the time (hour-ahead) of bidding into the balancing market for the following hour of operation, but is revealed once this market has cleared. Finally, both spot and balancing market prices are known when imbalances are settled following the hour of operation. Taking into account the sequential clearing of the markets, we formulate the bidding problem as a multi-stage stochastic program. The first stage consists of spot market bidding, stages 2–25 of balancing market bidding, and stages 3–26 consists of operation and settlement of imbalances. By assuming a discrete distribution of market prices, the gradual realization of uncertainty can be represented by a so-called scenario tree.We use the following notation for the bidding problem. A 24hour operation day is divided into hourly time intervals[t-1,t],t=1,…,TwithT=24, where the interval[0,1]represents the hour 00:00–01:00,[1,2]represents the hour 01:00–02:00, etc. In the following, however, we refer to the time interval[t-1,t]simply as t.We denote the random spot and balancing market prices in time interval t byρtandμt, respectively. Accordingly, we assume that{ρt,μt}t=1Tis a stochastic process on some probability space(Ω,F,P), whereΩis the sample space,Fis theσ-algebra, andPis the probability measure. This probability space is equipped with a filtration given by theσ-fieldsF0spot≔{∅,Ω}⊆F1spot≔F0reg⊆F1reg⊆⋯⊆FTreg≔F, whereF1spotis generated by{ρt}t=1T, andFtregis generated by{ρt}t=1Tand{μt′}t′=1tfort=1,…,T. Hence, theσ-fieldsF0spotandF1spotrepresent the information available before (first stage) and after (second stage) the day-ahead spot market clearing, respectively, and likewiseFt-1regandFtregrepresent the information available before (stages 2–25) and after (stages 3–26) the hour-ahead balancing market clearing in time interval t, fort=1,…,T.We represent the decisions of the sequential bidding problem by the multi-dimensional process{xtspot,ytspot,xtreg,ytreg,zt,qt}t=1T, where the processes (some of which are also multi-dimensional){xtspot}t=1Tand{xtreg}t=1Tare the volumes bid in the day-ahead spot market and the hour-ahead balancing market, respectively,{ytspot}t=1Tand{ytreg}t=1Tare the corresponding volumes dispatched,{zt}t=1Trepresent the imbalances and{qt}t=1Tare the actual net production levels (a positive level indicates production, a negative level consumption). As for market prices, the sequence of decisions in the bidding problem forms a stochastic process on(Ω,F,P). We assume that this process is adapted to the filtration ofσ-fields, or equivalently, that the decisions are non-anticipative. Non-anticipativity implies that decisions made at a given stage depend only on the information available in this stage. Hence, the decisions{xtspot}t=1Tand{ytspot}t=1Tare made before (first stage) and after (second stage) the observation of spot prices{ρt}t=1T, respectively, and likewise the decisionsxtregandytreg,zt,qtare made before (stages 2–25) and after (stages 3–26) the observation of the balancing priceρtin time interval t, fort=1,…,T. Technically speaking, we assume that{xtspot}t=1TisF0spot-measurable,{ytspot}t=1TisF1spot-measurable,xtregisFt-1reg-measurable andytreg,zt,qtareFtreg-measurable fort=1,…,T.For computational reasons, we assume that the process{ρt,μt}t=1Tfollows a discrete distributions with finite support, which we refer to as a set of scenarios. With the above assumptions, the scenarios form a tree with a finite set of nodes. Although we implement the nodal formulation of the multi-stage stochastic programming problem, for ease of exposition, we present the scenario formulation of the problem. Thus, we denote the realizations of the random prices by{ρts,μts}t=1T,s=1,…,Sand their corresponding probabilities byπs,s=1,…,S. We refer to the realizations and their probabilities as scenarios. The decisions of the bidding problem are assigned to scenarios accordingly, i.e.xtspot,s,ytspot,s,xtreg,s,ytreg,s,zts,qtst=1T,s=1,…,S, and we enforce the non-anticipativity explicitly by a set of linear constraints.We consider both selling to and buying from the spot market such that the market participant submits a supply or demand curve for every hour of the following operation day. We assume that the bid prices are fixed, i.e. these are parameters, whereas the bid volumes are decision variables. We let the discretization of the price range be indexed by1,…,I. For a given hour t, the supply curve is then defined by the pricespit+,i=1,…,I, wherepit+⩽pi+1t+andp1t+=0,pI+1t+=+∞, and the volumesxitspot,+,s⩾0,i=1,…,I,s=1,…,S(note that bid volumes are defined as the accumulated volumes at a particular bid price. Occasionally, we may however also refer to a bid as the incremental volume). When minimum and maximum bid volumes apply, we denote these byxminandxmax, and include the decision variablesδit+,s∈{0,1},i=1,…,I,s=1,…,Ssuch thatδit+,s=1, whenxi+1tspot,+,s-xitspot,+,s>0, andδit+,s=0, whenxi+1tspot,+,s-xitspot,+,s=0(minimum and maximum apply to incremental bid volumes). Likewise, for a given hour t, the demand curve is defined by the pricespit-,i=1,…,I, wherepit-⩽pi-1t-andp0t-=+∞,pIt-=0, and the volumesxitspot,-,s⩾0,i=1,…,I,s=1,…,S. The same minimum and maximum bidding volumes may apply, with the corresponding decision variablesδit-,s∈{0,1},i=1,…,I,s=1,…,S. Obviously, if the producer could perfectly predict market prices, it would be unnecessary to submit bidding curves. However, market prices are unknown at the time of bidding. Once these become known, we can determine which (incremental) bids are accepted. For a given hour t, we denote the total volumes dispatched byytspot,+,s,ytspot,-,s⩾0,s=1,…,S, so that these decision variables represent the accumulated volume of accepted supply or demand bids, respectively.In the following, we present only the supply side constraints, and refer the reader to Appendix A for the corresponding demand side constraints. Volumes bid are related to volumes dispatched through the bidding curve. Depending on the market rules, this curve may be a step-wise bidding curve, for which supply bids are accepted if the bid price is below the market price. This implies that(1)ytspot,+,s=xitspot,+,s,ifpit+⩽ρts<pi+1t+,i=1,…,I,t=1,…,T,s=1,…,S.The market rules may alternatively prescribe a piece-wise linear bidding curve (this is the case in the Nordic market), which is given byytspot,+,s=ρts-pit+pi+1t+-pit+xi+1tspot,+,s+pi+1t+-ρtspi+1t+-pit+xitspot,+,s,ifpit+⩽ρts<pi+1t+,i=1,…,I-1,t=1,…,T,s=1,…,S,andytspot,+,s=xItspot,+,sifpIt+⩽ρts. In case of both a step-wise and piece-wise linear bidding curve, for a price-taker, we can determine a priori whether a bid is accepted or rejected, and express the relation between volumes bid and volumes dispatched as a linear constraint. The market rules usually require bidding curves to be monotone (e.g. that the supply curve is non-decreasing) such that(2)xitspot,+,s⩽xi+1tspot,+,s,i=1,…,I-1,t=1,…,T,s=1,…,S.When minimum and maximum bid volumes apply, these constraints can be replaced byxminδit+,s+xitspot,+,s⩽xi+1tspot,+,s⩽xmaxδit+,s+xitspot,+,s,i=1,…,I-1,t=1,…,T,s=1,…,S.To rule out speculation, and since the purpose of the spot market is the physical exchange of power, we further impose the constraints that a market participant who is active only on the supply side cannot sell more than full production capacity and cannot buy in the spot market. We assume that similar constraints hold on the demand side (Note, however, that some market participants may be active on both the supply and demand sides).Now, the spot market bidding problem is two-stage, with bidding and dispatch taking place before and after market clearing, respectively. We explicitly enforce this structure by imposing the non-anticipativity constraints(3)xitspot,+,s=xitspot,+,s′,i=1,…,I,t=1,…,T,s,s′=1,…,S,and(4)yitspot,+,s=yitspot,+,s′,if(ρ1s,…,ρTs)=(ρ1s′,…,ρTs′),i=1,…,I,t=1,…,T,s,s′=1,…,S.Finally, for every hour of the operation day, the spot market profit is calculated as the market price times total volume dispatched. Thus, the expected total daily spot market revenue is∑s=1Sπs∑t=1Tρtsytspot,+,s-ytspot,-,s.As for the spot market, we consider both selling to and buying from the balancing market, and hence the market participant submits a supply or demand curve for the following hour of operation. We again assume that bid prices are fixed, and for ease of exposition, we use the same discretization of the price range. For a given hour t, the volumes bid are represented by the decision variablesxitreg,+,s,xitreg,-,s⩾0,i=1,…,I,s=1,…,S, and the volumes dispatched byytreg,+,s,ytreg,-,s⩾0,s=1,…,S. At the time of bidding into the balancing market, the spot market price is known, but the balancing market price is unknown. Once both the spot and balancing market prices become known, we can determine which bids are accepted.We present only the up regulation constraints, and refer the reader to Appendix B for the corresponding down regulation constraints. We confine ourselves to step-wise bidding curves (the use of piece-wise bidding curves, however, follows along the same lines) and consider the relation between volumes bid and volumes dispatched. In the balancing market, up regulation bids are accepted if the bid price is below the market price and the system is up regulated, which is revealed from the spot and balancing market prices. In situations where the system is up regulated, the balancing market price is higher than spot price, and thus, we have that(5)ytreg,+,s=xitreg,+,s,ifpit+⩽μts<pi+1t+andρts⩽μts0,ifμts<ρtsi=1,…,I,t=1,…,T,s=1,…,S.Again, for a price-taker, we can determine a priori whether a bid is accepted or rejected. It should be remarked that in the balancing market, the market participant faces an additional risk of not being dispatched, if offering up regulating in situations of a positive system imbalance. As above, the bidding curves must be monotone, and so(6)xitreg,+,s⩽xi+1treg,+,s,i=1,…,I-1,t=1,…,T,s=1,…,S.Minimum and maximum bid volumes may also apply. To rule out excessive speculation, we further impose the constraints that a market participant cannot buy or sell more balancing power than available up or down regulating capacity (On the supply side, we define up regulation capacity as production capacity in excess of the spot market dispatch and down regulation capacity as the capacity dispatched in the spot market. We assume that similar definitions hold on the demand side).In balancing market bidding, bidding and dispatch likewise take place before and after market clearing, respectively. However, whereas the spot market is day-ahead, the balancing market is hour-ahead, making the balancing market bidding problem multi-stage. We enforce this by the following non-anticipativity constraints(7)xitreg,+,s=xitreg,+,s′,ifρ1s,…,ρTs,μ1s,…,μt-1s=ρ1s′,…,ρTs′,μ1s′,…,μt-1s′,i=1,…,I,t=1,…,T,s,s′=1,…,S,and(8)yitreg,+,s=yitreg,+,s′,ifρ1s,…,ρTs,μ1s,…,μts=ρ1s′,…,ρTs′,μ1s′,…,μts′,i=1,…,I,t=1,…,T,s,s′=1,…,S.Based on balancing market prices and dispatched volumes, the expected total daily balancing market revenue can be calculated as∑s=1Sπs∑t=1Tμtsytreg,+,s-ytreg,-,s.Imbalances occur when total spot and balancing market commitments do not comply with realized production and consumption. For a given hour t, positive and negative imbalances are represented by the decision variableszt+,s,zt-,s⩾0,s=1,…,S, respectively, and net production byqts,s=1,…,S. Since imbalances are settled following the delivery hour, both spot and balancing market prices are known, and thus, the balancing costs are also known at the time of settlement.The settlement of imbalances is formulated as(9)zt-,s-zt+,s=ytspot,+,s-ytspot,-,s+ytreg,+,s-ytreg,-,s-qts,t=1,…,T,s=1,…,S.Positive and negative imbalances may, respectively, be charged or paid the balancing market price. Under this one-price system, expected total daily balancing costs are∑s=1Sπs∑t=1Tμtszt-,s-zt+,s.A two-price system implies that imbalances are charged or paid the balancing market price when these are of the same sign as system imbalances and otherwise the spot price. In this case, balancing costs sum to∑s=1Sπs∑t=1Tmax{μts,ρts}zt-,s-min{μts,ρts}zt+,s.For ease of notation, we denote balancing prices byγt1,-,s=γt1,+,s=μtsunder a one-price system and byγt2,-,s=max{μts,ρts}andγt2,+,s=min{μts,ρts}under a two-price system.We proceed to formulate the multi-stage stochastic programming problem of coordinated spot and balancing market bidding under balancing price mechanism k fork=1,2.Since existing market rules (except for maybe the balancing price mechanism) apply to any market participant, the bidding model can be used irrespective of the production or consumption technology. However, bidding must be coordinated with operation for the technology considered. For a general representation of the operational part of the problem, we assume thatgtcaptures the state of operation in time intervalt,Ct(qt)denotes the operating costs, andgt∈Xt(gt-1,qt)represents the operational constraints in time interval t, including the relation between state of operation and net production.The first stage of the bidding problem consists of day-ahead spot market bidding such as to maximize expected future revenues from the actual spot market dispatch, i.e.zk=maxEQ1spot(x1spot,…,xTspot)F0spot:(2).In response to the realization of spot market prices, the second stage consists of hour-ahead balancing market bidding such as to maximize the expected difference between future revenues from actual balancing market dispatch and balancing costs, and soQ1spotx1spot,…,xTspot=max∑t=1Tρtytspot,+-ytspot,-+EQ1regy1spot,…,yTspot,x1regF0reg:(1), (6),where (6) applies to time interval 1.Upon the realization of balancing market prices, the market participant aims to produce or consume accordingly. If net production does not comply with the market commitments, imbalances are settled. The process repeats such that stages 2–25 consists of hour-ahead balancing market bidding, whereas production and consumption occur and imbalances are settled in stages 3–26, i.e.Qtregy1spot,…,yTspot,xtreg,gt-1=maxμtytreg,+-ytreg,--(γtk,-zt--γtk,+zt+)-Ct(qt)+EQt+1regy1spot,…,yTspot,xt+1reg,gtFtreg:(5), (6),(9),gt∈Xt(gt-1,qt),t=1,…,T,where (5) and (9) apply to time interval t, (6) applies to time intervalt+1andQT+1reg≔0.Using the same notation as above, the so-called deterministic equivalent iszk=max∑s=1Sπs∑t=1Tρts(ytspot,+,s-ytspot,-,s)+μtsytreg,+,s-ytreg,-,s-(γtk,-,szt-,s-γtk,+,szt+,s)-Ct(qts):(1)–(9),gts∈Xtgt-1s,qts,gts=gts′,ifρ1s,…,ρTs,μ1s,…,μts=ρ1s′,…,ρTs′,μ1s′,…,μts′,t=1,…,T,s,s′=1,…,S,fork=1,2.By taking into account operational aspects by linear or mixed-integer linear modeling, the deterministic equivalent is a linear or mixed-integer linear program. It should be remarked that the objective function and constraints of the bidding problem are separable with respect to time periods. However, the operational constraints most likely introduce temporal dependencies.So far, we assumed that the market participant is a price-taker. This is a valid assumption for many spot market participants, but may be questionable for the balancing market, where market participants tend to be larger players. We therefore relax the price-taker assumption by letting market prices respond linearly to the volumes dispatched. Denote byρˆtnandμˆtnthe spot and balancing prices that realize if the producer or consumer does not participate in the market. The spot price decreases with increased supply or decreased demand volumes dispatched in the spot market, whereas the balancing price responds to both spot and balancing market trades. Hence, we letρts=ρˆts-αspotytspot,+,s-ytspot,-,s,t=1,…,T,s=1,…,S,μts=μˆts-βspotytspot,+,s-ytspot,-,s-βregytreg,+,s-ytreg,-,s,t=1,…,T,s=1,…,S,whereαspot,βspot,βreg>0are parameters. For simplicity, we incorporate the price response only in spot and balancing revenues, and useρˆtsandμˆtsin the constraints and for the calculation of balancing costs (Had we included variable prices in the constraints (1) and (5), the model would no longer be linear). For4αspotβreg>(βspot)2, the bidding problem becomes a convex quadratic program.Although we allow for price response in the following, for simplicity of notation, we denote the pricesρtsytspot,+,s,ytspot,-,sandμtsytspot,+,s-,ytspot,-,s-,ytreg,+,s,ytreg,-,ssimply byρtsandμts.The aim of the operational part of the problem is to produce or consume in accordance with the market commitments, while complying with operational constraints and minimizing costs. For simplicity, we assume that this problem is deterministic, and hence, disregard operational uncertainty such as reservoir inflow, wind power production, and availability of generating plants. We provide two examples.In hydro-power operation, the problem is to determine water releases from a network of reservoirs such as to maximize the final value of water in storage subject to storage balancing and capacity restrictions. We denote byj=1,…,Jthe reservoirs, and assume for simplicity that these are serially connected. The decision variablesljts,vjts⩾0,s=1,…,Srepresent the storage and discharge levels for a given hour t. Upper and lower bounds on storage and discharge are denoted by the parametersljmin,ljmax,vjmin,vjmax. Assuming constant water value and electricity generation efficiency, these are denoted byVjandηj, respectively. Finally, in addition to potential inflows from upstream reservoirs, we assume that all reservoirs have external inflows and denote the inflow in hour t byνjt. Then, the operational part of the problem ismax∑s=1Sπs∑j=1JVjljTs:∑j=1Jηjvjts=qts,ljt+1s=ljts+νjt+vj-1ts-vjts,ljmin⩽ljts⩽ljmax,vjmin⩽vjts⩽vjmax,ljts=ljts′,vjts=vjts′,ifρ1s,…,ρTs,μ1s,…,μts=ρ1s′,…,ρTs′,μ1s′,…,μts′,j=1,…,J,t=1,…,T,s,s′=1,…,S.Note that the first set of constraints ensure compliance with the market commitments, and so these commitments can be viewed as a type of demand. For further details on the modeling of hydro-power operation, see for example Fleten and Kristoffersen (2008).The thermal generation problem is concerned with the optimal operation of a number of production units. We denote these units byj=1,…,J. Production levels for a given hour t are represented by the decision variablesgjts⩾0,s=1,…,S, and their upper and lower bounds bygjmin,gjmax. The variable operation cost is denoted byaj. As a result, the operational part of the problem ismin∑s=1Sπs∑t=1T∑j=1Jajgjts:∑j=1Igjts=qts,gjmin⩽gjts⩽gjmax,gjts=gjts′,if(ρ1s,…,ρTs,μ1s,…,μts)=(ρ1s′,…,ρTs′,μ1s′,…,μts′),j=1,…,J,t=1,…,T,s,s′=1,…,S.As above, it should be remarked that the first set of constraints ensure compliance with the market commitments. This problem may be further subject to ramping restrictions, reserve constraints and include start-up costs.We account for uncertainty in spot and balancing prices and for the sign of the system imbalance. As already indicated, however, the sign of the imbalance is revealed by spot and balancing prices, and so scenario generation reduces to describing a two-dimensional price process.Spot and balancing prices exhibit strong autocorrelations and cross-correlations. The former are highly important for technologies with start-up costs, storage ability, ramping restrictions or other temporal dependencies in the operational constraints, whereas the latter are obviously relevant to market participants who engage in both the spot and balancing markets. We therefore put efforts into preserving these correlations in the scenario generation.We begin by fitting the two price processes. We describe spot and balancing prices by autoregressive processes that capture their autocorrelations. Moreover, since spot prices are known at the time of balancing market clearing, we include these as exogenous variables in the balancing price process, and thereby also capture their cross-correlations.The problem of electricity spot price modeling is a subject of extensive study in the literature, see for example (Contreras, Espinola, Nogales, & Conejo, 2003; Garcia, Contreras, Akkeren, & Garcia, 2005; Haldrup & Nielsen, 2006; Nogales, Conejo, & Espinola, 2002), whereas the modeling of balancing market prices is relatively unexplored, a few references being (Klæboe, Eriksrud, & Fleten, 2013; Olsson & Söder, 2008; Skytte, 1999). With only spot and balancing price data available, structural analysis (e.g. the inclusion of exogenous variables such as consumption) is infeasible. Like in most of the cited references, we instead fit autoregressive models, although ignoring more complex characteristics such as jumps, regime switching and volatility clustering. Prior to model fitting, we de-trend and de-seasonalize the data, using hourly, daily and monthly seasonal dummies. We then adjust for non-stationarity in de-seasonalized and de-trended market prices by applying hourly differencing (We also tested logarithmic transformation of the data, which however did not improve stationarity).We fit spot prices to the SARIMA(2,1,0)×(1,0,1)24process1-ϕ24spotL241-ϕ1spotL-ϕ2spotL(1-L)ρt=1-θ24spotL24∊tspot,where the L is the backshift operator, i.e.Lkρt=ρt-k,ϕ1spot,ϕ2spot,ϕ24spotandθ24spotare model parameters, and the innovations∊tspot,t=1,…,Tare independent and identically distributedN(0,(σspot)2). Several other model specifications were tested, but none were found superior to this model. The model describes hourly and daily cycles in the data (which are mainly due variations in consumption patterns). The best fit to balancing prices is the ARMAX(1,0,0)process, including exogenous spot prices(1-ϕ1regL)(μt-ψregρt)=∊treg,whereψregandϕ1regare model parameters, and the innovations∊treg,t=1,…,Tare identically distributedN(0,(σreg)2), mutually independent and independent of the above innovations.In our Nordic case study, we use historical spot and balancing prices from January 1 2009–December 31 2010 and obtained from the Danish transmission system operator (Energinet, 2012). Parameter estimates for the SARIMA and ARMAX models can be found in Table 1. To test the validity of the fitted models, we check that the residuals are independent and identically Normally distributed with zero mean and constant variance. Moreover, we check the goodness of fit with the following test statistics. The R-square, the MAE (mean absolute error) and RMSE (root mean square error) are 0.79, 2.42Euro/megawatthour, and 4.12Euro/megawatthour for spot prices, and 0.50, 6.44Euro/megawatthour, and 17.86Euro/megawatthour for balancing prices. We consider this to be a reasonable fit.We proceed with scenario tree sampling and reduction. Whereas the existing literature applies the two methods separately, we alternate between scenario sampling and reduction in a stage-wise fashion. By sampling current prices conditional on previous ones, we preserve autocorrelations for both spot and balancing prices. Likewise, by sampling balancing market prices conditional on spot prices, we preserve cross-correlations. To accurately describe the distribution of the two-dimensional price process, we generate a large fan of samples, and for computational reasons, we subsequently reduce this fan. The idea is, however, to apply sampling and reduction in a stage-wise fashion in order not to alter correlations too much in the process. Furthermore, for a multi-stage problem, separate scenario tree sampling and reduction require the storing of an enormous number of scenario samples prior to reduction, whereas with the stage-wise approach it is sufficient to store the scenario samples for the current stage.Recall that S denotes the total number of spot and balancing price scenario paths. We denote bySspotthe number of spot price scenario paths generated, and bySregthe number of balancing price scenario values generated conditional on a previous spot and balancing price scenario path. The stage-wise scenario generation approach can then be summarized as follows:•Sample a fan of spot price scenario paths (vectors), and reduce this fan by clustering to obtain(ρ1s,…,ρTs),s=1,…,Sspot. Keep theSspotspot price scenario paths.Fort=1,…,T:•Conditional on each previous spot and balancing price scenario path(ρ1s,…,ρTs,μ1s,…,μt-1s), sample a fan of balancing price scenario values (scalars), and reduce this fan by clustering to obtainμts′,s′=1,…,Sreg.Further reduce the total number of balancing price scenario valuesSspot×lt-1×Sregat time t by keeping only theSspot×ltlargest clusters, where l is such thatSspot×lT=S.Note that we sample and cluster spot price scenario paths (vectors), since an entire spot price path is realized upon day-ahead market clearing (recall that the day-ahead market clears once a day), whereas we sample and cluster balancing price scenario values (scalars), since only a single balancing price is realized upon intra-day market clearing (recall that the intra-day market clears once an hour). The approach is illustrated in Fig. 1.We elaborate on the approach below. To generate scenarios, we first sample a fan of spot price scenario paths from the SARIMA process. We reduce this fan using a k-medoids clustering algorithm. Hence, we partition the scenario paths intok=Sspotclusters by iteratively assigning paths to clusters such that the distance from path to medoid is minimal, and subsequently updating the medoids. As distance measure, we use the Euclidian distance. Hence, the distance between two spot price scenario paths(ρ1s,…,ρTs)and(ρ1s′,…,ρTs′)is∑t=1T|ρts-ρts′|2.We next sample a fan of balancing price scenario values from the ARMAX process (conditional on each previous spot price scenario path), and apply the clustering algorithm withk=Sreg. We repeat this for allt=1,…,T. Thus, we sample balancing price scenario values (conditional on each previous spot and balancing price scenario path), and apply the clustering algorithm with the same k. The distance between two balancing price scenario valuesμtsandμts′is|μts-μts′|.Since the number of scenarios increases exponentially with the number of stages in the multi-stage problem, we further reduce the size of the scenario tree as follows. In the spot market stage (second stage), we keep theSspotscenario paths obtained by clustering. However, in the balancing market stages (stages 3–26), we do the following. Fort=1,…,T, we further reduce the total number of scenario valuesSspot×lt-1×Sregat time t by keeping only theSspot×lt(rounded) largest clusters, where l is such thatSspot×lT=Sand S is the total number of spot and balancing price scenario paths.The scenario tree sampling and reduction has been implemented in the Python programming language. We generate results for the Nordic case study. In the spot market stage (second stage), we sample 500 spot price scenario paths and reduce these to 10. In the balancing market stages (stages 3–26), we likewise sample 500 balancing price scenario values for each previous spot and balancing price scenario path and reduce these to 10. However, fort=1,…,Twe further reduce the total number of balancing price scenario values10×lt-1×10at time t to10×lt(rounded), wherel=1.18. For example, in stage 3, we generate a total of10×500samples and reduce these to10×10and then to10×1.18. In stage 26, we generate a total of10×1.1823×500and reduce these to10×1.1823×10and then to10×1.1824=500. The reason for reducing the scenario tree to 500 scenarios is the computational tractability of the bidding model.Table 2shows the statistical properties of the stochastic processes prior to and as a result of the scenario reduction for December 15 2010. As can be seen, the properties of spot prices are well preserved. The mean changes by only 0.28Euro/megawatthour when applying scenario reduction and the standard deviation is reduced by 2.92Euro/megawatthour, in spite of a significant reduction from 500 to 10 spot price scenarios. Furthermore, the first order autocorrelation changes by only 0.0111. The mean of balancing prices is likewise well preserved with a change of only 0.82Euro/megawatthour and the standard deviation is reduced by 3.29Euro/megawatthour. The first order autocorrelation changes by 0.2107, which is due to the enormous reduction from50024to 500 balancing price scenarios. Finally, the cross-correlation changes by a more moderate 0.1033 when applying scenario reduction. It should be remarked that we see smaller changes in standard deviations and correlations, when the reduction of the scenario tree is less significant.The generation of spot price scenario paths is illustrated in Fig. 2. For the two selected days December 14–15 2010, the figure shows historical spot prices for the hours 1–24, conditional on which future scenario paths are sampled for the hours 25–48. The figure to the left displays the sample paths prior to scenario reduction, and that to the right shows the result of the scenario reduction. For illustration purposes, the scenario fan before scenario reduction consists of only 20 out of the 500 scenarios, whereas after scenario reduction, the scenario fan consists of all 10 scenarios.In this section, we examine the profit gain from coordinated spot and balancing market bidding. More specifically, we assess the performance of the separately derived bidding strategies often used in practice. We do this by deriving bounds on the profits obtained from coordinated and separate bidding.Recall that the optimal value of the coordination problem under balancing price mechanism k is denoted byzkfork=1,2.To resemble that practitioners often derive the bidding strategies separately, we solve the spot and balancing market bidding problems in a sequential fashion. The spot market bidding problem under balancing price mechanism k iszspot,k=maxEQ1spotx1spot,…,xTspotF0spot:(2),Q1spotx1spot,…,xTspot=max∑t=1Tρtytspot,+-ytspot,-+EQ1regy1spot,…,yTspotF0reg:(1),(10)Qtregy1spot,…,yTspot,gt-1=max-(γtk,-zt--γtk,+zt+)-Ct(qt)+EQt+1regy1spot,…,yTspot,gtFtreg:zt--zt+=ytspot,+-ytspot,--qt,gt∈Xtgt-1,qt,t=1,…,T,fork=1,2. We denote the optimal volumes dispatched in the spot market by the (stochastic) vector(y¯1spot,…,y¯Tspot).In solving the problems sequentially, balancing bidding is conditional on the optimal volumes dispatched in the spot market. Hence, the balancing bidding problems under balancing price mechanism k are(11)zreg,ky¯1spot,…,y¯Tspot=maxEQ1regy¯1spot,…,y¯Tspot,x1regF0reg:(6),Qtregy¯1spot,…,y¯Tspot,xtreg,gt-1=maxμtytreg,+-ytreg,--(γtk,-zt--γtk,+zt+)-Ct(qt)+EQt+1regy¯1spot,…,y¯Tspot,xt+1reg,gtFtreg:(5), (6),zt--zt+=y¯tspot,+-y¯tspot,-+ytreg+-ytreg,--qt,gt∈Xtgt-1,qt,t=1,…,T,fork=1,2.The expected profit from using the resulting spot market bids provides a lower bound on the profit in the coordination problem. However, to compute the expected profit from using the spot market bids, one must solve a number of bidding problems. A much less computationally expensive, though less tight, lower bound is provided by solving only the spot market bidding problem. This is formalized in the following, the proof of which is provided in Appendix C.Proposition 1zspot,k⩽E∑t=1Tρty¯tspot,+-y¯tspot,-+zreg,ky¯1spot,…,y¯TspotF0spot⩽zk,k=1,2.When the market participant is a price-taker, an upper bound on the profit in the coordination problem is provided by solving the spot market bidding problem, assuming a one-price balancing mechanism. For the proof, see Appendix D.Proposition 2Assume thatρt=ρˆtandμt=μˆt(fixed prices). Then,zk⩽zspot,1,k=1,2.Note that the gain from coordinated bidding can be bounded without actually solving the coordination problem, but by solving at most two variations of the spot market bidding problem (under the one-price and two-price balancing mechanisms).Propositions 1 and 2 apply irrespective of the balancing price mechanism. Hence, when the market participant is a price-taker, and under a one-price mechanism, it is evident that one cannot obtain higher profits through balancing market bidding and, hence, it is sufficient to bid in the spot market.Corollary 1Assume thatρt=ρˆtandμt=μˆt(fixed prices). Then, under a one-price balancing price mechanism,z1=zspot,1.In the following section, we investigate the quality of the bounds numerically.

@&#CONCLUSIONS@&#
