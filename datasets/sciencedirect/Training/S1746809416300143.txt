@&#MAIN-TITLE@&#
An algorithm for beat-to-beat heart rate detection from the BCG based on the continuous spline wavelet transform

@&#HIGHLIGHTS@&#
An algorithm for beat-to-beat heart rate detection from the BCG is proposed.BCG is obtained from seated subjects.Algorithm is based on the continuous wavelet transform with splines.Algorithm detects J-wave peak of the BCG for heart rate calculation.Good agreement between heart rates from BCG and standard ECG was obtained.

@&#KEYPHRASES@&#
BCG,Heart rate,Wavelet transform,

@&#ABSTRACT@&#
This work describes an algorithm intended to detect the beat-to-beat heart rate from the ballistocardiogram (BCG) obtained from seated subjects. The algorithm is based on the continuous wavelet transform with splines, which enables the selection of an optimum scale for reducing noise and mechanical interferences. The first step of the algorithm is a learning phase in which the first four heartbeats in the BCG are detected to define initial thresholds, search windows and interval limits. The learned parameters serve to identify the next heartbeat and are readapted after each heartbeat detected to follow the heart rate and signal-amplitude changes. To evaluate the agreement between results from the algorithm and the heart rate obtained from the ECG, a Bland–Altman plot has been used to compare them for seven seated subjects. The mean error obtained was −0.03beats/min and the 95% confidence interval (±2 SD) was ±2.7beats/min, which is within the accuracy limits recommended by the Association for the Advancement of Medical Instrumentation (AAMI) standard for heart rate meters.

@&#INTRODUCTION@&#
The ballistocardiogram (BCG) describes the movement of the center of gravity within the body caused by changes in the mass distribution due to the main circulatory events that occur in the ventricles and in the larger arteries at each heartbeat. These movements can be recorded in terms of displacement, velocity or acceleration [1].In the 1930s, Starr constructed what is considered the first ballistocardiograph [2], a supine recording system based on the opposition to the movement of the body that attenuated the respiratory content in the record, but despite its high potential value it rapidly fell into disuse in the 1960s. Physicians lost interest in the BCG due to the poor reproducibility of the cardiac cycles even in healthy people and preferred the then recently introduced catheter-based cardiovascular monitoring methods. In the last years, home health monitoring and e-health at large have renewed the interest for research focused on the BCG as a non-obtrusive technique able to assess cardiovascular and respiratory activity [3]. Sensor technology development has enabled the design of low cost recording systems that can be embedded in common objects, such as beds [4], office chairs [5,6], wheelchairs [7] and body weighing scales [8], and enables patients to perform the measurements themselves with minimal medical staff support. These factors minimize stress induced by examinations and the patient involuntary psychophysiological responses [9]. Additionally, computer science enables the development of more powerful signal processing tools able to extract information from complex signals.The reaction forces that originate the BCG induce body displacement in three directions [10]: head-foot (longitudinal), anterior-posterior (dorsoventral) and left-right (transverse). Fig. 1shows a longitudinal BCG cardiac cycle recorded in the seat of an office chair [6] and its corresponding electrocardiogram (ECG) simultaneously recorded. This is the most common and easiest component of the BCG that can be obtained in seated and standing position. BCG waves in normal records are named with consecutive letters from H to N. The H to L waves are the main oscillations of the BCG because of its good reproducibility and larger magnitude, being the J wave the central and largest positive deflection. It is noted that J-wave peak (Jp) appears close to the T-wave peak in the ECG. In automated BCG analysis, the detection of Jp is important because once it has been detected, other BCG waves amplitudes and intervals such as J-J or I-J (shown in Fig. 2) can be analyzed with more detail [6].For heart rate (HR) calculations, the I, J and K waves are the most common waves used, and are related to the ventricular ejection and aortic flow [1]. The I-J amplitude reflects the maximal force delivered by the heart during the ventricular systole in order to propel blood flow [11]. Recently, J-wave amplitude has been proposed to monitor the ejection force in patients with diagnosed heart failure during cardiac resynchronization therapy optimization [12]. The time interval between the R-wave peak of the simultaneously measured ECG and the Jp, named R-J interval, has been proposed to estimate the systolic blood pressure [13] and cardiac contractility [14].Beat-to-beat HR detection in the BCG without using any other signal as a reference is not a trivial task because its waveform strongly changes from subject-to-subject and even from beat-to-beat in the same record of a given subject. These changes can be attributed, at least in part, to internal and external mechanical interferences such as breathing, muscular temblors and vibrations. Several algorithms have been proposed to detect individual heartbeats from the BCG, some based on the search of largest deflection [15] which was very sensitive to motion artifacts. Some others are based on the discrete wavelet transform (DWT) [7], for which is required additional signal processing for noise filtering; and the continuous wavelet transform (CWT) [16], that required two ranges of scales to obtain low and high HR. Other algorithms that involve a high computational load due to its complexity are based on unsupervised learning techniques [4], continuous local interval estimation with three estimators combined [17] and adaptive heartbeat shape modeling [18].Regarding the wavelet transform, it is a suitable tool that has been used to determine peaks and limits of ECG waves because of its ability to detect transients and of its robustness in front of noise and artifacts [19]. Wavelet transforms at different scales describe the time characteristics of a signal in different frequency bands, but the analysis is restricted to scales that are powers of two [20]. The use of B-splines as base functions permits the evaluation of the CWT in any integer scale [21], which enables to use a wider range of scales and to reduce noise and artifacts more efficiently. This feature can allow the direct application of the algorithm over the raw BCG signal without any pre-processing stage, because frequency filtering is performed when the CWT is computed. In this work, an algorithm to detect Jp in the BCG based on the CWT with splines is presented, which has been evaluated in seven BCG records obtained in seated subjects.The longitudinal BCG was recorded in 7 seated subjects (5 males, 2 females; age 33±6 years) with different physical constitution (weight and height ranges from 67 to 87kg and from 1.65 to 1.75m respectively). The ballistic force was measured with a piezoelectric sensor fixed with adhesive tape to the bottom side of the seat of a common office chair [6]. Fig. 3shows the chair, the location of the sensor, and the block diagram of the force measurement system. The mechanical stress of the seat yields electrical charge variations at the sensor output and a charge amplifier converted these to voltage signals.To reduce noise and mechanical interferences, BCG was band limited. The charge amplifier has a first order high pass response, which was settled to fL=0.5Hz. The bias current of this amplifier produces an offset voltage at the output of the amplifier even though the high pass response. This was canceled by a passive first order high pass filter (HPF) with the same cutoff frequency, therefore, the overall high pass response of the circuit was of second order (n=2). The output of the passive HPF was band limited with a second order low pass filter (LPF) to fH=20Hz with an active filter. Finally, the BCG was digitized at a sampling rate of 1kS/s with 12-bit resolution.The ECG (lead I) was simultaneously recorded as a reference signal but otherwise it was not used to process the BCG. It was amplified by 1340 to fit the dynamic range of the ADC and band limited with active filters between 0.16Hz (with a second order HPF) and 100Hz (with a third order LPF). BCG and ECG acquisition systems used a ground isolated power supply of ±6V.The wavelet transform decomposes a signal in components that appear at different scales or resolutions [20]. Thus, the CWT of a time-continuous signal x(t) is defined as(1)CWT{x(t);a,b}=1a∫−∞∞x(t)ψ*t−badtwhere ψ*(t) is the complex conjugate of the analyzing wavelet function ψ(t)and a and b are the scale and translation parameters respectively. The function ψ(t) compresses or dilates depending on a, which enables the CWT to extract the low and high-frequency components of x(t). To implement the CWT, a and b are usually discretized. If a is discretized over a sequence 2j(j=1, 2,…), the analysis is restricted to scales that are powers of two, and the result is the dyadic wavelet transform that can be computed with Mallat's algorithm [20].In this work, B-splines have been used which enable the evaluation of the CWT in any integer scale [21]. In this approach, the input signal x(t) and the analyzing wavelet ψ(t) are both represented by polynomial splines of degree n1 and n2 respectively, and therefore the resulting CWT will be a polynomial spline function.The splines are functions constructed from polynomial segments of degree n of unit length that are smoothly connected together at joining points called knots, in a way such that guarantees the continuity of the function and its derivatives up to order (n−1).The B-splines are the basic building blocks for splines and are bell-shaped functions of compact support that are constructed from the repeated convolution of a centered unit rectangular pulse (B-spline of degree zero) β0(t)(2)βn(t)=β0×βn−1(t)Input signal x(t) is characterized in terms of its B-spline expansion of degree n1 and the sequence of B-spline coefficients c(k)(3)x(t)=∑k∈Zc(k)βn1(t−k)Then, the wavelet ψ(t) is a spline of degree n2 with its B-spline expansion(4)ψ(t)=∑k∈Zp(k)βn2(t−k)B-splines satisfy a two-scale equation for any integer m, where m is not restricted to a power of two, thus the wavelet expanded by a factor m can be expressed as(5)ψ(t/m)=∑k∈Z([p]↑m×umn2)(k)βn2(t−k)where the sequenceumn2(k), when n2 and m are not both even, is given by z transform,(6)umn2(z)=zk0mn2∑k=0m−1z−kn2+1with k0=(n2+1)(m−1)/2.The resulting CWT at scale m evaluated at integer time samples is a polynomial spline function given by(7)CWT{x(t),m,k}=([p]↑m×umn2×bn1+n2+1×c)(k)where the notation([p]↑m×umn2)(k)represents the kth term of the convolution of the sequences p upsampled by a factor m and of sequenceumn2, the filterumn2is a cascade of (n2+1) moving sum filters of order (m−1) with an offset k0 that ensures its symmetry, bn1+n2+1 is the B-spline representation of a spline of order n1+n2+1, and c(k)’s are the B-splines coefficients.The program developed by Alvarado et al. [22] (written in Matlab®, The MathWorks Inc.), calculates the CWT of the discrete signal x(t) at the integer scales m with expansion coefficients spline p, and its implementation is based in the fast algorithm proposed by Unser et al. [21]. It can be seen from (6) that filters are iterated discrete convolutions of moving sums, and can be computed without any multiplication, which results in a very efficient algorithm.The selected wavelet function ψ(t) is the first derivative of a 4th-order cubic B-spline expanded by two, which is similar to the first derivative of a Gaussian function and it yields good time and frequency resolution [21]. The Fourier transform of the wavelet at four scales at a sampling frequency of 1kHz is shown in Fig. 4.From the equivalent filters responses in Fig. 4, scale 5, which corresponds to a −3dB bandwidth of 23–78Hz, was selected to reduce the influence of noise, mechanical interferences and detection errors in all BCG records.According to the form of the wavelet function selected, the J wave of the BCG corresponds to a pair of local maxima Wp and minima Wn of the modulus Pmm of the CWT by using the scale 5 (CWT5), where the rising slope yields a minimum and the falling slope yields a maximum [19]. Jp corresponds to the zero crossing of Pmm (Fig. 5).The algorithm for Jp detection is directly applied to the CWT of the longitudinal BCG band limited and comprises two stages: learning and decision.The learning stage includes the definition of a first set of detection thresholds to detect the first four beats considered as Jp, a refractory period of 300ms to avoid false detections once Jp has been located [23], and the calculus of a J-J interval average obtained of the first three J-J intervals to define an initial search window.In this stage, the highest positive peak (Wp) and the lowest negative peak (Wn) are searched within the first 2s of the record in order to define a positive threshold (Tp1=KpWp) and a negative threshold (Tn1=KnWn). Constants Kp and Kn are experimental values that in the algorithm performs best for Kp=0.5 and Kn=0.4. Thereafter, in the first 2s a positive peak larger than Tp1 (Wp(1:4)) and its nearest negative peak backwards lower than Tn1 (Wn(1:4)) are searched. A zero crossing between those points would be the first beat considered Jp (1:4). With this method, the following three beats considered as Jp, are detected to calculate the first three values of J-J interval, JJ(1:3). Then, an average value defined as JJav(1:3)=Ksw×mean[JJ(1:3)] is used as the initial value to define a search window for the next Jp detection, where constant Ksw is an experimental value that in the algorithm has its best performance for Ksw=0.8. Also, the first three HR values are calculated.The decision stage is a process of three steps to recognize Jp. It includes the definition of a second set of adaptive detection thresholds and an adaptive search window, besides of the calculus of two J-J intervals average that are the mean of the two and three last J-J intervals respectively. Flowchart of the decision stage is shown in Fig. 6.In the first step, positive and negative thresholds are defined as Tpd=KpdTp1(n) and Tnd=KndTn1(n) respectively, where constants Kpd and Knd are experimental values that in the algorithm performs best for Kpd=0.7 and Knd=0.5. A positive peak larger than Tpd; (Wpa(5:n)) and its nearest negative peak backwards (Wna(5:n)) are searched in the defined window. A zero crossing between those points would be the first Jp candidate Jp1(5:n) and its corresponding interval JJ1(4:n) is calculated. To determine whether Jp has occurred or not, Eqs. (8) and (9) are applied.(8)Wna(5:n)<Tnd(9)1.3×JJav2>JJ1(4:n)>0.84×JJav2where JJav2 is the mean of the two most recent intervals [JJ(1:n):JJ(2:n)].If these two conditions are not met, in the second step another Jp candidate Jp2 (5:n), the zero crossing between a pair of local maxima, Wpb(5:n) and minima Wnb(5:n), is searched from Jp1 in a new window, and a new interval JJ2(4:n) is calculated. The decision about if a Jp was found, is taken with Eqs. (10) and (11).(10)Wpb(5:n)>Tpd(11)1.3×JJav3>JJ2(4:n)>0.9×JJav3where JJav3 is the mean of the three most recent J-J intervals [JJ(1:n):JJ(3:n)].If these second pair of conditions are not fulfilled, in the third step the last Jp candidate Jp3(5:n), the zero crossing between a pair of local maxima, Wpc(5:n) and minima Wnc(5:n), is searched from Jp2 in a new window, and a last interval JJ3(4:n) is calculated. In this step Jp3(5:n) is considered to be Jp, and JJ3(4:n) is a valid interval.In any of the steps once Jp is validated, HR values are calculated and adaptive detection thresholds and an adaptive search window are defined. The next thresholds at the nth beat are calculated as(12)Tpd(n+1)=0.4Tpd(n)+0.2Wp(n)(13)Tnd(n+1)=0.4Tnd(n)+0.2Wn(n)For the search of Jp at the nth beat, the next search windows JJav(n+1) are calculated from the last J-J interval JJ(n), as described by Laguna et al. [24] for QT interval measurement, but the low and high J-J limits are modified as follows in order to adapt to heart rate changes,(14)If1.2JJav(n)>JJ(n)>0.8JJav(n)JJav(n+1)=0.8JJav(n)+0.2JJ(n)else(15)JJav(n+1)=JJav(n)

@&#CONCLUSIONS@&#
