@&#MAIN-TITLE@&#
Automatic detection of misleading blood flow values in CT perfusion studies of lung cancer

@&#HIGHLIGHTS@&#
CT perfusion (CTp) is a promising technique to assess anti-angiogenic therapies.Patient motion and CTp artefacts prevent reliable quantitative measurements.An adaptive thresholding of goodness-of-fit errors histogram is proposed.Voxels with high fitting errors correspond to vessel, bronchi and artefacts.These misleading voxels are removed and the CTp maps increase their reliability.

@&#KEYPHRASES@&#
Quantitative imaging,Error analysis,Image processing,Imaging artefacts,Cancer,

@&#ABSTRACT@&#
In the oncology field, the anti-angiogenetic therapies aim at inhibiting tumour vascularization, that is the development of new capillary blood vessels in tumours, that allows them to grow and spread and, potentially, to metastasi. Computed tomography perfusion (CTp) is a dynamic contrast-enhanced technique that has emerged in the last few years as a promising approach for earlier assessment of such therapies, and of tumour response, in general, since functional changes precede morphological changes, that take more time to become evident. However several issues, such as patient motion and several types of artefacts, jeopardize quantitative measurements, this preventing CTp to be used in standard clinics. This paper presents an original automatic approach, based on the voxel-based analysis of the time–concentration curves (TCCs), that allows emphasizing those physiological structures, such as vessels, bronchi or artefacts, that could affect the final computation of blood flow perfusion values in CTp studies of lung cancer. The automatic exclusion of these misleading values represents a step towards a quantitative CTp, hence its routine use in clinics.

@&#INTRODUCTION@&#
In the last years the computed tomography perfusion (CTp) has aroused lively interest because of its capability of providing morphologically detailed functional maps that could find application in monitoring functional activity of tumours at their different stages [1], predicting treatment outcome or early therapeutic response of anti-angiogenetic therapies [2–6], before morphological changes become visible [7]. This widely available and non-invasive technique relies on the estimation of tissue contrast agent delivery, and on the corresponding haemodynamic parameters, which can be derived from the analysis of the tissue time-concentration curves (TCCs) signals generated by the contrast agent before, during, and after reaching the tumour lesion. As such, they can be employed to detect changes in its vascular structure, hinting at possible anomalies in blood supply (i.e., tumour angiogenesis [2,8]). The main obstacles preventing the use of CTp in the standard clinical practice is represented by the difficulty to measure its reproducibility and, in the last analysis, the reliability of perfusion values [9]. In its turn, this arises from the difficulty to achieve reliable TCCs because of motion artefacts due to breathing [10] or a high concentration of contrast agent that may also yield streaking  [11] or simulate partial volume effects in the repeated acquisitions of a CTp study. In addition, streaks or dark bands may also originate from beam hardening (for instance, induced by the presence in the lesion's neighbourhood of a main vessel flooded with contrast agent). A detailed description of possible artefacts in CT examinations, also holding for CTp examinations, can be found in  [12,13]. Besides artefacts  [14], also vessels  [15] and bronchi  [16] are usually manually excluded from the perfusion analysis not to jeopardize the visual analysis of perfusion colour maps nor the automatic computation of local or global statistical indexes regarding perfusion values.In general, the unreliable perfusion values in colour maps are simply considered as those being out of range of physiological parameters (for instance, due to vessels  [17] and are detected and excluded by manually adjusting an appropriate window level  [9]. So far, the TCC fitting errors and goodness of fit indexes have been mainly used to evaluate the reliability of given simulated model fitting, from a theoretical point of view, in lung CT  [18] or liver MRI  [19] perfusion studies, rather than to assess the voxel-based reliability of perfusion values. Just recently, some works have appeared to try addressing explicitly the reliability of TCCs in relation to the outcome of perfusion studies, suggesting methods to detect where the error in fitting a TCC according to a given pharmacokinetic model could prejudice the computation of correct perfusion values  [20] or even to improve the way a TCC is built, so as to reduce the number of possible flawed TCCs  [21]. However, they do not associate fitting errors to their causes, if not to generic motion artefacts and, not at all, to anatomical structures.This methodological work presents a novel quantitative and automatic approach to detect those anatomical structures (mainly vessels and bronchi) and those regions undergoing CTp reconstruction and acquisition artefacts, that could compromise the correct interpretation of a CTp colour map and, ultimately, the clinical outcome. The approach is based on the computation of a statistical error index connected to the quality (i.e., goodness of fit) of TCCs. The ability of our method to automatically remove the “misleading” regions is assessed and compared with the performance of two 25-year experienced radiologists who detected, and manually bounded using a graphic tablet, the anatomical structures and the regions undergoing artefacts. The main errors made when operating manually, and their consequences on the definite perfusion maps, are also discussed. Moreover, we analyze how mean of perfusion values and, above, their standard deviation and coefficient of variation (CV), change before and after removing automatically segmented regions. Finally, we also discuss some meaningful comparisons between definite colour maps achieved by using our approach and the manual thresholding on BF values commonly used by readers.The paper is organized as follows. Section 2 describes the materials and the methods employed from image acquisition to building of the final perfusion maps, including the automatic histogram-based image segmentation approach developed by exploiting goodness-of-fit errors. Section 3 presents the choices performed to evaluate the experimental results which are subsequently analysed in Section 4 and discussed in Section 5. Finally, drawing conclusions are reported in Section 6.46 patients with non-small cell lung cancer (NSCLC) underwent CTp. As the inclusion criteria, patients over eighteen, with lesions having maximum transverse diameter greater than 2.5cm, and area wider than 3.14cm2 were considered. Consequently, the remaining 22 patients (age range, 36–81 years; median, 66 years; mean, 64.8 years; 17 men, 5 women) were enrolled for the study, for a total amount of thirty-four examinations, with as many lesions. The data set utilized in this study was selected from a prospective CTp study approved by the institutional review board.To achieve a perfusion examination, a region of interest (ROI) has to be repeatedly sampled. The kinetics of a contrast agent in tissue directly depends on the tissue properties themselves, so it can be used to estimate them. In particular, the well-known Mullani–Gould model  [22], grounding on the simplified assumption of no venous washout  [23], exploits the tissue's blood flow (BF) to estimate perfusion by measuring the instantaneous concentration of the contrast agent over time, limitedly to the first pass phase, where the amount of contrast agent diffusing from the intra-vascular to the extra-cellular compartment is negligible. Accordingly, the Hill's equation  [24], commonly used in pharmacodynamic models to describe non-linear drug dose–response relationships, can be also employed to model the pharmacokinetic of the contrast agent  [25], thus representing a TCC:(1)fˆ(t)=E0+(Emax−E0)tα(EC50)α+tαwhere E0 and Emaxrepresent the baseline and the saturation expressed in Hounsfield Units (HU) values, respectively, EC50 is the time instant of half-maximum response concentration of the curve and α is the non-linear parameter mostly affecting the slope of the curve. Fig. 1points out an ideal TCC and a time-series of HU values. The BF values are then calculated according to the maximum slope method  [26] during the first-pass phase:(2)BF=dftˆ(t)dt|maxfaˆ(t)|maxthat represents the ratio between the maximum slope of the tissue TCCftˆ(t)and the peak density reached by the TCC of the arterial inputfaˆ(t). For the sake of clarity, hereinafter the tissue TCCftˆ(t)will be indicated asfˆ(t).CTp examinations were performed using a 256-slice CT system (Brilliance iCT, Philips Medical Systems, Best, The Netherlands). Patients were instructed for breath-hold and laid in the supine (feet first) position. An initial full-body, unenhanced, low-dose axial CT scan was performed to identify the target lesion at baseline condition. Then, an intravenous 50-mL bolus of contrast agent (Iomeron, Bracco, Milan, Italy) was injected at 5mL/s. 5s after, axial CTp scan was performed at fixed tube voltage (80kV) and current (250mA), with an exposure of 100mAs. A single acquisition of 25-second duration consisted of M=20 scans centred on the target lesion, yielding volumes of 55mm of z-coverage with N=11 slices (5-mm thickness each, 0.4-second rotation time). Finally, image data were then reconstructed to 220 cine images (512×512 pixel, 350mm×350mm, 5-mm slice spacing, 1.25-second temporal resolution).Before computing voxel-based perfusion values, the sequences of slices have been registered according to the 3D rigid procedure described in  [20]. The target lesions and the arterial input (aorta) were selected in agreement by two 25-year experienced radiologists, on a reference slice, where two ROIs for the aorta and the lesion section (hereafter, reference ROI), respectively, were manually outlined. Let f(x, y, z, tm) be the generic voxel, sampled at the time instant tm, m∈{1, …, M}, with (x, y) being the pixel coordinates referring to the slice z, z∈{1, …, N}, and f(x, y, z, t) a generic sampled TCC of the resulting reference sequence, at ROI's voxel location (x, y, z) (hereinafter, f(t) for the sake of readability). Then, all the sampled TCCs are fitted according to the model described in Eq. (1) by using the Levenberg–Marquardt least-squares minimization routine available in MATLAB (MathWorks, Natick, MA), and the resultingfˆ(t)utilized to calculate the functional BF maps. Fig. 2shows the ROI referring to lesion ID8, with related BF colour map (in red, the higher values).BF values strictly lower than 1 mL/min/100 g were considered as being unlikely compliant with physiological values and rather ascribable to numerical errors (since the computing method forces BF to have positive values only), hence marked as unreliable and highlighted in the colour map with the “pink” colour.In order to detect the presence of vessels, bronchi, and artefacts, we used a histogram-based method, referring to a voxel-oriented index of goodness-of-fit of the fitted curve in correspondence of the TCC samples. In particular, for each TCC we first considered, for each sample time instant m, the absolute value of residual, ϵm, defined as:(3)ϵm=|f(tm)−fˆ(tm)|that is, the absolute difference (expressed in HU) between the concentration value measured in that voxel and the expected value derived from the fitting curve at the same time instant. Then, the temporal mean of these M absolute values, μϵ, defined as:(4)μϵ=1M∑m=1Mϵmrepresents the error index for a given voxel. The μϵerrors can be also represented with a colour map, as shown in Fig. 3(a). Of course, we expect that low μϵvalues point out voxels with reliable BF values. On the opposite, a high μϵvalue for a TCC would suggest to exclude its corresponding voxel from the perfusion analysis. In order to find out, for each examination, a proper threshold T capable of discriminating between “low” and “high” error values, we considered the distribution (or better, the histogram, Fig. 3(b)) of these μϵerrors so as to take advantage of statistical indexes, such as the mean E[μϵ] and the standard deviation σ (although the correct notation should beσμϵ, for the sake of readability we always use σ). Accordingly, as the first approach we considered the 2-σ rule  [20], implying that all voxels whose μϵ>E[μϵ]+2σ are highlighted and discarded. In that case, the threshold is defined as T2σ=E[μϵ]+2σ. Histograms have positive values only and long right tails and, subsequently, the 2-σ rule is quite conservative. For this reason, we proposed a second well-established and more aggressive approach (also known as “the triangle method”) conceived for “removing” tails in unimodal distributions  [27]. Hereafter, we refer to its threshold as TT. In particular, given a straight line joining the modal and the last bin, TTis defined as the index of the bin having the maximum perpendicular distance to that line. As a matter of fact, this geometric approach is less conservative than the 2-σ rule, hence TT<T2σ. Fig. 3(b) shows an example of thresholded histogram (referring to lesion ID8), in cyan, with the blue colour representing errors such that μϵ>T2σand the red colour referring to TT<μϵ≤T2σ. Fig. 3(c) shows the corresponding thresholded colour mask, which emphasizes how pixels with same colours (i.e., undergoing same thresholding) appear as structural aggregates, with spatial coherence, meaning that same errors are shared by quite connected regions. Also, usually red colours extend and surround blue regions, this pointing out a transition from high-error to reliable regions. As a matter of fact, while histograms are used to automatically define a proper threshold (mainly for the triangle method), the thresholded error colour masks are utilized for the subsequent comparison with the original reference slices manually annotated.For each examination, the initial sequence of 20 scans is looked through to detect and annotate the main causes affecting the analysis of perfusion maps, represented by artefacts, and anatomical structures such as vessels and bronchi. The purpose of this manual annotation stage was twofold. On the one hand, we wanted to achieve the best possible performance, and to this purpose the first radiologist (hereafter, Reader A) was given no time limit for his analysis. On the other hand, we aimed to obtain realistic results, and for this reason the second radiologist (hereafter, Reader B) had to complete his analysis in a time compliant with a “routine” CTp study, under the same conditions as those in a clinical environment. The analyses were accomplished in a blind fashion.First of all, the two Readers analysed the whole set of images in cine-mode and detected the presence of vessels and bronchi inside the lesion. After that, they manually outlined in the reference slice the anatomical structures also visible in the reference sequence (Fig. 4(a) and (b)) using a graphic device (Intuos®Pro, Wacom, Krefeld, Germany). Then, the radiologists identified, and manually annotated in the reference slice, the lesion's regions undergoing the different type of artefacts, although mainly arising from partial volume effects induced by residual motion and from beam hardening (Fig. 4(c) and (d)). As one can see in Fig. 4, while vessels and bronchi are usually well identifiable, detecting artefacts is much harder and, even when succeeding, both boundaries and extent cannot be detected with accuracy.One of the purposes of this work is to determine and “quantify” how skilled two very expert readers are to detect and circumscribe the possible causes of errors in perfusion values, stemming from the CTp sequence. This task was carried out by comparing the ROIs manually drawn and the thresholded error colour mask automatically computed, using statistical indexes. In addition, some perfusion maps are compared where errors are removed through our approach versus manual thresholding on perfusion values.Finally, mean, standard deviation and CV (computed as the ratio of the standard deviation to the mean) of the BF values in the original examination, and of the remaining BF values after thresholding using 2-σ rule and triangle method are computed and compared.The way the anatomical structures and artefacts were detected and outlined, mainly the uncertainty in delineating artefacts, drove our choice regarding the approach to compare the regions manually outlined with the outcome of our automatic error detection approach. For this reason, we have considered the number of numerical structures found (or missed) and the presence of artefacts in a given region, since their extent was not visually assessable. Nevertheless, different types of artefacts, in the same lesion are considered separately. Accordingly, there are four different outcomes from the matching procedure: “hit” or true positive (TP), false positive (FP), true negative (TN), “miss” or false negative (FN), all arranged into three 2×2 contingency tables, for vessels, bronchi, and artefacts, respectively  [28]. Also, it is worth recalling that we are interested in detecting only those acquisition and reconstruction artefacts, vessels, and bronchi that can hamper the perfusion values, rather than artefacts or anatomical structures in themselves. Therefore, as the reference (i.e., the “ground truth”) we chose the thresholded error masks and the regions manually outlined by radiologists were considered as the test condition. For instance, when a Reader detects an item that has no correspondence on the thresholded error mask (this representing a FP), this does not necessarily hints a mistake, rather most probably what detected does not hamper the computation of perfusion values. On the other side, in case that a Reader does not outline any item in correspondence of an error structure present in the thresholded error map, this is considered a FN only after that a radiologist confirmed the nature of that error structure, that is vessel, bronchus or artefact. The simple case is when no error structures are detected, nor visually neither automatically, when the TN number in each contingency table is increased by one. As far as the TP are concerned, at the beginning we hypothesized to segment the thresholded error maps into connected ROIs and perform an automatic matching between manual and computed ROIs. Then, several known strategies could have been considered to decree a match, ranging from inclusion criteria to overlapping thresholds, even weighted to allow for possible different sizes  [29]. As a matter of fact, this could work for anatomical structures, but would fail for artefacts and using different approaches would not have been fair. Besides that, in any case determining the FNs would require the intervention of radiologists. In addition, if our purpose is to quantify the readers errors (with the meaning defined at the beginning of this paragraph), then it is enough to find out how many error causes, in terms of structures and artefacts, are missed visually. For all these reasons, we decided that a visual matching performed by the Readers would be appropriate for our purposes.To assess the Readers’ performance we measured how their errors, in terms of FP and FN, impact on the total number of negative (N=FP+TN) and positive (P=TP+FN) cases, respectively. This is given by the frequency of their errors over the total number of cases, namely, the FP rate (FPR=FP/N) and the FN rate (FNR=FN/P), computed on each of the three contingency tables. FPR and FNR are also known as Type I and Type II statistical errors, respectively. Also, in order to better understand the implications of these errors, it could be useful to think of them as functions of specificity (SP) and sensitivity (SE), these being entities more used in clinics, where FPR=1-SP and FNR=1-SE.The paired two-sided Wilcoxon signed rank test was used to compare the mean BF values before and after thresholding, while the one-tail F test and Z test were computed to assess the reduction of standard deviation and CV, respectively, after thresholding. All tests are implemented in R software (version 3.2.1, The R Foundation for Statistical Computing). P values ≤.01 were considered as being statistically significant.

@&#CONCLUSIONS@&#
