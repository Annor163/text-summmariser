@&#MAIN-TITLE@&#
Large-scale CFD simulations of the transitional and turbulent regime for the large human airways during rapid inhalation

@&#HIGHLIGHTS@&#
Unsteady flow in the human large airways during a rapid inhalation is proposed.The finest mesh contained 350 million elements.Thanks to the high fidelity simulations, turbulence and transitional regime are observed.

@&#KEYPHRASES@&#
CFD,Airways,Turbulence,Inspiratory flow,Respiratory airflow,

@&#ABSTRACT@&#
The dynamics of unsteady flow in the human large airways during a rapid inhalation were investigated using highly detailed large-scale computational fluid dynamics on a subject-specific geometry. The simulations were performed to resolve all the spatial and temporal scales of the flow, thanks to the use of massive computational resources. A highly parallel finite element code was used, running on two supercomputers, solving the transient incompressible Navier–Stokes equations on unstructured meshes. Given that the finest mesh contained 350 million elements, the study sets a precedent for large-scale simulations of the respiratory system, proposing an analysis strategy for mean flow, fluctuations and wall shear stresses on a rapid and short inhalation (a so-called sniff). The geometry used encompasses the exterior face and the airways from the nasal cavity, through the trachea and up to the third lung bifurcation; it was derived from a contrast-enhanced computed tomography (CT) scan of a 48-year-old male. The transient inflow produces complex flows over a wide range of Reynolds numbers (Re). Thanks to the high fidelity simulations, many features involving the flow transition were observed, with the level of turbulence clearly higher in the throat than in the nose. Spectral analysis revealed turbulent characteristics persisting downstream of the glottis, and were captured even with a medium mesh resolution. However a fine mesh resolution was found necessary in the nasal cavity to observe transitional features. This work indicates the potential of large-scale simulations to further understanding of airway physiological mechanics, which is essential to guide clinical diagnosis; better understanding of the flow also has implications for the design of interventions such as aerosol drug delivery.

@&#INTRODUCTION@&#
The flow in the human large airways is rich with complexity and variety. The geometry is extraordinarily complex with constriction zones and rapid changes in direction. Accordingly, a wide range of local Reynolds numbers (Re) occurs in the human large airways, which involve a mixture of various fluid motions. Further complications arise due to the fact that the breathing pace can change dramatically: at rest, whilst smelling or under heavy exercise. Previous studies state than while one is resting, flow is quasi-steady and laminar (see Zhao et al. [1]). On the other hand, during the kind of inspiration typical of a sniff, which is a rapid and short inhalation, the assumption of laminar flow is not justified. With the high amplitude of the inhalation and the rapid acceleration occurring during the sniff, the flow is transitional and turbulent.Considering all these issues, the use of large-scale simulations becomes a must, as shown in several previous works where geometry and flow complexity are clearly exposed as core difficulties.Doorly et al. [2] investigated variations in the nasal airways and in the modelling of flow in this complex geometry, providing comparisons [3] with numerical and experimental models. Lintermann et al. [4] also investigated variations in nasal airways, although under the scope of the respiratory efficiency. They classified different nasal cavities into ability groups, which support the a priori decision process on surgical interventions.To ensure a realistic inspiration model and velocity profile at the naris, Taylor et al. [5] demonstrated that incorporating the external nose and face not only reproduces the physiological situation, but also from a computational point of view furnishes additional information, such as the spatial position of particles over time. Other works, such as Jayaraju et al. [6] and Ball et al. [7], used the upper human airway with an idealized geometry and presented results concerning mean flow and flow structures. Contrary to Jayaraju et al. and Ball et al., Ghahramani et al. [8] used a realistic model to perform a numerical analysis in the upper human airway. Saksono et al. [9] and Lin et al. [10] demonstrated that incorporating the nasal cavity into the upper airway is essential in order to study the flow in the throat, since the results with and without the nasal cavity are dramatically different.Many works have been performed with simplified models [11], idealized models [6,7], or using several realistic models [2,3], for example Choi et al. [12] investigated the variabilities of intra- and inter-subject of airflow in the human lung.The laryngeal jet is the most important flow feature occurring in the throat during rapid inhalation. This phenomenon determines mean and fluctuating behaviours of the flow downstream in the tracheobronchiol airways [10]. The laryngeal jet involves various flow types, such as noncircular confined turbulent jet, open cavity flow, shear layers and curved and bifurcating turbulent and transitional pipe flow [12]. Choi et al. [12] detailed the unsteady behaviour of the laryngeal jet through spectral analysis, Varghese et al. [13], described similar behaviours with the laryngeal jet with turbulence in a stenotic flow.Another phenomenon known as flapping which is clearly an unsteady and transitional feature, may occur in the nasal cavity, i.e., in the anterior cavity [2].In the present paper, we focus on the sniff inspiration. A subject-specific model is used for this study, which extends from the face to the third branch generation of the bronchopulmonary tree (see Figs. 1 and 2), created from a contrast-enhanced computed tomography (CT) scan of a 48-year-old male.The objective of this study is to determine the location of transition in the airways during a sniff using a realistic anatomical model and a high resolution of the computational mesh. The spatial and temporal resolutions in this study are very fine, in the order of 1μs for the temporal resolution and 0.1mm for the spatial resolution throughout the domain; well beyond the resolution commonly applied in the literature today [4,14].This paper is organized as follows. Section 2 presents the methods used, Section 3 presents the results of the simulation, whilst the conclusion and the discussion are presented in Section 4.To simulate the flow in the large human airways, computational meshes of different sizes were generated based on a single realistic geometry derived from Computer Tomography images. The numerical simulations were carried out using an in-house finite element code. In the following, brief descriptions of the geometry, the mesh, the fluid solver and the boundary conditions are given.The three-dimensional computational model was reconstructed from a clinically acquired computed tomography scan of a 48-year-old male subject, retrospectively collected from a large hospital database. The scan was performed in the supine position and the resulting data set comprises of 912 images in the axial plane, with 1mm slice thickness and in-plane 0.65×0.65mm pixel size. Further details of the subject and acquisition are provided by Bates et al. [15]. Local ethics committee approval and patient consent were obtained to use the data for the investigation. A short description of the medical case is given in the Appendix section.The preliminary surface definition, obtained from a process of semi-automatic segmentation of the medical images, is of insufficient quality for direct use in numerical simulations. This is due to the limited resolution of the image stack together with the linear sub-pixel interpolation used in the segmentation, which results in an overly faceted and step-like surface representation. The resulting surface was then smoothed using Taubin׳s algorithm [16]. Surface mesh refinement was therefore performed, taking care that the refined surface definition lay within half a pixel size of the initial segmentation. Since this length scale is representative of the underlying uncertainty bounds, the resulting surface representation was deemed anatomically realistic and faithful to the medical data. A rigid-body reorientation to approximately align the posture to the Cartesian axes was performed as a final step to facilitate subsequent analysis.Meshing technique: The mesh discretisation used for scientific computing and simulation of the passages of the upper human respiratory system must be of high quality. An unstructured mesh was employed, due to the complex shape of the computational domain, especially apparent within the elaborate passageways of the nasal cavity. Given the importance of a good spatial discretisation, details of the mesh generation and size characteristics are outlined in the following. The mesh generation software employed was ANSYS ICEM CFD (ANSYS Inc., USA) and the description relates to the use of this software.The approach used employs an octree-based method to generate a fine resolution surface mesh of the computational domain. Since this mesh resolution is finer than the previous representation, surface smoothing is once again required to avoid local flat patches and maintain a smoothly varying representation. The surface smoothing was performed using successive Laplace smoothing [17] and aspect ratio (ratio of shortest to longest edge) smoothing [18] in order to avoid surface shrinkage.The second stage of the meshing process is the generation of a volumetric mesh, for which the Delaunay method was employed. This yielded a tetrahedral volume mesh with a smooth cell transition ratio (~1.2) employed close to the boundary wall. Finally a multi-layer prism mesh was created to resolve the high velocity gradients at the wall, with a few pyramids needed to ensure the transition between the prism layer and tetrahedral mesh in the core of the computational domain.Three meshes: Three different mesh sizes were created with the parameters given in Table 1.The coarsest mesh (M1), with 8 million elements, was employed to obtain a general description of the flow field to identify regions requiring mesh refinement. The medium-sized mesh (M2), with 44 million elements, strikes a balance between computational costs and accuracy of solution, and was used to provide the majority of results presented in this study. Examples of the medium mesh (M2) are presented in Fig. 1. For mesh M2, a minimum element height of 6μm at the wall in used for the most critical region (just above the glottis, see Fig. 2), which corresponds to a value ofy+=u⁎y/ν=0.5at the peak of the sniff inflow, whereu⁎is the friction velocity at the wall, y is the distance to the wall and ν is the local kinematic viscosity of the fluid. This value ofy+can be considered to be sufficiently small for resolving the near-wall flow dynamics [19] and falls into the range defined by Piomelli and Balaras [20] that describes well resolved wall-layers. The mesh generation of the coarse and medium meshes M1 and M2 was achieved using the ANSYS ICEM CFD software. Mesh M2 took 3h to be generated, on a single Intel Xeon X5650 core. A total of 4GB of RAM was used while meshing.The finest mesh (M3) was produced using the Mesh Multiplication technique described in [21]. This technique consists in refining the mesh uniformly, recursively, on-the-fly and in parallel, inside the simulation code. For tetrahedra, hexahedra and prisms, each level multiplies the number of elements by eight, while a pyramid is divided into ten new elements. Mesh M3 was obtained using a one-level mesh multiplication from mesh M2, therefore obtaining approximately (due to the presence of pyramids) eight times more elements. The time to produce this multiplied mesh in parallel is almost negligible [21].Discretization method: We consider the incompressible Navier–Stokes equations, one of the physical modules of the Alya system [22], a high performance computational mechanics code developed at BSC-CNS. The numerical model to solve these equations is based on a stabilized finite element method. The stabilization is based on the Variational MultiScale method which is considered as an implicit Large Eddy Simulation method [23]. The formulation is obtained by splitting the unknowns into grid scale and subgrid scale components. In the present formulation of Alya, the subgrid scale is, in addition, tracked in time and in space, thereby giving more accuracy and more stability to the numerical model [24].Algebraic solver: The discretization of the Navier–Stokes equations yields a coupled algebraic system to be solved at each linearization step within a time loop. The resulting system is split to solve the momentum and continuity equations independently.. This is achieved by applying an iterative strategy to solve for the Schur complement of the pressure. According to our scheme, at each linearization step it is necessary to solve the momentum and continuity equation twice. This split strategy is described and validated in [25].The momentum equation algebraic system is solved using the GMRES method, with a simple diagonal preconditioner with a relatively low Krylov dimension. Usually, convergence is obtained in tens of iterations. The continuity equations are solved using the Deflated Conjugate Gradient (DCG) method [26], together with a linelet preconditioner to accelerate the convergence in the boundary layers [27].Parallelization: The Alya code is written in Fortran90/95 and parallelized with MPI. The partition of the mesh is carried out on-the-fly with the METIS library [28]. The time for the partition is only a few seconds, even for mesh M3, for which the mesh multiplication is performed after the partition.The fluid solver consists mainly of two basic steps, the assembly of the matrix and the right hand side of the Navier–Stokes system, and the solution of this system using the iterative solvers described previously. The assembly step does not require any communication, and its speedup is directly related to the load balance provided by METIS. The MPI exchanges in the iterative solvers are carried out in an asynchronous way, enabling to overlap work and communication during the matrix-vector products. The parallelization of the DCG solver is based on MPI gather functions, as extensively described in [26]. Finally, parallel I/O is achieved using the HDF5 library [29] in order to postprocess the velocities and pressure on the mesh. In addition, filtering strategies enable to postprocess these variables on reduced portions of the mesh or to track single point values at each time step. These filtering techniques are necessary to reduce the amount of stored data and accelerate their visualizations.The computational domain is extensive and comprises, in order of inspired flow direction, a hemisphere of the subject׳s face exterior, followed by the bilateral nasal passages, through to the pharynx, larynx, trachea and down to the third branch generation in the lungs, as shown in Figs. 1 and 2. A no-slip boundary condition is imposed on the passage walls and the flat surface of the external hemisphere.Inflow condition: The inflow velocity is imposed as a Dirichlet condition on the hemisphere dome. It is prescribed as a time varying uniform velocity with direction normal to the hemisphere. The radius of the hemisphere is 0.5m. It was chosen to be large enough to avoid the inlet boundary conditions affecting the flow field within the airways on expiration (0.3m and 1m were also tested). Consequently, for inspiration this hemisphere size is considered to be sufficient. To model the sniff, we use a polynomial function of order 10 derived from the experimental work detailed in Rennie et al. [30], in which several short inhalations from rest as initial conditions were measured for different subjects. The 10th order polynomial function (see Eq. (1)) describing the temporal evolution of the flow rate is provided in Fig. 3, with the coefficients of the flow defining Eq. (1) are referenced in the Appendix section:(1)P(x)=∑i=010Cixi×1.74Outflow condition: A zero-traction outflow condition is imposed as a Neumann condition (the surface is free from external stress) at the third bronchial branch. In order to ensure fully developed flow at the outflow sections, the final bronchial branches were extruded to constant cross-sectional pipes for several diameters. These bronchial branches are set to have the 5 last layers of elements with higher constant viscosity to reduce turbulence and thus to avoid entrant flow that would unstabilize the solution.The mesh convergence study was performed by time averaging the velocity magnitude profile at a location in the trachea (Fig. 4). The time average was taken over the period shown in Fig. 3, during the plateau phase [0.1–0.13s]. The velocity profile is shown over a line extending from the anterior to posterior along the middle of slice 11, defined in Fig. 2(b).The simulations were carried out on the MareNostrum supercomputer, hosted by the Barcelona Supercomputing Center, and on the Fermi supercomputer, hosted by Cineca. For example, to carry out the simulation for the medium mesh M2 on the MareNostrum, 50,000 time-steps are required on 1456 cores requiring approximately 200h. On the Fermi supercomputer, 16,384 cores were used. Usually, in order to keep a good parallel efficiency, between 20,000 and 40,000 elements are used on each core. This makes the RAM requirement of the simulation very low under the possibilities of the computational nodes of the supercomputers used in this work.

@&#CONCLUSIONS@&#
