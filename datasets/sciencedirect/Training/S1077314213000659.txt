@&#MAIN-TITLE@&#
Ricci flow-based spherical parameterization and surface registration

@&#HIGHLIGHTS@&#
An Euclidean Ricci flow for efficient and effective spherical parameterization.A scale space with Ricci energy, which offers robust scale dependent surface features.Combining local features and global Ricci energy for accurate surface registration.The brain surface registration demonstrate the accuracy of the method.The proposed framework shows the efficacy for hippocampus surface analysis.

@&#KEYPHRASES@&#
Discrete Ricci flow,Surface parameterization,Surface registration,Scale space,

@&#ABSTRACT@&#
This paper presents an improved Euclidean Ricci flow method for spherical parameterization. We subsequently invent a scale space processing built upon Ricci energy to extract robust surface features for accurate surface registration. Since our method is based on the proposed Euclidean Ricci flow, it inherits the properties of Ricci flow such as conformality, robustness and intrinsicalness, facilitating efficient and effective surface mapping. Compared with other surface registration methods using curvature or sulci pattern, our method demonstrates a significant improvement for surface registration. In addition, Ricci energy can capture local differences for surface analysis as shown in the experiments and applications.

@&#INTRODUCTION@&#
Image registration is the process of finding the optimal transformation that aligns different imaging data into spatial correspondence. As a result, the same anatomic structures occupy the same spatial locations in different images [40]. It is the building block for a variety of medical image analysis tasks, such as motion correction, multi-modality information fusion, atlas-based image segmentation, population-based studies, longitudinal studies, computational anatomy and image-guided surgery [8,23,28]. Usually, the image registration can be categorized into two categories, volume-based registration and surface-based registration [10]. Since the brain cortex is highly folded, cortical surface model can explicitly preserve geometric property of the cortex compared to volume space [8,26,34]. Thus, surface-based approaches have recently received great attention and been applied in brain morphometry for exploring abnormalities [4,28,31]. Many related comparisons and surveys have also been presented, as in [23,29,38].Usually, surface is parameterized and represented in the spherical domain. There are many different methods of surface parameterization proposed in the past years [9,14,24,30]. In order to achieve spherical parameterization, some methods cut the surface into pieces and turn the problem into planar parameterization [14,21]. These methods are highly dependent on the cutting quality. Others perform the parameterization directly on the sphere by minimizing certain energy function. Gotsman et al. [11] show a nice relationship between spectral graph theory and spherical parameterization, embedding simple meshes on the sphere by solving a quadratic system.Once the spherical representation of the surface is constructed, many image registration algorithms can be used with spherical coordinates. For cortical surface analysis, the methods usually make use of some landmark to guide the registration process. For example, manually identified cortical sulci landmarks were used in [34,39]. Surface properties such as mean curvature, or sulcal depth have also been utilized in [8,26,36]. Though the registrations with manually landmarks are more accurate than that using normal surface properties, it requires medical background and is hard to be applied on large scale data. Therefore, many studies focus on the landmark-free approach with different surface properties for surface registration [25,36].Like Gaussian curvature, Ricci energy is an intrinsic property of surfaces, which can be used for landmark-free surface registration and analysis [12,35]. Ricci energy is computed from Ricci flow. Ricci flow was first introduced in differential geometry by Hamilton [15] for the purpose of proving Poincaré conjecture. It is also a powerful curvature flow method in geometric analysis. Unlike mean curvature flow [18], the Ricci flow is performed purely on the intrinsic geometry of the surface shape as a process of metric diffusion. With the circle packing algorithm [5,17,33], discrete surface Ricci flow theory was developed by Chow and Luo [3] and a computational algorithm was introduced in [19]. The conventional Ricci flow can be highly generalized to the three canonical background geometries, namely, the Euclidean geometry, hyperbolic geometry and spherical geometry. The Ricci energy is convex for Euclidean and hyperbolic geometries. With spherical geometry, however, Ricci energy is not strictly convex but converges to a local optimum [3,20]. Since the conventional circle packing is too restrictive, the Ricci flow algorithm has limitations. For meshes with low quality triangulations, if high conformality is required, the flow tends to be numerically unstable. If convergence to the global optimum is enforced, the conformality may be sacrificed. In order to solve this problem, inversive distance metric [1] was introduced to Ricci flow with euclidean and hyperbolic geometry in [37]. Guo proved the convexity of discrete Ricci energy with the inversive distance circle packing for Euclidean and Hyperbolic case [13]. Thus, Guo’s method is more flexible, more robust and conformal for meshes with low quality triangulations. However, the algorithm does not cover the spherical geometry. From [19], we can see that spherical Ricci flow is not strictly convex, which merely settles at a local minimum. In addition, no packing algorithm intrinsic to the spherical geometry has been found yet. Thus, it is difficult to perform the spherical Ricci flow with inversive distance metric.In this paper, we present a framework for spherical parameterization and registration using Euclidean Ricci flow. The major contributions are summarized as follows: (1) We propose the discrete Euclidean Ricci flow for efficient and effective computation of spherical parameterization; (2) A scale space is designed with Euclidean Ricci energy, which offers robust scale dependent surface features; (3) We present an energy function in the combination of local scale dependent geometry features and global Ricci energy for accurate surface registration; and (4) Applications to the brain surface registration and hippocampus surface analysis demonstrate the efficacy of the proposed framework.The rest of the paper is organized as follows: mathematical background is introduced in Section 2. Discrete euclidean Ricci flow algorithms are explained in Section 3. Scale dependent feature extraction and surface registration are shown in Section 4. The parameter and registration results are discussed in Section 5. We also apply Ricci energy to surface analysis of hippocampus in Section 6. The concluding remarks are given in Section 7.In this section, we briefly introduce the most related theoretical background of discrete geometry and Ricci flow. For more information, please refer to [3,15].Suppose S is a surface, the Riemannian metric is a tensor g=(gij) which is positive definite and defines an inner product for the tangent space of S.Two Riemannian metrics on S are conformal if there is a function defined on the surfaceu:S→Rsuch thatg¯=e2ug, where u is called the conformal factor.Curvature is determined by the Riemannian metric, and different metrics induce different curvatures. But, the total curvature is solely determined by the topology and holds the Gauss–Bonnet theorem: Let (S,g) be a metric surface, the total curvature is(1)∫SKdAg+∫∂Skgds=2πχ(S),where Agis the area of metric g,χ(S) is the Euler number of the surface.The Uniformization theorem [19] ensures that all genus zero surfaces inR3admits a uniformization metric, which is conformal to the original metric and induces constant Gaussian curvature.Ricci flow is a powerful curvature flow method, invented by Hamilton [15] for the proof of the Poincaré conjecture. Intuitively, it describes the process to deform the Riemannian metric according to curvature such that the curvature evolves like a heat diffusion process:(2)dgdt=-2kg.Hamilton [15] and Chow [2] proved the convergence of surface Ricci flow. Thus, for a closed surface, if the total area of the surface is preserved during the flow, the Ricci flow will converge to a metric such that the final metric is compatible with a sphere and can be embedded inS2.In engineering fields, smooth surfaces are often approximated by simplicial complexes. Major concepts such as curvature and conformal deformation in the continuous setting can be generalized to the discrete setting. In the following, we specifically focus on the Euclidean geometric setting, as it is the background geometry of our Ricci flow computation.Suppose M(V,E,F) is a triangle mesh with vertex set V, edge set E and face set F, respectively. We use vito denote the ith vertex. [vi,vj] is the edge between viand vj, [vi,vj,vk] is the face fi,j,kformed by vi, vj, vk.A discrete matrix on M is a function l:E→R+, such that on each face [vi,vj,vk], the triangle inequality holds lij+ljk⩽lki.The discrete metric determines the corner angles on each face by the cosine law,(3)θi=arccoslij2+lki2-ljk22lijlki.Then, we could get the discrete Gaussian curvature Ki. In general, the discrete Gaussian curvature Kion a vertex i can be computed from the angle deficit:(4)Ki=2π-∑fi,j,kθijk,whereθijkrepresents the corner angle attached to vertex viin the face fi,j,k.A circle packing associates each vertex with a circle. The circle at vertex viis denoted as ci(Fig. 1). Suppose the length of [vi,vj] is li,j, the radii of ciand cjare γiand γj, respectively. Then, the inversive distance between ciand cjis given by(5)I(ci,cj)=lij2-γi2-γj22γiγj.A generalized circle packing metric on a mesh M is to associate each vertex viwith a circle ci, whose radius is γi, and to associate each edge [vi,vj] with a nonnegative number Iij. The edge length is given by(6)lij=γi2+γi2+2Iijγiγj.The circle packing metric is denoted as (Γ,I,M), where Γ={γi}, I={Iij}.A discrete conformal deformation is to change radii γionly, and preserve inversive distance Iij. Letui=logγi,then, the discrete Ricci flow is(7)duidt=K¯i-Ki,whereK¯iis the user-defined curvature at vertex vi.Let u represent the vector (u1,u2,…,un) and K represent the vector (K1,K2,…,Kn), where n=∣V∣. The discrete Euclidean Ricci energy is defined as(8)E(u)=∫u0u∑i(K¯i-Ki)dui,where u0=(0,0,…,0).The discrete Euclidean Ricci flow in (7) is the negative gradient flow of the Ricci energy. It is convex on the hyperplane∑iui=0in the admissible metric space. Detailed proof can be found in [3,13]. The metric inducing the target curvature is the unique global optimum of the Ricci energy. Therefore, it, unlike spherical Ricci flow, converges to the global optimum.We use Euclidean Ricci flow for the computation of spherical parameterization. Therefore, the Ricci energy is convex and converges to the global minimum. Because the surface is approximated by a piecewise linear triangular mesh in practice, it is crucial to make certain that the curvature approximation is accurate and robust, with respect to the continuous counterpart.From Fig. 2, we can see that (4) cannot compute the Gaussian curvature accurately when mesh vertices’ distribution is non-uniform on the sphere. Thus, (4) does not satisfy the accuracy requirement. In order to solve this problem, we use Meyer’s method [27] instead.The main idea of Meyer’s method is using a local spatial average over the immediate 1-ring neighborhood to optimize the discrete results. In this method, Gaussian curvature is calculated as:(9)Ki=1AMi2π-∑fi,j,kθijk,where fi,j,kis 1-ring neighbor face of vertex vi.AMiis the mixed area of vi(Fig. 3). Fore more details, please refer to [27].Compared with conventional discrete Gaussian curvature, (9) can be more accurate when computing the Gaussian curvature on a sphere with less computational cost (Fig. 2). Besides, the curvature by using Meyer’s method satisfies the Gauss–Bonnet theorem. Thus, when we compute Euclidean Ricci flow with Meyer’s method, it is still a heat diffusion flow, and converges to the global optimum.This section provides the algorithm for spherical parameterization using Euclidean Ricci flow.Here, we use (9) to calculate the Gaussian curvature. In order to get the appropriate spherical parameterization, we set the target curvature equally everywhere since the Gaussian curvature on a sphere is uniform. According to Gauss–Bonnet theorem, we can get the target curvature:(10)ctarget=4π∑iAMiwhereAMiis the mixed area of vi. Then, we use the method in [37] to calculate the inversive distance circle packing metric.After the inversive distance circle packing metric is calculated, the conformal metric which induces the target curvature is computed as Algorithm 1.Algorithm 1Ricci energy optimizationInput: Initial radii Γ, edge weight I, target curvature ctarget, step length δ, error tolerance τOutput: Gaussian curvature metrics{K0,…,n(t)}, edge length metrics{L0,…,n(t)}, diffused metrics {μ0,…,n(t)}. Here t is the scale factor.1. For each vertex v, set current target curvatureK¯i=ctarget.2. Initialize t=0 and ui=lnγi3. Repeat(a) Compute the edge length lijfrom current vertex radii γi,γjand inversive distance Iij.lij=γi2+γj2+2Iijγiγj(b) Compute the corner angles on each face [vi,vj,vk] using current edge length:θijk=arccoslij2+lki2-ljk22lijlki(c) Compute the mixed areaAMiof each vertex vi.(d) For each vertex vi, compute current curvatureKi=1AMi2π-∑jkθijk(e) Update uiof each vertex vi.ui=ui+δ(K¯i-Ki)(f) Normalize the metrics, set∑iui=0(g) Update the radius γiof vi. γi=exp (ui)(h) Update the target curvatureK¯i=4π∑iAMi.(i) Save the edge lengthsL(t):{lij}, Gaussian curvatureK(t):{Ki}, diffused metrics μ(t):uias the scale-space representation at scale t.(j) t=t+14. Untilmax|K¯i-Ki|⩽τAfter computing the discrete metric of the mesh, we can embed the mesh ontoS2. Basically, we isometrically embed the mesh triangle by triangle using the Euclidean cosine law (Algorithm 2).Algorithm 2Sphere embeddingInput: Final diffused edge length LOutput: Embedding sphere mesh1. Calculate the corresponding spherical radiiR=∑iAMi4π2. Flatten a seed face [vi,vj,vk].3. Put all the neighbored faces of seed face [vi,vj,vk] to a face queue.4. Repeat(a) Pop the first face [vi,vj,vk] from queue.(b) Suppose viand vjhave been embedded, compute the position of vkby using Euclidean cosine law and keep the orientation of the face.(c) Put the neighbor faces of [vi,vj,vk], which haven’t been accessed yet, to the queue.5. Until the face queue is empty.Fig. 4shows the spherical parameter result of left cortical surface.Since Ricci flow energy distribution could be seen as heat diffusion, the scale-space representation of the surface geometry can be formulated as a family of diffused metrics, parameterized by time t. Consider a surface as a Riemannian manifold, the intrinsic geometry of surfaces can be presented by the pointwise Ricci energy. For a triangle mesh M(V,E,F), the scale-space is retained by an n×∣V∣ matrix:(11)Mat(M)=Ev0t0Ev0t1⋯Ev0tn-1Ev1t0Ev1t1⋯Ev1tn-1⋮⋮⋱⋮Evmt0Evmt1⋯Evmtn-1.Here, E is calculated by (8) with the discrete method on each vertex. Compared to the simple differential of Gaussian curvature [41], the Ricci energy also takes the evolving conformal factor into account. Thus, the scale space constructed with Ricci energy (Euclidean) contains more characteristic information and lead to a better feature representation of the shape data. Each column of the matrix stands for the surface Ricci energy at scale t. The scale-space has the following properties:Causality. For 3D objects, recent research in visual saliency suggests that shape features usually appear as curvature variance [41]. For this reason, we identify geometric features as diffused energy extrema in the scale space. The causality criterion can be established by requiring that all minima and maxima of the energy function belong to the original shape with the scale space.Scale invariance. In the spirit of discrete geometry, the curvatures are defined as vertices, edges and faces. With the Euclidean background geometry, the edges and faces have no curvature. This setting let the scale space invariant to the similarity transformation of the objects.Besides, based on the parallel structure of the algorithm, the scale space has the properties of parallelism and flexibility. Thus, we can introduce image scale space analytical method to process the geometric scale space [16,22,41].Once shapes are represented at multiple scales, meaningful features can be extracted in a scale-invariant manner which are adaptive to the surface geometry. For 2D images, the Laplacian normalized with the scale parameter t has proved to be a more stable feature detector, compared to a range of other possible candidates, such as the gradient or Hessian. Let Etbe the geometric representation at scale t. The scale-normalized Laplacian operator is defined as(12)ΔnormEt=t·Δg(t)Et.To detect scale-dependent features, ΔnormEtis required to be the local extrema with respect to both space and scale simultaneously. For a triangular mesh, the discrete Laplacian at vertex vican be calculated as follows:(13)ΔEvit=12∑vj∈N1(vi)(cotαij+cotβij)Evit-Evjtwhere N1(vi) is the 1-ring neighbors of vi. αijand βijare the two angles opposite to edge eij.Consequently, we obtain(14)ΔnormMat=t0ΔEv0t0t1ΔEv0t1⋯tn-1ΔEv0tn-1t0ΔEv1t0t1ΔEv1t1⋯tn-1ΔEv1tn-1⋮⋮⋱⋮t0ΔEvmt0t1ΔEvmt1⋯tn-1ΔEvmtn-1.Then the feature points are identified as local extrema of the normalized Laplacian of the scale space representation across scale t. Specifically, it is done by comparing each vertex in the mesh structure to its 1-ring neighbors at the same scale t and also itself as well as its 1-ring neighbors at the neighboring scales t−1 and t+1. Because features at small scales could be possibly due to the noise, those features have been suppressed. Also, we set a threshold of the magnitude of the scale-normalized Laplacian for another level of feature selection, when too many features cause visual cluttering.Taking geodesic scale into consideration, all the feature points in the geodesic scale of one single coarse feature point at coarse scales will be treated as one feature point. The scale is delineated by a center-surrounded geodesic neighborhoodU(v)of vertex v under original metric g(0), which is formulated as(15)U(v,t)=x|dist(x,v)<2t,x∈S(t),where S(t) is the diffused surface at time t, and v is detected as a feature point at S(t). dist(x,v) is the geodesic distance between point x and v, estimated under the original metric. Fig. 5shows the feature point at different scales on a left hemisphere.Since Ricci energy is an intrinsic property of surface, it is not related to the position or rotation [3]. Through the algorithm, we can get the parameterization result with decreased Ricci energy and conformal factor for each vertex.For surface registration, we need to seek a mapping P:S1→S2 between two surfaces S1 and S2. Instead of seeking a mapping by using the surfaces directly, we use Ricci energy to represent the surface. Thus, we can find a mapping by reducing an scale function between two surfaces:(16)Eshape(P)=α|E1-E2∘P|2+β|F1-F2∘P|2.Here, E1 and E2 are the Ricci energy calculated from (8) of S1 and S2, respectively. F1 and F2 are the feature point positions of S1 and S2. α and β provide a trade-off among the different terms of the function. The first term measures the geometric information differences between the shapes, which we define as∑i(E1(vi)-E2(vi∘P))2,viis the vertex on surface S1, Ei(vi) is the Ricci energy of vion the surface Si. The second term measures the feature point differences by using a scale-dependent representation as the local shape descriptor. Thus, Eshapemeasures the difference distance between S1 and S2. Especially, when Eshape=0, S1 and S2 become equal up to a rigid rotation. Besides, by adjusting the parameters (α and β), we can relate Eshapewith other methods. When β=0, Eshapemeasures the Ricci energy differences between shapes. With α=0, Eshapeis the same as shape matching with scale-dependent shape descriptor. In our work, we set α=1 and β=0.5 to measure the complex shape variation. Therefore, the surface map P minimizing Eshape(P) is the best registration, given the geometry of the surfaces.In order to simplify the calculation of registration, we use the Ricci flow-based spherical parameterization to map the surface S to a simple domain D while keeping the topological connectivity and the geometrical property. Denoting the parameterizations by ϕ1:S1→D1 and ϕ2:S2→D2, D1, D2∈D, the mapping P minimizing Eshapecan be transferred to a composition mappingP′=ϕ2∘P∘ϕ1-1:D1→D2(Fig. 6). Then, the registration transfers to a sphere registration problem on the spherical domain D using (16) as the scale function.In practice, we introduce Spherical Demons algorithm to solve our registration problem. It is based on the two-step optimization of the Demons algorithm and can conduct a good registration in the spherical domain. In order to minimizing the scale function (16), we modify demons objective function to a different interpretation:(17)(ϒ,P′)=argminϒ,P′α‖Σ(E(S1)-E(S2)∘P′)‖2+β‖F1-F2∘P′‖2+1σx2dist(ϒ,P′)+1σT2Reg(ϒ)where P′ is the transformation from D1 to D2 and ϒ is a hidden transformation used in demons algorithm. Then, we can apply the registration process based on [36].

@&#CONCLUSIONS@&#
