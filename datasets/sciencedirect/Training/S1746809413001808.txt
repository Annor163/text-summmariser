@&#MAIN-TITLE@&#
Statistical denoising scheme for single molecule fluorescence microscopic images

@&#HIGHLIGHTS@&#
Applying simple but robust de-noising algorithms to one of interesting biomedical applications.Designing the de-noising algorithms in a Bayesian framework.Introducing heterogeneous priors to Gaussian Markov random field (GMRF) to construct flexible and robust algorithms.

@&#KEYPHRASES@&#
De-noising,Bayesian,Adaptive prior,

@&#ABSTRACT@&#
Single molecule fluorescence microscopy is a powerful technique for uncovering detailed information about biological systems, both in vitro and in vivo. In such experiments, the inherently low signal to noise ratios mean that accurate algorithms to separate true signal and background noise are essential to generate meaningful results. To this end, we have developed a new and robust method to reduce noise in single molecule fluorescence images by using a Gaussian Markov random field (GMRF) prior in a Bayesian framework. Two different strategies are proposed to build the prior—an intrinsic GMRF, with a stationary relationship between pixels and a heterogeneous intrinsic GMRF, with a differently weighted relationship between pixels classified as molecules and background. Testing with synthetic and real experimental fluorescence images demonstrates that the heterogeneous intrinsic GMRF is superior to other conventional de-noising approaches.

@&#INTRODUCTION@&#
Using wide-field fluorescence microscopy with single-molecule sensitivity, it is now possible to track the movement of individual fluorophore-tagged molecules such as proteins and lipids in the cell membrane with nanometer precision. This ability has been used to characterize the diffusional properties of molecules [1], as well as monitor their organization relative to other molecules [2] and cellular structures [3], with the potential to work below the diffraction limit of light.The design of automatic, efficient computer algorithms for data analysis is an extremely important facet of such experiments. Ideally, the program should be able to tolerate the low signal to noise ratios inherent to single-molecule data, must work at high object density and be able to cope with large data volumes at reasonable speed. Suitable methods can usually be decomposed into several sequential steps: filtering of the data, identification of fluorescent objects and their precise positions, and tracking of these objects by linking together their positions over an image sequence. For precise tracking care must be taken to optimize each of these stages.Previous work in single molecule fluorescence image processing has focused on the tracking step of the problem, with several suggested approaches resulting in excellent performance, including a grid algorithm [4], and several Monte Carlo-based algorithms [5,2]. However, with one exception [5], the initial de-noising step utilized conventional de-noising algorithms, such as Gaussian filtering. Afterwards, the detection algorithms are applied to the de-noised images in order to separate signals and background noise. As a result, the tracking algorithms had to assume a cluttered environment with false alarms and missed detections, impacting their performance. Thus in this paper we concentrate on the first step in the data analysis procedure: data filtering or de-noising.De-noising is commonly carried out using one of two approaches: Gaussian smoothing or wavelet de-noising. In the first, the image is smoothed through convolution with a Gaussian or average kernel, which is related to matched filtering for additive uncorrelated noise [6]. Use of a Gaussian filter is justified since the fluorescence profile of an individual molecule is well approximated by (and hence frequently fitted to) a Gaussian function [7]. In cases where the noise addition is linear or stationary, a Wiener filter is also used to reduce the noise of the image [8]. For the non-stationary problem, wavelet based de-noising algorithms are also well-known for image restoration [9,10]. In computer vision and image processing society, Markov random field is also popularly used to reduce noise from images [11–14].To date, there have been several studies about denoising noisy single molecule images [15–17]. Lee et al. uses higher order singular value decomposition (HOSVD) method to extract spatial and temporal features [15]. Noise reduction in single-molecule experiments was improved by using molecular constructs with short handles [17]. There are also several approaches to de-noise the trajectories of the single molecules rather than image denoising [18–20]. A generalized nonlinear filtration technique introduced by Haran reduces the noise of single molecule fluorescence trajectories [18]. Taylor et al. introduced wavelets and Bayesian inference to de-noise single molecule fluorescence resonance energy (smFRET) trajectories [19].In this work we develop and describe a new de-noising algorithm based on a Gaussian Markov random field (GMRF) model. Our proposed algorithm is a fully Bayesian approach with few tuned parameters: we need to set only a small relative threshold parameter and specify hyper-parameters to build prior distributions. The performance of this method relative to previous methods is evaluated using both synthetic and real single molecule data and found to display significant advantages.The paper is structured as follows. We first introduce the Gaussian Markov random field in a latent Gaussian model (Section 2) which is then used to propose mathematical models for de-noising images (Sections 3 and 4). Finally, we compare the results of the various algorithms when applied to synthetic and real data (Section 5).Gaussian Markov random fields (GMRFs) are Gaussian fields defined on a discrete grid with a Markov property of conditional independence of a component with all others given its neighbours [21,22]. They have seen widespread application in statistical modelling, for example in spatio-temporal models [23] and dynamic linear models [24].In this paper, a GMRF f is an one dimensional vector which corresponds to a two dimensional image lattice {(i, j)|i=1, …, n1;j=1, …, n2} [22]. Let ?i,jbe differenced values of f at a site (i, j) on the lattice with neighbours. There are many possible ways to define a GMRF for f through the ?i,j. For example, a first order model can be defined through assuming the differences with the 4 nearest neighbours ?i,j={(i-1, j), (i+1, j), (i, j-1), (i, j+1)},?i,j=?(k,l)??i,j(fk,l-fi,j),to be Gaussian with mean 0 and precision (inverse of variance) ?f. The distribution of f is of multivariate Gaussian form:(1)p(f|?f)?exp-?f2?i=1n1?j=1n2?i,j2=exp-0.5?f(Df)T(Df)=exp-0.5?ffTQff,where Qf=DTD, and D is a n1n2×n1n2 matrix with elementsDm,m=-?d=1,d?mn1n2Dm,d,Dm1,m2=-1if the pixels represented by the m1th and m2th components are neighbours, and 0 otherwise. The resulting precision matrix Qfis not of full rank, in which case it is known as an intrinsic GMRF (IGMRF). This form is used often as a prior in Bayesian inference. For de-noising, it has the desirable properties of placing more prior weight on smooth images while avoiding the specification of a mean value of f. Under very general conditions, the posterior of f will become a proper distribution [22].Note that we focus on de-noising a single image in this paper although we have a sequence of images for processing. For simplicity, we assume images in the sequence are independent so that the de-noising algorithm can be applied separately. The dependency of spots across the sequence of images is accounted for in the tracking process.We assume a Gaussian model for an observed image y in terms of the underlying signal f and some regression coefficients ?=(?1, ?2, ?3):(2)y=zT?+f+?where?~N(·;0,?l-1I)for an unstructured term andNdenotes the Gaussian distribution. In this model, z are lattice location indices so that zT? models any global background noise trend. One of the simplest and the most practical ways to design z is to use low-pass filters like average and Gaussian filter to model the background noise.According to Eqs. (1) and (2), we find that there are unknown regression coefficients ? and a set of two hidden parameters denoted by ?={?l, ?f}. Given this model we assume conjugate prior forms of the regression coefficients(3)?~p(?)=N(?;0,Q?-1),where Q?=(1/103)I3×3, giving a weak prior, and?f~G(·;af,ßf)and?l~G(·;al,ßl),whereG(·;a,ß)denotes the Gamma distribution with hyper-parameters a and ß. Since ?fand ?lare non-negative real variables, we model their priors by using Gamma distribution. In machine learning and data mining literatures, the Gamma distribution is commonly used for designing inverse of variance since the Gaussian distribution of a random variable x with mean µ and covariance (?Q)-1 can be transformed to Gamma distribution with respect to ?.11Given a d dimensional random variable x with µ and variance (?Q)-1, we havep(x|µ,?,Q)=N(x;µ,(?Q)-1)=|2p?Q|(1/2)exp-?2(x-µ)TQ(x-µ)=?(d/2)|2pQ|(1/2)exp-(x-µ)TQ(x-µ)2?=G?;d2+1,(x-µ)T(x-µ)2whereG(·;a,b)is the Gamma distribution with a shape parameter a and a rate parameter b. That is, normal distribution can be described in the Gaussian distribution with respect to ?.. In addition, Gamma distribution is also a member of an exponential family so that we can use it as conjugate prior to obtain a closed form for the posterior distribution.According to the linearity of the hidden parameters in Eq. (2), we can apply Rao-Blackwellization technique [25] to reduce the dimension of the hidden variables and variances. Now, we have marginalized likelihood defined by(4)p(y|f,?)=??p(y|f,?,?)p(?|?)d?=??N(y;zT?+f,?l-1I)N(?;0,Q?-1)d?=N(y;f,F)whereF=?l-1zT(zzT)-1z+zTQ?-1z.Ref. [22] describes several limitations of the intrinsic GMRF. The limitations will bring following problems in de-noising images:1Unwanted blurring effects can be introduced because the IGMRF penalises discrete boundaries or sharp gradients between neighbours;Weak signals can be ignored by smoothing with the background;Stationary (homogeneous) fields across an image rarely exist in practice.In spite of its convenient mathematical properties, these three concerns present difficulties for this application. To address these problems, a variant of the conventional IGMRF is therefore introduced that assigns different interaction weights to pixel neighbours according to whether the pixel is classified as being part of a spot (the molecule of interest is present) or the background. We name this variant of the IGMRF as the heterogeneous GMRF (HGMRF). We also add the disadvantages of HIGMRF in discussion section as well.In this application, pixels in the image can be classified as either a spot or background. This provides a way to allow for non-stationarity in an IGMRF. For pixel (i, j) let ei,j=1 if it is a spot and ei,j=0 if it is background. The conditional distribution p(f|e) is of the same Gaussian form of Eq. (1), and the precision matrix Qfis defined through differences ?i,jas with the IGMRF, but the differences are weighted by ? between a background pixel and neighbouring spot pixels, so(5)?i,j=?(k,l)??i,j(fk,l-fi,j),ifei,j=1,?(k,l)??i,j?1-ek,l(fk,l-fi,j),ifei,j=0,for ?>1. The effect of this prior is to give higher probability to images with large contiguous background regions whilst preventing over-smoothing of spots. The value of ? must be specified; ?=50 is used here and works well for the images used in this paper. This model is related to the Ising model commonly used in image processing [26]. Although the e can be estimated from the p(e|f), we do not estimate e in Gibbs scheme because it is time consuming.The unknown parameters in the marginalized form are f and ?={?l, ?f} and so the goal is to evaluate p(f, ?|y). This is implemented by a Gibbs sampler that samples f from(6)p(f|y,?)?p(y|f,?)p(f|?)=N(y;f,F)N(f;0,?f-1Qf-1)=N(f;µ*,S*)whereS*=(F-1+?fQf)-1and µ*=[I+?fFQf]-1y.Then ?land ?fare sampled separately from p(?|f, y). However, it is not straightforward to draw samples from the marginalized conditional posterior since there is no exact conditional distribution which we can easily generate samples from. Thus, we draw the ? from the complete posterior (which is a sort of data augmentation technique) and then we generate samples on the model parameters ?land ?f. That is, we can generate samples from the full posterior distribution ?~ p(?|y, f, ?) in a Gibbs sampling scheme. However this is not the best solution and we can make more efficient model which has smaller variance than p(?|y, f, ?) by marginalizing out a high-dimensional uncertain variable f. Therefore ? can be drawn not from p(?|y, f, ?) but from p(?|y, ?) where p(?|y, ?)=?fp(?, f|y, ?)df via dimension reduction technique[27],(7)?~p(?|y,?)?p(y|?,?)p(?|?)=p(?|?)?p(y|f,?,?)p(f|?,?)df=N(?;m?,C?)where(8)C?=(S1-1+S2-1)-1m?=C?(S1-1m1+S2-1m2)m1=0m2=(zT)-1yS1=Q?-1S2=?l-1(zzT)-1+?f-1(zQfzT)-1.The detailed derivations of the above equation is described in Appendix. The next step is to generate samples of ?land ?fseparately from p(?|y, f, ?), which are of the form with conjugate prior in Bayesian statistics:(9)?l~p(?l|y,f,?)=p(y|f,?,?l)p(?l)p(y|f,?)=G(·;al*,ßl*)?f~p(?f|f)=p(f|?f)p(?f)p(f)=G(·;af*,ßf*)whereal*=N/2+al,ßl*=(y-zT?-f)T(y-zT?-f)2+1ßl-1,af*=N/2+afandßf*=fTQff2+1ßf-1.When f is an HIGMRF, it depends on e. Good performance of the algorithm can be obtained if e is updated at each iteration of the Gibb's sampler by a locally defined threshold hlocal; eij=0 if fij<hlocal(background) and otherwise eij=1 (spot), reflecting the fact that the background is darker. The details of the algorithm are described in Algorithm 1. The threshold is specified through a parameter h; empirically it has been found that h=0.1 works well for the images used in this paper. More details to find such a hard threshold h will be referred to in discussion section.Algorithm 1e ?getBinaryImage (f)1:h?0.12:Let n1 and n2 be the size of row and column of the image f.3:for alli, j?{i, j|1=i=n1, 1=j=n2, and i and j are integers} do4:Create a window fwincentred at (i, j).5:Calculate a local threshold by hlocal=µlocal+hslocalwhere µlocaland slocalare the mean and standard deviation of pixels of fwinrespectively.STATE If fi,j=hlocal, then ei,j=1. Otherwise, ei,j=0.6:end forThe Gibb's sampler is initialized with e=0 or e=getBinaryImage(y) of Algorithm 1 and Qfis defined as in the usual IGMRF case of Section 2. The tth iteration of the Gibb's sampler is:•?(t) is sampled from p(?|y, ?(t-1)).?(t)=(?l(t),?f(t))is sampled from p(?|y, f(t-1), ?(t)).f(t) is sampled from the marginalized posterior p(f|y, ?(t)).If the HIGMRF prior is used for f:–e(t) is calculated from f(t) from Algorithm 1.Qf(t)is calculated from e(t).The de-noised image is reported as the sample average of the f(t), following an initial burn-in period, Tburn-in. The detailed procedure of HIGMRF is shown in Algorithm 2.Algorithm 2Main algorithm for HIGMRF1:Let y be the noisy image.2:Q?=1103I3×3.3:e(0)?getBinaryImage(y) or e(0)?0.4:CalculateQf(0)using e(0).5:Obtain a random imagef(0)~N(f;0,Qf(0)-1).6:f*=0.7:Let z be the lattice location induces. (Users can apply their own low pass filter algorithms for z.)8:Set af, ßf, aland ßl.9:?l(0)~G(·;al,ßl)and?f(0)~G(·;af,ßf)10:fort=1 to Ldo11:Draw samples ?(t) fromp(?|y,?(t-1))=N(·;m?,C?)whereS2=(zzT)-1?l(t-1)+(zQf(t-1)zT)-1?f(t-1)C?=(Q?+S2-1)-1m?=C?S2-1(zT)-1y12:Draw samples of?l(t)fromp(?l|y,f(t-1),?(t))=G(·;al*,ßl*)and?f(t)fromp(?f|f(t-1))=G(·;af*,ßf*)whereal*=N2+alandßl*=(y-zT?(t)-f(t-1))T(y-zT?(t)-f(t-1))2+1ßl-1af*=N2+afandßf*=f(t-1)TQf(t-1)f(t-1)2+1ßf-1.13:Draw samples f(t) from the marginalized posteriorp(f|y,?(t))=N(·;µ*,S*)whereF=?l(t)-1zT(zzT)-1z+zTQ?-1zS*=(F-1+?f(t)Qf(t-1))-1µ*=(I+?f(t)FQf(t-1))-1y14:Obtain e(t)?getBinaryImage(f(t)).15:CalculateQf(t)using e(t).16:ift>Tburn-inthen17:Add a sample into f*f*=f*+f(t).18:end if19:end for20:Calculate the averaged sample for the denoised image, f*?f*/(T-Tburn-in).Convergence of the MCMC method is checked through the potential scale reduction factor (PSRF) diagnostic of [28] that monitors selected outputs of the MCMC algorithm and is perhaps more accurately described as output analysis[29,30]. For m scalar valued sequences of length L,{?i,n}n=0L-1, i=1, …, m, we define the following quantities:(10)si=?n=0L-1(?i,n-?¯i)2L-1,where?¯i=?n=0L-1?i,nL.W=1m?i=1msi,B=Lm-1?i=0m(?¯i-?¯)2,where?¯=1m?i=0m?¯i. The PSRF is defined to bePSRF=1-1L+BLW.The PSRF is computed for all univariate parameters separately following burn-in. Convergence is consistent with PSRF values below to 1.2 [28]. If this criterion is not satisfied for all parameters then it is indicative of lack of convergence and the simulation run needs to be lengthened.Let f* andf˜be the estimated image by a particular de-noising algorithm and its ground truth image respectively.The most common and simplest metric for the image quality assessment is root mean square error (RMSE) which is computed by averaging the squared intensity differences of f* andf˜byRMSE(f*)=E((f*-f˜)2).Peak signal-to-noise ratio (PSNR) is a well-known quality metric which is an extension of the RMSE by PSNR(f*)=20log10(max(f*)/RMSE(f*)) where max(f*) is the maximum intensity of the estimated image pixels.Letpf˜andpf*be the true distribution and the estimated distribution respectively byKLD(f*)=?ipf˜(i)log(pf˜(i)/pf*(i))where the distributions are estimated via quantification into Nqbins. In this paper, we set Nq=10.The other metric is structural similarity based image quality assessment which is able to explain the strong dependencies between pixels of the highly structured images [31].(11)SSIM(f*)=(2µf*µf˜+C1)(2sf*f˜+C2)(µf*2+µf˜2+C1)(sf*2+sf˜2+C2)whereµf*=?ifi*/N,µf˜=?ifi˜/N,sf*=?i(fi*-µf*)2/N1/2,sf˜=?i(fi˜-µf˜)2/N1/2, andsf*f˜=?i(fi*-µf*)(fi˜-µf˜)/N. In this paper, for simplicity we use C1=C2=0 which is commonly defined as “universal quality index (UQI)” although this produces unstable results when the denominator of Eq. (11) is very close to zero [32].Initially we sought to quantitatively compare the performance of the various algorithms using synthetic data. Single molecule fluorescence images may be designed by particular profiles such as Gaussian profiles for spot shapes. Therefore we model this image as a mixture of spots with Gaussian profiles as follows:(12)f(s)=?k=1Kwk?(s|µ(k),s2)where f(s) is the intensity at position s of the image.wkis the amplitude of each spot, and ?(s|µ(k), s2) denotes the radial Gaussian functions with a specific shape. The radial Gaussian function for each spot consists of the centre position µ(k) and the shared spots’ width s. The basis function and other related equations are definedwk~G(wk;10,5)forallwk>0?(s|µ(k),s2)=|2ps2I2×???2|-1/2exp-12s2(s-µ(k))T(s-µ(k))µ(k)=[µi(k),µj(k)]Tµi(k)~U(µi(k);0,1)µj(k)~U(µi(k);0,1)whereG(·;a,b)is Gamma distribution with parameters a and b andU(·;a,b)is a uniform distribution from which the sampled observations are randomly drawn between minimum a and the maximum b. In addition, to design background signals z? of Eq. (2), the synthetic data has additional background noise by(13)z?=?11n1×???n2+?212?n212?n2????12?n2+?311?122?2????n1n1?n1where1n1×???n2is an n1× n2 matrix with value one and we set [?1, ?2, ?3]=[10, 1, 0.5] in this paper. Afterwards, by adding an unstructured local noise in all area, we finally have y=f+z?+? where?~N(?;0,5000).One of the noisy synthetic images is shown in Fig. 1(g) and its corresponding ground truth image f is in Fig. 1(a). Synthetic data consisted of 50 randomly generated ground-truth images of a 30×30 pixel region with a small number of single molecule signals, to which varying levels of noise were added (resulting in signal to noise ratios in the range of 3–10dB for different noise levels). As we can see in the figure, there are 9 spots in the synthetic image (K=9).Table 1shows the various systematic parameters which are used to process and analysis this synthetic data for our proposed approach and other denoising algorithm. In order to check the sensitivity and stability of the parameters, we tested several experiments for sensitivity analysis. Unfortunately, we found that the systematic parameters are rather sensitive and depend on the data sets. Therefore, the systematic parameters should be carefully chosen to obtain accurate results. It is important to note that the hyper-parameters (af, al, ßfand ßl) are fortunately less sensitive than actual parameters (?fand ?l) in a hierarchical Bayesian scheme. This is why we are estimating the hyper-parameters rather than actual parameters.Fig. 1 shows an example of simulated data (Fig. 1(a) and (g)) and the de-noised images obtained through different algorithms: Gaussian filter (Ga), average filter (Av), Wiener filter (Wi), wavelet filter (Wav) [9], log Garbor wavelet (LGW) based filter [33], total variation approach by Rudin et al. (ROF) [34], non-local mean filter (NLM) [35], total variation by split Bregman method (TV) [36], IGMRF, and HIGMRF of Fig. 1. By eye it appeared that the HIGMRF filtered images came closest to matching the underlying ground-truth. Analysing the root mean square error (RMSE), Kullback Leibler distance (KLD), peak signal-to-noise ratio (PSNR) and structural SIMilarity (SSIM) between the intensities of the ground truth relative to recovered intensities in the filtered images (Fig. 2) confirmed this supposition, showing that intensities recovered after HIGMRF were much closer to the truth than the other methods.In addition, we compared the execution times of the algorithms as shown in Table 2. As we can see in the table, HIGMRF is rather 103–104 times slower than other conventional approaches. This is a critical problem and disadvantage in our proposed approach compared to other traditional approaches. The possible solutions to resolve this problem are presented in the discussion section.Fig. 3shows spectra obtained by using two dimensional discrete Fourier transform (DFT) for both a ground truth of Fig. 1(a) and de-noised images. As we can see in the spectra, the ground truth image has signals in both low and high frequency spaces. Although most algorithms look like using the combination of low and high pass filters, they have far different spectra from Fig. 3(a). In addition, while IGMRF works as if it uses only low-pass filters, the HIGMRF has preserved the uniformity of the frequency space, which is close to the DFT spectra of ground truth image.The localization determination is also tested with this synthetic dataset for evaluating the performance of our proposed approach although this test is slightly out of scope of this paper. This paper is focusing on not how to find centres of the spots but how to reduce the noise. However, it is obvious that we can obtain better localization accuracy if the image is well de-noised. There are several researches on the localization determination [37–39]. Most of them are based on fitting algorithms under an assumption that the intensities of the spots follow bell/Gaussian shape as used in the paper. Fig. 4is the visualization of the detected spots. Fig. 4(a) and (g) is the ground truth image f and its noisy observed image y. The underlying desired spot positions and detected spot positions are displayed in other sub-figures of Fig. 4. As we can see in figure, average filter, wiener filter, log Garbor wavelet filter and our proposed HIGMRF find most spots effectively. However, IGMRF fails to detect the underlying spots and other filtering algorithms including Gaussian filter, Wavelet filter, ROF, NLM and TV have several false alarms.The performance of the algorithms was then tested with real single molecule fluorescence data, obtained on living human T-cells, a cell of the immune response. To create a suitable sample, the immunoglobulin protein CD86 was genetically introduced into human T-cells so that it was present at the cell membrane at low concentrations, as described in Dunne et al. [2]. These molecules were labelled with an organic dye-labelled antibody fragment specific to CD86 (Alexa Fluor 488 labelled Fab molecule, derived from the anti-CD86 antibody BU63, see James et al. [40] for details), and imaged using total internal reflection fluorescence wide-field microscopy, as described previously [2].For this real experimental image, the performances of ten different de-noising algorithms as shown in synthetic dataset were compared for one frame (Fig. 5(a)). The results from these filtering steps are shown in Fig. 5(b)–(k). The figures show only chopped area (40×40 size) to clearly see the denoising effect. Compared to other approaches the HIGMRF preserves the spot signals of interest while it suppresses the global and local noises effectively. The convergence of our Gibbs sampler during IGMRF and HIGMRF filtering of this data was checked using the PSRF diagnostic method described in Section 4.3. The PSRF was found to converge to a value below 1.2 for all components of ? (Fig. 6).

@&#CONCLUSIONS@&#
